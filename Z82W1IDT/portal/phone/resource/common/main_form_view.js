; 
; 
/*! jQuery v1.11.3 | (c) 2005, 2015 jQuery Foundation, Inc. | jquery.org/license */
!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){var c=[],d=c.slice,e=c.concat,f=c.push,g=c.indexOf,h={},i=h.toString,j=h.hasOwnProperty,k={},l="1.11.3",m=function(a,b){return new m.fn.init(a,b)},n=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,o=/^-ms-/,p=/-([\da-z])/gi,q=function(a,b){return b.toUpperCase()};m.fn=m.prototype={jquery:l,constructor:m,selector:"",length:0,toArray:function(){return d.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:d.call(this)},pushStack:function(a){var b=m.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return m.each(this,a,b)},map:function(a){return this.pushStack(m.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:c.sort,splice:c.splice},m.extend=m.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||m.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(e=arguments[h]))for(d in e)a=g[d],c=e[d],g!==c&&(j&&c&&(m.isPlainObject(c)||(b=m.isArray(c)))?(b?(b=!1,f=a&&m.isArray(a)?a:[]):f=a&&m.isPlainObject(a)?a:{},g[d]=m.extend(j,f,c)):void 0!==c&&(g[d]=c));return g},m.extend({expando:"jQuery"+(l+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===m.type(a)},isArray:Array.isArray||function(a){return"array"===m.type(a)},isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){return!m.isArray(a)&&a-parseFloat(a)+1>=0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},isPlainObject:function(a){var b;if(!a||"object"!==m.type(a)||a.nodeType||m.isWindow(a))return!1;try{if(a.constructor&&!j.call(a,"constructor")&&!j.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}if(k.ownLast)for(b in a)return j.call(a,b);for(b in a);return void 0===b||j.call(a,b)},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?h[i.call(a)]||"object":typeof a},globalEval:function(b){b&&m.trim(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(o,"ms-").replace(p,q)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,c){var d,e=0,f=a.length,g=r(a);if(c){if(g){for(;f>e;e++)if(d=b.apply(a[e],c),d===!1)break}else for(e in a)if(d=b.apply(a[e],c),d===!1)break}else if(g){for(;f>e;e++)if(d=b.call(a[e],e,a[e]),d===!1)break}else for(e in a)if(d=b.call(a[e],e,a[e]),d===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(n,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(r(Object(a))?m.merge(c,"string"==typeof a?[a]:a):f.call(c,a)),c},inArray:function(a,b,c){var d;if(b){if(g)return g.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;d>c;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,b){var c=+b.length,d=0,e=a.length;while(c>d)a[e++]=b[d++];if(c!==c)while(void 0!==b[d])a[e++]=b[d++];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,f=0,g=a.length,h=r(a),i=[];if(h)for(;g>f;f++)d=b(a[f],f,c),null!=d&&i.push(d);else for(f in a)d=b(a[f],f,c),null!=d&&i.push(d);return e.apply([],i)},guid:1,proxy:function(a,b){var c,e,f;return"string"==typeof b&&(f=a[b],b=a,a=f),m.isFunction(a)?(c=d.call(arguments,2),e=function(){return a.apply(b||this,c.concat(d.call(arguments)))},e.guid=a.guid=a.guid||m.guid++,e):void 0},now:function(){return+new Date},support:k}),m.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){h["[object "+b+"]"]=b.toLowerCase()});function r(a){var b="length"in a&&a.length,c=m.type(a);return"function"===c||m.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}var s=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+1*new Date,v=a.document,w=0,x=0,y=ha(),z=ha(),A=ha(),B=function(a,b){return a===b&&(l=!0),0},C=1<<31,D={}.hasOwnProperty,E=[],F=E.pop,G=E.push,H=E.push,I=E.slice,J=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},K="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",L="[\\x20\\t\\r\\n\\f]",M="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",N=M.replace("w","w#"),O="\\["+L+"*("+M+")(?:"+L+"*([*^$|!~]?=)"+L+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+N+"))|)"+L+"*\\]",P=":("+M+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+O+")*)|.*)\\)|)",Q=new RegExp(L+"+","g"),R=new RegExp("^"+L+"+|((?:^|[^\\\\])(?:\\\\.)*)"+L+"+$","g"),S=new RegExp("^"+L+"*,"+L+"*"),T=new RegExp("^"+L+"*([>+~]|"+L+")"+L+"*"),U=new RegExp("="+L+"*([^\\]'\"]*?)"+L+"*\\]","g"),V=new RegExp(P),W=new RegExp("^"+N+"$"),X={ID:new RegExp("^#("+M+")"),CLASS:new RegExp("^\\.("+M+")"),TAG:new RegExp("^("+M.replace("w","w*")+")"),ATTR:new RegExp("^"+O),PSEUDO:new RegExp("^"+P),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+L+"*(even|odd|(([+-]|)(\\d*)n|)"+L+"*(?:([+-]|)"+L+"*(\\d+)|))"+L+"*\\)|)","i"),bool:new RegExp("^(?:"+K+")$","i"),needsContext:new RegExp("^"+L+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+L+"*((?:-\\d)?\\d*)"+L+"*\\)|)(?=[^-]|$)","i")},Y=/^(?:input|select|textarea|button)$/i,Z=/^h\d$/i,$=/^[^{]+\{\s*\[native \w/,_=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,aa=/[+~]/,ba=/'|\\/g,ca=new RegExp("\\\\([\\da-f]{1,6}"+L+"?|("+L+")|.)","ig"),da=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},ea=function(){m()};try{H.apply(E=I.call(v.childNodes),v.childNodes),E[v.childNodes.length].nodeType}catch(fa){H={apply:E.length?function(a,b){G.apply(a,I.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function ga(a,b,d,e){var f,h,j,k,l,o,r,s,w,x;if((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,d=d||[],k=b.nodeType,"string"!=typeof a||!a||1!==k&&9!==k&&11!==k)return d;if(!e&&p){if(11!==k&&(f=_.exec(a)))if(j=f[1]){if(9===k){if(h=b.getElementById(j),!h||!h.parentNode)return d;if(h.id===j)return d.push(h),d}else if(b.ownerDocument&&(h=b.ownerDocument.getElementById(j))&&t(b,h)&&h.id===j)return d.push(h),d}else{if(f[2])return H.apply(d,b.getElementsByTagName(a)),d;if((j=f[3])&&c.getElementsByClassName)return H.apply(d,b.getElementsByClassName(j)),d}if(c.qsa&&(!q||!q.test(a))){if(s=r=u,w=b,x=1!==k&&a,1===k&&"object"!==b.nodeName.toLowerCase()){o=g(a),(r=b.getAttribute("id"))?s=r.replace(ba,"\\$&"):b.setAttribute("id",s),s="[id='"+s+"'] ",l=o.length;while(l--)o[l]=s+ra(o[l]);w=aa.test(a)&&pa(b.parentNode)||b,x=o.join(",")}if(x)try{return H.apply(d,w.querySelectorAll(x)),d}catch(y){}finally{r||b.removeAttribute("id")}}}return i(a.replace(R,"$1"),b,d,e)}function ha(){var a=[];function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}return b}function ia(a){return a[u]=!0,a}function ja(a){var b=n.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function ka(a,b){var c=a.split("|"),e=a.length;while(e--)d.attrHandle[c[e]]=b}function la(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||C)-(~a.sourceIndex||C);if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function ma(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function na(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function oa(a){return ia(function(b){return b=+b,ia(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function pa(a){return a&&"undefined"!=typeof a.getElementsByTagName&&a}c=ga.support={},f=ga.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},m=ga.setDocument=function(a){var b,e,g=a?a.ownerDocument||a:v;return g!==n&&9===g.nodeType&&g.documentElement?(n=g,o=g.documentElement,e=g.defaultView,e&&e!==e.top&&(e.addEventListener?e.addEventListener("unload",ea,!1):e.attachEvent&&e.attachEvent("onunload",ea)),p=!f(g),c.attributes=ja(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=ja(function(a){return a.appendChild(g.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=$.test(g.getElementsByClassName),c.getById=ja(function(a){return o.appendChild(a).id=u,!g.getElementsByName||!g.getElementsByName(u).length}),c.getById?(d.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&p){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},d.filter.ID=function(a){var b=a.replace(ca,da);return function(a){return a.getAttribute("id")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(ca,da);return function(a){var c="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):c.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return p?b.getElementsByClassName(a):void 0},r=[],q=[],(c.qsa=$.test(g.querySelectorAll))&&(ja(function(a){o.appendChild(a).innerHTML="<a id='"+u+"'></a><select id='"+u+"-\f]' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&q.push("[*^$]="+L+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||q.push("\\["+L+"*(?:value|"+K+")"),a.querySelectorAll("[id~="+u+"-]").length||q.push("~="),a.querySelectorAll(":checked").length||q.push(":checked"),a.querySelectorAll("a#"+u+"+*").length||q.push(".#.+[+~]")}),ja(function(a){var b=g.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&q.push("name"+L+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||q.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),q.push(",.*:")})),(c.matchesSelector=$.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&ja(function(a){c.disconnectedMatch=s.call(a,"div"),s.call(a,"[s!='']:x"),r.push("!=",P)}),q=q.length&&new RegExp(q.join("|")),r=r.length&&new RegExp(r.join("|")),b=$.test(o.compareDocumentPosition),t=b||$.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===g||a.ownerDocument===v&&t(v,a)?-1:b===g||b.ownerDocument===v&&t(v,b)?1:k?J(k,a)-J(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,e=a.parentNode,f=b.parentNode,h=[a],i=[b];if(!e||!f)return a===g?-1:b===g?1:e?-1:f?1:k?J(k,a)-J(k,b):0;if(e===f)return la(a,b);c=a;while(c=c.parentNode)h.unshift(c);c=b;while(c=c.parentNode)i.unshift(c);while(h[d]===i[d])d++;return d?la(h[d],i[d]):h[d]===v?-1:i[d]===v?1:0},g):n},ga.matches=function(a,b){return ga(a,null,null,b)},ga.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(U,"='$1']"),!(!c.matchesSelector||!p||r&&r.test(b)||q&&q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return ga(b,n,null,[a]).length>0},ga.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},ga.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&D.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},ga.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},ga.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return k=null,a},e=ga.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=ga.selectors={cacheLength:50,createPseudo:ia,match:X,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ca,da),a[3]=(a[3]||a[4]||a[5]||"").replace(ca,da),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||ga.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&ga.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return X.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&V.test(c)&&(b=g(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(ca,da).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+L+")"+a+"("+L+"|$)"))&&y(a,function(a){return b.test("string"==typeof a.className&&a.className||"undefined"!=typeof a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=ga.attr(d,a);return null==e?"!="===b:b?(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e.replace(Q," ")+" ").indexOf(c)>-1:"|="===b?e===c||e.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){while(p){l=b;while(l=l[p])if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){k=q[u]||(q[u]={}),j=k[a]||[],n=j[0]===w&&j[1],m=j[0]===w&&j[2],l=n&&q.childNodes[n];while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if(1===l.nodeType&&++m&&l===b){k[a]=[w,n,m];break}}else if(s&&(j=(b[u]||(b[u]={}))[a])&&j[0]===w)m=j[1];else while(l=++n&&l&&l[p]||(m=n=0)||o.pop())if((h?l.nodeName.toLowerCase()===r:1===l.nodeType)&&++m&&(s&&((l[u]||(l[u]={}))[a]=[w,m]),l===b))break;return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||ga.error("unsupported pseudo: "+a);return e[u]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?ia(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=J(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:ia(function(a){var b=[],c=[],d=h(a.replace(R,"$1"));return d[u]?ia(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),b[0]=null,!c.pop()}}),has:ia(function(a){return function(b){return ga(a,b).length>0}}),contains:ia(function(a){return a=a.replace(ca,da),function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:ia(function(a){return W.test(a||"")||ga.error("unsupported lang: "+a),a=a.replace(ca,da).toLowerCase(),function(b){var c;do if(c=p?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return Z.test(a.nodeName)},input:function(a){return Y.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:oa(function(){return[0]}),last:oa(function(a,b){return[b-1]}),eq:oa(function(a,b,c){return[0>c?c+b:c]}),even:oa(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:oa(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:oa(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:oa(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=ma(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=na(b);function qa(){}qa.prototype=d.filters=d.pseudos,d.setFilters=new qa,g=ga.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){(!c||(e=S.exec(h)))&&(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=T.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(R," ")}),h=h.slice(c.length));for(g in d.filter)!(e=X[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?ga.error(a):z(a,i).slice(0)};function ra(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function sa(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=x++;return b.first?function(b,c,f){while(b=b[d])if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j=[w,f];if(g){while(b=b[d])if((1===b.nodeType||e)&&a(b,c,g))return!0}else while(b=b[d])if(1===b.nodeType||e){if(i=b[u]||(b[u]={}),(h=i[d])&&h[0]===w&&h[1]===f)return j[2]=h[2];if(i[d]=j,j[2]=a(b,c,g))return!0}}}function ta(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function ua(a,b,c){for(var d=0,e=b.length;e>d;d++)ga(a,b[d],c);return c}function va(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function wa(a,b,c,d,e,f){return d&&!d[u]&&(d=wa(d)),e&&!e[u]&&(e=wa(e,f)),ia(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||ua(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:va(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=va(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?J(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=va(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):H.apply(g,r)})}function xa(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[" "],i=g?1:0,k=sa(function(a){return a===b},h,!0),l=sa(function(a){return J(b,a)>-1},h,!0),m=[function(a,c,d){var e=!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d));return b=null,e}];f>i;i++)if(c=d.relative[a[i].type])m=[sa(ta(m),c)];else{if(c=d.filter[a[i].type].apply(null,a[i].matches),c[u]){for(e=++i;f>e;e++)if(d.relative[a[e].type])break;return wa(i>1&&ta(m),i>1&&ra(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(R,"$1"),c,e>i&&xa(a.slice(i,e)),f>e&&xa(a=a.slice(e)),f>e&&ra(a))}m.push(c)}return ta(m)}function ya(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,m,o,p=0,q="0",r=f&&[],s=[],t=j,u=f||e&&d.find.TAG("*",k),v=w+=null==t?1:Math.random()||.1,x=u.length;for(k&&(j=g!==n&&g);q!==x&&null!=(l=u[q]);q++){if(e&&l){m=0;while(o=a[m++])if(o(l,g,h)){i.push(l);break}k&&(w=v)}c&&((l=!o&&l)&&p--,f&&r.push(l))}if(p+=q,c&&q!==p){m=0;while(o=b[m++])o(r,s,g,h);if(f){if(p>0)while(q--)r[q]||s[q]||(s[q]=F.call(i));s=va(s)}H.apply(i,s),k&&!f&&s.length>0&&p+b.length>1&&ga.uniqueSort(i)}return k&&(w=v,j=t),r};return c?ia(f):f}return h=ga.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){b||(b=g(a)),c=b.length;while(c--)f=xa(b[c]),f[u]?d.push(f):e.push(f);f=A(a,ya(e,d)),f.selector=a}return f},i=ga.select=function(a,b,e,f){var i,j,k,l,m,n="function"==typeof a&&a,o=!f&&g(a=n.selector||a);if(e=e||[],1===o.length){if(j=o[0]=o[0].slice(0),j.length>2&&"ID"===(k=j[0]).type&&c.getById&&9===b.nodeType&&p&&d.relative[j[1].type]){if(b=(d.find.ID(k.matches[0].replace(ca,da),b)||[])[0],!b)return e;n&&(b=b.parentNode),a=a.slice(j.shift().value.length)}i=X.needsContext.test(a)?0:j.length;while(i--){if(k=j[i],d.relative[l=k.type])break;if((m=d.find[l])&&(f=m(k.matches[0].replace(ca,da),aa.test(j[0].type)&&pa(b.parentNode)||b))){if(j.splice(i,1),a=f.length&&ra(j),!a)return H.apply(e,f),e;break}}}return(n||h(a,o))(f,b,!p,e,aa.test(a)&&pa(b.parentNode)||b),e},c.sortStable=u.split("").sort(B).join("")===u,c.detectDuplicates=!!l,m(),c.sortDetached=ja(function(a){return 1&a.compareDocumentPosition(n.createElement("div"))}),ja(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||ka("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&ja(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||ka("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),ja(function(a){return null==a.getAttribute("disabled")})||ka(K,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),ga}(a);m.find=s,m.expr=s.selectors,m.expr[":"]=m.expr.pseudos,m.unique=s.uniqueSort,m.text=s.getText,m.isXMLDoc=s.isXML,m.contains=s.contains;var t=m.expr.match.needsContext,u=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,v=/^.[^:#\[\.,]*$/;function w(a,b,c){if(m.isFunction(b))return m.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return m.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(v.test(b))return m.filter(b,a,c);b=m.filter(b,a)}return m.grep(a,function(a){return m.inArray(a,b)>=0!==c})}m.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?m.find.matchesSelector(d,a)?[d]:[]:m.find.matches(a,m.grep(b,function(a){return 1===a.nodeType}))},m.fn.extend({find:function(a){var b,c=[],d=this,e=d.length;if("string"!=typeof a)return this.pushStack(m(a).filter(function(){for(b=0;e>b;b++)if(m.contains(d[b],this))return!0}));for(b=0;e>b;b++)m.find(a,d[b],c);return c=this.pushStack(e>1?m.unique(c):c),c.selector=this.selector?this.selector+" "+a:a,c},filter:function(a){return this.pushStack(w(this,a||[],!1))},not:function(a){return this.pushStack(w(this,a||[],!0))},is:function(a){return!!w(this,"string"==typeof a&&t.test(a)?m(a):a||[],!1).length}});var x,y=a.document,z=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,A=m.fn.init=function(a,b){var c,d;if(!a)return this;if("string"==typeof a){if(c="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&a.length>=3?[null,a,null]:z.exec(a),!c||!c[1]&&b)return!b||b.jquery?(b||x).find(a):this.constructor(b).find(a);if(c[1]){if(b=b instanceof m?b[0]:b,m.merge(this,m.parseHTML(c[1],b&&b.nodeType?b.ownerDocument||b:y,!0)),u.test(c[1])&&m.isPlainObject(b))for(c in b)m.isFunction(this[c])?this[c](b[c]):this.attr(c,b[c]);return this}if(d=y.getElementById(c[2]),d&&d.parentNode){if(d.id!==c[2])return x.find(a);this.length=1,this[0]=d}return this.context=y,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):m.isFunction(a)?"undefined"!=typeof x.ready?x.ready(a):a(m):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),m.makeArray(a,this))};A.prototype=m.fn,x=m(y);var B=/^(?:parents|prev(?:Until|All))/,C={children:!0,contents:!0,next:!0,prev:!0};m.extend({dir:function(a,b,c){var d=[],e=a[b];while(e&&9!==e.nodeType&&(void 0===c||1!==e.nodeType||!m(e).is(c)))1===e.nodeType&&d.push(e),e=e[b];return d},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}}),m.fn.extend({has:function(a){var b,c=m(a,this),d=c.length;return this.filter(function(){for(b=0;d>b;b++)if(m.contains(this,c[b]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=t.test(a)||"string"!=typeof a?m(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&m.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?m.unique(f):f)},index:function(a){return a?"string"==typeof a?m.inArray(this[0],m(a)):m.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(m.unique(m.merge(this.get(),m(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function D(a,b){do a=a[b];while(a&&1!==a.nodeType);return a}m.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return m.dir(a,"parentNode")},parentsUntil:function(a,b,c){return m.dir(a,"parentNode",c)},next:function(a){return D(a,"nextSibling")},prev:function(a){return D(a,"previousSibling")},nextAll:function(a){return m.dir(a,"nextSibling")},prevAll:function(a){return m.dir(a,"previousSibling")},nextUntil:function(a,b,c){return m.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return m.dir(a,"previousSibling",c)},siblings:function(a){return m.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return m.sibling(a.firstChild)},contents:function(a){return m.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:m.merge([],a.childNodes)}},function(a,b){m.fn[a]=function(c,d){var e=m.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=m.filter(d,e)),this.length>1&&(C[a]||(e=m.unique(e)),B.test(a)&&(e=e.reverse())),this.pushStack(e)}});var E=/\S+/g,F={};function G(a){var b=F[a]={};return m.each(a.match(E)||[],function(a,c){b[c]=!0}),b}m.Callbacks=function(a){a="string"==typeof a?F[a]||G(a):m.extend({},a);var b,c,d,e,f,g,h=[],i=!a.once&&[],j=function(l){for(c=a.memory&&l,d=!0,f=g||0,g=0,e=h.length,b=!0;h&&e>f;f++)if(h[f].apply(l[0],l[1])===!1&&a.stopOnFalse){c=!1;break}b=!1,h&&(i?i.length&&j(i.shift()):c?h=[]:k.disable())},k={add:function(){if(h){var d=h.length;!function f(b){m.each(b,function(b,c){var d=m.type(c);"function"===d?a.unique&&k.has(c)||h.push(c):c&&c.length&&"string"!==d&&f(c)})}(arguments),b?e=h.length:c&&(g=d,j(c))}return this},remove:function(){return h&&m.each(arguments,function(a,c){var d;while((d=m.inArray(c,h,d))>-1)h.splice(d,1),b&&(e>=d&&e--,f>=d&&f--)}),this},has:function(a){return a?m.inArray(a,h)>-1:!(!h||!h.length)},empty:function(){return h=[],e=0,this},disable:function(){return h=i=c=void 0,this},disabled:function(){return!h},lock:function(){return i=void 0,c||k.disable(),this},locked:function(){return!i},fireWith:function(a,c){return!h||d&&!i||(c=c||[],c=[a,c.slice?c.slice():c],b?i.push(c):j(c)),this},fire:function(){return k.fireWith(this,arguments),this},fired:function(){return!!d}};return k},m.extend({Deferred:function(a){var b=[["resolve","done",m.Callbacks("once memory"),"resolved"],["reject","fail",m.Callbacks("once memory"),"rejected"],["notify","progress",m.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return m.Deferred(function(c){m.each(b,function(b,f){var g=m.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&m.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?m.extend(a,d):d}},e={};return d.pipe=d.then,m.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=d.call(arguments),e=c.length,f=1!==e||a&&m.isFunction(a.promise)?e:0,g=1===f?a:m.Deferred(),h=function(a,b,c){return function(e){b[a]=this,c[a]=arguments.length>1?d.call(arguments):e,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}},i,j,k;if(e>1)for(i=new Array(e),j=new Array(e),k=new Array(e);e>b;b++)c[b]&&m.isFunction(c[b].promise)?c[b].promise().done(h(b,k,c)).fail(g.reject).progress(h(b,j,i)):--f;return f||g.resolveWith(k,c),g.promise()}});var H;m.fn.ready=function(a){return m.ready.promise().done(a),this},m.extend({isReady:!1,readyWait:1,holdReady:function(a){a?m.readyWait++:m.ready(!0)},ready:function(a){if(a===!0?!--m.readyWait:!m.isReady){if(!y.body)return setTimeout(m.ready);m.isReady=!0,a!==!0&&--m.readyWait>0||(H.resolveWith(y,[m]),m.fn.triggerHandler&&(m(y).triggerHandler("ready"),m(y).off("ready")))}}});function I(){y.addEventListener?(y.removeEventListener("DOMContentLoaded",J,!1),a.removeEventListener("load",J,!1)):(y.detachEvent("onreadystatechange",J),a.detachEvent("onload",J))}function J(){(y.addEventListener||"load"===event.type||"complete"===y.readyState)&&(I(),m.ready())}m.ready.promise=function(b){if(!H)if(H=m.Deferred(),"complete"===y.readyState)setTimeout(m.ready);else if(y.addEventListener)y.addEventListener("DOMContentLoaded",J,!1),a.addEventListener("load",J,!1);else{y.attachEvent("onreadystatechange",J),a.attachEvent("onload",J);var c=!1;try{c=null==a.frameElement&&y.documentElement}catch(d){}c&&c.doScroll&&!function e(){if(!m.isReady){try{c.doScroll("left")}catch(a){return setTimeout(e,50)}I(),m.ready()}}()}return H.promise(b)};var K="undefined",L;for(L in m(k))break;k.ownLast="0"!==L,k.inlineBlockNeedsLayout=!1,m(function(){var a,b,c,d;c=y.getElementsByTagName("body")[0],c&&c.style&&(b=y.createElement("div"),d=y.createElement("div"),d.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(d).appendChild(b),typeof b.style.zoom!==K&&(b.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",k.inlineBlockNeedsLayout=a=3===b.offsetWidth,a&&(c.style.zoom=1)),c.removeChild(d))}),function(){var a=y.createElement("div");if(null==k.deleteExpando){k.deleteExpando=!0;try{delete a.test}catch(b){k.deleteExpando=!1}}a=null}(),m.acceptData=function(a){var b=m.noData[(a.nodeName+" ").toLowerCase()],c=+a.nodeType||1;return 1!==c&&9!==c?!1:!b||b!==!0&&a.getAttribute("classid")===b};var M=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,N=/([A-Z])/g;function O(a,b,c){if(void 0===c&&1===a.nodeType){var d="data-"+b.replace(N,"-$1").toLowerCase();if(c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:M.test(c)?m.parseJSON(c):c}catch(e){}m.data(a,b,c)}else c=void 0}return c}function P(a){var b;for(b in a)if(("data"!==b||!m.isEmptyObject(a[b]))&&"toJSON"!==b)return!1;

return!0}function Q(a,b,d,e){if(m.acceptData(a)){var f,g,h=m.expando,i=a.nodeType,j=i?m.cache:a,k=i?a[h]:a[h]&&h;if(k&&j[k]&&(e||j[k].data)||void 0!==d||"string"!=typeof b)return k||(k=i?a[h]=c.pop()||m.guid++:h),j[k]||(j[k]=i?{}:{toJSON:m.noop}),("object"==typeof b||"function"==typeof b)&&(e?j[k]=m.extend(j[k],b):j[k].data=m.extend(j[k].data,b)),g=j[k],e||(g.data||(g.data={}),g=g.data),void 0!==d&&(g[m.camelCase(b)]=d),"string"==typeof b?(f=g[b],null==f&&(f=g[m.camelCase(b)])):f=g,f}}function R(a,b,c){if(m.acceptData(a)){var d,e,f=a.nodeType,g=f?m.cache:a,h=f?a[m.expando]:m.expando;if(g[h]){if(b&&(d=c?g[h]:g[h].data)){m.isArray(b)?b=b.concat(m.map(b,m.camelCase)):b in d?b=[b]:(b=m.camelCase(b),b=b in d?[b]:b.split(" ")),e=b.length;while(e--)delete d[b[e]];if(c?!P(d):!m.isEmptyObject(d))return}(c||(delete g[h].data,P(g[h])))&&(f?m.cleanData([a],!0):k.deleteExpando||g!=g.window?delete g[h]:g[h]=null)}}}m.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(a){return a=a.nodeType?m.cache[a[m.expando]]:a[m.expando],!!a&&!P(a)},data:function(a,b,c){return Q(a,b,c)},removeData:function(a,b){return R(a,b)},_data:function(a,b,c){return Q(a,b,c,!0)},_removeData:function(a,b){return R(a,b,!0)}}),m.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=m.data(f),1===f.nodeType&&!m._data(f,"parsedAttrs"))){c=g.length;while(c--)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=m.camelCase(d.slice(5)),O(f,d,e[d])));m._data(f,"parsedAttrs",!0)}return e}return"object"==typeof a?this.each(function(){m.data(this,a)}):arguments.length>1?this.each(function(){m.data(this,a,b)}):f?O(f,a,m.data(f,a)):void 0},removeData:function(a){return this.each(function(){m.removeData(this,a)})}}),m.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=m._data(a,b),c&&(!d||m.isArray(c)?d=m._data(a,b,m.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=m.queue(a,b),d=c.length,e=c.shift(),f=m._queueHooks(a,b),g=function(){m.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return m._data(a,c)||m._data(a,c,{empty:m.Callbacks("once memory").add(function(){m._removeData(a,b+"queue"),m._removeData(a,c)})})}}),m.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?m.queue(this[0],a):void 0===b?this:this.each(function(){var c=m.queue(this,a,b);m._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&m.dequeue(this,a)})},dequeue:function(a){return this.each(function(){m.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=m.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};"string"!=typeof a&&(b=a,a=void 0),a=a||"fx";while(g--)c=m._data(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}});var S=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,T=["Top","Right","Bottom","Left"],U=function(a,b){return a=b||a,"none"===m.css(a,"display")||!m.contains(a.ownerDocument,a)},V=m.access=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===m.type(c)){e=!0;for(h in c)m.access(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,m.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(m(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},W=/^(?:checkbox|radio)$/i;!function(){var a=y.createElement("input"),b=y.createElement("div"),c=y.createDocumentFragment();if(b.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",k.leadingWhitespace=3===b.firstChild.nodeType,k.tbody=!b.getElementsByTagName("tbody").length,k.htmlSerialize=!!b.getElementsByTagName("link").length,k.html5Clone="<:nav></:nav>"!==y.createElement("nav").cloneNode(!0).outerHTML,a.type="checkbox",a.checked=!0,c.appendChild(a),k.appendChecked=a.checked,b.innerHTML="<textarea>x</textarea>",k.noCloneChecked=!!b.cloneNode(!0).lastChild.defaultValue,c.appendChild(b),b.innerHTML="<input type='radio' checked='checked' name='t'/>",k.checkClone=b.cloneNode(!0).cloneNode(!0).lastChild.checked,k.noCloneEvent=!0,b.attachEvent&&(b.attachEvent("onclick",function(){k.noCloneEvent=!1}),b.cloneNode(!0).click()),null==k.deleteExpando){k.deleteExpando=!0;try{delete b.test}catch(d){k.deleteExpando=!1}}}(),function(){var b,c,d=y.createElement("div");for(b in{submit:!0,change:!0,focusin:!0})c="on"+b,(k[b+"Bubbles"]=c in a)||(d.setAttribute(c,"t"),k[b+"Bubbles"]=d.attributes[c].expando===!1);d=null}();var X=/^(?:input|select|textarea)$/i,Y=/^key/,Z=/^(?:mouse|pointer|contextmenu)|click/,$=/^(?:focusinfocus|focusoutblur)$/,_=/^([^.]*)(?:\.(.+)|)$/;function aa(){return!0}function ba(){return!1}function ca(){try{return y.activeElement}catch(a){}}m.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,n,o,p,q,r=m._data(a);if(r){c.handler&&(i=c,c=i.handler,e=i.selector),c.guid||(c.guid=m.guid++),(g=r.events)||(g=r.events={}),(k=r.handle)||(k=r.handle=function(a){return typeof m===K||a&&m.event.triggered===a.type?void 0:m.event.dispatch.apply(k.elem,arguments)},k.elem=a),b=(b||"").match(E)||[""],h=b.length;while(h--)f=_.exec(b[h])||[],o=q=f[1],p=(f[2]||"").split(".").sort(),o&&(j=m.event.special[o]||{},o=(e?j.delegateType:j.bindType)||o,j=m.event.special[o]||{},l=m.extend({type:o,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&m.expr.match.needsContext.test(e),namespace:p.join(".")},i),(n=g[o])||(n=g[o]=[],n.delegateCount=0,j.setup&&j.setup.call(a,d,p,k)!==!1||(a.addEventListener?a.addEventListener(o,k,!1):a.attachEvent&&a.attachEvent("on"+o,k))),j.add&&(j.add.call(a,l),l.handler.guid||(l.handler.guid=c.guid)),e?n.splice(n.delegateCount++,0,l):n.push(l),m.event.global[o]=!0);a=null}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,n,o,p,q,r=m.hasData(a)&&m._data(a);if(r&&(k=r.events)){b=(b||"").match(E)||[""],j=b.length;while(j--)if(h=_.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o){l=m.event.special[o]||{},o=(d?l.delegateType:l.bindType)||o,n=k[o]||[],h=h[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),i=f=n.length;while(f--)g=n[f],!e&&q!==g.origType||c&&c.guid!==g.guid||h&&!h.test(g.namespace)||d&&d!==g.selector&&("**"!==d||!g.selector)||(n.splice(f,1),g.selector&&n.delegateCount--,l.remove&&l.remove.call(a,g));i&&!n.length&&(l.teardown&&l.teardown.call(a,p,r.handle)!==!1||m.removeEvent(a,o,r.handle),delete k[o])}else for(o in k)m.event.remove(a,o+b[j],c,d,!0);m.isEmptyObject(k)&&(delete r.handle,m._removeData(a,"events"))}},trigger:function(b,c,d,e){var f,g,h,i,k,l,n,o=[d||y],p=j.call(b,"type")?b.type:b,q=j.call(b,"namespace")?b.namespace.split("."):[];if(h=l=d=d||y,3!==d.nodeType&&8!==d.nodeType&&!$.test(p+m.event.triggered)&&(p.indexOf(".")>=0&&(q=p.split("."),p=q.shift(),q.sort()),g=p.indexOf(":")<0&&"on"+p,b=b[m.expando]?b:new m.Event(p,"object"==typeof b&&b),b.isTrigger=e?2:3,b.namespace=q.join("."),b.namespace_re=b.namespace?new RegExp("(^|\\.)"+q.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=d),c=null==c?[b]:m.makeArray(c,[b]),k=m.event.special[p]||{},e||!k.trigger||k.trigger.apply(d,c)!==!1)){if(!e&&!k.noBubble&&!m.isWindow(d)){for(i=k.delegateType||p,$.test(i+p)||(h=h.parentNode);h;h=h.parentNode)o.push(h),l=h;l===(d.ownerDocument||y)&&o.push(l.defaultView||l.parentWindow||a)}n=0;while((h=o[n++])&&!b.isPropagationStopped())b.type=n>1?i:k.bindType||p,f=(m._data(h,"events")||{})[b.type]&&m._data(h,"handle"),f&&f.apply(h,c),f=g&&h[g],f&&f.apply&&m.acceptData(h)&&(b.result=f.apply(h,c),b.result===!1&&b.preventDefault());if(b.type=p,!e&&!b.isDefaultPrevented()&&(!k._default||k._default.apply(o.pop(),c)===!1)&&m.acceptData(d)&&g&&d[p]&&!m.isWindow(d)){l=d[g],l&&(d[g]=null),m.event.triggered=p;try{d[p]()}catch(r){}m.event.triggered=void 0,l&&(d[g]=l)}return b.result}},dispatch:function(a){a=m.event.fix(a);var b,c,e,f,g,h=[],i=d.call(arguments),j=(m._data(this,"events")||{})[a.type]||[],k=m.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){h=m.event.handlers.call(this,a,j),b=0;while((f=h[b++])&&!a.isPropagationStopped()){a.currentTarget=f.elem,g=0;while((e=f.handlers[g++])&&!a.isImmediatePropagationStopped())(!a.namespace_re||a.namespace_re.test(e.namespace))&&(a.handleObj=e,a.data=e.data,c=((m.event.special[e.origType]||{}).handle||e.handler).apply(f.elem,i),void 0!==c&&(a.result=c)===!1&&(a.preventDefault(),a.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&(!a.button||"click"!==a.type))for(;i!=this;i=i.parentNode||this)if(1===i.nodeType&&(i.disabled!==!0||"click"!==a.type)){for(e=[],f=0;h>f;f++)d=b[f],c=d.selector+" ",void 0===e[c]&&(e[c]=d.needsContext?m(c,this).index(i)>=0:m.find(c,this,null,[i]).length),e[c]&&e.push(d);e.length&&g.push({elem:i,handlers:e})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},fix:function(a){if(a[m.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];g||(this.fixHooks[e]=g=Z.test(e)?this.mouseHooks:Y.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new m.Event(f),b=d.length;while(b--)c=d[b],a[c]=f[c];return a.target||(a.target=f.srcElement||y),3===a.target.nodeType&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,g.filter?g.filter(a,f):a},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,d,e,f=b.button,g=b.fromElement;return null==a.pageX&&null!=b.clientX&&(d=a.target.ownerDocument||y,e=d.documentElement,c=d.body,a.pageX=b.clientX+(e&&e.scrollLeft||c&&c.scrollLeft||0)-(e&&e.clientLeft||c&&c.clientLeft||0),a.pageY=b.clientY+(e&&e.scrollTop||c&&c.scrollTop||0)-(e&&e.clientTop||c&&c.clientTop||0)),!a.relatedTarget&&g&&(a.relatedTarget=g===a.target?b.toElement:g),a.which||void 0===f||(a.which=1&f?1:2&f?3:4&f?2:0),a}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==ca()&&this.focus)try{return this.focus(),!1}catch(a){}},delegateType:"focusin"},blur:{trigger:function(){return this===ca()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return m.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(a){return m.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=m.extend(new m.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?m.event.trigger(e,null,b):m.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},m.removeEvent=y.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)}:function(a,b,c){var d="on"+b;a.detachEvent&&(typeof a[d]===K&&(a[d]=null),a.detachEvent(d,c))},m.Event=function(a,b){return this instanceof m.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?aa:ba):this.type=a,b&&m.extend(this,b),this.timeStamp=a&&a.timeStamp||m.now(),void(this[m.expando]=!0)):new m.Event(a,b)},m.Event.prototype={isDefaultPrevented:ba,isPropagationStopped:ba,isImmediatePropagationStopped:ba,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=aa,a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=aa,a&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=aa,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},m.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){m.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!m.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),k.submitBubbles||(m.event.special.submit={setup:function(){return m.nodeName(this,"form")?!1:void m.event.add(this,"click._submit keypress._submit",function(a){var b=a.target,c=m.nodeName(b,"input")||m.nodeName(b,"button")?b.form:void 0;c&&!m._data(c,"submitBubbles")&&(m.event.add(c,"submit._submit",function(a){a._submit_bubble=!0}),m._data(c,"submitBubbles",!0))})},postDispatch:function(a){a._submit_bubble&&(delete a._submit_bubble,this.parentNode&&!a.isTrigger&&m.event.simulate("submit",this.parentNode,a,!0))},teardown:function(){return m.nodeName(this,"form")?!1:void m.event.remove(this,"._submit")}}),k.changeBubbles||(m.event.special.change={setup:function(){return X.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(m.event.add(this,"propertychange._change",function(a){"checked"===a.originalEvent.propertyName&&(this._just_changed=!0)}),m.event.add(this,"click._change",function(a){this._just_changed&&!a.isTrigger&&(this._just_changed=!1),m.event.simulate("change",this,a,!0)})),!1):void m.event.add(this,"beforeactivate._change",function(a){var b=a.target;X.test(b.nodeName)&&!m._data(b,"changeBubbles")&&(m.event.add(b,"change._change",function(a){!this.parentNode||a.isSimulated||a.isTrigger||m.event.simulate("change",this.parentNode,a,!0)}),m._data(b,"changeBubbles",!0))})},handle:function(a){var b=a.target;return this!==b||a.isSimulated||a.isTrigger||"radio"!==b.type&&"checkbox"!==b.type?a.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return m.event.remove(this,"._change"),!X.test(this.nodeName)}}),k.focusinBubbles||m.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){m.event.simulate(b,a.target,m.event.fix(a),!0)};m.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=m._data(d,b);e||d.addEventListener(a,c,!0),m._data(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=m._data(d,b)-1;e?m._data(d,b,e):(d.removeEventListener(a,c,!0),m._removeData(d,b))}}}),m.fn.extend({on:function(a,b,c,d,e){var f,g;if("object"==typeof a){"string"!=typeof b&&(c=c||b,b=void 0);for(f in a)this.on(f,b,c,a[f],e);return this}if(null==c&&null==d?(d=b,c=b=void 0):null==d&&("string"==typeof b?(d=c,c=void 0):(d=c,c=b,b=void 0)),d===!1)d=ba;else if(!d)return this;return 1===e&&(g=d,d=function(a){return m().off(a),g.apply(this,arguments)},d.guid=g.guid||(g.guid=m.guid++)),this.each(function(){m.event.add(this,a,d,c,b)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,m(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return(b===!1||"function"==typeof b)&&(c=b,b=void 0),c===!1&&(c=ba),this.each(function(){m.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){m.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?m.event.trigger(a,b,c,!0):void 0}});function da(a){var b=ea.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}var ea="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",fa=/ jQuery\d+="(?:null|\d+)"/g,ga=new RegExp("<(?:"+ea+")[\\s/>]","i"),ha=/^\s+/,ia=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,ja=/<([\w:]+)/,ka=/<tbody/i,la=/<|&#?\w+;/,ma=/<(?:script|style|link)/i,na=/checked\s*(?:[^=]|=\s*.checked.)/i,oa=/^$|\/(?:java|ecma)script/i,pa=/^true\/(.*)/,qa=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,ra={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:k.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},sa=da(y),ta=sa.appendChild(y.createElement("div"));ra.optgroup=ra.option,ra.tbody=ra.tfoot=ra.colgroup=ra.caption=ra.thead,ra.th=ra.td;function ua(a,b){var c,d,e=0,f=typeof a.getElementsByTagName!==K?a.getElementsByTagName(b||"*"):typeof a.querySelectorAll!==K?a.querySelectorAll(b||"*"):void 0;if(!f)for(f=[],c=a.childNodes||a;null!=(d=c[e]);e++)!b||m.nodeName(d,b)?f.push(d):m.merge(f,ua(d,b));return void 0===b||b&&m.nodeName(a,b)?m.merge([a],f):f}function va(a){W.test(a.type)&&(a.defaultChecked=a.checked)}function wa(a,b){return m.nodeName(a,"table")&&m.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function xa(a){return a.type=(null!==m.find.attr(a,"type"))+"/"+a.type,a}function ya(a){var b=pa.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function za(a,b){for(var c,d=0;null!=(c=a[d]);d++)m._data(c,"globalEval",!b||m._data(b[d],"globalEval"))}function Aa(a,b){if(1===b.nodeType&&m.hasData(a)){var c,d,e,f=m._data(a),g=m._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;e>d;d++)m.event.add(b,c,h[c][d])}g.data&&(g.data=m.extend({},g.data))}}function Ba(a,b){var c,d,e;if(1===b.nodeType){if(c=b.nodeName.toLowerCase(),!k.noCloneEvent&&b[m.expando]){e=m._data(b);for(d in e.events)m.removeEvent(b,d,e.handle);b.removeAttribute(m.expando)}"script"===c&&b.text!==a.text?(xa(b).text=a.text,ya(b)):"object"===c?(b.parentNode&&(b.outerHTML=a.outerHTML),k.html5Clone&&a.innerHTML&&!m.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):"input"===c&&W.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):"option"===c?b.defaultSelected=b.selected=a.defaultSelected:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}}m.extend({clone:function(a,b,c){var d,e,f,g,h,i=m.contains(a.ownerDocument,a);if(k.html5Clone||m.isXMLDoc(a)||!ga.test("<"+a.nodeName+">")?f=a.cloneNode(!0):(ta.innerHTML=a.outerHTML,ta.removeChild(f=ta.firstChild)),!(k.noCloneEvent&&k.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||m.isXMLDoc(a)))for(d=ua(f),h=ua(a),g=0;null!=(e=h[g]);++g)d[g]&&Ba(e,d[g]);if(b)if(c)for(h=h||ua(a),d=d||ua(f),g=0;null!=(e=h[g]);g++)Aa(e,d[g]);else Aa(a,f);return d=ua(f,"script"),d.length>0&&za(d,!i&&ua(a,"script")),d=h=e=null,f},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,l,n=a.length,o=da(b),p=[],q=0;n>q;q++)if(f=a[q],f||0===f)if("object"===m.type(f))m.merge(p,f.nodeType?[f]:f);else if(la.test(f)){h=h||o.appendChild(b.createElement("div")),i=(ja.exec(f)||["",""])[1].toLowerCase(),l=ra[i]||ra._default,h.innerHTML=l[1]+f.replace(ia,"<$1></$2>")+l[2],e=l[0];while(e--)h=h.lastChild;if(!k.leadingWhitespace&&ha.test(f)&&p.push(b.createTextNode(ha.exec(f)[0])),!k.tbody){f="table"!==i||ka.test(f)?"<table>"!==l[1]||ka.test(f)?0:h:h.firstChild,e=f&&f.childNodes.length;while(e--)m.nodeName(j=f.childNodes[e],"tbody")&&!j.childNodes.length&&f.removeChild(j)}m.merge(p,h.childNodes),h.textContent="";while(h.firstChild)h.removeChild(h.firstChild);h=o.lastChild}else p.push(b.createTextNode(f));h&&o.removeChild(h),k.appendChecked||m.grep(ua(p,"input"),va),q=0;while(f=p[q++])if((!d||-1===m.inArray(f,d))&&(g=m.contains(f.ownerDocument,f),h=ua(o.appendChild(f),"script"),g&&za(h),c)){e=0;while(f=h[e++])oa.test(f.type||"")&&c.push(f)}return h=null,o},cleanData:function(a,b){for(var d,e,f,g,h=0,i=m.expando,j=m.cache,l=k.deleteExpando,n=m.event.special;null!=(d=a[h]);h++)if((b||m.acceptData(d))&&(f=d[i],g=f&&j[f])){if(g.events)for(e in g.events)n[e]?m.event.remove(d,e):m.removeEvent(d,e,g.handle);j[f]&&(delete j[f],l?delete d[i]:typeof d.removeAttribute!==K?d.removeAttribute(i):d[i]=null,c.push(f))}}}),m.fn.extend({text:function(a){return V(this,function(a){return void 0===a?m.text(this):this.empty().append((this[0]&&this[0].ownerDocument||y).createTextNode(a))},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=wa(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=wa(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?m.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||m.cleanData(ua(c)),c.parentNode&&(b&&m.contains(c.ownerDocument,c)&&za(ua(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++){1===a.nodeType&&m.cleanData(ua(a,!1));while(a.firstChild)a.removeChild(a.firstChild);a.options&&m.nodeName(a,"select")&&(a.options.length=0)}return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return m.clone(this,a,b)})},html:function(a){return V(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a)return 1===b.nodeType?b.innerHTML.replace(fa,""):void 0;if(!("string"!=typeof a||ma.test(a)||!k.htmlSerialize&&ga.test(a)||!k.leadingWhitespace&&ha.test(a)||ra[(ja.exec(a)||["",""])[1].toLowerCase()])){a=a.replace(ia,"<$1></$2>");try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(m.cleanData(ua(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=arguments[0];return this.domManip(arguments,function(b){a=this.parentNode,m.cleanData(ua(this)),a&&a.replaceChild(b,this)}),a&&(a.length||a.nodeType)?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b){a=e.apply([],a);var c,d,f,g,h,i,j=0,l=this.length,n=this,o=l-1,p=a[0],q=m.isFunction(p);if(q||l>1&&"string"==typeof p&&!k.checkClone&&na.test(p))return this.each(function(c){var d=n.eq(c);q&&(a[0]=p.call(this,c,d.html())),d.domManip(a,b)});if(l&&(i=m.buildFragment(a,this[0].ownerDocument,!1,this),c=i.firstChild,1===i.childNodes.length&&(i=c),c)){for(g=m.map(ua(i,"script"),xa),f=g.length;l>j;j++)d=i,j!==o&&(d=m.clone(d,!0,!0),f&&m.merge(g,ua(d,"script"))),b.call(this[j],d,j);if(f)for(h=g[g.length-1].ownerDocument,m.map(g,ya),j=0;f>j;j++)d=g[j],oa.test(d.type||"")&&!m._data(d,"globalEval")&&m.contains(h,d)&&(d.src?m._evalUrl&&m._evalUrl(d.src):m.globalEval((d.text||d.textContent||d.innerHTML||"").replace(qa,"")));i=c=null}return this}}),m.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){m.fn[a]=function(a){for(var c,d=0,e=[],g=m(a),h=g.length-1;h>=d;d++)c=d===h?this:this.clone(!0),m(g[d])[b](c),f.apply(e,c.get());return this.pushStack(e)}});var Ca,Da={};function Ea(b,c){var d,e=m(c.createElement(b)).appendTo(c.body),f=a.getDefaultComputedStyle&&(d=a.getDefaultComputedStyle(e[0]))?d.display:m.css(e[0],"display");return e.detach(),f}function Fa(a){var b=y,c=Da[a];return c||(c=Ea(a,b),"none"!==c&&c||(Ca=(Ca||m("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=(Ca[0].contentWindow||Ca[0].contentDocument).document,b.write(),b.close(),c=Ea(a,b),Ca.detach()),Da[a]=c),c}!function(){var a;k.shrinkWrapBlocks=function(){if(null!=a)return a;a=!1;var b,c,d;return c=y.getElementsByTagName("body")[0],c&&c.style?(b=y.createElement("div"),d=y.createElement("div"),d.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(d).appendChild(b),typeof b.style.zoom!==K&&(b.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",b.appendChild(y.createElement("div")).style.width="5px",a=3!==b.offsetWidth),c.removeChild(d),a):void 0}}();var Ga=/^margin/,Ha=new RegExp("^("+S+")(?!px)[a-z%]+$","i"),Ia,Ja,Ka=/^(top|right|bottom|left)$/;a.getComputedStyle?(Ia=function(b){return b.ownerDocument.defaultView.opener?b.ownerDocument.defaultView.getComputedStyle(b,null):a.getComputedStyle(b,null)},Ja=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Ia(a),g=c?c.getPropertyValue(b)||c[b]:void 0,c&&(""!==g||m.contains(a.ownerDocument,a)||(g=m.style(a,b)),Ha.test(g)&&Ga.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f)),void 0===g?g:g+""}):y.documentElement.currentStyle&&(Ia=function(a){return a.currentStyle},Ja=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Ia(a),g=c?c[b]:void 0,null==g&&h&&h[b]&&(g=h[b]),Ha.test(g)&&!Ka.test(b)&&(d=h.left,e=a.runtimeStyle,f=e&&e.left,f&&(e.left=a.currentStyle.left),h.left="fontSize"===b?"1em":g,g=h.pixelLeft+"px",h.left=d,f&&(e.left=f)),void 0===g?g:g+""||"auto"});function La(a,b){return{get:function(){var c=a();if(null!=c)return c?void delete this.get:(this.get=b).apply(this,arguments)}}}!function(){var b,c,d,e,f,g,h;if(b=y.createElement("div"),b.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",d=b.getElementsByTagName("a")[0],c=d&&d.style){c.cssText="float:left;opacity:.5",k.opacity="0.5"===c.opacity,k.cssFloat=!!c.cssFloat,b.style.backgroundClip="content-box",b.cloneNode(!0).style.backgroundClip="",k.clearCloneStyle="content-box"===b.style.backgroundClip,k.boxSizing=""===c.boxSizing||""===c.MozBoxSizing||""===c.WebkitBoxSizing,m.extend(k,{reliableHiddenOffsets:function(){return null==g&&i(),g},boxSizingReliable:function(){return null==f&&i(),f},pixelPosition:function(){return null==e&&i(),e},reliableMarginRight:function(){return null==h&&i(),h}});function i(){var b,c,d,i;c=y.getElementsByTagName("body")[0],c&&c.style&&(b=y.createElement("div"),d=y.createElement("div"),d.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(d).appendChild(b),b.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",e=f=!1,h=!0,a.getComputedStyle&&(e="1%"!==(a.getComputedStyle(b,null)||{}).top,f="4px"===(a.getComputedStyle(b,null)||{width:"4px"}).width,i=b.appendChild(y.createElement("div")),i.style.cssText=b.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",i.style.marginRight=i.style.width="0",b.style.width="1px",h=!parseFloat((a.getComputedStyle(i,null)||{}).marginRight),b.removeChild(i)),b.innerHTML="<table><tr><td></td><td>t</td></tr></table>",i=b.getElementsByTagName("td"),i[0].style.cssText="margin:0;border:0;padding:0;display:none",g=0===i[0].offsetHeight,g&&(i[0].style.display="",i[1].style.display="none",g=0===i[0].offsetHeight),c.removeChild(d))}}}(),m.swap=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e};var Ma=/alpha\([^)]*\)/i,Na=/opacity\s*=\s*([^)]*)/,Oa=/^(none|table(?!-c[ea]).+)/,Pa=new RegExp("^("+S+")(.*)$","i"),Qa=new RegExp("^([+-])=("+S+")","i"),Ra={position:"absolute",visibility:"hidden",display:"block"},Sa={letterSpacing:"0",fontWeight:"400"},Ta=["Webkit","O","Moz","ms"];function Ua(a,b){if(b in a)return b;var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=Ta.length;while(e--)if(b=Ta[e]+c,b in a)return b;return d}function Va(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=m._data(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&U(d)&&(f[g]=m._data(d,"olddisplay",Fa(d.nodeName)))):(e=U(d),(c&&"none"!==c||!e)&&m._data(d,"olddisplay",e?c:m.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function Wa(a,b,c){var d=Pa.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function Xa(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=m.css(a,c+T[f],!0,e)),d?("content"===c&&(g-=m.css(a,"padding"+T[f],!0,e)),"margin"!==c&&(g-=m.css(a,"border"+T[f]+"Width",!0,e))):(g+=m.css(a,"padding"+T[f],!0,e),"padding"!==c&&(g+=m.css(a,"border"+T[f]+"Width",!0,e)));return g}function Ya(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=Ia(a),g=k.boxSizing&&"border-box"===m.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=Ja(a,b,f),(0>e||null==e)&&(e=a.style[b]),Ha.test(e))return e;d=g&&(k.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+Xa(a,b,c||(g?"border":"content"),d,f)+"px"}m.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Ja(a,"opacity");return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":k.cssFloat?"cssFloat":"styleFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=m.camelCase(b),i=a.style;if(b=m.cssProps[h]||(m.cssProps[h]=Ua(i,h)),g=m.cssHooks[b]||m.cssHooks[h],void 0===c)return g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b];if(f=typeof c,"string"===f&&(e=Qa.exec(c))&&(c=(e[1]+1)*e[2]+parseFloat(m.css(a,b)),f="number"),null!=c&&c===c&&("number"!==f||m.cssNumber[h]||(c+="px"),k.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),!(g&&"set"in g&&void 0===(c=g.set(a,c,d)))))try{i[b]=c}catch(j){}}},css:function(a,b,c,d){var e,f,g,h=m.camelCase(b);return b=m.cssProps[h]||(m.cssProps[h]=Ua(a.style,h)),g=m.cssHooks[b]||m.cssHooks[h],g&&"get"in g&&(f=g.get(a,!0,c)),void 0===f&&(f=Ja(a,b,d)),"normal"===f&&b in Sa&&(f=Sa[b]),""===c||c?(e=parseFloat(f),c===!0||m.isNumeric(e)?e||0:f):f}}),m.each(["height","width"],function(a,b){m.cssHooks[b]={get:function(a,c,d){return c?Oa.test(m.css(a,"display"))&&0===a.offsetWidth?m.swap(a,Ra,function(){return Ya(a,b,d)}):Ya(a,b,d):void 0},set:function(a,c,d){var e=d&&Ia(a);return Wa(a,c,d?Xa(a,b,d,k.boxSizing&&"border-box"===m.css(a,"boxSizing",!1,e),e):0)}}}),k.opacity||(m.cssHooks.opacity={get:function(a,b){return Na.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=m.isNumeric(b)?"alpha(opacity="+100*b+")":"",f=d&&d.filter||c.filter||"";c.zoom=1,(b>=1||""===b)&&""===m.trim(f.replace(Ma,""))&&c.removeAttribute&&(c.removeAttribute("filter"),""===b||d&&!d.filter)||(c.filter=Ma.test(f)?f.replace(Ma,e):f+" "+e)}}),m.cssHooks.marginRight=La(k.reliableMarginRight,function(a,b){return b?m.swap(a,{display:"inline-block"},Ja,[a,"marginRight"]):void 0}),m.each({margin:"",padding:"",border:"Width"},function(a,b){m.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+T[d]+b]=f[d]||f[d-2]||f[0];return e}},Ga.test(a)||(m.cssHooks[a+b].set=Wa)}),m.fn.extend({css:function(a,b){return V(this,function(a,b,c){var d,e,f={},g=0;if(m.isArray(b)){for(d=Ia(a),e=b.length;e>g;g++)f[b[g]]=m.css(a,b[g],!1,d);return f}return void 0!==c?m.style(a,b,c):m.css(a,b)},a,b,arguments.length>1)},show:function(){return Va(this,!0)},hide:function(){return Va(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){U(this)?m(this).show():m(this).hide()})}});function Za(a,b,c,d,e){
return new Za.prototype.init(a,b,c,d,e)}m.Tween=Za,Za.prototype={constructor:Za,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(m.cssNumber[c]?"":"px")},cur:function(){var a=Za.propHooks[this.prop];return a&&a.get?a.get(this):Za.propHooks._default.get(this)},run:function(a){var b,c=Za.propHooks[this.prop];return this.options.duration?this.pos=b=m.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):Za.propHooks._default.set(this),this}},Za.prototype.init.prototype=Za.prototype,Za.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=m.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){m.fx.step[a.prop]?m.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[m.cssProps[a.prop]]||m.cssHooks[a.prop])?m.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},Za.propHooks.scrollTop=Za.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},m.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},m.fx=Za.prototype.init,m.fx.step={};var $a,_a,ab=/^(?:toggle|show|hide)$/,bb=new RegExp("^(?:([+-])=|)("+S+")([a-z%]*)$","i"),cb=/queueHooks$/,db=[ib],eb={"*":[function(a,b){var c=this.createTween(a,b),d=c.cur(),e=bb.exec(b),f=e&&e[3]||(m.cssNumber[a]?"":"px"),g=(m.cssNumber[a]||"px"!==f&&+d)&&bb.exec(m.css(c.elem,a)),h=1,i=20;if(g&&g[3]!==f){f=f||g[3],e=e||[],g=+d||1;do h=h||".5",g/=h,m.style(c.elem,a,g+f);while(h!==(h=c.cur()/d)&&1!==h&&--i)}return e&&(g=c.start=+g||+d||0,c.unit=f,c.end=e[1]?g+(e[1]+1)*e[2]:+e[2]),c}]};function fb(){return setTimeout(function(){$a=void 0}),$a=m.now()}function gb(a,b){var c,d={height:a},e=0;for(b=b?1:0;4>e;e+=2-b)c=T[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function hb(a,b,c){for(var d,e=(eb[b]||[]).concat(eb["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function ib(a,b,c){var d,e,f,g,h,i,j,l,n=this,o={},p=a.style,q=a.nodeType&&U(a),r=m._data(a,"fxshow");c.queue||(h=m._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,n.always(function(){n.always(function(){h.unqueued--,m.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[p.overflow,p.overflowX,p.overflowY],j=m.css(a,"display"),l="none"===j?m._data(a,"olddisplay")||Fa(a.nodeName):j,"inline"===l&&"none"===m.css(a,"float")&&(k.inlineBlockNeedsLayout&&"inline"!==Fa(a.nodeName)?p.zoom=1:p.display="inline-block")),c.overflow&&(p.overflow="hidden",k.shrinkWrapBlocks()||n.always(function(){p.overflow=c.overflow[0],p.overflowX=c.overflow[1],p.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],ab.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(q?"hide":"show")){if("show"!==e||!r||void 0===r[d])continue;q=!0}o[d]=r&&r[d]||m.style(a,d)}else j=void 0;if(m.isEmptyObject(o))"inline"===("none"===j?Fa(a.nodeName):j)&&(p.display=j);else{r?"hidden"in r&&(q=r.hidden):r=m._data(a,"fxshow",{}),f&&(r.hidden=!q),q?m(a).show():n.done(function(){m(a).hide()}),n.done(function(){var b;m._removeData(a,"fxshow");for(b in o)m.style(a,b,o[b])});for(d in o)g=hb(q?r[d]:0,d,n),d in r||(r[d]=g.start,q&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function jb(a,b){var c,d,e,f,g;for(c in a)if(d=m.camelCase(c),e=b[d],f=a[c],m.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=m.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function kb(a,b,c){var d,e,f=0,g=db.length,h=m.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=$a||fb(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:m.extend({},b),opts:m.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:$a||fb(),duration:c.duration,tweens:[],createTween:function(b,c){var d=m.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(jb(k,j.opts.specialEasing);g>f;f++)if(d=db[f].call(j,a,k,j.opts))return d;return m.map(k,hb,j),m.isFunction(j.opts.start)&&j.opts.start.call(a,j),m.fx.timer(m.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}m.Animation=m.extend(kb,{tweener:function(a,b){m.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],eb[c]=eb[c]||[],eb[c].unshift(b)},prefilter:function(a,b){b?db.unshift(a):db.push(a)}}),m.speed=function(a,b,c){var d=a&&"object"==typeof a?m.extend({},a):{complete:c||!c&&b||m.isFunction(a)&&a,duration:a,easing:c&&b||b&&!m.isFunction(b)&&b};return d.duration=m.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in m.fx.speeds?m.fx.speeds[d.duration]:m.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){m.isFunction(d.old)&&d.old.call(this),d.queue&&m.dequeue(this,d.queue)},d},m.fn.extend({fadeTo:function(a,b,c,d){return this.filter(U).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=m.isEmptyObject(a),f=m.speed(b,c,d),g=function(){var b=kb(this,m.extend({},a),f);(e||m._data(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=m.timers,g=m._data(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&cb.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));(b||!c)&&m.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=m._data(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=m.timers,g=d?d.length:0;for(c.finish=!0,m.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),m.each(["toggle","show","hide"],function(a,b){var c=m.fn[b];m.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(gb(b,!0),a,d,e)}}),m.each({slideDown:gb("show"),slideUp:gb("hide"),slideToggle:gb("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){m.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),m.timers=[],m.fx.tick=function(){var a,b=m.timers,c=0;for($a=m.now();c<b.length;c++)a=b[c],a()||b[c]!==a||b.splice(c--,1);b.length||m.fx.stop(),$a=void 0},m.fx.timer=function(a){m.timers.push(a),a()?m.fx.start():m.timers.pop()},m.fx.interval=13,m.fx.start=function(){_a||(_a=setInterval(m.fx.tick,m.fx.interval))},m.fx.stop=function(){clearInterval(_a),_a=null},m.fx.speeds={slow:600,fast:200,_default:400},m.fn.delay=function(a,b){return a=m.fx?m.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},function(){var a,b,c,d,e;b=y.createElement("div"),b.setAttribute("className","t"),b.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",d=b.getElementsByTagName("a")[0],c=y.createElement("select"),e=c.appendChild(y.createElement("option")),a=b.getElementsByTagName("input")[0],d.style.cssText="top:1px",k.getSetAttribute="t"!==b.className,k.style=/top/.test(d.getAttribute("style")),k.hrefNormalized="/a"===d.getAttribute("href"),k.checkOn=!!a.value,k.optSelected=e.selected,k.enctype=!!y.createElement("form").enctype,c.disabled=!0,k.optDisabled=!e.disabled,a=y.createElement("input"),a.setAttribute("value",""),k.input=""===a.getAttribute("value"),a.value="t",a.setAttribute("type","radio"),k.radioValue="t"===a.value}();var lb=/\r/g;m.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=m.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,m(this).val()):a,null==e?e="":"number"==typeof e?e+="":m.isArray(e)&&(e=m.map(e,function(a){return null==a?"":a+""})),b=m.valHooks[this.type]||m.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=m.valHooks[e.type]||m.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(lb,""):null==c?"":c)}}}),m.extend({valHooks:{option:{get:function(a){var b=m.find.attr(a,"value");return null!=b?b:m.trim(m.text(a))}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(k.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&m.nodeName(c.parentNode,"optgroup"))){if(b=m(c).val(),f)return b;g.push(b)}return g},set:function(a,b){var c,d,e=a.options,f=m.makeArray(b),g=e.length;while(g--)if(d=e[g],m.inArray(m.valHooks.option.get(d),f)>=0)try{d.selected=c=!0}catch(h){d.scrollHeight}else d.selected=!1;return c||(a.selectedIndex=-1),e}}}}),m.each(["radio","checkbox"],function(){m.valHooks[this]={set:function(a,b){return m.isArray(b)?a.checked=m.inArray(m(a).val(),b)>=0:void 0}},k.checkOn||(m.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var mb,nb,ob=m.expr.attrHandle,pb=/^(?:checked|selected)$/i,qb=k.getSetAttribute,rb=k.input;m.fn.extend({attr:function(a,b){return V(this,m.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){m.removeAttr(this,a)})}}),m.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(a&&3!==f&&8!==f&&2!==f)return typeof a.getAttribute===K?m.prop(a,b,c):(1===f&&m.isXMLDoc(a)||(b=b.toLowerCase(),d=m.attrHooks[b]||(m.expr.match.bool.test(b)?nb:mb)),void 0===c?d&&"get"in d&&null!==(e=d.get(a,b))?e:(e=m.find.attr(a,b),null==e?void 0:e):null!==c?d&&"set"in d&&void 0!==(e=d.set(a,c,b))?e:(a.setAttribute(b,c+""),c):void m.removeAttr(a,b))},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(E);if(f&&1===a.nodeType)while(c=f[e++])d=m.propFix[c]||c,m.expr.match.bool.test(c)?rb&&qb||!pb.test(c)?a[d]=!1:a[m.camelCase("default-"+c)]=a[d]=!1:m.attr(a,c,""),a.removeAttribute(qb?c:d)},attrHooks:{type:{set:function(a,b){if(!k.radioValue&&"radio"===b&&m.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}}}),nb={set:function(a,b,c){return b===!1?m.removeAttr(a,c):rb&&qb||!pb.test(c)?a.setAttribute(!qb&&m.propFix[c]||c,c):a[m.camelCase("default-"+c)]=a[c]=!0,c}},m.each(m.expr.match.bool.source.match(/\w+/g),function(a,b){var c=ob[b]||m.find.attr;ob[b]=rb&&qb||!pb.test(b)?function(a,b,d){var e,f;return d||(f=ob[b],ob[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,ob[b]=f),e}:function(a,b,c){return c?void 0:a[m.camelCase("default-"+b)]?b.toLowerCase():null}}),rb&&qb||(m.attrHooks.value={set:function(a,b,c){return m.nodeName(a,"input")?void(a.defaultValue=b):mb&&mb.set(a,b,c)}}),qb||(mb={set:function(a,b,c){var d=a.getAttributeNode(c);return d||a.setAttributeNode(d=a.ownerDocument.createAttribute(c)),d.value=b+="","value"===c||b===a.getAttribute(c)?b:void 0}},ob.id=ob.name=ob.coords=function(a,b,c){var d;return c?void 0:(d=a.getAttributeNode(b))&&""!==d.value?d.value:null},m.valHooks.button={get:function(a,b){var c=a.getAttributeNode(b);return c&&c.specified?c.value:void 0},set:mb.set},m.attrHooks.contenteditable={set:function(a,b,c){mb.set(a,""===b?!1:b,c)}},m.each(["width","height"],function(a,b){m.attrHooks[b]={set:function(a,c){return""===c?(a.setAttribute(b,"auto"),c):void 0}}})),k.style||(m.attrHooks.style={get:function(a){return a.style.cssText||void 0},set:function(a,b){return a.style.cssText=b+""}});var sb=/^(?:input|select|textarea|button|object)$/i,tb=/^(?:a|area)$/i;m.fn.extend({prop:function(a,b){return V(this,m.prop,a,b,arguments.length>1)},removeProp:function(a){return a=m.propFix[a]||a,this.each(function(){try{this[a]=void 0,delete this[a]}catch(b){}})}}),m.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(a,b,c){var d,e,f,g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g)return f=1!==g||!m.isXMLDoc(a),f&&(b=m.propFix[b]||b,e=m.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){var b=m.find.attr(a,"tabindex");return b?parseInt(b,10):sb.test(a.nodeName)||tb.test(a.nodeName)&&a.href?0:-1}}}}),k.hrefNormalized||m.each(["href","src"],function(a,b){m.propHooks[b]={get:function(a){return a.getAttribute(b,4)}}}),k.optSelected||(m.propHooks.selected={get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null}}),m.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){m.propFix[this.toLowerCase()]=this}),k.enctype||(m.propFix.enctype="encoding");var ub=/[\t\r\n\f]/g;m.fn.extend({addClass:function(a){var b,c,d,e,f,g,h=0,i=this.length,j="string"==typeof a&&a;if(m.isFunction(a))return this.each(function(b){m(this).addClass(a.call(this,b,this.className))});if(j)for(b=(a||"").match(E)||[];i>h;h++)if(c=this[h],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(ub," "):" ")){f=0;while(e=b[f++])d.indexOf(" "+e+" ")<0&&(d+=e+" ");g=m.trim(d),c.className!==g&&(c.className=g)}return this},removeClass:function(a){var b,c,d,e,f,g,h=0,i=this.length,j=0===arguments.length||"string"==typeof a&&a;if(m.isFunction(a))return this.each(function(b){m(this).removeClass(a.call(this,b,this.className))});if(j)for(b=(a||"").match(E)||[];i>h;h++)if(c=this[h],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(ub," "):"")){f=0;while(e=b[f++])while(d.indexOf(" "+e+" ")>=0)d=d.replace(" "+e+" "," ");g=a?m.trim(d):"",c.className!==g&&(c.className=g)}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):this.each(m.isFunction(a)?function(c){m(this).toggleClass(a.call(this,c,this.className,b),b)}:function(){if("string"===c){var b,d=0,e=m(this),f=a.match(E)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else(c===K||"boolean"===c)&&(this.className&&m._data(this,"__className__",this.className),this.className=this.className||a===!1?"":m._data(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(ub," ").indexOf(b)>=0)return!0;return!1}}),m.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){m.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),m.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var vb=m.now(),wb=/\?/,xb=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;m.parseJSON=function(b){if(a.JSON&&a.JSON.parse)return a.JSON.parse(b+"");var c,d=null,e=m.trim(b+"");return e&&!m.trim(e.replace(xb,function(a,b,e,f){return c&&b&&(d=0),0===d?a:(c=e||b,d+=!f-!e,"")}))?Function("return "+e)():m.error("Invalid JSON: "+b)},m.parseXML=function(b){var c,d;if(!b||"string"!=typeof b)return null;try{a.DOMParser?(d=new DOMParser,c=d.parseFromString(b,"text/xml")):(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b))}catch(e){c=void 0}return c&&c.documentElement&&!c.getElementsByTagName("parsererror").length||m.error("Invalid XML: "+b),c};var yb,zb,Ab=/#.*$/,Bb=/([?&])_=[^&]*/,Cb=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Db=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Eb=/^(?:GET|HEAD)$/,Fb=/^\/\//,Gb=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Hb={},Ib={},Jb="*/".concat("*");try{zb=location.href}catch(Kb){zb=y.createElement("a"),zb.href="",zb=zb.href}yb=Gb.exec(zb.toLowerCase())||[];function Lb(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(E)||[];if(m.isFunction(c))while(d=f[e++])"+"===d.charAt(0)?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function Mb(a,b,c,d){var e={},f=a===Ib;function g(h){var i;return e[h]=!0,m.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function Nb(a,b){var c,d,e=m.ajaxSettings.flatOptions||{};for(d in b)void 0!==b[d]&&((e[d]?a:c||(c={}))[d]=b[d]);return c&&m.extend(!0,a,c),a}function Ob(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while("*"===i[0])i.shift(),void 0===e&&(e=a.mimeType||b.getResponseHeader("Content-Type"));if(e)for(g in h)if(h[g]&&h[g].test(e)){i.unshift(g);break}if(i[0]in c)f=i[0];else{for(g in c){if(!i[0]||a.converters[g+" "+i[0]]){f=g;break}d||(d=g)}f=f||d}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function Pb(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}m.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:zb,type:"GET",isLocal:Db.test(yb[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Jb,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":m.parseJSON,"text xml":m.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?Nb(Nb(a,m.ajaxSettings),b):Nb(m.ajaxSettings,a)},ajaxPrefilter:Lb(Hb),ajaxTransport:Lb(Ib),ajax:function(a,b){"object"==typeof a&&(b=a,a=void 0),b=b||{};var c,d,e,f,g,h,i,j,k=m.ajaxSetup({},b),l=k.context||k,n=k.context&&(l.nodeType||l.jquery)?m(l):m.event,o=m.Deferred(),p=m.Callbacks("once memory"),q=k.statusCode||{},r={},s={},t=0,u="canceled",v={readyState:0,getResponseHeader:function(a){var b;if(2===t){if(!j){j={};while(b=Cb.exec(f))j[b[1].toLowerCase()]=b[2]}b=j[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===t?f:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return t||(a=s[c]=s[c]||a,r[a]=b),this},overrideMimeType:function(a){return t||(k.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>t)for(b in a)q[b]=[q[b],a[b]];else v.always(a[v.status]);return this},abort:function(a){var b=a||u;return i&&i.abort(b),x(0,b),this}};if(o.promise(v).complete=p.add,v.success=v.done,v.error=v.fail,k.url=((a||k.url||zb)+"").replace(Ab,"").replace(Fb,yb[1]+"//"),k.type=b.method||b.type||k.method||k.type,k.dataTypes=m.trim(k.dataType||"*").toLowerCase().match(E)||[""],null==k.crossDomain&&(c=Gb.exec(k.url.toLowerCase()),k.crossDomain=!(!c||c[1]===yb[1]&&c[2]===yb[2]&&(c[3]||("http:"===c[1]?"80":"443"))===(yb[3]||("http:"===yb[1]?"80":"443")))),k.data&&k.processData&&"string"!=typeof k.data&&(k.data=m.param(k.data,k.traditional)),Mb(Hb,k,b,v),2===t)return v;h=m.event&&k.global,h&&0===m.active++&&m.event.trigger("ajaxStart"),k.type=k.type.toUpperCase(),k.hasContent=!Eb.test(k.type),e=k.url,k.hasContent||(k.data&&(e=k.url+=(wb.test(e)?"&":"?")+k.data,delete k.data),k.cache===!1&&(k.url=Bb.test(e)?e.replace(Bb,"$1_="+vb++):e+(wb.test(e)?"&":"?")+"_="+vb++)),k.ifModified&&(m.lastModified[e]&&v.setRequestHeader("If-Modified-Since",m.lastModified[e]),m.etag[e]&&v.setRequestHeader("If-None-Match",m.etag[e])),(k.data&&k.hasContent&&k.contentType!==!1||b.contentType)&&v.setRequestHeader("Content-Type",k.contentType),v.setRequestHeader("Accept",k.dataTypes[0]&&k.accepts[k.dataTypes[0]]?k.accepts[k.dataTypes[0]]+("*"!==k.dataTypes[0]?", "+Jb+"; q=0.01":""):k.accepts["*"]);for(d in k.headers)v.setRequestHeader(d,k.headers[d]);if(k.beforeSend&&(k.beforeSend.call(l,v,k)===!1||2===t))return v.abort();u="abort";for(d in{success:1,error:1,complete:1})v[d](k[d]);if(i=Mb(Ib,k,b,v)){v.readyState=1,h&&n.trigger("ajaxSend",[v,k]),k.async&&k.timeout>0&&(g=setTimeout(function(){v.abort("timeout")},k.timeout));try{t=1,i.send(r,x)}catch(w){if(!(2>t))throw w;x(-1,w)}}else x(-1,"No Transport");function x(a,b,c,d){var j,r,s,u,w,x=b;2!==t&&(t=2,g&&clearTimeout(g),i=void 0,f=d||"",v.readyState=a>0?4:0,j=a>=200&&300>a||304===a,c&&(u=Ob(k,v,c)),u=Pb(k,u,v,j),j?(k.ifModified&&(w=v.getResponseHeader("Last-Modified"),w&&(m.lastModified[e]=w),w=v.getResponseHeader("etag"),w&&(m.etag[e]=w)),204===a||"HEAD"===k.type?x="nocontent":304===a?x="notmodified":(x=u.state,r=u.data,s=u.error,j=!s)):(s=x,(a||!x)&&(x="error",0>a&&(a=0))),v.status=a,v.statusText=(b||x)+"",j?o.resolveWith(l,[r,x,v]):o.rejectWith(l,[v,x,s]),v.statusCode(q),q=void 0,h&&n.trigger(j?"ajaxSuccess":"ajaxError",[v,k,j?r:s]),p.fireWith(l,[v,x]),h&&(n.trigger("ajaxComplete",[v,k]),--m.active||m.event.trigger("ajaxStop")))}return v},getJSON:function(a,b,c){return m.get(a,b,c,"json")},getScript:function(a,b){return m.get(a,void 0,b,"script")}}),m.each(["get","post"],function(a,b){m[b]=function(a,c,d,e){return m.isFunction(c)&&(e=e||d,d=c,c=void 0),m.ajax({url:a,type:b,dataType:e,data:c,success:d})}}),m._evalUrl=function(a){return m.ajax({url:a,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},m.fn.extend({wrapAll:function(a){if(m.isFunction(a))return this.each(function(b){m(this).wrapAll(a.call(this,b))});if(this[0]){var b=m(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&1===a.firstChild.nodeType)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return this.each(m.isFunction(a)?function(b){m(this).wrapInner(a.call(this,b))}:function(){var b=m(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=m.isFunction(a);return this.each(function(c){m(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){m.nodeName(this,"body")||m(this).replaceWith(this.childNodes)}).end()}}),m.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0||!k.reliableHiddenOffsets()&&"none"===(a.style&&a.style.display||m.css(a,"display"))},m.expr.filters.visible=function(a){return!m.expr.filters.hidden(a)};var Qb=/%20/g,Rb=/\[\]$/,Sb=/\r?\n/g,Tb=/^(?:submit|button|image|reset|file)$/i,Ub=/^(?:input|select|textarea|keygen)/i;function Vb(a,b,c,d){var e;if(m.isArray(b))m.each(b,function(b,e){c||Rb.test(a)?d(a,e):Vb(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==m.type(b))d(a,b);else for(e in b)Vb(a+"["+e+"]",b[e],c,d)}m.param=function(a,b){var c,d=[],e=function(a,b){b=m.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=m.ajaxSettings&&m.ajaxSettings.traditional),m.isArray(a)||a.jquery&&!m.isPlainObject(a))m.each(a,function(){e(this.name,this.value)});else for(c in a)Vb(c,a[c],b,e);return d.join("&").replace(Qb,"+")},m.fn.extend({serialize:function(){return m.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=m.prop(this,"elements");return a?m.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!m(this).is(":disabled")&&Ub.test(this.nodeName)&&!Tb.test(a)&&(this.checked||!W.test(a))}).map(function(a,b){var c=m(this).val();return null==c?null:m.isArray(c)?m.map(c,function(a){return{name:b.name,value:a.replace(Sb,"\r\n")}}):{name:b.name,value:c.replace(Sb,"\r\n")}}).get()}}),m.ajaxSettings.xhr=void 0!==a.ActiveXObject?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&Zb()||$b()}:Zb;var Wb=0,Xb={},Yb=m.ajaxSettings.xhr();a.attachEvent&&a.attachEvent("onunload",function(){for(var a in Xb)Xb[a](void 0,!0)}),k.cors=!!Yb&&"withCredentials"in Yb,Yb=k.ajax=!!Yb,Yb&&m.ajaxTransport(function(a){if(!a.crossDomain||k.cors){var b;return{send:function(c,d){var e,f=a.xhr(),g=++Wb;if(f.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(e in a.xhrFields)f[e]=a.xhrFields[e];a.mimeType&&f.overrideMimeType&&f.overrideMimeType(a.mimeType),a.crossDomain||c["X-Requested-With"]||(c["X-Requested-With"]="XMLHttpRequest");for(e in c)void 0!==c[e]&&f.setRequestHeader(e,c[e]+"");f.send(a.hasContent&&a.data||null),b=function(c,e){var h,i,j;if(b&&(e||4===f.readyState))if(delete Xb[g],b=void 0,f.onreadystatechange=m.noop,e)4!==f.readyState&&f.abort();else{j={},h=f.status,"string"==typeof f.responseText&&(j.text=f.responseText);try{i=f.statusText}catch(k){i=""}h||!a.isLocal||a.crossDomain?1223===h&&(h=204):h=j.text?200:404}j&&d(h,i,j,f.getAllResponseHeaders())},a.async?4===f.readyState?setTimeout(b):f.onreadystatechange=Xb[g]=b:b()},abort:function(){b&&b(void 0,!0)}}}});function Zb(){try{return new a.XMLHttpRequest}catch(b){}}function $b(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}m.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return m.globalEval(a),a}}}),m.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),m.ajaxTransport("script",function(a){if(a.crossDomain){var b,c=y.head||m("head")[0]||y.documentElement;return{send:function(d,e){b=y.createElement("script"),b.async=!0,a.scriptCharset&&(b.charset=a.scriptCharset),b.src=a.url,b.onload=b.onreadystatechange=function(a,c){(c||!b.readyState||/loaded|complete/.test(b.readyState))&&(b.onload=b.onreadystatechange=null,b.parentNode&&b.parentNode.removeChild(b),b=null,c||e(200,"success"))},c.insertBefore(b,c.firstChild)},abort:function(){b&&b.onload(void 0,!0)}}}});var _b=[],ac=/(=)\?(?=&|$)|\?\?/;m.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=_b.pop()||m.expando+"_"+vb++;return this[a]=!0,a}}),m.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(ac.test(b.url)?"url":"string"==typeof b.data&&!(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&ac.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=m.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(ac,"$1"+e):b.jsonp!==!1&&(b.url+=(wb.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||m.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,_b.push(e)),g&&m.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),m.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||y;var d=u.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=m.buildFragment([a],b,e),e&&e.length&&m(e).remove(),m.merge([],d.childNodes))};var bc=m.fn.load;m.fn.load=function(a,b,c){if("string"!=typeof a&&bc)return bc.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>=0&&(d=m.trim(a.slice(h,a.length)),a=a.slice(0,h)),m.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(f="POST"),g.length>0&&m.ajax({url:a,type:f,dataType:"html",data:b}).done(function(a){e=arguments,g.html(d?m("<div>").append(m.parseHTML(a)).find(d):a)}).complete(c&&function(a,b){g.each(c,e||[a.responseText,b,a])}),this},m.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){m.fn[b]=function(a){return this.on(b,a)}}),m.expr.filters.animated=function(a){return m.grep(m.timers,function(b){return a===b.elem}).length};var cc=a.document.documentElement;function dc(a){return m.isWindow(a)?a:9===a.nodeType?a.defaultView||a.parentWindow:!1}m.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=m.css(a,"position"),l=m(a),n={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=m.css(a,"top"),i=m.css(a,"left"),j=("absolute"===k||"fixed"===k)&&m.inArray("auto",[f,i])>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),m.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(n.top=b.top-h.top+g),null!=b.left&&(n.left=b.left-h.left+e),"using"in b?b.using.call(a,n):l.css(n)}},m.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){m.offset.setOffset(this,a,b)});var b,c,d={top:0,left:0},e=this[0],f=e&&e.ownerDocument;if(f)return b=f.documentElement,m.contains(b,e)?(typeof e.getBoundingClientRect!==K&&(d=e.getBoundingClientRect()),c=dc(f),{top:d.top+(c.pageYOffset||b.scrollTop)-(b.clientTop||0),left:d.left+(c.pageXOffset||b.scrollLeft)-(b.clientLeft||0)}):d},position:function(){if(this[0]){var a,b,c={top:0,left:0},d=this[0];return"fixed"===m.css(d,"position")?b=d.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),m.nodeName(a[0],"html")||(c=a.offset()),c.top+=m.css(a[0],"borderTopWidth",!0),c.left+=m.css(a[0],"borderLeftWidth",!0)),{top:b.top-c.top-m.css(d,"marginTop",!0),left:b.left-c.left-m.css(d,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent||cc;while(a&&!m.nodeName(a,"html")&&"static"===m.css(a,"position"))a=a.offsetParent;return a||cc})}}),m.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c=/Y/.test(b);m.fn[a]=function(d){return V(this,function(a,d,e){var f=dc(a);return void 0===e?f?b in f?f[b]:f.document.documentElement[d]:a[d]:void(f?f.scrollTo(c?m(f).scrollLeft():e,c?e:m(f).scrollTop()):a[d]=e)},a,d,arguments.length,null)}}),m.each(["top","left"],function(a,b){m.cssHooks[b]=La(k.pixelPosition,function(a,c){return c?(c=Ja(a,b),Ha.test(c)?m(a).position()[b]+"px":c):void 0})}),m.each({Height:"height",Width:"width"},function(a,b){m.each({padding:"inner"+a,content:b,"":"outer"+a},function(c,d){m.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return V(this,function(b,c,d){var e;return m.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?m.css(b,c,g):m.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),m.fn.size=function(){return this.length},m.fn.andSelf=m.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return m});var ec=a.jQuery,fc=a.$;return m.noConflict=function(b){return a.$===m&&(a.$=fc),b&&a.jQuery===m&&(a.jQuery=ec),m},typeof b===K&&(a.jQuery=a.$=m),m});
; 
var ajaxPage = {
		debug : false,
		//控制页面刷新，弹出层打开时，refresh为false
		refresh : true,
		//存储主页几个title值
		title : {
			homePage : document.title,
			flowCenter : document.title,
			menu : document.title
		},
		//浏览器历史记录管理
		history : {
			//初始历史长度
			initLength : history.length,
			//根据历史长度计算返回页面数量
			getGoBackNum : function(){
				return -(history.length - this.initLength + 1);
			},
			/**
			 * 返回页面
			 * num:特殊操作需要返回两个页面时传值-1，如表单提交
			 */
			go : function(num){
				var gonum = -1;	//this.getGoBackNum();
				if(num){
					gonum += num;
				}
				history.go(gonum);
			}
		},
		flowHistorys : {},	//流程历史数据，根据stateid存储data
		pageArray : [],	//存储已打开的page_?页面id，不包括homePage/flowCenter/menu/iconMore
		//隐藏当前页
		hideCurPage : function(){
			this.getCurPage().removeClass("cur");
		},
		//显示新页
		showCurPage : function(id){
			$("form#"+id).addClass("cur");
		},
		//获取当前页
		getCurPage : function(){
			return $("body > form.cur");
		},
		/**
		 * 
		 * @param target : 页面id值
		 * @param isShow : 是否立即显示
		 * @returns
		 */
		addPage : function(target, isShow){
			target = target ? target : ("page_" + (this.pageArray.length + 1));
			this.pageArray.push(target);	//存储已打开的page_?页面id
			var $page = $("<form id='"+ target +"'></form>").addClass("bd cur");
			if(isShow === false){
				$page.css("display", "none");
			}else{
				this.hideCurPage();
			}
			$("body").append($page);
			return $page;
		},
		showPage : function($div, title){
			var $page = this.addPage();
			
			$page.append($div);
			ajaxPage.setTitle($page.attr("id"));
		},
		/**
		 * 关闭后打开的页面,显示已存在的
		 * 在返回上一页面或跳转到主页时，以当前页面为基准，关闭后打开的页面
		 * 除#homePage、#flowCenter、#menu外其他hash返回值true(已存在),false(不存在，当页面刷新时)
		 * @param hash
		 */
		closeOrHidePage : function(hash,url){
			if(hash == "homePage" || hash == "flowCenter" || hash == "menu"){
				$("body > form[id^=page_]").remove();
				this.pageArray.length = 0;
			}else{
				var isReload = true;	//当前hash页面没有打开(避免再次加载)
				var $page = $("body > form[id^=page_]");
				$page.each(function(){
					var _href = $(this).attr("href");
					if(url == _href){
						$(this).addClass("cur").siblings(".bd").removeClass("cur");
						var numb = $(this).attr("id").replace("page_","");
						if(parseInt(numb) < ajaxPage.pageArray.length){
							numb++;
							$("body > form#page_" + numb).remove();
							ajaxPage.pageArray.pop();
						}
						isReload = false;
						//this.getCurPage().find(">div[id^=page_]").hide();
						return;
					}
				});
				return isReload;	
			}
			
		},
		/**
		 * 隐藏所有弹出层
		 */
		hidePopUpLayer : function(){
			//hideLoadingToast();
			$("body > .mbsc-ios .dwo").trigger("click");	//移除日期控件选择界面
			OBPM.dialog.doExit();		//退出弹出层
			$("#flowReminderDiv, #page_flowPro, #viewHistory").hide();	//隐藏历史记录面板、提交回退面板、催办面板
			
			$("#confirmPanel").find(".btn-cancel").trigger("click");	//隐藏对话框
		},
		/**
		 * 添加title
		 * @param hash
		 */
		addTitle : function(hash){
			var $titles = this.getCurPage().find("title");
			if($titles.size() > 0){
				this.title[hash] = $titles.eq(0).text();	//存储title
				if($titles.attr("title") != "listView" && $titles.attr("title") != "displayView"){	//不移除列表视图，保证从表单返回后可以刷新列表视图
					$titles.remove();	//移除页面内的title
				}
			}
		},
		/**
		 * 设置title
		 */
		setTitle : function(hash){
			if(hash){
				document.title = this.title[hash];
				//修复iso下微信title需要加载新内容时才会变化的bug--start
				var $body = $('body');
				var $iframe = $('<iframe style="display:none"><img src="../../weixin/trial/images/favicon.ico"></iframe>');
				$iframe.on('load',function() {
				  setTimeout(function() {
				      $iframe.off('load').remove();
				  }, 0);
				}).appendTo($body);
				//--end
			}
		},
		/**
		 * 刷新页面--用于刷新视图
		 */
		refreshPage : function(){
			var $curPage = this.getCurPage();
			var title = $curPage.find("title").attr("title");
			if(title == "listView" || title == "displayView"){	//列表视图
				if(!ajaxPage.getCurPage().find("#_searchPanel").hasClass("active")){
					this.reloadPage();
				}else{
					ajaxPage.getCurPage().find("#_searchPanel").removeClass("active");
				}
			}
			/*//刷新表单子表视图
			var $subView = this.getCurPage().find("div[name=display_view]");
			//判断是否子表查询界面
			if(!$subView.find(".searchPanel_sub").hasClass("active")){
				//非查询直接刷新子表视图
				$subView.trigger("refresh");
			}else{
				//关闭查询界面执行子表查询方法 ,依赖obpm.displayView.js
				$subView.find(".searchPanel_sub").removeClass("active");
				DisplayView.search($subView.find(".searchPanel_sub"));
			}*/
		},
		/**
		 * 表单提交时无法获取到属性disabled为true的控件的属性值
		 * 把disabled改为false
		 * @param elements
		 * @returns {Array}
		 */
		makeAllFieldAble: function(elements) {
			var fields = [];
			if (!elements) {
				elements = this.getCurPage()[0].elements;
			}
			for (var i = 0; i < elements.length; i++) {
				var element = elements[i];
				if (element.disabled == true) {
					element.disabled = false;
					fields.push(element);
				}
			}
			
			return fields;
		},
		/**
		 * 执行与makeAllFieldAble方法相反操作
		 * 表单提交时获取好控件的属性值后恢复控件的disabled属性
		 * 把disabled改为true
		 * @param fields
		 */
		setFieldDisabled: function(fields){
			for (var i = 0; i < fields.length; i++) {
				var element = fields[i];
				if (element.disabled == false) {
					element.disabled = true;
				}
			}
		},
		//获取参数
		getParams : function(){
			var params = {};
			var $cur = this.getCurPage();	//find("div[name='params']").
			
			var fields = this.makeAllFieldAble();
			params = $cur.serialize();
			this.setFieldDisabled(fields);
			return params;
		},
		//获取参数
		getParamsArray : function(){
			var params = {};
			var $cur = this.getCurPage();	//find("div[name='params']").
			params = $cur.serializeArray();
			return params;
		},
		//根据参数名获取参数jQuery对象
		getParamsByName : function(name){//div[name='params'] 
			return this.getCurPage().find("input[name='"+name+"']");
		},
		//管理页面的加载切换和关闭
		pageCurShow : function(id){
			if(id == undefined){
				id = "page_main";
			}
			$("#" + id).addClass("cur");
		},
		//移除当前页面
		pageRemove : function(){
			$("body").children(".cur").remove();
		},
		/**
		 * 根据hash判断是否显示导航切换按钮，只在首页、流程中心、菜单中显示
		 * @param hash
		 */
		setNavPanel : function(hash){
			if(hash == "homePage" || hash == "flowCenter" || hash == "menu"){
				$("body > .phone-main-nav-panel").show();
			}else{
				$("body > .phone-main-nav-panel").hide();
			}
		},
		/**
		 * annie
		 * 
		 * */
		/*
		 * 增加hash后缀
		 * 弹出层、流程提交面板、查询、时间控件（选择时间）
		 * 在当前hash后面加/popUpLayer,/flowPro,/_searchForm,/dateControls
		 * */
		addHashPostfix : function(postfix){
			location.hash = location.hash + "/" + postfix;
			ajaxPage.controlRefresh(false);	//在原来hash背后加变量不刷新内容
		},
		/*
		 * 清楚hash额外增加的变量
		 * 弹出层、流程提交面板、查询、时间控件（选择时间）
		 * 去掉在当前hash后面加/popUpLayer,/flowPro,/_searchForm,/dateControls
		 * */
		clearHashPostfix : function(postfix){
			postfix = "/" + postfix;
			if(window.location.hash.indexOf(postfix) >= 0){
				ajaxPage.controlRefresh(false);
				$curPage = ajaxPage.getCurPage();
				if($curPage.find("title").attr("title")=="displayView"){	//区别表单查询和子表页面加载，表单查询时为true，在提交后端的ajax请求中增加这个参数以作区别
					$curPage.find("title").attr("isQueryButton", "true");
				}
        		history.back();
        	}
			
		},
		/*
		 * 弹出层、流程提交面板、查询、时间控件（选择时间）改变hash后，不刷新当前页的内容
		 * 关闭或者浏览回退也不重新加载当前页内容
		 * */
		controlRefresh : function(value){
			ajaxPage.refresh = value;	//为“true”时，页面刷新，否则，不刷新
		},
		/*
		 * 判断用哪个action进表单
		 * 带其他参数
		 * */
		useFormAction : function(_href){
			if(_href.indexOf("newWithPermission.action") > 0){	//进表单有两个action，要区别
				ajaxPage.getFormNewWithPermissionHash(_href);
			}else if(_href.indexOf("view.action") > 0){
				ajaxPage.getFormViewHash(_href);
			}
		},
		/*
		 * 判断用哪个action进表单
		 * 不带其他参数(流程进表单时不带)
		 * */
		useFormActionNoOtherParams : function(_href){
			if(_href.indexOf("newWithPermission.action") > 0){	//进表单有两个action，要区别
				ajaxPage.getFormNewWithPermissionHash(_href);
				
			}else if(_href.indexOf("view.action") > 0){
				ajaxPage.getFlowFormViewHash(_href);
			}
		},
		/**
		 * 流程进表单的路由的方法(不带当前页面参数view.action)
		 * 
		 */
		getFlowFormViewHash : function(_href){
			var params = ajaxPage.returnParams(_href);	//获取“？”后面得参数
			params = params.replace(/\&/g,"\/");	//把“&”替换成“/”
			location.hash = "#form_view/"+params;
		},
		/**
		 * 进表单的路由的方法(首页widget、代办、经办,菜单进表单,带当前页面参数view.action)
		 * 
		 */
		getFormViewHash : function(_href){
			var params = ajaxPage.returnParams(_href);	//获取“？”后面得参数
			var otherParams = ajaxPage.getParams();	//必须在$page前
			params += "&";
			params += otherParams;
			params = params.replace(/\&/g,"\/");	//把“&”替换成“/”
			location.hash = "#form_view/"+params;
		},
		/**
		 * 从菜单进表单的路由的方法(视图进表单,newWithPermission.action)
		 * 
		 */
		getFormNewWithPermissionHash : function(_href){
			var params = ajaxPage.returnParams(_href);	//获取“？”后面得参数
			params = params.replace(/\&/g,"\/");	//把“&”替换成“/”
			location.hash = "#form_newWithPermission/"+params;
		},
		/*
		 * 进视图，配置按钮跳转到视图(可能跳主视图，可以能跳子视图)
		 * 判断用哪个action进视图
		 * */
		useViewAction : function(_href,otherParams){
			if(_href.indexOf("displayViewWithPermission.action") > 0){	//进表单有两个action，要区别
				ajaxPage.getToViewHash(_href,otherParams);
			}else if(_href.indexOf("displayView.action") > 0){
				ajaxPage.getToDisplayViewHash(_href);
			}
		},
		/**
		 * 从菜单进视图的路由的方法
		 */
		getToViewHash : function(_href,otherParams){
			var params = ajaxPage.returnParams(_href);	//获取“？”后面得参数
			if(typeof(otherParams) != "undefined" && otherParams != ""){
				params = otherParams;
			}
			params = params.replace(/\&/g,"\/");	//把“&”替换成“/”
			location.hash = "#view_displayViewWithPermission/"+params;
		},
		/**
		 * 脚本按钮进视图的路由的方法
		 */
		getToDisplayViewHash : function(_href){
			var params = ajaxPage.returnParams(_href);	//获取“？”后面得参数
			params = params.replace(/\&/g,"\/");	//把“&”替换成“/”
			location.hash = "#view_displayView/"+params;
		},
		/**
		 * 内部链接进入流程中心的路由方法
		 */
		getToFlowCenterHash : function(_href){
			window.location.hash = "#flowCenter";
		},
		
		/**
		 * 子视图hash构建
		 * params={
		 * 		_href : action链接带参数,
		 * 		id : 标识	
		 * }
		 */
		getDisplayViewHash : function(_href,id){
			var params = ajaxPage.returnParams(_href);	//获取“？”后面得参数
			params = params.replace(/\&/g,"\/");	//把“&”替换成“/”
			location.hash = "#subView_displayView/"+id+"/"+params;
		},
		/**
		 * 子视图进表单hash构建
		 * 
		 */
		getSubViewFormHash : function(_href){
			var params = ajaxPage.returnParams(_href);	//获取“？”后面得参数
			params = params.replace(/\&/g,"\/");	//把“&”替换成“/”
			location.hash = "#subView_view/"+params;
		},
		/**
		 * 新建按钮hash构建
		 * 
		 */
		getCreateHash : function(_href){
			var params = ajaxPage.returnParams(_href);	//获取“？”后面得参数
			params = params.replace(/\&/g,"\/");	//把“&”替换成“/”
			location.hash = "#activity_create/"+params;
		},
		//视图刷新列表（主表、子表）
		refreshView : function(){
			$curPage = ajaxPage.getCurPage();
			var curPage_title = ajaxPage.title[$curPage.attr("id")];
			document.title = curPage_title;
			if($curPage.attr("url")){	//当前页有url时刷新页面
				if($curPage.find("title").attr("title")=="displayView"){//包含元素打开的视图刷新
					var url = $curPage.attr("href");
					var id = $curPage.find("title").attr("id");
					//区别表单查询和子表页面加载，表单查询时为true，在提交后端的ajax请求中增加这个参数以作区别
					var isQueryButton = $curPage.find("title").attr("isQueryButton");
					refreshDisplayView(url, id, isQueryButton);
				}else{
					this.refreshPage();
				}
			}
		},
		/**
 		* 获取自定义报表的hash并改变浏览器hash
 		* @param {string} _href 自定义报表的链接
 		*/
		getToOReportHash : function(_href){
			var params = ajaxPage.returnParams(_href);	//获取“？”后面得参数
			params = params.replace(/\&/g,"\/");	//把“&”替换成“/”
			location.hash = "#report_oReport/"+params;
		},

		/**
		 * 判断是进入的是表单、视图、报表、流程中心
		 * @param {string} url 跳转的链接
		 * @return {string} 返回类型
		 */
		judgeType : function(url){
			var type = "";
			if(url.indexOf("displayViewWithPermission.action") > 0 || url.indexOf("displayView.action") > 0){
				type = "view";
			}else if(url.indexOf("view.action") > 0 || url.indexOf("newWithPermission.action") > 0){
				type = "form";
			}else if(url.indexOf("oReport.jsp") > 0){
				type = "oReport";
			}else if(url.indexOf("flowCenter.jsp") > 0){
				type = "flowCenter";
			}else if(url.indexOf("http") >= 0){
				type = "externalLinks";
			}
			return type;
		},
		/**
		 * 去掉form[id^=page_]
		 * 
		 */
		removePage : function(){	//返回到主页时移除所有id值以page_开头的div page
			$("body > form[id^=page_]").remove();
			this.pageArray.length = 0;
		},
		/**
		 * 获取链接“？”后面得参数
		 * 
		 */
		returnParams : function(_href){	//
			var params = "";
			if(_href && _href.indexOf("?") != -1){
				var ind = _href.indexOf("?");
				params = _href.substring(ind+1);
			}
			return params;
		},
		/**
		 * 提交当前页面(查询列表)
		 */
		submitPage : function(url){
			var params = this.getParams();	//必须在$page前
			var $page = this.getCurPage();
			showLoadingToast();
			$.ajax({
				url : url,
				data : params,
				dataType : "html",
				cache : false,
				type : "POST",
				success : function(html){
					$page.html(html);
					ajaxPage.addTitle($page.attr("id"));
					
					hideLoadingToast();
				},
				error : function(ex){
					
				}
			});
		},
		//重加载页面
		/*
		 * 主表调用不传参数；获取当前页的url、获取当前页的所有参数
		 * 子表调用传三个参数
		 * */
		reloadPage : function(url, params,callback){
			var params = params ? params : this.getParams();
			var $page = this.getCurPage();
			var $displayView = $page.find("div[name='display_view']");
			/*//判断是否子表视图			
			if($displayView.size() > 0){
				url = $page.attr("href");
			}else{
				url = $page.attr("url");
			}*/
			var url = url ? url : $page.attr("url");
			showLoadingToast();
			$.ajax({
				url : url,
				data : params,
				dataType : "html",
				cache : false,
				type : "POST",
				success : function(html){
					$page.html(html);
					
					if($displayView.size() > 0){
						DisplayView.input2Span();
					}
					
					if(typeof(callback) == "function"){	//有回调函数时执行回调函数
						callback();
					}
					ajaxPage.history.initLength = history.length;

					setTimeout(function(){
						hideLoadingToast();
					},1000)
				},
				error : function(ex){
					
				}
			});
		},
		//加载页面
		routerLoadPage : function(url, params, callback){
			var urlParams = url+"?"+params;
			var $page = this.addPage();
			$page.attr("url", url).attr("href", urlParams);
			showLoadingToast();
			$.ajax({
				url : url,
				data : params,
				dataType : "html",
				cache : false,
				type : "POST",
				success : function(html){
					$page.html(html);
					ajaxPage.addTitle($page.attr("id"));
					ajaxPage.setTitle($page.attr("id"));
					if(typeof(callback) == "function"){	//有回调函数时执行回调函数
						callback();
					}
					ajaxPage.history.initLength = history.length;
					setTimeout(function(){
						hideLoadingToast();
					},1000)
				},
				error : function(ex){
					console.error("ajax页面加载报错：" + ex);
				}
			});
			
		}
};; 
/*!
 * =====================================================
 * Ratchet v2.0.2 (http://goratchet.com)
 * Copyright 2014 Connor Sears
 * Licensed under MIT (https://github.com/twbs/ratchet/blob/master/LICENSE)
 *
 * v2.0.2 designed by @connors.
 * =====================================================
 */
!function(){"use strict";var a=function(a){for(var b,c=document.querySelectorAll("a");a&&a!==document;a=a.parentNode)for(b=c.length;b--;)if(c[b]===a)return a},b=function(b){var c=a(b.target);return c&&c.hash?document.querySelector(c.hash):void 0};window.addEventListener("touchend",function(a){var c=b(a);c&&(c&&c.classList.contains("modal")&&c.classList.toggle("active"),a.preventDefault())})}(),!function(){"use strict";var a,b=function(a){for(var b,c=document.querySelectorAll("a");a&&a!==document;a=a.parentNode)for(b=c.length;b--;)if(c[b]===a)return a},c=function(){a.style.display="none",a.removeEventListener("webkitTransitionEnd",c)},d=function(){var b=document.createElement("div");return b.classList.add("backdrop"),b.addEventListener("touchend",function(){a.addEventListener("webkitTransitionEnd",c),a.classList.remove("visible"),a.parentNode.removeChild(d)}),b}(),e=function(c){var d=b(c.target);if(d&&d.hash&&!(d.hash.indexOf("/")>0)){try{a=document.querySelector(d.hash)}catch(e){a=null}if(null!==a&&a&&a.classList.contains("popover"))return a}},f=function(a){var b=e(a);b&&(b.style.display="block",b.offsetHeight,b.classList.add("visible"),b.parentNode.appendChild(d))};window.addEventListener("touchend",f)}(),!function(){"use strict";var a,b=function(){},c=20,d=sessionStorage,e={},f={slideIn:"slide-out",slideOut:"slide-in",fade:"fade"},g={bartab:".bar-tab",barnav:".bar-nav",barfooter:".bar-footer",barheadersecondary:".bar-header-secondary"},h=function(a,b){o.id=a.id,b&&(a=k(a.id)),d[a.id]=JSON.stringify(a),window.history.replaceState(a.id,a.title,a.url),e[a.id]=document.body.cloneNode(!0)},i=function(){var a=o.id,b=JSON.parse(d.cacheForwardStack||"[]"),e=JSON.parse(d.cacheBackStack||"[]");for(e.push(a);b.length;)delete d[b.shift()];for(;e.length>c;)delete d[e.shift()];window.history.pushState(null,"",d[o.id].url),d.cacheForwardStack=JSON.stringify(b),d.cacheBackStack=JSON.stringify(e)},j=function(a,b){var c="forward"===b,e=JSON.parse(d.cacheForwardStack||"[]"),f=JSON.parse(d.cacheBackStack||"[]"),g=c?f:e,h=c?e:f;o.id&&g.push(o.id),h.pop(),d.cacheForwardStack=JSON.stringify(e),d.cacheBackStack=JSON.stringify(f)},k=function(a){return JSON.parse(d[a]||null)||{}},l=function(b){var c=t(b.target);if(!(!c||b.which>1||b.metaKey||b.ctrlKey||a||location.protocol!==c.protocol||location.host!==c.host||!c.hash&&/#/.test(c.href)||c.hash&&c.href.replace(c.hash,"")===location.href.replace(location.hash,"")||"push"===c.getAttribute("data-ignore")))return c},m=function(a){var b=l(a);b&&(a.preventDefault(),o({url:b.href,hash:b.hash,timeout:b.getAttribute("data-timeout"),transition:b.getAttribute("data-transition")}))},n=function(a){var b,c,h,i,l,m,n,p,q=a.state;if(q&&d[q]){if(l=o.id<q?"forward":"back",j(q,l),h=k(q),i=e[q],h.title&&(document.title=h.title),"back"===l?(n=JSON.parse("back"===l?d.cacheForwardStack:d.cacheBackStack),p=k(n[n.length-1])):p=h,"back"===l&&!p.id)return o.id=q;if(m="back"===l?f[p.transition]:p.transition,!i)return o({id:h.id,url:h.url,title:h.title,timeout:h.timeout,transition:m,ignorePush:!0});if(p.transition){h=v(h,".content",i.cloneNode(!0));for(b in g)g.hasOwnProperty(b)&&(c=document.querySelector(g[b]),h[b]?r(h[b],c):c&&c.parentNode.removeChild(c))}r((h.contents||i).cloneNode(!0),document.querySelector(".content"),m),o.id=q,document.body.offsetHeight}},o=function(a){var c,d=o.xhr;a.container=a.container||a.transition?document.querySelector(".content"):document.body;for(c in g)g.hasOwnProperty(c)&&(a[c]=a[c]||document.querySelector(g[c]));d&&d.readyState<4&&(d.onreadystatechange=b,d.abort()),d=new XMLHttpRequest,d.open("GET",a.url,!0),d.setRequestHeader("X-PUSH","true"),d.onreadystatechange=function(){a._timeout&&clearTimeout(a._timeout),4===d.readyState&&(200===d.status?p(d,a):q(a.url))},o.id||h({id:+new Date,url:window.location.href,title:document.title,timeout:a.timeout,transition:null}),a.timeout&&(a._timeout=setTimeout(function(){d.abort("timeout")},a.timeout)),d.send(),d.readyState&&!a.ignorePush&&i()},p=function(a,b){var c,d,e=w(a,b);if(!e.contents)return u(b.url);if(e.title&&(document.title=e.title),b.transition)for(c in g)g.hasOwnProperty(c)&&(d=document.querySelector(g[c]),e[c]?r(e[c],d):d&&d.parentNode.removeChild(d));r(e.contents,b.container,b.transition,function(){h({id:b.id||+new Date,url:e.url,title:e.title,timeout:b.timeout,transition:b.transition},b.id),s()}),!b.ignorePush&&window._gaq&&_gaq.push(["_trackPageview"]),!b.hash},q=function(a){throw new Error("Could not get: "+a)},r=function(a,b,c,d){var e,f,g;if(c?(e=/in$/.test(c),"fade"===c&&(b.classList.add("in"),b.classList.add("fade"),a.classList.add("fade")),/slide/.test(c)&&(a.classList.add("sliding-in",e?"right":"left"),a.classList.add("sliding"),b.classList.add("sliding")),b.parentNode.insertBefore(a,b)):b?b.innerHTML=a.innerHTML:a.classList.contains("content")?document.body.appendChild(a):document.body.insertBefore(a,document.querySelector(".content")),c||d&&d(),"fade"===c){b.offsetWidth,b.classList.remove("in");var h=function(){b.removeEventListener("webkitTransitionEnd",h),a.classList.add("in"),a.addEventListener("webkitTransitionEnd",i)},i=function(){a.removeEventListener("webkitTransitionEnd",i),b.parentNode.removeChild(b),a.classList.remove("fade"),a.classList.remove("in"),d&&d()};b.addEventListener("webkitTransitionEnd",h)}if(/slide/.test(c)){var j=function(){a.removeEventListener("webkitTransitionEnd",j),a.classList.remove("sliding","sliding-in"),a.classList.remove(g),b.parentNode.removeChild(b),d&&d()};b.offsetWidth,g=e?"right":"left",f=e?"left":"right",b.classList.add(f),a.classList.remove(g),a.addEventListener("webkitTransitionEnd",j)}},s=function(){var a=new CustomEvent("push",{detail:{state:k(o.id)},bubbles:!0,cancelable:!0});window.dispatchEvent(a)},t=function(a){for(var b,c=document.querySelectorAll("a");a&&a!==document;a=a.parentNode)for(b=c.length;b--;)if(c[b]===a)return a},u=function(a){window.history.replaceState(null,"","#"),window.location.replace(a)},v=function(a,b,c){var d,e={};for(d in a)a.hasOwnProperty(d)&&(e[d]=a[d]);return Object.keys(g).forEach(function(a){var b=c.querySelector(g[a]);b&&b.parentNode.removeChild(b),e[a]=b}),e.contents=c.querySelector(b),e},w=function(a,b){var c,d,e={},f=a.responseText;if(e.url=b.url,!f)return e;/<html/i.test(f)?(c=document.createElement("div"),d=document.createElement("div"),c.innerHTML=f.match(/<head[^>]*>([\s\S.]*)<\/head>/i)[0],d.innerHTML=f.match(/<body[^>]*>([\s\S.]*)<\/body>/i)[0]):(c=d=document.createElement("div"),c.innerHTML=f),e.title=c.querySelector("title");var g="innerText"in e.title?"innerText":"textContent";return e.title=e.title&&e.title[g].trim(),b.transition?e=v(e,".content",d):e.contents=d,e};window.addEventListener("touchstart",function(){a=!1}),window.addEventListener("touchmove",function(){a=!0}),window.addEventListener("touchend",m),window.addEventListener("click",function(a){l(a)&&a.preventDefault()}),window.addEventListener("popstate",n),window.PUSH=o}(),!function(){"use strict";var a=function(a){for(var b,c=document.querySelectorAll(".segmented-control .control-item");a&&a!==document;a=a.parentNode)for(b=c.length;b--;)if(c[b]===a)return a};window.addEventListener("touchend",function(b){var c,d,e,f=a(b.target),g="active",h="."+g;if(f&&(c=f.parentNode.querySelector(h),c&&c.classList.remove(g),f.classList.add(g),f.hash&&(e=document.querySelector(f.hash)))){d=e.parentNode.querySelectorAll(h);for(var i=0;i<d.length;i++)d[i].classList.remove(g);e.classList.add(g)}}),window.addEventListener("click",function(b){a(b.target)&&b.preventDefault()})}(),!function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n=function(a){for(var b,c=document.querySelectorAll(".slider > .slide-group");a&&a!==document;a=a.parentNode)for(b=c.length;b--;)if(c[b]===a)return a},o=function(){if("webkitTransform"in c.style){var a=c.style.webkitTransform.match(/translate3d\(([^,]*)/),b=a?a[1]:0;return parseInt(b,10)}},p=function(a){var b=a?0>d?"ceil":"floor":"round";k=Math[b](o()/(m/c.children.length)),k+=a,k=Math.min(k,0),k=Math.max(-(c.children.length-1),k)},q=function(f){if(c=n(f.target)){var k=c.querySelector(".slide");m=k.offsetWidth*c.children.length,l=void 0,j=c.offsetWidth,i=1,g=-(c.children.length-1),h=+new Date,a=f.touches[0].pageX,b=f.touches[0].pageY,d=0,e=0,p(0),c.style["-webkit-transition-duration"]=0}},r=function(h){h.touches.length>1||!c||(d=h.touches[0].pageX-a,e=h.touches[0].pageY-b,a=h.touches[0].pageX,b=h.touches[0].pageY,"undefined"==typeof l&&(l=Math.abs(e)>Math.abs(d)),l||(f=d/i+o(),h.preventDefault(),i=0===k&&d>0?a/j+1.25:k===g&&0>d?Math.abs(a)/j+1.25:1,c.style.webkitTransform="translate3d("+f+"px,0,0)"))},s=function(a){c&&!l&&(p(+new Date-h<1e3&&Math.abs(d)>15?0>d?-1:1:0),f=k*j,c.style["-webkit-transition-duration"]=".2s",c.style.webkitTransform="translate3d("+f+"px,0,0)",a=new CustomEvent("slide",{detail:{slideNumber:Math.abs(k)},bubbles:!0,cancelable:!0}),c.parentNode.dispatchEvent(a))};window.addEventListener("touchstart",q),window.addEventListener("touchmove",r),window.addEventListener("touchend",s)}(),!function(){"use strict";var a={},b=!1,c=!1,d=!1,e=function(a){for(var b,c=document.querySelectorAll(".toggle");a&&a!==document;a=a.parentNode)for(b=c.length;b--;)if(c[b]===a)return a};window.addEventListener("touchstart",function(c){if(c=c.originalEvent||c,d=e(c.target)){var f=d.querySelector(".toggle-handle"),g=d.clientWidth,h=f.clientWidth,i=d.classList.contains("active")?g-h:0;a={pageX:c.touches[0].pageX-i,pageY:c.touches[0].pageY},b=!1}}),window.addEventListener("touchmove",function(e){if(e=e.originalEvent||e,!(e.touches.length>1)&&d){var f=d.querySelector(".toggle-handle"),g=e.touches[0],h=d.clientWidth,i=f.clientWidth,j=h-i;if(b=!0,c=g.pageX-a.pageX,!(Math.abs(c)<Math.abs(g.pageY-a.pageY))){if(e.preventDefault(),0>c)return f.style.webkitTransform="translate3d(0,0,0)";if(c>j)return f.style.webkitTransform="translate3d("+j+"px,0,0)";f.style.webkitTransform="translate3d("+c+"px,0,0)",d.classList[c>h/2-i/2?"add":"remove"]("active")}}}),window.addEventListener("touchend",function(a){if(d){var e=d.querySelector(".toggle-handle"),f=d.clientWidth,g=e.clientWidth,h=f-g,i=!b&&!d.classList.contains("active")||b&&c>f/2-g/2;e.style.webkitTransform=i?"translate3d("+h+"px,0,0)":"translate3d(0,0,0)",d.classList[i?"add":"remove"]("active"),a=new CustomEvent("toggle",{detail:{isActive:i},bubbles:!0,cancelable:!0}),d.dispatchEvent(a),b=!1,d=!1}})}();; 
/**
 * Swiper 3.3.1
 * Most modern mobile touch slider and framework with hardware accelerated transitions
 * 
 * http://www.idangero.us/swiper/
 * 
 * Copyright 2016, Vladimir Kharlampidi
 * The iDangero.us
 * http://www.idangero.us/
 * 
 * Licensed under MIT
 * 
 * Released on: February 7, 2016
 */
!function(){"use strict";function e(e){e.fn.swiper=function(a){var s;return e(this).each(function(){var e=new t(this,a);s||(s=e)}),s}}var a,t=function(e,s){function r(e){return Math.floor(e)}function i(){y.autoplayTimeoutId=setTimeout(function(){y.params.loop?(y.fixLoop(),y._slideNext(),y.emit("onAutoplay",y)):y.isEnd?s.autoplayStopOnLast?y.stopAutoplay():(y._slideTo(0),y.emit("onAutoplay",y)):(y._slideNext(),y.emit("onAutoplay",y))},y.params.autoplay)}function n(e,t){var s=a(e.target);if(!s.is(t))if("string"==typeof t)s=s.parents(t);else if(t.nodeType){var r;return s.parents().each(function(e,a){a===t&&(r=t)}),r?t:void 0}if(0!==s.length)return s[0]}function o(e,a){a=a||{};var t=window.MutationObserver||window.WebkitMutationObserver,s=new t(function(e){e.forEach(function(e){y.onResize(!0),y.emit("onObserverUpdate",y,e)})});s.observe(e,{attributes:"undefined"==typeof a.attributes?!0:a.attributes,childList:"undefined"==typeof a.childList?!0:a.childList,characterData:"undefined"==typeof a.characterData?!0:a.characterData}),y.observers.push(s)}function l(e){e.originalEvent&&(e=e.originalEvent);var a=e.keyCode||e.charCode;if(!y.params.allowSwipeToNext&&(y.isHorizontal()&&39===a||!y.isHorizontal()&&40===a))return!1;if(!y.params.allowSwipeToPrev&&(y.isHorizontal()&&37===a||!y.isHorizontal()&&38===a))return!1;if(!(e.shiftKey||e.altKey||e.ctrlKey||e.metaKey||document.activeElement&&document.activeElement.nodeName&&("input"===document.activeElement.nodeName.toLowerCase()||"textarea"===document.activeElement.nodeName.toLowerCase()))){if(37===a||39===a||38===a||40===a){var t=!1;if(y.container.parents(".swiper-slide").length>0&&0===y.container.parents(".swiper-slide-active").length)return;var s={left:window.pageXOffset,top:window.pageYOffset},r=window.innerWidth,i=window.innerHeight,n=y.container.offset();y.rtl&&(n.left=n.left-y.container[0].scrollLeft);for(var o=[[n.left,n.top],[n.left+y.width,n.top],[n.left,n.top+y.height],[n.left+y.width,n.top+y.height]],l=0;l<o.length;l++){var p=o[l];p[0]>=s.left&&p[0]<=s.left+r&&p[1]>=s.top&&p[1]<=s.top+i&&(t=!0)}if(!t)return}y.isHorizontal()?((37===a||39===a)&&(e.preventDefault?e.preventDefault():e.returnValue=!1),(39===a&&!y.rtl||37===a&&y.rtl)&&y.slideNext(),(37===a&&!y.rtl||39===a&&y.rtl)&&y.slidePrev()):((38===a||40===a)&&(e.preventDefault?e.preventDefault():e.returnValue=!1),40===a&&y.slideNext(),38===a&&y.slidePrev())}}function p(e){e.originalEvent&&(e=e.originalEvent);var a=y.mousewheel.event,t=0,s=y.rtl?-1:1;if("mousewheel"===a)if(y.params.mousewheelForceToAxis)if(y.isHorizontal()){if(!(Math.abs(e.wheelDeltaX)>Math.abs(e.wheelDeltaY)))return;t=e.wheelDeltaX*s}else{if(!(Math.abs(e.wheelDeltaY)>Math.abs(e.wheelDeltaX)))return;t=e.wheelDeltaY}else t=Math.abs(e.wheelDeltaX)>Math.abs(e.wheelDeltaY)?-e.wheelDeltaX*s:-e.wheelDeltaY;else if("DOMMouseScroll"===a)t=-e.detail;else if("wheel"===a)if(y.params.mousewheelForceToAxis)if(y.isHorizontal()){if(!(Math.abs(e.deltaX)>Math.abs(e.deltaY)))return;t=-e.deltaX*s}else{if(!(Math.abs(e.deltaY)>Math.abs(e.deltaX)))return;t=-e.deltaY}else t=Math.abs(e.deltaX)>Math.abs(e.deltaY)?-e.deltaX*s:-e.deltaY;if(0!==t){if(y.params.mousewheelInvert&&(t=-t),y.params.freeMode){var r=y.getWrapperTranslate()+t*y.params.mousewheelSensitivity,i=y.isBeginning,n=y.isEnd;if(r>=y.minTranslate()&&(r=y.minTranslate()),r<=y.maxTranslate()&&(r=y.maxTranslate()),y.setWrapperTransition(0),y.setWrapperTranslate(r),y.updateProgress(),y.updateActiveIndex(),(!i&&y.isBeginning||!n&&y.isEnd)&&y.updateClasses(),y.params.freeModeSticky?(clearTimeout(y.mousewheel.timeout),y.mousewheel.timeout=setTimeout(function(){y.slideReset()},300)):y.params.lazyLoading&&y.lazy&&y.lazy.load(),0===r||r===y.maxTranslate())return}else{if((new window.Date).getTime()-y.mousewheel.lastScrollTime>60)if(0>t)if(y.isEnd&&!y.params.loop||y.animating){if(y.params.mousewheelReleaseOnEdges)return!0}else y.slideNext();else if(y.isBeginning&&!y.params.loop||y.animating){if(y.params.mousewheelReleaseOnEdges)return!0}else y.slidePrev();y.mousewheel.lastScrollTime=(new window.Date).getTime()}return y.params.autoplay&&y.stopAutoplay(),e.preventDefault?e.preventDefault():e.returnValue=!1,!1}}function d(e,t){e=a(e);var s,r,i,n=y.rtl?-1:1;s=e.attr("data-swiper-parallax")||"0",r=e.attr("data-swiper-parallax-x"),i=e.attr("data-swiper-parallax-y"),r||i?(r=r||"0",i=i||"0"):y.isHorizontal()?(r=s,i="0"):(i=s,r="0"),r=r.indexOf("%")>=0?parseInt(r,10)*t*n+"%":r*t*n+"px",i=i.indexOf("%")>=0?parseInt(i,10)*t+"%":i*t+"px",e.transform("translate3d("+r+", "+i+",0px)")}function u(e){return 0!==e.indexOf("on")&&(e=e[0]!==e[0].toUpperCase()?"on"+e[0].toUpperCase()+e.substring(1):"on"+e),e}if(!(this instanceof t))return new t(e,s);var c={direction:"horizontal",touchEventsTarget:"container",initialSlide:0,speed:300,autoplay:!1,autoplayDisableOnInteraction:!0,autoplayStopOnLast:!1,iOSEdgeSwipeDetection:!1,iOSEdgeSwipeThreshold:20,freeMode:!1,freeModeMomentum:!0,freeModeMomentumRatio:1,freeModeMomentumBounce:!0,freeModeMomentumBounceRatio:1,freeModeSticky:!1,freeModeMinimumVelocity:.02,autoHeight:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",coverflow:{rotate:50,stretch:0,depth:100,modifier:1,slideShadows:!0},flip:{slideShadows:!0,limitRotation:!0},cube:{slideShadows:!0,shadow:!0,shadowOffset:20,shadowScale:.94},fade:{crossFade:!1},parallax:!1,scrollbar:null,scrollbarHide:!0,scrollbarDraggable:!1,scrollbarSnapOnRelease:!1,keyboardControl:!1,mousewheelControl:!1,mousewheelReleaseOnEdges:!1,mousewheelInvert:!1,mousewheelForceToAxis:!1,mousewheelSensitivity:1,hashnav:!1,breakpoints:void 0,spaceBetween:0,slidesPerView:1,slidesPerColumn:1,slidesPerColumnFill:"column",slidesPerGroup:1,centeredSlides:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,onlyExternal:!1,threshold:0,touchMoveStopPropagation:!0,uniqueNavElements:!0,pagination:null,paginationElement:"span",paginationClickable:!1,paginationHide:!1,paginationBulletRender:null,paginationProgressRender:null,paginationFractionRender:null,paginationCustomRender:null,paginationType:"bullets",resistance:!0,resistanceRatio:.85,nextButton:null,prevButton:null,watchSlidesProgress:!1,watchSlidesVisibility:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,lazyLoading:!1,lazyLoadingInPrevNext:!1,lazyLoadingInPrevNextAmount:1,lazyLoadingOnTransitionStart:!1,preloadImages:!0,updateOnImagesReady:!0,loop:!1,loopAdditionalSlides:0,loopedSlides:null,control:void 0,controlInverse:!1,controlBy:"slide",allowSwipeToPrev:!0,allowSwipeToNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",slideClass:"swiper-slide",slideActiveClass:"swiper-slide-active",slideVisibleClass:"swiper-slide-visible",slideDuplicateClass:"swiper-slide-duplicate",slideNextClass:"swiper-slide-next",slidePrevClass:"swiper-slide-prev",wrapperClass:"swiper-wrapper",bulletClass:"swiper-pagination-bullet",bulletActiveClass:"swiper-pagination-bullet-active",buttonDisabledClass:"swiper-button-disabled",paginationCurrentClass:"swiper-pagination-current",paginationTotalClass:"swiper-pagination-total",paginationHiddenClass:"swiper-pagination-hidden",paginationProgressbarClass:"swiper-pagination-progressbar",observer:!1,observeParents:!1,a11y:!1,prevSlideMessage:"Previous slide",nextSlideMessage:"Next slide",firstSlideMessage:"This is the first slide",lastSlideMessage:"This is the last slide",paginationBulletMessage:"Go to slide {{index}}",runCallbacksOnInit:!0},m=s&&s.virtualTranslate;s=s||{};var f={};for(var g in s)if("object"!=typeof s[g]||null===s[g]||(s[g].nodeType||s[g]===window||s[g]===document||"undefined"!=typeof Dom7&&s[g]instanceof Dom7||"undefined"!=typeof jQuery&&s[g]instanceof jQuery))f[g]=s[g];else{f[g]={};for(var h in s[g])f[g][h]=s[g][h]}for(var v in c)if("undefined"==typeof s[v])s[v]=c[v];else if("object"==typeof s[v])for(var w in c[v])"undefined"==typeof s[v][w]&&(s[v][w]=c[v][w]);var y=this;if(y.params=s,y.originalParams=f,y.classNames=[],"undefined"!=typeof a&&"undefined"!=typeof Dom7&&(a=Dom7),("undefined"!=typeof a||(a="undefined"==typeof Dom7?window.Dom7||window.Zepto||window.jQuery:Dom7))&&(y.$=a,y.currentBreakpoint=void 0,y.getActiveBreakpoint=function(){if(!y.params.breakpoints)return!1;var e,a=!1,t=[];for(e in y.params.breakpoints)y.params.breakpoints.hasOwnProperty(e)&&t.push(e);t.sort(function(e,a){return parseInt(e,10)>parseInt(a,10)});for(var s=0;s<t.length;s++)e=t[s],e>=window.innerWidth&&!a&&(a=e);return a||"max"},y.setBreakpoint=function(){var e=y.getActiveBreakpoint();if(e&&y.currentBreakpoint!==e){var a=e in y.params.breakpoints?y.params.breakpoints[e]:y.originalParams,t=y.params.loop&&a.slidesPerView!==y.params.slidesPerView;for(var s in a)y.params[s]=a[s];y.currentBreakpoint=e,t&&y.destroyLoop&&y.reLoop(!0)}},y.params.breakpoints&&y.setBreakpoint(),y.container=a(e),0!==y.container.length)){if(y.container.length>1){var b=[];return y.container.each(function(){b.push(new t(this,s))}),b}y.container[0].swiper=y,y.container.data("swiper",y),y.classNames.push("swiper-container-"+y.params.direction),y.params.freeMode&&y.classNames.push("swiper-container-free-mode"),y.support.flexbox||(y.classNames.push("swiper-container-no-flexbox"),y.params.slidesPerColumn=1),y.params.autoHeight&&y.classNames.push("swiper-container-autoheight"),(y.params.parallax||y.params.watchSlidesVisibility)&&(y.params.watchSlidesProgress=!0),["cube","coverflow","flip"].indexOf(y.params.effect)>=0&&(y.support.transforms3d?(y.params.watchSlidesProgress=!0,y.classNames.push("swiper-container-3d")):y.params.effect="slide"),"slide"!==y.params.effect&&y.classNames.push("swiper-container-"+y.params.effect),"cube"===y.params.effect&&(y.params.resistanceRatio=0,y.params.slidesPerView=1,y.params.slidesPerColumn=1,y.params.slidesPerGroup=1,y.params.centeredSlides=!1,y.params.spaceBetween=0,y.params.virtualTranslate=!0,y.params.setWrapperSize=!1),("fade"===y.params.effect||"flip"===y.params.effect)&&(y.params.slidesPerView=1,y.params.slidesPerColumn=1,y.params.slidesPerGroup=1,y.params.watchSlidesProgress=!0,y.params.spaceBetween=0,y.params.setWrapperSize=!1,"undefined"==typeof m&&(y.params.virtualTranslate=!0)),y.params.grabCursor&&y.support.touch&&(y.params.grabCursor=!1),y.wrapper=y.container.children("."+y.params.wrapperClass),y.params.pagination&&(y.paginationContainer=a(y.params.pagination),y.params.uniqueNavElements&&"string"==typeof y.params.pagination&&y.paginationContainer.length>1&&1===y.container.find(y.params.pagination).length&&(y.paginationContainer=y.container.find(y.params.pagination)),"bullets"===y.params.paginationType&&y.params.paginationClickable?y.paginationContainer.addClass("swiper-pagination-clickable"):y.params.paginationClickable=!1,y.paginationContainer.addClass("swiper-pagination-"+y.params.paginationType)),(y.params.nextButton||y.params.prevButton)&&(y.params.nextButton&&(y.nextButton=a(y.params.nextButton),y.params.uniqueNavElements&&"string"==typeof y.params.nextButton&&y.nextButton.length>1&&1===y.container.find(y.params.nextButton).length&&(y.nextButton=y.container.find(y.params.nextButton))),y.params.prevButton&&(y.prevButton=a(y.params.prevButton),y.params.uniqueNavElements&&"string"==typeof y.params.prevButton&&y.prevButton.length>1&&1===y.container.find(y.params.prevButton).length&&(y.prevButton=y.container.find(y.params.prevButton)))),y.isHorizontal=function(){return"horizontal"===y.params.direction},y.rtl=y.isHorizontal()&&("rtl"===y.container[0].dir.toLowerCase()||"rtl"===y.container.css("direction")),y.rtl&&y.classNames.push("swiper-container-rtl"),y.rtl&&(y.wrongRTL="-webkit-box"===y.wrapper.css("display")),y.params.slidesPerColumn>1&&y.classNames.push("swiper-container-multirow"),y.device.android&&y.classNames.push("swiper-container-android"),y.container.addClass(y.classNames.join(" ")),y.translate=0,y.progress=0,y.velocity=0,y.lockSwipeToNext=function(){y.params.allowSwipeToNext=!1},y.lockSwipeToPrev=function(){y.params.allowSwipeToPrev=!1},y.lockSwipes=function(){y.params.allowSwipeToNext=y.params.allowSwipeToPrev=!1},y.unlockSwipeToNext=function(){y.params.allowSwipeToNext=!0},y.unlockSwipeToPrev=function(){y.params.allowSwipeToPrev=!0},y.unlockSwipes=function(){y.params.allowSwipeToNext=y.params.allowSwipeToPrev=!0},y.params.grabCursor&&(y.container[0].style.cursor="move",y.container[0].style.cursor="-webkit-grab",y.container[0].style.cursor="-moz-grab",y.container[0].style.cursor="grab"),y.imagesToLoad=[],y.imagesLoaded=0,y.loadImage=function(e,a,t,s,r){function i(){r&&r()}var n;e.complete&&s?i():a?(n=new window.Image,n.onload=i,n.onerror=i,t&&(n.srcset=t),a&&(n.src=a)):i()},y.preloadImages=function(){function e(){"undefined"!=typeof y&&null!==y&&(void 0!==y.imagesLoaded&&y.imagesLoaded++,y.imagesLoaded===y.imagesToLoad.length&&(y.params.updateOnImagesReady&&y.update(),y.emit("onImagesReady",y)))}y.imagesToLoad=y.container.find("img");for(var a=0;a<y.imagesToLoad.length;a++)y.loadImage(y.imagesToLoad[a],y.imagesToLoad[a].currentSrc||y.imagesToLoad[a].getAttribute("src"),y.imagesToLoad[a].srcset||y.imagesToLoad[a].getAttribute("srcset"),!0,e)},y.autoplayTimeoutId=void 0,y.autoplaying=!1,y.autoplayPaused=!1,y.startAutoplay=function(){return"undefined"!=typeof y.autoplayTimeoutId?!1:y.params.autoplay?y.autoplaying?!1:(y.autoplaying=!0,y.emit("onAutoplayStart",y),void i()):!1},y.stopAutoplay=function(e){y.autoplayTimeoutId&&(y.autoplayTimeoutId&&clearTimeout(y.autoplayTimeoutId),y.autoplaying=!1,y.autoplayTimeoutId=void 0,y.emit("onAutoplayStop",y))},y.pauseAutoplay=function(e){y.autoplayPaused||(y.autoplayTimeoutId&&clearTimeout(y.autoplayTimeoutId),y.autoplayPaused=!0,0===e?(y.autoplayPaused=!1,i()):y.wrapper.transitionEnd(function(){y&&(y.autoplayPaused=!1,y.autoplaying?i():y.stopAutoplay())}))},y.minTranslate=function(){return-y.snapGrid[0]},y.maxTranslate=function(){return-y.snapGrid[y.snapGrid.length-1]},y.updateAutoHeight=function(){var e=y.slides.eq(y.activeIndex)[0];if("undefined"!=typeof e){var a=e.offsetHeight;a&&y.wrapper.css("height",a+"px")}},y.updateContainerSize=function(){var e,a;e="undefined"!=typeof y.params.width?y.params.width:y.container[0].clientWidth,a="undefined"!=typeof y.params.height?y.params.height:y.container[0].clientHeight,0===e&&y.isHorizontal()||0===a&&!y.isHorizontal()||(e=e-parseInt(y.container.css("padding-left"),10)-parseInt(y.container.css("padding-right"),10),a=a-parseInt(y.container.css("padding-top"),10)-parseInt(y.container.css("padding-bottom"),10),y.width=e,y.height=a,y.size=y.isHorizontal()?y.width:y.height)},y.updateSlidesSize=function(){y.slides=y.wrapper.children("."+y.params.slideClass),y.snapGrid=[],y.slidesGrid=[],y.slidesSizesGrid=[];var e,a=y.params.spaceBetween,t=-y.params.slidesOffsetBefore,s=0,i=0;if("undefined"!=typeof y.size){"string"==typeof a&&a.indexOf("%")>=0&&(a=parseFloat(a.replace("%",""))/100*y.size),y.virtualSize=-a,y.rtl?y.slides.css({marginLeft:"",marginTop:""}):y.slides.css({marginRight:"",marginBottom:""});var n;y.params.slidesPerColumn>1&&(n=Math.floor(y.slides.length/y.params.slidesPerColumn)===y.slides.length/y.params.slidesPerColumn?y.slides.length:Math.ceil(y.slides.length/y.params.slidesPerColumn)*y.params.slidesPerColumn,"auto"!==y.params.slidesPerView&&"row"===y.params.slidesPerColumnFill&&(n=Math.max(n,y.params.slidesPerView*y.params.slidesPerColumn)));var o,l=y.params.slidesPerColumn,p=n/l,d=p-(y.params.slidesPerColumn*p-y.slides.length);for(e=0;e<y.slides.length;e++){o=0;var u=y.slides.eq(e);if(y.params.slidesPerColumn>1){var c,m,f;"column"===y.params.slidesPerColumnFill?(m=Math.floor(e/l),f=e-m*l,(m>d||m===d&&f===l-1)&&++f>=l&&(f=0,m++),c=m+f*n/l,u.css({"-webkit-box-ordinal-group":c,"-moz-box-ordinal-group":c,"-ms-flex-order":c,"-webkit-order":c,order:c})):(f=Math.floor(e/p),m=e-f*p),u.css({"margin-top":0!==f&&y.params.spaceBetween&&y.params.spaceBetween+"px"}).attr("data-swiper-column",m).attr("data-swiper-row",f)}"none"!==u.css("display")&&("auto"===y.params.slidesPerView?(o=y.isHorizontal()?u.outerWidth(!0):u.outerHeight(!0),y.params.roundLengths&&(o=r(o))):(o=(y.size-(y.params.slidesPerView-1)*a)/y.params.slidesPerView,y.params.roundLengths&&(o=r(o)),y.isHorizontal()?y.slides[e].style.width=o+"px":y.slides[e].style.height=o+"px"),y.slides[e].swiperSlideSize=o,y.slidesSizesGrid.push(o),y.params.centeredSlides?(t=t+o/2+s/2+a,0===e&&(t=t-y.size/2-a),Math.abs(t)<.001&&(t=0),i%y.params.slidesPerGroup===0&&y.snapGrid.push(t),y.slidesGrid.push(t)):(i%y.params.slidesPerGroup===0&&y.snapGrid.push(t),y.slidesGrid.push(t),t=t+o+a),y.virtualSize+=o+a,s=o,i++)}y.virtualSize=Math.max(y.virtualSize,y.size)+y.params.slidesOffsetAfter;var g;if(y.rtl&&y.wrongRTL&&("slide"===y.params.effect||"coverflow"===y.params.effect)&&y.wrapper.css({width:y.virtualSize+y.params.spaceBetween+"px"}),(!y.support.flexbox||y.params.setWrapperSize)&&(y.isHorizontal()?y.wrapper.css({width:y.virtualSize+y.params.spaceBetween+"px"}):y.wrapper.css({height:y.virtualSize+y.params.spaceBetween+"px"})),y.params.slidesPerColumn>1&&(y.virtualSize=(o+y.params.spaceBetween)*n,y.virtualSize=Math.ceil(y.virtualSize/y.params.slidesPerColumn)-y.params.spaceBetween,y.wrapper.css({width:y.virtualSize+y.params.spaceBetween+"px"}),y.params.centeredSlides)){for(g=[],e=0;e<y.snapGrid.length;e++)y.snapGrid[e]<y.virtualSize+y.snapGrid[0]&&g.push(y.snapGrid[e]);y.snapGrid=g}if(!y.params.centeredSlides){for(g=[],e=0;e<y.snapGrid.length;e++)y.snapGrid[e]<=y.virtualSize-y.size&&g.push(y.snapGrid[e]);y.snapGrid=g,Math.floor(y.virtualSize-y.size)-Math.floor(y.snapGrid[y.snapGrid.length-1])>1&&y.snapGrid.push(y.virtualSize-y.size)}0===y.snapGrid.length&&(y.snapGrid=[0]),0!==y.params.spaceBetween&&(y.isHorizontal()?y.rtl?y.slides.css({marginLeft:a+"px"}):y.slides.css({marginRight:a+"px"}):y.slides.css({marginBottom:a+"px"})),y.params.watchSlidesProgress&&y.updateSlidesOffset()}},y.updateSlidesOffset=function(){for(var e=0;e<y.slides.length;e++)y.slides[e].swiperSlideOffset=y.isHorizontal()?y.slides[e].offsetLeft:y.slides[e].offsetTop},y.updateSlidesProgress=function(e){if("undefined"==typeof e&&(e=y.translate||0),0!==y.slides.length){"undefined"==typeof y.slides[0].swiperSlideOffset&&y.updateSlidesOffset();var a=-e;y.rtl&&(a=e),y.slides.removeClass(y.params.slideVisibleClass);for(var t=0;t<y.slides.length;t++){var s=y.slides[t],r=(a-s.swiperSlideOffset)/(s.swiperSlideSize+y.params.spaceBetween);if(y.params.watchSlidesVisibility){var i=-(a-s.swiperSlideOffset),n=i+y.slidesSizesGrid[t],o=i>=0&&i<y.size||n>0&&n<=y.size||0>=i&&n>=y.size;o&&y.slides.eq(t).addClass(y.params.slideVisibleClass)}s.progress=y.rtl?-r:r}}},y.updateProgress=function(e){"undefined"==typeof e&&(e=y.translate||0);var a=y.maxTranslate()-y.minTranslate(),t=y.isBeginning,s=y.isEnd;0===a?(y.progress=0,y.isBeginning=y.isEnd=!0):(y.progress=(e-y.minTranslate())/a,y.isBeginning=y.progress<=0,y.isEnd=y.progress>=1),y.isBeginning&&!t&&y.emit("onReachBeginning",y),y.isEnd&&!s&&y.emit("onReachEnd",y),y.params.watchSlidesProgress&&y.updateSlidesProgress(e),y.emit("onProgress",y,y.progress)},y.updateActiveIndex=function(){var e,a,t,s=y.rtl?y.translate:-y.translate;for(a=0;a<y.slidesGrid.length;a++)"undefined"!=typeof y.slidesGrid[a+1]?s>=y.slidesGrid[a]&&s<y.slidesGrid[a+1]-(y.slidesGrid[a+1]-y.slidesGrid[a])/2?e=a:s>=y.slidesGrid[a]&&s<y.slidesGrid[a+1]&&(e=a+1):s>=y.slidesGrid[a]&&(e=a);(0>e||"undefined"==typeof e)&&(e=0),t=Math.floor(e/y.params.slidesPerGroup),t>=y.snapGrid.length&&(t=y.snapGrid.length-1),e!==y.activeIndex&&(y.snapIndex=t,y.previousIndex=y.activeIndex,y.activeIndex=e,y.updateClasses())},y.updateClasses=function(){y.slides.removeClass(y.params.slideActiveClass+" "+y.params.slideNextClass+" "+y.params.slidePrevClass);var e=y.slides.eq(y.activeIndex);e.addClass(y.params.slideActiveClass);var t=e.next("."+y.params.slideClass).addClass(y.params.slideNextClass);y.params.loop&&0===t.length&&y.slides.eq(0).addClass(y.params.slideNextClass);var s=e.prev("."+y.params.slideClass).addClass(y.params.slidePrevClass);if(y.params.loop&&0===s.length&&y.slides.eq(-1).addClass(y.params.slidePrevClass),y.paginationContainer&&y.paginationContainer.length>0){var r,i=y.params.loop?Math.ceil((y.slides.length-2*y.loopedSlides)/y.params.slidesPerGroup):y.snapGrid.length;if(y.params.loop?(r=Math.ceil((y.activeIndex-y.loopedSlides)/y.params.slidesPerGroup),r>y.slides.length-1-2*y.loopedSlides&&(r-=y.slides.length-2*y.loopedSlides),r>i-1&&(r-=i),0>r&&"bullets"!==y.params.paginationType&&(r=i+r)):r="undefined"!=typeof y.snapIndex?y.snapIndex:y.activeIndex||0,"bullets"===y.params.paginationType&&y.bullets&&y.bullets.length>0&&(y.bullets.removeClass(y.params.bulletActiveClass),y.paginationContainer.length>1?y.bullets.each(function(){a(this).index()===r&&a(this).addClass(y.params.bulletActiveClass)}):y.bullets.eq(r).addClass(y.params.bulletActiveClass)),"fraction"===y.params.paginationType&&(y.paginationContainer.find("."+y.params.paginationCurrentClass).text(r+1),y.paginationContainer.find("."+y.params.paginationTotalClass).text(i)),"progress"===y.params.paginationType){var n=(r+1)/i,o=n,l=1;y.isHorizontal()||(l=n,o=1),y.paginationContainer.find("."+y.params.paginationProgressbarClass).transform("translate3d(0,0,0) scaleX("+o+") scaleY("+l+")").transition(y.params.speed)}"custom"===y.params.paginationType&&y.params.paginationCustomRender&&(y.paginationContainer.html(y.params.paginationCustomRender(y,r+1,i)),y.emit("onPaginationRendered",y,y.paginationContainer[0]))}y.params.loop||(y.params.prevButton&&y.prevButton&&y.prevButton.length>0&&(y.isBeginning?(y.prevButton.addClass(y.params.buttonDisabledClass),y.params.a11y&&y.a11y&&y.a11y.disable(y.prevButton)):(y.prevButton.removeClass(y.params.buttonDisabledClass),y.params.a11y&&y.a11y&&y.a11y.enable(y.prevButton))),y.params.nextButton&&y.nextButton&&y.nextButton.length>0&&(y.isEnd?(y.nextButton.addClass(y.params.buttonDisabledClass),y.params.a11y&&y.a11y&&y.a11y.disable(y.nextButton)):(y.nextButton.removeClass(y.params.buttonDisabledClass),y.params.a11y&&y.a11y&&y.a11y.enable(y.nextButton))))},y.updatePagination=function(){if(y.params.pagination&&y.paginationContainer&&y.paginationContainer.length>0){var e="";if("bullets"===y.params.paginationType){for(var a=y.params.loop?Math.ceil((y.slides.length-2*y.loopedSlides)/y.params.slidesPerGroup):y.snapGrid.length,t=0;a>t;t++)e+=y.params.paginationBulletRender?y.params.paginationBulletRender(t,y.params.bulletClass):"<"+y.params.paginationElement+' class="'+y.params.bulletClass+'"></'+y.params.paginationElement+">";y.paginationContainer.html(e),y.bullets=y.paginationContainer.find("."+y.params.bulletClass),y.params.paginationClickable&&y.params.a11y&&y.a11y&&y.a11y.initPagination()}"fraction"===y.params.paginationType&&(e=y.params.paginationFractionRender?y.params.paginationFractionRender(y,y.params.paginationCurrentClass,y.params.paginationTotalClass):'<span class="'+y.params.paginationCurrentClass+'"></span> / <span class="'+y.params.paginationTotalClass+'"></span>',y.paginationContainer.html(e)),"progress"===y.params.paginationType&&(e=y.params.paginationProgressRender?y.params.paginationProgressRender(y,y.params.paginationProgressbarClass):'<span class="'+y.params.paginationProgressbarClass+'"></span>',y.paginationContainer.html(e)),"custom"!==y.params.paginationType&&y.emit("onPaginationRendered",y,y.paginationContainer[0])}},y.update=function(e){function a(){s=Math.min(Math.max(y.translate,y.maxTranslate()),y.minTranslate()),y.setWrapperTranslate(s),y.updateActiveIndex(),y.updateClasses()}if(y.updateContainerSize(),y.updateSlidesSize(),y.updateProgress(),y.updatePagination(),y.updateClasses(),y.params.scrollbar&&y.scrollbar&&y.scrollbar.set(),e){var t,s;y.controller&&y.controller.spline&&(y.controller.spline=void 0),y.params.freeMode?(a(),y.params.autoHeight&&y.updateAutoHeight()):(t=("auto"===y.params.slidesPerView||y.params.slidesPerView>1)&&y.isEnd&&!y.params.centeredSlides?y.slideTo(y.slides.length-1,0,!1,!0):y.slideTo(y.activeIndex,0,!1,!0),t||a())}else y.params.autoHeight&&y.updateAutoHeight()},y.onResize=function(e){y.params.breakpoints&&y.setBreakpoint();var a=y.params.allowSwipeToPrev,t=y.params.allowSwipeToNext;y.params.allowSwipeToPrev=y.params.allowSwipeToNext=!0,y.updateContainerSize(),y.updateSlidesSize(),("auto"===y.params.slidesPerView||y.params.freeMode||e)&&y.updatePagination(),y.params.scrollbar&&y.scrollbar&&y.scrollbar.set(),y.controller&&y.controller.spline&&(y.controller.spline=void 0);var s=!1;if(y.params.freeMode){var r=Math.min(Math.max(y.translate,y.maxTranslate()),y.minTranslate());y.setWrapperTranslate(r),y.updateActiveIndex(),y.updateClasses(),y.params.autoHeight&&y.updateAutoHeight()}else y.updateClasses(),s=("auto"===y.params.slidesPerView||y.params.slidesPerView>1)&&y.isEnd&&!y.params.centeredSlides?y.slideTo(y.slides.length-1,0,!1,!0):y.slideTo(y.activeIndex,0,!1,!0);y.params.lazyLoading&&!s&&y.lazy&&y.lazy.load(),y.params.allowSwipeToPrev=a,y.params.allowSwipeToNext=t};var x=["mousedown","mousemove","mouseup"];window.navigator.pointerEnabled?x=["pointerdown","pointermove","pointerup"]:window.navigator.msPointerEnabled&&(x=["MSPointerDown","MSPointerMove","MSPointerUp"]),y.touchEvents={start:y.support.touch||!y.params.simulateTouch?"touchstart":x[0],move:y.support.touch||!y.params.simulateTouch?"touchmove":x[1],end:y.support.touch||!y.params.simulateTouch?"touchend":x[2]},(window.navigator.pointerEnabled||window.navigator.msPointerEnabled)&&("container"===y.params.touchEventsTarget?y.container:y.wrapper).addClass("swiper-wp8-"+y.params.direction),y.initEvents=function(e){var a=e?"off":"on",t=e?"removeEventListener":"addEventListener",r="container"===y.params.touchEventsTarget?y.container[0]:y.wrapper[0],i=y.support.touch?r:document,n=y.params.nested?!0:!1;y.browser.ie?(r[t](y.touchEvents.start,y.onTouchStart,!1),i[t](y.touchEvents.move,y.onTouchMove,n),i[t](y.touchEvents.end,y.onTouchEnd,!1)):(y.support.touch&&(r[t](y.touchEvents.start,y.onTouchStart,!1),r[t](y.touchEvents.move,y.onTouchMove,n),r[t](y.touchEvents.end,y.onTouchEnd,!1)),!s.simulateTouch||y.device.ios||y.device.android||(r[t]("mousedown",y.onTouchStart,!1),document[t]("mousemove",y.onTouchMove,n),document[t]("mouseup",y.onTouchEnd,!1))),window[t]("resize",y.onResize),y.params.nextButton&&y.nextButton&&y.nextButton.length>0&&(y.nextButton[a]("click",y.onClickNext),y.params.a11y&&y.a11y&&y.nextButton[a]("keydown",y.a11y.onEnterKey)),y.params.prevButton&&y.prevButton&&y.prevButton.length>0&&(y.prevButton[a]("click",y.onClickPrev),y.params.a11y&&y.a11y&&y.prevButton[a]("keydown",y.a11y.onEnterKey)),y.params.pagination&&y.params.paginationClickable&&(y.paginationContainer[a]("click","."+y.params.bulletClass,y.onClickIndex),y.params.a11y&&y.a11y&&y.paginationContainer[a]("keydown","."+y.params.bulletClass,y.a11y.onEnterKey)),(y.params.preventClicks||y.params.preventClicksPropagation)&&r[t]("click",y.preventClicks,!0)},y.attachEvents=function(){y.initEvents()},y.detachEvents=function(){y.initEvents(!0)},y.allowClick=!0,y.preventClicks=function(e){y.allowClick||(y.params.preventClicks&&e.preventDefault(),y.params.preventClicksPropagation&&y.animating&&(e.stopPropagation(),e.stopImmediatePropagation()))},y.onClickNext=function(e){e.preventDefault(),(!y.isEnd||y.params.loop)&&y.slideNext()},y.onClickPrev=function(e){e.preventDefault(),(!y.isBeginning||y.params.loop)&&y.slidePrev()},y.onClickIndex=function(e){e.preventDefault();var t=a(this).index()*y.params.slidesPerGroup;y.params.loop&&(t+=y.loopedSlides),y.slideTo(t)},y.updateClickedSlide=function(e){var t=n(e,"."+y.params.slideClass),s=!1;if(t)for(var r=0;r<y.slides.length;r++)y.slides[r]===t&&(s=!0);if(!t||!s)return y.clickedSlide=void 0,void(y.clickedIndex=void 0);if(y.clickedSlide=t,y.clickedIndex=a(t).index(),y.params.slideToClickedSlide&&void 0!==y.clickedIndex&&y.clickedIndex!==y.activeIndex){var i,o=y.clickedIndex;if(y.params.loop){if(y.animating)return;i=a(y.clickedSlide).attr("data-swiper-slide-index"),y.params.centeredSlides?o<y.loopedSlides-y.params.slidesPerView/2||o>y.slides.length-y.loopedSlides+y.params.slidesPerView/2?(y.fixLoop(),o=y.wrapper.children("."+y.params.slideClass+'[data-swiper-slide-index="'+i+'"]:not(.swiper-slide-duplicate)').eq(0).index(),setTimeout(function(){y.slideTo(o)},0)):y.slideTo(o):o>y.slides.length-y.params.slidesPerView?(y.fixLoop(),o=y.wrapper.children("."+y.params.slideClass+'[data-swiper-slide-index="'+i+'"]:not(.swiper-slide-duplicate)').eq(0).index(),setTimeout(function(){y.slideTo(o)},0)):y.slideTo(o)}else y.slideTo(o)}};var T,S,C,z,M,P,I,k,E,B,D="input, select, textarea, button",L=Date.now(),H=[];y.animating=!1,y.touches={startX:0,startY:0,currentX:0,currentY:0,diff:0};var G,A;if(y.onTouchStart=function(e){if(e.originalEvent&&(e=e.originalEvent),G="touchstart"===e.type,G||!("which"in e)||3!==e.which){if(y.params.noSwiping&&n(e,"."+y.params.noSwipingClass))return void(y.allowClick=!0);if(!y.params.swipeHandler||n(e,y.params.swipeHandler)){var t=y.touches.currentX="touchstart"===e.type?e.targetTouches[0].pageX:e.pageX,s=y.touches.currentY="touchstart"===e.type?e.targetTouches[0].pageY:e.pageY;if(!(y.device.ios&&y.params.iOSEdgeSwipeDetection&&t<=y.params.iOSEdgeSwipeThreshold)){if(T=!0,S=!1,C=!0,M=void 0,A=void 0,y.touches.startX=t,y.touches.startY=s,z=Date.now(),y.allowClick=!0,y.updateContainerSize(),y.swipeDirection=void 0,y.params.threshold>0&&(k=!1),"touchstart"!==e.type){var r=!0;a(e.target).is(D)&&(r=!1),document.activeElement&&a(document.activeElement).is(D)&&document.activeElement.blur(),r&&e.preventDefault()}y.emit("onTouchStart",y,e)}}}},y.onTouchMove=function(e){if(e.originalEvent&&(e=e.originalEvent),!G||"mousemove"!==e.type){if(e.preventedByNestedSwiper)return y.touches.startX="touchmove"===e.type?e.targetTouches[0].pageX:e.pageX,void(y.touches.startY="touchmove"===e.type?e.targetTouches[0].pageY:e.pageY);if(y.params.onlyExternal)return y.allowClick=!1,void(T&&(y.touches.startX=y.touches.currentX="touchmove"===e.type?e.targetTouches[0].pageX:e.pageX,y.touches.startY=y.touches.currentY="touchmove"===e.type?e.targetTouches[0].pageY:e.pageY,z=Date.now()));if(G&&document.activeElement&&e.target===document.activeElement&&a(e.target).is(D))return S=!0,void(y.allowClick=!1);if(C&&y.emit("onTouchMove",y,e),!(e.targetTouches&&e.targetTouches.length>1)){if(y.touches.currentX="touchmove"===e.type?e.targetTouches[0].pageX:e.pageX,y.touches.currentY="touchmove"===e.type?e.targetTouches[0].pageY:e.pageY,"undefined"==typeof M){var t=180*Math.atan2(Math.abs(y.touches.currentY-y.touches.startY),Math.abs(y.touches.currentX-y.touches.startX))/Math.PI;M=y.isHorizontal()?t>y.params.touchAngle:90-t>y.params.touchAngle}if(M&&y.emit("onTouchMoveOpposite",y,e),"undefined"==typeof A&&y.browser.ieTouch&&(y.touches.currentX!==y.touches.startX||y.touches.currentY!==y.touches.startY)&&(A=!0),T){if(M)return void(T=!1);if(A||!y.browser.ieTouch){y.allowClick=!1,y.emit("onSliderMove",y,e),e.preventDefault(),y.params.touchMoveStopPropagation&&!y.params.nested&&e.stopPropagation(),S||(s.loop&&y.fixLoop(),I=y.getWrapperTranslate(),y.setWrapperTransition(0),y.animating&&y.wrapper.trigger("webkitTransitionEnd transitionend oTransitionEnd MSTransitionEnd msTransitionEnd"),y.params.autoplay&&y.autoplaying&&(y.params.autoplayDisableOnInteraction?y.stopAutoplay():y.pauseAutoplay()),B=!1,y.params.grabCursor&&(y.container[0].style.cursor="move",y.container[0].style.cursor="-webkit-grabbing",y.container[0].style.cursor="-moz-grabbin",y.container[0].style.cursor="grabbing")),S=!0;var r=y.touches.diff=y.isHorizontal()?y.touches.currentX-y.touches.startX:y.touches.currentY-y.touches.startY;r*=y.params.touchRatio,y.rtl&&(r=-r),y.swipeDirection=r>0?"prev":"next",P=r+I;var i=!0;if(r>0&&P>y.minTranslate()?(i=!1,y.params.resistance&&(P=y.minTranslate()-1+Math.pow(-y.minTranslate()+I+r,y.params.resistanceRatio))):0>r&&P<y.maxTranslate()&&(i=!1,y.params.resistance&&(P=y.maxTranslate()+1-Math.pow(y.maxTranslate()-I-r,y.params.resistanceRatio))),
i&&(e.preventedByNestedSwiper=!0),!y.params.allowSwipeToNext&&"next"===y.swipeDirection&&I>P&&(P=I),!y.params.allowSwipeToPrev&&"prev"===y.swipeDirection&&P>I&&(P=I),y.params.followFinger){if(y.params.threshold>0){if(!(Math.abs(r)>y.params.threshold||k))return void(P=I);if(!k)return k=!0,y.touches.startX=y.touches.currentX,y.touches.startY=y.touches.currentY,P=I,void(y.touches.diff=y.isHorizontal()?y.touches.currentX-y.touches.startX:y.touches.currentY-y.touches.startY)}(y.params.freeMode||y.params.watchSlidesProgress)&&y.updateActiveIndex(),y.params.freeMode&&(0===H.length&&H.push({position:y.touches[y.isHorizontal()?"startX":"startY"],time:z}),H.push({position:y.touches[y.isHorizontal()?"currentX":"currentY"],time:(new window.Date).getTime()})),y.updateProgress(P),y.setWrapperTranslate(P)}}}}}},y.onTouchEnd=function(e){if(e.originalEvent&&(e=e.originalEvent),C&&y.emit("onTouchEnd",y,e),C=!1,T){y.params.grabCursor&&S&&T&&(y.container[0].style.cursor="move",y.container[0].style.cursor="-webkit-grab",y.container[0].style.cursor="-moz-grab",y.container[0].style.cursor="grab");var t=Date.now(),s=t-z;if(y.allowClick&&(y.updateClickedSlide(e),y.emit("onTap",y,e),300>s&&t-L>300&&(E&&clearTimeout(E),E=setTimeout(function(){y&&(y.params.paginationHide&&y.paginationContainer.length>0&&!a(e.target).hasClass(y.params.bulletClass)&&y.paginationContainer.toggleClass(y.params.paginationHiddenClass),y.emit("onClick",y,e))},300)),300>s&&300>t-L&&(E&&clearTimeout(E),y.emit("onDoubleTap",y,e))),L=Date.now(),setTimeout(function(){y&&(y.allowClick=!0)},0),!T||!S||!y.swipeDirection||0===y.touches.diff||P===I)return void(T=S=!1);T=S=!1;var r;if(r=y.params.followFinger?y.rtl?y.translate:-y.translate:-P,y.params.freeMode){if(r<-y.minTranslate())return void y.slideTo(y.activeIndex);if(r>-y.maxTranslate())return void(y.slides.length<y.snapGrid.length?y.slideTo(y.snapGrid.length-1):y.slideTo(y.slides.length-1));if(y.params.freeModeMomentum){if(H.length>1){var i=H.pop(),n=H.pop(),o=i.position-n.position,l=i.time-n.time;y.velocity=o/l,y.velocity=y.velocity/2,Math.abs(y.velocity)<y.params.freeModeMinimumVelocity&&(y.velocity=0),(l>150||(new window.Date).getTime()-i.time>300)&&(y.velocity=0)}else y.velocity=0;H.length=0;var p=1e3*y.params.freeModeMomentumRatio,d=y.velocity*p,u=y.translate+d;y.rtl&&(u=-u);var c,m=!1,f=20*Math.abs(y.velocity)*y.params.freeModeMomentumBounceRatio;if(u<y.maxTranslate())y.params.freeModeMomentumBounce?(u+y.maxTranslate()<-f&&(u=y.maxTranslate()-f),c=y.maxTranslate(),m=!0,B=!0):u=y.maxTranslate();else if(u>y.minTranslate())y.params.freeModeMomentumBounce?(u-y.minTranslate()>f&&(u=y.minTranslate()+f),c=y.minTranslate(),m=!0,B=!0):u=y.minTranslate();else if(y.params.freeModeSticky){var g,h=0;for(h=0;h<y.snapGrid.length;h+=1)if(y.snapGrid[h]>-u){g=h;break}u=Math.abs(y.snapGrid[g]-u)<Math.abs(y.snapGrid[g-1]-u)||"next"===y.swipeDirection?y.snapGrid[g]:y.snapGrid[g-1],y.rtl||(u=-u)}if(0!==y.velocity)p=y.rtl?Math.abs((-u-y.translate)/y.velocity):Math.abs((u-y.translate)/y.velocity);else if(y.params.freeModeSticky)return void y.slideReset();y.params.freeModeMomentumBounce&&m?(y.updateProgress(c),y.setWrapperTransition(p),y.setWrapperTranslate(u),y.onTransitionStart(),y.animating=!0,y.wrapper.transitionEnd(function(){y&&B&&(y.emit("onMomentumBounce",y),y.setWrapperTransition(y.params.speed),y.setWrapperTranslate(c),y.wrapper.transitionEnd(function(){y&&y.onTransitionEnd()}))})):y.velocity?(y.updateProgress(u),y.setWrapperTransition(p),y.setWrapperTranslate(u),y.onTransitionStart(),y.animating||(y.animating=!0,y.wrapper.transitionEnd(function(){y&&y.onTransitionEnd()}))):y.updateProgress(u),y.updateActiveIndex()}return void((!y.params.freeModeMomentum||s>=y.params.longSwipesMs)&&(y.updateProgress(),y.updateActiveIndex()))}var v,w=0,b=y.slidesSizesGrid[0];for(v=0;v<y.slidesGrid.length;v+=y.params.slidesPerGroup)"undefined"!=typeof y.slidesGrid[v+y.params.slidesPerGroup]?r>=y.slidesGrid[v]&&r<y.slidesGrid[v+y.params.slidesPerGroup]&&(w=v,b=y.slidesGrid[v+y.params.slidesPerGroup]-y.slidesGrid[v]):r>=y.slidesGrid[v]&&(w=v,b=y.slidesGrid[y.slidesGrid.length-1]-y.slidesGrid[y.slidesGrid.length-2]);var x=(r-y.slidesGrid[w])/b;if(s>y.params.longSwipesMs){if(!y.params.longSwipes)return void y.slideTo(y.activeIndex);"next"===y.swipeDirection&&(x>=y.params.longSwipesRatio?y.slideTo(w+y.params.slidesPerGroup):y.slideTo(w)),"prev"===y.swipeDirection&&(x>1-y.params.longSwipesRatio?y.slideTo(w+y.params.slidesPerGroup):y.slideTo(w))}else{if(!y.params.shortSwipes)return void y.slideTo(y.activeIndex);"next"===y.swipeDirection&&y.slideTo(w+y.params.slidesPerGroup),"prev"===y.swipeDirection&&y.slideTo(w)}}},y._slideTo=function(e,a){return y.slideTo(e,a,!0,!0)},y.slideTo=function(e,a,t,s){"undefined"==typeof t&&(t=!0),"undefined"==typeof e&&(e=0),0>e&&(e=0),y.snapIndex=Math.floor(e/y.params.slidesPerGroup),y.snapIndex>=y.snapGrid.length&&(y.snapIndex=y.snapGrid.length-1);var r=-y.snapGrid[y.snapIndex];y.params.autoplay&&y.autoplaying&&(s||!y.params.autoplayDisableOnInteraction?y.pauseAutoplay(a):y.stopAutoplay()),y.updateProgress(r);for(var i=0;i<y.slidesGrid.length;i++)-Math.floor(100*r)>=Math.floor(100*y.slidesGrid[i])&&(e=i);return!y.params.allowSwipeToNext&&r<y.translate&&r<y.minTranslate()?!1:!y.params.allowSwipeToPrev&&r>y.translate&&r>y.maxTranslate()&&(y.activeIndex||0)!==e?!1:("undefined"==typeof a&&(a=y.params.speed),y.previousIndex=y.activeIndex||0,y.activeIndex=e,y.rtl&&-r===y.translate||!y.rtl&&r===y.translate?(y.params.autoHeight&&y.updateAutoHeight(),y.updateClasses(),"slide"!==y.params.effect&&y.setWrapperTranslate(r),!1):(y.updateClasses(),y.onTransitionStart(t),0===a?(y.setWrapperTranslate(r),y.setWrapperTransition(0),y.onTransitionEnd(t)):(y.setWrapperTranslate(r),y.setWrapperTransition(a),y.animating||(y.animating=!0,y.wrapper.transitionEnd(function(){y&&y.onTransitionEnd(t)}))),!0))},y.onTransitionStart=function(e){"undefined"==typeof e&&(e=!0),y.params.autoHeight&&y.updateAutoHeight(),y.lazy&&y.lazy.onTransitionStart(),e&&(y.emit("onTransitionStart",y),y.activeIndex!==y.previousIndex&&(y.emit("onSlideChangeStart",y),y.activeIndex>y.previousIndex?y.emit("onSlideNextStart",y):y.emit("onSlidePrevStart",y)))},y.onTransitionEnd=function(e){y.animating=!1,y.setWrapperTransition(0),"undefined"==typeof e&&(e=!0),y.lazy&&y.lazy.onTransitionEnd(),e&&(y.emit("onTransitionEnd",y),y.activeIndex!==y.previousIndex&&(y.emit("onSlideChangeEnd",y),y.activeIndex>y.previousIndex?y.emit("onSlideNextEnd",y):y.emit("onSlidePrevEnd",y))),y.params.hashnav&&y.hashnav&&y.hashnav.setHash()},y.slideNext=function(e,a,t){if(y.params.loop){if(y.animating)return!1;y.fixLoop();y.container[0].clientLeft;return y.slideTo(y.activeIndex+y.params.slidesPerGroup,a,e,t)}return y.slideTo(y.activeIndex+y.params.slidesPerGroup,a,e,t)},y._slideNext=function(e){return y.slideNext(!0,e,!0)},y.slidePrev=function(e,a,t){if(y.params.loop){if(y.animating)return!1;y.fixLoop();y.container[0].clientLeft;return y.slideTo(y.activeIndex-1,a,e,t)}return y.slideTo(y.activeIndex-1,a,e,t)},y._slidePrev=function(e){return y.slidePrev(!0,e,!0)},y.slideReset=function(e,a,t){return y.slideTo(y.activeIndex,a,e)},y.setWrapperTransition=function(e,a){y.wrapper.transition(e),"slide"!==y.params.effect&&y.effects[y.params.effect]&&y.effects[y.params.effect].setTransition(e),y.params.parallax&&y.parallax&&y.parallax.setTransition(e),y.params.scrollbar&&y.scrollbar&&y.scrollbar.setTransition(e),y.params.control&&y.controller&&y.controller.setTransition(e,a),y.emit("onSetTransition",y,e)},y.setWrapperTranslate=function(e,a,t){var s=0,i=0,n=0;y.isHorizontal()?s=y.rtl?-e:e:i=e,y.params.roundLengths&&(s=r(s),i=r(i)),y.params.virtualTranslate||(y.support.transforms3d?y.wrapper.transform("translate3d("+s+"px, "+i+"px, "+n+"px)"):y.wrapper.transform("translate("+s+"px, "+i+"px)")),y.translate=y.isHorizontal()?s:i;var o,l=y.maxTranslate()-y.minTranslate();o=0===l?0:(e-y.minTranslate())/l,o!==y.progress&&y.updateProgress(e),a&&y.updateActiveIndex(),"slide"!==y.params.effect&&y.effects[y.params.effect]&&y.effects[y.params.effect].setTranslate(y.translate),y.params.parallax&&y.parallax&&y.parallax.setTranslate(y.translate),y.params.scrollbar&&y.scrollbar&&y.scrollbar.setTranslate(y.translate),y.params.control&&y.controller&&y.controller.setTranslate(y.translate,t),y.emit("onSetTranslate",y,y.translate)},y.getTranslate=function(e,a){var t,s,r,i;return"undefined"==typeof a&&(a="x"),y.params.virtualTranslate?y.rtl?-y.translate:y.translate:(r=window.getComputedStyle(e,null),window.WebKitCSSMatrix?(s=r.transform||r.webkitTransform,s.split(",").length>6&&(s=s.split(", ").map(function(e){return e.replace(",",".")}).join(", ")),i=new window.WebKitCSSMatrix("none"===s?"":s)):(i=r.MozTransform||r.OTransform||r.MsTransform||r.msTransform||r.transform||r.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),t=i.toString().split(",")),"x"===a&&(s=window.WebKitCSSMatrix?i.m41:16===t.length?parseFloat(t[12]):parseFloat(t[4])),"y"===a&&(s=window.WebKitCSSMatrix?i.m42:16===t.length?parseFloat(t[13]):parseFloat(t[5])),y.rtl&&s&&(s=-s),s||0)},y.getWrapperTranslate=function(e){return"undefined"==typeof e&&(e=y.isHorizontal()?"x":"y"),y.getTranslate(y.wrapper[0],e)},y.observers=[],y.initObservers=function(){if(y.params.observeParents)for(var e=y.container.parents(),a=0;a<e.length;a++)o(e[a]);o(y.container[0],{childList:!1}),o(y.wrapper[0],{attributes:!1})},y.disconnectObservers=function(){for(var e=0;e<y.observers.length;e++)y.observers[e].disconnect();y.observers=[]},y.createLoop=function(){y.wrapper.children("."+y.params.slideClass+"."+y.params.slideDuplicateClass).remove();var e=y.wrapper.children("."+y.params.slideClass);"auto"!==y.params.slidesPerView||y.params.loopedSlides||(y.params.loopedSlides=e.length),y.loopedSlides=parseInt(y.params.loopedSlides||y.params.slidesPerView,10),y.loopedSlides=y.loopedSlides+y.params.loopAdditionalSlides,y.loopedSlides>e.length&&(y.loopedSlides=e.length);var t,s=[],r=[];for(e.each(function(t,i){var n=a(this);t<y.loopedSlides&&r.push(i),t<e.length&&t>=e.length-y.loopedSlides&&s.push(i),n.attr("data-swiper-slide-index",t)}),t=0;t<r.length;t++)y.wrapper.append(a(r[t].cloneNode(!0)).addClass(y.params.slideDuplicateClass));for(t=s.length-1;t>=0;t--)y.wrapper.prepend(a(s[t].cloneNode(!0)).addClass(y.params.slideDuplicateClass))},y.destroyLoop=function(){y.wrapper.children("."+y.params.slideClass+"."+y.params.slideDuplicateClass).remove(),y.slides.removeAttr("data-swiper-slide-index")},y.reLoop=function(e){var a=y.activeIndex-y.loopedSlides;y.destroyLoop(),y.createLoop(),y.updateSlidesSize(),e&&y.slideTo(a+y.loopedSlides,0,!1)},y.fixLoop=function(){var e;y.activeIndex<y.loopedSlides?(e=y.slides.length-3*y.loopedSlides+y.activeIndex,e+=y.loopedSlides,y.slideTo(e,0,!1,!0)):("auto"===y.params.slidesPerView&&y.activeIndex>=2*y.loopedSlides||y.activeIndex>y.slides.length-2*y.params.slidesPerView)&&(e=-y.slides.length+y.activeIndex+y.loopedSlides,e+=y.loopedSlides,y.slideTo(e,0,!1,!0))},y.appendSlide=function(e){if(y.params.loop&&y.destroyLoop(),"object"==typeof e&&e.length)for(var a=0;a<e.length;a++)e[a]&&y.wrapper.append(e[a]);else y.wrapper.append(e);y.params.loop&&y.createLoop(),y.params.observer&&y.support.observer||y.update(!0)},y.prependSlide=function(e){y.params.loop&&y.destroyLoop();var a=y.activeIndex+1;if("object"==typeof e&&e.length){for(var t=0;t<e.length;t++)e[t]&&y.wrapper.prepend(e[t]);a=y.activeIndex+e.length}else y.wrapper.prepend(e);y.params.loop&&y.createLoop(),y.params.observer&&y.support.observer||y.update(!0),y.slideTo(a,0,!1)},y.removeSlide=function(e){y.params.loop&&(y.destroyLoop(),y.slides=y.wrapper.children("."+y.params.slideClass));var a,t=y.activeIndex;if("object"==typeof e&&e.length){for(var s=0;s<e.length;s++)a=e[s],y.slides[a]&&y.slides.eq(a).remove(),t>a&&t--;t=Math.max(t,0)}else a=e,y.slides[a]&&y.slides.eq(a).remove(),t>a&&t--,t=Math.max(t,0);y.params.loop&&y.createLoop(),y.params.observer&&y.support.observer||y.update(!0),y.params.loop?y.slideTo(t+y.loopedSlides,0,!1):y.slideTo(t,0,!1)},y.removeAllSlides=function(){for(var e=[],a=0;a<y.slides.length;a++)e.push(a);y.removeSlide(e)},y.effects={fade:{setTranslate:function(){for(var e=0;e<y.slides.length;e++){var a=y.slides.eq(e),t=a[0].swiperSlideOffset,s=-t;y.params.virtualTranslate||(s-=y.translate);var r=0;y.isHorizontal()||(r=s,s=0);var i=y.params.fade.crossFade?Math.max(1-Math.abs(a[0].progress),0):1+Math.min(Math.max(a[0].progress,-1),0);a.css({opacity:i}).transform("translate3d("+s+"px, "+r+"px, 0px)")}},setTransition:function(e){if(y.slides.transition(e),y.params.virtualTranslate&&0!==e){var a=!1;y.slides.transitionEnd(function(){if(!a&&y){a=!0,y.animating=!1;for(var e=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],t=0;t<e.length;t++)y.wrapper.trigger(e[t])}})}}},flip:{setTranslate:function(){for(var e=0;e<y.slides.length;e++){var t=y.slides.eq(e),s=t[0].progress;y.params.flip.limitRotation&&(s=Math.max(Math.min(t[0].progress,1),-1));var r=t[0].swiperSlideOffset,i=-180*s,n=i,o=0,l=-r,p=0;if(y.isHorizontal()?y.rtl&&(n=-n):(p=l,l=0,o=-n,n=0),t[0].style.zIndex=-Math.abs(Math.round(s))+y.slides.length,y.params.flip.slideShadows){var d=y.isHorizontal()?t.find(".swiper-slide-shadow-left"):t.find(".swiper-slide-shadow-top"),u=y.isHorizontal()?t.find(".swiper-slide-shadow-right"):t.find(".swiper-slide-shadow-bottom");0===d.length&&(d=a('<div class="swiper-slide-shadow-'+(y.isHorizontal()?"left":"top")+'"></div>'),t.append(d)),0===u.length&&(u=a('<div class="swiper-slide-shadow-'+(y.isHorizontal()?"right":"bottom")+'"></div>'),t.append(u)),d.length&&(d[0].style.opacity=Math.max(-s,0)),u.length&&(u[0].style.opacity=Math.max(s,0))}t.transform("translate3d("+l+"px, "+p+"px, 0px) rotateX("+o+"deg) rotateY("+n+"deg)")}},setTransition:function(e){if(y.slides.transition(e).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(e),y.params.virtualTranslate&&0!==e){var t=!1;y.slides.eq(y.activeIndex).transitionEnd(function(){if(!t&&y&&a(this).hasClass(y.params.slideActiveClass)){t=!0,y.animating=!1;for(var e=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],s=0;s<e.length;s++)y.wrapper.trigger(e[s])}})}}},cube:{setTranslate:function(){var e,t=0;y.params.cube.shadow&&(y.isHorizontal()?(e=y.wrapper.find(".swiper-cube-shadow"),0===e.length&&(e=a('<div class="swiper-cube-shadow"></div>'),y.wrapper.append(e)),e.css({height:y.width+"px"})):(e=y.container.find(".swiper-cube-shadow"),0===e.length&&(e=a('<div class="swiper-cube-shadow"></div>'),y.container.append(e))));for(var s=0;s<y.slides.length;s++){var r=y.slides.eq(s),i=90*s,n=Math.floor(i/360);y.rtl&&(i=-i,n=Math.floor(-i/360));var o=Math.max(Math.min(r[0].progress,1),-1),l=0,p=0,d=0;s%4===0?(l=4*-n*y.size,d=0):(s-1)%4===0?(l=0,d=4*-n*y.size):(s-2)%4===0?(l=y.size+4*n*y.size,d=y.size):(s-3)%4===0&&(l=-y.size,d=3*y.size+4*y.size*n),y.rtl&&(l=-l),y.isHorizontal()||(p=l,l=0);var u="rotateX("+(y.isHorizontal()?0:-i)+"deg) rotateY("+(y.isHorizontal()?i:0)+"deg) translate3d("+l+"px, "+p+"px, "+d+"px)";if(1>=o&&o>-1&&(t=90*s+90*o,y.rtl&&(t=90*-s-90*o)),r.transform(u),y.params.cube.slideShadows){var c=y.isHorizontal()?r.find(".swiper-slide-shadow-left"):r.find(".swiper-slide-shadow-top"),m=y.isHorizontal()?r.find(".swiper-slide-shadow-right"):r.find(".swiper-slide-shadow-bottom");0===c.length&&(c=a('<div class="swiper-slide-shadow-'+(y.isHorizontal()?"left":"top")+'"></div>'),r.append(c)),0===m.length&&(m=a('<div class="swiper-slide-shadow-'+(y.isHorizontal()?"right":"bottom")+'"></div>'),r.append(m)),c.length&&(c[0].style.opacity=Math.max(-o,0)),m.length&&(m[0].style.opacity=Math.max(o,0))}}if(y.wrapper.css({"-webkit-transform-origin":"50% 50% -"+y.size/2+"px","-moz-transform-origin":"50% 50% -"+y.size/2+"px","-ms-transform-origin":"50% 50% -"+y.size/2+"px","transform-origin":"50% 50% -"+y.size/2+"px"}),y.params.cube.shadow)if(y.isHorizontal())e.transform("translate3d(0px, "+(y.width/2+y.params.cube.shadowOffset)+"px, "+-y.width/2+"px) rotateX(90deg) rotateZ(0deg) scale("+y.params.cube.shadowScale+")");else{var f=Math.abs(t)-90*Math.floor(Math.abs(t)/90),g=1.5-(Math.sin(2*f*Math.PI/360)/2+Math.cos(2*f*Math.PI/360)/2),h=y.params.cube.shadowScale,v=y.params.cube.shadowScale/g,w=y.params.cube.shadowOffset;e.transform("scale3d("+h+", 1, "+v+") translate3d(0px, "+(y.height/2+w)+"px, "+-y.height/2/v+"px) rotateX(-90deg)")}var b=y.isSafari||y.isUiWebView?-y.size/2:0;y.wrapper.transform("translate3d(0px,0,"+b+"px) rotateX("+(y.isHorizontal()?0:t)+"deg) rotateY("+(y.isHorizontal()?-t:0)+"deg)")},setTransition:function(e){y.slides.transition(e).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(e),y.params.cube.shadow&&!y.isHorizontal()&&y.container.find(".swiper-cube-shadow").transition(e)}},coverflow:{setTranslate:function(){for(var e=y.translate,t=y.isHorizontal()?-e+y.width/2:-e+y.height/2,s=y.isHorizontal()?y.params.coverflow.rotate:-y.params.coverflow.rotate,r=y.params.coverflow.depth,i=0,n=y.slides.length;n>i;i++){var o=y.slides.eq(i),l=y.slidesSizesGrid[i],p=o[0].swiperSlideOffset,d=(t-p-l/2)/l*y.params.coverflow.modifier,u=y.isHorizontal()?s*d:0,c=y.isHorizontal()?0:s*d,m=-r*Math.abs(d),f=y.isHorizontal()?0:y.params.coverflow.stretch*d,g=y.isHorizontal()?y.params.coverflow.stretch*d:0;Math.abs(g)<.001&&(g=0),Math.abs(f)<.001&&(f=0),Math.abs(m)<.001&&(m=0),Math.abs(u)<.001&&(u=0),Math.abs(c)<.001&&(c=0);var h="translate3d("+g+"px,"+f+"px,"+m+"px)  rotateX("+c+"deg) rotateY("+u+"deg)";if(o.transform(h),o[0].style.zIndex=-Math.abs(Math.round(d))+1,y.params.coverflow.slideShadows){var v=y.isHorizontal()?o.find(".swiper-slide-shadow-left"):o.find(".swiper-slide-shadow-top"),w=y.isHorizontal()?o.find(".swiper-slide-shadow-right"):o.find(".swiper-slide-shadow-bottom");0===v.length&&(v=a('<div class="swiper-slide-shadow-'+(y.isHorizontal()?"left":"top")+'"></div>'),o.append(v)),0===w.length&&(w=a('<div class="swiper-slide-shadow-'+(y.isHorizontal()?"right":"bottom")+'"></div>'),o.append(w)),v.length&&(v[0].style.opacity=d>0?d:0),w.length&&(w[0].style.opacity=-d>0?-d:0)}}if(y.browser.ie){var b=y.wrapper[0].style;b.perspectiveOrigin=t+"px 50%"}},setTransition:function(e){y.slides.transition(e).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(e)}}},y.lazy={initialImageLoaded:!1,loadImageInSlide:function(e,t){if("undefined"!=typeof e&&("undefined"==typeof t&&(t=!0),0!==y.slides.length)){var s=y.slides.eq(e),r=s.find(".swiper-lazy:not(.swiper-lazy-loaded):not(.swiper-lazy-loading)");!s.hasClass("swiper-lazy")||s.hasClass("swiper-lazy-loaded")||s.hasClass("swiper-lazy-loading")||(r=r.add(s[0])),0!==r.length&&r.each(function(){var e=a(this);e.addClass("swiper-lazy-loading");var r=e.attr("data-background"),i=e.attr("data-src"),n=e.attr("data-srcset");y.loadImage(e[0],i||r,n,!1,function(){if(r?(e.css("background-image",'url("'+r+'")'),e.removeAttr("data-background")):(n&&(e.attr("srcset",n),e.removeAttr("data-srcset")),i&&(e.attr("src",i),e.removeAttr("data-src"))),e.addClass("swiper-lazy-loaded").removeClass("swiper-lazy-loading"),s.find(".swiper-lazy-preloader, .preloader").remove(),y.params.loop&&t){var a=s.attr("data-swiper-slide-index");if(s.hasClass(y.params.slideDuplicateClass)){var o=y.wrapper.children('[data-swiper-slide-index="'+a+'"]:not(.'+y.params.slideDuplicateClass+")");y.lazy.loadImageInSlide(o.index(),!1)}else{var l=y.wrapper.children("."+y.params.slideDuplicateClass+'[data-swiper-slide-index="'+a+'"]');y.lazy.loadImageInSlide(l.index(),!1)}}y.emit("onLazyImageReady",y,s[0],e[0])}),y.emit("onLazyImageLoad",y,s[0],e[0])})}},load:function(){var e;if(y.params.watchSlidesVisibility)y.wrapper.children("."+y.params.slideVisibleClass).each(function(){y.lazy.loadImageInSlide(a(this).index())});else if(y.params.slidesPerView>1)for(e=y.activeIndex;e<y.activeIndex+y.params.slidesPerView;e++)y.slides[e]&&y.lazy.loadImageInSlide(e);else y.lazy.loadImageInSlide(y.activeIndex);if(y.params.lazyLoadingInPrevNext)if(y.params.slidesPerView>1||y.params.lazyLoadingInPrevNextAmount&&y.params.lazyLoadingInPrevNextAmount>1){var t=y.params.lazyLoadingInPrevNextAmount,s=y.params.slidesPerView,r=Math.min(y.activeIndex+s+Math.max(t,s),y.slides.length),i=Math.max(y.activeIndex-Math.max(s,t),0);for(e=y.activeIndex+y.params.slidesPerView;r>e;e++)y.slides[e]&&y.lazy.loadImageInSlide(e);for(e=i;e<y.activeIndex;e++)y.slides[e]&&y.lazy.loadImageInSlide(e)}else{var n=y.wrapper.children("."+y.params.slideNextClass);n.length>0&&y.lazy.loadImageInSlide(n.index());var o=y.wrapper.children("."+y.params.slidePrevClass);o.length>0&&y.lazy.loadImageInSlide(o.index())}},onTransitionStart:function(){y.params.lazyLoading&&(y.params.lazyLoadingOnTransitionStart||!y.params.lazyLoadingOnTransitionStart&&!y.lazy.initialImageLoaded)&&y.lazy.load()},onTransitionEnd:function(){y.params.lazyLoading&&!y.params.lazyLoadingOnTransitionStart&&y.lazy.load()}},y.scrollbar={isTouched:!1,setDragPosition:function(e){var a=y.scrollbar,t=y.isHorizontal()?"touchstart"===e.type||"touchmove"===e.type?e.targetTouches[0].pageX:e.pageX||e.clientX:"touchstart"===e.type||"touchmove"===e.type?e.targetTouches[0].pageY:e.pageY||e.clientY,s=t-a.track.offset()[y.isHorizontal()?"left":"top"]-a.dragSize/2,r=-y.minTranslate()*a.moveDivider,i=-y.maxTranslate()*a.moveDivider;r>s?s=r:s>i&&(s=i),s=-s/a.moveDivider,y.updateProgress(s),y.setWrapperTranslate(s,!0)},dragStart:function(e){var a=y.scrollbar;a.isTouched=!0,e.preventDefault(),e.stopPropagation(),a.setDragPosition(e),clearTimeout(a.dragTimeout),a.track.transition(0),y.params.scrollbarHide&&a.track.css("opacity",1),y.wrapper.transition(100),a.drag.transition(100),y.emit("onScrollbarDragStart",y)},dragMove:function(e){var a=y.scrollbar;a.isTouched&&(e.preventDefault?e.preventDefault():e.returnValue=!1,a.setDragPosition(e),y.wrapper.transition(0),a.track.transition(0),a.drag.transition(0),y.emit("onScrollbarDragMove",y))},dragEnd:function(e){var a=y.scrollbar;a.isTouched&&(a.isTouched=!1,y.params.scrollbarHide&&(clearTimeout(a.dragTimeout),a.dragTimeout=setTimeout(function(){a.track.css("opacity",0),a.track.transition(400)},1e3)),y.emit("onScrollbarDragEnd",y),y.params.scrollbarSnapOnRelease&&y.slideReset())},enableDraggable:function(){var e=y.scrollbar,t=y.support.touch?e.track:document;a(e.track).on(y.touchEvents.start,e.dragStart),a(t).on(y.touchEvents.move,e.dragMove),a(t).on(y.touchEvents.end,e.dragEnd)},disableDraggable:function(){var e=y.scrollbar,t=y.support.touch?e.track:document;a(e.track).off(y.touchEvents.start,e.dragStart),a(t).off(y.touchEvents.move,e.dragMove),a(t).off(y.touchEvents.end,e.dragEnd)},set:function(){if(y.params.scrollbar){var e=y.scrollbar;e.track=a(y.params.scrollbar),y.params.uniqueNavElements&&"string"==typeof y.params.scrollbar&&e.track.length>1&&1===y.container.find(y.params.scrollbar).length&&(e.track=y.container.find(y.params.scrollbar)),e.drag=e.track.find(".swiper-scrollbar-drag"),0===e.drag.length&&(e.drag=a('<div class="swiper-scrollbar-drag"></div>'),e.track.append(e.drag)),e.drag[0].style.width="",e.drag[0].style.height="",e.trackSize=y.isHorizontal()?e.track[0].offsetWidth:e.track[0].offsetHeight,e.divider=y.size/y.virtualSize,e.moveDivider=e.divider*(e.trackSize/y.size),e.dragSize=e.trackSize*e.divider,y.isHorizontal()?e.drag[0].style.width=e.dragSize+"px":e.drag[0].style.height=e.dragSize+"px",e.divider>=1?e.track[0].style.display="none":e.track[0].style.display="",y.params.scrollbarHide&&(e.track[0].style.opacity=0)}},setTranslate:function(){if(y.params.scrollbar){var e,a=y.scrollbar,t=(y.translate||0,a.dragSize);e=(a.trackSize-a.dragSize)*y.progress,y.rtl&&y.isHorizontal()?(e=-e,e>0?(t=a.dragSize-e,e=0):-e+a.dragSize>a.trackSize&&(t=a.trackSize+e)):0>e?(t=a.dragSize+e,e=0):e+a.dragSize>a.trackSize&&(t=a.trackSize-e),y.isHorizontal()?(y.support.transforms3d?a.drag.transform("translate3d("+e+"px, 0, 0)"):a.drag.transform("translateX("+e+"px)"),a.drag[0].style.width=t+"px"):(y.support.transforms3d?a.drag.transform("translate3d(0px, "+e+"px, 0)"):a.drag.transform("translateY("+e+"px)"),a.drag[0].style.height=t+"px"),y.params.scrollbarHide&&(clearTimeout(a.timeout),a.track[0].style.opacity=1,a.timeout=setTimeout(function(){a.track[0].style.opacity=0,a.track.transition(400)},1e3))}},setTransition:function(e){y.params.scrollbar&&y.scrollbar.drag.transition(e)}},y.controller={LinearSpline:function(e,a){this.x=e,this.y=a,this.lastIndex=e.length-1;var t,s;this.x.length;this.interpolate=function(e){return e?(s=r(this.x,e),t=s-1,(e-this.x[t])*(this.y[s]-this.y[t])/(this.x[s]-this.x[t])+this.y[t]):0};var r=function(){var e,a,t;return function(s,r){for(a=-1,e=s.length;e-a>1;)s[t=e+a>>1]<=r?a=t:e=t;return e}}()},getInterpolateFunction:function(e){y.controller.spline||(y.controller.spline=y.params.loop?new y.controller.LinearSpline(y.slidesGrid,e.slidesGrid):new y.controller.LinearSpline(y.snapGrid,e.snapGrid))},setTranslate:function(e,a){function s(a){e=a.rtl&&"horizontal"===a.params.direction?-y.translate:y.translate,"slide"===y.params.controlBy&&(y.controller.getInterpolateFunction(a),i=-y.controller.spline.interpolate(-e)),i&&"container"!==y.params.controlBy||(r=(a.maxTranslate()-a.minTranslate())/(y.maxTranslate()-y.minTranslate()),i=(e-y.minTranslate())*r+a.minTranslate()),y.params.controlInverse&&(i=a.maxTranslate()-i),a.updateProgress(i),a.setWrapperTranslate(i,!1,y),a.updateActiveIndex()}var r,i,n=y.params.control;if(y.isArray(n))for(var o=0;o<n.length;o++)n[o]!==a&&n[o]instanceof t&&s(n[o]);else n instanceof t&&a!==n&&s(n)},setTransition:function(e,a){function s(a){a.setWrapperTransition(e,y),0!==e&&(a.onTransitionStart(),a.wrapper.transitionEnd(function(){i&&(a.params.loop&&"slide"===y.params.controlBy&&a.fixLoop(),a.onTransitionEnd())}))}var r,i=y.params.control;if(y.isArray(i))for(r=0;r<i.length;r++)i[r]!==a&&i[r]instanceof t&&s(i[r]);else i instanceof t&&a!==i&&s(i)}},y.hashnav={init:function(){if(y.params.hashnav){y.hashnav.initialized=!0;var e=document.location.hash.replace("#","");if(e)for(var a=0,t=0,s=y.slides.length;s>t;t++){var r=y.slides.eq(t),i=r.attr("data-hash");if(i===e&&!r.hasClass(y.params.slideDuplicateClass)){var n=r.index();y.slideTo(n,a,y.params.runCallbacksOnInit,!0)}}}},setHash:function(){y.hashnav.initialized&&y.params.hashnav&&(document.location.hash=y.slides.eq(y.activeIndex).attr("data-hash")||"")}},y.disableKeyboardControl=function(){y.params.keyboardControl=!1,a(document).off("keydown",l)},y.enableKeyboardControl=function(){y.params.keyboardControl=!0,a(document).on("keydown",l)},y.mousewheel={event:!1,lastScrollTime:(new window.Date).getTime()},y.params.mousewheelControl){try{new window.WheelEvent("wheel"),y.mousewheel.event="wheel"}catch(O){(window.WheelEvent||y.container[0]&&"wheel"in y.container[0])&&(y.mousewheel.event="wheel")}!y.mousewheel.event&&window.WheelEvent,y.mousewheel.event||void 0===document.onmousewheel||(y.mousewheel.event="mousewheel"),y.mousewheel.event||(y.mousewheel.event="DOMMouseScroll")}y.disableMousewheelControl=function(){return y.mousewheel.event?(y.container.off(y.mousewheel.event,p),!0):!1},y.enableMousewheelControl=function(){return y.mousewheel.event?(y.container.on(y.mousewheel.event,p),!0):!1},y.parallax={setTranslate:function(){y.container.children("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){d(this,y.progress)}),y.slides.each(function(){var e=a(this);e.find("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){var a=Math.min(Math.max(e[0].progress,-1),1);d(this,a)})})},setTransition:function(e){"undefined"==typeof e&&(e=y.params.speed),y.container.find("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){var t=a(this),s=parseInt(t.attr("data-swiper-parallax-duration"),10)||e;0===e&&(s=0),t.transition(s)})}},y._plugins=[];for(var N in y.plugins){var R=y.plugins[N](y,y.params[N]);R&&y._plugins.push(R)}return y.callPlugins=function(e){for(var a=0;a<y._plugins.length;a++)e in y._plugins[a]&&y._plugins[a][e](arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},y.emitterEventListeners={},y.emit=function(e){y.params[e]&&y.params[e](arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);var a;if(y.emitterEventListeners[e])for(a=0;a<y.emitterEventListeners[e].length;a++)y.emitterEventListeners[e][a](arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);y.callPlugins&&y.callPlugins(e,arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},y.on=function(e,a){return e=u(e),y.emitterEventListeners[e]||(y.emitterEventListeners[e]=[]),y.emitterEventListeners[e].push(a),y},y.off=function(e,a){var t;if(e=u(e),"undefined"==typeof a)return y.emitterEventListeners[e]=[],y;if(y.emitterEventListeners[e]&&0!==y.emitterEventListeners[e].length){for(t=0;t<y.emitterEventListeners[e].length;t++)y.emitterEventListeners[e][t]===a&&y.emitterEventListeners[e].splice(t,1);return y}},y.once=function(e,a){e=u(e);var t=function(){a(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]),y.off(e,t)};return y.on(e,t),y},y.a11y={makeFocusable:function(e){return e.attr("tabIndex","0"),e},addRole:function(e,a){return e.attr("role",a),e},addLabel:function(e,a){return e.attr("aria-label",a),e},disable:function(e){return e.attr("aria-disabled",!0),e},enable:function(e){return e.attr("aria-disabled",!1),e},onEnterKey:function(e){13===e.keyCode&&(a(e.target).is(y.params.nextButton)?(y.onClickNext(e),y.isEnd?y.a11y.notify(y.params.lastSlideMessage):y.a11y.notify(y.params.nextSlideMessage)):a(e.target).is(y.params.prevButton)&&(y.onClickPrev(e),y.isBeginning?y.a11y.notify(y.params.firstSlideMessage):y.a11y.notify(y.params.prevSlideMessage)),a(e.target).is("."+y.params.bulletClass)&&a(e.target)[0].click())},liveRegion:a('<span class="swiper-notification" aria-live="assertive" aria-atomic="true"></span>'),notify:function(e){var a=y.a11y.liveRegion;0!==a.length&&(a.html(""),a.html(e))},init:function(){y.params.nextButton&&y.nextButton&&y.nextButton.length>0&&(y.a11y.makeFocusable(y.nextButton),y.a11y.addRole(y.nextButton,"button"),y.a11y.addLabel(y.nextButton,y.params.nextSlideMessage)),y.params.prevButton&&y.prevButton&&y.prevButton.length>0&&(y.a11y.makeFocusable(y.prevButton),y.a11y.addRole(y.prevButton,"button"),y.a11y.addLabel(y.prevButton,y.params.prevSlideMessage)),a(y.container).append(y.a11y.liveRegion)},initPagination:function(){y.params.pagination&&y.params.paginationClickable&&y.bullets&&y.bullets.length&&y.bullets.each(function(){var e=a(this);y.a11y.makeFocusable(e),y.a11y.addRole(e,"button"),y.a11y.addLabel(e,y.params.paginationBulletMessage.replace(/{{index}}/,e.index()+1))})},destroy:function(){y.a11y.liveRegion&&y.a11y.liveRegion.length>0&&y.a11y.liveRegion.remove()}},y.init=function(){y.params.loop&&y.createLoop(),y.updateContainerSize(),y.updateSlidesSize(),y.updatePagination(),y.params.scrollbar&&y.scrollbar&&(y.scrollbar.set(),y.params.scrollbarDraggable&&y.scrollbar.enableDraggable()),"slide"!==y.params.effect&&y.effects[y.params.effect]&&(y.params.loop||y.updateProgress(),y.effects[y.params.effect].setTranslate()),y.params.loop?y.slideTo(y.params.initialSlide+y.loopedSlides,0,y.params.runCallbacksOnInit):(y.slideTo(y.params.initialSlide,0,y.params.runCallbacksOnInit),0===y.params.initialSlide&&(y.parallax&&y.params.parallax&&y.parallax.setTranslate(),y.lazy&&y.params.lazyLoading&&(y.lazy.load(),y.lazy.initialImageLoaded=!0))),y.attachEvents(),y.params.observer&&y.support.observer&&y.initObservers(),y.params.preloadImages&&!y.params.lazyLoading&&y.preloadImages(),y.params.autoplay&&y.startAutoplay(),y.params.keyboardControl&&y.enableKeyboardControl&&y.enableKeyboardControl(),y.params.mousewheelControl&&y.enableMousewheelControl&&y.enableMousewheelControl(),
y.params.hashnav&&y.hashnav&&y.hashnav.init(),y.params.a11y&&y.a11y&&y.a11y.init(),y.emit("onInit",y)},y.cleanupStyles=function(){y.container.removeClass(y.classNames.join(" ")).removeAttr("style"),y.wrapper.removeAttr("style"),y.slides&&y.slides.length&&y.slides.removeClass([y.params.slideVisibleClass,y.params.slideActiveClass,y.params.slideNextClass,y.params.slidePrevClass].join(" ")).removeAttr("style").removeAttr("data-swiper-column").removeAttr("data-swiper-row"),y.paginationContainer&&y.paginationContainer.length&&y.paginationContainer.removeClass(y.params.paginationHiddenClass),y.bullets&&y.bullets.length&&y.bullets.removeClass(y.params.bulletActiveClass),y.params.prevButton&&a(y.params.prevButton).removeClass(y.params.buttonDisabledClass),y.params.nextButton&&a(y.params.nextButton).removeClass(y.params.buttonDisabledClass),y.params.scrollbar&&y.scrollbar&&(y.scrollbar.track&&y.scrollbar.track.length&&y.scrollbar.track.removeAttr("style"),y.scrollbar.drag&&y.scrollbar.drag.length&&y.scrollbar.drag.removeAttr("style"))},y.destroy=function(e,a){y.detachEvents(),y.stopAutoplay(),y.params.scrollbar&&y.scrollbar&&y.params.scrollbarDraggable&&y.scrollbar.disableDraggable(),y.params.loop&&y.destroyLoop(),a&&y.cleanupStyles(),y.disconnectObservers(),y.params.keyboardControl&&y.disableKeyboardControl&&y.disableKeyboardControl(),y.params.mousewheelControl&&y.disableMousewheelControl&&y.disableMousewheelControl(),y.params.a11y&&y.a11y&&y.a11y.destroy(),y.emit("onDestroy"),e!==!1&&(y=null)},y.init(),y}};t.prototype={isSafari:function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("safari")>=0&&e.indexOf("chrome")<0&&e.indexOf("android")<0}(),isUiWebView:/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent),isArray:function(e){return"[object Array]"===Object.prototype.toString.apply(e)},browser:{ie:window.navigator.pointerEnabled||window.navigator.msPointerEnabled,ieTouch:window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints>1||window.navigator.pointerEnabled&&window.navigator.maxTouchPoints>1},device:function(){var e=navigator.userAgent,a=e.match(/(Android);?[\s\/]+([\d.]+)?/),t=e.match(/(iPad).*OS\s([\d_]+)/),s=e.match(/(iPod)(.*OS\s([\d_]+))?/),r=!t&&e.match(/(iPhone\sOS)\s([\d_]+)/);return{ios:t||r||s,android:a}}(),support:{touch:window.Modernizr&&Modernizr.touch===!0||function(){return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)}(),transforms3d:window.Modernizr&&Modernizr.csstransforms3d===!0||function(){var e=document.createElement("div").style;return"webkitPerspective"in e||"MozPerspective"in e||"OPerspective"in e||"MsPerspective"in e||"perspective"in e}(),flexbox:function(){for(var e=document.createElement("div").style,a="alignItems webkitAlignItems webkitBoxAlign msFlexAlign mozBoxAlign webkitFlexDirection msFlexDirection mozBoxDirection mozBoxOrient webkitBoxDirection webkitBoxOrient".split(" "),t=0;t<a.length;t++)if(a[t]in e)return!0}(),observer:function(){return"MutationObserver"in window||"WebkitMutationObserver"in window}()},plugins:{}};for(var s=["jQuery","Zepto","Dom7"],r=0;r<s.length;r++)window[s[r]]&&e(window[s[r]]);var i;i="undefined"==typeof Dom7?window.Dom7||window.Zepto||window.jQuery:Dom7,i&&("transitionEnd"in i.fn||(i.fn.transitionEnd=function(e){function a(i){if(i.target===this)for(e.call(this,i),t=0;t<s.length;t++)r.off(s[t],a)}var t,s=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],r=this;if(e)for(t=0;t<s.length;t++)r.on(s[t],a);return this}),"transform"in i.fn||(i.fn.transform=function(e){for(var a=0;a<this.length;a++){var t=this[a].style;t.webkitTransform=t.MsTransform=t.msTransform=t.MozTransform=t.OTransform=t.transform=e}return this}),"transition"in i.fn||(i.fn.transition=function(e){"string"!=typeof e&&(e+="ms");for(var a=0;a<this.length;a++){var t=this[a].style;t.webkitTransitionDuration=t.MsTransitionDuration=t.msTransitionDuration=t.MozTransitionDuration=t.OTransitionDuration=t.transitionDuration=e}return this})),window.Swiper=t}(),"undefined"!=typeof module?module.exports=window.Swiper:"function"==typeof define&&define.amd&&define([],function(){"use strict";return window.Swiper});
//# sourceMappingURL=maps/swiper.jquery.min.js.map
; 
/*
 Jh.js
 Jquery Portal layout 
 可拖拽布局 
 Copyright (C) Jh 2012.4.11
 @author xiaofan
*/
var Jh = {	
	Config:{
		tableCls:"form-list",
		tdCls:"form-text",
		tdCls2:"single",
		ulCls : "tag-list",
		layCls :"layout-list",
		min :"min",
		mintext:"\u6536\u8D77",
		max :"max",
		maxtext:"\u5C55\u5F00",
		close :"close",
		closetext :"\u5173\u95ED",
		refreshtext:"\u5237\u65B0",
		refresh :"refresh",
		_groupItemContent : "itemContent",
		_groupItemHead : "itemHeader",
		_groupWrapperClass  : "groupWrapper",
		_groupItemClass : "groupItem",
		_sysWidgetSet : {
			"system_workflow" : "true",
			"system_announcement" : "false",
			"system_weather" : "false",
			"menuIcon" : "true",
			"Banner" : "true"
		}
	}	
};

function FormBaiduMap(FieldID,applicationid,displayType){
	var oField = jQuery("#"+ FieldID);
	var url="../../portal/share/component/map/form/baiduMap.jsp?type=dialog&applicationid="+applicationid+"&displayType="+displayType;
	OBPM.dialog.show({
		title : title_map,
		url : url,
		args: {"fieldID":FieldID,"mapData":oField.val()},
		width : 1000,
		height : 600,
		close : function(result) {
		}
	});
}

Jh.Layout=function(me){
	var _winwidth = $(window).width();
	
	var _left = "portal_l"	,
		_center ="portal_m",
		_right ="portal_r",
		_icon ="portal_i";
	return me = {
		location:{//三列容器
			left:_left,
			center:_center,
			right:_right,
			icon:_icon
		},
		locationId : {
			left:"#"+_left,
			center:"#"+_center,
			right:"#"+_right,
			icon:"#"+_icon
		},
		layoutCss : {
			0:"1:3",
			1:"3:1",
			2:"1:2",
			3:"2:1",
			4:"1:2:1",
			5:"1:1:2",
			6:"2:1:1",
			7:"1:1:1",
			8:"1:1",
			9:"1"
		},
		layoutText : {
			0 :function(){return "w25 w75 wnone";}(),
			1 :function(){return "w75 w25 wnone";}(),
			2 :function(){return "w33 w66 wnone";}(),
			3 :function(){return "w66 w33 wnone";}(),
			4 :function(){return "w25 w50 w25";}(),
			5 :function(){return "w25 w25 w50";}(),
			6 :function(){return "w50 w25 w25";}(),
			7 :function(){return "w33 w33 w33";}(),
			8 :function(){return "w50 w50 wnone";}(),
			9 :function(){return "w00 wnone wnone";}()
		}
	};
}();

Jh.Util = {//工具类
	format : function (str, model) {//格式化指定键值的模板
		for (var k in model) {
			var re = new RegExp("{" + k + "}", "g");
			str = str.replace(re, model[k]);
		}
		return str;
	},
	toBody:function(o){//往Body添加对象
		$("body").prepend(o);
	},
	configToString:function(val,cfg){
		name = "'"+val+"':" + cfg + ",";
		return name;
	},
	//判断旧数据 利用json2.js将字符串转对象
	setValueJson:function(val){
		var oldVal = false;
		var iconJson
		try { 
			iconJson = JSON.parse(val);
		}catch(e){ 
			oldVal = true;
		} 
		if(oldVal == true){
			iconJson = {}
			iconJson.icon = val;
		}
		return iconJson
	},
	sysFlowTab:function(tabName){
		$(".widget-tab").find(".nav-tabs").find("li").removeClass("active");
		$(".widget-tab").find("a[aria-controls='"+tabName+"']").parent("li").addClass("active");
		$(".widget-tab").find(".tab-content").find(".tab-pane").removeClass("active");
		$(".widget-tab").find(".tab-content").find("#sysFlowTab_"+tabName).addClass("active");
	},
	setUserWidget:function(userCfg, defaultCfg){//往Body添加对象
		var _userCfg = "";
		var _appIcon = "";
		var _appL = "";
		var _appM = "";
		var _appR = "";
		
		$.each(userCfg, function(i, value) {
			if(value && value.length > 0){
				if(i=="appIcon"){
					$.each(value,function(j,val) {
						if(defaultCfg.appIcon[val] || defaultCfg.appIcon[val]!=undefined){
							_appIcon += Jh.Util.configToString(val,JSON.stringify(defaultCfg.appIcon[val]));
						}else if(defaultCfg.appL[val] || defaultCfg.appL[val]!=undefined){
							_appIcon += Jh.Util.configToString(val,JSON.stringify(defaultCfg.appL[val]));
						}else if(defaultCfg.appM[val] || defaultCfg.appM[val]!=undefined){
							_appIcon += Jh.Util.configToString(val,JSON.stringify(defaultCfg.appM[val]));
						}else if(defaultCfg.appR[val] || defaultCfg.appR[val]!=undefined){
							_appIcon += Jh.Util.configToString(val,JSON.stringify(defaultCfg.appR[val]));
						}
					 })
				}
				if(i=="appL"){
					$.each(value,function(j,val) { 
						if(defaultCfg.appIcon[val] || defaultCfg.appIcon[val]!=undefined){
							_appL += Jh.Util.configToString(val,JSON.stringify(defaultCfg.appIcon[val]));
						}else if(defaultCfg.appL[val] || defaultCfg.appL[val]!=undefined){
							_appL += Jh.Util.configToString(val,JSON.stringify(defaultCfg.appL[val]));
						}else if(defaultCfg.appM[val] || defaultCfg.appM[val]!=undefined){
							_appL += Jh.Util.configToString(val,JSON.stringify(defaultCfg.appM[val]));
						}else if(defaultCfg.appR[val] || defaultCfg.appR[val]!=undefined){
							_appL += Jh.Util.configToString(val,JSON.stringify(defaultCfg.appR[val]));
						}
					 })
				}
				if(i=="appM"){
					$.each(value,function(j,val) {
						if(defaultCfg.appIcon[val] || defaultCfg.appIcon[val]!=undefined){
							_appM += Jh.Util.configToString(val,JSON.stringify(defaultCfg.appIcon[val]));
						}else if(defaultCfg.appL[val] || defaultCfg.appL[val]!=undefined){
							_appM += Jh.Util.configToString(val,JSON.stringify(defaultCfg.appL[val]));
						}else if(defaultCfg.appM[val] || defaultCfg.appM[val]!=undefined){
							_appM += Jh.Util.configToString(val,JSON.stringify(defaultCfg.appM[val]));
						}else if(defaultCfg.appR[val] || defaultCfg.appR[val]!=undefined){
							_appM += Jh.Util.configToString(val,JSON.stringify(defaultCfg.appR[val]));
						}
					 })
				}
				if(i=="appR"){
					$.each(value,function(j,val) {
						if(defaultCfg.appIcon[val] || defaultCfg.appIcon[val]!=undefined){
							_appR += Jh.Util.configToString(val,JSON.stringify(defaultCfg.appIcon[val]));
						}else if(defaultCfg.appL[val] || defaultCfg.appL[val]!=undefined){
							_appR += Jh.Util.configToString(val,JSON.stringify(defaultCfg.appL[val]));
						}else if(defaultCfg.appM[val] || defaultCfg.appM[val]!=undefined){
							_appR += Jh.Util.configToString(val,JSON.stringify(defaultCfg.appM[val]));
						}else if(defaultCfg.appR[val] || defaultCfg.appR[val]!=undefined){
							_appR += Jh.Util.configToString(val,JSON.stringify(defaultCfg.appR[val]));
						}
					 })
				}
				if(i=="layoutStyle"){
					_userCfg += "'layoutStyle':'";
					_userCfg += defaultCfg.layoutStyle;
					_userCfg += "'";
				}
			}
		});
		
		if (_appL.length > 0)
			_appL = _appL.substring(0,_appL.length - 1);
		if (_appM.length > 0)
			_appM = _appM.substring(0,_appM.length - 1);
		if (_appR.length > 0)
			_appR = _appR.substring(0,_appR.length - 1);
		if (_appIcon.length > 0)
			_appIcon = _appIcon.substring(0,_appIcon.length - 1);
		
		return ("{" + "'appIcon':{"+ _appIcon +"}," 
			+ "'appL':{"+ _appL +"}," 
			+ "'appM':{"+ _appM +"}," 
			+ "'appR':{"+ _appR +"}," 
			+ _userCfg
			+ "}");
	},
	setIcon:function(widgetType){
		var defaultIcon;
		var _defaultIcon = {
				iconCustomizeReport : '<i class=\"icon iconfont\">&#xe602;</i>',
				iconIscript : '<i class=\"icon iconfont\">&#xe602;</i>',
				iconLink : '<i class=\"icon iconfont\">&#xe603;</i>',
				iconPage : '<i class=\"icon iconfont\">&#xe604;</i>',
				iconReport : '<i class=\"icon iconfont\">&#xe605;</i>',
				iconRunquanReport : '<i class=\"icon iconfont\">&#xe602;</i>',
				iconSummary : '<i class=\"icon iconfont\">&#xe607;</i>',
				iconSystemAnnouncement : '<i class=\"icon iconfont\">&#xe602;</i>',
				iconSystemWorkflow : '<i class=\"icon iconfont\">&#xe608;</i>',
				iconSystemWeather : '/portal/phone/resource/images/icon-weather.png',
				iconView : '<i class=\"icon iconfont\">&#xe608;</i>',
				iconWorkflowAnalyzer : '<i class=\"icon iconfont\">&#xe602;</i>',
				iconOther : '<i class=\"icon iconfont\">&#xe602;</i>'
		};
		switch (widgetType) {
			case "customizeReport":
				defaultIcon = _defaultIcon.iconCustomizeReport;
				break;
			case "iscript":
				defaultIcon = _defaultIcon.iconIscript;
				break;
			case "link":
				defaultIcon = _defaultIcon.iconLink;
				break;
			case "page":
				defaultIcon = _defaultIcon.iconPage;
				break;
			case "report":
				defaultIcon = _defaultIcon.iconReport;
				break;
			case "summary":
				defaultIcon = _defaultIcon.iconSummary;
				break;
			case "system_announcement":
				defaultIcon = _defaultIcon.iconSystemAnnouncement;
				break;
			case "system_workflow":
				defaultIcon = _defaultIcon.iconSystemWorkflow;
				break;
			case "system_weather":
				defaultIcon = _defaultIcon.iconSystemWeather;
				break;
			case "view":
				defaultIcon = _defaultIcon.iconView;
				break;
			case "workflow_analyzer":
				defaultIcon = _defaultIcon.iconWorkflowAnalyzer;
				break;
			default:
				defaultIcon = _defaultIcon.iconOther;
				break;
		}
		return defaultIcon;
	}
};
Jh.fn = function(me){//功能区
	return me = {
		init:function(data){//初始化
			me._ele = {};
			me._create();
			me._createWrap(data);
			me._bindEvent();
			//设置默认layout
			$("#header>table a[rel='"+data.layoutStyle+"']").trigger("click");
		},
		
		_create:function(){//创建自己
			var _box = $("<div id='header'/>");
			$("<div id='configBtn'><span class='configImg'></span></div>")
			.hover(function(){
				//addClass("")
			},function(){

			})
			.click(function(){
				var $table = $("#header").find("table");
				if ($table.is(":hidden")) {
					$table.show();
				}
				else {
					$table.hide();
				}
			}).appendTo(_box);
			me.box = _box; 
			Jh.Util.toBody(_box);//往Body里添加自己
			
			
			
		},
		
		_createWrap:function(d){//创建外层容器
			var _table = me._createTable(Jh.Config.tableCls);
			me._ele.table = _table;
			me._createModuleList(d);
			
			me._addPanel(_table);
			_table.hide();//初始化隐藏
		},
		
		_createTable:function(clsName){	//创建表格		
			var _t = $("<table/>").addClass(clsName);
			$("<tbody/>")
								.append(me._createLayoutTr())
								.append(me._createBaseTr())					 
								.append(me._createActionTr())
								.appendTo(_t);	
			return _t; 	
		},
		
		_createBaseTr:function(){//创建功能模块tr
			var	_td = me._createTd(Jh.Config.tdCls2),
				_tr = $("<tr>").append(me._createTd(Jh.Config.tdCls,"\u529F\u80FD\u6A21\u5757\u8BBE\u7F6E:"))
							   .append(_td);
			me._ele.mtd = _td;				   
			return _tr;
		},
		
		_createActionTr:function(){//创建按钮tr
			var _td = me._createTd(Jh.Config.tdCls2),
				_tr = $("<tr>").append(me._createTd(Jh.Config.tdCls))
							.append(_td);
			me._ele.atd = _td;	
			return _tr;
		},
		
		_createLayoutTr:function(){//创建布局
			var _td = me._createTd(Jh.Config.tdCls2),
				_div = $("<div/>").addClass(Jh.Config.layCls)
				  				  .append(me._createA("1"))
								  .append(me._createA("1:1"))
								  .append(me._createA("1:3"))
								  .append(me._createA("3:1"))
								  .append(me._createA("1:2"))
								  .append(me._createA("2:1"))
							 	  .append(me._createA("1:1:2"))
								  .append(me._createA("1:2:1"))
								  .append(me._createA("2:1:1"))
								  .append(me._createA("1:1:1"))
								  .appendTo(_td),
				_tr = $("<tr>").append(me._createTd(Jh.Config.tdCls,"\u5E03\u5C40\u8BBE\u7F6E:")).append(_td);

			me._ele.layoutTd = _td;
			return _tr;
		},
		
		_createModuleList:function(data){//创建模块list
			var _ul = $("<ul/>").addClass(Jh.Config.ulCls);
//			me._createLis(data,_ul);
			//初始化icon
			me._createLis(data.appIcon,_ul);
			me._createHr(_ul);
			//初始化左中右
			me._createLis(data.appL,_ul);
			me._createLis(data.appM,_ul);
			me._createLis(data.appR,_ul);
			me._ele.ul = _ul;
			_ul.appendTo(me._ele.mtd);
		},
		
		
		
		_createLis:function(obj,_ul){//创建li列表
			$.each(obj,function(key,o){				
				_ul.append(me._createLi(key,o));
			});
		},
		
		_createHr:function(_ul){//创建分割线
			_ul.append("<hr style='clear:both'/>");
		},
		
		_createA:function(text){//创建A
			return $("<a href='javascript:void(0);' rel='"+text+"'>"+text+"</a>");
		},
		
		_createLi:function(key,o){//创建li
			var setIcon
			if(o.icon == "" || o.icon == "null"){
				setIcon = Jh.Util.setIcon(o.type);
			}else{
				setIcon = o.icon;
			}
			 
			var $li = $("<li/>").append("<a href='#' rel='"+key+"' titleColor='"+o.titleColor+"' icon='../.."+setIcon+"' type='"+o.type+"' titleBColor='"+o.titleBColor+"' iconShow='"+o.iconShow+"' >"+o.name+"</a>").append("<span class='ok'></span>");
			////--todo
			var	_m = $("#"+key); //模块div 
			if (_m.size()>0) {
				$li.find(".ok").show();
			}
			else {
				$li.find(".ok").hide();
			}
			
			return $li;
		},
		
		_createTd:function(clsName,text){//创建td
			var t = $("<td>").addClass(clsName);
			if(text!=undefined){
				t.text(text);
			}
			return  t; 
		},
		_addPanel:function(o){
			me.box.append(o);		
		},
		
		_bindCancel:function(obj){//添加模块
			obj.click(function(){
				location.reload();
			});
		
		},
		
		_bindEvent:function(){//事件绑定
			me._moduleLiClick();
			me._layoutAClick();
		},
		
		_moduleLiClick:function(){//绑定模块LI单击事件
			$("."+Jh.Config.ulCls+" li").on("click",function(){
				var _this = $(this),
					_mName = _this.find("a").attr("rel"),//获取模块名
					_m = $("#"+_mName), //模块div 
					_d = _this.find(".ok");//对号
				
				if (_m.size()<=0) {//判断是否已经存在，避免二次添加
					var	o = {},
						key  = _mName,	
						layout = "left",
						position ;
					
						o["name"] = _this.find("a").text();
						o["titleColor"] = _this.find("a").attr("titleColor");
						o["titleBColor"] = _this.find("a").attr("titleBColor");
						o["icon"] = _this.find("a").attr("icon");
						o["iconShow"] = _this.find("a").attr("iconShow");
						o["type"] = _this.find("a").attr("type");
						
					// me._ele.ul.append(me._createLi(key,name));//添加功能标签
					if (o["iconShow"]=="true"){
						Jh.Iconlink.createIconOne(key,o);
					}
					else {
						if(layout=='left'){
							position = $("#"+Jh.Layout.location.left);
						}else if(layout=='center'){
							position = $("#"+Jh.Layout.location.center);
						}else{
							position = $("#"+Jh.Layout.location.right);
						}
						position.append(Jh.Portal._createPortalOne(key,o));//添加portal							
						Jh.Portal._eventRefresh();//重新绑定刷新事件并触发
					}
				}
					
				if(_d.is(":visible")){//判断是否显示
					_d.hide();//隐藏对号
					//_m.hide();//隐藏模块
					_m.remove();
				}else{
					_d.show();//显示对号
					_m.show();//显示模块
				}
				//Jh.Util.refresh();
				
			});
		},
		
		_layoutAClick:function(){//绑定布局列表A 单击事件
			$("."+Jh.Config.layCls+" a").click(function(){
				var _this = $(this);
				var _v = _this.attr("rel");
				me._ToLayout(_v);
				_this.addClass("active").siblings().removeClass("active");
			});
		},
		
		_ToLayout:function(v){//刷新布局
			var CssMode= Jh.Layout.layoutCss, //布局模式  
				CssText= Jh.Layout.layoutText,//css 
				ModulesId= Jh.Layout.locationId, //模块id
				CssTextId=0,//默认css数组编号
				ModuleItems="";//模块数组
			$.each(CssMode, function(m, mn){
				if(v==mn) CssTextId=m;//css 赋值
			});	
	
			$.each(ModulesId, function(s, sn){	

				var currentModule = $(sn),				
					cssName = CssText[CssTextId],
					ary = cssName.split(/\s+/);//得到当前布局css数组
				switch(s){
					case "left": s =0;
					break;
					case "center": s =1;
					break;
					case "right":s = 2;
				}	
			});
	
		}
		
	};

}();

//swiper-carousel对象
Jh.Carousel = function(me){	
	var _template = {
			carousel : '<div class="swiper-container">'
				+ '<div class="swiper-wrapper"></div>'
				+ '<div class="swiper-pagination swiper-pagination-bullets"></div>'
				+ '</div>',
			carouselItem : '<div class="swiper-slide"><img src="{swiperPic}" style="width:100%"></div>'	
	};
	return me = {
		init : function(){
			var swiperPic = {
				    "001": {
				        "pic": obpmPhone.bar1//"resource/images/banner01.jpg"
				    },
				    "002": {
				        "pic": obpmPhone.bar2
				    },
				    "003": {
				        "pic": obpmPhone.bar3
				    }
				};
			
			$("#homeCont").prepend("<div id='carousel-box'></div>")
			me.create(swiperPic);
			
			if($("#carousel-box").find(".swiper-container").html()==""){
				$("#carousel-box").remove();
			}
			
			var carouselSwiper = new Swiper('#carousel-box>.swiper-container', {
				autoplay: 4000,
		        pagination: '.swiper-pagination',
		        paginationClickable: true
		    });
			
		},
		create : function(swiperPic){
			var $carouselPanel = $(_template.carousel);
			$("#carousel-box").append($carouselPanel)
			$.each(swiperPic,function(){
				me.createSwiperOne(this.pic)
			})
		},
		createSwiperOne : function(img){
			var swiperItem_html = Jh.Util.format(_template.carouselItem,{'swiperPic' : img});
			var $swiperItem_html = $(swiperItem_html);
			$("#carousel-box").find(".swiper-wrapper").append($swiperItem_html);
		}
	};
}();

//iconLink对象
Jh.Iconlink = function(me){	
	var _template = {

			iconLink : '<div class="iconLink" id="iconLink" style="margin-top:0px;"></div>',
			icon_p : '<div class="weui_grids icon_p" style="padding:0px;"></div>',
			icon_con : '<a class="weui_grid js_grid icon_con" data-id="button" id="{id}" _type="{type}">'
					+ '<div class="weui_grid_icon">{icon}</div>'
					+ '<p class="weui_grid_label" style="color:{titleColor};background-color:{titleBColor}">{name}</p>'
					+ '</a>',
			iconMorePanel : '<form class="weui_grids bd" id="iconMore"></form>',
			iconMoreBtn : '<a class="weui_grid js_grid" data-id="iconMore" id="icoMoreBtn">'
					+ '<div class="weui_grid_icon">...</div>'
					+ '<p class="weui_grid_label">更多</p>'
					+ '</a>',
	};
	return me = {
		init : function(iconLink){
			$("#homeCont").prepend("<div id='iconLink-box'></div>")
			me.create(iconLink);
			me.loadUrl();
			if($("#iconLink-box").find(".icon_p").html()==""){
				$("#iconLink-box").remove();
			}
			me.iconMoreNum();
			var iconPicHeight = $("#iconLink-box").find("span.icon_con").find("img").width();
			$("#iconLink-box").find("span.icon_con").find("img").height(iconPicHeight);
			$("#iconLink-box").find("a.btn").height(iconPicHeight+5);
			
			//临时修复页面默认#iconMore开始
			if(window.location.hash && window.location.hash.length > 1 && window.location.hash == "#iconMore"){
				var html = $("#tpl_iconMore").html();
	            var $html = $(html).addClass('slideIn').addClass("iconMore").css("z-index","1000");
	            $("body").append($html);
//	            location.hash = "#iconMore";
			}
            //临时修复页面默认#iconMore结束
			
		},
		iconMoreNum : function(){
			
			var $icoNumBox = $(".icon_p");
			var $icoNumList = $icoNumBox.find("a");
			var underIcoNum = '<a class="weui_grid js_grid">'
							+ '<div class="weui_grid_icon">&nbsp;</div>'
							+ '<p class="weui_grid_label">&nbsp;</p>'
							+ '</a>';
			
			if(Jh.Config._sysWidgetSet.system_workflow == "true"){
				//计算快速入口数量
				if($icoNumList.size() > 8){
					var $panel = $(_template.iconMorePanel);	//定义成更多页面对象
					$icoNumList.each(function(i){	//更多的widget icon移入更多页面中
						if(i >= 7){
							if(i == 7){
								var $moreBtn = $(_template.iconMoreBtn)
								$moreBtn.on("click",function(){
									var id = $(this).data('id');
						            ajaxPage.title[id] = document.title + "更多";
						            window.location.hash = "#"+id;
								});
								$(this).before($moreBtn);
							}
							$panel.append($(this));
						}
					});

					//处理好更多页面中的换行
					var $tplIconMore = $panel.find("a").size();	
					if($tplIconMore < 4){
						for(var j = 0; j < ( 4 - $tplIconMore ); j++){
							$panel.append($(underIcoNum));
						}
					}else{
						if($tplIconMore % 4 != 0){
							for(var j = 0; j < $tplIconMore % 4; j++){
								$panel.append($(underIcoNum));
							}
						}
					}
					
					$("body").append($panel);	//把更多页面直接插入到body下，隐藏
				}else{
					if($icoNumList.size()<4){
						for(var j=0; j<(4-$icoNumList.size()); j++){
							$(".icon_p").append($(underIcoNum));
						}
					}else{
						if($icoNumList.size()%4 != 0){
							for(var j=0; j<(8-$icoNumList.size()); j++){
								$(".icon_p").append($(underIcoNum));
							}
						}
					}
				}
				
				$("body").append($panel);	//把更多页面直接插入到body下，隐藏
			}else{
				if($icoNumList.size()<4){
					for(var j=0; j<(4-$icoNumList.size()); j++){
						$(".icon_p").append($(underIcoNum));
					}
				}else{
					if($icoNumList.size()%4 != 0){
						for(var j=0; j<(4-$icoNumList.size()%4); j++){
							$(".icon_p").append($(underIcoNum));
						}
					}
				}
			}
		},
		create : function(iconLink){	//插入body
			var $icon_p = $(_template.icon_p);
			var $iconLink = $(_template.iconLink).append($icon_p);
			$("#iconLink-box").append($iconLink);
			if(iconLink || iconLink!=undefined){
				$.each(iconLink,function(key,obj){
					me.createIconOne(key,obj);
				});
			}
		},
		
		createIconOne : function(key,obj){	//替换参数
			if(obj.type == 'report') return;	//报表不渲染
			var setIcon
			if(obj.icon == "" || obj.icon == "null"){
				setIcon = Jh.Util.setIcon(obj.type);
			}else{
				var iconJson = Jh.Util.setValueJson(obj.icon);
				if(iconJson.icontype == "font"){
					setIcon = "<i class='"+ iconJson.icon +"' style='color:" + iconJson.iconFontColor + "'></i>";
				}else{
					setIcon = "<img src=\"" + contextPath + iconJson.icon +"\" />";
				}
			}
			var con_html = Jh.Util.format(_template.icon_con,{'name' : obj.name});
				con_html = Jh.Util.format(con_html,{'icon' : setIcon});
				con_html = Jh.Util.format(con_html,{'titleColor' : obj.titleColor});
				con_html = Jh.Util.format(con_html,{'titleBColor' : obj.titleBColor});
				con_html = Jh.Util.format(con_html,{'id' : key});
				con_html = Jh.Util.format(con_html,{'type' : obj.type});
				
			var $con_html = $(con_html);
				if(obj.actionContent){
					$con_html.attr("_actionContent",obj.actionContent);
				}
			$("#iconLink-box").find(".icon_p").append($con_html);
		},
		loadUrl : function(){	//加载url并设置
			$("#iconLink .icon_con").bind("click",function(){
            	me.openIconUrl($(this));
			});	
		},
		openIconUrl : function($con){
			switch ($con.attr("_type")) {
			case "link":
				var $temp = $("<div></div>");
				var _url = "../widget/displayWidget.action?id="+$con.attr("id");
				
				$temp.appendTo($con);
				$temp.load(_url,function(){
					$cur = $(this);
					var _href = $cur.find("a").attr("href");
					$cur.parent().attr("_href",_href);
					$cur.parent().click(function(){
						window.location.href = _href;
					});
					$cur.remove();						
				});
				break;
			case "view":
				var _href = "../../portal/dynaform/view/displayViewWithPermission.action?_viewid="
					+ $con.attr("_actionContent") + "&clearTemp=true&_backURL=../../../portal/cool/closeTab.jsp";
				ajaxPage.getToViewHash(_href);	//获取url拼接路由hash
				break;
			case "customizeReport":
				var id = $con.attr("_actioncontent");	//formid
				var url = contextPath+"/portal/phone/dynaform/report/oReport.jsp?id="+id;
				ajaxPage.getToOReportHash(url);
				break;
			case "page":
				var url = $con.attr("_actionContent");
				var type = ajaxPage.judgeType(url);
				switch(type){
				case "form":
					ajaxPage.useFormAction(url);	//获取url拼接路由hash
					break;
				case "view":
					ajaxPage.getToViewHash(url);
					break;
				}
				break;
			default:
				break;
			}
		}
		
	};
}();

Jh.Portal = function(me){//Portal对象
	
	var portalDiv = "<div id='home_link'></div>",
		_template = {//模板
			l :"<div id='"+Jh.Layout.location.left+"' class='"+Jh.Config._groupWrapperClass+"'/>",
			m :"<div id='"+Jh.Layout.location.center+"' class='"+Jh.Config._groupWrapperClass+"'/>",
			r :"<div id='"+Jh.Layout.location.right+"' class='"+Jh.Config._groupWrapperClass+"'/>",
			portalWrapBox : "<div id='{key}' class='home-widget-box widget-tab' _type='{type}'></div>",
			portalWrap : "<div class='card_app home_link'><div class='table' style='padding:0px'><ul class='home-list'></ul></div></div>",
			itemHeader : "<li id='{key}' class='home' _type='{type}'><i class='icon iconfont'>&#xe60a;</i><span>{name}</span>"
						+ "<span class='icon icon-right-nav imgS' style='color:#bcbcbc'></span>" 
						+ "<span class='pendingTotal'></span></li>"
	};

	var _defaultCfg, _userCfg, _sysWidgetCfg;
	return me={	
		init:function(userCfg, defaultCfg, sysWidgetCfg){//初始化
			if(userCfg && userCfg!=undefined){
				_userCfg = eval("("+Jh.Util.setUserWidget(userCfg, defaultCfg)+")");
			}else{
				_userCfg = defaultCfg
			}
			_defaultCfg = defaultCfg;
			_sysWidgetCfg = sysWidgetCfg;//系统widget设置
			//初始化Portal
			me.box = $(portalDiv);
			$("#homeCont").append(me.box);	
			me._elements = {};		
			me._createModulesWrap();
			me._bindData(_userCfg, _sysWidgetCfg);
			Jh.Iconlink.init(_userCfg.appIcon);	//初始化图标链接--必须在最后,不好看 要优化
			
			if(_sysWidgetCfg.Banner == "true"){
				Jh.Carousel.init();
			}
			
			if(_sysWidgetCfg.menuIcon == "true"){
				$(".phone-main-nav-trigger").show();
			} else {
				$(".phone-main-nav-trigger").hide();
			}
			if(($("#homePage #iconLink-box").size() <= 0) && (_sysWidgetCfg.Banner == "false") && (Jh.Config._sysWidgetSet.system_workflow == "false")){
				$("#homePage").append("<div class='contentIsNull'></div>")
			} 
		},
		_isFnExist:function(widgetId){//判断是否WidgetKey存在
			var flag = false;
			$.each(_defaultCfg.appL, function(k, o){
				if (widgetId == k) {
					flag = true;
					return;
				}
			});
			$.each(_defaultCfg.appM, function(k, o){
				if (widgetId == k) {
					flag = true;
					return;
				}
			});
			$.each(_defaultCfg.appR, function(k, o){
				if (widgetId == k) {
					flag = true;
					return;
				}
			});
			return flag;
		},


		_bindData:function(op, sysWidgetCfg){//绑定数据
			$.each(op,function(key,item){				
				me._createPortal(key,item,sysWidgetCfg);
			});
		},
		
		_createModulesWrap:function(){//创建模块外层容器
			me._elements.m_l = $(_template.l);
			me._elements.m_m = $(_template.m);
			me._elements.m_r = $(_template.r);
			me._addPanel(me._elements.m_l);
			me._addPanel(me._elements.m_m);
			me._addPanel(me._elements.m_r);
		},
		
		_addPanel:function(o){//往容器里添加
			me.box.append(o);
		},
		
		_createPortal:function(key,item,sysWidgetCfg){//创建portal
			var mWrap ;
			switch(key){
			   case "appL":mWrap = me._elements.m_l;
				break;
			   case "appM":mWrap = me._elements.m_m;
				break;
			   case "appR":mWrap = me._elements.m_r;
				break;
			}
			if (key!="layoutStyle"){//添加内容部分,即：非layoutStyle
				$.each(item,function(k,o){
					if(k == "system_workflow"){
						if(sysWidgetCfg.system_workflow == "true"){
							if (me._isFnExist(k)){
								mWrap.append(me._createPortalOne(k,o));
								me._createContent(k,o);
							}
						}
					}else{
						if (me._isFnExist(k)){
							mWrap.append(me._createPortalOne(k,o));
							me._createContent(k,o);
						}	
					}
				});
			}
		},
		
		_createPortalOne:function(key,o){//创建单个portal item
			
			portalWrapBox = Jh.Util.format(_template.portalWrapBox,{"key":key});
			portalWrapBox = $(Jh.Util.format(portalWrapBox,{"type":o.type}));

			return portalWrapBox;
		},
		
		
		
		_createDiv:function(classname){
			var _div = $("<div/>").addClass(classname);
			return _div;
		},
		
		_createContent:function(key,o){
			var $me = $("#"+key);
			var name = o.name;
			var refreshUrl = "../widget/displayWidget.action?id="+$me.attr("id")+"&widgetTitle=" + name +"&appid=" + appId;
			$me.load(refreshUrl, function(data){
				var $content = $(this);
				switch($content.attr("_type")) {
					//case "summary":
					//	me._renderSummary($content);
					//break;
					case "view":
						me._renderView($content);
					break;
					//case "link":
					//	me._renderLink($content);
					//break;
					//case "extlink":
					//	me._renderExtLink($content);
					//break;
					//case "announcement":
					//	me._renderAnnouncement($content);
					//break;
					case "system_workflow":
						me._renderWorkflow($content);
					break;
					//case "weather":
					//	me._renderWeather($content);
					//break;
					case "customizeReport":
						me._renderCustomizeReport($content);
					break;
					default:
						//$content.remove();
					break;
				};
			});
		},
		_renderCustomizeReport:function($me){
			setTimeout(function(){
			  var cid = $me.find(".widgetId").attr("cid");
			  var echartId = $me.find(".widgetId").attr("id");
		      //var contextPath = '<%=request.getContextPath()%>';
		      //var name = '<%=name%>';
		      $.ajax({
				  //type: "POST",
				  url: contextPath+'/portal/widget/getCustomizeReportData.action',
				  data:{id:cid},
				  success: function(datae){
					  if(datae != ""){
					  var datas = JSON.parse(datae);
					  var myChart = echarts.init(document.getElementById(echartId));
					  if("pie"==datas.sign){	//馅饼图
					  	var legendArr = [];
			            $.each(datas.data, function(i,obj){ 
			            	legendArr.push(obj.name);
			            	}); 
			            myChart.setOption({
			                legend: {
			                    data:legendArr
			                },
			                tooltip : {
			                    trigger: 'item',
			                    formatter: "{a} <br/>{b} : {c} ({d}%)"
			                },
			                calculable : true,
			                series : [
			                    {
			                        type:'pie',
			                        radius : '55%',
			                        center: ['50%', '55%'],
			                        data:datas.data
			                    }
			                ]
			            });
					  }
				  
				  if("scatter"==datas.sign){	//散点图
			            myChart.setOption({
			                tooltip : {
			                    trigger: 'axis'
			                },
			                grid:{
			                	x:25,
			                	y:25,
			                	x2:15,
			                	y2:22,
			                	left:'2%',
						    	right: '2%',
						    	containLabel: true
						    },
			                calculable : true,
			                xAxis : [
			                    {
			                    	type : 'value',
			                    	splitLine: {
			                            show: true,
			                            lineStyle: {
			                                color: '#455061'
			                            }
			                        },
			                        axisLine: {
			                            lineStyle: {
			                                color: '#4C4C4C'
			                            }
			                        }
			                    }
			                ],
			                yAxis : [
			                    {
			                        type : 'value',
			                        splitLine: {
			                            show: true,
			                            lineStyle: {
			                                color: '#455061'
			                            }
			                        },
			                        axisLine: {
			                            lineStyle: {
			                                color: '#4C4C4C'
			                            }
			                        }
			                    }
			                ],
			                series : [
			                    {
			                        type:'scatter',
			                        data:datas.data
			                    }
			                ]
			            });
					  }
				  
				  if("area"==datas.sign){	//面积图
			            myChart.setOption({
			                tooltip : {
			                    trigger: 'axis'
			                },
			                grid:{
			                	x:25,
			                	y:25,
			                	x2:15,
			                	y2:22,
			                	left:'2%',
						    	right: '2%',
						    	containLabel: true
						    },
			                calculable : true,
			                xAxis : [
			                    {
			                        type : 'category',
			                        boundaryGap : false,
			                        data : datas.xAxis
			                    }
			                ],
			                yAxis : [
			                    {
			                        type : 'value',
			                    }
			                ],
			                series : [
			                    {
			                        type:'line',
			                        smooth:true,
			                        itemStyle: {normal: {areaStyle: {type: 'default'}}},
			                        data:datas.yAxis
			                    }
			                ]
			            });
					  }
				  
				  if("line"==datas.sign){	//折线图
			            myChart.setOption({
			                tooltip : {
			                    trigger: 'axis'
			                },
			                grid:{
			                	x:25,
			                	y:25,
			                	x2:15,
			                	y2:22,
			                	left:'2%',
						    	right: '5%',
						    	containLabel: true
						    },
			                calculable : true,
			                xAxis : [
			                    {
			                        type : 'category',
			                        boundaryGap : false,
			                        data : datas.xAxis
			                    }
			                ],
			                yAxis : [
			                    {
			                        type : 'value',
			                    }
			                ],
			                series : [
			                    {
			                        type:'line',
			                        data:datas.yAxis
			                    }
			                ]
			            });
					  }
				  
				  if("bar"==datas.sign){	//条形图
			            myChart.setOption({
			                tooltip : {
			                    trigger: 'axis'
			                },
			                grid:{
						    	x:40,
						    	y:25,
						    	x2:10,
						    	y2:22,
						    	left:'2%',
						    	right: '2%',
						    	containLabel: true
						    },
			                calculable : true,
			                xAxis : [
			                    {
			                        type : 'value',
			                        boundaryGap : [0, 0.01]
			                    }
			                ],
			                yAxis : [
			                    {
			                        type : 'category',
			                        data : datas.xAxis
			                    }
			                ],
			                series : [
			                    {
			                        type:'bar',
			                        barCategoryGap: '60%',
						            itemStyle: {
						                normal: {
						                    color: 'tomato',
						                    barBorderColor: 'tomato',
						                    barBorderWidth: 0,
						                    barBorderRadius:4,
						                    label : {
						                        show: true, position: 'insideLeft'
						                    }
						                }
						            },
			                        data:datas.yAxis
			                    }
			                ]
			            });
					  }
				  
				  if("histogram"==datas.sign){	//柱状图
					  myChart.setOption({
					    tooltip : {
					        trigger: 'axis'
					    },
					    grid:{
					    	x:25,
					    	y:25,
					    	x2:15,
					    	y2:22,
					    	left:'2%',
					    	right: '2%',
					    	containLabel: true
					    },
					    calculable : true,
					    xAxis : [
					        {
					            type : 'category',
					            axisLine: {
		                            lineStyle: {
		                                color: '#4C4C4C'
		                            }
		                        },
					            data : datas.xAxis
					        }
					    ],
					    yAxis : [
					        {
					            type : 'value',
					            axisLine: {
		                            lineStyle: {
		                                color: '#4C4C4C'
		                            }
		                        }
					        }
					    ],
					    series : [
					        {
					            type:'bar',
					            barCategoryGap: '60%',
					            itemStyle: {
					                normal: {
					                    color: 'tomato',
					                    barBorderColor: 'tomato',
					                    barBorderWidth: 6,
					                    barBorderRadius:0,
					                    label : {
					                        show: true, position: 'insideTop'
					                    }
					                }
					            },
					            data:datas.yAxis
					        }
					    ]
					  })
				  }
				}
		      }
		  })},10)
		},
		
		_renderView:function($me) {	//渲染视图
			var refreshId = $me.closest("div.groupItem").addClass("widget-view").attr("id");
			var urlTemplate = "../dynaform/document/view.action?_formid={formid}&_docid={docid}&application={appid}";
			var applicationId = $me.find("section").attr("_applicationId");
			var viewId = $me.find("section").attr("_viewid");
			var $table = $me.find("table");
			var column_no = 1;
			
			var userAgent = window.navigator.userAgent.toLowerCase();
			$table.css("display","table").css("width","100%");
//			if (userAgent.indexOf('msie')<=0) {
//				$table.find("tr.header").css("font-size","15");
//			}
			
			//处理Column属性所应该有的相关表现
			$table.find("td").each(function(){
				var $td = $(this);
				if ($td.attr("isshowtitle")!="true") {
					$td.removeAttr("title");
				}
				//列宽
				if($td.attr("colwidth") && $td.attr("colwidth") != ""){
					$td.width($td.attr("colwidth"));
				}
				//字体大小
				if($td.attr("colColor") && $td.attr("colColor") != ""){
					$td.css("color",$td.attr("colColor"));
				}
				//字体颜色
				if($td.attr("colFontSize") && $td.attr("colFontSize") != ""){
					$td.css("font-size",$td.attr("colFontSize")+"px");
				}
			});

//			$table.find("tr.header>td").css("font-weight","bold");
			
			$table.find("tr").each(function(){
				var url = "", $tr = $(this), docid, formid,viewTemplateForm;
				$tr.children().each(function(index){
					var $td = $(this);	
					if($td.attr("ishiddencolumn") == "true" || $td.attr("ishidden") == "true" || $td.attr("isvisible") == "false"){
						$td.hide();
						$table.find("tr:gt(0)").each(function(){
							$(this).find(" td:eq("+index+")").attr("isHidden", $td.attr("isHiddenColumn"));
						});
					}
					//渲染状态标签数据
					if($tr.attr("trtype") == "dataTr"){
						
						if($td.attr("colFieldName") == "$StateLabel"){
							var $tdHtml=jQuery(this);
							var divtype=$tdHtml.children("div[name=result]");
							var divhtml=divtype.html();
							if(divhtml.indexOf("[")>=0){
								var divdata = JSON.parse(divhtml.substring(1,divhtml.length-1));
								var objdata = eval(divdata.nodes);
								var stateLabel = ""
								for(var i=0;i<objdata.length;i++){  
									stateLabel = objdata[i].stateLabel;   
								}
								divtype.empty().append(stateLabel);
							}
							
							return $tdHtml;
						}
						if($td.attr("colFieldName") == "$PrevAuditNode"){
							var $tdHtml=jQuery(this);
							var divtype=$tdHtml.children("div[name=result]");
							var divhtml=divtype.html();
							if(divhtml.indexOf("[")>=0){
								var divdata = JSON.parse(divhtml);
								var prevAuditNode = ""
								for(var i=0;i<divdata.length;i++){  
									prevAuditNode += divdata[i].prevAuditNode+",";
								}
								if(prevAuditNode.length>0){
									prevAuditNode = prevAuditNode.substring(0,prevAuditNode.length-1);
								}
								divtype.empty().append(prevAuditNode);
								$tdHtml.find("div[name='result']").text(prevAuditNode);
							}
							return $tdHtml;
						}
						if($td.attr("colFieldName") == "$PrevAuditUser"){
							var $tdHtml=jQuery(this);
							var divtype=$tdHtml.children("div[name=result]");
							var divhtml=divtype.html();
							if(divhtml.indexOf("[")>=0){
								var divdata = JSON.parse(divhtml);
								var prevAuditUser = ""
								for(var i=0;i<divdata.length;i++){  
									prevAuditUser += divdata[i].prevAuditUser+",";
								}
								if(prevAuditUser.length>0){
									prevAuditUser = prevAuditUser.substring(0,prevAuditUser.length-1);
								}
								divtype.empty().append(prevAuditUser);
								$tdHtml.find("div[name='result']").text(prevAuditUser);
							}
							
							return $tdHtml;
						}
						if("COLUMN_TYPE_ROWNUM"==$td.attr("colType")){
							var $tdHtml=$(this); 
							$tdHtml.find("div[name='result']").text(column_no);
							column_no++;
							return $tdHtml;
						}
						//渲染word控件数据
						if("genericwordfield" == $td.attr("fieldtype") || "wordfield" == $td.attr("fieldtype")){
							var $tdHtml=$(this); 
							var _result = $tdHtml.find("div[name='result']").html();
							if(_result && _result != "" && _result != " "){
								var aHtml = "";
								var resultObj = JSON.parse(_result);
								aHtml = "<img class='genericword' src='../share/images/view/genericword.jpg' "+
												"data-title='"+$td.showword+"' "+
												"data-fileName='"+resultObj.filename+"' "+
												"data-path='"+resultObj.path+"' "+
												"data-type='"+resultObj.type+"' "+
												"data-colFieldName='"+$td.colFieldName+"'/>";
								$tdHtml.find("div[name='result']").html(aHtml);
								return $tdHtml;
							}
						}
						//渲染在线拍照控件数据
						if("onlinetakephoto" == $td.attr("fieldtype")){
							var $tdHtml=$(this); 
							var _result = $tdHtml.find("div[name='result']").html();
							var divHtml = '<div name="result">';
							var aHtml = "";
							if(_result && _result != "" && _result != " "){
								var _url = $(_result).attr("url").replace(/\\'/g,"");
								aHtml = "<div class='images-preview' data-src='"+_url+"' style='display: inline-block;margin:3px;'>" +
										"<img style='max-height:50px;max-width:50px;' src='"+_url+"' />" +
										"</div>";
								divHtml += aHtml;
								
							}
							divHtml += '</div>';
							$tdHtml.html(divHtml);
							return $tdHtml;
						}
						//渲染录音控件数据
						if("weixinrecordfield" == $td.attr("fieldtype")){
							var $tdHtml=$(this); 
							var _result = $tdHtml.find("div[name='result']").html();
							if(_result && _result != "" && _result != " "){
								var aHtml = "";
								aHtml+='<div class="weixin_record">';
								aHtml+= '<img src="../share/images/view/voice.png" width="21px"/>';
								aHtml+='</div>';
								$tdHtml.find("div[name='result']").html(aHtml);
								return $tdHtml;
							}
						}
						//渲染微信GPS控件
						if("weixingpsfield" == $td.attr("fieldtype")){
							var $tdHtml=$(this); 
							var _result = $tdHtml.find("div[name='result']").html();
							if(_result && _result != "" && _result != " "){
								var aHtml = "";
								var location = JSON.parse(_result);
								aHtml+='<div class="gps_col">';
								if($td.showType=="00"){//真实值
									aHtml+='<a href="#" class="gps_col_link" data-location=\''+result+'\'>';
									aHtml+='<span class="gps_col_text">'+location.address+'</span>';
									aHtml+='</a>';
								}else{//显示值
									aHtml+='<span class="gps_col_text">'+location.address+'</span>';
								}
								aHtml+='</div>';
								$tdHtml.find("div[name='result']").html(aHtml);
								return $tdHtml;
							}
						}
						//渲染图片上传控件数据
						if("imageupload" == $td.attr("fieldtype")){
							var $tdHtml=$(this); 
							var _result = $tdHtml.find("div[name='result']").html();
							if(_result && _result != "" && _result != " "){
								var aHtml = "";
								var _images = JSON.parse(_result);
								for(var i = 0; i < _images.length; i++){
									var _url = contextPath + _images[i].path;
									var _picHtml = "<div class='images-preview' data-src='"+_url+"' style='display: inline-block;margin:3px;'>" +
											"<img style='max-height:50px;max-width:50px;' src='"+_url+"' />" +
											"</div>";
									aHtml += _picHtml;
								}
								$tdHtml.find("div[name='result']").html(aHtml);
								return $tdHtml;
							}
						}
						
						//渲染文件控件数据
						if("attachmentupload" == $td.attr("fieldtype")){
							var $tdHtml=$(this); 
							var _result = $tdHtml.find("div[name='result']").html();
							if(_result && _result != "" && _result != " "){
								var aHtml = "";
								var _images = JSON.parse(_result);
								for(var i = 0; i < _images.length; i++){
									var _name = _images[i].name;
									var url = encodeURI(contextPath + "/portal/dynaform/document/fileDownload.action?filename="+ encodeURI(_name) + "&filepath=" + _images[i].path);
									var _picHtml = "<a href='" + url + "' target='_about'>" + _name + "</a>";
									aHtml += _picHtml;
								}
								$tdHtml.find("div[name='result']").html(aHtml);
								return $tdHtml;
							}
						}
						
						//视图列样式
						//1.截断字符串
						if($td.attr("coldisplaylength") && $td.attr("coldisplaylength") > 0 ){
							var $tdHtml=$(this); 
							var _result = $tdHtml.find("div[name='result']").html();
							if(_result.length > $td.attr("coldisplaylength")){
								_result = _result.substring(0,$td.attr("coldisplaylength"))+"...";
							}
							$tdHtml.find("div[name='result']").html(_result);
						}
						//2.列图标
						if($td.attr("showicon")  && $td.attr("showicon").length  > 0 ){
							var $tdHtml=$(this); 
							var icon =  "<img style='' src='../../lib/icon/" + $td.attr("showicon") + "'/>";
							$tdHtml.find("div[name='result']").html(icon);
						}
						
					}
					//渲染地图控件数据
					if($td.attr("fieldinstanceofmapfield") == "true"){
						var convert2HTMLEncode = function(str){
							var s = str;
							if("COLUMN_TYPE_FIELD" == $td.attr("colType") && !$td.attr("colFieldName").substr(0,1) == "$" && !$td.attr("colFlowReturnCss")){
								s = s.replace(new RegExp(">","gm"),"&gt;");
								s = s.replace(new RegExp("<","gm"),"&lt;");
							}
							return s;
						};
						var $tdHtml=jQuery(this);
						var divtype=$tdHtml.children("div[name=result]");
						var application = jQuery("body",parent.document).find("#application").val();
						var fieldVal = "";
						var displayType = 1;
						var docId = $tdHtml.attr('docId');
						docId = docId?docId:'';
						var f_id = docId + "_" + $td.attr("colFieldName");
						var valhtml = convert2HTMLEncode($td.attr("title")) == " "?"":"value = '" + convert2HTMLEncode($td.attr("title")) + "'";
						var btnHtml = "<input type='hidden' id = '" + f_id + "' " + valhtml + ">";
						btnHtml += "<img src='../../portal/share/images/view/map.png' style='margin: 0 5px;'";
						btnHtml += " onclick=\"FormBaiduMap('";
						btnHtml += f_id + "', '";
						btnHtml += application + "', '";
						btnHtml += displayType + "')\"";
						btnHtml +="/>";
						divtype.empty().append(btnHtml);
						return $tdHtml;
					}
					
				});
				
				$tr.addClass("widgetItem").find("td").each(function(){
					if (url == "") {
						var $td = $(this);
						
						formid = $td.attr("docformid");
						viewTemplateForm = $td.attr("viewTemplateForm");
						docid = $td.attr("docid");
						
						if (formid && docid && applicationId) {
							url = urlTemplate.replace(/\{formid\}/g,formid).replace(/\{docid\}/g, docid).replace(/\{appid\}/g,applicationId);
							if(viewTemplateForm){
								url+= "&_templateForm="+viewTemplateForm;
							}
							url += "&?refreshId="+refreshId;
						}
						
					}
				});
				if (url != "") {
					$tr.find(">td[isreadonly!='true']").click(function(e){
						if(e.target && $(e.target).attr("name")=="result"){//阻止冒泡事件触发打开新页签的行为
							var title = $(this).parent().find("td > div").first().text();
							ajaxPage.useFormAction(url);	//获取url拼接路由hash
						} 
						else if (e.target && $(e.target).closest("div[name=result]").length > 0 ){
							var title = $(this).parent().find("td > div").first().text();
							ajaxPage.useFormAction(url);	//获取url拼接路由hash
						}
						else if (e.target && $(e.target).is("a")){
							url = $(e.target).attr("href");
							$(e.target).attr("href");
							if (url!="" && url!="#") {
								ajaxPage.useFormAction(url);	//获取url拼接路由hash
							}
							return false;
						} 
						else{
							return false;
						}
					});
				}
			});

			//超过5条数据时显示更多
			if($table.find("tr").size()>5){
				var $a = $("<div class='bottom-menu text-center'><a class='btn'>更多»</a></div>").bind("click",function(){
					var url = "../dynaform/view/displayView.action?_viewid="+viewId+"&application="+applicationId;
					ajaxPage.getToViewHash(url);
				}).insertAfter($table.parent());
			}
			if($table.find("tr").size()==1){
				var $null = $("<p class='zhanwei'>当前没有数据<span>。。。</span><img src='../H5/resource/homepage/images/null.png' class='animated'/></p>");
				$null.insertAfter($table);
				$(".zhanwei img").animate({left: '0px'}, "slow");
			}
			var h = $me.attr("_height");
			if (h && h!='') {
//				$me.height(h);
			}
			
		},
		
		_renderWorkflow:function($me){//流程处理
			$me.addClass("card_app widget-tab");
			var _template = {
					tabPanel : '<div class="itemContent"><div class="widget-workflow-container" role="tabpanel"></div></div>',
					tabUl : '<ul class="nav nav-tabs swiper-wrapper" role="tablist"></ul>',
					tabNav : '<li role="presentation" class="widget-workflow-slide">'
					+'<a aria-controls="pending">我的待办 <span class="flowNum">(0)</span></a>'
					+'</li><li role="presentation" class="widget-workflow-slide">'
					+'<a aria-controls="processing">经办跟踪 <span class="flowNum">(0)</span></a>'
					+'</li>',
					tabConBox : '<div class="tab-content" style="padding-bottom: 50px;">'
					+'<div role="tabpanel" class="tab-pane" id="sysFlowTab_pending">'
					+'<ul style="padding:10px;margin:0px;"></ul><div class="bottom-menu text-right"><a class="btn btn-default" role="button" style="display:none">更多&raquo;</a></div></div>'
					+'<div role="tabpanel" class="tab-pane" id="sysFlowTab_processing">'
					+'<ul style="padding:10px;margin:0px;"></ul><div class="bottom-menu text-right"><a class="btn btn-default" role="button" style="display:none">更多&raquo;</a></div></div></div>',
					tabLi : '<li class="widgetItem" id="{tabDocID}" _url="{tabUrl}" _isRead ="{tabIsRead}">'
						+ '<div class="tabLiFace">{tabAvatar}'
						+ '<span class="{tabIsReadClass}"></span>'
						+ '</div>'
						+ '<div class="tabLiCon">'
						+ '<div class="tabLiConBox">'
						+ '<div class="tabLiConA text-left">'
						+ '<span class="tabLiCon-text">[{tabName}] {tabCon}</span>'
						+ '</div>'
						+ '<div class="tabLiConB"><div class="tabLiTagLeft">'
						+ '<span class="tabLiCon-auditornames" _initiator="{tabInitiator}" _initiatorId="{tabInitiatorID}">{tabDept}{tabInitiator}</span>'
						+ '<span class="tabLiCon-lastprocesstime timeago" title="{tabTime}">{tabTime}</span>'
						+ '</div>'
						+ '<div class="tabLiTagRight text-right">'
						+ '<span class="tabLiCon-status" title="{tabState}">{tabState}</span>'
						+ '</div>'
						+ '</div>'
						+ '</li>',
					tabSpacePending : '<div id="content-load-panel"><div id="content-space" class="text-center">'
						+ '<div class="content-space-icon icon iconfont">&#xe61b;</div>'
						+ '<div class="content-space-h1">当前没有任何待办</div>'
						+ '<div class="content-space-h2">可发起的待办将显示在这里</div></div></div>',
					tabSpaceProcessing : '<div id="content-load-panel"><div id="content-space" class="text-center">'
						+ '<div class="content-space-icon icon iconfont">&#xe618;</div>'
						+ '<div class="content-space-h1">当前没有任何内容</div>'
						+ '<div class="content-space-h2">可发起的申请将显示在这里</div></div></div>'
			};
			$me.append(_template.tabPanel);
			$me.find(".widget-workflow-container").append(_template.tabUl);
			$me.find(".widget-workflow-container").append(_template.tabConBox);
			$me.find(".nav-tabs").append(_template.tabNav);
			
			
			var $pendingList = $me.find("input[name='pendingList']");
			var $processedList = $me.find("input[name='processedList']");
			var _pendappId = $pendingList.attr("_appId");
			var _processedappId = $processedList.attr("_appId");
			var $accordionPending = $("<div class='panel-group' id='accordion-pending'></div>");
			var $accordionProcessing = $("<div class='panel-group' id='accordion-processing'></div>");
			$me.append($accordionPending);
			$me.append($accordionProcessing);
			
			var $sysFlowTab_pending = $(".widget-tab").find("#sysFlowTab_pending");
			if($sysFlowTab_pending.find("#content-load-panel").size() == 0){
				$sysFlowTab_pending.prepend(_template.tabSpacePending);
			}

			var $sysFlowTab_processing = $(".widget-tab").find("#sysFlowTab_processing");
			if($sysFlowTab_processing.find("#content-load-panel").size() == 0){
				$sysFlowTab_processing.prepend(_template.tabSpaceProcessing);
			}
			
			setTimeout(function(){
//			$pendingList.each(function(){
				$accordionPending.load($pendingList.attr("_url"), function(response,status) {
					var $accorPend = $("#accordion-pending");
					var pendingLi = "";
					if(status=="success"){
						var $lis = $accorPend.find("li");
						var count= $lis.size();
						if(count != 0){
							if(count > 9){
								count = "9+";
							}
							$(".nav-tabs").find("a[aria-controls='pending']>.flowNum").text("("+ count +")");	//设置总数
						}
						$lis.each(function(i){
							var $li = $(this);
							var _flowname = $li.attr("_flowname");
							var _url = $li.attr("_url");
							var _tabDocID = $li.attr("_docid");
							var _initiator = $li.attr("_initiator");
							var _initiatorID = $li.attr("_initiatorId");
							var _initiatorDept = $li.attr("_initiatorDept");
							var _time = $li.attr("_lastprocesstime");
							var _isRead = $li.attr("_isRead");
							
							if( i < 5 ){
								var flowTime = new Date(_time);
								var timeFixArr = _time.split(/[- :]/); 
								var timeFixDate = new Date(timeFixArr[0], timeFixArr[1]-1, timeFixArr[2], timeFixArr[3], timeFixArr[4]);
								var _timeAgo,_avatar;
								var avatar = Common.Util.getAvatar(_initiatorID);
								var Month = timeFixDate.getMonth() + 1; 
								var Day = timeFixDate.getDate(); 
								var Hour = timeFixDate.getHours(); 
								var Minute = timeFixDate.getMinutes(); 
							
								if(avatar!="" && avatar!=undefined){
									_avatar = "<img class='lazy' data-original='"+avatar+"'/>";
								}else{
									_avatar = "<div class='noAvatar'>"+ _initiator.substr(_initiator.length-2, 2) +"</div>";
								}
								
								//比较时间 serviceTime定义在main.jsp
				 				var comTime = Common.Util.daysCalc(_time,serviceTime);

								if(comTime.days > 2){
									if (Month >= 10){ 
										_timeAgo = Month + "-"; 
									}else{ 
										_timeAgo = "0" + Month + "-"; 
									} 
									if (Day >= 10) 
									{ 
										_timeAgo += Day + " "; 
									}else{ 
										_timeAgo += "0" + Day; 
									} 
								}else if(comTime.days == 2){ 
									_timeAgo = "前天 ";
									if (Hour >= 10) 
									{ 
										_timeAgo += Hour + ":" ; 
									}else{ 
										_timeAgo += "0" + Hour + ":" ; 
									} 
									if (Minute >= 10) 
									{ 
										_timeAgo += Minute ; 
									}else{ 
										_timeAgo += "0" + Minute ; 
									} 
								}else if(comTime.days == 1){
									_timeAgo = "昨天 ";
									if (Hour >= 10) 
									{ 
										_timeAgo += Hour + ":" ; 
									}else{ 
										_timeAgo += "0" + Hour + ":" ; 
									} 
									if (Minute >= 10) 
									{ 
										_timeAgo += Minute ; 
									}else{ 
										_timeAgo += "0" + Minute ; 
									} 
								}else if(comTime.days <= 0 && comTime.hours > 0){
									_timeAgo = comTime.hours + " 小时前 ";
								}else if(comTime.days <= 0 && comTime.hours <= 0){
									if(comTime.minutes < 5){
										_timeAgo = " 刚刚";
									}else{
										_timeAgo = comTime.minutes + " 分钟前 ";
									}
								}
								
								var _stateLabel = $li.attr("_stateLabel");
								var $pendingBox = $(".tab-content").find("#sysFlowTab_pending>ul");
								var tabLi = Jh.Util.format(_template.tabLi , {'tabID' : _flowname});
								tabLi = Jh.Util.format(tabLi , {'tabCon' : $li.text()});
								tabLi = Jh.Util.format(tabLi , {'tabUrl' : _url});
								tabLi = Jh.Util.format(tabLi , {'tabName' : _flowname});
								tabLi = Jh.Util.format(tabLi , {'tabTime' : _timeAgo});
								tabLi = Jh.Util.format(tabLi , {'tabDocID' : _tabDocID});
								tabLi = Jh.Util.format(tabLi , {'tabIsRead' : _isRead});
								if(_isRead == "false"){
									tabLi = Jh.Util.format(tabLi , {'tabIsReadClass' : 'noread'});
								}else{
									tabLi = Jh.Util.format(tabLi , {'tabIsReadClass' : 'isread'});
								}
								tabLi = Jh.Util.format(tabLi , {'tabIsReadClass' : _isRead});
								tabLi = Jh.Util.format(tabLi , {'tabIsReadText' : _isRead});
								tabLi = Jh.Util.format(tabLi , {'tabInitiator' : _initiator});
								tabLi = Jh.Util.format(tabLi , {'tabInitiatorID' : _initiatorID});
								tabLi = Jh.Util.format(tabLi , {'tabAvatar' : _avatar});
								tabLi = Jh.Util.format(tabLi , {'tabDept' : _initiatorDept});
								tabLi = Jh.Util.format(tabLi , {'tabState' : _stateLabel});
							//if( i < 5 ){
								pendingLi += tabLi;	
							}else{
								$("#sysFlowTab_pending").find(".btn").show();
							};
							
							$li.remove();
						});
						
						if($(".nav-tabs").find("a[aria-controls='pending']>.flowNum").text()=="(0)"){
							$(".nav-tabs").find("a[aria-controls='pending']>.flowNum").css("display","none");
							$(".widget-tab").find("#sysFlowTab_pending>#content-load-panel").css("display","block");
						}else{
							$(".nav-tabs").find("a[aria-controls='pending']>.flowNum").css("display","inline-block");
							$(".widget-tab").find("#sysFlowTab_pending>#content-load-panel").css("display","none");
						}
						
						$(".widget-tab").find("#sysFlowTab_pending>ul").append(pendingLi)
						$(".widget-tab").find("#sysFlowTab_pending li.widgetItem").unbind().bind("click",function(){
							var $this = $(this);
							$this.find("span.noread").removeClass("noread").addClass("isread");		//仅待办
							var _href = $this.attr("_url");
							ajaxPage.useFormAction(_href);	//获取url拼接路由hash
						});
						$(".widget-tab").find("#sysFlowTab_pending>.bottom-menu>a").click(function(){
							window.location.href="#flowCenter";
							FlowCenter.config.active = "pending";
							$("#flowCenter").find("div.weui_navbar_item[_for='"+FlowCenter.config.active+"']").trigger("click");
						});
						
						$("#sysFlowTab_pending img.lazy").lazyload({
							event : "sporty,scroll",
							effect : "fadeIn",
							container : document.getElementById("homeCont")
						}).each(function(i){
							if(i<10){
								$(this).trigger("sporty");
							}else{
								return false;
							}
						});
					}
					if(status=="error"){
						
					}
					$accordionPending.remove();
				});
//			});
			
			//$processedList.each(function(){
				$accordionProcessing.load($processedList.attr("_url"), function(response,status) {
					var $accorProcess = $("#accordion-processing");
					var processingLi = "";
					if(status=="success"){
						var $lis = $accorProcess.find("li");
						var count = $lis.size();
						if(count != 0){
							if(count > 9){
								count = "9+";
							}
							$(".nav-tabs").find("a[aria-controls='processing']>.flowNum").text("("+ count +")");	//设置总数
						}
						$lis.each(function(i){
							
							var $li = $(this);
							var _flowname = $li.attr("_flowname");
							var _url = $li.attr("_url");
							var _tabDocID = $li.attr("_docid");
							var _initiator = $li.attr("_initiator");
							var _initiatorID = $li.attr("_initiatorId");
							var _initiatorDept = $li.attr("_initiatorDept");
							var _time = $li.attr("_lastprocesstime");
							var _isRead = $li.attr("_isRead");
							
							if( i < 5 ){
								var flowTime = new Date(_time);
								var timeFixArr = _time.split(/[- :]/); 
								var timeFixDate = new Date(timeFixArr[0], timeFixArr[1]-1, timeFixArr[2], timeFixArr[3], timeFixArr[4]);
								var _timeAgo,_avatar;
								var avatar = Common.Util.getAvatar(_initiatorID);
								var Month = timeFixDate.getMonth() + 1; 
								var Day = timeFixDate.getDate(); 
								var Hour = timeFixDate.getHours(); 
								var Minute = timeFixDate.getMinutes(); 
								if(avatar!="" && avatar!=undefined){
									_avatar = "<img class='lazy' data-original='"+avatar+"'/>";
								}else{
									_avatar = "<div class='noAvatar'>"+ _initiator.substr(_initiator.length-2, 2) +"</div>";
								}
								
								//比较时间 serviceTime定义在main.jsp
				 				var comTime = Common.Util.daysCalc(_time,serviceTime);

								if(comTime.days > 2){
									if (Month >= 10){ 
										_timeAgo = Month + "-"; 
									}else{ 
										_timeAgo = "0" + Month + "-"; 
									} 
									if (Day >= 10) 
									{ 
										_timeAgo += Day + " "; 
									}else{ 
										_timeAgo += "0" + Day; 
									} 
								}else if(comTime.days == 2){ 
									_timeAgo = "前天 ";
									if (Hour >= 10) 
									{ 
										_timeAgo += Hour + ":" ; 
									}else{ 
										_timeAgo += "0" + Hour + ":" ; 
									} 
									if (Minute >= 10) 
									{ 
										_timeAgo += Minute ; 
									}else{ 
										_timeAgo += "0" + Minute ; 
									} 
								}else if(comTime.days == 1){
									_timeAgo = "昨天 ";
									if (Hour >= 10) 
									{ 
										_timeAgo += Hour + ":" ; 
									}else{ 
										_timeAgo += "0" + Hour + ":" ; 
									} 
									if (Minute >= 10) 
									{ 
										_timeAgo += Minute ; 
									}else{ 
										_timeAgo += "0" + Minute ; 
									} 
								}else if(comTime.days <= 0 && comTime.hours > 0){
									_timeAgo = comTime.hours + " 小时前 ";
								}else if(comTime.days <= 0 && comTime.hours <= 0){
									if(comTime.minutes < 5){
										_timeAgo = " 刚刚";
									}else{
										_timeAgo = comTime.minutes + " 分钟前 ";
									}
								}
								
								var _stateLabel = $li.attr("_stateLabel");
								
								var $processingBox = $(".tab-content").find("#sysFlowTab_processing>ul");
								
								var tabLi = Jh.Util.format(_template.tabLi , {'tabID' : _flowname});
								tabLi = Jh.Util.format(tabLi , {'tabCon' : $li.text()});
								tabLi = Jh.Util.format(tabLi , {'tabUrl' : _url});
								tabLi = Jh.Util.format(tabLi , {'tabName' : _flowname});
								tabLi = Jh.Util.format(tabLi , {'tabTime' : _timeAgo});
								tabLi = Jh.Util.format(tabLi , {'tabDocID' : _tabDocID});
								tabLi = Jh.Util.format(tabLi , {'tabIsRead' : _isRead});
								if(_isRead == "true"){
									tabLi = Jh.Util.format(tabLi , {'tabIsReadClass' : 'tabLiCon-isread'});
									tabLi = Jh.Util.format(tabLi , {'tabIsReadText' : '已阅'});
								}else{
									tabLi = Jh.Util.format(tabLi , {'tabIsReadClass' : 'tabLiCon-noread'});
									tabLi = Jh.Util.format(tabLi , {'tabIsReadText' : '未阅'});
								}
								tabLi = Jh.Util.format(tabLi , {'tabInitiator' : _initiator});
								tabLi = Jh.Util.format(tabLi , {'tabInitiatorID' : _initiatorID});
								tabLi = Jh.Util.format(tabLi , {'tabAvatar' : _avatar});
								tabLi = Jh.Util.format(tabLi , {'tabDept' : _initiatorDept});
								tabLi = Jh.Util.format(tabLi , {'tabState' : _stateLabel});
				
								processingLi += tabLi;	
							}else{
								$("#sysFlowTab_processing").find(".btn").show();
							};
							$li.remove();
						});	
						
						if($(".nav-tabs").find("a[aria-controls='processing']>.flowNum").text()=="(0)"){
							$(".nav-tabs").find("a[aria-controls='processing']>.flowNum").css("display","none");
							$(".widget-tab").find("#sysFlowTab_processing>#content-load-panel").css("display","block");
						}else{
							$(".widget-tab").find("#sysFlowTab_processing>#content-load-panel").css("display","none");
							$(".nav-tabs").find("a[aria-controls='processing']>.flowNum").css("display","inline-block");
						}
						$(".widget-tab").find("#sysFlowTab_processing>ul").append(processingLi)
						$(".widget-tab").find("#sysFlowTab_processing li.widgetItem").unbind().bind("click",function(){
							var $this = $(this);
							var _href = $this.attr("_url");
							ajaxPage.useFormAction(_href);	//获取url拼接路由hash
						});
						$(".widget-tab").find("#sysFlowTab_processing>.bottom-menu>a").click(function(){
							window.location.href="#flowCenter";
							FlowCenter.config.active = "processing";
							$("#flowCenter").find("div.weui_navbar_item[_for='"+FlowCenter.config.active+"']").trigger("click");
						});
						
						$("#sysFlowTab_processing img.lazy").lazyload({
							event : "sporty,scroll",
							effect : "fadeIn",
							container : document.getElementById("homeCont")
						}).each(function(i){
							if(i<10){
								$(this).trigger("sporty");
							}else{
								return false;
							}
						});
					}
					if(status=="error"){
						
					}
					$accordionProcessing.remove();
				});
			});

			$me.find("li.widget-workflow-slide:eq(0)").addClass("active");
			$me.find("div.tab-pane:eq(0)").addClass("active");
		},
		
		_eventRefresh:function(){	
			
			
			$("#home_link .groupWrapper").find("div.widget-tab").each(function(){
				var _me = $(this);
				var refreshUrl = "../widget/displayWidget.action?id="+_me.attr("id")+"&appid=" + appId;
				_me.load(refreshUrl, function(data){
					var $content = $(this);
					switch($content.attr("_type")) {
//						case "summary":
//							me._renderSummary($content);
//						break;
//						case "view":
//							me._renderView($content);
//						break;
//						case "link":
//							me._renderLink($content);
//						break;
//						case "extlink":
//							me._renderExtLink($content);
//						break;
//						case "announcement":
//							me._renderAnnouncement($content);
//						break;
						case "system_workflow":
							me._renderWorkflow($content);
						break;
						case "weather":
							me._renderWeather($content);
						break;
					}
				});
			});
		},
		_eventRefreshReport:function(obj){
			var refreshUrl = "../widget/displayWidget.action?id="+obj.attr("_id")+"&name=" + obj.attr("name") +"&appid=" + appId;
			$("#"+obj.attr("_id")).load(refreshUrl, function(data){
				var $content = $(this);
				me._renderCustomizeReport($content);
				hideLoadingToast()
			});
		}
	};
}();

function loadHome(){
	showLoadingToast();
	$.get("./homepage.jsp?application="+appId,function(text){
		$("#homePage").attr("isLoaded","true").html("").append("<div id='homeCont'></div>");
		var $homePage = $("<div>"+text+"</div>");
		var defaultCfg = eval("("+$homePage.find("#defaultCfg").val()+")");
		
//		try {
			var userCfg = $.trim($homePage.find("#templateElement").val());
			//兼容平台旧数据，是旧数据时重置首页
			if(userCfg.indexOf(";")>0){
				userCfg="";
			}
			
			if (userCfg.length>0) {
				userCfg = $.parseJSON(userCfg);
				defaultCfg.layoutStyle = userCfg.layoutStyle;
			}
			
			var sysWidgetCfg = $.trim($homePage.find("#sysWidgetCfg").val());
			if (sysWidgetCfg.length>0) {
				sysWidgetCfg = $.parseJSON(sysWidgetCfg);
			}
			
			Jh.Config._sysWidgetSet = $.extend({},Jh.Config._sysWidgetSet,sysWidgetCfg);
			Jh.Portal.init(userCfg, defaultCfg, Jh.Config._sysWidgetSet);
			hideLoadingToast();

//		} catch(e) {
//			console.error("loadHome function output JSON:"+e);
//			hideLoadingToast();
//		}
	});
}

/**
 * 
 * @param $bool
 */
function triggerBouncyNav($bool) {
    if (!is_bouncy_nav_animating) {
        is_bouncy_nav_animating = true;
        $('.phone-main-nav-modal').toggleClass('fade-in', $bool).toggleClass('fade-out', !$bool).find('li:last-child').one('webkitAnimationEnd oanimationend msAnimationEnd animationend', function() {
        	$('.phone-main-nav-modal').toggleClass('is-visible', $bool);
            if (!$bool)
                $('.phone-main-nav-modal').removeClass('fade-out');
            is_bouncy_nav_animating = false;
        });
        if ($('.phone-main-nav-trigger').parents('.no-csstransitions').length > 0) {
            $('.phone-main-nav-modal').toggleClass('is-visible', $bool);
            is_bouncy_nav_animating = false;
        }
        $('.phone-main-nav-trigger').toggle();
    	$('.phone-main-nav-close').toggle();
    }
}

/**
 * 加载页签内容
 */
function loadContent(target){
	var hash = target ? "#" + target : window.location.hash;
	var title;
	if (hash && hash.length > 1) {
		title = hash.substring(1);
	}else {
		title = "homePage";
	}
	ajaxPage.setTitle(target);
	switch (title) {
		case "homePage":	//加载首页
			if($("#homePage").attr("isLoaded") != "true"){
				loadHome();
			}
			
			break;

		case "flowCenter":	//加载流程中心
			if($("#flowCenter").attr("isLoaded") != "true"){
				loadFlow();
			}
			break;

		case "menu":	//加载菜单
			if($("#menu").attr("isLoaded") != "true"){
				loadMenu();		//menu.js
			}
			break;
			
		default:
			break;
	}
}

/**
 * 事件绑定
 */
function mainBindEvent(){

    //控制菜单
    $('.phone-main-nav-trigger').on('click', function() {
        triggerBouncyNav(true);
    });
    $('.phone-main-nav-close').on('click', function() {
        triggerBouncyNav(false);
    });
    $('.phone-main-nav-modal').on('click', function(event) {
        if ($(event.target).is('.phone-main-nav-modal')) {
        	triggerBouncyNav(false);
        }
    });
    
	/**
	 * 导航显示
	 */
	$(".phone-main-nav-panel .phone-main-nav li").on("touchend click",function(event){
		if($("#flowCenter").is(":visible")){
			$(".weui_navbar_item[_for='startFlow']").trigger("touchend");
		}
		var title = $(this).attr("title");
		triggerBouncyNav(false);		
		window.location.hash = "#"+title;
		event.preventDefault();
	});
	
	/**
	 * “我的待办|经办跟踪”label切换
	 */
	$("#homePage").on("click", "#home_link ul[role=tablist] a", function(){
		Jh.Util.sysFlowTab($(this).attr("aria-controls"));
		return false;
	});
	/*
	 * 刷新自定义报表
	 * */
	$("#homePage").on("click", ".refreshReport",function(){
		showLoadingToast()
		var obj = $(this);
		Jh.Portal._eventRefreshReport(obj);//重新绑定刷新事件并触发
	});
}

/**
 * 根据传递的url跳转到表单中
 */
function jumpToPage(url){
	//ajaxPage.routerLoadPage(url);
	ajaxPage.useFormAction(url);
}

function showLoadingToast() {
    $('#loadingToast').show();
}

function hideLoadingToast() {
    $('#loadingToast').hide();
}; 

/**
 * 加载菜单
 */
function loadMenu(){
	showLoadingToast();
	// +号按钮
	$(".phone-main-nav-trigger").show();

	$.get("./menu.jsp?application=" + appId, function(text){
		//$("#menu").html(text).enhanceWithin();
		var $menu = $("#menu");
		$menu.attr("isLoaded", "true").html(text);
		//单击部门名称展开|折叠下级
		$menu.find(".menulist").on("click",".menu",function(e){
//			e.preventDefault();
			e.stopPropagation();
			$(this).toggleClass("open");
			$(">ul",$(this)).toggle();
		});
		
		var $appTitle = $menu.find(".appTitle");
		var $topBox = $menu.find(".top_menu_box");
		var $secondBox = $menu.find(".second_menu_box");
		var $thirdBox = $menu.find(".third_menu_box");
		
		$menu.find(".app_Title").html("<div><i class='iconfont-h5'>&#xe038;</i>" + $appTitle.text() + "</div><div class='title_line'></div>");
		
		$menu.find("li.topMenuItem").each(function(){
			var $this = $(this);
			var $topMenuItem;
			var _iconType = $this.attr("_icontype");
			var _icon = $this.attr("_icon");
			var _color = $this.attr("_color");
			
			if(_iconType == "img"){
				$topMenuItem = $("<span id='icon_" + $this.attr("id") 
						+ "' data-placement='bottom' title='" 
						+ $this.find(">.topMenu_title").text() 
						+ "'><i class='menuLiIcon weui_bar_item_on'>" 
						+ "<img src='"+contextPath+_icon+"'></i><i class='menuLiTxt'>" 
						+ $this.find(">.topMenu_title").text() + "</i></span>").appendTo($topBox);
			}else if(_iconType == "font"){
				$topMenuItem = $("<span id='icon_" + $this.attr("id") 
						+ "' data-placement='bottom' title='" 
						+ $this.find(">.topMenu_title").text() 
						+ "'><i class='menuLiIcon weui_bar_item_on'>" 
						+ "<i class='"+_icon+"' style='color:"+_color+";font-size: 50px;line-height: 100%;'></i></i><i class='menuLiTxt'>" 
						+ $this.find(">.topMenu_title").text() + "</i></span>").appendTo($topBox);
			}
			//menu1
			$topMenuItem.click(function(){
				var topMenuId = $(this).attr("id").substring(5);
				
				var $topMenuLi = $menu.find("#"+topMenuId).find(">ul>li");
				$topBox.find("span").removeClass("active");
				$(this).addClass("active");
				//$secondBox.slideUp();
				$secondBox.empty();
				$thirdBox.empty();
				
				
				if ($topMenuLi.size()<=0) {
					urlLink(topMenuId);
				}
				else {
					
					$topMenuLi.each(function(){
						var $this = $(this);
						var $secondMenuItem;
						var _iconType = $this.attr("_icontype");
						var _icon = $this.attr("_icon");
						var _color = $this.attr("_color");
						
						if(_iconType == "img"){
							$secondMenuItem = $("<span id='icon_" + $this.attr("id") 
									+ "' data-placement='bottom' title='" 
									+ $this.find(">.second_title").text() 
									+ "'><i class='menuLiIcon weui_bar_item_on'>" 
									+ "<img src='"+contextPath+_icon+"'></i><i class='menuLiTxt'>" 
									+ $this.find(">.second_title").text() + "</i></span>").appendTo($secondBox);
						}else if(_iconType == "font"){
							$secondMenuItem = $("<span id='icon_" + $this.attr("id") 
									+ "' data-placement='bottom' title='" 
									+ $this.find(">.second_title").text() 
									+ "'><i class='menuLiIcon weui_bar_item_on'>" 
									+ "<i class='"+_icon+"' style='color:"+_color+";font-size: 50px;line-height: 100%;'></i></i><i class='menuLiTxt'>" 
									+ $this.find(">.second_title").text() + "</i></span>").appendTo($secondBox);
						}
						//menu2
						$secondMenuItem.click(function(){
							var secondMenuId = $(this).attr("id").substring(5);
							var $secondMenuLi = $menu.find("#"+secondMenuId).find(">ul>li");
							$secondBox.find("span").removeClass("active");
							$(this).addClass("active");
							//$thirdBox.slideUp();
							$thirdBox.empty();
							
							if ($secondMenuLi.size()<=0){
								urlLink(secondMenuId);
							}
							else {
								$secondMenuLi.each(function(){
									var $this = $(this);
									var $thirdMenuItem;
									var _iconType = $this.attr("_icontype");
									var _icon = $this.attr("_icon");
									var _color = $this.attr("_color");
									
									if(_iconType == "img"){
										$thirdMenuItem = $("<span id='icon_" + $this.attr("id") 
												+ "' data-placement='bottom' title='" 
												+ $this.find(">.third_title").text() 
												+ "'><i class='menuLiIcon weui_bar_item_on'>" 
												+ "<img src='"+contextPath+_icon+"'></i><i class='menuLiTxt'>" 
												+ $this.find(">.third_title").text() + "</i></span>").appendTo($thirdBox);
									}else if(_iconType == "font"){
										$thirdMenuItem = $("<span id='icon_" + $this.attr("id") 
												+ "' data-placement='bottom' title='" 
												+ $this.find(">.third_title").text() 
												+ "'><i class='menuLiIcon weui_bar_item_on'>" 
												+ "<i class='"+_icon+"' style='color:"+_color+";font-size: 50px;line-height: 100%;'></i></i><i class='menuLiTxt'>" 
												+ $this.find(">.third_title").text() + "</i></span>").appendTo($thirdBox);
									}
									//menu3
									$thirdMenuItem.click(function(){
										var thirdMenuId = $(this).attr("id").substring(5);
										urlLink(thirdMenuId);
									});
									$thirdBox.slideDown("fast");
								});
							}
						});
						
					});
					$secondBox.slideDown("fast");	
				}
			});
		});
		//隐藏无菜单的软件
		$menu.find(".menu_dl").each(function(){
			if($(this).find(".menu .topMenuItem").size()<=0){
				$(this).find(".app").css("display","none");
			}else{
				$menu.find(".noApp").css("display","none");	//隐藏无发起内容的提示
			}
		});
		hideLoadingToast();

		function urlLink(liId){
			var $a = $menu.find("#"+liId);
			var url = $a.attr("_href");
			var type = ajaxPage.judgeType(url);
			switch(type){
			case "form":
				ajaxPage.useFormAction(url);	//获取url拼接路由hash
				break;
			case "view":
				ajaxPage.getToViewHash(url);
				break;
			case "oReport":
				ajaxPage.getToOReportHash(url);
				break;
			case "flowCenter":
				ajaxPage.getToFlowCenterHash(url);
				break;
			case "externalLinks":
				window.open(url);
                break;
			}
		};
		
	});

}; 
/**待办
 * 原数据结构：
 * <ul>软件
 * 	<li>待办：属性_flowName为流程名，
 *		根据流程名创建li，多个待办共用相同流程名
 * 返回数据结构：
 * <ul>
 * 	<li>软件名
 *	<li>流程名
 *		<span>数量
 *		<ul>
 *			<li>待办
 */
FlowCenter = {
	config : {
		active : ""//流程中心默认打开页面  startFlow(发起) pending(待办) processing(经办) finished(历史) 
	},
	multilingual : {},
	_click : function(scope, tabName){
		var $scope = $("#" + scope);
	 	$scope.find("a[aria-controls='"+tabName+"']").parent("li").addClass("active").siblings().removeClass("active");
	 	$scope.find(".tab-content").find("#"+tabName).addClass("active").siblings().removeClass("active");
	},
	_clickFlowName : function(scope, tabName){
		var $scope = $("#" + scope);
	 	$scope.find("a[aria-controls='"+tabName+"']").parent("li").addClass("active").siblings().removeClass("active");
		if(tabName && (tabName.indexOf("pending-") != -1 || tabName.indexOf("processing-") != -1)){
			$scope.find(".tab-content").find("#"+tabName).addClass("active").siblings().removeClass("active")
	 		$scope.find(".tab-content").find("li.pending-list-con").show();
	 	}else{
	 		$scope.find(".tab-content").find("li[flowname=" + tabName +"]").siblings().hide().end().show();
	 	}
	},
	format : function(str, model) {//格式化指定键值的模板
	 	for (var k in model) {
	 		var re = new RegExp("{" + k + "}", "g");
	 		str = str.replace(re, model[k]);
	 	}
	 	return str;
	 },
	 render2P : function(scope){
	 	//构建内容
	 	$("#"+scope +"App ul[_appid='"+appId+"']").each(function(i){
	 		$("#" + scope).html("");
	 		var $scope = $("#"+scope);
	 		var $app = $(this);
	 		var _appID = $app.attr("_appid");
	 		var _appName = $app.attr("_appname");
	 		var _appUrl = $app.attr("_url");

	 		var _template = {
	 				appPanel : '<div class="pending-app-tab" role="tabpanel"></div>',
	 				appHeaderBox : '<ul class="pending-app-nav nav nav-tabs" role="tablist" style="display:none"></ul>',
	 				appHeaderNav :	'<li role="presentation">'
	 							+'<a onclick="FlowCenter._click(\''+scope +'\',\'{appID}\');" _href="#{appID}" aria-controls="{appID}" role="tab" data-toggle="tab">{appName}</a>'
	 							+'</li>',
	 				appBodyBox : '<div class="pending-app-content tab-content"></div>',
	 				appBodyCon : '<div role="tabpanel" class="tab-pane" id="{appID}">'
	 							+'<div class="pending-tab swiper-container" role="tabpanel"><ul class="pending-nav nav nav-tabs swiper-wrapper" role="tablist" style="display: none;">'
	 							+'<li class="swiper-slide" role="presentation"><a onclick="FlowCenter._clickFlowName(\''+scope +'\',\''+scope +'-'+_appID+'\');" _href="#'+scope +'-'+_appID+'" aria-controls="'+scope +'-'+_appID+'" role="tab" data-toggle="tab">全部<span></span></a></li></ul></div></div>',
	 							
	 				tabHeaderNav : '<li class="swiper-slide" role="presentation">'
	 								+'<a onclick="FlowCenter._clickFlowName(\''+scope +'\',\'{tabID}\');" _href="#{tabID}" aria-controls="{tabID}" role="tab" data-toggle="tab">{tabTitle}<span></span></a>'
	 								+'</li>',
	 				
	 				appFilterBox : '<div class="pending-app-filter text-center">'
				 					+'<div class="pending-app-filter-item" data-filter="all"><i class="iconfont if-phone-updown"></i>全部 <span class="pending-app-filter-arrow">▲</span></div>'
				 					+'<div class="pending-app-filter-item" data-filter="filter"><i class="iconfont if-phone-filter"></i>筛选 <span class="pending-app-filter-arrow">▲</span></div>'
				 					+'</div>',
	 				 								
	 				tabBodyBox : '<div class="pending-content tab-content"></div>',
	 				
	 				tabBodyAll : '<div role="tabpanel" class="tab-pane" id="'+scope +'-'+_appID+'" style="padding-bottom: 50px;"><ul></ul></div>',
	 				
	 				tabBodyCon : '<div role="tabpanel" class="tab-pane" id="{tabID}"><ul></ul></div>',
	 									
					tabBodyLi : '<li class="widgetItem pending-list-con" flowname="{flowName}" id="{tabDocID}" _url="{tabUrl}" _isRead="{tabIsRead}">'
								+ '<div class="tabLiFace">{tabAvatar}'
								+ '<span class="{tabIsReadClass}"></span>'
								+ '</div>'
								+ '<div class="tabLiCon">'
								+ '<div class="tabLiConBox">'
								+ '<div class="tabLiConA text-left">'
								+ '<span class="tabLiCon-text">[{tabName}] {tabCon}</span>'

								+ '</div>'
								+ '<div class="tabLiConB"><div class="tabLiTagLeft">'
								+ '<span class="tabLiCon-auditornames" _initiator="{tabInitiator}" _initiatorId="{tabInitiatorID}">{tabDept}{tabInitiator}</span>'
								+ '<span class="tabLiCon-lastprocesstime timeago" title="{tabTime}">{tabTime}</span>'
								+ '</div>'
								+ '<div class="tabLiTagRight text-right">'
								+ '<span class="tabLiCon-status" title="{tabState}">{tabState}</span>'
								+ '</div>'
								+ '</div>'
								+ '</li>',
	 				
	 				tabBtnLeft : '<div class="tabs-button-prev"><span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span></div>',
	 				tabBtnright : '<div class="tabs-button-next"><span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span></div>',
	 				tabSpace : '<div id="content-load-panel"><div id="content-space" class="text-center">'
	 							+ '<div class="content-space-icon icon iconfont">&#xe61b;</div>'
	 							+ '<div class="content-space-h1">当前没有任何信息</div>'
	 							+ '<div class="content-space-h2">需要处理的信息将显示在这里</div></div></div>'

	 		}
	 		
	 		if($scope.find(".pending-app-tab").size()==0){
	 			var $appPanel = $(_template.appPanel).append(_template.appHeaderBox);
	 			$appPanel.append(_template.appBodyBox);
	 			$appPanel.find(".pending-tab").append(_template.tabBodyBox);
	 			$scope.append($appPanel);
	 		}
	 		
	 		var appHeaderNav = FlowCenter.format(_template.appHeaderNav , {'appID' : _appID});
	 			appHeaderNav = FlowCenter.format(appHeaderNav , {'appName' : _appName});
	 		var appBodyCon = FlowCenter.format(_template.appBodyCon , {'appID' : _appID});
	 		
	 		$scope.find(".pending-app-tab").find(".pending-app-nav").append(appHeaderNav);
	 		$scope.find(".pending-app-tab").find(".pending-app-content").append(_template.appFilterBox);
	 		$scope.find(".pending-app-tab").find(".pending-app-content").append(appBodyCon);
	 		$scope.find(".pending-app-content").find(".pending-tab").each(function(){
	 			if($(this).find(".pending-content").size()==0){
	 				$(this).append(_template.tabBodyBox);
	 			}
	 		})

	 		var $tabList = $scope.find(".pending-app-content").find("div.tab-pane[id='"+_appID+"']");
	 		var $tabListBox = $("<div id='tabListBox-"+_appID+"'></div>");
	 		$tabList.append($tabListBox);
	 		$tabList.find(".pending-content").append(_template.tabBodyAll);
			
	 		$tabListBox.load(_appUrl, {"_pagelines" : 100}, function() {
	 			var $accor = $(this);
	 			var $lis = $accor.find("li");
	 			var count = $lis.size();
	 			
	 			if(count != 0){
	 				if(count > 99){
	 					count = "99+";
	 				}
	 				$("#flowCenter").find(".weui_navbar_item[_for='"+scope+"']").find(".navbar-item-box>span").text(count).show();	//设置总数
	 				$scope.find("div.tab-pane[id='"+_appID+"']").find(".nav-tabs").find("a[aria-controls='"+scope +"-"+_appID+"']>span").text(count);	//设置总数
	 			}else{
	 				$scope.html(_template.tabSpace);
	 				$("#flowCenter").find(".weui_navbar_item[_for='"+scope+"']").find(".navbar-item-box>span").hide();
	 				$("#"+scope).height($("#flow-center-panel").height());
	 			}
	 			
	 			var count = {};		//统计各流程数据
	 			$lis.each(function(i){
	 				var $li = $(this);
	 				var _flowname = $.trim($li.attr("_flowname"));
	 				var _url = $li.attr("_url");
	 				var _tabDocID = $li.attr("_docid");
	 				var _text = $li.text();
	 				var _stateLabel = $li.attr("_statelabel");
	 				var _name = $li.attr("_auditornames");
					var _initiator = $li.attr("_initiator");
					var _initiatorID = $li.attr("_initiatorId");
					var _initiatorDept = $li.attr("_initiatorDept");
					var _time = $li.attr("_lastprocesstime");
					var _isRead = $li.attr("_isRead");
	 				
					var flowTime = new Date(_time);
					var timeFixArr = _time.split(/[- :]/); 
					var timeFixDate = new Date(timeFixArr[0], timeFixArr[1]-1, timeFixArr[2], timeFixArr[3], timeFixArr[4]);
					var _timeAgo,_avatar;
					var avatar = Common.Util.getAvatar(_initiatorID);
					var Month = timeFixDate.getMonth() + 1; 
					var Day = timeFixDate.getDate(); 
					var Hour = timeFixDate.getHours(); 
					var Minute = timeFixDate.getMinutes(); 

					if(avatar!="" && avatar!=undefined){
						_avatar = "<img class='lazy' data-original ="+avatar+">";
					}else{
						_avatar = "<div class='noAvatar'>"+ _initiator.substr(_initiator.length-2, 2) +"</div>";
					}
	 				
	 				//比较时间 serviceTime定义在main.jsp
	 				var comTime = Common.Util.daysCalc(_time,serviceTime);

					if(comTime.days > 2){
						if (Month >= 10){ 
							_timeAgo = Month + "-"; 
						}else{ 
							_timeAgo = "0" + Month + "-"; 
						} 
						if (Day >= 10) 
						{ 
							_timeAgo += Day + " "; 
						}else{ 
							_timeAgo += "0" + Day; 
						} 
					}else if(comTime.days == 2){ 
						_timeAgo = "前天 ";
						if (Hour >= 10) 
						{ 
							_timeAgo += Hour + ":" ; 
						}else{ 
							_timeAgo += "0" + Hour + ":" ; 
						} 
						if (Minute >= 10) 
						{ 
							_timeAgo += Minute ; 
						}else{ 
							_timeAgo += "0" + Minute ; 
						} 
					}else if(comTime.days == 1){
						_timeAgo = "昨天 ";
						if (Hour >= 10) 
						{ 
							_timeAgo += Hour + ":" ; 
						}else{ 
							_timeAgo += "0" + Hour + ":" ; 
						} 
						if (Minute >= 10) 
						{ 
							_timeAgo += Minute ; 
						}else{ 
							_timeAgo += "0" + Minute ; 
						} 
					}else if(comTime.days <= 0 && comTime.hours > 0){
						_timeAgo = comTime.hours + " 小时前 ";
					}else if(comTime.days <= 0 && comTime.hours <= 0){
						if(comTime.minutes < 5){
							_timeAgo = " 刚刚";
						}else{
							_timeAgo = comTime.minutes + " 分钟前 ";
						}
					}
	 				var _lastprocesstime = $li.attr("_lastprocesstime");
	 				
	 				
	 				
	 				count[_flowname] = count[_flowname] ? (count[_flowname]+1) : 1;
	 				$panel = $("#"+_flowname);
	 				
	 				var tabHeaderNav = FlowCenter.format(_template.tabHeaderNav , {'tabID' : _flowname});
	 					tabHeaderNav = FlowCenter.format(tabHeaderNav , {'tabTitle' : _flowname});
	 				var tabBodyCon = FlowCenter.format(_template.tabBodyCon , {'tabID' : _flowname});
	 					tabBodyCon = FlowCenter.format(tabBodyCon , {'tabCon' : $li.text()});
	 					tabBodyCon = FlowCenter.format(tabBodyCon , {'tabUrl' : _url});
	 					tabBodyCon = FlowCenter.format(tabBodyCon , {'tabDocID' : _tabDocID});
	 					
	 					
	 				var tabBodyLi = FlowCenter.format(_template.tabBodyLi , {'tabID' : _flowname});
	 					tabBodyLi = FlowCenter.format(tabBodyLi , {'tabCon' : $li.text()});
	 					tabBodyLi = FlowCenter.format(tabBodyLi , {'tabIsRead' : _isRead});
	 					tabBodyLi = FlowCenter.format(tabBodyLi , {'tabUrl' : _url});
	 					tabBodyLi = FlowCenter.format(tabBodyLi , {'tabName' : _flowname});
	 					tabBodyLi = FlowCenter.format(tabBodyLi , {'flowName' : _flowname});
	 					tabBodyLi = FlowCenter.format(tabBodyLi , {'tabTime' : _timeAgo});
	 					tabBodyLi = FlowCenter.format(tabBodyLi , {'tabDocID' : _tabDocID});
	 					tabBodyLi = FlowCenter.format(tabBodyLi , {'tabIsRead' : _isRead});
						if(_isRead == "false"){
							tabBodyLi = FlowCenter.format(tabBodyLi , {'tabIsReadClass' : 'noread'});
						}else{
							tabBodyLi = FlowCenter.format(tabBodyLi , {'tabIsReadClass' : 'isread'});
						}
	 					tabBodyLi = FlowCenter.format(tabBodyLi , {'tabInitiator' : _initiator});
	 					tabBodyLi = FlowCenter.format(tabBodyLi , {'tabInitiatorID' : _initiatorID});
	 					tabBodyLi = FlowCenter.format(tabBodyLi , {'tabAvatar' : _avatar});
	 					tabBodyLi = FlowCenter.format(tabBodyLi , {'tabDept' : _initiatorDept});
	 					tabBodyLi = FlowCenter.format(tabBodyLi , {'tabState' : _stateLabel});
	 					
	 
	 					
	 				$scope.find("div.tab-pane[id='"+_appID+"']").find(".pending-content").find("#"+scope +"-"+_appID).find("ul").append(tabBodyLi);
	 				if(count[_flowname] == 1){	//没有创建相同流程名称内容时创建
	 					$scope.find("div.tab-pane[id='"+_appID+"']").find(".pending-nav").append(tabHeaderNav);
	 				}
	 				$scope.find("div.tab-pane[id='"+_appID+"']").find(".nav-tabs").find("a[aria-controls='"+_flowname+"']>span").text(count[_flowname]);	//设置总数
	 				$li.remove();
	 			})
	 			
	 			$scope.find("div.tab-pane[id='"+_appID+"']").find(".pending-content .pending-list-con").click(function(){
	 				var $this = $(this);
	 				$this.find("span.noread").removeClass("noread").addClass("isread");		//仅待办
	 				var id = $this.attr("id");
	 				var title = $this.text();
	 				title = !title || title.trim().length == 0 ? "..." : title.trim();
	 				title = title.length > 5 ? title.substring(0, 5) + ".." : title;
	 				var url = $this.attr("_url");
	 				ajaxPage.useFormActionNoOtherParams(url);	//获取url拼接路由hash
	 			})
	 			$scope.find(".pending-app-nav").find("li:eq(0) a").trigger('click');
	 			$scope.find(".pending-nav").find("li:eq(0) a").trigger('click');

				$scope.find("img.lazy").lazyload({
					event : "sporty,scroll",
					effect : "fadeIn",
					container : document.getElementById("flow-center-panel")
				}).each(function(i){
					if(i<10){
						$(this).trigger("sporty");
					}else{
						return false;
					}
				});
				
	 			$tabListBox.remove();
				hideLoadingToast();
	 		})
	 	});
	 },
		/**
		 * 加载待办
		 */
		loadPending:function() {
			FlowCenter.render2P("pending");
		},
		/**
		 * 加载经办
		 */
		loadProcessing:function() {
			FlowCenter.render2P("processing");
		},
		/**
		 * 加载流程历史
		 */
		loadResult:function() {
			//添加软件名称
			var url = "../dynaform/work/historyListNew.action";
			var $searForm = $("#searchForm");
			var $form = $searForm.wrap("<form></form>").parent();
			var params = $form.serializeArray();
			$searForm.unwrap();
			showLoadingToast();
			
		    $.ajax({
		    	url : url,
		    	data : params,
		    	dataType:"text", 
		    	type : "POST",
		    	success : function(text){
		    		var $ul = $("<ul></ul>").append(text);
		    		FlowCenter.renderNew($ul);
					hideLoadingToast();
		    	}
		    });
		},
	/**
	 * 流程历史数据重构和渲染
	 */
	renderNew:function($ul) {

		$finishedBox = $("#finished");
		var $contentLoad = $finishedBox.find("#content-load-panel");
		if($ul.find("li").size()==0){
			$contentLoad.show();
			if($contentLoad.find(".content-space-h1").text()=="当前没有任何查询"){
				$contentLoad.find(".icon-619").hide();
				$contentLoad.find(".icon-61a").show();
				$contentLoad.find(".content-space-h1").text("当前没有历史记录");
				$contentLoad.find(".content-space-h2").text("请重新输入关键字查询");
			}
		}else{
			$contentLoad.hide();
		}

		$listViewBox = "<div id='ui-content' class='card_app'><ul data-role='listview' id='resultUl' class='table-view'></ul></div>"
		$finishedBox.find("#ui-content").remove();
		$finishedBox.append($listViewBox);
		
		$listView = $("#resultUl");
		$listView.html("");	//清空原有数据

		$ul.find("li").each(function(){
			var $li = $(this);
			var url = $li.attr("_url");
			var text = $li.text();
			var flowName = $li.attr("_flowName");
			var stateLabel = $li.attr("_stateLabel");
			var _time = $li.attr("_lastProcessTime");
			var _applicationId=$li.attr("_applicationId");
			var _initiator = $li.attr("_initiator");
			var _initiatorID = $li.attr("_initiatorId");
			var _initiatorDept = $li.attr("_initiatorDept");
			var _isRead = $li.attr("_isRead");
			
			var _timeAgo,_avatar,_tabIsReadClass;
			
			var proTime = new Date(_time);
			var timeFixArr = _time.split(/[- :]/); 
			var timeFixDate = new Date(timeFixArr[0], timeFixArr[1]-1, timeFixArr[2], timeFixArr[3], timeFixArr[4]);
			var Month = timeFixDate.getMonth() + 1; 
			var Day = timeFixDate.getDate(); 
			var Hour = timeFixDate.getHours(); 
			var Minute = timeFixDate.getMinutes();
			
			var avatar = Common.Util.getAvatar(_initiatorID);
			if(avatar!="" && avatar!=undefined){
				_avatar = "<img class='lazy' data-original ="+avatar+">";
			}else{
				_avatar = "<div class='noAvatar'>"+ _initiator.substr(_initiator.length-2, 2) +"</div>";
			}
			
			//比较时间 serviceTime定义在main.jsp
			var comTime = Common.Util.daysCalc(_time,serviceTime);

			if(comTime.days > 2){
				if (Month >= 10){ 
					_timeAgo = Month + "-"; 
				}else{ 
					_timeAgo = "0" + Month + "-"; 
				} 
				if (Day >= 10) 
				{ 
					_timeAgo += Day + " "; 
				}else{ 
					_timeAgo += "0" + Day; 
				} 
			}else if(comTime.days == 2){ 
				_timeAgo = "前天 ";
				if (Hour >= 10) 
				{ 
					_timeAgo += Hour + ":" ; 
				}else{ 
					_timeAgo += "0" + Hour + ":" ; 
				} 
				if (Minute >= 10) 
				{ 
					_timeAgo += Minute ; 
				}else{ 
					_timeAgo += "0" + Minute ; 
				} 
			}else if(comTime.days == 1){
				_timeAgo = "昨天 ";
				if (Hour >= 10) 
				{ 
					_timeAgo += Hour + ":" ; 
				}else{ 
					_timeAgo += "0" + Hour + ":" ; 
				} 
				if (Minute >= 10) 
				{ 
					_timeAgo += Minute ; 
				}else{ 
					_timeAgo += "0" + Minute ; 
				} 
			}else if(comTime.days <= 0 && comTime.hours > 0){
				_timeAgo = comTime.hours + " 小时前 ";
			}else if(comTime.days <= 0 && comTime.hours <= 0){
				if(comTime.minutes < 5){
					_timeAgo = " 刚刚";
				}else{
					_timeAgo = comTime.minutes + " 分钟前 ";
				}
			}
			
			if(_isRead == "false"){
				_tabIsReadClass = "noread";
			}else{
				_tabIsReadClass = "isread";
			}
			
			var li = '<li class="table-view-cell" _url="' + url + '"><a data-ignore="push" class="navigate-right">'
					+ '<div class="tabLiFace">' + _avatar + '<span class="' + _tabIsReadClass + '"></span></div>'
					+ '<div class="tabLiCon"><div class="tabLiConBox"><div class="tabLiConA text-left">'
					+ '[' + flowName + ']&nbsp;' + text + '</div>'
					+ '<div class="tabLiConB"><div class="tabLiTagLeft"><span class="tabLiCon-auditornames" >' + _initiatorDept + _initiator + '</span>'
					+ '<span class="tabLiCon-lastprocesstime timeago" title="' + _timeAgo + '">' + _timeAgo + '</span></div><div class="tabLiTagRight text-right">'
					+ '<span class="tabLiCon-status" title="">' + stateLabel + '</span></div></div></div></div>'
					+'</a></li>';

			var $li = $(li);
			$li.appendTo($listView);
		});
		//监听事件
		
		if($ul.find("li").size()==0){
			$finishedBox.find("#ui-content").remove();
		}
		$ul.remove();
		$("#ui-content").html($("#ui-content").html());	

		//lazyload
		$finishedBox.find("img.lazy").lazyload({
			event : "sporty,scroll",
			effect : "fadeIn",
			container : document.getElementById("flow-center-panel")
		}).each(function(i){
			if(i<10){
				$(this).trigger("sporty");
			}else{
				return false;
			}
		});
	},

	/**
	 * 流程发起打开链接
	 * @param liId
	 */
	urlLink : function(liId){
		var $a = $("#startFlow").find("#"+liId);	
		var url = $a.attr("_href");
		ajaxPage.useFormActionNoOtherParams(url);
	},
		/**
		 *	加载发起菜单
		 * @param $startFlow
		 */
	initStartFlow : function(){
		var $startFlow = $("#startFlow");
		$startFlow.find("dl.menu_dl#appNum_"+appId).each(function(){
			
			var $appBoxId = $(this).attr("id");
			$startFlow.find(".launch-tab").append("<li>"
									+"<a id='"+ $appBoxId +"_title' class='app_Title' href='#"+ $appBoxId+"_List' role='tab' data-toggle='tab'></a></li>"
									);		
			$startFlow.find(".launch-tab-content").append("<div id='"+ $appBoxId +"_List' class='app_List tab-pane'>"
					+ "<div class='top_menu_box clearfix'></div>"
					+ "<div class='second_menu_box clearfix' style='display:none'></div>"
					+ "<div class='third_menu_box clearfix' style='display:none'></div></div>");		
					
			var $appTitle = $(this).find(".appTitle");
			var $topBox = $startFlow.find("#"+$appBoxId+"_List>.top_menu_box");
			var $secondBox = $startFlow.find("#"+$appBoxId+"_List>.second_menu_box");
			var $thirdBox = $startFlow.find("#"+$appBoxId+"_List>.third_menu_box");
			
			$startFlow.find("#"+ $appBoxId +"_title").html("<div><i class='iconfont-h5'>&#xe038;</i>" + $appTitle.text() + "</div><div class='title_line'></div>");

			$(this).find("li.topMenuItem").each(function(){
				var $this = $(this);
				var $topMenuItem;
				var _iconType = $this.attr("_icontype");
				var _icon = $this.attr("_icon");
				var _color = $this.attr("_color");
				
				if(_iconType == "img"){
					$topMenuItem = $("<span id='icon_" + $this.attr("id") 
							+ "' data-placement='bottom' title='" 
							+ $this.find(">.topMenu_title").text() 
							+ "'><i class='menuLiIcon weui_bar_item_on'>" 
							+ "<img src='"+contextPath+_icon+"'></i><i class='menuLiTxt'>" 
							+ $this.find(">.topMenu_title").text() + "</i></span>").appendTo($topBox);
				}else if(_iconType == "font"){
					$topMenuItem = $("<span id='icon_" + $this.attr("id") 
							+ "' data-placement='bottom' title='" 
							+ $this.find(">.topMenu_title").text() 
							+ "'><i class='menuLiIcon weui_bar_item_on'>" 
							+ "<i class='"+_icon+"' style='color:"+_color+";font-size: 50px;line-height: 100%;'></i></i><i class='menuLiTxt'>" 
							+ $this.find(">.topMenu_title").text() + "</i></span>").appendTo($topBox);
				}
				//menu1
				$topMenuItem.click(function(){
					var topMenuId = $(this).attr("id").substring(5);
					var $topMenuLi = $startFlow.find("#"+topMenuId).find(">ul>li");
					$topBox.find("span").removeClass("active");
					$(this).addClass("active");
					//$secondBox.slideUp();
					$secondBox.empty();
					$thirdBox.empty();
					
					
					if ($topMenuLi.size()<=0) {
						FlowCenter.urlLink(topMenuId);
					}
					else {
						
						$topMenuLi.each(function(){
							var $this = $(this);
							var $secondMenuItem;
							var _iconType = $this.attr("_icontype");
							var _icon = $this.attr("_icon");
							var _color = $this.attr("_color");
							
							if(_iconType == "img"){
								$secondMenuItem = $("<span id='icon_" + $this.attr("id") 
										+ "' data-placement='bottom' title='" 
										+ $this.find(">.second_title").text() 
										+ "'><i class='menuLiIcon weui_bar_item_on'>" 
										+ "<img src='"+contextPath+_icon+"'></i><i class='menuLiTxt'>" 
										+ $this.find(">.second_title").text() + "</i></span>").appendTo($secondBox);
							}else if(_iconType == "font"){
								$secondMenuItem = $("<span id='icon_" + $this.attr("id") 
										+ "' data-placement='bottom' title='" 
										+ $this.find(">.second_title").text() 
										+ "'><i class='menuLiIcon weui_bar_item_on'>" 
										+ "<i class='"+_icon+"' style='color:"+_color+";font-size: 50px;line-height: 100%;'></i></i><i class='menuLiTxt'>" 
										+ $this.find(">.second_title").text() + "</i></span>").appendTo($secondBox);
							}
							
							//menu2
							$secondMenuItem.click(function(){
								var secondMenuId = $(this).attr("id").substring(5);
								var $secondMenuLi = $startFlow.find("#"+secondMenuId).find(">ul>li");
								$secondBox.find("span").removeClass("active");
								$(this).addClass("active");
								//$thirdBox.slideUp();
								$thirdBox.empty();
								if ($secondMenuLi.size()<=0){
									FlowCenter.urlLink(secondMenuId);
								}
								else {
									$secondMenuLi.each(function(){
										var $this = $(this);
										var $thirdMenuItem;
										var _iconType = $this.attr("_icontype");
										var _icon = $this.attr("_icon");
										var _color = $this.attr("_color");
										
										if(_iconType == "img"){
											$thirdMenuItem = $("<span id='icon_" + $this.attr("id") 
													+ "' data-placement='bottom' title='" 
													+ $this.find(">.third_title").text() 
													+ "'><i class='menuLiIcon weui_bar_item_on'>" 
													+ "<img src='"+contextPath+_icon+"'></i><i class='menuLiTxt'>" 
													+ $this.find(">.third_title").text() + "</i></span>").appendTo($thirdBox);
										}else if(_iconType == "font"){
											$thirdMenuItem = $("<span id='icon_" + $this.attr("id") 
													+ "' data-placement='bottom' title='" 
													+ $this.find(">.third_title").text() 
													+ "'><i class='menuLiIcon weui_bar_item_on'>" 
													+ "<i class='"+_icon+"' style='color:"+_color+";font-size: 50px;line-height: 100%;'></i></i><i class='menuLiTxt'>" 
													+ $this.find(">.third_title").text() + "</i></span>").appendTo($thirdBox);
										}
										//menu3
										$thirdMenuItem.click(function(){
											var thirdMenuId = $(this).attr("id").substring(5);
											FlowCenter.urlLink(thirdMenuId);
										});
										$thirdBox.slideDown("fast");
									});
								}
							});
						});
						$secondBox.slideDown("fast");
					}
				});
			});
		});
		//tab第一个增加class类“active”
		$startFlow.find(".launch-tab li").eq(0).addClass("active");
		$startFlow.find(".launch-tab-content .tab-pane").eq(0).addClass("active");
		
		//隐藏无菜单的软件
		$startFlow.find(".menu_dl").each(function(){
			if($(this).find(".menu .topMenuItem").size()<=0){
				$(this).find(".app").css("display","none");
			}else{
				$startFlow.find(".noApp").css("display","none");	//隐藏无发起内容的提示
			}
		});
	},
	
	initPending : function(){
		this.getPendingNum();
		$("#pendingApp ul[_appid='" + appId + "']").each(function(){
			$(this).bind("refresh", function(event) {
				FlowCenter.render2P("pending");
			});
		});
	},
	initProcessing : function(){
		this.getProcessingNum();
		$("#processingApp ul[_appid='" + appId + "']").each(function(){
			$(this).bind("refresh", function(event) {
				FlowCenter.render2P("processing");
			});
		});
	},
	
	getPendingNum : function(){
		var url = "../dynaform/work/pendingCount.action";
		var $searForm = $("#searchForm");
		var $form = $searForm.wrap("<form></form>").parent();
		var params = $form.serializeArray();
		$searForm.unwrap();
		showLoadingToast();
		
	    $.ajax({
	    	url : url,
	    	data : params,
	    	dataType:"json", 
	    	type : "POST",
	    	success : function(result){
	    		if(result.status == 1){
	    			var count = result.data;
	    			if(count != 0){
	    				if(count > 99){
	    					count = "99+";
	    				}
	    				$("#flowCenter").find(".weui_navbar_item[_for='pending']").find(".navbar-item-box>span").text(count).show();	//设置总数
	    			}else{
	    				$("#flowCenter").find(".weui_navbar_item[_for='pending']").find(".navbar-item-box>span").hide();
	    			}
	    		}
	    	}
	    });
	},
	getProcessingNum : function(){
		var url = "../dynaform/work/processedCount.action";
		var $searForm = $("#searchForm");
		var $form = $searForm.wrap("<form></form>").parent();
		var params = $form.serializeArray();
		$searForm.unwrap();
		showLoadingToast();
		
	    $.ajax({
	    	url : url,
	    	data : params,
	    	dataType:"json", 
	    	type : "POST",
	    	success : function(result){
	    		if(result.status == 1){
	    			var count = result.data;
	    			if(count != 0){
	    				if(count > 99){
	    					count = "99+";
	    				}
	    				$("#flowCenter").find(".weui_navbar_item[_for='processing']").find(".navbar-item-box>span").text(count).show();	//设置总数
	    			}else{
	    				$("#flowCenter").find(".weui_navbar_item[_for='processing']").find(".navbar-item-box>span").hide();
	    			}
	    		}
	    	}
	    });
	},
	initFinished : function(){

		$("#finished").find("#content-load-panel").height($("#flowCenter").height()-166);
		//绑定查询按钮
		$("#searchBtn").click(function() {
			FlowCenter.loadResult();
			return false;
		});
		//切换我发起的
		$("#finish-pend").on("click",function(){
			var $this = $(this);
			if($this.hasClass("check")){
				$this.removeClass("check");
				$this.find(".finish-pend-icon").html('<i class="fa fa-square-o" aria-hidden="true"></i>');
				$("#_isMyWorkFlow").val("");
			}else{
				$this.addClass("check");
				$this.find(".finish-pend-icon").html('<i class="fa fa-check-square-o" aria-hidden="true"></i>');
				$("#_isMyWorkFlow").val("1");
			}
			FlowCenter.loadResult();
			return false;
		});
	},
	addListen : function(){

		//流程中心页头切换操作
		$("#flowCenter .weui_navbar").find(".weui_navbar_item").on("click",function(){
			$(this).addClass("weui_bar_item_on").siblings(".weui_navbar_item").removeClass("weui_bar_item_on");
			$("div[name=flowCenterDiv]").css("display","none");
			var val = $(this).attr("_for");
			$("#flowCenter #flow-center-panel").find("#" + val).show().siblings().hide();
			switch (val) {
			case "pending":
				if($(this).attr("isloaded") != "true"){
					$(this).attr("isloaded", "true");
					FlowCenter.loadPending();
				}
				break;

			case "processing":
				if($(this).attr("isloaded") != "true"){
					$(this).attr("isloaded", "true");
					FlowCenter.loadProcessing();
				}
				break;
				
			case "finished":
				
				if($(this).attr("isloaded") != "true"){
					$(this).attr("isloaded", "true");
					FlowCenter.loadResult();
				}
				break;
				
			default:
				break;
			}
		});

		//待办经办全部和筛选点击事件
		$("#pending, #processing").on("click",".pending-app-filter-item",function(){
			var $this = $(this);
			var filter = $this.data("filter");
			var $pendingNav = $this.parents(".pending-app-content").find(".tab-pane.active").find("ul.pending-nav");
			$(".pending-app-filter-item").removeClass("active");
			if($pendingNav.is(":visible")){
				
			}else{
				$this.addClass("active");
			}
			$pendingNav.slideToggle(function(){
				if($pendingNav.is(":visible")){
					$pendingNav.css("display","block");
				}
			});
		});
		
		//流程历史列表点击事件
		$("#finished").on("click", "#resultUl li", function(){
			var url = $(this).attr("_url");
			ajaxPage.useFormActionNoOtherParams(url);	//获取url拼接路由hash
		});
	},
	
	load : function() {
		$("#flowCenter").load("./flowCenter.jsp?application=" + appId, {}, function(){
			$("#flowCenter").attr("isLoaded","true");
			FlowCenter.init();
			hideLoadingToast();
		});
	},
	/**
	 * 流程中心初始化
	 */
	init : function(){

		// +号按钮
		$(".phone-main-nav-trigger").show();
		
		//发起
		this.initStartFlow();

		//待办
		this.initPending();
		
		//经办
		this.initProcessing();
		
		//历史
		this.initFinished();
		
		//事件监听
		this.addListen();

		if(FlowCenter.config.active != ""){
			$("#flowCenter").find("div.weui_navbar_item[_for='"+FlowCenter.config.active+"']").trigger("click");
			FlowCenter.config.active = "";
		}
		
	}
};
; 
var Common = {};
Common.Util = {
	cache : {
		
	},
	/**
	 * 获取用户头像图片url地址
	 * @param userId
	 */	
	getAvatar : function(userId){
		if(!this.cache[userId]){
			$.ajax({
				type: "GET",
				url: contextPath + "/contacts/getAvatar.action",
				data: {"id":userId},
				async: false,
				dataType: "json",
				success:function(result){
					if(1==result.status){
						Common.Util.cache[userId] = result.data;
					}
				}
			});
		}
		
		return this.cache[userId];;
	},
	/**
	 * 计算时间差
	 * @param date,date2
	 */
	daysCalc : function(date,date2){
		var startDateArr = date.split(/[- :]/); 
		var startDate = new Date(startDateArr[0], startDateArr[1]-1, startDateArr[2], startDateArr[3], startDateArr[4]);
		var nowDate = new Date();
		if(!date2 || date2 == ""){
			var nowDate = new Date();
		}else{
			var endDateArr = date2.split(/[- :]/); 
			nowDate = new Date(endDateArr[0], endDateArr[1]-1, endDateArr[2], endDateArr[3], endDateArr[4]);
		}
		var msDate = nowDate.getTime() - startDate.getTime();
		//计算出相差天数
		var days=Math.floor(msDate/(24*3600*1000));
		//计算出小时数
		var leave1 = msDate%(24*3600*1000);//计算天数后剩余的毫秒数
		var hours = Math.floor(leave1/(3600*1000));
		//计算相差分钟数
		var leave2 = leave1%(3600*1000);//计算小时数后剩余的毫秒数
		var minutes = Math.floor(leave2/(60*1000));
		//计算相差秒数
		var leave3=leave2%(60*1000);//计算分钟数后剩余的毫秒数
		var seconds=Math.round(leave3/1000);
		//alert(" 相差 "+days+"天 "+hours+"小时 "+minutes+" 分钟"+seconds+" 秒");	
		var timeCalc = {
			    "days": days,
			    "hours": hours,
			    "minutes": minutes,
			    "seconds": seconds
			};
		return timeCalc;
	},
	/**
	 * 计算时间差
	 * @param date,date2
	 */
	getQueryString : function(name,url){
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i"); 
        var r = url.substr(url.indexOf("?")+1).match(reg); 
        if (r != null) return unescape(r[2]); 
        return null; 
    } 
}; 
/*!
 * jQuery Cookie Plugin v1.4.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2006, 2014 Klaus Hartl
 * Released under the MIT license
 */
(function (factory) {
	if (typeof define === 'function' && define.amd) {
		// AMD (Register as an anonymous module)
		define(['jquery'], factory);
	} else if (typeof exports === 'object') {
		// Node/CommonJS
		module.exports = factory(require('jquery'));
	} else {
		// Browser globals
		factory(jQuery);
	}
}(function ($) {

	var pluses = /\+/g;

	function encode(s) {
		return config.raw ? s : encodeURIComponent(s);
	}

	function decode(s) {
		return config.raw ? s : decodeURIComponent(s);
	}

	function stringifyCookieValue(value) {
		return encode(config.json ? JSON.stringify(value) : String(value));
	}

	function parseCookieValue(s) {
		if (s.indexOf('"') === 0) {
			// This is a quoted cookie as according to RFC2068, unescape...
			s = s.slice(1, -1).replace(/\\"/g, '"').replace(/\\\\/g, '\\');
		}

		try {
			// Replace server-side written pluses with spaces.
			// If we can't decode the cookie, ignore it, it's unusable.
			// If we can't parse the cookie, ignore it, it's unusable.
			s = decodeURIComponent(s.replace(pluses, ' '));
			return config.json ? JSON.parse(s) : s;
		} catch(e) {}
	}

	function read(s, converter) {
		var value = config.raw ? s : parseCookieValue(s);
		return $.isFunction(converter) ? converter(value) : value;
	}

	var config = $.cookie = function (key, value, options) {

		// Write

		if (arguments.length > 1 && !$.isFunction(value)) {
			options = $.extend({}, config.defaults, options);

			if (typeof options.expires === 'number') {
				var days = options.expires, t = options.expires = new Date();
				t.setMilliseconds(t.getMilliseconds() + days * 864e+5);
			}

			return (document.cookie = [
				encode(key), '=', stringifyCookieValue(value),
				options.expires ? '; expires=' + options.expires.toUTCString() : '', // use expires attribute, max-age is not supported by IE
				options.path    ? '; path=' + options.path : '',
				options.domain  ? '; domain=' + options.domain : '',
				options.secure  ? '; secure' : ''
			].join(''));
		}

		// Read

		var result = key ? undefined : {},
			// To prevent the for loop in the first place assign an empty array
			// in case there are no cookies at all. Also prevents odd result when
			// calling $.cookie().
			cookies = document.cookie ? document.cookie.split('; ') : [],
			i = 0,
			l = cookies.length;

		for (; i < l; i++) {
			var parts = cookies[i].split('='),
				name = decode(parts.shift()),
				cookie = parts.join('=');

			if (key === name) {
				// If second argument (value) is a function it's a converter...
				result = read(cookie, value);
				break;
			}

			// Prevent storing a cookie that we couldn't decode.
			if (!key && (cookie = read(cookie)) !== undefined) {
				result[name] = cookie;
			}
		}

		return result;
	};

	config.defaults = {};

	$.removeCookie = function (key, options) {
		// Must not alter options, thus extending a fresh object...
		$.cookie(key, '', $.extend({}, options, { expires: -1 }));
		return !$.cookie(key);
	};

}));
; 
function tableListColumn() {
	var showColumn;
	var $body = $("body");
	if(ajaxPage.getCurPage().size() > 0){
		$body = ajaxPage.getCurPage();
	}
	

	$("table[data-mode='columntoggle']").each(function() { 
		
		
		var $tableBox = $(this);
		var $tableListID = $tableBox.attr("id"),
			$listDataTh = $tableBox.find(".listDataTh"),
			$listDataTr = $tableBox.find(".listDataTr");
		
		
		//获取用户配置视图列
		$.ajax({
			url: contextPath + "/portal/usersetup/getConfigOnWxViewColumn.action",
			async: false,
			cache:false,
			type:"POST",
			data: {
				"userId": USER.id,
				"viewId": $tableListID
			},
			success: function(result){
				if(result && result != ""){
					showColumn = JSON.parse(result);
				}
			}
		})
		
 
		$tableBox.attr("data-mode","_columntoggle");
		
		if($listDataTh.find(".listDataThTd").size()>2){
			
			var tableHeadMenu = $listDataTh.find("th").not(".listDataThFirstTd");	
			var td_length = tableHeadMenu.length;
			
			$listDataTh.append("<td class='tdMenu' onclick='tdMenu(\""+$tableListID+"\")'><img src='"+contextPath+"/portal/phone/resource/images/view/more.png'/></td>");
			$listDataTr.each(function(){
				var $tdR = $("<td class='tdRight'><span class='icon icon-right-nav'></span></td>");
				$(this).append($tdR);
				
			})
			if($("#viewMenu_"+$tableListID).size()<=0){
				
				$body.append('<div class="tableList-menu-container tableList-menu text-left" id="viewMenu_'+$tableListID+'" style="display:none;"></div>');
				$body.append('<div class="tableList-screen" id="viewScreen_'+$tableListID+'" onclick="tdMenu(\''+$tableListID+'\')" style="display:none;"></div>');
				for(i=0;i<td_length;i++)
		    	{
		    		$("#viewMenu_"+$tableListID).append('<div class="ui-checkbox"><input id="checkbox_'+$tableListID+'_'+i+'" type="checkbox" onclick="tdHide(\''+ $tableListID +'\','+i+')"><label for="checkbox_'+$tableListID+'_'+i+'">'+tableHeadMenu.eq(i).clone().text()+'</label></div>');
		    	}
			}

			if(showColumn && showColumn.length >= 1){
				tableHeadMenu.attr("data-priority","6");
				$.each(showColumn,function(key,value){
					tableHeadMenu.each(function(i){
						var text_content=$.trim($(this).text());
						if(text_content){
							$(this).attr("data-priority","1");
						}
					})
				})
			}else{
				tableHeadMenu.each(function(num){
					if(num>1){
						$(this).attr("data-priority","6");
					}else{
						$(this).attr("data-priority","1");
					}
				})
			}

	    	tableHeadMenu.each(function(num){
	    		var $tableHiddenColumn = $(this).attr("isHiddenColumn");
	    		var $tableIsVisible = $(this).attr("isVisible");
	    		
	    		if($tableHiddenColumn == "true" || $tableIsVisible == "false"){
	    			if($(this).attr("data-priority") == "1"){
	    				$(this).attr("data-priority","6");
	    				if($(this).next().attr("data-priority")=="6"){
	    					$(this).next().attr("data-priority","1");
	    				}else{
	    					if($(this).next().next().attr("data-priority")=="6"){
		    					$(this).next().next().attr("data-priority","1");
		    				}
	    				}
	    			}
	    			$(this).addClass("tableTH-hide");
		    		$(this).parents("#"+$tableListID).find('.listDataTr').find('.listDataTrTd:eq('+num+')').hide();
		    		$body.find('#viewMenu_'+$tableListID+'>.ui-checkbox:eq('+num+')').hide();
		    		$body.find('#viewMenu_'+$tableListID+'>.ui-checkbox:eq('+num+')>input').attr("checked",false);
				}else{
					if($(this).attr("data-priority")=="1"){
			    		$(this).addClass("tableTH-show");
			    		$(this).parents("#"+$tableListID).find('.listDataTr').find('.listDataTrTd:eq('+num+')').show();
			    		$body.find('#viewMenu_'+$tableListID+'>.ui-checkbox:eq('+num+')>input').attr("checked",true);
			    	}else{
			    		$(this).addClass("tableTH-hide");
			    		$(this).parents("#"+$tableListID).find('.listDataTr').find('.listDataTrTd:eq('+num+')').hide();
			    		$body.find('#viewMenu_'+$tableListID+'>.ui-checkbox:eq('+num+')>input').attr("checked",false);
			    	}
				}
	    	});
	    	var menu_top = $(".tdMenu").offset().top + $(".tdMenu").outerHeight() + 5
	    	$("#viewMenu_"+$tableListID).css({"top":menu_top,"right":5});
		}
	});	
};

function tdHide(tableListID,num) {
	var $curPage = $("body");
	if(ajaxPage.getCurPage().size() > 0){
		$curPage = ajaxPage.getCurPage();
	}
	var listViewTable = tableListID
	$curPage.find("#"+listViewTable).find('.listDataThTd:eq('+num+')').toggle();
	$curPage.find("#"+listViewTable).find('.listDataTr').find('.listDataTrTd:eq('+num+')').toggle();
	$curPage.find("#"+listViewTable).find('.listDataTr').find('.listDataTrTd:eq('+num+')').css("text-align","center");
	$curPage.find("#"+listViewTable).find('.listDataTr').each(function(){
		$(this).find("td").each(function(){
			 if ($(this).css("display") != "none")  { 
				 return false;
			 } 
		}); 
	});
	
	//设置用户配置视图显示列
	var colums = [];
	
	$("#viewMenu_"+tableListID).find(".ui-checkbox").each(function(){
		var $this = $(this);
		if($this.find("input").is(":checked")){
			colums.push($this.find("label").text());
		}
	})
	
	$.ajax({
		url: contextPath + "/portal/usersetup/ConfigOnWxViewCoulum.action",
		cache:false,
		type:"POST",
		data:{
			"userId": USER.id,
			"viewId": tableListID,
			"colums": JSON.stringify(colums)
		}
	})
};

function tdMenu(tableListID) {
	$("#viewMenu_"+tableListID).toggle();
	$("#viewScreen_"+tableListID).toggle();
};
; 
/*
 * Lazy Load - jQuery plugin for lazy loading images
 *
 * Copyright (c) 2007-2013 Mika Tuupola
 *
 * Licensed under the MIT license:
 *   http://www.opensource.org/licenses/mit-license.php
 *
 * Project home:
 *   http://www.appelsiini.net/projects/lazyload
 *
 * Version:  1.9.3
 *
 */

(function($, window, document, undefined) {
    var $window = $(window);

    $.fn.lazyload = function(options) {
        var elements = this;
        var $container;
        var settings = {
            threshold       : 0,
            failure_limit   : 0,
            event           : "scroll",
            effect          : "show",
            container       : window,
            data_attribute  : "original",
            skip_invisible  : true,
            appear          : null,
            load            : null,
            placeholder     : "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAANSURBVBhXYzh8+PB/AAffA0nNPuCLAAAAAElFTkSuQmCC"
        };

        function update() {
            var counter = 0;

            elements.each(function() {
                var $this = $(this);
                if (settings.skip_invisible && !$this.is(":visible")) {
                    return;
                }
                if ($.abovethetop(this, settings) ||
                    $.leftofbegin(this, settings)) {
                        /* Nothing. */
                } else if (!$.belowthefold(this, settings) &&
                    !$.rightoffold(this, settings)) {
                        $this.trigger("appear");
                        /* if we found an image we'll load, reset the counter */
                        counter = 0;
                } else {
                    if (++counter > settings.failure_limit) {
                        return false;
                    }
                }
            });

        }

        if(options) {
            /* Maintain BC for a couple of versions. */
            if (undefined !== options.failurelimit) {
                options.failure_limit = options.failurelimit;
                delete options.failurelimit;
            }
            if (undefined !== options.effectspeed) {
                options.effect_speed = options.effectspeed;
                delete options.effectspeed;
            }

            $.extend(settings, options);
        }

        /* Cache container as jQuery as object. */
        $container = (settings.container === undefined ||
                      settings.container === window) ? $window : $(settings.container);

        /* Fire one scroll event per scroll. Not one scroll event per image. */
        //兼容多事件--jack-20161108
		if(settings.event.indexOf(",") != -1){
			var events = settings.event.split(",");
			for(a in events){
				if(0 === events[a].trim().indexOf("scroll")){
					$container.bind(events[a].trim(), function() {
						return update();
					});
				}
			}
		}else{
			if (0 === settings.event.indexOf("scroll")) {
				$container.bind(settings.event, function() {
					return update();
				});
			}
		}

        this.each(function() {
            var self = this;
            var $self = $(self);

            self.loaded = false;

            /* If no src attribute given use data:uri. */
            if ($self.attr("src") === undefined || $self.attr("src") === false) {
                if ($self.is("img")) {
                    $self.attr("src", settings.placeholder);
                }
            }

            /* When appear is triggered load original image. */
            $self.one("appear", function() {
                if (!this.loaded) {
                    if (settings.appear) {
                        var elements_left = elements.length;
                        settings.appear.call(self, elements_left, settings);
                    }
                    $("<img />")
                        .bind("load", function() {

                            var original = $self.attr("data-" + settings.data_attribute);
                            $self.hide();
                            if ($self.is("img")) {
                                $self.attr("src", original);
                            } else {
                                $self.css("background-image", "url('" + original + "')");
                            }
                            $self[settings.effect](settings.effect_speed);

                            self.loaded = true;

                            /* Remove image from array so it is not looped next time. */
                            var temp = $.grep(elements, function(element) {
                                return !element.loaded;
                            });
                            elements = $(temp);

                            if (settings.load) {
                                var elements_left = elements.length;
                                settings.load.call(self, elements_left, settings);
                            }
                        })
                        .attr("src", $self.attr("data-" + settings.data_attribute));
                }
            });

            /* When wanted event is triggered load original image */
            /* by triggering appear.                              */
            //兼容多事件--jack-20161108
			if(settings.event.indexOf(",") != -1){
				var events = settings.event.split(",");
				for(a in events){
					if(0 !== events[a].trim().indexOf("scroll")){
						$self.bind(events[a], function() {
							if (!self.loaded) {
								$self.trigger("appear");
							}
						});
					}
				}
			}else{
				if (0 !== settings.event.indexOf("scroll")) {
					$self.bind(settings.event, function() {
						if (!self.loaded) {
							$self.trigger("appear");
						}
					});
				}
			}
        });

        /* Check if something appears when window is resized. */
        $window.bind("resize", function() {
            update();
        });

        /* With IOS5 force loading images when navigating with back button. */
        /* Non optimal workaround. */
        if ((/(?:iphone|ipod|ipad).*os 5/gi).test(navigator.appVersion)) {
            $window.bind("pageshow", function(event) {
                if (event.originalEvent && event.originalEvent.persisted) {
                    elements.each(function() {
                        $(this).trigger("appear");
                    });
                }
            });
        }

        /* Force initial check if images should appear. */
        $(document).ready(function() {
            update();
        });

        return this;
    };

    /* Convenience methods in jQuery namespace.           */
    /* Use as  $.belowthefold(element, {threshold : 100, container : window}) */

    $.belowthefold = function(element, settings) {
        var fold;

        if (settings.container === undefined || settings.container === window) {
            fold = (window.innerHeight ? window.innerHeight : $window.height()) + $window.scrollTop();
        } else {
            fold = $(settings.container).offset().top + $(settings.container).height();
        }

        return fold <= $(element).offset().top - settings.threshold;
    };

    $.rightoffold = function(element, settings) {
        var fold;

        if (settings.container === undefined || settings.container === window) {
            fold = $window.width() + $window.scrollLeft();
        } else {
            fold = $(settings.container).offset().left + $(settings.container).width();
        }

        return fold <= $(element).offset().left - settings.threshold;
    };

    $.abovethetop = function(element, settings) {
        var fold;

        if (settings.container === undefined || settings.container === window) {
            fold = $window.scrollTop();
        } else {
            fold = $(settings.container).offset().top;
        }

        return fold >= $(element).offset().top + settings.threshold  + $(element).height();
    };

    $.leftofbegin = function(element, settings) {
        var fold;

        if (settings.container === undefined || settings.container === window) {
            fold = $window.scrollLeft();
        } else {
            fold = $(settings.container).offset().left;
        }

        return fold >= $(element).offset().left + settings.threshold + $(element).width();
    };

    $.inviewport = function(element, settings) {
         return !$.rightoffold(element, settings) && !$.leftofbegin(element, settings) &&
                !$.belowthefold(element, settings) && !$.abovethetop(element, settings);
     };

    /* Custom selectors for your convenience.   */
    /* Use as $("img:below-the-fold").something() or */
    /* $("img").filter(":below-the-fold").something() which is faster */

    $.extend($.expr[":"], {
        "below-the-fold" : function(a) { return $.belowthefold(a, {threshold : 0}); },
        "above-the-top"  : function(a) { return !$.belowthefold(a, {threshold : 0}); },
        "right-of-screen": function(a) { return $.rightoffold(a, {threshold : 0}); },
        "left-of-screen" : function(a) { return !$.rightoffold(a, {threshold : 0}); },
        "in-viewport"    : function(a) { return $.inviewport(a, {threshold : 0}); },
        /* Maintain BC for couple of versions. */
        "above-the-fold" : function(a) { return !$.belowthefold(a, {threshold : 0}); },
        "right-of-fold"  : function(a) { return $.rightoffold(a, {threshold : 0}); },
        "left-of-fold"   : function(a) { return !$.rightoffold(a, {threshold : 0}); }
    });

})(jQuery, window, document);
; 
!function(){"use strict";function e(e){e.fn.swiper=function(a){var r;return e(this).each(function(){var e=new t(this,a);r||(r=e)}),r}}var a,t=function(e,s){function i(){return"horizontal"===w.params.direction}function n(e){return Math.floor(e)}function o(){w.autoplayTimeoutId=setTimeout(function(){w.params.loop?(w.fixLoop(),w._slideNext()):w.isEnd?s.autoplayStopOnLast?w.stopAutoplay():w._slideTo(0):w._slideNext()},w.params.autoplay)}function l(e,t){var r=a(e.target);if(!r.is(t))if("string"==typeof t)r=r.parents(t);else if(t.nodeType){var s;return r.parents().each(function(e,a){a===t&&(s=t)}),s?t:void 0}return 0===r.length?void 0:r[0]}function d(e,a){a=a||{};var t=window.MutationObserver||window.WebkitMutationObserver,r=new t(function(e){e.forEach(function(e){w.onResize(!0),w.emit("onObserverUpdate",w,e)})});r.observe(e,{attributes:"undefined"==typeof a.attributes?!0:a.attributes,childList:"undefined"==typeof a.childList?!0:a.childList,characterData:"undefined"==typeof a.characterData?!0:a.characterData}),w.observers.push(r)}function p(e){e.originalEvent&&(e=e.originalEvent);var a=e.keyCode||e.charCode;if(!w.params.allowSwipeToNext&&(i()&&39===a||!i()&&40===a))return!1;if(!w.params.allowSwipeToPrev&&(i()&&37===a||!i()&&38===a))return!1;if(!(e.shiftKey||e.altKey||e.ctrlKey||e.metaKey||document.activeElement&&document.activeElement.nodeName&&("input"===document.activeElement.nodeName.toLowerCase()||"textarea"===document.activeElement.nodeName.toLowerCase()))){if(37===a||39===a||38===a||40===a){var t=!1;if(w.container.parents(".swiper-slide").length>0&&0===w.container.parents(".swiper-slide-active").length)return;var r={left:window.pageXOffset,top:window.pageYOffset},s=window.innerWidth,n=window.innerHeight,o=w.container.offset();w.rtl&&(o.left=o.left-w.container[0].scrollLeft);for(var l=[[o.left,o.top],[o.left+w.width,o.top],[o.left,o.top+w.height],[o.left+w.width,o.top+w.height]],d=0;d<l.length;d++){var p=l[d];p[0]>=r.left&&p[0]<=r.left+s&&p[1]>=r.top&&p[1]<=r.top+n&&(t=!0)}if(!t)return}i()?((37===a||39===a)&&(e.preventDefault?e.preventDefault():e.returnValue=!1),(39===a&&!w.rtl||37===a&&w.rtl)&&w.slideNext(),(37===a&&!w.rtl||39===a&&w.rtl)&&w.slidePrev()):((38===a||40===a)&&(e.preventDefault?e.preventDefault():e.returnValue=!1),40===a&&w.slideNext(),38===a&&w.slidePrev())}}function u(e){e.originalEvent&&(e=e.originalEvent);var a=w.mousewheel.event,t=0;if(e.detail)t=-e.detail;else if("mousewheel"===a)if(w.params.mousewheelForceToAxis)if(i()){if(!(Math.abs(e.wheelDeltaX)>Math.abs(e.wheelDeltaY)))return;t=e.wheelDeltaX}else{if(!(Math.abs(e.wheelDeltaY)>Math.abs(e.wheelDeltaX)))return;t=e.wheelDeltaY}else t=e.wheelDelta;else if("DOMMouseScroll"===a)t=-e.detail;else if("wheel"===a)if(w.params.mousewheelForceToAxis)if(i()){if(!(Math.abs(e.deltaX)>Math.abs(e.deltaY)))return;t=-e.deltaX}else{if(!(Math.abs(e.deltaY)>Math.abs(e.deltaX)))return;t=-e.deltaY}else t=Math.abs(e.deltaX)>Math.abs(e.deltaY)?-e.deltaX:-e.deltaY;if(w.params.mousewheelInvert&&(t=-t),w.params.freeMode){var r=w.getWrapperTranslate()+t;if(r>0&&(r=0),r<w.maxTranslate()&&(r=w.maxTranslate()),w.setWrapperTransition(0),w.setWrapperTranslate(r),w.updateProgress(),w.updateActiveIndex(),w.params.freeModeSticky&&(clearTimeout(w.mousewheel.timeout),w.mousewheel.timeout=setTimeout(function(){w.slideReset()},300)),0===r||r===w.maxTranslate())return}else{if((new window.Date).getTime()-w.mousewheel.lastScrollTime>60)if(0>t)if(w.isEnd){if(w.params.mousewheelReleaseOnEdges)return!0}else w.slideNext();else if(w.isBeginning){if(w.params.mousewheelReleaseOnEdges)return!0}else w.slidePrev();w.mousewheel.lastScrollTime=(new window.Date).getTime()}return w.params.autoplay&&w.stopAutoplay(),e.preventDefault?e.preventDefault():e.returnValue=!1,!1}function c(e,t){e=a(e);var r,s,n;r=e.attr("data-swiper-parallax")||"0",s=e.attr("data-swiper-parallax-x"),n=e.attr("data-swiper-parallax-y"),s||n?(s=s||"0",n=n||"0"):i()?(s=r,n="0"):(n=r,s="0"),s=s.indexOf("%")>=0?parseInt(s,10)*t+"%":s*t+"px",n=n.indexOf("%")>=0?parseInt(n,10)*t+"%":n*t+"px",e.transform("translate3d("+s+", "+n+",0px)")}function m(e){return 0!==e.indexOf("on")&&(e=e[0]!==e[0].toUpperCase()?"on"+e[0].toUpperCase()+e.substring(1):"on"+e),e}if(!(this instanceof t))return new t(e,s);var f={direction:"horizontal",touchEventsTarget:"container",initialSlide:0,speed:300,autoplay:!1,autoplayDisableOnInteraction:!0,freeMode:!1,freeModeMomentum:!0,freeModeMomentumRatio:1,freeModeMomentumBounce:!0,freeModeMomentumBounceRatio:1,freeModeSticky:!1,setWrapperSize:!1,virtualTranslate:!1,effect:"slide",coverflow:{rotate:50,stretch:0,depth:100,modifier:1,slideShadows:!0},cube:{slideShadows:!0,shadow:!0,shadowOffset:20,shadowScale:.94},fade:{crossFade:!1},parallax:!1,scrollbar:null,scrollbarHide:!0,keyboardControl:!1,mousewheelControl:!1,mousewheelReleaseOnEdges:!1,mousewheelInvert:!1,mousewheelForceToAxis:!1,hashnav:!1,spaceBetween:0,slidesPerView:1,slidesPerColumn:1,slidesPerColumnFill:"column",slidesPerGroup:1,centeredSlides:!1,slidesOffsetBefore:0,slidesOffsetAfter:0,roundLengths:!1,touchRatio:1,touchAngle:45,simulateTouch:!0,shortSwipes:!0,longSwipes:!0,longSwipesRatio:.5,longSwipesMs:300,followFinger:!0,onlyExternal:!1,threshold:0,touchMoveStopPropagation:!0,pagination:null,paginationElement:"span",paginationClickable:!1,paginationHide:!1,paginationBulletRender:null,resistance:!0,resistanceRatio:.85,nextButton:null,prevButton:null,watchSlidesProgress:!1,watchSlidesVisibility:!1,grabCursor:!1,preventClicks:!0,preventClicksPropagation:!0,slideToClickedSlide:!1,lazyLoading:!1,lazyLoadingInPrevNext:!1,lazyLoadingOnTransitionStart:!1,preloadImages:!0,updateOnImagesReady:!0,loop:!1,loopAdditionalSlides:0,loopedSlides:null,control:void 0,controlInverse:!1,controlBy:"slide",allowSwipeToPrev:!0,allowSwipeToNext:!0,swipeHandler:null,noSwiping:!0,noSwipingClass:"swiper-no-swiping",slideClass:"swiper-slide",slideActiveClass:"swiper-slide-active",slideVisibleClass:"swiper-slide-visible",slideDuplicateClass:"swiper-slide-duplicate",slideNextClass:"swiper-slide-next",slidePrevClass:"swiper-slide-prev",wrapperClass:"swiper-wrapper",bulletClass:"swiper-pagination-bullet",bulletActiveClass:"swiper-pagination-bullet-active",buttonDisabledClass:"swiper-button-disabled",paginationHiddenClass:"swiper-pagination-hidden",observer:!1,observeParents:!1,a11y:!1,prevSlideMessage:"Previous slide",nextSlideMessage:"Next slide",firstSlideMessage:"This is the first slide",lastSlideMessage:"This is the last slide",paginationBulletMessage:"Go to slide {{index}}",runCallbacksOnInit:!0},h=s&&s.virtualTranslate;s=s||{};for(var g in f)if("undefined"==typeof s[g])s[g]=f[g];else if("object"==typeof s[g])for(var v in f[g])"undefined"==typeof s[g][v]&&(s[g][v]=f[g][v]);var w=this;if(w.version="3.1.0",w.params=s,w.classNames=[],"undefined"!=typeof a&&"undefined"!=typeof r&&(a=r),("undefined"!=typeof a||(a="undefined"==typeof r?window.Dom7||window.Zepto||window.jQuery:r))&&(w.$=a,w.container=a(e),0!==w.container.length)){if(w.container.length>1)return void w.container.each(function(){new t(this,s)});w.container[0].swiper=w,w.container.data("swiper",w),w.classNames.push("swiper-container-"+w.params.direction),w.params.freeMode&&w.classNames.push("swiper-container-free-mode"),w.support.flexbox||(w.classNames.push("swiper-container-no-flexbox"),w.params.slidesPerColumn=1),(w.params.parallax||w.params.watchSlidesVisibility)&&(w.params.watchSlidesProgress=!0),["cube","coverflow"].indexOf(w.params.effect)>=0&&(w.support.transforms3d?(w.params.watchSlidesProgress=!0,w.classNames.push("swiper-container-3d")):w.params.effect="slide"),"slide"!==w.params.effect&&w.classNames.push("swiper-container-"+w.params.effect),"cube"===w.params.effect&&(w.params.resistanceRatio=0,w.params.slidesPerView=1,w.params.slidesPerColumn=1,w.params.slidesPerGroup=1,w.params.centeredSlides=!1,w.params.spaceBetween=0,w.params.virtualTranslate=!0,w.params.setWrapperSize=!1),"fade"===w.params.effect&&(w.params.slidesPerView=1,w.params.slidesPerColumn=1,w.params.slidesPerGroup=1,w.params.watchSlidesProgress=!0,w.params.spaceBetween=0,"undefined"==typeof h&&(w.params.virtualTranslate=!0)),w.params.grabCursor&&w.support.touch&&(w.params.grabCursor=!1),w.wrapper=w.container.children("."+w.params.wrapperClass),w.params.pagination&&(w.paginationContainer=a(w.params.pagination),w.params.paginationClickable&&w.paginationContainer.addClass("swiper-pagination-clickable")),w.rtl=i()&&("rtl"===w.container[0].dir.toLowerCase()||"rtl"===w.container.css("direction")),w.rtl&&w.classNames.push("swiper-container-rtl"),w.rtl&&(w.wrongRTL="-webkit-box"===w.wrapper.css("display")),w.params.slidesPerColumn>1&&w.classNames.push("swiper-container-multirow"),w.device.android&&w.classNames.push("swiper-container-android"),w.container.addClass(w.classNames.join(" ")),w.translate=0,w.progress=0,w.velocity=0,w.lockSwipeToNext=function(){w.params.allowSwipeToNext=!1},w.lockSwipeToPrev=function(){w.params.allowSwipeToPrev=!1},w.lockSwipes=function(){w.params.allowSwipeToNext=w.params.allowSwipeToPrev=!1},w.unlockSwipeToNext=function(){w.params.allowSwipeToNext=!0},w.unlockSwipeToPrev=function(){w.params.allowSwipeToPrev=!0},w.unlockSwipes=function(){w.params.allowSwipeToNext=w.params.allowSwipeToPrev=!0},w.params.grabCursor&&(w.container[0].style.cursor="move",w.container[0].style.cursor="-webkit-grab",w.container[0].style.cursor="-moz-grab",w.container[0].style.cursor="grab"),w.imagesToLoad=[],w.imagesLoaded=0,w.loadImage=function(e,a,t,r){function s(){r&&r()}var i;e.complete&&t?s():a?(i=new window.Image,i.onload=s,i.onerror=s,i.src=a):s()},w.preloadImages=function(){function e(){"undefined"!=typeof w&&null!==w&&(void 0!==w.imagesLoaded&&w.imagesLoaded++,w.imagesLoaded===w.imagesToLoad.length&&(w.params.updateOnImagesReady&&w.update(),w.emit("onImagesReady",w)))}w.imagesToLoad=w.container.find("img");for(var a=0;a<w.imagesToLoad.length;a++)w.loadImage(w.imagesToLoad[a],w.imagesToLoad[a].currentSrc||w.imagesToLoad[a].getAttribute("src"),!0,e)},w.autoplayTimeoutId=void 0,w.autoplaying=!1,w.autoplayPaused=!1,w.startAutoplay=function(){return"undefined"!=typeof w.autoplayTimeoutId?!1:w.params.autoplay?w.autoplaying?!1:(w.autoplaying=!0,w.emit("onAutoplayStart",w),void o()):!1},w.stopAutoplay=function(e){w.autoplayTimeoutId&&(w.autoplayTimeoutId&&clearTimeout(w.autoplayTimeoutId),w.autoplaying=!1,w.autoplayTimeoutId=void 0,w.emit("onAutoplayStop",w))},w.pauseAutoplay=function(e){w.autoplayPaused||(w.autoplayTimeoutId&&clearTimeout(w.autoplayTimeoutId),w.autoplayPaused=!0,0===e?(w.autoplayPaused=!1,o()):w.wrapper.transitionEnd(function(){w&&(w.autoplayPaused=!1,w.autoplaying?o():w.stopAutoplay())}))},w.minTranslate=function(){return-w.snapGrid[0]},w.maxTranslate=function(){return-w.snapGrid[w.snapGrid.length-1]},w.updateContainerSize=function(){var e,a;e="undefined"!=typeof w.params.width?w.params.width:w.container[0].clientWidth,a="undefined"!=typeof w.params.height?w.params.height:w.container[0].clientHeight,0===e&&i()||0===a&&!i()||(e=e-parseInt(w.container.css("padding-left"),10)-parseInt(w.container.css("padding-right"),10),a=a-parseInt(w.container.css("padding-top"),10)-parseInt(w.container.css("padding-bottom"),10),w.width=e,w.height=a,w.size=i()?w.width:w.height)},w.updateSlidesSize=function(){w.slides=w.wrapper.children("."+w.params.slideClass),w.snapGrid=[],w.slidesGrid=[],w.slidesSizesGrid=[];var e,a=w.params.spaceBetween,t=-w.params.slidesOffsetBefore,r=0,s=0;"string"==typeof a&&a.indexOf("%")>=0&&(a=parseFloat(a.replace("%",""))/100*w.size),w.virtualSize=-a,w.slides.css(w.rtl?{marginLeft:"",marginTop:""}:{marginRight:"",marginBottom:""});var o;w.params.slidesPerColumn>1&&(o=Math.floor(w.slides.length/w.params.slidesPerColumn)===w.slides.length/w.params.slidesPerColumn?w.slides.length:Math.ceil(w.slides.length/w.params.slidesPerColumn)*w.params.slidesPerColumn);var l,d=w.params.slidesPerColumn,p=o/d,u=p-(w.params.slidesPerColumn*p-w.slides.length);for(e=0;e<w.slides.length;e++){l=0;var c=w.slides.eq(e);if(w.params.slidesPerColumn>1){var m,f,h;"column"===w.params.slidesPerColumnFill?(f=Math.floor(e/d),h=e-f*d,(f>u||f===u&&h===d-1)&&++h>=d&&(h=0,f++),m=f+h*o/d,c.css({"-webkit-box-ordinal-group":m,"-moz-box-ordinal-group":m,"-ms-flex-order":m,"-webkit-order":m,order:m})):(h=Math.floor(e/p),f=e-h*p),c.css({"margin-top":0!==h&&w.params.spaceBetween&&w.params.spaceBetween+"px"}).attr("data-swiper-column",f).attr("data-swiper-row",h)}"none"!==c.css("display")&&("auto"===w.params.slidesPerView?(l=i()?c.outerWidth(!0):c.outerHeight(!0),w.params.roundLengths&&(l=n(l))):(l=(w.size-(w.params.slidesPerView-1)*a)/w.params.slidesPerView,w.params.roundLengths&&(l=n(l)),i()?w.slides[e].style.width=l+"px":w.slides[e].style.height=l+"px"),w.slides[e].swiperSlideSize=l,w.slidesSizesGrid.push(l),w.params.centeredSlides?(t=t+l/2+r/2+a,0===e&&(t=t-w.size/2-a),Math.abs(t)<.001&&(t=0),s%w.params.slidesPerGroup===0&&w.snapGrid.push(t),w.slidesGrid.push(t)):(s%w.params.slidesPerGroup===0&&w.snapGrid.push(t),w.slidesGrid.push(t),t=t+l+a),w.virtualSize+=l+a,r=l,s++)}w.virtualSize=Math.max(w.virtualSize,w.size)+w.params.slidesOffsetAfter;var g;if(w.rtl&&w.wrongRTL&&("slide"===w.params.effect||"coverflow"===w.params.effect)&&w.wrapper.css({width:w.virtualSize+w.params.spaceBetween+"px"}),(!w.support.flexbox||w.params.setWrapperSize)&&w.wrapper.css(i()?{width:w.virtualSize+w.params.spaceBetween+"px"}:{height:w.virtualSize+w.params.spaceBetween+"px"}),w.params.slidesPerColumn>1&&(w.virtualSize=(l+w.params.spaceBetween)*o,w.virtualSize=Math.ceil(w.virtualSize/w.params.slidesPerColumn)-w.params.spaceBetween,w.wrapper.css({width:w.virtualSize+w.params.spaceBetween+"px"}),w.params.centeredSlides)){for(g=[],e=0;e<w.snapGrid.length;e++)w.snapGrid[e]<w.virtualSize+w.snapGrid[0]&&g.push(w.snapGrid[e]);w.snapGrid=g}if(!w.params.centeredSlides){for(g=[],e=0;e<w.snapGrid.length;e++)w.snapGrid[e]<=w.virtualSize-w.size&&g.push(w.snapGrid[e]);w.snapGrid=g,Math.floor(w.virtualSize-w.size)>Math.floor(w.snapGrid[w.snapGrid.length-1])&&w.snapGrid.push(w.virtualSize-w.size)}0===w.snapGrid.length&&(w.snapGrid=[0]),0!==w.params.spaceBetween&&w.slides.css(i()?w.rtl?{marginLeft:a+"px"}:{marginRight:a+"px"}:{marginBottom:a+"px"}),w.params.watchSlidesProgress&&w.updateSlidesOffset()},w.updateSlidesOffset=function(){for(var e=0;e<w.slides.length;e++)w.slides[e].swiperSlideOffset=i()?w.slides[e].offsetLeft:w.slides[e].offsetTop},w.updateSlidesProgress=function(e){if("undefined"==typeof e&&(e=w.translate||0),0!==w.slides.length){"undefined"==typeof w.slides[0].swiperSlideOffset&&w.updateSlidesOffset();var a=w.params.centeredSlides?-e+w.size/2:-e;w.rtl&&(a=w.params.centeredSlides?e-w.size/2:e);{w.container[0].getBoundingClientRect(),i()?"left":"top",i()?"right":"bottom"}w.slides.removeClass(w.params.slideVisibleClass);for(var t=0;t<w.slides.length;t++){var r=w.slides[t],s=w.params.centeredSlides===!0?r.swiperSlideSize/2:0,n=(a-r.swiperSlideOffset-s)/(r.swiperSlideSize+w.params.spaceBetween);if(w.params.watchSlidesVisibility){var o=-(a-r.swiperSlideOffset-s),l=o+w.slidesSizesGrid[t],d=o>=0&&o<w.size||l>0&&l<=w.size||0>=o&&l>=w.size;d&&w.slides.eq(t).addClass(w.params.slideVisibleClass)}r.progress=w.rtl?-n:n}}},w.updateProgress=function(e){"undefined"==typeof e&&(e=w.translate||0);var a=w.maxTranslate()-w.minTranslate();0===a?(w.progress=0,w.isBeginning=w.isEnd=!0):(w.progress=(e-w.minTranslate())/a,w.isBeginning=w.progress<=0,w.isEnd=w.progress>=1),w.isBeginning&&w.emit("onReachBeginning",w),w.isEnd&&w.emit("onReachEnd",w),w.params.watchSlidesProgress&&w.updateSlidesProgress(e),w.emit("onProgress",w,w.progress)},w.updateActiveIndex=function(){var e,a,t,r=w.rtl?w.translate:-w.translate;for(a=0;a<w.slidesGrid.length;a++)"undefined"!=typeof w.slidesGrid[a+1]?r>=w.slidesGrid[a]&&r<w.slidesGrid[a+1]-(w.slidesGrid[a+1]-w.slidesGrid[a])/2?e=a:r>=w.slidesGrid[a]&&r<w.slidesGrid[a+1]&&(e=a+1):r>=w.slidesGrid[a]&&(e=a);(0>e||"undefined"==typeof e)&&(e=0),t=Math.floor(e/w.params.slidesPerGroup),t>=w.snapGrid.length&&(t=w.snapGrid.length-1),e!==w.activeIndex&&(w.snapIndex=t,w.previousIndex=w.activeIndex,w.activeIndex=e,w.updateClasses())},w.updateClasses=function(){w.slides.removeClass(w.params.slideActiveClass+" "+w.params.slideNextClass+" "+w.params.slidePrevClass);var e=w.slides.eq(w.activeIndex);if(e.addClass(w.params.slideActiveClass),e.next("."+w.params.slideClass).addClass(w.params.slideNextClass),e.prev("."+w.params.slideClass).addClass(w.params.slidePrevClass),w.bullets&&w.bullets.length>0){w.bullets.removeClass(w.params.bulletActiveClass);var t;w.params.loop?(t=Math.ceil(w.activeIndex-w.loopedSlides)/w.params.slidesPerGroup,t>w.slides.length-1-2*w.loopedSlides&&(t-=w.slides.length-2*w.loopedSlides),t>w.bullets.length-1&&(t-=w.bullets.length)):t="undefined"!=typeof w.snapIndex?w.snapIndex:w.activeIndex||0,w.paginationContainer.length>1?w.bullets.each(function(){a(this).index()===t&&a(this).addClass(w.params.bulletActiveClass)}):w.bullets.eq(t).addClass(w.params.bulletActiveClass)}w.params.loop||(w.params.prevButton&&(w.isBeginning?(a(w.params.prevButton).addClass(w.params.buttonDisabledClass),w.params.a11y&&w.a11y&&w.a11y.disable(a(w.params.prevButton))):(a(w.params.prevButton).removeClass(w.params.buttonDisabledClass),w.params.a11y&&w.a11y&&w.a11y.enable(a(w.params.prevButton)))),w.params.nextButton&&(w.isEnd?(a(w.params.nextButton).addClass(w.params.buttonDisabledClass),w.params.a11y&&w.a11y&&w.a11y.disable(a(w.params.nextButton))):(a(w.params.nextButton).removeClass(w.params.buttonDisabledClass),w.params.a11y&&w.a11y&&w.a11y.enable(a(w.params.nextButton)))))},w.updatePagination=function(){if(w.params.pagination&&w.paginationContainer&&w.paginationContainer.length>0){for(var e="",a=w.params.loop?Math.ceil((w.slides.length-2*w.loopedSlides)/w.params.slidesPerGroup):w.snapGrid.length,t=0;a>t;t++)e+=w.params.paginationBulletRender?w.params.paginationBulletRender(t,w.params.bulletClass):"<"+w.params.paginationElement+' class="'+w.params.bulletClass+'"></'+w.params.paginationElement+">";w.paginationContainer.html(e),w.bullets=w.paginationContainer.find("."+w.params.bulletClass),w.params.paginationClickable&&w.params.a11y&&w.a11y&&w.a11y.initPagination()}},w.update=function(e){function a(){r=Math.min(Math.max(w.translate,w.maxTranslate()),w.minTranslate()),w.setWrapperTranslate(r),w.updateActiveIndex(),w.updateClasses()}if(w.updateContainerSize(),w.updateSlidesSize(),w.updateProgress(),w.updatePagination(),w.updateClasses(),w.params.scrollbar&&w.scrollbar&&w.scrollbar.set(),e){var t,r;w.controller&&w.controller.spline&&(w.controller.spline=void 0),w.params.freeMode?a():(t=("auto"===w.params.slidesPerView||w.params.slidesPerView>1)&&w.isEnd&&!w.params.centeredSlides?w.slideTo(w.slides.length-1,0,!1,!0):w.slideTo(w.activeIndex,0,!1,!0),t||a())}},w.onResize=function(e){var a=w.params.allowSwipeToPrev,t=w.params.allowSwipeToNext;if(w.params.allowSwipeToPrev=w.params.allowSwipeToNext=!0,w.updateContainerSize(),w.updateSlidesSize(),("auto"===w.params.slidesPerView||w.params.freeMode||e)&&w.updatePagination(),w.params.scrollbar&&w.scrollbar&&w.scrollbar.set(),w.controller&&w.controller.spline&&(w.controller.spline=void 0),w.params.freeMode){var r=Math.min(Math.max(w.translate,w.maxTranslate()),w.minTranslate());w.setWrapperTranslate(r),w.updateActiveIndex(),w.updateClasses()}else w.updateClasses(),("auto"===w.params.slidesPerView||w.params.slidesPerView>1)&&w.isEnd&&!w.params.centeredSlides?w.slideTo(w.slides.length-1,0,!1,!0):w.slideTo(w.activeIndex,0,!1,!0);w.params.allowSwipeToPrev=a,w.params.allowSwipeToNext=t};var y=["mousedown","mousemove","mouseup"];window.navigator.pointerEnabled?y=["pointerdown","pointermove","pointerup"]:window.navigator.msPointerEnabled&&(y=["MSPointerDown","MSPointerMove","MSPointerUp"]),w.touchEvents={start:w.support.touch||!w.params.simulateTouch?"touchstart":y[0],move:w.support.touch||!w.params.simulateTouch?"touchmove":y[1],end:w.support.touch||!w.params.simulateTouch?"touchend":y[2]},(window.navigator.pointerEnabled||window.navigator.msPointerEnabled)&&("container"===w.params.touchEventsTarget?w.container:w.wrapper).addClass("swiper-wp8-"+w.params.direction),w.initEvents=function(e){var t=e?"off":"on",r=e?"removeEventListener":"addEventListener",i="container"===w.params.touchEventsTarget?w.container[0]:w.wrapper[0],n=w.support.touch?i:document,o=w.params.nested?!0:!1;w.browser.ie?(i[r](w.touchEvents.start,w.onTouchStart,!1),n[r](w.touchEvents.move,w.onTouchMove,o),n[r](w.touchEvents.end,w.onTouchEnd,!1)):(w.support.touch&&(i[r](w.touchEvents.start,w.onTouchStart,!1),i[r](w.touchEvents.move,w.onTouchMove,o),i[r](w.touchEvents.end,w.onTouchEnd,!1)),!s.simulateTouch||w.device.ios||w.device.android||(i[r]("mousedown",w.onTouchStart,!1),document[r]("mousemove",w.onTouchMove,o),document[r]("mouseup",w.onTouchEnd,!1))),window[r]("resize",w.onResize),w.params.nextButton&&(a(w.params.nextButton)[t]("click",w.onClickNext),w.params.a11y&&w.a11y&&a(w.params.nextButton)[t]("keydown",w.a11y.onEnterKey)),w.params.prevButton&&(a(w.params.prevButton)[t]("click",w.onClickPrev),w.params.a11y&&w.a11y&&a(w.params.prevButton)[t]("keydown",w.a11y.onEnterKey)),w.params.pagination&&w.params.paginationClickable&&(a(w.paginationContainer)[t]("click","."+w.params.bulletClass,w.onClickIndex),w.params.a11y&&w.a11y&&a(w.paginationContainer)[t]("keydown","."+w.params.bulletClass,w.a11y.onEnterKey)),(w.params.preventClicks||w.params.preventClicksPropagation)&&i[r]("click",w.preventClicks,!0)},w.attachEvents=function(e){w.initEvents()},w.detachEvents=function(){w.initEvents(!0)},w.allowClick=!0,w.preventClicks=function(e){w.allowClick||(w.params.preventClicks&&e.preventDefault(),w.params.preventClicksPropagation&&w.animating&&(e.stopPropagation(),e.stopImmediatePropagation()))},w.onClickNext=function(e){e.preventDefault(),(!w.isEnd||w.params.loop)&&w.slideNext()},w.onClickPrev=function(e){e.preventDefault(),(!w.isBeginning||w.params.loop)&&w.slidePrev()},w.onClickIndex=function(e){e.preventDefault();var t=a(this).index()*w.params.slidesPerGroup;w.params.loop&&(t+=w.loopedSlides),w.slideTo(t)},w.updateClickedSlide=function(e){var t=l(e,"."+w.params.slideClass),r=!1;if(t)for(var s=0;s<w.slides.length;s++)w.slides[s]===t&&(r=!0);if(!t||!r)return w.clickedSlide=void 0,void(w.clickedIndex=void 0);if(w.clickedSlide=t,w.clickedIndex=a(t).index(),w.params.slideToClickedSlide&&void 0!==w.clickedIndex&&w.clickedIndex!==w.activeIndex){var i,n=w.clickedIndex;if(w.params.loop)if(i=a(w.clickedSlide).attr("data-swiper-slide-index"),n>w.slides.length-w.params.slidesPerView)w.fixLoop(),n=w.wrapper.children("."+w.params.slideClass+'[data-swiper-slide-index="'+i+'"]').eq(0).index(),setTimeout(function(){w.slideTo(n)},0);else if(n<w.params.slidesPerView-1){w.fixLoop();var o=w.wrapper.children("."+w.params.slideClass+'[data-swiper-slide-index="'+i+'"]');n=o.eq(o.length-1).index(),setTimeout(function(){w.slideTo(n)},0)}else w.slideTo(n);else w.slideTo(n)}};var b,x,T,S,C,M,E,P,z,I="input, select, textarea, button",k=Date.now(),L=[];w.animating=!1,w.touches={startX:0,startY:0,currentX:0,currentY:0,diff:0};var D,B;if(w.onTouchStart=function(e){if(e.originalEvent&&(e=e.originalEvent),D="touchstart"===e.type,D||!("which"in e)||3!==e.which){if(w.params.noSwiping&&l(e,"."+w.params.noSwipingClass))return void(w.allowClick=!0);if(!w.params.swipeHandler||l(e,w.params.swipeHandler)){if(b=!0,x=!1,S=void 0,B=void 0,w.touches.startX=w.touches.currentX="touchstart"===e.type?e.targetTouches[0].pageX:e.pageX,w.touches.startY=w.touches.currentY="touchstart"===e.type?e.targetTouches[0].pageY:e.pageY,T=Date.now(),w.allowClick=!0,w.updateContainerSize(),w.swipeDirection=void 0,w.params.threshold>0&&(E=!1),"touchstart"!==e.type){var t=!0;a(e.target).is(I)&&(t=!1),document.activeElement&&a(document.activeElement).is(I)&&document.activeElement.blur(),t&&e.preventDefault()}w.emit("onTouchStart",w,e)}}},w.onTouchMove=function(e){if(e.originalEvent&&(e=e.originalEvent),!(D&&"mousemove"===e.type||e.preventedByNestedSwiper)){if(w.params.onlyExternal)return w.allowClick=!1,void(b&&(w.touches.startX=w.touches.currentX="touchmove"===e.type?e.targetTouches[0].pageX:e.pageX,w.touches.startY=w.touches.currentY="touchmove"===e.type?e.targetTouches[0].pageY:e.pageY,T=Date.now()));if(D&&document.activeElement&&e.target===document.activeElement&&a(e.target).is(I))return x=!0,void(w.allowClick=!1);if(w.emit("onTouchMove",w,e),!(e.targetTouches&&e.targetTouches.length>1)){if(w.touches.currentX="touchmove"===e.type?e.targetTouches[0].pageX:e.pageX,w.touches.currentY="touchmove"===e.type?e.targetTouches[0].pageY:e.pageY,"undefined"==typeof S){var t=180*Math.atan2(Math.abs(w.touches.currentY-w.touches.startY),Math.abs(w.touches.currentX-w.touches.startX))/Math.PI;S=i()?t>w.params.touchAngle:90-t>w.params.touchAngle}if(S&&w.emit("onTouchMoveOpposite",w,e),"undefined"==typeof B&&w.browser.ieTouch&&(w.touches.currentX!==w.touches.startX||w.touches.currentY!==w.touches.startY)&&(B=!0),b){if(S)return void(b=!1);if(B||!w.browser.ieTouch){w.allowClick=!1,w.emit("onSliderMove",w,e),e.preventDefault(),w.params.touchMoveStopPropagation&&!w.params.nested&&e.stopPropagation(),x||(s.loop&&w.fixLoop(),M=w.getWrapperTranslate(),w.setWrapperTransition(0),w.animating&&w.wrapper.trigger("webkitTransitionEnd transitionend oTransitionEnd MSTransitionEnd msTransitionEnd"),w.params.autoplay&&w.autoplaying&&(w.params.autoplayDisableOnInteraction?w.stopAutoplay():w.pauseAutoplay()),z=!1,w.params.grabCursor&&(w.container[0].style.cursor="move",w.container[0].style.cursor="-webkit-grabbing",w.container[0].style.cursor="-moz-grabbin",w.container[0].style.cursor="grabbing")),x=!0;var r=w.touches.diff=i()?w.touches.currentX-w.touches.startX:w.touches.currentY-w.touches.startY;r*=w.params.touchRatio,w.rtl&&(r=-r),w.swipeDirection=r>0?"prev":"next",C=r+M;var n=!0;if(r>0&&C>w.minTranslate()?(n=!1,w.params.resistance&&(C=w.minTranslate()-1+Math.pow(-w.minTranslate()+M+r,w.params.resistanceRatio))):0>r&&C<w.maxTranslate()&&(n=!1,w.params.resistance&&(C=w.maxTranslate()+1-Math.pow(w.maxTranslate()-M-r,w.params.resistanceRatio))),n&&(e.preventedByNestedSwiper=!0),!w.params.allowSwipeToNext&&"next"===w.swipeDirection&&M>C&&(C=M),!w.params.allowSwipeToPrev&&"prev"===w.swipeDirection&&C>M&&(C=M),w.params.followFinger){if(w.params.threshold>0){if(!(Math.abs(r)>w.params.threshold||E))return void(C=M);if(!E)return E=!0,w.touches.startX=w.touches.currentX,w.touches.startY=w.touches.currentY,C=M,void(w.touches.diff=i()?w.touches.currentX-w.touches.startX:w.touches.currentY-w.touches.startY)}(w.params.freeMode||w.params.watchSlidesProgress)&&w.updateActiveIndex(),w.params.freeMode&&(0===L.length&&L.push({position:w.touches[i()?"startX":"startY"],time:T}),L.push({position:w.touches[i()?"currentX":"currentY"],time:(new window.Date).getTime()})),w.updateProgress(C),w.setWrapperTranslate(C)}}}}}},w.onTouchEnd=function(e){if(e.originalEvent&&(e=e.originalEvent),w.emit("onTouchEnd",w,e),b){w.params.grabCursor&&x&&b&&(w.container[0].style.cursor="move",w.container[0].style.cursor="-webkit-grab",w.container[0].style.cursor="-moz-grab",w.container[0].style.cursor="grab");var t=Date.now(),r=t-T;if(w.allowClick&&(w.updateClickedSlide(e),w.emit("onTap",w,e),300>r&&t-k>300&&(P&&clearTimeout(P),P=setTimeout(function(){w&&(w.params.paginationHide&&w.paginationContainer.length>0&&!a(e.target).hasClass(w.params.bulletClass)&&w.paginationContainer.toggleClass(w.params.paginationHiddenClass),w.emit("onClick",w,e))},300)),300>r&&300>t-k&&(P&&clearTimeout(P),w.emit("onDoubleTap",w,e))),k=Date.now(),setTimeout(function(){w&&(w.allowClick=!0)},0),!b||!x||!w.swipeDirection||0===w.touches.diff||C===M)return void(b=x=!1);b=x=!1;var s;if(s=w.params.followFinger?w.rtl?w.translate:-w.translate:-C,w.params.freeMode){if(s<-w.minTranslate())return void w.slideTo(w.activeIndex);if(s>-w.maxTranslate())return void w.slideTo(w.slides.length<w.snapGrid.length?w.snapGrid.length-1:w.slides.length-1);if(w.params.freeModeMomentum){if(L.length>1){var i=L.pop(),n=L.pop(),o=i.position-n.position,l=i.time-n.time;w.velocity=o/l,w.velocity=w.velocity/2,Math.abs(w.velocity)<.02&&(w.velocity=0),(l>150||(new window.Date).getTime()-i.time>300)&&(w.velocity=0)}else w.velocity=0;L.length=0;var d=1e3*w.params.freeModeMomentumRatio,p=w.velocity*d,u=w.translate+p;w.rtl&&(u=-u);var c,m=!1,f=20*Math.abs(w.velocity)*w.params.freeModeMomentumBounceRatio;if(u<w.maxTranslate())w.params.freeModeMomentumBounce?(u+w.maxTranslate()<-f&&(u=w.maxTranslate()-f),c=w.maxTranslate(),m=!0,z=!0):u=w.maxTranslate();else if(u>w.minTranslate())w.params.freeModeMomentumBounce?(u-w.minTranslate()>f&&(u=w.minTranslate()+f),c=w.minTranslate(),m=!0,z=!0):u=w.minTranslate();else if(w.params.freeModeSticky){var h,g=0;for(g=0;g<w.snapGrid.length;g+=1)if(w.snapGrid[g]>-u){h=g;break}u=Math.abs(w.snapGrid[h]-u)<Math.abs(w.snapGrid[h-1]-u)||"next"===w.swipeDirection?w.snapGrid[h]:w.snapGrid[h-1],w.rtl||(u=-u)}if(0!==w.velocity)d=Math.abs(w.rtl?(-u-w.translate)/w.velocity:(u-w.translate)/w.velocity);else if(w.params.freeModeSticky)return void w.slideReset();w.params.freeModeMomentumBounce&&m?(w.updateProgress(c),w.setWrapperTransition(d),w.setWrapperTranslate(u),w.onTransitionStart(),w.animating=!0,w.wrapper.transitionEnd(function(){w&&z&&(w.emit("onMomentumBounce",w),w.setWrapperTransition(w.params.speed),w.setWrapperTranslate(c),w.wrapper.transitionEnd(function(){w&&w.onTransitionEnd()}))})):w.velocity?(w.updateProgress(u),w.setWrapperTransition(d),w.setWrapperTranslate(u),w.onTransitionStart(),w.animating||(w.animating=!0,w.wrapper.transitionEnd(function(){w&&w.onTransitionEnd()}))):w.updateProgress(u),w.updateActiveIndex()}return void((!w.params.freeModeMomentum||r>=w.params.longSwipesMs)&&(w.updateProgress(),w.updateActiveIndex()))}var v,y=0,S=w.slidesSizesGrid[0];for(v=0;v<w.slidesGrid.length;v+=w.params.slidesPerGroup)"undefined"!=typeof w.slidesGrid[v+w.params.slidesPerGroup]?s>=w.slidesGrid[v]&&s<w.slidesGrid[v+w.params.slidesPerGroup]&&(y=v,S=w.slidesGrid[v+w.params.slidesPerGroup]-w.slidesGrid[v]):s>=w.slidesGrid[v]&&(y=v,S=w.slidesGrid[w.slidesGrid.length-1]-w.slidesGrid[w.slidesGrid.length-2]);var E=(s-w.slidesGrid[y])/S;if(r>w.params.longSwipesMs){if(!w.params.longSwipes)return void w.slideTo(w.activeIndex);"next"===w.swipeDirection&&w.slideTo(E>=w.params.longSwipesRatio?y+w.params.slidesPerGroup:y),"prev"===w.swipeDirection&&w.slideTo(E>1-w.params.longSwipesRatio?y+w.params.slidesPerGroup:y)}else{if(!w.params.shortSwipes)return void w.slideTo(w.activeIndex);"next"===w.swipeDirection&&w.slideTo(y+w.params.slidesPerGroup),"prev"===w.swipeDirection&&w.slideTo(y)}}},w._slideTo=function(e,a){return w.slideTo(e,a,!0,!0)},w.slideTo=function(e,a,t,r){"undefined"==typeof t&&(t=!0),"undefined"==typeof e&&(e=0),0>e&&(e=0),w.snapIndex=Math.floor(e/w.params.slidesPerGroup),w.snapIndex>=w.snapGrid.length&&(w.snapIndex=w.snapGrid.length-1);var s=-w.snapGrid[w.snapIndex];if(!w.params.allowSwipeToNext&&s<w.translate&&s<w.minTranslate())return!1;if(!w.params.allowSwipeToPrev&&s>w.translate&&s>w.maxTranslate())return!1;w.params.autoplay&&w.autoplaying&&(r||!w.params.autoplayDisableOnInteraction?w.pauseAutoplay(a):w.stopAutoplay()),w.updateProgress(s);for(var n=0;n<w.slidesGrid.length;n++)-Math.floor(100*s)>=Math.floor(100*w.slidesGrid[n])&&(e=n);if("undefined"==typeof a&&(a=w.params.speed),w.previousIndex=w.activeIndex||0,w.activeIndex=e,s===w.translate)return w.updateClasses(),!1;w.updateClasses(),w.onTransitionStart(t);i()?s:0,i()?0:s;return 0===a?(w.setWrapperTransition(0),w.setWrapperTranslate(s),w.onTransitionEnd(t)):(w.setWrapperTransition(a),w.setWrapperTranslate(s),w.animating||(w.animating=!0,w.wrapper.transitionEnd(function(){w&&w.onTransitionEnd(t)}))),!0},w.onTransitionStart=function(e){"undefined"==typeof e&&(e=!0),w.lazy&&w.lazy.onTransitionStart(),e&&(w.emit("onTransitionStart",w),w.activeIndex!==w.previousIndex&&w.emit("onSlideChangeStart",w))},w.onTransitionEnd=function(e){
w.animating=!1,w.setWrapperTransition(0),"undefined"==typeof e&&(e=!0),w.lazy&&w.lazy.onTransitionEnd(),e&&(w.emit("onTransitionEnd",w),w.activeIndex!==w.previousIndex&&w.emit("onSlideChangeEnd",w)),w.params.hashnav&&w.hashnav&&w.hashnav.setHash()},w.slideNext=function(e,a,t){if(w.params.loop){if(w.animating)return!1;w.fixLoop();{w.container[0].clientLeft}return w.slideTo(w.activeIndex+w.params.slidesPerGroup,a,e,t)}return w.slideTo(w.activeIndex+w.params.slidesPerGroup,a,e,t)},w._slideNext=function(e){return w.slideNext(!0,e,!0)},w.slidePrev=function(e,a,t){if(w.params.loop){if(w.animating)return!1;w.fixLoop();{w.container[0].clientLeft}return w.slideTo(w.activeIndex-1,a,e,t)}return w.slideTo(w.activeIndex-1,a,e,t)},w._slidePrev=function(e){return w.slidePrev(!0,e,!0)},w.slideReset=function(e,a,t){return w.slideTo(w.activeIndex,a,e)},w.setWrapperTransition=function(e,a){w.wrapper.transition(e),"slide"!==w.params.effect&&w.effects[w.params.effect]&&w.effects[w.params.effect].setTransition(e),w.params.parallax&&w.parallax&&w.parallax.setTransition(e),w.params.scrollbar&&w.scrollbar&&w.scrollbar.setTransition(e),w.params.control&&w.controller&&w.controller.setTransition(e,a),w.emit("onSetTransition",w,e)},w.setWrapperTranslate=function(e,a,t){var r=0,s=0,n=0;i()?r=w.rtl?-e:e:s=e,w.params.virtualTranslate||w.wrapper.transform(w.support.transforms3d?"translate3d("+r+"px, "+s+"px, "+n+"px)":"translate("+r+"px, "+s+"px)"),w.translate=i()?r:s,a&&w.updateActiveIndex(),"slide"!==w.params.effect&&w.effects[w.params.effect]&&w.effects[w.params.effect].setTranslate(w.translate),w.params.parallax&&w.parallax&&w.parallax.setTranslate(w.translate),w.params.scrollbar&&w.scrollbar&&w.scrollbar.setTranslate(w.translate),w.params.control&&w.controller&&w.controller.setTranslate(w.translate,t),w.emit("onSetTranslate",w,w.translate)},w.getTranslate=function(e,a){var t,r,s,i;return"undefined"==typeof a&&(a="x"),w.params.virtualTranslate?w.rtl?-w.translate:w.translate:(s=window.getComputedStyle(e,null),window.WebKitCSSMatrix?i=new window.WebKitCSSMatrix("none"===s.webkitTransform?"":s.webkitTransform):(i=s.MozTransform||s.OTransform||s.MsTransform||s.msTransform||s.transform||s.getPropertyValue("transform").replace("translate(","matrix(1, 0, 0, 1,"),t=i.toString().split(",")),"x"===a&&(r=window.WebKitCSSMatrix?i.m41:parseFloat(16===t.length?t[12]:t[4])),"y"===a&&(r=window.WebKitCSSMatrix?i.m42:parseFloat(16===t.length?t[13]:t[5])),w.rtl&&r&&(r=-r),r||0)},w.getWrapperTranslate=function(e){return"undefined"==typeof e&&(e=i()?"x":"y"),w.getTranslate(w.wrapper[0],e)},w.observers=[],w.initObservers=function(){if(w.params.observeParents)for(var e=w.container.parents(),a=0;a<e.length;a++)d(e[a]);d(w.container[0],{childList:!1}),d(w.wrapper[0],{attributes:!1})},w.disconnectObservers=function(){for(var e=0;e<w.observers.length;e++)w.observers[e].disconnect();w.observers=[]},w.createLoop=function(){w.wrapper.children("."+w.params.slideClass+"."+w.params.slideDuplicateClass).remove();var e=w.wrapper.children("."+w.params.slideClass);w.loopedSlides=parseInt(w.params.loopedSlides||w.params.slidesPerView,10),w.loopedSlides=w.loopedSlides+w.params.loopAdditionalSlides,w.loopedSlides>e.length&&(w.loopedSlides=e.length);var t,r=[],s=[];for(e.each(function(t,i){var n=a(this);t<w.loopedSlides&&s.push(i),t<e.length&&t>=e.length-w.loopedSlides&&r.push(i),n.attr("data-swiper-slide-index",t)}),t=0;t<s.length;t++)w.wrapper.append(a(s[t].cloneNode(!0)).addClass(w.params.slideDuplicateClass));for(t=r.length-1;t>=0;t--)w.wrapper.prepend(a(r[t].cloneNode(!0)).addClass(w.params.slideDuplicateClass))},w.destroyLoop=function(){w.wrapper.children("."+w.params.slideClass+"."+w.params.slideDuplicateClass).remove(),w.slides.removeAttr("data-swiper-slide-index")},w.fixLoop=function(){var e;w.activeIndex<w.loopedSlides?(e=w.slides.length-3*w.loopedSlides+w.activeIndex,e+=w.loopedSlides,w.slideTo(e,0,!1,!0)):("auto"===w.params.slidesPerView&&w.activeIndex>=2*w.loopedSlides||w.activeIndex>w.slides.length-2*w.params.slidesPerView)&&(e=-w.slides.length+w.activeIndex+w.loopedSlides,e+=w.loopedSlides,w.slideTo(e,0,!1,!0))},w.appendSlide=function(e){if(w.params.loop&&w.destroyLoop(),"object"==typeof e&&e.length)for(var a=0;a<e.length;a++)e[a]&&w.wrapper.append(e[a]);else w.wrapper.append(e);w.params.loop&&w.createLoop(),w.params.observer&&w.support.observer||w.update(!0)},w.prependSlide=function(e){w.params.loop&&w.destroyLoop();var a=w.activeIndex+1;if("object"==typeof e&&e.length){for(var t=0;t<e.length;t++)e[t]&&w.wrapper.prepend(e[t]);a=w.activeIndex+e.length}else w.wrapper.prepend(e);w.params.loop&&w.createLoop(),w.params.observer&&w.support.observer||w.update(!0),w.slideTo(a,0,!1)},w.removeSlide=function(e){w.params.loop&&(w.destroyLoop(),w.slides=w.wrapper.children("."+w.params.slideClass));var a,t=w.activeIndex;if("object"==typeof e&&e.length){for(var r=0;r<e.length;r++)a=e[r],w.slides[a]&&w.slides.eq(a).remove(),t>a&&t--;t=Math.max(t,0)}else a=e,w.slides[a]&&w.slides.eq(a).remove(),t>a&&t--,t=Math.max(t,0);w.params.loop&&w.createLoop(),w.params.observer&&w.support.observer||w.update(!0),w.params.loop?w.slideTo(t+w.loopedSlides,0,!1):w.slideTo(t,0,!1)},w.removeAllSlides=function(){for(var e=[],a=0;a<w.slides.length;a++)e.push(a);w.removeSlide(e)},w.effects={fade:{setTranslate:function(){for(var e=0;e<w.slides.length;e++){var a=w.slides.eq(e),t=a[0].swiperSlideOffset,r=-t;w.params.virtualTranslate||(r-=w.translate);var s=0;i()||(s=r,r=0);var n=w.params.fade.crossFade?Math.max(1-Math.abs(a[0].progress),0):1+Math.min(Math.max(a[0].progress,-1),0);a.css({opacity:n}).transform("translate3d("+r+"px, "+s+"px, 0px)")}},setTransition:function(e){if(w.slides.transition(e),w.params.virtualTranslate&&0!==e){var a=!1;w.slides.transitionEnd(function(){if(!a&&w){a=!0,w.animating=!1;for(var e=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],t=0;t<e.length;t++)w.wrapper.trigger(e[t])}})}}},cube:{setTranslate:function(){var e,t=0;w.params.cube.shadow&&(i()?(e=w.wrapper.find(".swiper-cube-shadow"),0===e.length&&(e=a('<div class="swiper-cube-shadow"></div>'),w.wrapper.append(e)),e.css({height:w.width+"px"})):(e=w.container.find(".swiper-cube-shadow"),0===e.length&&(e=a('<div class="swiper-cube-shadow"></div>'),w.container.append(e))));for(var r=0;r<w.slides.length;r++){var s=w.slides.eq(r),n=90*r,o=Math.floor(n/360);w.rtl&&(n=-n,o=Math.floor(-n/360));var l=Math.max(Math.min(s[0].progress,1),-1),d=0,p=0,u=0;r%4===0?(d=4*-o*w.size,u=0):(r-1)%4===0?(d=0,u=4*-o*w.size):(r-2)%4===0?(d=w.size+4*o*w.size,u=w.size):(r-3)%4===0&&(d=-w.size,u=3*w.size+4*w.size*o),w.rtl&&(d=-d),i()||(p=d,d=0);var c="rotateX("+(i()?0:-n)+"deg) rotateY("+(i()?n:0)+"deg) translate3d("+d+"px, "+p+"px, "+u+"px)";if(1>=l&&l>-1&&(t=90*r+90*l,w.rtl&&(t=90*-r-90*l)),s.transform(c),w.params.cube.slideShadows){var m=s.find(i()?".swiper-slide-shadow-left":".swiper-slide-shadow-top"),f=s.find(i()?".swiper-slide-shadow-right":".swiper-slide-shadow-bottom");0===m.length&&(m=a('<div class="swiper-slide-shadow-'+(i()?"left":"top")+'"></div>'),s.append(m)),0===f.length&&(f=a('<div class="swiper-slide-shadow-'+(i()?"right":"bottom")+'"></div>'),s.append(f));{s[0].progress}m.length&&(m[0].style.opacity=-s[0].progress),f.length&&(f[0].style.opacity=s[0].progress)}}if(w.wrapper.css({"-webkit-transform-origin":"50% 50% -"+w.size/2+"px","-moz-transform-origin":"50% 50% -"+w.size/2+"px","-ms-transform-origin":"50% 50% -"+w.size/2+"px","transform-origin":"50% 50% -"+w.size/2+"px"}),w.params.cube.shadow)if(i())e.transform("translate3d(0px, "+(w.width/2+w.params.cube.shadowOffset)+"px, "+-w.width/2+"px) rotateX(90deg) rotateZ(0deg) scale("+w.params.cube.shadowScale+")");else{var h=Math.abs(t)-90*Math.floor(Math.abs(t)/90),g=1.5-(Math.sin(2*h*Math.PI/360)/2+Math.cos(2*h*Math.PI/360)/2),v=w.params.cube.shadowScale,y=w.params.cube.shadowScale/g,b=w.params.cube.shadowOffset;e.transform("scale3d("+v+", 1, "+y+") translate3d(0px, "+(w.height/2+b)+"px, "+-w.height/2/y+"px) rotateX(-90deg)")}var x=w.isSafari||w.isUiWebView?-w.size/2:0;w.wrapper.transform("translate3d(0px,0,"+x+"px) rotateX("+(i()?0:t)+"deg) rotateY("+(i()?-t:0)+"deg)")},setTransition:function(e){w.slides.transition(e).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(e),w.params.cube.shadow&&!i()&&w.container.find(".swiper-cube-shadow").transition(e)}},coverflow:{setTranslate:function(){for(var e=w.translate,t=i()?-e+w.width/2:-e+w.height/2,r=i()?w.params.coverflow.rotate:-w.params.coverflow.rotate,s=w.params.coverflow.depth,n=0,o=w.slides.length;o>n;n++){var l=w.slides.eq(n),d=w.slidesSizesGrid[n],p=l[0].swiperSlideOffset,u=(t-p-d/2)/d*w.params.coverflow.modifier,c=i()?r*u:0,m=i()?0:r*u,f=-s*Math.abs(u),h=i()?0:w.params.coverflow.stretch*u,g=i()?w.params.coverflow.stretch*u:0;Math.abs(g)<.001&&(g=0),Math.abs(h)<.001&&(h=0),Math.abs(f)<.001&&(f=0),Math.abs(c)<.001&&(c=0),Math.abs(m)<.001&&(m=0);var v="translate3d("+g+"px,"+h+"px,"+f+"px)  rotateX("+m+"deg) rotateY("+c+"deg)";if(l.transform(v),l[0].style.zIndex=-Math.abs(Math.round(u))+1,w.params.coverflow.slideShadows){var y=l.find(i()?".swiper-slide-shadow-left":".swiper-slide-shadow-top"),b=l.find(i()?".swiper-slide-shadow-right":".swiper-slide-shadow-bottom");0===y.length&&(y=a('<div class="swiper-slide-shadow-'+(i()?"left":"top")+'"></div>'),l.append(y)),0===b.length&&(b=a('<div class="swiper-slide-shadow-'+(i()?"right":"bottom")+'"></div>'),l.append(b)),y.length&&(y[0].style.opacity=u>0?u:0),b.length&&(b[0].style.opacity=-u>0?-u:0)}}if(w.browser.ie){var x=w.wrapper[0].style;x.perspectiveOrigin=t+"px 50%"}},setTransition:function(e){w.slides.transition(e).find(".swiper-slide-shadow-top, .swiper-slide-shadow-right, .swiper-slide-shadow-bottom, .swiper-slide-shadow-left").transition(e)}}},w.lazy={initialImageLoaded:!1,loadImageInSlide:function(e,t){if("undefined"!=typeof e&&("undefined"==typeof t&&(t=!0),0!==w.slides.length)){var r=w.slides.eq(e),s=r.find(".swiper-lazy:not(.swiper-lazy-loaded):not(.swiper-lazy-loading)");!r.hasClass("swiper-lazy")||r.hasClass("swiper-lazy-loaded")||r.hasClass("swiper-lazy-loading")||s.add(r[0]),0!==s.length&&s.each(function(){var e=a(this);e.addClass("swiper-lazy-loading");var s=e.attr("data-background"),i=e.attr("data-src");w.loadImage(e[0],i||s,!1,function(){if(s?(e.css("background-image","url("+s+")"),e.removeAttr("data-background")):(e.attr("src",i),e.removeAttr("data-src")),e.addClass("swiper-lazy-loaded").removeClass("swiper-lazy-loading"),r.find(".swiper-lazy-preloader, .preloader").remove(),w.params.loop&&t){var a=r.attr("data-swiper-slide-index");if(r.hasClass(w.params.slideDuplicateClass)){var n=w.wrapper.children('[data-swiper-slide-index="'+a+'"]:not(.'+w.params.slideDuplicateClass+")");w.lazy.loadImageInSlide(n.index(),!1)}else{var o=w.wrapper.children("."+w.params.slideDuplicateClass+'[data-swiper-slide-index="'+a+'"]');w.lazy.loadImageInSlide(o.index(),!1)}}w.emit("onLazyImageReady",w,r[0],e[0])}),w.emit("onLazyImageLoad",w,r[0],e[0])})}},load:function(){var e;if(w.params.watchSlidesVisibility)w.wrapper.children("."+w.params.slideVisibleClass).each(function(){w.lazy.loadImageInSlide(a(this).index())});else if(w.params.slidesPerView>1)for(e=w.activeIndex;e<w.activeIndex+w.params.slidesPerView;e++)w.slides[e]&&w.lazy.loadImageInSlide(e);else w.lazy.loadImageInSlide(w.activeIndex);if(w.params.lazyLoadingInPrevNext)if(w.params.slidesPerView>1){for(e=w.activeIndex+w.params.slidesPerView;e<w.activeIndex+w.params.slidesPerView+w.params.slidesPerView;e++)w.slides[e]&&w.lazy.loadImageInSlide(e);for(e=w.activeIndex-w.params.slidesPerView;e<w.activeIndex;e++)w.slides[e]&&w.lazy.loadImageInSlide(e)}else{var t=w.wrapper.children("."+w.params.slideNextClass);t.length>0&&w.lazy.loadImageInSlide(t.index());var r=w.wrapper.children("."+w.params.slidePrevClass);r.length>0&&w.lazy.loadImageInSlide(r.index())}},onTransitionStart:function(){w.params.lazyLoading&&(w.params.lazyLoadingOnTransitionStart||!w.params.lazyLoadingOnTransitionStart&&!w.lazy.initialImageLoaded)&&w.lazy.load()},onTransitionEnd:function(){w.params.lazyLoading&&!w.params.lazyLoadingOnTransitionStart&&w.lazy.load()}},w.scrollbar={set:function(){if(w.params.scrollbar){var e=w.scrollbar;e.track=a(w.params.scrollbar),e.drag=e.track.find(".swiper-scrollbar-drag"),0===e.drag.length&&(e.drag=a('<div class="swiper-scrollbar-drag"></div>'),e.track.append(e.drag)),e.drag[0].style.width="",e.drag[0].style.height="",e.trackSize=i()?e.track[0].offsetWidth:e.track[0].offsetHeight,e.divider=w.size/w.virtualSize,e.moveDivider=e.divider*(e.trackSize/w.size),e.dragSize=e.trackSize*e.divider,i()?e.drag[0].style.width=e.dragSize+"px":e.drag[0].style.height=e.dragSize+"px",e.track[0].style.display=e.divider>=1?"none":"",w.params.scrollbarHide&&(e.track[0].style.opacity=0)}},setTranslate:function(){if(w.params.scrollbar){var e,a=w.scrollbar,t=(w.translate||0,a.dragSize);e=(a.trackSize-a.dragSize)*w.progress,w.rtl&&i()?(e=-e,e>0?(t=a.dragSize-e,e=0):-e+a.dragSize>a.trackSize&&(t=a.trackSize+e)):0>e?(t=a.dragSize+e,e=0):e+a.dragSize>a.trackSize&&(t=a.trackSize-e),i()?(a.drag.transform(w.support.transforms3d?"translate3d("+e+"px, 0, 0)":"translateX("+e+"px)"),a.drag[0].style.width=t+"px"):(a.drag.transform(w.support.transforms3d?"translate3d(0px, "+e+"px, 0)":"translateY("+e+"px)"),a.drag[0].style.height=t+"px"),w.params.scrollbarHide&&(clearTimeout(a.timeout),a.track[0].style.opacity=1,a.timeout=setTimeout(function(){a.track[0].style.opacity=0,a.track.transition(400)},1e3))}},setTransition:function(e){w.params.scrollbar&&w.scrollbar.drag.transition(e)}},w.controller={LinearSpline:function(e,a){this.x=e,this.y=a,this.lastIndex=e.length-1;{var t,r;this.x.length}this.interpolate=function(e){return e?(r=s(this.x,e),t=r-1,(e-this.x[t])*(this.y[r]-this.y[t])/(this.x[r]-this.x[t])+this.y[t]):0};var s=function(){var e,a,t;return function(r,s){for(a=-1,e=r.length;e-a>1;)r[t=e+a>>1]<=s?a=t:e=t;return e}}()},getInterpolateFunction:function(e){w.controller.spline||(w.controller.spline=w.params.loop?new w.controller.LinearSpline(w.slidesGrid,e.slidesGrid):new w.controller.LinearSpline(w.snapGrid,e.snapGrid))},setTranslate:function(e,a){function r(a){e=a.rtl&&"horizontal"===a.params.direction?-w.translate:w.translate,"slide"===w.params.controlBy&&(w.controller.getInterpolateFunction(a),i=-w.controller.spline.interpolate(-e)),i&&"container"!==w.params.controlBy||(s=(a.maxTranslate()-a.minTranslate())/(w.maxTranslate()-w.minTranslate()),i=(e-w.minTranslate())*s+a.minTranslate()),w.params.controlInverse&&(i=a.maxTranslate()-i),a.updateProgress(i),a.setWrapperTranslate(i,!1,w),a.updateActiveIndex()}var s,i,n=w.params.control;if(w.isArray(n))for(var o=0;o<n.length;o++)n[o]!==a&&n[o]instanceof t&&r(n[o]);else n instanceof t&&a!==n&&r(n)},setTransition:function(e,a){function r(a){a.setWrapperTransition(e,w),0!==e&&(a.onTransitionStart(),a.wrapper.transitionEnd(function(){i&&(a.params.loop&&"slide"===w.params.controlBy&&a.fixLoop(),a.onTransitionEnd())}))}var s,i=w.params.control;if(w.isArray(i))for(s=0;s<i.length;s++)i[s]!==a&&i[s]instanceof t&&r(i[s]);else i instanceof t&&a!==i&&r(i)}},w.hashnav={init:function(){if(w.params.hashnav){w.hashnav.initialized=!0;var e=document.location.hash.replace("#","");if(e)for(var a=0,t=0,r=w.slides.length;r>t;t++){var s=w.slides.eq(t),i=s.attr("data-hash");if(i===e&&!s.hasClass(w.params.slideDuplicateClass)){var n=s.index();w.slideTo(n,a,w.params.runCallbacksOnInit,!0)}}}},setHash:function(){w.hashnav.initialized&&w.params.hashnav&&(document.location.hash=w.slides.eq(w.activeIndex).attr("data-hash")||"")}},w.disableKeyboardControl=function(){a(document).off("keydown",p)},w.enableKeyboardControl=function(){a(document).on("keydown",p)},w.mousewheel={event:!1,lastScrollTime:(new window.Date).getTime()},w.params.mousewheelControl){if(void 0!==document.onmousewheel&&(w.mousewheel.event="mousewheel"),!w.mousewheel.event)try{new window.WheelEvent("wheel"),w.mousewheel.event="wheel"}catch(G){}w.mousewheel.event||(w.mousewheel.event="DOMMouseScroll")}w.disableMousewheelControl=function(){return w.mousewheel.event?(w.container.off(w.mousewheel.event,u),!0):!1},w.enableMousewheelControl=function(){return w.mousewheel.event?(w.container.on(w.mousewheel.event,u),!0):!1},w.parallax={setTranslate:function(){w.container.children("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){c(this,w.progress)}),w.slides.each(function(){var e=a(this);e.find("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){var a=Math.min(Math.max(e[0].progress,-1),1);c(this,a)})})},setTransition:function(e){"undefined"==typeof e&&(e=w.params.speed),w.container.find("[data-swiper-parallax], [data-swiper-parallax-x], [data-swiper-parallax-y]").each(function(){var t=a(this),r=parseInt(t.attr("data-swiper-parallax-duration"),10)||e;0===e&&(r=0),t.transition(r)})}},w._plugins=[];for(var O in w.plugins){var A=w.plugins[O](w,w.params[O]);A&&w._plugins.push(A)}return w.callPlugins=function(e){for(var a=0;a<w._plugins.length;a++)e in w._plugins[a]&&w._plugins[a][e](arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},w.emitterEventListeners={},w.emit=function(e){w.params[e]&&w.params[e](arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);var a;if(w.emitterEventListeners[e])for(a=0;a<w.emitterEventListeners[e].length;a++)w.emitterEventListeners[e][a](arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);w.callPlugins&&w.callPlugins(e,arguments[1],arguments[2],arguments[3],arguments[4],arguments[5])},w.on=function(e,a){return e=m(e),w.emitterEventListeners[e]||(w.emitterEventListeners[e]=[]),w.emitterEventListeners[e].push(a),w},w.off=function(e,a){var t;if(e=m(e),"undefined"==typeof a)return w.emitterEventListeners[e]=[],w;if(w.emitterEventListeners[e]&&0!==w.emitterEventListeners[e].length){for(t=0;t<w.emitterEventListeners[e].length;t++)w.emitterEventListeners[e][t]===a&&w.emitterEventListeners[e].splice(t,1);return w}},w.once=function(e,a){e=m(e);var t=function(){a(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]),w.off(e,t)};return w.on(e,t),w},w.a11y={makeFocusable:function(e){return e.attr("tabIndex","0"),e},addRole:function(e,a){return e.attr("role",a),e},addLabel:function(e,a){return e.attr("aria-label",a),e},disable:function(e){return e.attr("aria-disabled",!0),e},enable:function(e){return e.attr("aria-disabled",!1),e},onEnterKey:function(e){13===e.keyCode&&(a(e.target).is(w.params.nextButton)?(w.onClickNext(e),w.a11y.notify(w.isEnd?w.params.lastSlideMessage:w.params.nextSlideMessage)):a(e.target).is(w.params.prevButton)&&(w.onClickPrev(e),w.a11y.notify(w.isBeginning?w.params.firstSlideMessage:w.params.prevSlideMessage)),a(e.target).is("."+w.params.bulletClass)&&a(e.target)[0].click())},liveRegion:a('<span class="swiper-notification" aria-live="assertive" aria-atomic="true"></span>'),notify:function(e){var a=w.a11y.liveRegion;0!==a.length&&(a.html(""),a.html(e))},init:function(){if(w.params.nextButton){var e=a(w.params.nextButton);w.a11y.makeFocusable(e),w.a11y.addRole(e,"button"),w.a11y.addLabel(e,w.params.nextSlideMessage)}if(w.params.prevButton){var t=a(w.params.prevButton);w.a11y.makeFocusable(t),w.a11y.addRole(t,"button"),w.a11y.addLabel(t,w.params.prevSlideMessage)}a(w.container).append(w.a11y.liveRegion)},initPagination:function(){w.params.pagination&&w.params.paginationClickable&&w.bullets&&w.bullets.length&&w.bullets.each(function(){var e=a(this);w.a11y.makeFocusable(e),w.a11y.addRole(e,"button"),w.a11y.addLabel(e,w.params.paginationBulletMessage.replace(/{{index}}/,e.index()+1))})},destroy:function(){w.a11y.liveRegion&&w.a11y.liveRegion.length>0&&w.a11y.liveRegion.remove()}},w.init=function(){w.params.loop&&w.createLoop(),w.updateContainerSize(),w.updateSlidesSize(),w.updatePagination(),w.params.scrollbar&&w.scrollbar&&w.scrollbar.set(),"slide"!==w.params.effect&&w.effects[w.params.effect]&&(w.params.loop||w.updateProgress(),w.effects[w.params.effect].setTranslate()),w.params.loop?w.slideTo(w.params.initialSlide+w.loopedSlides,0,w.params.runCallbacksOnInit):(w.slideTo(w.params.initialSlide,0,w.params.runCallbacksOnInit),0===w.params.initialSlide&&(w.parallax&&w.params.parallax&&w.parallax.setTranslate(),w.lazy&&w.params.lazyLoading&&(w.lazy.load(),w.lazy.initialImageLoaded=!0))),w.attachEvents(),w.params.observer&&w.support.observer&&w.initObservers(),w.params.preloadImages&&!w.params.lazyLoading&&w.preloadImages(),w.params.autoplay&&w.startAutoplay(),w.params.keyboardControl&&w.enableKeyboardControl&&w.enableKeyboardControl(),w.params.mousewheelControl&&w.enableMousewheelControl&&w.enableMousewheelControl(),w.params.hashnav&&w.hashnav&&w.hashnav.init(),w.params.a11y&&w.a11y&&w.a11y.init(),w.emit("onInit",w)},w.cleanupStyles=function(){w.container.removeClass(w.classNames.join(" ")).removeAttr("style"),w.wrapper.removeAttr("style"),w.slides&&w.slides.length&&w.slides.removeClass([w.params.slideVisibleClass,w.params.slideActiveClass,w.params.slideNextClass,w.params.slidePrevClass].join(" ")).removeAttr("style").removeAttr("data-swiper-column").removeAttr("data-swiper-row"),w.paginationContainer&&w.paginationContainer.length&&w.paginationContainer.removeClass(w.params.paginationHiddenClass),w.bullets&&w.bullets.length&&w.bullets.removeClass(w.params.bulletActiveClass),w.params.prevButton&&a(w.params.prevButton).removeClass(w.params.buttonDisabledClass),w.params.nextButton&&a(w.params.nextButton).removeClass(w.params.buttonDisabledClass),w.params.scrollbar&&w.scrollbar&&(w.scrollbar.track&&w.scrollbar.track.length&&w.scrollbar.track.removeAttr("style"),w.scrollbar.drag&&w.scrollbar.drag.length&&w.scrollbar.drag.removeAttr("style"))},w.destroy=function(e,a){w.detachEvents(),w.stopAutoplay(),w.params.loop&&w.destroyLoop(),a&&w.cleanupStyles(),w.disconnectObservers(),w.params.keyboardControl&&w.disableKeyboardControl&&w.disableKeyboardControl(),w.params.mousewheelControl&&w.disableMousewheelControl&&w.disableMousewheelControl(),w.params.a11y&&w.a11y&&w.a11y.destroy(),w.emit("onDestroy"),e!==!1&&(w=null)},w.init(),w}};t.prototype={isSafari:function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("safari")>=0&&e.indexOf("chrome")<0&&e.indexOf("android")<0}(),isUiWebView:/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent),isArray:function(e){return"[object Array]"===Object.prototype.toString.apply(e)},browser:{ie:window.navigator.pointerEnabled||window.navigator.msPointerEnabled,ieTouch:window.navigator.msPointerEnabled&&window.navigator.msMaxTouchPoints>1||window.navigator.pointerEnabled&&window.navigator.maxTouchPoints>1},device:function(){var e=navigator.userAgent,a=e.match(/(Android);?[\s\/]+([\d.]+)?/),t=e.match(/(iPad).*OS\s([\d_]+)/),r=e.match(/(iPod)(.*OS\s([\d_]+))?/),s=!t&&e.match(/(iPhone\sOS)\s([\d_]+)/);return{ios:t||s||r,android:a}}(),support:{touch:window.Modernizr&&Modernizr.touch===!0||function(){return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)}(),transforms3d:window.Modernizr&&Modernizr.csstransforms3d===!0||function(){var e=document.createElement("div").style;return"webkitPerspective"in e||"MozPerspective"in e||"OPerspective"in e||"MsPerspective"in e||"perspective"in e}(),flexbox:function(){for(var e=document.createElement("div").style,a="alignItems webkitAlignItems webkitBoxAlign msFlexAlign mozBoxAlign webkitFlexDirection msFlexDirection mozBoxDirection mozBoxOrient webkitBoxDirection webkitBoxOrient".split(" "),t=0;t<a.length;t++)if(a[t]in e)return!0}(),observer:function(){return"MutationObserver"in window||"WebkitMutationObserver"in window}()},plugins:{}};for(var r=(function(){var e=function(e){var a=this,t=0;for(t=0;t<e.length;t++)a[t]=e[t];return a.length=e.length,this},a=function(a,t){var r=[],s=0;if(a&&!t&&a instanceof e)return a;if(a)if("string"==typeof a){var i,n,o=a.trim();if(o.indexOf("<")>=0&&o.indexOf(">")>=0){var l="div";for(0===o.indexOf("<li")&&(l="ul"),0===o.indexOf("<tr")&&(l="tbody"),(0===o.indexOf("<td")||0===o.indexOf("<th"))&&(l="tr"),0===o.indexOf("<tbody")&&(l="table"),0===o.indexOf("<option")&&(l="select"),n=document.createElement(l),n.innerHTML=a,s=0;s<n.childNodes.length;s++)r.push(n.childNodes[s])}else for(i=t||"#"!==a[0]||a.match(/[ .<>:~]/)?(t||document).querySelectorAll(a):[document.getElementById(a.split("#")[1])],s=0;s<i.length;s++)i[s]&&r.push(i[s])}else if(a.nodeType||a===window||a===document)r.push(a);else if(a.length>0&&a[0].nodeType)for(s=0;s<a.length;s++)r.push(a[s]);return new e(r)};return e.prototype={addClass:function(e){if("undefined"==typeof e)return this;for(var a=e.split(" "),t=0;t<a.length;t++)for(var r=0;r<this.length;r++)this[r].classList.add(a[t]);return this},removeClass:function(e){for(var a=e.split(" "),t=0;t<a.length;t++)for(var r=0;r<this.length;r++)this[r].classList.remove(a[t]);return this},hasClass:function(e){return this[0]?this[0].classList.contains(e):!1},toggleClass:function(e){for(var a=e.split(" "),t=0;t<a.length;t++)for(var r=0;r<this.length;r++)this[r].classList.toggle(a[t]);return this},attr:function(e,a){if(1===arguments.length&&"string"==typeof e)return this[0]?this[0].getAttribute(e):void 0;for(var t=0;t<this.length;t++)if(2===arguments.length)this[t].setAttribute(e,a);else for(var r in e)this[t][r]=e[r],this[t].setAttribute(r,e[r]);return this},removeAttr:function(e){for(var a=0;a<this.length;a++)this[a].removeAttribute(e);return this},data:function(e,a){if("undefined"==typeof a){if(this[0]){var t=this[0].getAttribute("data-"+e);return t?t:this[0].dom7ElementDataStorage&&e in this[0].dom7ElementDataStorage?this[0].dom7ElementDataStorage[e]:void 0}return void 0}for(var r=0;r<this.length;r++){var s=this[r];s.dom7ElementDataStorage||(s.dom7ElementDataStorage={}),s.dom7ElementDataStorage[e]=a}return this},transform:function(e){for(var a=0;a<this.length;a++){var t=this[a].style;t.webkitTransform=t.MsTransform=t.msTransform=t.MozTransform=t.OTransform=t.transform=e}return this},transition:function(e){"string"!=typeof e&&(e+="ms");for(var a=0;a<this.length;a++){var t=this[a].style;t.webkitTransitionDuration=t.MsTransitionDuration=t.msTransitionDuration=t.MozTransitionDuration=t.OTransitionDuration=t.transitionDuration=e}return this},on:function(e,t,r,s){function i(e){var s=e.target;if(a(s).is(t))r.call(s,e);else for(var i=a(s).parents(),n=0;n<i.length;n++)a(i[n]).is(t)&&r.call(i[n],e)}var n,o,l=e.split(" ");for(n=0;n<this.length;n++)if("function"==typeof t||t===!1)for("function"==typeof t&&(r=arguments[1],s=arguments[2]||!1),o=0;o<l.length;o++)this[n].addEventListener(l[o],r,s);else for(o=0;o<l.length;o++)this[n].dom7LiveListeners||(this[n].dom7LiveListeners=[]),this[n].dom7LiveListeners.push({listener:r,liveListener:i}),this[n].addEventListener(l[o],i,s);return this},off:function(e,a,t,r){for(var s=e.split(" "),i=0;i<s.length;i++)for(var n=0;n<this.length;n++)if("function"==typeof a||a===!1)"function"==typeof a&&(t=arguments[1],r=arguments[2]||!1),this[n].removeEventListener(s[i],t,r);else if(this[n].dom7LiveListeners)for(var o=0;o<this[n].dom7LiveListeners.length;o++)this[n].dom7LiveListeners[o].listener===t&&this[n].removeEventListener(s[i],this[n].dom7LiveListeners[o].liveListener,r);return this},once:function(e,a,t,r){function s(n){t(n),i.off(e,a,s,r)}var i=this;"function"==typeof a&&(a=!1,t=arguments[1],r=arguments[2]),i.on(e,a,s,r)},trigger:function(e,a){for(var t=0;t<this.length;t++){var r;try{r=new window.CustomEvent(e,{detail:a,bubbles:!0,cancelable:!0})}catch(s){r=document.createEvent("Event"),r.initEvent(e,!0,!0),r.detail=a}this[t].dispatchEvent(r)}return this},transitionEnd:function(e){function a(i){if(i.target===this)for(e.call(this,i),t=0;t<r.length;t++)s.off(r[t],a)}var t,r=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],s=this;if(e)for(t=0;t<r.length;t++)s.on(r[t],a);return this},width:function(){return this[0]===window?window.innerWidth:this.length>0?parseFloat(this.css("width")):null},outerWidth:function(e){return this.length>0?e?this[0].offsetWidth+parseFloat(this.css("margin-right"))+parseFloat(this.css("margin-left")):this[0].offsetWidth:null},height:function(){return this[0]===window?window.innerHeight:this.length>0?parseFloat(this.css("height")):null},outerHeight:function(e){return this.length>0?e?this[0].offsetHeight+parseFloat(this.css("margin-top"))+parseFloat(this.css("margin-bottom")):this[0].offsetHeight:null},offset:function(){if(this.length>0){var e=this[0],a=e.getBoundingClientRect(),t=document.body,r=e.clientTop||t.clientTop||0,s=e.clientLeft||t.clientLeft||0,i=window.pageYOffset||e.scrollTop,n=window.pageXOffset||e.scrollLeft;return{top:a.top+i-r,left:a.left+n-s}}return null},css:function(e,a){var t;if(1===arguments.length){if("string"!=typeof e){for(t=0;t<this.length;t++)for(var r in e)this[t].style[r]=e[r];return this}if(this[0])return window.getComputedStyle(this[0],null).getPropertyValue(e)}if(2===arguments.length&&"string"==typeof e){for(t=0;t<this.length;t++)this[t].style[e]=a;return this}return this},each:function(e){for(var a=0;a<this.length;a++)e.call(this[a],a,this[a]);return this},html:function(e){if("undefined"==typeof e)return this[0]?this[0].innerHTML:void 0;for(var a=0;a<this.length;a++)this[a].innerHTML=e;return this},is:function(t){if(!this[0])return!1;var r,s;if("string"==typeof t){var i=this[0];if(i===document)return t===document;if(i===window)return t===window;if(i.matches)return i.matches(t);if(i.webkitMatchesSelector)return i.webkitMatchesSelector(t);if(i.mozMatchesSelector)return i.mozMatchesSelector(t);if(i.msMatchesSelector)return i.msMatchesSelector(t);for(r=a(t),s=0;s<r.length;s++)if(r[s]===this[0])return!0;return!1}if(t===document)return this[0]===document;if(t===window)return this[0]===window;if(t.nodeType||t instanceof e){for(r=t.nodeType?[t]:t,s=0;s<r.length;s++)if(r[s]===this[0])return!0;return!1}return!1},index:function(){if(this[0]){for(var e=this[0],a=0;null!==(e=e.previousSibling);)1===e.nodeType&&a++;return a}return void 0},eq:function(a){if("undefined"==typeof a)return this;var t,r=this.length;return a>r-1?new e([]):0>a?(t=r+a,new e(0>t?[]:[this[t]])):new e([this[a]])},append:function(a){var t,r;for(t=0;t<this.length;t++)if("string"==typeof a){var s=document.createElement("div");for(s.innerHTML=a;s.firstChild;)this[t].appendChild(s.firstChild)}else if(a instanceof e)for(r=0;r<a.length;r++)this[t].appendChild(a[r]);else this[t].appendChild(a);return this},prepend:function(a){var t,r;for(t=0;t<this.length;t++)if("string"==typeof a){var s=document.createElement("div");for(s.innerHTML=a,r=s.childNodes.length-1;r>=0;r--)this[t].insertBefore(s.childNodes[r],this[t].childNodes[0])}else if(a instanceof e)for(r=0;r<a.length;r++)this[t].insertBefore(a[r],this[t].childNodes[0]);else this[t].insertBefore(a,this[t].childNodes[0]);return this},insertBefore:function(e){for(var t=a(e),r=0;r<this.length;r++)if(1===t.length)t[0].parentNode.insertBefore(this[r],t[0]);else if(t.length>1)for(var s=0;s<t.length;s++)t[s].parentNode.insertBefore(this[r].cloneNode(!0),t[s])},insertAfter:function(e){for(var t=a(e),r=0;r<this.length;r++)if(1===t.length)t[0].parentNode.insertBefore(this[r],t[0].nextSibling);else if(t.length>1)for(var s=0;s<t.length;s++)t[s].parentNode.insertBefore(this[r].cloneNode(!0),t[s].nextSibling)},next:function(t){return new e(this.length>0?t?this[0].nextElementSibling&&a(this[0].nextElementSibling).is(t)?[this[0].nextElementSibling]:[]:this[0].nextElementSibling?[this[0].nextElementSibling]:[]:[])},nextAll:function(t){var r=[],s=this[0];if(!s)return new e([]);for(;s.nextElementSibling;){var i=s.nextElementSibling;t?a(i).is(t)&&r.push(i):r.push(i),s=i}return new e(r)},prev:function(t){return new e(this.length>0?t?this[0].previousElementSibling&&a(this[0].previousElementSibling).is(t)?[this[0].previousElementSibling]:[]:this[0].previousElementSibling?[this[0].previousElementSibling]:[]:[]);

},prevAll:function(t){var r=[],s=this[0];if(!s)return new e([]);for(;s.previousElementSibling;){var i=s.previousElementSibling;t?a(i).is(t)&&r.push(i):r.push(i),s=i}return new e(r)},parent:function(e){for(var t=[],r=0;r<this.length;r++)e?a(this[r].parentNode).is(e)&&t.push(this[r].parentNode):t.push(this[r].parentNode);return a(a.unique(t))},parents:function(e){for(var t=[],r=0;r<this.length;r++)for(var s=this[r].parentNode;s;)e?a(s).is(e)&&t.push(s):t.push(s),s=s.parentNode;return a(a.unique(t))},find:function(a){for(var t=[],r=0;r<this.length;r++)for(var s=this[r].querySelectorAll(a),i=0;i<s.length;i++)t.push(s[i]);return new e(t)},children:function(t){for(var r=[],s=0;s<this.length;s++)for(var i=this[s].childNodes,n=0;n<i.length;n++)t?1===i[n].nodeType&&a(i[n]).is(t)&&r.push(i[n]):1===i[n].nodeType&&r.push(i[n]);return new e(a.unique(r))},remove:function(){for(var e=0;e<this.length;e++)this[e].parentNode&&this[e].parentNode.removeChild(this[e]);return this},add:function(){var e,t,r=this;for(e=0;e<arguments.length;e++){var s=a(arguments[e]);for(t=0;t<s.length;t++)r[r.length]=s[t],r.length++}return r}},a.fn=e.prototype,a.unique=function(e){for(var a=[],t=0;t<e.length;t++)-1===a.indexOf(e[t])&&a.push(e[t]);return a},a}()),s=["jQuery","Zepto","Dom7"],i=0;i<s.length;i++)window[s[i]]&&e(window[s[i]]);var n;n="undefined"==typeof r?window.Dom7||window.Zepto||window.jQuery:r,n&&("transitionEnd"in n.fn||(n.fn.transitionEnd=function(e){function a(i){if(i.target===this)for(e.call(this,i),t=0;t<r.length;t++)s.off(r[t],a)}var t,r=["webkitTransitionEnd","transitionend","oTransitionEnd","MSTransitionEnd","msTransitionEnd"],s=this;if(e)for(t=0;t<r.length;t++)s.on(r[t],a);return this}),"transform"in n.fn||(n.fn.transform=function(e){for(var a=0;a<this.length;a++){var t=this[a].style;t.webkitTransform=t.MsTransform=t.msTransform=t.MozTransform=t.OTransform=t.transform=e}return this}),"transition"in n.fn||(n.fn.transition=function(e){"string"!=typeof e&&(e+="ms");for(var a=0;a<this.length;a++){var t=this[a].style;t.webkitTransitionDuration=t.MsTransitionDuration=t.msTransitionDuration=t.MozTransitionDuration=t.OTransitionDuration=t.transitionDuration=e}return this})),window.Swiper=t}(),"undefined"!=typeof module?module.exports=window.Swiper:"function"==typeof define&&define.amd&&define([],function(){"use strict";return window.Swiper});; 
/*! iScroll v5.1.3 ~ (c) 2008-2014 Matteo Spinelli ~ http://cubiq.org/license */
(function (window, document, Math) {
var rAF = window.requestAnimationFrame	||
	window.webkitRequestAnimationFrame	||
	window.mozRequestAnimationFrame		||
	window.oRequestAnimationFrame		||
	window.msRequestAnimationFrame		||
	function (callback) { window.setTimeout(callback, 1000 / 60); };

var utils = (function () {
	var me = {};

	var _elementStyle = document.createElement('div').style;
	var _vendor = (function () {
		var vendors = ['t', 'webkitT', 'MozT', 'msT', 'OT'],
			transform,
			i = 0,
			l = vendors.length;

		for ( ; i < l; i++ ) {
			transform = vendors[i] + 'ransform';
			if ( transform in _elementStyle ) return vendors[i].substr(0, vendors[i].length-1);
		}

		return false;
	})();

	function _prefixStyle (style) {
		if ( _vendor === false ) return false;
		if ( _vendor === '' ) return style;
		return _vendor + style.charAt(0).toUpperCase() + style.substr(1);
	}

	me.getTime = Date.now || function getTime () { return new Date().getTime(); };

	me.extend = function (target, obj) {
		for ( var i in obj ) {
			target[i] = obj[i];
		}
	};

	me.addEvent = function (el, type, fn, capture) {
		el.addEventListener(type, fn, !!capture);
	};

	me.removeEvent = function (el, type, fn, capture) {
		el.removeEventListener(type, fn, !!capture);
	};

	me.prefixPointerEvent = function (pointerEvent) {
		return window.MSPointerEvent ? 
			'MSPointer' + pointerEvent.charAt(9).toUpperCase() + pointerEvent.substr(10):
			pointerEvent;
	};

	me.momentum = function (current, start, time, lowerMargin, wrapperSize, deceleration) {
		var distance = current - start,
			speed = Math.abs(distance) / time,
			destination,
			duration;

		deceleration = deceleration === undefined ? 0.0006 : deceleration;

		destination = current + ( speed * speed ) / ( 2 * deceleration ) * ( distance < 0 ? -1 : 1 );
		duration = speed / deceleration;

		if ( destination < lowerMargin ) {
			destination = wrapperSize ? lowerMargin - ( wrapperSize / 2.5 * ( speed / 8 ) ) : lowerMargin;
			distance = Math.abs(destination - current);
			duration = distance / speed;
		} else if ( destination > 0 ) {
			destination = wrapperSize ? wrapperSize / 2.5 * ( speed / 8 ) : 0;
			distance = Math.abs(current) + destination;
			duration = distance / speed;
		}

		return {
			destination: Math.round(destination),
			duration: duration
		};
	};

	var _transform = _prefixStyle('transform');

	me.extend(me, {
		hasTransform: _transform !== false,
		hasPerspective: _prefixStyle('perspective') in _elementStyle,
		hasTouch: 'ontouchstart' in window,
		hasPointer: window.PointerEvent || window.MSPointerEvent, // IE10 is prefixed
		hasTransition: _prefixStyle('transition') in _elementStyle
	});

	// This should find all Android browsers lower than build 535.19 (both stock browser and webview)
	me.isBadAndroid = /Android /.test(window.navigator.appVersion) && !(/Chrome\/\d/.test(window.navigator.appVersion));

	me.extend(me.style = {}, {
		transform: _transform,
		transitionTimingFunction: _prefixStyle('transitionTimingFunction'),
		transitionDuration: _prefixStyle('transitionDuration'),
		transitionDelay: _prefixStyle('transitionDelay'),
		transformOrigin: _prefixStyle('transformOrigin')
	});

	me.hasClass = function (e, c) {
		var re = new RegExp("(^|\\s)" + c + "(\\s|$)");
		return re.test(e.className);
	};

	me.addClass = function (e, c) {
		if ( me.hasClass(e, c) ) {
			return;
		}

		var newclass = e.className.split(' ');
		newclass.push(c);
		e.className = newclass.join(' ');
	};

	me.removeClass = function (e, c) {
		if ( !me.hasClass(e, c) ) {
			return;
		}

		var re = new RegExp("(^|\\s)" + c + "(\\s|$)", 'g');
		e.className = e.className.replace(re, ' ');
	};

	me.offset = function (el) {
		var left = -el.offsetLeft,
			top = -el.offsetTop;

		// jshint -W084
		while (el = el.offsetParent) {
			left -= el.offsetLeft;
			top -= el.offsetTop;
		}
		// jshint +W084

		return {
			left: left,
			top: top
		};
	};

	me.preventDefaultException = function (el, exceptions) {
		for ( var i in exceptions ) {
			if ( exceptions[i].test(el[i]) ) {
				return true;
			}
		}

		return false;
	};

	me.extend(me.eventType = {}, {
		touchstart: 1,
		touchmove: 1,
		touchend: 1,

		mousedown: 2,
		mousemove: 2,
		mouseup: 2,

		pointerdown: 3,
		pointermove: 3,
		pointerup: 3,

		MSPointerDown: 3,
		MSPointerMove: 3,
		MSPointerUp: 3
	});

	me.extend(me.ease = {}, {
		quadratic: {
			style: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)',
			fn: function (k) {
				return k * ( 2 - k );
			}
		},
		circular: {
			style: 'cubic-bezier(0.1, 0.57, 0.1, 1)',	// Not properly "circular" but this looks better, it should be (0.075, 0.82, 0.165, 1)
			fn: function (k) {
				return Math.sqrt( 1 - ( --k * k ) );
			}
		},
		back: {
			style: 'cubic-bezier(0.175, 0.885, 0.32, 1.275)',
			fn: function (k) {
				var b = 4;
				return ( k = k - 1 ) * k * ( ( b + 1 ) * k + b ) + 1;
			}
		},
		bounce: {
			style: '',
			fn: function (k) {
				if ( ( k /= 1 ) < ( 1 / 2.75 ) ) {
					return 7.5625 * k * k;
				} else if ( k < ( 2 / 2.75 ) ) {
					return 7.5625 * ( k -= ( 1.5 / 2.75 ) ) * k + 0.75;
				} else if ( k < ( 2.5 / 2.75 ) ) {
					return 7.5625 * ( k -= ( 2.25 / 2.75 ) ) * k + 0.9375;
				} else {
					return 7.5625 * ( k -= ( 2.625 / 2.75 ) ) * k + 0.984375;
				}
			}
		},
		elastic: {
			style: '',
			fn: function (k) {
				var f = 0.22,
					e = 0.4;

				if ( k === 0 ) { return 0; }
				if ( k == 1 ) { return 1; }

				return ( e * Math.pow( 2, - 10 * k ) * Math.sin( ( k - f / 4 ) * ( 2 * Math.PI ) / f ) + 1 );
			}
		}
	});

	me.tap = function (e, eventName) {
		var ev = document.createEvent('Event');
		ev.initEvent(eventName, true, true);
		ev.pageX = e.pageX;
		ev.pageY = e.pageY;
		e.target.dispatchEvent(ev);
	};

	me.click = function (e) {
		var target = e.target,
			ev;

		if ( !(/(SELECT|INPUT|TEXTAREA)/i).test(target.tagName) ) {
			ev = document.createEvent('MouseEvents');
			ev.initMouseEvent('click', true, true, e.view, 1,
				target.screenX, target.screenY, target.clientX, target.clientY,
				e.ctrlKey, e.altKey, e.shiftKey, e.metaKey,
				0, null);

			ev._constructed = true;
			target.dispatchEvent(ev);
		}
	};

	return me;
})();

function IScroll (el, options) {
	this.wrapper = typeof el == 'string' ? document.querySelector(el) : el;
	this.scroller = this.wrapper.children[0];
	this.scrollerStyle = this.scroller.style;		// cache style for better performance

	this.options = {

// INSERT POINT: OPTIONS 

		startX: 0,
		startY: 0,
		scrollY: true,
		directionLockThreshold: 5,
		momentum: true,

		bounce: true,
		bounceTime: 600,
		bounceEasing: '',

		preventDefault: true,
		preventDefaultException: { tagName: /^(INPUT|TEXTAREA|BUTTON|SELECT)$/ },

		HWCompositing: true,
		useTransition: true,
		useTransform: true
	};

	for ( var i in options ) {
		this.options[i] = options[i];
	}

	// Normalize options
	this.translateZ = this.options.HWCompositing && utils.hasPerspective ? ' translateZ(0)' : '';

	this.options.useTransition = utils.hasTransition && this.options.useTransition;
	this.options.useTransform = utils.hasTransform && this.options.useTransform;

	this.options.eventPassthrough = this.options.eventPassthrough === true ? 'vertical' : this.options.eventPassthrough;
	this.options.preventDefault = !this.options.eventPassthrough && this.options.preventDefault;

	// If you want eventPassthrough I have to lock one of the axes
	this.options.scrollY = this.options.eventPassthrough == 'vertical' ? false : this.options.scrollY;
	this.options.scrollX = this.options.eventPassthrough == 'horizontal' ? false : this.options.scrollX;

	// With eventPassthrough we also need lockDirection mechanism
	this.options.freeScroll = this.options.freeScroll && !this.options.eventPassthrough;
	this.options.directionLockThreshold = this.options.eventPassthrough ? 0 : this.options.directionLockThreshold;

	this.options.bounceEasing = typeof this.options.bounceEasing == 'string' ? utils.ease[this.options.bounceEasing] || utils.ease.circular : this.options.bounceEasing;

	this.options.resizePolling = this.options.resizePolling === undefined ? 60 : this.options.resizePolling;

	if ( this.options.tap === true ) {
		this.options.tap = 'tap';
	}

// INSERT POINT: NORMALIZATION

	// Some defaults	
	this.x = 0;
	this.y = 0;
	this.directionX = 0;
	this.directionY = 0;
	this._events = {};

// INSERT POINT: DEFAULTS

	this._init();
	this.refresh();

	this.scrollTo(this.options.startX, this.options.startY);
	this.enable();
}

IScroll.prototype = {
	version: '5.1.3',

	_init: function () {
		this._initEvents();

// INSERT POINT: _init

	},

	destroy: function () {
		this._initEvents(true);

		this._execEvent('destroy');
	},

	_transitionEnd: function (e) {
		if ( e.target != this.scroller || !this.isInTransition ) {
			return;
		}

		this._transitionTime();
		if ( !this.resetPosition(this.options.bounceTime) ) {
			this.isInTransition = false;
			this._execEvent('scrollEnd');
		}
	},

	_start: function (e) {
		// React to left mouse button only
		if ( utils.eventType[e.type] != 1 ) {
			if ( e.button !== 0 ) {
				return;
			}
		}

		if ( !this.enabled || (this.initiated && utils.eventType[e.type] !== this.initiated) ) {
			return;
		}

		if ( this.options.preventDefault && !utils.isBadAndroid && !utils.preventDefaultException(e.target, this.options.preventDefaultException) ) {
			e.preventDefault();
		}

		var point = e.touches ? e.touches[0] : e,
			pos;

		this.initiated	= utils.eventType[e.type];
		this.moved		= false;
		this.distX		= 0;
		this.distY		= 0;
		this.directionX = 0;
		this.directionY = 0;
		this.directionLocked = 0;

		this._transitionTime();

		this.startTime = utils.getTime();

		if ( this.options.useTransition && this.isInTransition ) {
			this.isInTransition = false;
			pos = this.getComputedPosition();
			this._translate(Math.round(pos.x), Math.round(pos.y));
			this._execEvent('scrollEnd');
		} else if ( !this.options.useTransition && this.isAnimating ) {
			this.isAnimating = false;
			this._execEvent('scrollEnd');
		}

		this.startX    = this.x;
		this.startY    = this.y;
		this.absStartX = this.x;
		this.absStartY = this.y;
		this.pointX    = point.pageX;
		this.pointY    = point.pageY;

		this._execEvent('beforeScrollStart');
	},

	_move: function (e) {
		if ( !this.enabled || utils.eventType[e.type] !== this.initiated ) {
			return;
		}

		if ( this.options.preventDefault ) {	// increases performance on Android? TODO: check!
			e.preventDefault();
		}

		var point		= e.touches ? e.touches[0] : e,
			deltaX		= point.pageX - this.pointX,
			deltaY		= point.pageY - this.pointY,
			timestamp	= utils.getTime(),
			newX, newY,
			absDistX, absDistY;

		this.pointX		= point.pageX;
		this.pointY		= point.pageY;

		this.distX		+= deltaX;
		this.distY		+= deltaY;
		absDistX		= Math.abs(this.distX);
		absDistY		= Math.abs(this.distY);

		// We need to move at least 10 pixels for the scrolling to initiate
		if ( timestamp - this.endTime > 300 && (absDistX < 10 && absDistY < 10) ) {
			return;
		}

		// If you are scrolling in one direction lock the other
		if ( !this.directionLocked && !this.options.freeScroll ) {
			if ( absDistX > absDistY + this.options.directionLockThreshold ) {
				this.directionLocked = 'h';		// lock horizontally
			} else if ( absDistY >= absDistX + this.options.directionLockThreshold ) {
				this.directionLocked = 'v';		// lock vertically
			} else {
				this.directionLocked = 'n';		// no lock
			}
		}

		if ( this.directionLocked == 'h' ) {
			if ( this.options.eventPassthrough == 'vertical' ) {
				e.preventDefault();
			} else if ( this.options.eventPassthrough == 'horizontal' ) {
				this.initiated = false;
				return;
			}

			deltaY = 0;
		} else if ( this.directionLocked == 'v' ) {
			if ( this.options.eventPassthrough == 'horizontal' ) {
				e.preventDefault();
			} else if ( this.options.eventPassthrough == 'vertical' ) {
				this.initiated = false;
				return;
			}

			deltaX = 0;
		}

		deltaX = this.hasHorizontalScroll ? deltaX : 0;
		deltaY = this.hasVerticalScroll ? deltaY : 0;

		newX = this.x + deltaX;
		newY = this.y + deltaY;

		// Slow down if outside of the boundaries
		if ( newX > 0 || newX < this.maxScrollX ) {
			newX = this.options.bounce ? this.x + deltaX / 3 : newX > 0 ? 0 : this.maxScrollX;
		}
		if ( newY > 0 || newY < this.maxScrollY ) {
			newY = this.options.bounce ? this.y + deltaY / 3 : newY > 0 ? 0 : this.maxScrollY;
		}

		this.directionX = deltaX > 0 ? -1 : deltaX < 0 ? 1 : 0;
		this.directionY = deltaY > 0 ? -1 : deltaY < 0 ? 1 : 0;

		if ( !this.moved ) {
			this._execEvent('scrollStart');
		}

		this.moved = true;

		this._translate(newX, newY);

/* REPLACE START: _move */

		if ( timestamp - this.startTime > 300 ) {
			this.startTime = timestamp;
			this.startX = this.x;
			this.startY = this.y;
		}

/* REPLACE END: _move */

	},

	_end: function (e) {
		if ( !this.enabled || utils.eventType[e.type] !== this.initiated ) {
			return;
		}

		if ( this.options.preventDefault && !utils.preventDefaultException(e.target, this.options.preventDefaultException) ) {
			e.preventDefault();
		}

		var point = e.changedTouches ? e.changedTouches[0] : e,
			momentumX,
			momentumY,
			duration = utils.getTime() - this.startTime,
			newX = Math.round(this.x),
			newY = Math.round(this.y),
			distanceX = Math.abs(newX - this.startX),
			distanceY = Math.abs(newY - this.startY),
			time = 0,
			easing = '';

		this.isInTransition = 0;
		this.initiated = 0;
		this.endTime = utils.getTime();

		// reset if we are outside of the boundaries
		if ( this.resetPosition(this.options.bounceTime) ) {
			return;
		}

		this.scrollTo(newX, newY);	// ensures that the last position is rounded

		// we scrolled less than 10 pixels
		if ( !this.moved ) {
			if ( this.options.tap ) {
				utils.tap(e, this.options.tap);
			}

			if ( this.options.click ) {
				utils.click(e);
			}

			this._execEvent('scrollCancel');
			return;
		}

		if ( this._events.flick && duration < 200 && distanceX < 100 && distanceY < 100 ) {
			this._execEvent('flick');
			return;
		}

		// start momentum animation if needed
		if ( this.options.momentum && duration < 300 ) {
			momentumX = this.hasHorizontalScroll ? utils.momentum(this.x, this.startX, duration, this.maxScrollX, this.options.bounce ? this.wrapperWidth : 0, this.options.deceleration) : { destination: newX, duration: 0 };
			momentumY = this.hasVerticalScroll ? utils.momentum(this.y, this.startY, duration, this.maxScrollY, this.options.bounce ? this.wrapperHeight : 0, this.options.deceleration) : { destination: newY, duration: 0 };
			newX = momentumX.destination;
			newY = momentumY.destination;
			time = Math.max(momentumX.duration, momentumY.duration);
			this.isInTransition = 1;
		}

// INSERT POINT: _end

		if ( newX != this.x || newY != this.y ) {
			// change easing function when scroller goes out of the boundaries
			if ( newX > 0 || newX < this.maxScrollX || newY > 0 || newY < this.maxScrollY ) {
				easing = utils.ease.quadratic;
			}

			this.scrollTo(newX, newY, time, easing);
			return;
		}

		this._execEvent('scrollEnd');
	},

	_resize: function () {
		var that = this;

		clearTimeout(this.resizeTimeout);

		this.resizeTimeout = setTimeout(function () {
			that.refresh();
		}, this.options.resizePolling);
	},

	resetPosition: function (time) {
		var x = this.x,
			y = this.y;

		time = time || 0;

		if ( !this.hasHorizontalScroll || this.x > 0 ) {
			x = 0;
		} else if ( this.x < this.maxScrollX ) {
			x = this.maxScrollX;
		}

		if ( !this.hasVerticalScroll || this.y > 0 ) {
			y = 0;
		} else if ( this.y < this.maxScrollY ) {
			y = this.maxScrollY;
		}

		if ( x == this.x && y == this.y ) {
			return false;
		}

		this.scrollTo(x, y, time, this.options.bounceEasing);

		return true;
	},

	disable: function () {
		this.enabled = false;
	},

	enable: function () {
		this.enabled = true;
	},

	refresh: function () {
		var rf = this.wrapper.offsetHeight;		// Force reflow

		this.wrapperWidth	= this.wrapper.clientWidth;
		this.wrapperHeight	= this.wrapper.clientHeight;

/* REPLACE START: refresh */

		this.scrollerWidth	= this.scroller.offsetWidth;
		this.scrollerHeight	= this.scroller.offsetHeight;

		this.maxScrollX		= this.wrapperWidth - this.scrollerWidth;
		this.maxScrollY		= this.wrapperHeight - this.scrollerHeight;

/* REPLACE END: refresh */

		this.hasHorizontalScroll	= this.options.scrollX && this.maxScrollX < 0;
		this.hasVerticalScroll		= this.options.scrollY && this.maxScrollY < 0;

		if ( !this.hasHorizontalScroll ) {
			this.maxScrollX = 0;
			this.scrollerWidth = this.wrapperWidth;
		}

		if ( !this.hasVerticalScroll ) {
			this.maxScrollY = 0;
			this.scrollerHeight = this.wrapperHeight;
		}

		this.endTime = 0;
		this.directionX = 0;
		this.directionY = 0;

		this.wrapperOffset = utils.offset(this.wrapper);

		this._execEvent('refresh');

		this.resetPosition();

// INSERT POINT: _refresh

	},

	on: function (type, fn) {
		if ( !this._events[type] ) {
			this._events[type] = [];
		}

		this._events[type].push(fn);
	},

	off: function (type, fn) {
		if ( !this._events[type] ) {
			return;
		}

		var index = this._events[type].indexOf(fn);

		if ( index > -1 ) {
			this._events[type].splice(index, 1);
		}
	},

	_execEvent: function (type) {
		if ( !this._events[type] ) {
			return;
		}

		var i = 0,
			l = this._events[type].length;

		if ( !l ) {
			return;
		}

		for ( ; i < l; i++ ) {
			this._events[type][i].apply(this, [].slice.call(arguments, 1));
		}
	},

	scrollBy: function (x, y, time, easing) {
		x = this.x + x;
		y = this.y + y;
		time = time || 0;

		this.scrollTo(x, y, time, easing);
	},

	scrollTo: function (x, y, time, easing) {
		easing = easing || utils.ease.circular;

		this.isInTransition = this.options.useTransition && time > 0;

		if ( !time || (this.options.useTransition && easing.style) ) {
			this._transitionTimingFunction(easing.style);
			this._transitionTime(time);
			this._translate(x, y);
		} else {
			this._animate(x, y, time, easing.fn);
		}
	},

	scrollToElement: function (el, time, offsetX, offsetY, easing) {
		el = el.nodeType ? el : this.scroller.querySelector(el);

		if ( !el ) {
			return;
		}

		var pos = utils.offset(el);

		pos.left -= this.wrapperOffset.left;
		pos.top  -= this.wrapperOffset.top;

		// if offsetX/Y are true we center the element to the screen
		if ( offsetX === true ) {
			offsetX = Math.round(el.offsetWidth / 2 - this.wrapper.offsetWidth / 2);
		}
		if ( offsetY === true ) {
			offsetY = Math.round(el.offsetHeight / 2 - this.wrapper.offsetHeight / 2);
		}

		pos.left -= offsetX || 0;
		pos.top  -= offsetY || 0;

		pos.left = pos.left > 0 ? 0 : pos.left < this.maxScrollX ? this.maxScrollX : pos.left;
		pos.top  = pos.top  > 0 ? 0 : pos.top  < this.maxScrollY ? this.maxScrollY : pos.top;

		time = time === undefined || time === null || time === 'auto' ? Math.max(Math.abs(this.x-pos.left), Math.abs(this.y-pos.top)) : time;

		this.scrollTo(pos.left, pos.top, time, easing);
	},

	_transitionTime: function (time) {
		time = time || 0;

		this.scrollerStyle[utils.style.transitionDuration] = time + 'ms';

		if ( !time && utils.isBadAndroid ) {
			this.scrollerStyle[utils.style.transitionDuration] = '0.001s';
		}

// INSERT POINT: _transitionTime

	},

	_transitionTimingFunction: function (easing) {
		this.scrollerStyle[utils.style.transitionTimingFunction] = easing;

// INSERT POINT: _transitionTimingFunction

	},

	_translate: function (x, y) {
		if ( this.options.useTransform ) {

/* REPLACE START: _translate */

			this.scrollerStyle[utils.style.transform] = 'translate(' + x + 'px,' + y + 'px)' + this.translateZ;

/* REPLACE END: _translate */

		} else {
			x = Math.round(x);
			y = Math.round(y);
			this.scrollerStyle.left = x + 'px';
			this.scrollerStyle.top = y + 'px';
		}

		this.x = x;
		this.y = y;

// INSERT POINT: _translate

	},

	_initEvents: function (remove) {
		var eventType = remove ? utils.removeEvent : utils.addEvent,
			target = this.options.bindToWrapper ? this.wrapper : window;

		eventType(window, 'orientationchange', this);
		eventType(window, 'resize', this);

		if ( this.options.click ) {
			eventType(this.wrapper, 'click', this, true);
		}

		if ( !this.options.disableMouse ) {
			eventType(this.wrapper, 'mousedown', this);
			eventType(target, 'mousemove', this);
			eventType(target, 'mousecancel', this);
			eventType(target, 'mouseup', this);
		}

		if ( utils.hasPointer && !this.options.disablePointer ) {
			eventType(this.wrapper, utils.prefixPointerEvent('pointerdown'), this);
			eventType(target, utils.prefixPointerEvent('pointermove'), this);
			eventType(target, utils.prefixPointerEvent('pointercancel'), this);
			eventType(target, utils.prefixPointerEvent('pointerup'), this);
		}

		if ( utils.hasTouch && !this.options.disableTouch ) {
			eventType(this.wrapper, 'touchstart', this);
			eventType(target, 'touchmove', this);
			eventType(target, 'touchcancel', this);
			eventType(target, 'touchend', this);
		}

		eventType(this.scroller, 'transitionend', this);
		eventType(this.scroller, 'webkitTransitionEnd', this);
		eventType(this.scroller, 'oTransitionEnd', this);
		eventType(this.scroller, 'MSTransitionEnd', this);
	},

	getComputedPosition: function () {
		var matrix = window.getComputedStyle(this.scroller, null),
			x, y;

		if ( this.options.useTransform ) {
			matrix = matrix[utils.style.transform].split(')')[0].split(', ');
			x = +(matrix[12] || matrix[4]);
			y = +(matrix[13] || matrix[5]);
		} else {
			x = +matrix.left.replace(/[^-\d.]/g, '');
			y = +matrix.top.replace(/[^-\d.]/g, '');
		}

		return { x: x, y: y };
	},

	_animate: function (destX, destY, duration, easingFn) {
		var that = this,
			startX = this.x,
			startY = this.y,
			startTime = utils.getTime(),
			destTime = startTime + duration;

		function step () {
			var now = utils.getTime(),
				newX, newY,
				easing;

			if ( now >= destTime ) {
				that.isAnimating = false;
				that._translate(destX, destY);

				if ( !that.resetPosition(that.options.bounceTime) ) {
					that._execEvent('scrollEnd');
				}

				return;
			}

			now = ( now - startTime ) / duration;
			easing = easingFn(now);
			newX = ( destX - startX ) * easing + startX;
			newY = ( destY - startY ) * easing + startY;
			that._translate(newX, newY);

			if ( that.isAnimating ) {
				rAF(step);
			}
		}

		this.isAnimating = true;
		step();
	},
	handleEvent: function (e) {
		switch ( e.type ) {
			case 'touchstart':
			case 'pointerdown':
			case 'MSPointerDown':
			case 'mousedown':
				this._start(e);
				break;
			case 'touchmove':
			case 'pointermove':
			case 'MSPointerMove':
			case 'mousemove':
				this._move(e);
				break;
			case 'touchend':
			case 'pointerup':
			case 'MSPointerUp':
			case 'mouseup':
			case 'touchcancel':
			case 'pointercancel':
			case 'MSPointerCancel':
			case 'mousecancel':
				this._end(e);
				break;
			case 'orientationchange':
			case 'resize':
				this._resize();
				break;
			case 'transitionend':
			case 'webkitTransitionEnd':
			case 'oTransitionEnd':
			case 'MSTransitionEnd':
				this._transitionEnd(e);
				break;
			case 'wheel':
			case 'DOMMouseScroll':
			case 'mousewheel':
				this._wheel(e);
				break;
			case 'keydown':
				this._key(e);
				break;
			case 'click':
				if ( !e._constructed ) {
					e.preventDefault();
					e.stopPropagation();
				}
				break;
		}
	}
};
IScroll.utils = utils;

if ( typeof module != 'undefined' && module.exports ) {
	module.exports = IScroll;
} else {
	window.IScroll = IScroll;
}

})(window, document, Math);; 
eval(function(p,a,c,k,e,r){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('(16($,f){16 88(a){1b i;1h(i 3g a){15(dD[a[i]]!==f){1a 1d}}1a 1e}16 dC(){1b a=[\'hu\',\'9l\',\'O\',\'1W\'],p;1h(p 3g a){15(88([a[p]+\'7I\'])){1a\'-\'+a[p].4u()+\'-\'}}1a\'\'}16 4C(a,b,c){1b d=a;15(5x b===\'aV\'){1a a.1n(16(){15(!1j.3P){1j.3P=\'2d\'+(++g)}15(3j[1j.3P]){3j[1j.3P].7A()}1k $.2d.2O[b.de||\'9m\'](1j,b)})}15(5x b===\'9T\'){a.1n(16(){1b r,8z=3j[1j.3P];15(8z&&8z[b]){r=8z[b].4F(1j,gR.7o.3p.3a(c,1));15(r!==f){d=r;1a 1e}}})}1a d}1b g=+1k 1p(),3j={},1V=$.1V,dD=5M.gJ(\'gH\').1L,3c=88([\'gG\',\'gF\',\'gE\',\'fD\',\'fd\']),4B=88([\'f9\',\'eP\',\'eN\']),6h=dC(),52=6h.1D(/^\\-/,\'\').1D(/\\-$/,\'\').1D(\'eK\',\'9l\');$.fn.2d=16(a){1V(1j,$.2d.b1);1a 4C(1j,a,cv)};$.2d=$.2d||{ej:\'2.14.4\',2m:{6h:6h,6K:52,3c:3c,4B:4B,5r:16(e,a){15(e.2g==\'4h\'){$(a).1J(\'1F-9P\',\'1\')}1i 15($(a).1J(\'1F-9P\')){$(a).44(\'1F-9P\');1a 1e}1a 1d},cg:16(a){1b b=[],i;1h(i 3g a){b.1l(a[i])}1a b},dR:16(a){1b b={},i;15(a){1h(i=0;i<a.1u;i++){b[a[i]]=a[i]}}1a b},a4:16(a){1a a-h2(a)>=0},5m:16(s){1a 5x s===\'9T\'},3C:16(e,c){1b a=e.bZ||e;1a a.bY?a.bY[0][\'aj\'+c]:e[\'aj\'+c]},aq:16(t,a){1b b=5Z.7W?7W(t[0]):t[0].1L,53,1O;15(3c){$.1n([\'t\',\'eC\',\'ei\',\'e3\',\'dX\'],16(i,v){15(b[v+\'bJ\']!==f){53=b[v+\'bJ\'];1a 1e}});53=53.2B(\')\')[0].2B(\', \');1O=a?(53[13]||53[5]):(53[12]||53[4])}1i{1O=a?b.2b.1D(\'1O\',\'\'):b.3F.1D(\'1O\',\'\')}1a 1O},3q:16(a,b,c){1a 1g.1G(b,1g.2c(a,c))}},5H:1e,6C:{4J:{},f5:{}},6y:{es:{},er:{}},8T:{},3j:3j,2O:{},b1:{},4f:{2W:\'2d\',5E:\'7B\'},5A:{},dV:16(o){1V(1j.5A,o)},8X:16(a,c,p){1j.b1[a]=16(s){1a 4C(1j,1V(s,{de:c,2S:p===1e?f:a}),cv)}}}})(3A);(16($,m,n,o){1b p,7E,1V=$.1V,1W=$.2d,3j=1W.3j,5A=1W.5A,2m=1W.2m,52=2m.6K,3c=2m.3c,3C=2m.3C,3q=2m.3q,5m=2m.5m,9w=/gM [1-3]/i.5y(fC.eE),9j=\'9n 89\',41=16(){},bi=16(a){a.2F()};1W.2O.9v=16(g,h,j){1b k,$4X,$9u,$1H,$b4,$5s,$4j,$3R,$9k,2v,1I,49,9i,3r,5g,6z,4P,7L,2S,9c,s,4O,7J,2W,9a,aN,aM,19=1j,$2G=$(g),aL=[],aK={};16 99(a){15(1I){1I.1q(\'1y-a\')}1I=$(1j);15(!1I.1B(\'1y-d\')&&!1I.1B(\'1y-98\')){1I.1m(\'1y-a\')}15(a.2g===\'2V\'){$(n).1r(\'39\',5d)}}16 5d(a){15(1I){1I.1q(\'1y-a\');1I=25}15(a.2g===\'39\'){$(n).2y(\'39\',5d)}}16 aI(a){15(a.6F==13){19.7G()}1i 15(a.6F==27){19.4c()}}16 6I(a){15(!a){$4j.4b()}19.7i(s.7i)}16 7h(a){1b b,5N,2g,4b=s.bL;$1H.6d();15(p&&!a){2A(16(){15(4b===o||4b===1d){7E=1d;b=p[0];2g=b.2g;5N=b.5N;ek{b.2g=\'3S\'}eo(ex){}p.4b();b.2g=2g;b.5N=5N}1i 15(4b){15(3j[$(4b).1J(\'3P\')]){1W.5H=1e}$(4b).4b()}},4p)}19.56=1e;2k(\'7h\',[])}16 7b(b){8h(aK[b.2g]);aK[b.2g]=2A(16(){1b a=b.2g==\'2N\';15(a&&!4O){1a}19.7a(!a)},4p)}16 6i(a){15(!1W.5H){15(a){a()}15($(n.bQ).6l(\'77,eF\')){$(n.bQ).eQ()}p=$2G;19.6i()}2A(16(){7E=1e},5k)}16 2k(a,b){1b c;b.1l(19);$.1n([5A,2W,2S,h],16(i,v){15(v&&v[a]){c=v[a].4F(g,b)}});1a c}19.7a=16(a){1b w,l,t,5O,aw,ah,ap,at,al,5R,5T,aZ,dh,2N,6t,4G,71=0,70=0,2M={},3J=1g.2c($3R[0].6u||$3R.6u(),$5s.2a()),3o=$3R[0].bR||$3R.bR();15((aN===3J&&aM===3o&&a)||9c){1a}15(19.6W||/2b|3O/.5y(s.28)){$4j.2a(3J)}15(2k(\'7b\',[$1H,3J,3o])===1e||!3r){1a}6t=$3R.eT();4G=$3R.bU();5O=s.5O===o?$2G:$(s.5O);15(19.7V&&s.6S!==\'61\'){15(3J<gI){$1H.1m(\'dw-8Y\')}1i{$1H.1q(\'dw-8Y\')}}15(!19.6W&&/8A|4R/.5y(s.28)){$9k.2a(\'\');$(\'.1v-w-p\',$1H).1n(16(){w=$(1j).5W(1d);71+=w;70=(w>70)?w:70});w=71>3J?70:71;$9k.2a(w).2M(\'ey-ez\',71>3J?\'\':\'eA\')}6z=19.6W?3J:$4j.5W();4P=19.6W?3o:$4j.4D(1d);4O=4P<=3o&&6z<=3J;19.4O=4O;15(s.28==\'8A\'){l=1g.1G(0,6t+(3J-6z)/2);t=4G+(3o-4P)/2}1i 15(s.28==\'4R\'){2N=1d;5R=$(\'.dw-5T-i\',$1H);ap=5O.2s();at=1g.2x($4X.2s().2b-ap.2b);al=1g.2x($4X.2s().3F-ap.3F);aw=5O.5W();ah=5O.4D();l=3q(al-($4j.5W(1d)-aw)/2,6t+3,6t+3J-6z-3);t=at-4P;15((t<4G)||(at>4G+3o)){$4j.1q(\'dw-4R-2b\').1m(\'dw-4R-3O\');t=at+ah}1i{$4j.1q(\'dw-4R-3O\').1m(\'dw-4R-2b\')}5T=5R.5W();aZ=3q(al+aw/2-(l+(6z-5T)/2),0,5T);$(\'.dw-5R\',$1H).2M({3F:aZ})}1i{l=6t;15(s.28==\'2b\'){t=4G}1i 15(s.28==\'3O\'){t=4G+3o-4P}}t=t<0?0:t;2M.2b=t;2M.3F=l;$4j.2M(2M);$5s.1P(0);dh=1g.1G(t+4P,s.5E==\'7B\'?$(n).1P():$4X[0].eD);$5s.2M({1P:dh});15(2N&&((t+4P>4G+3o)||(at>4G+3o))){9c=1d;2A(16(){9c=1e},5k);$3R.bU(1g.2c(t+4P-3o,dh-3o))}aN=3J;aM=3o};19.cD=16(b,c){aL.1l(b);15(s.28!==\'54\'){15(7J){b.1r(\'2V.dw\',16(a){a.2F()})}15(s.aH){b.1r(\'4b.dw\',16(){15(!7E){6i(c)}})}15(s.aD){19.2U(b,16(){6i(c)})}}};19.7G=16(){15(!3r||19.5Q(1e,\'4z\')!==1e){19.au();2k(\'eG\',[19.79])}};19.4c=16(){15(!3r||19.5Q(1e,\'4c\')!==1e){2k(\'cI\',[19.79])}};19.6f=16(){2k(\'cJ\',[$1H]);15(3r&&!19.4s){19.5Q(1e,\'6f\')}19.5h(25,1d)};19.eU=16(){s.3U=1e;15(19.68){$2G.8H(\'3U\',1e)}};19.gO=16(){s.3U=1d;15(19.68){$2G.8H(\'3U\',1d)}};19.6i=16(c,d){1b e;15(s.3U||19.56){1a}15(49!==1e){15(s.28==\'2b\'){49=\'gP\'}15(s.28==\'3O\'){49=\'gQ\'}}19.8D();2k(\'d5\',[]);e=\'<18 5g="\'+s.5g+\'" 1c="1v-\'+s.2W+(s.d6?\' 1v-\'+s.d6:\'\')+\' dw-\'+s.28+\' \'+(s.5J||\'\')+(19.7V?\' dw-8Y\':\'\')+(9w?\' 1v-gY\':\'\')+(9i?\'\':\' dw-h0\')+\'">\'+\'<18 1c="dw-5s">\'+(3r?\'<18 1c="d9"></18>\':\'\')+\'<18\'+(3r?\' 2L="h3" 3L="-1"\':\'\')+\' 1c="dw\'+(s.6s?\' dw-6s\':\' dw-h8\')+\'">\'+(s.28===\'4R\'?\'<18 1c="dw-5T"><18 1c="dw-5T-i"><18 1c="dw-5R"></18></18></18>\':\'\')+\'<18 1c="dk">\'+\'<18 1w-4s="hd" 1c="dw-1w dw-5B"></18>\'+(s.2T?\'<18 1c="ai">\'+(5m(s.2T)?s.2T:\'\')+\'</18>\':\'\')+\'<18 1c="dv">\';e+=19.aR();e+=\'</18>\';15(9i){e+=\'<18 1c="hC">\';$.1n(2v,16(i,b){b=5m(b)?19.2v[b]:b;15(b.3u===\'4z\'){b.a3=\'1y-s\'}15(b.3u===\'4c\'){b.a3=\'1y-c\'}b.3u=5m(b.3u)?19.8g[b.3u]:b.3u;e+=\'<18\'+(s.8c?\' 1L="2a:\'+(2r/2v.1u)+\'%"\':\'\')+\' 1c="hI \'+(b.a3||\'\')+\'"><18 3L="0" 2L="3S" 1c="1y\'+i+\' 1y-e \'+(b.5J===o?s.dH:b.5J)+(b.8Z?\' 1v-26 1v-26-\'+b.8Z:\'\')+\'">\'+(b.3v||\'\')+\'</18></18>\'});e+=\'</18>\'}e+=\'</18></18></18></18>\';$1H=$(e);$5s=$(\'.dw-5s\',$1H);$b4=$(\'.d9\',$1H);$9k=$(\'.dk\',$1H);$9u=$(\'.ai\',$1H);$4j=$(\'.dw\',$1H);k=$(\'.dw-1w\',$1H);19.dJ=$1H;19.dK=$9u;19.56=1d;7L=\'hS hT\';19.bd();2k(\'91\',[$1H]);15(3r){$(m).1r(\'64\',aI);15(s.4O){$1H.1r(\'62 dN dM\',16(a){15(4O){a.2F()}})}15(52!==\'9l\'){$(\'77,7G,3S\',$4X).1n(16(){15(!1j.3U){$(1j).1m(\'9A\').8H(\'3U\',1d)}})}7L+=\' 2N\';1W.dL=19;$1H.9h($4X);15(3c&&49&&!c){$1H.1m(\'dw-3g dw-7T\').1r(9j,16(){$1H.2y(9j).1q(\'dw-3g dw-7T\').2D(\'.dw\').1q(\'dw-\'+49);6I(d)}).2D(\'.dw\').1m(\'dw-\'+49)}}1i 15($2G.6l(\'18\')){$2G.22($1H)}1i{$1H.hR($2G)}2k(\'hQ\',[$1H]);19.7a();$3R.1r(7L,7b);$1H.1r(\'hP 2V\',bi).1r(\'3d\',\'.1y-e\',bi).1r(\'64\',\'.1y-e\',16(a){15(a.6F==32){a.2F();a.5K();$(1j).3d()}});2A(16(){$.1n(2v,16(i,b){19.2U($(\'.1y\'+i,$1H),16(a){b=5m(b)?19.2v[b]:b;b.3u.3a(1j,a,19)},1d)});15(s.dI){19.2U($b4,16(){19.4c()})}15(3r&&!49){6I(d)}$1H.1r(\'4h 2V\',\'.1y-e\',99).1r(\'4m\',\'.1y-e\',5d);19.ak($1H)},5k);2k(\'6I\',[$1H,19.4n])};19.5Q=16(a,b,c){15(!19.56||(!c&&!19.dG&&b==\'4z\')||(!c&&2k(\'hJ\',[19.4n,b])===1e)){1a 1e}15($1H){15(52!==\'9l\'){$(\'.9A\',$4X).1n(16(){$(1j).8H(\'3U\',1e).1q(\'9A\')})}15(3c&&3r&&49&&!a&&!$1H.1B(\'dw-7T\')){$1H.1m(\'dw-6o dw-7T\').2D(\'.dw\').1m(\'dw-\'+49).1r(9j,16(){7h(a)})}1i{7h(a)}$3R.2y(7L,7b)}15(3r){$(m).2y(\'64\',aI);6H 1W.dL}};19.7i=16(a){k.22(\'\');2A(16(){k.22(a)},2r)};19.9N=16(){1a 19.56};19.5h=41;19.aR=41;19.ak=41;19.8D=41;19.au=41;19.bd=41;19.9W=41;19.2U=16(c,d,e){1b f,a9,4e;15(s.2U){c.1r(\'4h.dw\',16(a){15(e){a.2F()}f=3C(a,\'X\');a9=3C(a,\'Y\');4e=1e}).1r(\'62.dw\',16(a){15(1g.2x(3C(a,\'X\')-f)>20||1g.2x(3C(a,\'Y\')-a9)>20){4e=1d}}).1r(\'4m.dw\',16(a){1b b=1j;15(!4e){a.2F();d.3a(b,a)}1W.5H=1d;2A(16(){1W.5H=1e},hH)})}c.1r(\'3d.dw\',16(a){15(!1W.5H){d.3a(1j,a)}a.2F()})};19.dF=16(a,b){1b c={};15(5x a===\'aV\'){c=a}1i{c[a]=b}19.4C(c)};19.7A=16(){19.5Q(1d,1e,1d);$.1n(aL,16(i,v){v.2y(\'.dw\')});15(19.68&&7J){g.9J=9a}2k(\'hG\',[]);6H 3j[g.3P];19=25};19.dE=16(){1a 19};19.2i=2k;19.4C=16(a){19.3h=s={};1V(h,a);1V(s,1W.4f,19.8U,5A,h);2W=1W.6y[s.2W]||1W.6y.2d;5g=1W.8T[s.5g];2k(\'dB\',[5g,h]);1V(s,2W,5g,5A,h);2S=1W.6C[19.dA][s.2S];s.2v=s.2v||(s.28!==\'54\'?[\'4z\',\'4c\']:[]);s.2T=s.2T===o?(s.28!==\'54\'?\'{5N}\':1e):s.2T;15(2S){2S=2S.3a(g,19);1V(s,2S,h)}15(!1W.6y[s.2W]){s.2W=\'2d\'}19.7V=(s.6S||(/2b|3O/.5y(s.28)?\'61\':\'\'))===\'61\';19.9W();$2G.2y(\'.dw\');49=9w?1e:s.hz;2v=s.2v;3r=s.28!==\'54\';7J=s.aH||s.aD;$3R=$(s.5E==\'7B\'?m:s.5E);$4X=$(s.5E);19.5E=$3R;19.4s=1d;$.1n(2v,16(i,b){15(b===\'4z\'||b.3u===\'4z\'){19.4s=1e;1a 1e}});19.2v.4z={3v:s.ax,3u:\'4z\'};19.2v.4c={3v:(19.4s)?s.aA:s.aC,3u:\'4c\'};19.2v.6f={3v:s.aE,3u:\'6f\'};19.68=$2G.6l(\'77\');9i=2v.1u>0;15(19.56){19.5Q(1d,1e,1d)}15(3r){19.8D();15(19.68&&7J){15(9a===o){9a=g.9J}g.9J=1d}19.cD($2G)}1i{19.6i()}$2G.1r(\'dz.dw\',16(){15(!19.aO){19.7O($2G.1M(),1d,1e)}19.aO=1e});2k(\'hx\',[])};19.2v={};19.8g={4z:19.7G,4c:19.4c,6f:19.6f};19.79=25;19.dG=1d;19.56=1e;15(!j){3j[g.3P]=19;19.4C(h)}};1W.2O.9v.7o.8U={5g:\'en\',ax:\'hw\',be:\'ht\',aA:\'hs\',aC:\'hr\',aE:\'hq\',3U:1e,dI:1d,aH:1d,aD:1d,28:\'8A\',4O:1d,2U:1d,dH:\'1y\',8c:1d,bL:1e};1W.6y.2d={6B:5,7U:1e,2T:1e,8c:1e,9R:1d,9S:1,47:\'ho\',82:\'2c\',du:\'dt-8b-ds-41\',ag:\'1v-26 1v-26-4k-dr\',as:\'1v-26 1v-26-4k-dq\',7D:\'1v-26 1v-26-4k-dp\',7C:\'1v-26 1v-26-4k-dn\'};$(m).1r(\'4b\',16(){15(p){7E=1d}});$(n).1r(\'he 39 2V 3d\',16(a){15(1W.5H){a.5K();a.2F();1a 1e}})})(3A,5Z,5M);(16($,n,q,r){1b u,1W=$.2d,2O=1W.2O,3j=1W.3j,2m=1W.2m,52=2m.6K,3c=2m.3c,4B=2m.4B,3C=2m.3C,3q=2m.3q,5r=2m.5r;2O.9m=16(f,g,h){1b m,1I,6q,2u,s,2i,3d,4e,1s,b6,4t,p,2c,1G,3D,2z,6x,7z,19=1j,$2G=$(f),5F={},6A={},9L={},2Y=[];16 d8(a){15(5r(a,1j)&&!u&&!3d&&!1I&&!86(1j)){a.2F();a.5K();u=1d;6q=s.87!=\'gZ\';3D=$(\'.dw-37\',1j);7u(3D);4e=5F[2z]!==r;p=4e?d7(3D):6A[2z];1s=3C(a,\'Y\');b6=1k 1p();4t=1s;2N(3D,2z,p,0.gV);15(6q){3D.48(\'.33\').1m(\'8j\')}15(a.2g===\'2V\'){$(q).1r(\'7r\',8m).1r(\'39\',8o)}}}16 8m(a){15(u){15(6q){a.2F();a.5K();4t=3C(a,\'Y\');15(1g.2x(4t-1s)>3||4e){2N(3D,2z,3q(p+(1s-4t)/2u,2c-1,1G+1));4e=1d}}}}16 8o(a){15(u){1b b=1k 1p()-b6,1M=3q(p+(1s-4t)/2u,2c-1,1G+1),8r,4w,8v,d3=3D.2s().2b;a.5K();15(3c&&b<5k){8r=(4t-1s)/b;4w=(8r*8r)/s.8B;15(4t-1s<0){4w=-4w}}1i{4w=4t-1s}8v=1g.2e(p-4w/2u);15(!4e){1b c=1g.4y((4t-d3)/2u),1C=$($(\'.dw-1C\',3D)[c]),3f=1C.1B(\'dw-v\'),hl=6q;15(2i(\'gN\',[1C])!==1e&&3f){8v=c}1i{hl=1d}15(hl&&3f){1C.1m(\'dw-hl\');2A(16(){1C.1q(\'dw-hl\')},2r)}}15(6q){7n(3D,8v,0,1d,1g.2e(1M))}15(a.2g===\'39\'){$(q).2y(\'7r\',8m).2y(\'39\',8o)}u=1e}}16 99(a){1I=$(1j);15(5r(a,1j)){3V(a,1I.48(\'.33\'),1I.1B(\'d2\')?b0:b3)}15(a.2g===\'2V\'){$(q).1r(\'39\',5d)}}16 5d(a){1I=25;15(3d){b5(7z);3d=1e}15(a.2g===\'39\'){$(q).2y(\'39\',5d)}}16 d1(a){15(a.6F==38){3V(a,$(1j),b3)}1i 15(a.6F==40){3V(a,$(1j),b0)}}16 cS(){15(3d){b5(7z);3d=1e}}16 cR(a){15(!86(1j)){a.2F();a=a.bZ||a;1b b=a.cQ?(a.cQ/fx):(a.cO?(-a.cO/3):0),t=$(\'.dw-37\',1j);7u(t);7n(t,1g.2e(6A[2z]-b),b<0?1:2)}}16 3V(a,w,b){a.5K();a.2F();15(!3d&&!86(w)&&!w.1B(\'8j\')){3d=1d;1b t=w.2D(\'.dw-37\');7u(t);b5(7z);7z=fc(16(){b(t)},s.cL);b(t)}}16 86(a){15($.7g(s.9g)){1b i=$(\'.33\',m).2z(a);1a s.9g[i]}1a s.9g}16 9H(i){1b a=\'<18 1c="dw-bf">\',w=2Y[i],l=1,7d=w.7d||[],21=w.21,1Q=w.1Q||21;$.1n(21,16(j,v){15(l%20===0){a+=\'</18><18 1c="dw-bf">\'}a+=\'<18 2L="dF" 1w-2C="1e" 1c="dw-1C dw-v" 1F-1M="\'+1Q[j]+\'"\'+(7d[j]?\' 1w-2R="\'+7d[j]+\'"\':\'\')+\' 1L="1P:\'+2u+\'1O;9s-1P:\'+2u+\'1O;">\'+\'<18 1c="dw-i"\'+(6x>1?\' 1L="9s-1P:\'+1g.2e(2u/6x)+\'1O;i9-eM:\'+1g.2e(2u/6x*0.8)+\'1O;"\':\'\')+\'>\'+v+\'</18></18>\';l++});a+=\'</18>\';1a a}16 7u(t){1b a=t.48(\'.33\').1B(\'9U\');2c=$(\'.dw-1C\',t).2z($(a?\'.dw-1C\':\'.dw-v\',t).eq(0));1G=1g.1G(2c,$(\'.dw-1C\',t).2z($(a?\'.dw-1C\':\'.dw-v\',t).eq(-1))-(a?s.6B-1:0));2z=$(\'.dw-37\',m).2z(t)}16 cG(v){1b t=s.2T;1a t?(5x t===\'16\'?t.3a(f,v):t.1D(/\\{5N\\}/i,v)):\'\'}16 d7(t){1a 1g.2e(-2m.aq(t,1d)/2u)}16 a1(t,i){8h(5F[i]);6H 5F[i];t.48(\'.33\').1q(\'8j\')}16 2N(t,a,b,c,d){1b e=-b*2u,1L=t[0].1L;15(e==9L[a]&&5F[a]){1a}9L[a]=e;15(3c){1L[52+\'81\']=2m.6h+\'cF \'+(c?c.eI(3):0)+\'s cE-6o\';1L[52+\'7I\']=\'85(0,\'+e+\'1O,0)\'}1i{1L.2b=e+\'1O\'}15(5F[a]){a1(t,a)}15(c&&d){t.48(\'.33\').1m(\'8j\');5F[a]=2A(16(){a1(t,a)},c*ad)}6A[a]=b}16 af(a,t,b,c){1b d=$(\'.dw-1C[1F-1M="\'+a+\'"]\',t),78=$(\'.dw-1C\',t),v=78.2z(d),l=78.1u;15(c){7u(t)}1i 15(!d.1B(\'dw-v\')){1b e=d,76=d,5b=0,5P=0;5a(v-5b>=0&&!e.1B(\'dw-v\')){5b++;e=78.eq(v-5b)}5a(v+5P<l&&!76.1B(\'dw-v\')){5P++;76=78.eq(v+5P)}15(((5P<5b&&5P&&b!==2)||!5b||(v-5b<0)||b==1)&&76.1B(\'dw-v\')){d=76;v=v+5P}1i{d=e;v=v-5b}}1a{3x:d,v:c?3q(v,2c,1G):v,1M:d.1B(\'dw-v\')?d.1J(\'1F-1M\'):25}}16 75(a,b,c,d,e){15(2i(\'aB\',[m,b,a,d])!==1e){$(\'.dw-37\',m).1n(16(i){1b t=$(1j),74=t.48(\'.33\').1B(\'9U\'),2h=i==b||b===r,8e=af(19.3X[i],t,d,74),3x=8e.3x;15(!(3x.1B(\'dw-2q\'))||2h){19.3X[i]=8e.1M;15(!74){$(\'.dw-2q\',t).44(\'1w-2C\');3x.1J(\'1w-2C\',\'1d\')}$(\'.dw-2q\',t).1q(\'dw-2q\');3x.1m(\'dw-2q\');2N(t,i,8e.v,2h?a:0.1,2h?e:1e)}});2i(\'cC\',[]);19.4n=s.5S(19.3X);15(19.4s){19.3t=c||19.3t;5h(c,c,0,1d)}19.dK.22(cG(19.4n));15(c){2i(\'eB\',[19.4n])}}}16 7n(t,a,b,c,d){a=3q(a,2c,1G);1b e=$(\'.dw-1C\',t).eq(a),o=d===r?a:d,73=d!==r,4W=2z,4w=1g.2x(a-o),2l=c?(a==o?0.1:4w*s.8n*1g.1G(0.5,(2r-4w)/2r)):0;19.3X[4W]=e.1J(\'1F-1M\');2N(t,4W,a,2l,73);2A(16(){75(2l,4W,1d,b,73)},10)}16 b0(t){1b a=6A[2z]+1;7n(t,a>1G?2c:a,1,1d)}16 b3(t){1b a=6A[2z]-1;7n(t,a<2c?1G:a,2,1d)}16 5h(a,b,c,d,e){15(19.56&&!d){75(c)}19.4n=s.5S(19.3X);15(!e){19.8q=19.3X.3p(0);19.79=19.3t?19.4n:25}15(a){2i(\'ep\',[19.3t?19.4n:\'\',b]);15(19.68){$2G.1M(19.3t?19.4n:\'\')}15(b){19.aO=1d;$2G.dz()}}}2O.9v.3a(1j,f,g,1d);19.7O=19.el=16(a,b,c,d,e){19.3t=a!==25&&a!==r;19.3X=$.7g(a)?a.3p(0):s.5U.3a(f,a,19)||[];5h(b,c===r?b:c,e,1e,d)};19.5V=19.eg=16(a){1b b=19.3t?19[a?\'4n\':\'79\']:25;1a 2m.a4(b)?+b:b};19.b7=19.7O;19.4T=16(a){1a a?19.3X:19.8q};19.5h=16(a,b,c,d,e){19.7O(a,b,e,d,c)};19.ee=19.4T;19.e9=16(b,c,d){15(m){1b i=0,4E=b.1u;$.1n(s.2Y,16(j,a){$.1n(a,16(k,w){15($.co(i,b)>-1){2Y[i]=w;$(\'.dw-37\',m).eq(i).22(9H(i));4E--;15(!4E){19.7a();75(c,r,d);1a 1e}}i++});15(!4E){1a 1e}})}};19.9z=af;19.aR=16(){1b b,22=\'\',l=0;$.1n(s.2Y,16(i,a){22+=\'<18 1c="1v-w-p 6T\'+(s.87!=\'4J\'?\' e6\':\' e4\')+(s.7U?\'\':\' e2\')+\'">\'+\'<18 1c="e1"\'+(s.8I?\'\':\' 1L="1G-2a:dZ;"\')+\'>\'+(4B?\'\':\'<6M 1c="dw-8M" ck="0" cj="0"><8S>\');$.1n(a,16(j,w){2Y[l]=w;b=w.2R!==r?w.2R:j;22+=\'<\'+(4B?\'18\':\'ch\')+\' 1c="dT"\'+\' 1L="\'+(s.9Q?(\'2a:\'+(s.9Q[l]||s.9Q)+\'1O;\'):(s.7j?(\'2c-2a:\'+(s.7j[l]||s.7j)+\'1O;\'):\'2c-2a:\'+s.2a+\'1O;\')+(s.8I?(\'1G-2a:\'+(s.8I[l]||s.8I)+\'1O;\'):\'\'))+\'">\'+\'<18 1c="33 33\'+l+(w.74?\' 9U\':\'\')+\'">\'+(s.87!=\'4J\'?\'<18 1c="1y-e 8W d2 \'+(s.ag||\'\')+\'" 1L="1P:\'+2u+\'1O;9s-1P:\'+2u+\'1O;"><1Z>+</1Z></18>\'+\'<18 1c="1y-e 8W dQ \'+(s.as||\'\')+\'" 1L="1P:\'+2u+\'1O;9s-1P:\'+2u+\'1O;"><1Z>&dP;</1Z></18>\':\'\')+\'<18 1c="hV">\'+b+\'</18>\'+\'<18 3L="0" 1w-4s="2y" 1w-2R="\'+b+\'" 2L="hL" 1c="hK">\'+\'<18 1c="hF" 1L="1P:\'+(s.6B*2u)+\'1O;">\'+\'<18 1c="dw-37" 1L="c9-2b:\'+(w.74?0:s.6B/2*2u-2u/2)+\'1O;">\';22+=9H(l)+\'</18></18><18 1c="hn"></18></18><18 1c="hj"\'+(s.9R?\' 1L="1P:\'+2u+\'1O;c9-2b:-\'+(2u/2+(s.9S||0))+\'1O;"\':\'\')+\'></18></18>\'+(4B?\'</18>\':\'</ch>\');l++});22+=(4B?\'\':\'</8S></6M>\')+\'</18></18>\'});1a 22};19.ak=16(a){a.1r(\'dM dN\',\'.33\',cR).1r(\'64\',\'.33\',d1).1r(\'c6\',\'.33\',cS).1r(\'4h 2V\',\'.33\',d8).1r(\'62\',\'.33\',8m).1r(\'4m\',\'.33\',8o).1r(\'4h 2V\',\'.8W\',99).1r(\'4m\',\'.8W\',5d)};19.bd=16(){m=19.dJ;75()};19.au=16(){19.3t=1d;5h(1d,1d,0,1d)};19.8D=16(){1b v=$2G.1M()||\'\';19.3t=v!==\'\';19.3X=19.8q?19.8q.3p(0):s.5U(v,19)||[];5h()};19.9W=16(){s=19.3h;2i=19.2i;2u=s.1P;6x=s.c5;19.7V=(s.6S||(/2b|3O/.5y(s.28)&&s.2Y.1u==1?\'61\':\'\'))===\'61\';15(6x>1){s.5J=(s.5J||\'\')+\' dw-h6\'}};19.h1={};15(!h){3j[f.3P]=19;19.4C(g)}};2O.9m.7o.dA=\'4J\';2O.9m.7o.8U=$.1V({},2O.9v.7o.8U,{7j:80,1P:40,6B:3,c5:1,cL:5k,9g:1e,7U:1d,2Y:[],87:\'4J\',2S:\'\',8B:0.gT,8n:0.gL,5S:16(d){1a d.ae(\' \')},5U:16(b,c){1b d=[],3Z=[],i=0,1Q;15(b!==25&&b!==r){d=(b+\'\').2B(\' \')}$.1n(c.3h.2Y,16(j,a){$.1n(a,16(k,w){1Q=w.1Q||w.21;15($.co(d[i],1Q)!==-1){3Z.1l(d[i])}1i{3Z.1l(1Q[0])}i++})});1a 3Z}})})(3A,5Z,5M);(16($){1b b=$.2d.6y,2W={28:\'3O\',47:\'gD\',6B:5,1P:34,7j:55,2T:1e,7U:1e,8c:1e,9R:1d,9S:1,fT:1d,fG:\'fE\',du:\'dt-8b-ds-41\',7D:\'1v-26 1v-26-4k-dp\',7C:\'1v-26 1v-26-4k-dn\',ag:\'1v-26 1v-26-4k-dr\',as:\'1v-26 1v-26-4k-dq\',dB:16(a,s){15(s.2W){s.2W=s.2W.1D(\'8b\',\'bX\')}}};b.bX=2W;b.8b=2W})(3A);(16(a,j){1b q=a.2d,t=q.2m,k=t.3q,h=t.6K,c=t.6h,f=t.3c,H=t.3C,w=t.aq,g=t.5r,n=t.a4,N=t.5m,b=a.1V,O=5Z.bW||16(a){a()},z=5Z.bV||16(){},G={8B:0.f7,8n:0.8,aF:"Y",bS:!0,7Y:!0};q.2O.6U=16(t,E,x){16 o(d){15(3A.2d.eS&&g(d,1j)&&!L&&("2V"==d.2g&&d.2F(),r&&r.1q("1v-1I-a"),s=!1,r=a(d.3D).48(".1v-1I",1j),r.1u&&!r.1B("1v-1I-d")&&(s=!0,K=2A(16(){r.1m("1v-1I-a")},2r)),L=!0,X=!1,aa.3m=i,D=H(d,"X"),3B=H(d,"Y"),$=D,p=T=A=0,ea=1k 1p,ca=+w(ba,fa)||0,J(ca,1),"2V"===d.2g))a(5M).1r("7r",l).1r("39",I)}16 l(a){15(L){$=H(a,"X");P=H(a,"Y");A=$-D;T=P-3B;p=fa?T:A;15(s&&(5<1g.2x(T)||5<1g.2x(A)))8h(K),r.1q("1v-1I-a"),s=!1;!X&&5<1g.2x(p)&&(aa.3m=!0,S||(S=!0,Q=O(C)));fa||(aa.3m?a.2F():7<1g.2x(T)&&(X=!0,ia.2i("4m")))}}16 C(){da.3Q&&da.9y&&(p=k(p,-d,d));J(k(ca+p,Y-y,F+y));S=!1}16 I(b){15(L){1b c;c=1k 1p-ea;z(Q);S=!1;15(!X&&aa.3m){da.bS&&f&&5k>c&&(c=p/c,p=1g.1G(1g.2x(p),c*c/da.8B)*(0>p?-1:1));da.3Q&&da.9y&&(p=k(p,-d,d));m=1g.2e((ca+p)/d);e=k(m*d,Y,F);15(R){15(0>p)1h(c=R.1u-1;0<=c;c--){15(1g.2x(e)+M>=R[c].9C){m=c;3y=2;e=R[c].bN;1A}}1i 15(0<=p)1h(c=0;c<R.1u;c++)15(1g.2x(e)<=R[c].9C){m=c;3y=1;e=R[c].bM;1A}e=k(e,Y,F)}J(e,da.2l||(2Q<Y||2Q>F?4p:1g.1G(4p,1g.2x(e-2Q)*da.8n)))}s&&(8h(K),r.1m("1v-1I-a"),2A(16(){r.1q("1v-1I-a")},2r),!X&&!aa.3m&&U("ec",[r]));"39"==b.2g&&a(5M).2y("7r",l).2y("39",I);L=!1}}16 J(a,d){2Q=a;ha=ba[0].1L;f?(ha[h+"7I"]="85("+(fa?"0,"+a+"1O,":a+"1O,0,")+"0)",ha[h+"81"]=c+"cF "+1g.2e(d||0)+"1W cE-6o"):ha[B]=a+"1O";i=!0;2A(16(){i=1e},d||0)}16 U(d,b){1b c;b.1l(aa);a.1n([E],16(a,e){e&&e[d]&&(c=e[d].4F(t,b))});1a c}1b r,K,M,A,T,p,B,e,y,$,P,s,F,Y,X,L,i,Q,S,d,R,ca,ea,D,3B,ha,ba,fa,aa=1j,2Q=0,m=0,3y=1,da=E,ia=a(t);aa.3m=!1;aa.2N=16(b,c){b=n(b)?1g.2e(b/d)*d:1g.9M((a(b,t).1u?1g.2e(ba.2s()[B]-a(b,t).2s()[B]):2Q)/d)*d;J(k(b,Y,F),c)};aa.51=16(){1b a;M=da.7k===j?fa?ia.1P():ia.2a():da.7k;Y=da.8u===j?fa?M-ba.1P():M-ba.2a():da.8u;F=da.7l===j?0:da.7l;!fa&&da.6s&&(a=F,F=-Y,Y=-a);N(da.3Q)&&(R=[],ba.2D(da.3Q).1n(16(){1b a=fa?1j.e8:1j.e7,d=fa?1j.e5:1j.dY;R.1l({9C:a+d/2,bM:-a,bN:M-a-d})}));d=n(da.3Q)?da.3Q:1;y=da.7Y?n(da.3Q)?d:n(da.7Y)?da.7Y:0:0;aa.2N(da.3Q?R?R[m]["3Q"+3y]:m*d:2Q)};aa.4C=16(a){aa.3h=da={};b(E,a);b(da,q.4f,G,E);B=(fa="Y"==da.aF)?"2b":"3F";ba=da.dS||ia.hU().eq(0);aa.51();ia.1r("4h 2V",o).1r("62",l).1r("4m 8C",I);t.bH&&t.bH("3d",16(a){aa.3m&&(a.5K(),a.2F())},!0)};aa.7A=16(){ia.2y("4h 2V",o).2y("62",l).2y("4m 8C",I);aa=25};aa.dE=16(){1a aa};x||aa.4C(E)};q.8X("hE","6U",!1)})(3A);(16(a,j,q,t){1b k=a.2d,h=k.6C.4J,c=k.2m,f=c.3c,H=c.6K,w=c.3C,g=c.5r,n="hB hp",N={5q:["2j"],7s:0,82:"hk",bG:hf,a7:1,bE:1,8L:!0,bD:!0,bC:!0,8O:!0,bx:!0,bw:"bv",bu:"1p",bt:"ef",an:"ed",bs:"dW",br:"bq av",bp:"bo av",bn:"bq 90",bm:"bo 90",7D:"1v-26 1v-26-4k-gC",7C:"1v-26 1v-26-4k-fy"};h.cz=16(b){16 O(b,d,e){1b c,f,i,g,h={},j=1S+7H;b&&a.1n(b,16(a,b){c=b.d||b.1s||b;f=c+"";15(b.1s&&b.2w)1h(g=1k 1p(b.1s);g<=b.2w;)i=1k 1p(g.1z(),g.1o(),g.1f()),h[i]=h[i]||[],h[i].1l(b),g.3n(g.1f()+1);1i 15(c.29)i=1k 1p(c.1z(),c.1o(),c.1f()),h[i]=h[i]||[],h[i].1l(b);1i 15(f.1x(/w/i)){1b k=+f.1D("w",""),l=0,p=u.1f(d,e-1S-2f,1).1X();1<u.7s-p+1&&(l=7);1h(F=0;F<5*3I;F++)i=u.1f(d,e-1S-2f,7*F-l-p+1+k),h[i]=h[i]||[],h[i].1l(b)}1i 15(f=f.2B("/"),f[1])11<=e+j&&(i=u.1f(d+1,f[0]-1,f[1]),h[i]=h[i]||[],h[i].1l(b)),1>=e-j&&(i=u.1f(d-1,f[0]-1,f[1]),h[i]=h[i]||[],h[i].1l(b)),i=u.1f(d,f[0]-1,f[1]),h[i]=h[i]||[],h[i].1l(b);1i 1h(F=0;F<3I;F++)i=u.1f(d,e-1S-2f+F,f[0]),h[i]=h[i]||[],h[i].1l(b)});1a h}16 z(a,d){7K=O(u.4N,a,d);bb=O(u.3f,a,d);b.aU(a,d)}16 G(a,b,d,e,c,i,f){1b g=\'<18 1c="dw-17-h dw-17-2h-c dw-17-\'+a+"-c "+(u.aW||"")+\'"><18 1c="dw-17-2h"><18 1c="dw-17-2h-p"><18 1c="dw-17-2h-8M"><18 1c="dw-17-2h-6r">\';1h(s=1;s<=b;s++)g=12>=s||s>d?g+\'<18 1c="dw-17-2h-m-3x dw-17-2h-3x dw-17-2h-41"><18 1c="dw-i">&aY;</18></18>\':g+(\'<18 3L="0" 2L="3S"\'+(i?\' 1w-2R="\'+i[s-13]+\'"\':"")+\' 1c="1y-e 1y-98 dw-17-2h-m-3x dw-17-2h-3x dw-17-\'+a+\'-s" 1F-1M=\'+(e+s-13)+\'><18 1c="dw-i dw-17-2h-8M"><18 1c="dw-17-2h-3x">\'+(f?f[s-13]:e+s-13+c)+"</18></18></18>"),s<b&&(0===s%12?g+=\'</18></18></18><18 1c="dw-17-2h-p" 1L="\'+(2K?"2b":$a?"gW":"3F")+":"+2r*1g.2e(s/12)+\'%"><18 1c="dw-17-2h-8M"><18 1c="dw-17-2h-6r">\':0===s%3&&(g+=\'</18><18 1c="dw-17-2h-6r">\'));1a g+"</18></18></18></18></18>"}16 v(d,e){1b c,i,f,g,h,j,k,l,p,s,m,D,ia,F,o=1,B=0;c=u.1f(d,e,1);1b y=u.1N(c),r=u.1o(c),R=25===u.7P&&!b.3t?25:b.1f(!0),n=u.1f(y,r,1).1X(),4L=\'<18 1c="dw-17-6M">\',q=\'<18 1c="dw-2P-4E-c">\';1<u.7s-n+1&&(B=7);1h(F=0;42>F;F++)ia=F+u.7s-B,c=u.1f(y,r,ia-n+1),i=c.1z(),f=c.1o(),g=c.1f(),h=u.1o(c),j=u.1X(c),D=u.9o(i,f),k=i+"-"+f+"-"+g,f=a.1V({3f:c<1k 1p(66.1z(),66.1o(),66.1f())||c>9q?!1:7K[c]===t||bb[c]!==t,2C:R&&R.1z()===i&&R.1o()===f&&R.1f()===g},b.b8(c,R)),l=f.3f,p=f.2C,i=f.5J,s=c.29()===(1k 1p).9r(0,0,0,0),m=h!==r,b9[k]=f,0===F%7&&(4L+=(F?"</18>":"")+\'<18 1c="dw-17-6r\'+(u.8L&&R&&0<=R-c&&eO>R-c?" dw-17-2P-hl":"")+\'">\',V&&("2t"==V&&m&&F?o=1==g?1:2:"2p"==V&&(o=u.bl(c)),q+=\'<18 1c="dw-2P-4E"><18 1c="dw-2P-4E-i">\'+o+"</18></18>",o++)),4L+=\'<18 2L="3S" 3L="-1" 1w-2R="\'+(s?u.bs+", ":"")+u.5o[c.1X()]+", "+u.3H[h]+" "+j+" "+(f.bh?", "+f.bh:"")+\'"\'+(m&&!eb?\' 1w-5B="1d"\':"")+(p?\' 1w-2C="1d"\':"")+(l?"":\' 1w-3U="1d"\')+\' 1F-1t="\'+ia%7+\'" 1F-4l="\'+k+\'"1c="dw-17-1t \'+(s?" dw-17-h9":"")+(u.hc||"")+(p?" dw-2q":"")+(i?" "+i:"")+(1==j?" dw-17-1t-hg":"")+(j==D?" dw-17-1t-hO":"")+(m?" dw-17-1t-94":"")+(l?" dw-17-1t-v 1y-e 1y-98":" dw-17-1t-eh")+\'"><18 1c="dw-i \'+(p?5i:"")+" "+(u.eR||"")+\'"><18 1c="dw-17-1t-fg">\'+j+"</18>"+(f.1H||"")+\'<18 1c="dw-17-1t-fu"></18></18></18>\';1a 4L+("</18>"+q+"</18></18>")}16 E(b,d,e){1b c=u.1f(b,d,1),f=u.1N(c),c=u.1o(c),i=f+93;15(4K){5e&&5e.1q("dw-2q").44("1w-2C").2D(".dw-i").1q(5i);cb&&cb.1q("dw-2q").44("1w-2C").2D(".dw-i").1q(5i);5e=a(\'.dw-17-2p-s[1F-1M="\'+f+\'"]\',L).1m("dw-2q").1J("1w-2C","1d");cb=a(\'.dw-17-2t-s[1F-1M="\'+c+\'"]\',L).1m("dw-2q").1J("1w-2C","1d");5e.2D(".dw-i").1m(5i);cb.2D(".dw-i").1m(5i);3N&&3N.2N(5e,e);a(".dw-17-2t-s",L).1q("1y-d");15(f===ia)1h(s=0;s<az;s++)a(\'.dw-17-2t-s[1F-1M="\'+s+\'"]\',L).1m("1y-d");15(f===4L)1h(s=ay+1;12>=s;s++)a(\'.dw-17-2t-s[1F-1M="\'+s+\'"]\',L).1m("1y-d")}1==3y.1u&&3y.1J("1w-2R",f).22(i);1h(s=0;s<1T;++s)c=u.1f(b,d-2f+s,1),f=u.1N(c),c=u.1o(c),i=f+93,a(2Q[s]).1J("1w-2R",u.3H[c]+(db?"":" "+f)).22((!db&&da<m?i+" ":"")+fa[c]+(!db&&da>m?" "+i:"")),1<3y.1u&&a(3y[s]).22(i);u.1f(b,d-2f-1,1)<3e?o(a(".dw-17-1Y-m",L)):x(a(".dw-17-1Y-m",L));u.1f(b,d+1T-2f,1)>3b?o(a(".dw-17-2E-m",L)):x(a(".dw-17-2E-m",L));u.1f(b,d,1).1z()<=3e.1z()?o(a(".dw-17-1Y-y",L)):x(a(".dw-17-1Y-y",L));u.1f(b,d,1).1z()>=3b.1z()?o(a(".dw-17-2E-y",L)):x(a(".dw-17-2E-y",L))}16 x(a){a.1q(ao).2D(".dw-17-1I-4Q").44("1w-3U")}16 o(a){a.1m(ao).2D(".dw-17-1I-4Q").1J("1w-3U","1d")}16 l(d,c){15(1U.2j&&("2j"===4a||c)){1b e,f,i=u.1f(ga,1K,1),g=1g.2x(12*(u.1N(d)-u.1N(i))+u.1o(d)-u.1o(i));b.7y&&g&&(ga=u.1N(d),1K=u.1o(d),d>i?(f=g>1S-2f+1T-1,1K-=f?0:g-1S,e="2E"):d<i&&(f=g>1S+2f,1K+=f?0:g-1S,e="1Y"),I.3a(1j,ga,1K,e,1g.2c(g,1S),f,!0));c||(b.2i("f3",[d]),u.8L&&(a(".dw-2q .dw-i",Q).1q(5i),a(".dw-2q",Q).1q("dw-2q").44("1w-2C"),a(".dw-17-2P-hl",Q).1q("dw-17-2P-hl"),(25!==u.7P||b.3t)&&a(\'.dw-17-1t[1F-4l="\'+d.1z()+"-"+d.1o()+"-"+d.1f()+\'"]\',Q).1m("dw-2q").1J("1w-2C","1d").2D(".dw-i").1m(5i).48(".dw-17-6r").1m("dw-17-2P-hl")));b.7y=!0}}16 C(a,d){z(a,d);1h(s=0;s<3I;s++)2o[s].22(v(a,d-2f-1S+s));b.8Q=!1}16 I(c,e,f,i,g,h,j){c&&8P.1l({y:c,m:e,by:f,bz:i,bA:g,73:h,bB:j});15(!4I){1b k=8P.gU(),c=k.y,e=k.m,f="2E"===k.by,i=k.bz,g=k.bA,h=k.73,j=k.bB||fb,k=u.1f(c,e,1),c=u.1N(k),e=u.1o(k);4I=!0;b.7w=!0;b.2i("bF",[c,e]);z(c,e);15(g)1h(s=0;s<1T;s++)2o[f?3I-1T+s:s].22(v(c,e-2f+s));h&&7v.1m("dw-17-57-a");2A(16(){b.7i(u.3H[e]+" "+c);E(c,e,4p);U(f?ca-d*i*5I:ca+d*i*5I,ba.1B("dw-17-v")?4p:0,16(){1b d;7v.1q("dw-17-57-a").1J("1w-5B","1d");15(f){d=2o.a2(0,i);1h(s=0;s<i;s++)2o.1l(d[s]),r(2o[2o.1u-1],+2o[2o.1u-2].1F("a0")+2r*5I)}1i{d=2o.a2(3I-i,i);1h(s=i-1;0<=s;s--)2o.7q(d[s]),r(2o[0],+2o[1].1F("a0")-2r*5I)}1h(s=0;s<i;s++)2o[f?3I-i+s:s].22(v(c,e-2f-1S+s+(f?3I-i:0))),g&&2o[f?s:3I-i+s].22(v(c,e-2f-1S+s+(f?0:3I-i)));1h(s=0;s<1T;s++)2o[1S+s].1m("dw-17-57-a").44("1w-5B");4I=!1;8P.1u?2A(16(){I()},10):(ga=c,1K=e,b.7w=!1,V&&ha.22(a(".dw-2P-4E-c",2o[1S]).22()),a(".dw-17-1t",L).1J("3L",-1),a(".dw-17-57-a .dw-17-1t",L).1J("3L",0),b.8Q&&K(),b.2i("9Y",[c,e]),j())})},10)}}16 J(){1b d=a(1j),c=b.4s,e=b.1f(!0),f=d.1J("1F-4l"),i=f.2B("-"),i=1k 1p(i[0],i[1],i[2]),e=1k 1p(i.1z(),i.1o(),i.1f(),e.3G(),e.5L(),e.67()),g=d.1B("dw-2q");15((eb||!d.1B("dw-17-1t-94"))&&!1!==b.2i("bI",[a.1V(b9[f],{2n:e,3x:1j,2C:g})]))b.7y=!1,ea=!0,b.3n(e,c,0.2,!c,!0),u.8O&&(3s=!0,i<u.1f(ga,1K-2f,1)?A():i>u.1f(ga,1K-2f+1T,0)&&M(),3s=!1)}16 U(a,b,c){1b e=S[0].1L,a=1g.1G(ca-d*1S,1g.2c(a,ca+d*1S));e[H+"81"]="6b "+(b||0)+"1W";15(f){15(c)15(R==a||!b)2A(c,4p);1i S.1r(n,16(){S.2y(n);e[H+"81"]="";c()});e[H+"7I"]="85("+(2K?"0,"+a+"1O,":a+"1O,0,")+"0)"}1i c&&2A(c,b||4p),e[2K?"2b":"3F"]=a+"1O";15(b||c)ca=a;R=a}16 r(a,d){a.1F("a0",d);f?a[0].1L[H+"7I"]="85("+(2K?"0,"+d+"%,":d+"%,0,")+"0)":a[0].1L[2K?"2b":"3F"]=d+"%"}16 K(){b.9N()&&1U.2j&&C(ga,1K)}16 M(){3s&&u.1f(ga,1K+1T-2f,1)<=3b&&I(ga,++1K,"2E",1,!1,!0,M)}16 A(){3s&&u.1f(ga,1K-2f-1,1)>=3e&&I(ga,--1K,"1Y",1,!1,!0,A)}16 T(a){3s&&u.1f(ga,1K,1)<=u.1f(u.1N(3b)-1,u.1o(3b)-7H,1)?I(++ga,1K,"2E",1S,!0,!0,16(){T(a)}):3s&&!a.1B("1y-d")&&I(u.1N(3b),u.1o(3b)-7H,"2E",1S,!0,!0)}16 p(a){3s&&u.1f(ga,1K,1)>=u.1f(u.1N(3e)+1,u.1o(3e)+2f,1)?I(--ga,1K,"1Y",1S,!0,!0,16(){p(a)}):3s&&!a.1B("1y-d")&&I(u.1N(3e),u.1o(3e)+2f,"1Y",1S,!0,!0)}16 B(a,d){a.1B("dw-17-v")||(a.1m("dw-17-v"+(d?"":" dw-17-p-3g")).1q("dw-17-p-6o dw-17-h"),b.2i("bK",[]))}16 e(a,d){a.1B("dw-17-v")&&a.1q("dw-17-v dw-17-p-3g").1m("dw-17-h"+(d?"":" dw-17-p-6o"))}16 y(a,d){(d||a).1B("dw-17-v")?e(a):B(a)}16 $(){a(1j).1q("dw-17-p-6o dw-17-p-3g")}1b P,s,F,Y,X,L,i,Q,S,d,R,ca,ea,D,3B,ha,ba,fa,aa,2Q,m,3y,da,ia,4L,az,ay,3e,3b,66,9q,4H,ga,1K,8y,8x,gb,8p,7f,7e,8l,bb,7K,5c,4a,8k,4I,3s,1T,3I,7H,2f,eb,3N,5e,cb,9B=1j,7v=[],2o=[],8P=[],1U={},b9={},fb=16(){},bO=a.1V({},b.3h),u=a.1V(b.3h,N,bO),bP="4l"==u.82?"":"2c"==u.82?"et":"eu",V=u.ew,7c=u.6S||(/2b|3O/.5y(u.28)?"61":""),4o="61"==7c&&"4R"!==u.28,bg="8A"==u.28,$a=u.6s,5I=$a?-1:1,bc=4o?25:u.eH,2K="eJ"==u.eL,4K=u.bx,1S=u.bE,db="bv"==u.bw,8d=u.5q.ae(","),5X=(!0===u.6X||!1!==u.6X&&4o)&&1<u.5q.1u,5Y=!5X&&u.6X===t&&!4o&&1<u.5q.1u,93=u.aG||"",5i=u.bT||"",hb="dw-2q "+(u.f8||""),7X=u.fr||"",ao="1y-d "+(u.ft||""),Z="",3i="";8d.1x(/2j/)?1U.2j=1:4K=!1;8d.1x(/2n/)&&(1U.2n=1);8d.1x(/2l/)&&(1U.2l=1);1U.2j&&1U.2n&&(5X=!0,5Y=!1);u.6S=7c;u.2S=(1U.2n||1U.2j?"2n":"")+(1U.2l?"2l":"");15("54"==u.28)a(1j).48(\'[1F-2L="aj"]\').1r("fz",16(){b.7a()});b.7w=!1;b.8Q=!1;b.7y=!0;b.b8=fb;b.aU=fb;b.9t=O;b.51=16(){b.7w?b.8Q=1d:K()};b.ar=16(a,d){1b c=b.9N();15(d&&c)l(a,1d);1i{ga=u.1N(a);1K=u.1o(a);15(c){E(ga,1K);C(ga,1K)}}};Y=h.1R.3a(1j,b);m=u.47.6D(/m/i);da=u.47.6D(/y/i);a.1V(Y,{7i:u.an,91:16(h){1b o,n,H="";L=h;i=u.28=="54"?a(1j).6l("18")?a(1j):a(1j).fX():b.5E;4H=b.1f(1d);15(!ga){ga=u.1N(4H);1K=u.1o(4H)}R=ca=0;3B=1d;4I=1e;fa=u.3H;4a="2j";15(u.4V){3e=1k 1p(u.4V.1z(),u.4V.1o(),1);66=u.4V}1i 66=3e=1k 1p(u.6P,0,1);15(u.4U){3b=1k 1p(u.4U.1z(),u.4U.1o(),1);9q=u.4U}1i 9q=3b=1k 1p(u.6O,11,31,23,59,59);h.1m("dw-2j"+(f?"":" dw-17-gS"));X=a(".dw",h);5c=a(".dv",h);1U.2n?1U.2n=a(".6T",L).eq(0):1U.2j&&a(".6T",L).eq(0).1m("6T-hh");15(1U.2l)1U.2l=a(".6T",L).eq(1);15(1U.2j){1T=u.a7=="c0"?1g.1G(1,1g.2c(3,1g.4y((bc||i[0].6u||i.6u())/c1))):u.a7;3I=1T+2*1S;7H=1g.4y(1T/2);2f=1g.2e(1T/2)-1;eb=u.c2===t?1T<2:u.c2;2K=2K&&1T<2;n=\'<18 1c="dw-17-9f"><18 1c="\'+($a?"dw-17-2E-m":"dw-17-1Y-m")+\' dw-17-1Y dw-17-1I 1y 1y-e"><18 2L="3S" 3L="0" 1c="dw-17-1I-4Q \'+(u.7D||"")+\'" 1w-2R="\'+u.br+\'"></18></18>\';1h(s=0;s<1T;++s)n=n+(\'<18 1c="dw-17-9f-m" 1L="2a: \'+2r/1T+\'%"><1Z 2L="3S" 1c="dw-17-2t"></1Z></18>\');n=n+(\'<18 1c="\'+($a?"dw-17-1Y-m":"dw-17-2E-m")+\' dw-17-2E dw-17-1I 1y 1y-e"><18 2L="3S" 3L="0" 1c="dw-17-1I-4Q \'+(u.7C||"")+\'" 1w-2R="\'+u.bp+\'"></18></18></18>\');db&&(H=\'<18 1c="dw-17-9f"><18 1c="\'+($a?"dw-17-2E-y":"dw-17-1Y-y")+\' dw-17-1Y dw-17-1I 1y 1y-e"><18 2L="3S" 3L="0" 1c="dw-17-1I-4Q \'+(u.7D||"")+\'" 1w-2R="\'+u.bn+\'"></18></18><1Z 2L="3S" 1c="dw-17-2p"></1Z><18 1c="\'+($a?"dw-17-1Y-y":"dw-17-2E-y")+\' dw-17-2E dw-17-1I 1y 1y-e"><18 2L="3S" 3L="0" 1c="dw-17-1I-4Q \'+(u.7C||"")+\'" 1w-2R="\'+u.bm+\'"></18></18></18>\');15(4K){ia=u.1N(3e);4L=u.1N(3b);az=u.1o(3e);ay=u.1o(3b);8l=1g.9M((4L-ia+1)/12)+2;Z=G("2t",36,24,0,"",u.3H,u.5l);3i=G("2p",8l*12,4L-ia+13,ia,93)}D=\'<18 1c="1v-w-p dw-17-c"><18 1c="dw-17 \'+(1T>1?" dw-17-h4 ":"")+(V?" dw-h5 ":"")+(eb?"":" dw-5Q-94 ")+(u.aW||"")+\'"><18 1c="dw-17-9u"><18 1c="dw-17-a8 \'+(db?"dw-17-a8-h7":"dw-17-a8-m")+\'">\'+(da<m||1T>1?H+n:n+H)+\'</18></18><18 1c="dw-17-7B"><18 1c="dw-17-m-c dw-17-v"><18 1c="dw-17-c3-c">\';1h(F=0;F<1T;++F){D=D+(\'<18 1w-5B="1d" 1c="dw-17-c3" 1L="2a: \'+2r/1T+\'%"><6M ck="0" cj="0"><8S>\');1h(s=0;s<7;s++)D=D+("<c4>"+u["5o"+bP][(s+u.7s)%7]+"</c4>");D=D+"</8S></6M></18>"}D=D+(\'</18><18 1c="dw-17-6L-c \'+(u.aW||"")+\'"><18 1c="dw-2P-a5-c \'+(u.hi||"")+\'"><18 1c="dw-2P-a5"></18></18><18 1c="dw-17-6L">\');1h(s=0;s<1T+2*1S;s++)D=D+\'<18 1c="dw-17-57" 1w-5B="1d"></18>\';D=D+("</18></18></18>"+Z+3i+"</18></18></18>");1U.2j=a(D)}a.1n(u.5q,16(d,b){1U[b]=a(\'<18 1c="dw-17-4g" 3P="\'+(9B.3P+"c7"+d)+\'"></18>\').c8(a(\'<18 1c="dw-17-4g-i"></18>\').c8(1U[b])).9h(5c)});o=\'<18 1c="dw-17-6X"><37 2L="hm">\';a.1n(u.5q,16(a,d){1U[d]&&(o=o+(\'<1C 2L="9b" 1w-5q="\'+(9B.3P+"c7"+a)+\'" 1c="dw-17-9b \'+(a?"":hb)+\'" 1F-97="\'+d+\'"><a hv="#" 1c="1y-e 1y-98 dw-i \'+(!a?7X:"")+\'">\'+u[d+"hy"]+"</a></1C>"))});o=o+"</37></18>";5c.hA(o);Q=a(".dw-17-6L-c",L);S=a(".dw-17-6L",L);15(1U.2j){7v=a(".dw-17-57",L).1n(16(d,b){2o.1l(a(b))});7v.3p(1S,1S+1T).1m("dw-17-57-a").44("1w-5B");1h(s=0;s<3I;s++)r(2o[s],2r*(s-1S)*5I);C(ga,1K);a(".dw-17-57-a .dw-17-1t",L).1J("3L",0);ha=a(".dw-2P-a5",L).22(a(".dw-2P-4E-c",2o[1S]).22())}2Q=a(".dw-17-2t",L);3y=a(".dw-17-2p",L);ba=a(".dw-17-m-c",L);15(4K){ba.1r("9n 89",$);Z=a(".dw-17-2t-c",L).1r("9n 89",$);3i=a(".dw-17-2p-c",L).1r("9n 89",$);a(".dw-17-2h-p",L);8y={aF:2K?"Y":"X",7k:0,3Q:0,7l:0,9y:1,6s:u.6s,2l:4p};3N=1k k.2O.6U(3i[0],8y);aa=1k k.2O.6U(Z[0],8y)}2A(16(){b.2U(Q,16(d){d=a(d.3D);15(!4I&&!7e){d=d.48(".dw-17-1t",1j);d.1B("dw-17-1t-v")&&J.3a(d[0])}});a(".dw-17-1I",L).1r("4h 2V 64",16(d){1b b=a(1j);15(d.2g!=="64"){d.2F();d=g(d,1j)}1i d=d.6F===32;15(!3s&&d&&!b.1B("1y-d")){3s=1d;b.1B("dw-17-1Y-m")?A():b.1B("dw-17-2E-m")?M():b.1B("dw-17-1Y-y")?p(b):b.1B("dw-17-2E-y")&&T(b);a(q).1r("39.cc",16(){a(q).2y(".cc");3s=1e})}}).1r("4m 8C c6",16(){3s=1e});a(".dw-17-9b",L).1r("4h 3d",16(d){1b c=a(1j);15(g(d,1j)&&!c.1B("dw-2q")){4a=c.1J("1F-97");a(".dw-17-4g",L).1q("dw-17-p-3g").1m("dw-17-4g-h");a(".dw-17-9b",L).1q(hb).44("1w-2C").2D(".dw-i").1q(7X);c.1m(hb).1J("1w-2C","1d").2D(".dw-i").1m(7X);1U[4a].1q("dw-17-4g-h").1m("dw-17-p-3g");15(4a==="2j"){P=b.1f(1d);(P.1z()!==4H.1z()||P.1o()!==4H.1o()||P.1f()!==4H.1f())&&l(P)}1i{4H=b.1f(1d);b.3n(4H,1e,0,1d)}15(4K){e(3i,1d);e(Z,1d);B(ba,1d)}b.2i("hD",[4a])}});15(4K){b.2U(a(".dw-17-2t",L),16(){3i.1B("dw-17-v")||y(ba);y(Z);e(3i)});b.2U(a(".dw-17-2p",L),16(){3i.1B("dw-17-v")||3N.2N(5e);Z.1B("dw-17-v")||y(ba);y(3i);e(Z)});b.2U(a(".dw-17-2t-s",L),16(){!aa.3m&&!a(1j).1B("1y-d")&&b.ar(u.1f(ga,a(1j).1J("1F-1M"),1))});b.2U(a(".dw-17-2p-s",L),16(){15(!3N.3m){P=u.1f(a(1j).1J("1F-1M"),1K,1);b.ar(1k 1p(c.3q(P,3e,3b)))}});b.2U(3i,16(){15(!3N.3m){e(3i);B(ba)}});b.2U(Z,16(){15(!aa.3m){e(Z);B(ba)}})}},5k);4o?h.1m("dw-17-8Y"):a(".dw-17",L).2a(bc||c1*1T);u.cd&&a(".dw-17-6L-c",L).1P(u.cd);15(u.bD){1b v,z,x,O,E,N,Y,K,ea,bb=u.bC,7K=j.bW||16(a){a()},7c=j.bV||fb,9Z=16(a){15(!ea&&!4I){8k=1d;7e=1e;ea=1d;O=1k 1p;ca=R;8x=w(a,"X");gb=w(a,"Y")}},5Y=16(){N=ea=1e;15(K){K=1e;7c(z);x=1e;v=2K?7f-gb:8p-8x;E=1k 1p-O;Y=(E<5k&&1g.2x(v)>50?v<0?-1S:1S:1g.2e((R-ca)/d))*5I;Y>0&&u.1f(ga,1K-Y-2f,1)>=3e?I(ga,1K-Y,"1Y",Y):Y<0&&u.1f(ga,1K-Y+1T-2f-1,1)<=3b?I(ga,1K-Y,"2E",-Y):bb&&U(ca,4p)}},cb=16(a){4I&&a.2F();15(ea){8p=w(a,"X");7f=w(a,"Y");v=2K?7f-gb:8p-8x;15(!K&&!N)15(1g.2x(v)>7)7e=K=1d;1i 15(!b.4O&&!2K&&1g.2x(7f-gb)>10){7e=N=1d;a.2g==="62"&&Q.2i("4m")}K&&a.2F();15(K&&bb&&!x){x=1d;z=7K(5X)}}},5X=16(){U(ca+v);x=1e};Q.1r("4h",9Z).1r("62",cb).1r("4m 8C",5Y).1r("2V",16(d){15(!8k){9Z(d);a(q).1r("7r.9X",cb).1r("39.9X",16(){5Y();a(q).2y(".9X")})}8k=1e})}},6I:16(){15(1U.2j){E(ga,1K);b.2i("9Y",[ga,1K])}},7b:16(c,e,f){1b g,h,j,k=0,l=0,p=0;15(4o){bg&&Q.1P("");5c.1P("");S.2a("")}d&&(j=d);15(d=1g.2e(1g.2e(96(Q.2M(2K?"1P":"2a")))/1T)){L.1q("1v-17-m 1v-17-l");d>hM?L.1m("1v-17-l"):d>hN&&L.1m("1v-17-m")}15(5X&&(3B||4o)||5Y){a(".dw-17-4g",L).1q("dw-17-4g-h");a.1n(1U,16(a,d){g=d.5W();k=1g.1G(k,g);l=1g.1G(l,d.4D());p=p+g});15(5X||5Y&&p>(i[0].6u||i.6u())){h=1d;4a=a(".dw-17-6X .dw-2q",L).1J("1F-97");X.1m("dw-17-ce")}1i{4a="2j";l=k="";X.1q("dw-17-ce");5c.2M({2a:"",1P:""})}}15(4o&&bg){b.6W=1d;h&&5c.1P(1U.2j.4D());c=X.4D();f>=c&&Q.1P(f-c+Q.4D());l=1g.1G(l,1U.2j.4D())}15(h){5c.2M({2a:4o?"":k,1P:l});d=1g.2e(1g.2e(96(Q.2M(2K?"1P":"2a")))/1T)}15(d){15(db){fa=u.bG>a(".dw-17-9f-m",L).2a()?u.5l:u.3H;1h(s=0;s<1T;++s)a(2Q[s]).3v(fa[u.1o(u.1f(ga,1K-2f+s,1))])}S[2K?"1P":"2a"](d);15(4K){f=3i[2K?"1P":"2a"]();a.1V(3N.3h,{7k:f,3Q:f,8u:(2-8l)*f,7l:-f});a.1V(aa.3h,{7k:f,3Q:f,8u:-f,7l:-f});3N.51();aa.51();3i.1B("dw-17-v")&&3N.2N(5e)}15(4o&&!3B&&j){j=ca/j;ca=j*d;U(ca,0)}}15(h){a(".dw-17-4g",L).1m("dw-17-4g-h");1U[4a].1q("dw-17-4g-h")}b.2i("cf",[]);3B=1e},7h:16(){2o=[];1K=ga=4a=25;4I=1d;15(4K&&3N&&aa){3N.7A();aa.7A()}},cC:16(){1b a,d,c;d=b.1f(1d);15(ea)a="2j";1i 1h(c 3g b.95)c&&b.95[c]===s&&(a=/hW/.5y(c)?"2n":"2l");b.2i("hX",[{2n:d,97:a}]);l(d);ea=1e}});1a Y}})(3A,5Z,5M);(16(a,j){1b q=a.2d,t=q.1R,k=1k 1p,h={6P:k.1z()-2r,6O:k.1z()+1,92:" ",63:"3z/dd/2Z",47:"dU",6J:"ci",4i:"hh:43 A",6N:"cl",7R:"90",6Q:"cm",6R:"cn",8E:"&aY;",6V:"cp",6Y:"cq"},c=16(c){16 k(a,d,b){1a s[d]!==j?+a[s[d]]:b!==j?b:F[d](ca)}16 w(a,d,b,c){a.1l({21:b,1Q:d,2R:c})}16 g(a,d,b,c){1a 1g.2c(c,1g.4y(a/d)*d+b)}16 n(a){15(25===a)1a a;1b d=k(a,"h",0);1a e.1f(k(a,"y"),k(a,"m"),k(a,"d",1),k(a,"a",0)?d+12:d,k(a,"i",0),k(a,"s",0))}16 N(a,d){1b c,e,i=!1,f=!1,g=0,h=0;15(b(a))1a a;a<ha&&(a=ha);a>ba&&(a=ba);e=c=a;15(2!==d)1h(i=b(c);!i&&c<ba;)c=1k 1p(c.29()+cr),i=b(c),g++;15(1!==d)1h(f=b(e);!f&&e>ha;)e=1k 1p(e.29()-cr),f=b(e),h++;1a 1===d&&i?c:2===d&&f?e:h<g&&f?e:c}16 b(a){1a a<ha||a>ba?!1:O(a,X)?!0:O(a,Y)?!1:!0}16 O(a,d){1b b,c,e;15(d)1h(c=0;c<d.1u;c++)15(b=d[c],e=b+"",!b.1s)15(b.29){15(a.1z()==b.1z()&&a.1o()==b.1o()&&a.1f()==b.1f())1a!0}1i 15(e.1x(/w/i)){15(e=+e.1D("w",""),e==a.1X())1a!0}1i 15(e=e.2B("/"),e[1]){15(e[0]-1==a.1o()&&e[1]==a.1f())1a!0}1i 15(e[0]==a.1f())1a!0;1a!1}16 z(a,d,b,c,i,f,g){1b h,j,k;15(a)1h(h=0;h<a.1u;h++)15(j=a[h],k=j+"",!j.1s)15(j.29)e.1N(j)==d&&e.1o(j)==b&&(f[e.1X(j)-1]=g);1i 15(k.1x(/w/i)){k=+k.1D("w","");1h(U=k-c;U<i;U+=7)0<=U&&(f[U]=g)}1i k=k.2B("/"),k[1]?k[0]-1==b&&(f[k[1]-1]=g):f[k[0]-1]=g}16 G(b,c,i,f,h,k,l,s,m){1b o,F,R,n,y,r,q,t,z,A,H,ca,x,w,G,P,da,O,C={},S={h:ea,i:D,s:3B,a:1},L=e.1f(h,k,l),Q=["a","h","i","s"];b&&(a.1n(b,16(a,d){15(d.1s&&(d.4F=!1,o=d.d,F=o+"",R=F.2B("/"),o&&(o.29&&h==e.1N(o)&&k==e.1o(o)&&l==e.1X(o)||!F.1x(/w/i)&&(R[1]&&l==R[1]&&k==R[0]-1||!R[1]&&l==R[0])||F.1x(/w/i)&&L.1X()==+F.1D("w",""))))d.4F=!0,C[L]=!0}),a.1n(b,16(b,e){H=w=x=0;ca=j;q=r=!0;G=!1;15(e.1s&&(e.4F||!e.d&&!C[L])){n=e.1s.2B(":");y=e.2w.2B(":");1h(A=0;3>A;A++)n[A]===j&&(n[A]=0),y[A]===j&&(y[A]=59),n[A]=+n[A],y[A]=+y[A];n.7q(11<n[0]?1:0);y.7q(11<y[0]?1:0);d&&(12<=n[1]&&(n[1]-=12),12<=y[1]&&(y[1]-=12));1h(A=0;A<c;A++)15($[A]!==j){t=g(n[A],S[Q[A]],p[Q[A]],B[Q[A]]);z=g(y[A],S[Q[A]],p[Q[A]],B[Q[A]]);O=da=P=0;d&&1==A&&(P=n[0]?12:0,da=y[0]?12:0,O=$[0]?12:0);r||(t=0);q||(z=B[Q[A]]);15((r||q)&&t+P<$[A]+O&&$[A]+O<z+da)G=!0;$[A]!=t&&(r=!1);$[A]!=z&&(q=!1)}15(!m)1h(A=c+1;4>A;A++)0<n[A]&&(x=S[i]),y[A]<B[Q[A]]&&(w=S[i]);G||(t=g(n[c],S[i],p[i],B[i])+x,z=g(y[c],S[i],p[i],B[i])-w,r&&(H=0>t?0:t>B[i]?a(".dw-1C",s).1u:v(s,t)+0),q&&(ca=0>z?0:z>B[i]?a(".dw-1C",s).1u:v(s,z)+1));15(r||q||G)m?a(".dw-1C",s).3p(H,ca).1m("dw-v"):a(".dw-1C",s).3p(H,ca).1q("dw-v")}}))}16 v(d,b){1a a(".dw-1C",d).2z(a(\'.dw-1C[1F-1M="\'+b+\'"]\',d))}16 E(a){1b d,b=[];15(25===a||a===j)1a a;1h(d 3g s)b[s[d]]=F[d](a);1a b}16 x(a){1b d,b,c,e=[];15(a){1h(d=0;d<a.1u;d++)15(b=a[d],b.1s&&b.1s.29)1h(c=1k 1p(b.1s);c<=b.2w;)e.1l(1k 1p(c.1z(),c.1o(),c.1f())),c.3n(c.1f()+1);1i e.1l(b);1a e}1a a}1b o=a(1j),l={},C;15(o.6l("77")){8w(o.1J("2g")){1E"2n":C="2Z-3z-dd";1A;1E"1R":C="2Z-3z-8t:43:cs";1A;1E"1R-ct":C="2Z-3z-8t:43:3W";1A;1E"2t":C="2Z-3z";l.47="cu";1A;1E"2l":C="b2:43:3W"}1b I=o.1J("2c"),o=o.1J("1G");I&&(l.4V=t.4q(C,I));o&&(l.4U=t.4q(C,o))}1b J,U,r,K,M,A,T,p,B,I=a.1V({},c.3h),e=a.1V(c.3h,q.1R.4f,h,l,I),y=0,$=[],l=[],P=[],s={},F={y:16(a){1a e.1N(a)},m:16(a){1a e.1o(a)},d:16(a){1a e.1X(a)},h:16(a){a=a.3G();a=d&&12<=a?a-12:a;1a g(a,ea,fa,m)},i:16(a){1a g(a.5L(),D,aa,3y)},s:16(a){1a g(a.67(),3B,2Q,da)},a:16(a){1a S&&11<a.3G()?1:0}},Y=e.4N,X=e.3f,I=e.2S,L=e.47,i=e.6J,Q=L.1x(/D/),S=i.1x(/a/i),d=i.1x(/h/),R="1R"==I?e.63+e.92+e.4i:"2l"==I?e.4i:e.63,ca=1k 1p,o=e.3l||{},ea=o.cw||e.cx||1,D=o.cy||e.bk||1,3B=o.cA||e.cB||1,o=o.6v,ha=e.4V||1k 1p(e.6P,0,1),ba=e.4U||1k 1p(e.6O,11,31,23,59,59),fa=o?0:ha.3G()%ea,aa=o?0:ha.5L()%D,2Q=o?0:ha.67()%3B,m=1g.4y(((d?11:23)-fa)/ea)*ea+fa,3y=1g.4y((59-aa)/D)*D+aa,da=1g.4y((59-aa)/D)*D+aa;C=C||R;15(I.1x(/2n/i)){a.1n(["y","m","d"],16(a,d){J=L.6D(6Z(d,"i"));-1<J&&P.1l({o:J,v:d})});P.72(16(a,d){1a a.o>d.o?1:-1});a.1n(P,16(a,d){s[d.v]=a});o=[];1h(U=0;3>U;U++)15(U==s.y){y++;K=[];r=[];M=e.1N(ha);A=e.1N(ba);1h(J=M;J<=A;J++)r.1l(J),K.1l((L.1x(/2Z/i)?J:(J+"").8i(2,2))+(e.aG||""));w(o,r,K,e.7R)}1i 15(U==s.m){y++;K=[];r=[];1h(J=0;12>J;J++)M=L.1D(/[dy]/gi,"").1D(/3z/,(9>J?"0"+(J+1):J+1)+(e.8f||"")).1D(/m/,J+1+(e.8f||"")),r.1l(J),K.1l(M.1x(/6n/)?M.1D(/6n/,\'<1Z 1c="dw-84">\'+e.3H[J]+"</1Z>"):M.1D(/M/,\'<1Z 1c="dw-84">\'+e.5l[J]+"</1Z>"));w(o,r,K,e.83)}1i 15(U==s.d){y++;K=[];r=[];1h(J=1;32>J;J++)r.1l(J),K.1l((L.1x(/dd/i)&&10>J?"0"+J:J)+(e.6k||""));w(o,r,K,e.6N)}l.1l(o)}15(I.1x(/2l/i)){T=!0;P=[];a.1n(["h","i","s","a"],16(a,d){a=i.6D(6Z(d,"i"));-1<a&&P.1l({o:a,v:d})});P.72(16(a,d){1a a.o>d.o?1:-1});a.1n(P,16(a,d){s[d.v]=y+a});o=[];1h(U=y;U<y+4;U++)15(U==s.h){y++;K=[];r=[];1h(J=fa;J<(d?12:24);J+=ea)r.1l(J),K.1l(d&&0===J?12:i.1x(/hh/i)&&10>J?"0"+J:J);w(o,r,K,e.6Q)}1i 15(U==s.i){y++;K=[];r=[];1h(J=aa;60>J;J+=D)r.1l(J),K.1l(i.1x(/43/)&&10>J?"0"+J:J);w(o,r,K,e.6R)}1i 15(U==s.s){y++;K=[];r=[];1h(J=2Q;60>J;J+=3B)r.1l(J),K.1l(i.1x(/3W/)&&10>J?"0"+J:J);w(o,r,K,e.6V)}1i U==s.a&&(y++,I=i.1x(/A/),w(o,[0,1],I?[e.3T.6j(),e.3E.6j()]:[e.3T,e.3E],e.8E));l.1l(o)}c.5V=16(a){1a c.3t||a?n(c.4T(a)):25};c.3n=16(a,d,b,e,i){c.b7(E(a),d,i,e,b)};c.1f=c.5V;c.2J=R;c.95=s;c.8g.6g=16(){c.3n(1k 1p,!1,0.3,!0,!0)};c.2v.6g={3v:e.6Y,3u:"6g"};Y=x(Y);X=x(X);ha=n(E(ha));ba=n(E(ba));p={y:ha.1z(),m:0,d:1,h:fa,i:aa,s:2Q,a:0};B={y:ba.1z(),m:11,d:31,h:m,i:3y,s:da,a:1};1a{2Y:l,2T:e.2T?16(){1a t.3Y(R,n(c.4T(!0)),e)}:!1,5S:16(a){1a t.3Y(C,n(a),e)},5U:16(a){1a E(a?t.4q(C,a,e):e.7P||1k 1p)},aB:16(d,b,i,g){1b b=N(n(c.4T(!0)),g),h=E(b),l=k(h,"y"),m=k(h,"m"),D=!0,o=!0;a.1n("y,m,d,a,h,i,s".2B(","),16(b,c){15(s[c]!==j){1b i=p[c],f=B[c],g=31,n=k(h,c),y=a(".dw-37",d).eq(s[c]);15(c=="d"){f=g=e.9o(l,m);Q&&a(".dw-1C",y).1n(16(){1b d=a(1j),b=d.1F("1M"),c=e.1f(l,m,b).1X(),b=L.1D(/[cH]/gi,"").1D(/dd/,(b<10?"0"+b:b)+(e.6k||"")).1D(/d/,b+(e.6k||""));a(".dw-i",d).22(b.1x(/9p/)?b.1D(/9p/,\'<1Z 1c="dw-1t">\'+e.5o[c]+"</1Z>"):b.1D(/D/,\'<1Z 1c="dw-1t">\'+e.6e[c]+"</1Z>"))})}D&&ha&&(i=F[c](ha));o&&ba&&(f=F[c](ba));15(c!="y"){1b R=v(y,i),r=v(y,f);a(".dw-1C",y).1q("dw-v").3p(R,r+1).1m("dw-v");c=="d"&&a(".dw-1C",y).1q("dw-h").3p(g).1m("dw-h")}n<i&&(n=i);n>f&&(n=f);D&&(D=n==i);o&&(o=n==f);15(c=="d"){i=e.1f(l,m,1).1X();f={};z(Y,l,m,i,g,f,1);z(X,l,m,i,g,f,0);a.1n(f,16(d,b){b&&a(".dw-1C",y).eq(d).1q("dw-v")})}}});T&&a.1n(["a","h","i","s"],16(b,e){1b i=k(h,e),p=k(h,"d"),D=a(".dw-37",d).eq(s[e]);s[e]!==j&&(G(Y,b,e,h,l,m,p,D,0),G(X,b,e,h,l,m,p,D,1),$[b]=+c.9z(i,D,g).1M)});c.3X=h}}};a.1n(["2n","2l","1R"],16(a,h){q.6C.4J[h]=c})})(3A);(16(a,j,q,t){1b k=a.2d,h=a.1V,c=k.2m,f=k.1R,H=k.6C.4J,w={cK:0,9K:"eV,eW,eX,eY,eZ,f0".2B(","),9I:"f4",9E:"f6",cM:"2k",cN:"2I"};k.8X("2j");H.2j=16(g){16 n(d){15(d){15(e[d])1a e[d];1b b=a(\'<18 1L="7m-3K:\'+d+\';"></18>\').9h("7B"),c=(j.7W?7W(b[0]):b[0].1L).fe.1D(/ff|fh|\\(|\\)|\\s/g,"").2B(","),c=fi<0.fj*c[0]+0.fk*c[1]+0.fl*c[2]?"#fm":"#fo";b.6d();1a e[d]=c}}16 q(a){1a a.72(16(a,d){1b b=a.d||a.1s,c=d.d||d.1s,b=!b.29?0:a.1s&&a.2w&&a.1s.6a()!==a.2w.6a()?1:b.29(),c=!c.29?0:d.1s&&d.2w&&d.1s.6a()!==d.2w.6a()?1:c.29();1a b-c})}16 b(d){1b b;b=a(".dw-17-c",o).4D();1b c=d.4D(),e=d.5W(),f=d.2s().2b-a(".dw-17-c",o).2s().2b,i=2>d.48(".dw-17-6r").2z();b=l.1m("dw-17-2I-t").2M({2b:i?f+c:"0",3O:i?"0":b-f}).1m("dw-17-2I-v").1P();l.2M(i?"3O":"2b","c0").1q("dw-17-2I-t");U.2M("1G-1P",b);J.51();J.2N(0);i?l.1m("dw-17-2I-b"):l.1q("dw-17-2I-b");a(".dw-17-2I-5R",l).2M("3F",d.2s().3F-l.2s().3F+e/2)}16 O(d,c){1b e=I[d];15(e){1b f,i,h,j,o,p=\'<37 1c="dw-17-2k-fp">\';C=c;c.1m($).2D(".dw-i").1m(s);c.1B(P)&&c.1J("1F-hl","1d").1q(P);q(e);a.1n(e,16(a,b){j=b.d||b.1s;o=b.1s&&b.2w&&b.1s.6a()!==b.2w.6a();h=b.3K;n(h);i=f="";j.29&&(f=k.1R.3Y((o?"6n d 2Z ":"")+y.4i,j));b.2w&&(i=k.1R.3Y((o?"6n d 2Z ":"")+y.4i,b.2w));1b d=p,c=\'<1C 2L="3S" 1w-2R="\'+b.3v+(f?", "+y.9I+" "+f:"")+(i?", "+y.9E+" "+i:"")+\'" 1c="dw-17-2k"><18 1c="dw-17-2k-3K" 1L="\'+(h?"7m:"+h+";":"")+\'"></18>\'+(j.29&&!o?\'<18 1c="dw-17-2k-2l">\'+k.1R.3Y(y.4i,j)+"</18>":"")+b.3v,e;15(b.1s&&b.2w){e=y.9K;1b g=1g.2x(b.2w-b.1s)/fq,l=g/60,s=l/60,F=s/24,r=F/cP;e=\'<18 1c="dw-17-2k-fs">\'+(45>g&&1g.2e(g)+" "+e[5].4u()||45>l&&1g.2e(l)+" "+e[4].4u()||24>s&&1g.2e(s)+" "+e[3].4u()||30>F&&1g.2e(F)+" "+e[2].4u()||cP>F&&1g.2e(F/30)+" "+e[1].4u()||1g.2e(r)+" "+e[0].4u())+"</18>"}1i e="";p=d+(c+e+"</1C>")});p+="</37>";r.22(p);g.2i("fv",[C,l]);b(C);g.2U(a(".dw-17-2k",r),16(b){J.3m||g.2i("fw",[b,e[a(1j).2z()],d])});K=!0}}16 z(){l&&l.1q("dw-17-2I-v");C&&(C.1q($).2D(".dw-i").1q(s),C.1J("1F-hl")&&C.44("1F-hl").1m(P));K=!1}16 G(a){1a 1k 1p(a.1z(),a.1o(),a.1f())}16 v(a){i={};15(a&&a.1u)1h(M=0;M<a.1u;M++)i[G(a[M])]=a[M]}16 E(){Q&&z();g.51()}1b x,o,l,C,I,J,U,r,K,M,A,T,p,B,e={};p=h({},g.3h);1b y=h(g.3h,w,p),$="dw-2q dw-17-1t-ev",P="dw-17-1t-hl",s=y.bT||"",F=y.9x||"2P"==y.bj,Y=y.fA,X=!0===y.2I||!0===y.fB,L=0,i={},Q=a.7g(y.2I),S=Q?h(!0,[],y.2I):[];p=H.cz.3a(1j,g);x=h({},p);15(y.8V)1h(M=0;M<y.8V.1u;M++)i[G(y.8V[M])]=y.8V[M];Q&&a.1n(S,16(a,b){b.4A===t&&(b.4A=L++)});g.aU=16(a,b){I=g.9t(S,a,b);A=g.9t(y.cT,a,b)};g.b8=16(b){1h(1b c=F?i[b]!==t:Q?b.29()===(1k 1p).9r(0,0,0,0):t,e=A[b]?A[b][0]:!1,f=I[b]?I[b][0]:!1,g=e||f,e=e.3v||(f?I[b].1u+" "+(1<I[b].1u?y.cN:y.cM):0),f=A[b]||I[b]||[],h=g.3K,j=X&&e?n(h):"",k="",l=\'<18 1c="dw-17-1t-m"\'+(h?\' 1L="7m-3K:\'+h+";fF-3K:"+h+" "+h+\' cU cU"\':"")+"></18>",b=0;b<f.1u;b++)f[b].8Z&&(k+=\'<1Z 1c="1v-26 1v-26-\'+f[b].8Z+\'"\'+(f[b].3v?"":f[b].3K?\' 1L="3K:\'+f[b].3K+\';"\':"")+"></1Z>\\n");15("3O"==Y){l=\'<18 1c="dw-17-1t-m"><18 1c="dw-17-1t-m-t">\';1h(b=0;b<f.1u;b++)l+=\'<18 1c="dw-17-1t-m-c"\'+(f[b].3K?\' 1L="7m:\'+f[b].3K+\';"\':"")+"></18>";l+="</18></18>"}1a{cT:g,2C:Q?!1:c,5J:Q&&c?"dw-17-1t-hl":"",bh:X||Q?e:"",1H:X&&e?\'<18 1c="dw-17-1t-4Q-c"><18 1c="dw-17-1t-4Q \'+(y.fH||"")+\'" fI="\'+a("<18>"+e+"</18>").3v()+\'"\'+(h?\' 1L="7m:\'+h+";3K:"+j+\';3v-fJ:fK;"\':"")+">"+k+e+"</18></18>":X&&k?\'<18 1c="dw-17-1t-26-c">\'+k+"</18>":g?l:""}};g.fL=16(a){i[G(a)]=a;E()};g.fM=16(a){6H i[G(a)];E()};g.7O=16(a,b,c,e,f){F&&(v(a),a=a?a[0]:25);g.3n(a,b,f,e,c);E()};g.5V=16(a){1a F?c.cg(i):g.1f(a)};g.fN=16(a,b){g.3n(a?a[0]:25,b);v(a);E()};g.fO=16(){1a F?g.5V():[g.1f()]};Q&&(g.fP=16(b){1b c=[],b=h(!0,[],a.7g(b)?b:[b]);a.1n(b,16(a,b){b.4A===t&&(b.4A=L++);S.1l(b);c.1l(b.4A)});E();1a c},g.fQ=16(b){b=a.7g(b)?b:[b];a.1n(b,16(b,d){a.1n(S,16(a,b){15(b.4A===d)1a S.a2(a,1),!1})});E()},g.fR=16(a){1b b;1a a?(a.9r(0,0,0,0),b=g.9t(S,a.1z(),a.1o()),b[a]?q(b[a]):[]):S},g.fS=16(b){1b c=[];S=h(!0,[],b);a.1n(S,16(a,b){b.4A===t&&(b.4A=L++);c.1l(b.4A)});E();1a c});h(p,{8L:!F&&!Q,8O:!F&&!Q,2v:Q&&"54"!==y.28?["4c"]:y.2v,5U:16(a){1b b,c;15(F&&a){i={};a=a.2B(",");1h(b=0;b<a.1u;b++){c=f.4q(g.2J,a[b].1D(/^\\s+|\\s+$/g,""),y);i[G(c)]=c}a=a[0]}1a x.5U.3a(1j,a)},5S:16(a){1b b,c=[];15(F){1h(b 3g i)c.1l(f.3Y(g.2J,i[b],y));1a c.ae(", ")}1a x.5S.3a(1j,a)},cJ:16(){15(F){i={};g.51()}},d5:16(){15(Q)y.2T=1e;15(y.cV)y.8O=1e;15(y.fU&&F)y.2T=16(){1b b=0,c=y.bj=="2P"?7:1;a.1n(i,16(){b++});1a b/c+" "+y.be}},91:16(b){x.91.3a(1j,b);o=b;15(F){a(".ai",b).1J("1w-4s","2y");T=h({},i)}X&&a(".dw-17",b).1m("dw-17-ev");Y&&a(".dw-17",b).1m("dw-17-m-"+Y);15(Q){b.1m("dw-17-em");l=a(\'<18 1c="dw-17-2I \'+(y.fV||"")+\'"><18 1c="dw-17-2I-5R"></18><18 1c="dw-17-2I-i"><18 1c="dw-17-2I-2h"></18></18></18>\').9h(a(".dw-17-c",b));U=a(".dw-17-2I-i",l);r=a(".dw-17-2I-2h",l);J=1k k.2O.6U(U[0]);g.2U(U,16(){J.3m||z()})}},bF:16(){Q&&z()},bK:16(){Q&&z()},9Y:16(){15(B){O(B.d,a(\'.dw-17-1t-v[1F-4l="\'+B.4l+\'"]:fW(.dw-17-1t-94)\',o));B=1e}},bI:16(b){1b c=b.2n,e=G(c),f=a(b.3x),b=b.2C;15(Q){z();f.1B("dw-17-1t-ev")||2A(16(){g.7w?B={d:e,4l:f.1J("1F-4l")}:O(e,f)},10)}1i 15(F)15(y.bj=="2P"){1b h,j,k=e.1X()-y.cK,k=k<0?7+k:k;y.9x||(i={});1h(h=0;h<7;h++){j=1k 1p(e.1z(),e.1o(),e.1f()-k+h);b?6H i[j]:i[j]=j}E()}1i{h=a(\'.dw-17 .dw-17-1t[1F-4l="\'+f.1J("1F-4l")+\'"]\',o);15(b){h.1q("dw-2q").44("1w-2C").2D(".dw-i").1q(s);6H i[e]}1i{h.1m("dw-2q").1J("1w-2C","1d").2D(".dw-i").1m(s);i[e]=e}}15(!Q&&!y.9x&&y.cV&&y.28!=="54"){g.7y=1e;g.3n(c);g.7G();1a 1e}},cf:16(){K&&b(C)},cI:16(){!g.4s&&F&&(i=h({},T))}});1a p}})(3A,5Z,5M);(16($,j){1b k=$.2d;k.1R={4f:{cW:\'+10\',3H:[\'fY\',\'fZ\',\'g0\',\'g1\',\'cX\',\'g2\',\'g3\',\'g4\',\'g5\',\'g6\',\'g7\',\'g8\'],5l:[\'g9\',\'gc\',\'gd\',\'ge\',\'cX\',\'gf\',\'gg\',\'gh\',\'gj\',\'gk\',\'gl\',\'gm\'],5o:[\'gn\',\'go\',\'gp\',\'gq\',\'gr\',\'gs\',\'gt\'],6e:[\'gu\',\'gv\',\'gw\',\'gx\',\'gy\',\'gz\',\'gA\'],cY:[\'S\',\'M\',\'T\',\'W\',\'T\',\'F\',\'S\'],83:\'av\',3T:\'am\',3E:\'gB\',1N:16(d){1a d.1z()},1o:16(d){1a d.1o()},1X:16(d){1a d.1f()},1f:16(y,m,d,h,i,s){1a 1k 1p(y,m,d,h||0,i||0,s||0)},9o:16(y,m){1a 32-1k 1p(y,m,32).1f()},bl:16(d){d=1k 1p(d);d.9r(0,0,0);d.3n(d.1f()+4-(d.1X()||7));1b a=1k 1p(d.1z(),0,1);1a 1g.9M((((d-a)/cZ)+1)/7)}},3Y:16(c,d,e){15(!d){1a 25}1b s=$.1V({},k.1R.4f,e),69=16(m){1b n=0;5a(i+1<c.1u&&c.5f(i+1)==m){n++;i++}1a n},f1=16(m,a,b){1b n=\'\'+a;15(69(m)){5a(n.1u<b){n=\'0\'+n}}1a n},f2=16(m,a,s,l){1a(69(m)?l[a]:s[a])},i,2p,2H=\'\',4Y=1e;1h(i=0;i<c.1u;i++){15(4Y){15(c.5f(i)=="\'"&&!69("\'")){4Y=1e}1i{2H+=c.5f(i)}}1i{8w(c.5f(i)){1E\'d\':2H+=f1(\'d\',s.1X(d),2);1A;1E\'D\':2H+=f2(\'D\',d.1X(),s.6e,s.5o);1A;1E\'o\':2H+=f1(\'o\',(d.29()-1k 1p(d.1z(),0,0).29())/cZ,3);1A;1E\'m\':2H+=f1(\'m\',s.1o(d)+1,2);1A;1E\'M\':2H+=f2(\'M\',s.1o(d),s.5l,s.3H);1A;1E\'y\':2p=s.1N(d);2H+=(69(\'y\')?2p:(2p%2r<10?\'0\':\'\')+2p%2r);1A;1E\'h\':1b h=d.3G();2H+=f1(\'h\',(h>12?(h-12):(h===0?12:h)),2);1A;1E\'H\':2H+=f1(\'H\',d.3G(),2);1A;1E\'i\':2H+=f1(\'i\',d.5L(),2);1A;1E\'s\':2H+=f1(\'s\',d.67(),2);1A;1E\'a\':2H+=d.3G()>11?s.3E:s.3T;1A;1E\'A\':2H+=d.3G()>11?s.3E.6j():s.3T.6j();1A;1E"\'":15(69("\'")){2H+="\'"}1i{4Y=1d}1A;d0:2H+=c.5f(i)}}}1a 2H},4q:16(c,d,e){1b s=$.1V({},k.1R.4f,e),4S=s.7P||1k 1p();15(!c||!d){1a 4S}15(d.29){1a d}d=(5x d==\'aV\'?d.gK():d+\'\');1b f=s.cW,2p=s.1N(4S),2t=s.1o(4S)+1,1t=s.1X(4S),8R=-1,4r=4S.3G(),aS=4S.5L(),aQ=0,5p=-1,4Y=1e,7p=16(a){1b b=(4x+1<c.1u&&c.5f(4x+1)==a);15(b){4x++}1a b},4v=16(a){7p(a);1b b=(a==\'@\'?14:(a==\'!\'?20:(a==\'y\'?4:(a==\'o\'?3:2)))),d4=1k 6Z(\'^\\\\d{1,\'+b+\'}\'),8s=d.8i(6G).1x(d4);15(!8s){1a 0}6G+=8s[0].1u;1a 96(8s[0],10)},7t=16(a,s,l){1b b=(7p(a)?l:s),i;1h(i=0;i<b.1u;i++){15(d.8i(6G,b[i].1u).4u()==b[i].4u()){6G+=b[i].1u;1a i+1}}1a 0},8a=16(){6G++},6G=0,4x;1h(4x=0;4x<c.1u;4x++){15(4Y){15(c.5f(4x)=="\'"&&!7p("\'")){4Y=1e}1i{8a()}}1i{8w(c.5f(4x)){1E\'d\':1t=4v(\'d\');1A;1E\'D\':7t(\'D\',s.6e,s.5o);1A;1E\'o\':8R=4v(\'o\');1A;1E\'m\':2t=4v(\'m\');1A;1E\'M\':2t=7t(\'M\',s.5l,s.3H);1A;1E\'y\':2p=4v(\'y\');1A;1E\'H\':4r=4v(\'H\');1A;1E\'h\':4r=4v(\'h\');1A;1E\'i\':aS=4v(\'i\');1A;1E\'s\':aQ=4v(\'s\');1A;1E\'a\':5p=7t(\'a\',[s.3T,s.3E],[s.3T,s.3E])-1;1A;1E\'A\':5p=7t(\'A\',[s.3T,s.3E],[s.3T,s.3E])-1;1A;1E"\'":15(7p("\'")){8a()}1i{4Y=1d}1A;d0:8a()}}}15(2p<2r){2p+=1k 1p().1z()-1k 1p().1z()%2r+(2p<=(5x f!=\'9T\'?f:1k 1p().1z()%2r+96(f,10))?0:-2r)}15(8R>-1){2t=1;1t=8R;do{1b g=32-1k 1p(2p,2t-1,32).1f();15(1t<=g){1A}2t++;1t-=g}5a(1d)}4r=(5p==-1)?4r:((5p&&4r<12)?(4r+12):(!5p&&4r==12?0:4r));1b h=s.1f(2p,2t-1,1t,4r,aS,aQ);15(s.1N(h)!=2p||s.1o(h)+1!=2t||s.1X(h)!=1t){1a 4S}1a h}};k.3Y=k.1R.3Y;k.4q=k.1R.4q})(3A);(16($,z){1b A=$.2d,1R=A.1R,2n=1k 1p(),4f={6P:2n.1z()-2r,6O:2n.1z()+1,92:\' \',63:\'3z/dd/2Z\',47:\'gX\',6J:\'ci\',4i:\'hh:43 A\',6N:\'cl\',7R:\'90\',6Q:\'cm\',6R:\'cn\',8E:\'&aY;\',6V:\'cp\',6Y:\'cq\'},2S=16(l){1b n=$(1j),7x={},2J;15(n.6l(\'77\')){8w(n.1J(\'2g\')){1E\'2n\':2J=\'2Z-3z-dd\';1A;1E\'1R\':2J=\'2Z-3z-8t:43:cs\';1A;1E\'1R-ct\':2J=\'2Z-3z-8t:43:3W\';1A;1E\'2t\':2J=\'2Z-3z\';7x.47=\'cu\';1A;1E\'2l\':2J=\'b2:43:3W\';1A}1b q=n.1J(\'2c\'),1G=n.1J(\'1G\');15(q){7x.4V=1R.4q(2J,q)}15(1G){7x.4U=1R.4q(2J,1G)}}1b i,k,1Q,21,3M,1s,2w,9O,5G,46,dc=$.1V({},l.3h),s=$.1V(l.3h,A.1R.4f,4f,7x,dc),2s=0,5j=[],2Y=[],4Z=[],o={},f={y:1N,m:1o,d:1X,h:df,i:dg,s:di,a:dj},4N=s.4N,3f=s.3f,p=s.2S,5D=s.47,5n=s.6J,dl=5D.1x(/D/),5p=5n.1x(/a/i),5C=5n.1x(/h/),8N=p==\'1R\'?s.63+s.92+s.4i:p==\'2l\'?s.4i:s.63,dm=1k 1p(),3l=s.3l||{},6m=3l.cw||s.cx||1,5z=3l.cy||s.bk||1,7F=3l.cA||s.cB||1,6v=3l.6v,3k=s.4V||1k 1p(s.6P,0,1),4d=s.4U||1k 1p(s.6O,11,31,23,59,59),7M=6v?0:3k.3G()%6m,6E=6v?0:3k.5L()%5z,7Z=6v?0:3k.67()%7F,9V=7S(6m,7M,(5C?11:23)),9F=7S(5z,6E,59),9D=7S(5z,6E,59);2J=2J||8N;15(p.1x(/2n/i)){$.1n([\'y\',\'m\',\'d\'],16(j,v){i=5D.6D(1k 6Z(v,\'i\'));15(i>-1){4Z.1l({o:i,v:v})}});4Z.72(16(a,b){1a a.o>b.o?1:-1});$.1n(4Z,16(i,v){o[v.v]=i});3M=[];1h(k=0;k<3;k++){15(k==o.y){2s++;21=[];1Q=[];1s=s.1N(3k);2w=s.1N(4d);1h(i=1s;i<=2w;i++){1Q.1l(i);21.1l((5D.1x(/2Z/i)?i:(i+\'\').8i(2,2))+(s.aG||\'\'))}58(3M,1Q,21,s.7R)}1i 15(k==o.m){2s++;21=[];1Q=[];1h(i=0;i<12;i++){1b r=5D.1D(/[dy]/gi,\'\').1D(/3z/,(i<9?\'0\'+(i+1):i+1)+(s.8f||\'\')).1D(/m/,i+1+(s.8f||\'\'));1Q.1l(i);21.1l(r.1x(/6n/)?r.1D(/6n/,\'<1Z 1c="dw-84">\'+s.3H[i]+\'</1Z>\'):r.1D(/M/,\'<1Z 1c="dw-84">\'+s.5l[i]+\'</1Z>\'))}58(3M,1Q,21,s.83)}1i 15(k==o.d){2s++;21=[];1Q=[];1h(i=1;i<32;i++){1Q.1l(i);21.1l((5D.1x(/dd/i)&&i<10?\'0\'+i:i)+(s.6k||\'\'))}58(3M,1Q,21,s.6N)}}2Y.1l(3M)}15(p.1x(/2l/i)){9O=1d;4Z=[];$.1n([\'h\',\'i\',\'s\',\'a\'],16(i,v){i=5n.6D(1k 6Z(v,\'i\'));15(i>-1){4Z.1l({o:i,v:v})}});4Z.72(16(a,b){1a a.o>b.o?1:-1});$.1n(4Z,16(i,v){o[v.v]=2s+i});3M=[];1h(k=2s;k<2s+4;k++){15(k==o.h){2s++;21=[];1Q=[];1h(i=7M;i<(5C?12:24);i+=6m){1Q.1l(i);21.1l(5C&&i===0?12:5n.1x(/hh/i)&&i<10?\'0\'+i:i)}58(3M,1Q,21,s.6Q)}1i 15(k==o.i){2s++;21=[];1Q=[];1h(i=6E;i<60;i+=5z){1Q.1l(i);21.1l(5n.1x(/43/)&&i<10?\'0\'+i:i)}58(3M,1Q,21,s.6R)}1i 15(k==o.s){2s++;21=[];1Q=[];1h(i=7Z;i<60;i+=7F){1Q.1l(i);21.1l(5n.1x(/3W/)&&i<10?\'0\'+i:i)}58(3M,1Q,21,s.6V)}1i 15(k==o.a){2s++;1b u=5n.1x(/A/);58(3M,[0,1],u?[s.3T.6j(),s.3E.6j()]:[s.3T,s.3E],s.8E)}}2Y.1l(3M)}16 3w(d,i,a){15(o[i]!==z){1a+d[o[i]]}15(a!==z){1a a}1a f[i](dm)}16 58(a,k,v,b){a.1l({21:v,1Q:k,2R:b})}16 3V(v,a,b,c){1a 1g.2c(c,1g.4y(v/a)*a+b)}16 1N(d){1a s.1N(d)}16 1o(d){1a s.1o(d)}16 1X(d){1a s.1X(d)}16 df(d){1b a=d.3G();a=5C&&a>=12?a-12:a;1a 3V(a,6m,7M,9V)}16 dg(d){1a 3V(d.5L(),5z,6E,9F)}16 di(d){1a 3V(d.67(),7F,7Z,9D)}16 dj(d){1a 5p&&d.3G()>11?1:0}16 1f(d){15(d===25){1a d}1b a=3w(d,\'h\',0);1a s.1f(3w(d,\'y\'),3w(d,\'m\'),3w(d,\'d\',1),3w(d,\'a\',0)?a+12:a,3w(d,\'i\',0),3w(d,\'s\',0))}16 7S(a,b,c){1a 1g.4y((c-b)/a)*a+b}16 dx(d,a){1b b,1Y,7N=1e,6w=1e,aT=0,aJ=0;15(6p(d)){1a d}15(d<3k){d=3k}15(d>4d){d=4d}b=d;1Y=d;15(a!==2){7N=6p(b);5a(!7N&&b<4d){b=1k 1p(b.29()+ad*60*60*24);7N=6p(b);aT++}}15(a!==1){6w=6p(1Y);5a(!6w&&1Y>3k){1Y=1k 1p(1Y.29()-ad*60*60*24);6w=6p(1Y);aJ++}}15(a===1&&7N){1a b}15(a===2&&6w){1a 1Y}1a aJ<aT&&6w?1Y:b}16 6p(d){15(d<3k){1a 1e}15(d>4d){1a 1e}15(ac(d,3f)){1a 1d}15(ac(d,4N)){1a 1e}1a 1d}16 ac(d,a){1b b,j,v;15(a){1h(j=0;j<a.1u;j++){b=a[j];v=b+\'\';15(!b.1s){15(b.29){15(d.1z()==b.1z()&&d.1o()==b.1o()&&d.1f()==b.1f()){1a 1d}}1i 15(!v.1x(/w/i)){v=v.2B(\'/\');15(v[1]){15((v[0]-1)==d.1o()&&v[1]==d.1f()){1a 1d}}1i 15(v[0]==d.1f()){1a 1d}}1i{v=+v.1D(\'w\',\'\');15(v==d.1X()){1a 1d}}}}}1a 1e}16 ab(a,y,m,b,c,e,f){1b j,d,v;15(a){1h(j=0;j<a.1u;j++){d=a[j];v=d+\'\';15(!d.1s){15(d.29){15(s.1N(d)==y&&s.1o(d)==m){e[s.1X(d)-1]=f}}1i 15(!v.1x(/w/i)){v=v.2B(\'/\');15(v[1]){15(v[0]-1==m){e[v[1]-1]=f}}1i{e[v[0]-1]=f}}1i{v=+v.1D(\'w\',\'\');1h(k=v-b;k<c;k+=7){15(k>=0){e[k]=f}}}}}}}16 a6(b,i,v,c,y,m,d,e,f){1b g,3W,r,35,2X,5w,5v,5u,5t,j,i1,i2,9e,6d,6b,9d,8K,7Q,aP={},3l={h:6m,i:5z,s:7F,a:1},1t=s.1f(y,m,d),w=[\'a\',\'h\',\'i\',\'s\'];15(b){$.1n(b,16(i,a){15(a.1s){a.4F=1e;g=a.d;3W=g+\'\';r=3W.2B(\'/\');15(g&&((g.29&&y==s.1N(g)&&m==s.1o(g)&&d==s.1X(g))||(!3W.1x(/w/i)&&((r[1]&&d==r[1]&&m==r[0]-1)||(!r[1]&&d==r[0])))||(3W.1x(/w/i)&&1t.1X()==+3W.1D(\'w\',\'\')))){a.4F=1d;aP[1t]=1d}}});$.1n(b,16(x,a){9e=0;6d=0;i1=0;i2=z;5w=1d;5v=1d;6b=1e;15(a.1s&&(a.4F||(!a.d&&!aP[1t]))){35=a.1s.2B(\':\');2X=a.2w.2B(\':\');1h(j=0;j<3;j++){15(35[j]===z){35[j]=0}15(2X[j]===z){2X[j]=59}35[j]=+35[j];2X[j]=+2X[j]}35.7q(35[0]>11?1:0);2X.7q(2X[0]>11?1:0);15(5C){15(35[1]>=12){35[1]=35[1]-12}15(2X[1]>=12){2X[1]=2X[1]-12}}1h(j=0;j<i;j++){15(5j[j]!==z){5u=3V(35[j],3l[w[j]],5G[w[j]],46[w[j]]);5t=3V(2X[j],3l[w[j]],5G[w[j]],46[w[j]]);9d=0;8K=0;7Q=0;15(5C&&j==1){9d=35[0]?12:0;8K=2X[0]?12:0;7Q=5j[0]?12:0}15(!5w){5u=0}15(!5v){5t=46[w[j]]}15((5w||5v)&&(5u+9d<5j[j]+7Q&&5j[j]+7Q<5t+8K)){6b=1d}15(5j[j]!=5u){5w=1e}15(5j[j]!=5t){5v=1e}}}15(!f){1h(j=i+1;j<4;j++){15(35[j]>0){9e=3l[v]}15(2X[j]<46[w[j]]){6d=3l[v]}}}15(!6b){5u=3V(35[i],3l[v],5G[v],46[v])+9e;5t=3V(2X[i],3l[v],5G[v],46[v])-6d;15(5w){i1=9G(e,5u,46[v],0)}15(5v){i2=9G(e,5t,46[v],1)}}15(5w||5v||6b){15(f){$(\'.dw-1C\',e).3p(i1,i2).1m(\'dw-v\')}1i{$(\'.dw-1C\',e).3p(i1,i2).1q(\'dw-v\')}}}})}}16 8F(t,v){1a $(\'.dw-1C\',t).2z($(\'.dw-1C[1F-1M="\'+v+\'"]\',t))}16 9G(t,v,a,b){15(v<0){1a 0}15(v>a){1a $(\'.dw-1C\',t).1u}1a 8F(t,v)+b}16 65(d){1b i,3Z=[];15(d===25||d===z){1a d}1h(i 3g o){3Z[o[i]]=f[i](d)}1a 3Z}16 aX(a){1b i,v,1s,3Z=[];15(a){1h(i=0;i<a.1u;i++){v=a[i];15(v.1s&&v.1s.29){1s=1k 1p(v.1s);5a(1s<=v.2w){3Z.1l(1k 1p(1s.1z(),1s.1o(),1s.1f()));1s.3n(1s.1f()+1)}}1i{3Z.1l(v)}}1a 3Z}1a a}l.5V=16(a){1a l.3t||a?1f(l.4T(a)):25};l.3n=16(d,a,b,c,e){l.b7(65(d),a,e,c,b)};l.1f=l.5V;l.2J=8N;l.95=o;l.8g.6g=16(){l.3n(1k 1p(),1e,0.3,1d,1d)};l.2v.6g={3v:s.6Y,3u:\'6g\'};4N=aX(4N);3f=aX(3f);3k=1f(65(3k));4d=1f(65(4d));5G={y:3k.1z(),m:0,d:1,h:7M,i:6E,s:7Z,a:0};46={y:4d.1z(),m:11,d:31,h:9V,i:9F,s:9D,a:1};1a{2Y:2Y,2T:s.2T?16(){1a 1R.3Y(8N,1f(l.4T(1d)),s)}:1e,5S:16(d){1a 1R.3Y(2J,1f(d),s)},5U:16(a){1a 65(a?1R.4q(2J,a,s):(s.7P||1k 1p()))},aB:16(g,i,h,j){1b k=dx(1f(l.4T(1d)),j),4M=65(k),y=3w(4M,\'y\'),m=3w(4M,\'m\'),8J=1d,8G=1d;$.1n([\'y\',\'m\',\'d\',\'a\',\'h\',\'i\',\'s\'],16(x,i){15(o[i]!==z){1b b=5G[i],1G=46[i],6c=31,1M=3w(4M,i),t=$(\'.dw-37\',g).eq(o[i]);15(i==\'d\'){6c=s.9o(y,m);1G=6c;15(dl){$(\'.dw-1C\',t).1n(16(){1b a=$(1j),d=a.1F(\'1M\'),w=s.1f(y,m,d).1X(),r=5D.1D(/[cH]/gi,\'\').1D(/dd/,(d<10?\'0\'+d:d)+(s.6k||\'\')).1D(/d/,d+(s.6k||\'\'));$(\'.dw-i\',a).22(r.1x(/9p/)?r.1D(/9p/,\'<1Z 1c="dw-1t">\'+s.5o[w]+\'</1Z>\'):r.1D(/D/,\'<1Z 1c="dw-1t">\'+s.6e[w]+\'</1Z>\'))})}}15(8J&&3k){b=f[i](3k)}15(8G&&4d){1G=f[i](4d)}15(i!=\'y\'){1b c=8F(t,b),i2=8F(t,1G);$(\'.dw-1C\',t).1q(\'dw-v\').3p(c,i2+1).1m(\'dw-v\');15(i==\'d\'){$(\'.dw-1C\',t).1q(\'dw-h\').3p(6c).1m(\'dw-h\')}}15(1M<b){1M=b}15(1M>1G){1M=1G}15(8J){8J=1M==b}15(8G){8G=1M==1G}15(i==\'d\'){1b e=s.1f(y,m,1).1X(),4W={};ab(4N,y,m,e,6c,4W,1);ab(3f,y,m,e,6c,4W,0);$.1n(4W,16(i,v){15(v){$(\'.dw-1C\',t).eq(i).1q(\'dw-v\')}})}}});15(9O){$.1n([\'a\',\'h\',\'i\',\'s\'],16(i,v){1b a=3w(4M,v),d=3w(4M,\'d\'),t=$(\'.dw-37\',g).eq(o[v]);15(o[v]!==z){a6(4N,i,v,4M,y,m,d,t,0);a6(3f,i,v,4M,y,m,d,t,1);5j[i]=+l.9z(a,t,j).1M}})}l.3X=4M}}};$.1n([\'2n\',\'2l\',\'1R\'],16(i,v){A.6C.4J[v]=2S})})(3A);(16($){$.1n([\'2n\',\'2l\',\'1R\'],16(i,v){$.2d.8X(v)})})(3A);(16($){$.2d.8T.dO=$.1V($.2d.8T.dO,{ax:\'确定\',aC:\'取消\',aE:\'明确\',be:\'选\',63:\'2Z-3z-dd\',47:\'hY\',5o:[\'周日\',\'周一\',\'周二\',\'周三\',\'周四\',\'周五\',\'周六\'],6e:[\'日\',\'一\',\'二\',\'三\',\'四\',\'五\',\'六\'],cY:[\'日\',\'一\',\'二\',\'三\',\'四\',\'五\',\'六\'],6N:\'日\',6Q:\'时\',6R:\'分\',5l:[\'1月\',\'2月\',\'3月\',\'4月\',\'5月\',\'6月\',\'7月\',\'8月\',\'9月\',\'10月\',\'11月\',\'12月\'],3H:[\'一\',\'二\',\'三\',\'四\',\'五\',\'六\',\'七\',\'八\',\'九\',\'十\',\'十一\',\'十二\'],83:\'月\',6V:\'秒\',4i:\'b2:43\',6J:\'hZ\',7R:\'年\',6Y:\'现在\',3E:\'下午\',3T:\'上午\',bu:\'日\',bt:\'时间\',an:\'日历\',aA:\'关闭\',9I:\'开始时间\',9E:\'结束时间\',i0:\'合计\',i3:\'分数\',i4:\'单位\',7d:[\'年\',\'月\',\'日\',\'小时\',\'分钟\',\'秒\',\'\'],9K:[\'年\',\'月\',\'日\',\'点\',\'分\',\'秒\',\'\'],i5:\'开始\',i6:\'停止\',i7:\'重置\',i8:\'圈\',e0:\'隐藏\'})})(3A);',62,1127,'|||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||||if|function|cal|div|that|return|var|class|true|false|getDate|Math|for|else|this|new|push|addClass|each|getMonth|Date|removeClass|on|start|day|length|mbsc|aria|match|dwb|getFullYear|break|hasClass|li|replace|case|data|max|markup|btn|attr|ma|style|val|getYear|px|height|keys|datetime|ka|sa|pa|extend|ms|getDay|prev|span||values|html|||null|ic||display|getTime|width|top|min|mobiscroll|round|va|type|sc|trigger|calendar|event|time|util|date|na|year|sel|100|offset|month|itemHeight|buttons|end|abs|off|index|setTimeout|split|selected|find|next|preventDefault|elm|output|events|format|ra|role|css|scroll|classes|week|ta|label|preset|headerText|tap|mousedown|theme|parts2|wheels|yy||||dwwl||parts1||ul||mouseup|call|Ga|has3d|click|qa|valid|in|settings|Ia|instances|mind|steps|scrolled|setDate|nh|slice|constrain|isModal|Ca|_hasValue|handler|text|get|cell|ja|mm|jQuery|la|getCoord|target|pmText|left|getHours|monthNames|Ra|nw|color|tabindex|wg|Pa|bottom|id|snap|wnd|button|amText|disabled|step|ss|_tempWheelArray|formatDate|ret||empty||ii|removeAttr||maxs|dateOrder|closest|doAnim|Ha|focus|cancel|maxd|moved|defaults|pnl|touchstart|timeFormat|popup|arrow|full|touchend|_tempValue|oa|200|parseDate|hours|live|stop|toLowerCase|getNumber|dist|iFormat|floor|set|_id|hasFlex|init|outerHeight|nr|apply|st|ua|Da|scroller|La|xa|temp|invalid|scrollLock|modalHeight|txt|bubble|def|getArrayVal|maxDate|minDate|idx|ctx|literal|ord||refresh|pr|matrix|inline||_isVisible|slide|addWheel||while|dist1|Aa|onBtnEnd|Qa|charAt|lang|setValue|Ta|validValues|300|monthNamesShort|isString|tord|dayNames|ampm|controls|testTouch|persp|v2|v1|prop2|prop1|typeof|test|stepM|userdef|hidden|hampm|dord|context|iv|mins|tapped|Za|cssClass|stopPropagation|getMinutes|document|value|anchor|dist2|hide|arr|formatResult|arrw|parseValue|getVal|outerWidth|Ja|ya|window||liquid|touchmove|dateFormat|keydown|getArray|lb|getSeconds|_isInput|look|toDateString|all|maxdays|remove|dayNamesShort|clear|now|prefix|show|toUpperCase|daySuffix|is|stepH|MM|out|isValid|isScrollable|row|rtl|sl|innerWidth|zeroBased|prevValid|lines|themes|modalWidth|pos|rows|presets|search|minM|keyCode|iValue|delete|onShow|timeWheels|jsPrefix|anim|table|dayText|endYear|startYear|hourText|minuteText|layout|dwc|ScrollView|secText|_isFullScreen|tabs|nowText|RegExp|minw|totalw|sort|active|multiple|scrollToPos|cell2|input|cells|_value|position|onPosition|za|labels|Xa|Ea|isArray|onHide|ariaMessage|minWidth|contSize|maxScroll|background|calc|prototype|lookAhead|unshift|mousemove|firstDay|getName|setGlobals|nb|changing|html5def|needsSlide|timer|destroy|body|btnCalNextClass|btnCalPrevClass|preventShow|stepS|select|pb|Transform|setReadOnly|sb|posEvents|minH|nextValid|setVal|defaultValue|hours3|yearText|getMax|trans|showLabel|_isLiquid|getComputedStyle|wb|elastic|minS||Transition|weekDays|monthText|mon|translate3d|isReadOnly|mode|testProps|animationend|checkLiteral|ios7|btnWidth|ob|res|monthSuffix|handlers|clearTimeout|substr|dwa|Na|Bb|onMove|timeUnit|onEnd|tb|_wheelArray|speed|num|ddTHH|minScroll|tindex|switch|mb|Fa|inst|modal|speedUnit|touchcancel|_readValue|ampmText|getIndex|maxprop|prop|maxWidth|minprop|hours2|highlight|tbl|hformat|divergentDayChange|yb|needsRefresh|doy|tr|i18n|_defaults|selectedValues|dwwb|presetShort|liq|icon|Year|onMarkupReady|separator|Wa|diff|order|parseInt|control|nhl|onBtnStart|wasReadOnly|tab|preventPos|hours1|add|btnw|readonly|appendTo|hasButtons|animEnd|wrapper|Moz|Scroller|webkitAnimationEnd|getMaxDayOfMonth|DD|xb|setHours|line|prepareObj|header|Widget|isOldAndroid|multiSelect|maxSnapScroll|getValidCell|dwtd|Ib|breakpoint|maxS|toText|maxM|getValidIndex|generateWheelItems|fromText|readOnly|labelsShort|pixels|ceil|isVisible|hasTime|touch|fixedWidth|selectedLineHeight|selectedLineBorder|string|dwwms|maxH|_processSettings|dwsw|onMonthLoaded|wa|curr|ready|splice|parentClass|isNumeric|nrs|validateTimes|months|btnc|startY||validateDates|isInObj|1000|join|getValid|btnPlusClass||dwv|page|_attachEvents|||calendarText|rb||getPosition|navigate|btnMinusClass||_fillValue|Month||setText|Ba|Va|closeText|validate|cancelText|showOnTap|clearText|axis|yearSuffix|showOnFocus|onWndKeyDown|down|posDebounce|elmList|wndHeight|wndWidth|_preventChange|spec|seconds|_generateContent|minutes|up|onGenMonth|object|calendarClass|convertRanges|nbsp|arrl|plus|components|HH|minus|overlay|clearInterval|startTime|setArrayVal|getDayProps|zb|||kb|_markupReady|selectedText||ub|ariaLabel|prevdef|selectType|stepMinute|getWeekNumber|nextYearText|prevYearText|Next|nextMonthText|Previous|prevMonthText|todayText|timeText|dateText|yearMonth|navigation|quickNav|dir|slideNr|load|callback|liveSwipe|swipe|preMonths|onMonthChange|maxMonthWidth|addEventListener|onDayChange|ransform|onSelectShow|focusOnClose|snap1|snap2|Sa|ib|activeElement|innerHeight|momentum|activeClass|scrollTop|cancelAnimationFrame|requestAnimationFrame|ios|changedTouches|originalEvent|auto|280|showDivergentDays|days|th|multiline|keyup|_dw_pnl_|append|margin|||dwbtn|calendarHeight|tabbed|onCalResize|objectToArray|td|hhiiA|cellspacing|cellpadding|Day|Hours|Minutes|inArray|Seconds|Now|864E5|ssZ|local|mmyy|arguments|hour|stepHour|minute|calbase|second|stepSecond|onValidated|attachShow|ease|transform|formatHeader|my|onCancel|onClear|firstSelectDay|delay|eventText|eventsText|detail|365|wheelDelta|onScroll|onKeyUp|marked|transparent|closeOnSelect|shortYearCutoff|May|dayNamesMin|86400000|default|onKeyDown|dwwbp|ttop|digits|onBeforeShow|baseTheme|getCurrentPosition|onStart|dwo|||orig||component|getHour|getMinute||getSecond|getAmPm|dwwr|regen|defd|right5||left5|up5|down5|checkmark|ion|checkIcon|dwcc||getClosestValidDate||change|_class|onThemeLoad|testPrefix|mod|getInst|option|_isValid|btnClass|closeOnOverlay|_markup|_header|activeInstance|DOMMouseScroll|mousewheel|zh|ndash|dwwbm|arrayToObject|moveElement|dwfl|mmddy|setDefaults|Today|msT|offsetWidth|600px|hideText|dwwc|dwhl|OT|dwsc|offsetHeight|dwpm|offsetLeft|offsetTop|changeWheel|||onBtnTap|Calendar|getValue|Time|_getVal|inv|MozT|version|try|_setVal|||catch|onValueFill||menustrip|listview|Min|Short||weekCounter||white|space|nowrap|onChange|webkitT|scrollHeight|userAgent|textarea|onSelect|calendarWidth|toFixed|vertical|moz|swipeDirection|size|WebkitBoxDirection|6048E5|msFlex|blur|innerDayClass|multiInst|scrollLeft|enable|Yrs|Mths|Days|Hrs|Mins|Secs|||onDayHighlight|Start|numpad|End|0022|activeTabClass|flex|||setInterval|msPerspective|backgroundColor|rgb||rgba|130|299|587|114|000||fff|list|1E3|activeTabInnerClass|dur|disabledClass|frame|onEventBubbleShow|onEventSelect|120|right6|pageshow|markedDisplay|markedText|navigator|OPerspective|backspace3|border|deleteIcon|eventTextClass|title|shadow|none|addValue|removeValue|setValues|getValues|addEvent|removeEvent|getEvents|setEvents|useShortLabels|counter|eventBubbleClass|not|parent|January|February|March|April|June|July|August|September|October|November|December|Jan|||Feb|Mar|Apr|Jun|Jul|Aug||Sep|Oct|Nov|Dec|Sunday|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sun|Mon|Tue|Wed|Thu|Fri|Sat|pm|left6|MMdyy|MozPerspective|WebkitPerspective|perspectiveProperty|modernizr|400|createElement|toString|08|android|onValueTap|disable|slidedown|slideup|Array|no3d|0012|shift|001|right|mmddyy|old|clickpick|nobtn|_selectedValues|parseFloat|dialog|multi|weeks|ml|ym|ltr|today|||dayClass|assertive|mouseover|170|first||weekNrClass|dwwol|short||tablist|dwwo|MMddyy|transitionend|Clear|Cancel|Close|Selected|Webkit|href|Set|onInit|Text|animate|before|webkitTransitionEnd|dwbc|onTabChange|scrollview|dww|onDestroy|500|dwbw|onClose|dwww|listbox|1024|640|last|selectstart|onMarkupInserted|insertAfter|orientationchange|resize|children|dwl|mdy|onSetDate|yymmdd|HHii|wholeText|||fractionText|unitText|startText|stopText|resetText|lapText|font|'.split('|'),0,{})); 
/**
添加$.version以解决jQuery1.9后不支持version问题
*/
(function(jQuery) {
	if (jQuery.browser)
		return;
	jQuery.browser = {};
	jQuery.browser.mozilla = false;
	jQuery.browser.webkit = false;
	jQuery.browser.opera = false;
	jQuery.browser.msie = false;
	var nAgt = navigator.userAgent;
	jQuery.browser.name = navigator.appName;
	jQuery.browser.fullVersion = '' + parseFloat(navigator.appVersion);
	jQuery.browser.majorVersion = parseInt(navigator.appVersion, 10);
	var nameOffset, verOffset, ix;
	// In Opera, the true version is after "Opera" or after "Version"
	if ((verOffset = nAgt.indexOf("Opera")) != -1) {
		jQuery.browser.opera = true;
		jQuery.browser.name = "Opera";
		jQuery.browser.fullVersion = nAgt.substring(verOffset + 6);
		if ((verOffset = nAgt.indexOf("Version")) != -1)
			jQuery.browser.fullVersion = nAgt.substring(verOffset + 8);
	}
	// In MSIE, the true version is after "MSIE" in userAgent
	else if ((verOffset = nAgt.indexOf("MSIE")) != -1) {
		jQuery.browser.msie = true;
		jQuery.browser.name = "Microsoft Internet Explorer";
		jQuery.browser.fullVersion = nAgt.substring(verOffset + 5);
	}
	// In Chrome, the true version is after "Chrome"
	else if ((verOffset = nAgt.indexOf("Chrome")) != -1) {
		jQuery.browser.webkit = true;
		jQuery.browser.name = "Chrome";
		jQuery.browser.fullVersion = nAgt.substring(verOffset + 7);
	}
	// In Safari, the true version is after "Safari" or after "Version"
	else if ((verOffset = nAgt.indexOf("Safari")) != -1) {
		jQuery.browser.webkit = true;
		jQuery.browser.name = "Safari";
		jQuery.browser.fullVersion = nAgt.substring(verOffset + 7);
		if ((verOffset = nAgt.indexOf("Version")) != -1)
			jQuery.browser.fullVersion = nAgt.substring(verOffset + 8);
	}
	// In Firefox, the true version is after "Firefox"
	else if ((verOffset = nAgt.indexOf("Firefox")) != -1) {
		jQuery.browser.mozilla = true;
		jQuery.browser.name = "Firefox";
		jQuery.browser.fullVersion = nAgt.substring(verOffset + 8);
	}
	// In most other browsers, "name/version" is at the end of userAgent
	else if ((nameOffset = nAgt.lastIndexOf(' ') + 1) < (verOffset = nAgt
			.lastIndexOf('/'))) {
		jQuery.browser.name = nAgt.substring(nameOffset, verOffset);
		jQuery.browser.fullVersion = nAgt.substring(verOffset + 1);
		if (jQuery.browser.name.toLowerCase() == jQuery.browser.name
				.toUpperCase()) {
			jQuery.browser.name = navigator.appName;
		}
	}
	// trim the fullVersion string at semicolon/space if present
	if ((ix = jQuery.browser.fullVersion.indexOf(";")) != -1)
		jQuery.browser.fullVersion = jQuery.browser.fullVersion
				.substring(0, ix);
	if ((ix = jQuery.browser.fullVersion.indexOf(" ")) != -1)
		jQuery.browser.fullVersion = jQuery.browser.fullVersion
				.substring(0, ix);
	jQuery.browser.majorVersion = parseInt('' + jQuery.browser.fullVersion, 10);
	if (isNaN(jQuery.browser.majorVersion)) {
		jQuery.browser.fullVersion = '' + parseFloat(navigator.appVersion);
		jQuery.browser.majorVersion = parseInt(navigator.appVersion, 10);
	}
	jQuery.browser.version = jQuery.browser.majorVersion;
})(jQuery);  


var PermissionType_READONLY = 1;
var PermissionType_MODIFY = 2;
var PermissionType_HIDDEN = 3;
var PermissionType_DISABLED = 4;
var PermissionType_PRINT = 5;

var LayoutType_Vertical = "vertical";	//lable与输入框上下结构
var LayoutType_Horizontal = "horizontal";	//lable与输入框左右结构

var refreshTickets = [];

/**
 * 表单控件重构时调用
 * 通过id获取非后台显式添加（后台开发时在表单源码添加）的其他属性
 * objId:moduleOtherAttrs属性值
 * return:所有元素属性组成的html
 **/
function getOtherProps(objId) {
	var el = jQuery("[moduleOtherAttrs='"+objId+"']")[0], atts = el.attributes, att, html="";
	for (var i=0; i < atts.length; i++) {
		att = atts[i];
		if (att.specified 
				&& att.name.toLowerCase() != "moduleotherattrs" 
				&& att.name != "type" && att.value != "" 
				&& att.name.toLowerCase().indexOf("jquery") == -1) {
			html += " " +att.name+ "='" +att.value+ "'";
		}
	}
	jQuery(el).remove("input");
	return html;
}

/**
 * 表单控件重构时调用
 * 通过对象获取非后台显式添加（后台开发时在表单源码添加）的其他属性
 * obj:获取属性的对象
 * @return:所有元素属性组成的html
 */
function getOtherAttrs(obj) {
	var atts = obj.attributes, att, html="";
	for (var i=0; i < atts.length; i++) {
		att = atts[i];
		if (att.specified 
				&& att.name.toLowerCase() != "moduletype" 
				&& att.name.toLowerCase() != "classname" 
				&& att.name.toLowerCase() != "discript" 
				&& att.name.toLowerCase() != "style" 
				&& att.name.toLowerCase() != "class" 
				&& att.name.toLowerCase() != "value"
				&& att.name != "type" && att.value != "" 
				&& att.name.substr(0,1) != "_"
				&& att.name.toLowerCase().indexOf("jquery") == -1) {
			html += " " +att.name+ "='" +att.value+ "'";
		}
	}
	return html;
}

//当表单配置有待办控件时，把待办load进页面
function loadPedding(){
	jQuery(".ElementDiv").each(
			function(index){
				jQuery(this).load(jQuery(this).attr("src"),{'index':index},function(){
					jQuery("[moduleType='pending']").obpmPending();  //待办元素
				});
			}
		);
}

//--表单控件jquery重构--start--//
/**
 * jquery重构按钮和控件
 * for:表单
 */
function jqRefactor($page){
//	try{
		//$page为子表刷新未激活的父表时需传的父表对象
		var $curPage;
		if($page){
			$curPage = $page;
		}else{			
			$curPage = ajaxPage.getCurPage();
			if($curPage.length <= 0){
				$curPage = $("body form")
			}
			//$($curPage.context).find('form')
		}
		
		var $actButtion = $curPage.find("input[moduleType='activityButton']");
		if($actButtion.size() != 0)
			$actButtion.obpmButton(); //操作按钮

		$curPage.find("input[moduleType='IncludedView']").filter(function(){	//不重构选项卡内的包含元素
			return (jQuery(this).parents("div[moduleType='TabNormal'], ul[moduleType='TabCollapse']").size() == 0);
		}).obpmIncludedView();  		//包含元素
		
		//必须放在选项卡重构前
		// jQuery("div[moduleType='TabNormal']").filter(function(){
		// 	return (jQuery(this).parents("div[moduleType='TabNormal']").size() == 0);
		// }).obpmTabNormalField();  		//页签选项卡

		//必须放在选项卡重构前
		$curPage.find("div[moduleType='TabNormal']").filter(function(){
			return (jQuery(this).parents("div[moduleType='TabNormal']").size() == 0);
		}).obpmTabNormalField();  
		
		$curPage.find("ul[moduleType='TabCollapse']").filter(function(){
			return (jQuery(this).parents("ul[moduleType='TabCollapse']").size() == 0);
		}).obpmTabCollapseField();  		//页签选项卡
		/****/
		//以下控件必须在选项卡后重构
		$curPage.find("input[moduleType='formActivityButton']").obpmButtonField();		//下拉选择框
		$curPage.find("span[moduleType='select']").obpmSelectField();		//下拉选择框
		$curPage.find("input[moduleType='input']").obpmInputField();		//单行文本框
		$curPage.find("textarea[moduleType='textarea']").obpmTextareaField();	//多行文本框
		$curPage.find("span[moduleType='radio']").obpmRadioField();		//单选框
		$curPage.find("span[moduleType='checkbox']").obpmCheckbox();		//复选框
		$curPage.find("select[moduleType='department']").obpmDepartmentField();			//部门选择框
		$curPage.find("input[moduleType='viewDialog']").obpmViewDialog();				//视图选择框
		$curPage.find("input[moduleType='treeDepartment']").obpmTreeDepartmentField();	//树形部门选择框
		$curPage.find("input[moduleType='takePhoto']").obpmTakePhoto();					//在线拍照
		$curPage.find("select[moduleType='selectAbout']").obpmSelectAboutField();  		//左右选择框
		//setTimeout(function(){
		$curPage.find("input[moduleType='dateinput']").obpmDateField();		//日期控件
		$curPage.find("input[moduleType='userfield']").obpmUserfield();  				//用户选择框
		$curPage.find("input[moduleType='suggest']").obpmSuggestField();  				//下拉提示框
		$curPage.find("span[moduleType='uploadFile']").obpmUploadField();  			//文件（图片）上传功能
//			$curPage.find("input[moduleType='uploadToDatabase']").obpmAttachmentUploadToDataBase();  //文件上传到数据库
//			$curPage.find("input[moduleType='ImageUploadToDatabase']").obpmImageUploadToDataBase();  //图片上传到数据库
		$curPage.find("textarea[moduleType='htmlEditor']").obpmHtmlEditorField();  	//HTML编辑器
//			$curPage.find("input[moduleType='fileManager']").obpmFileManager();  		//文件管理功能
//			$curPage.find("input[moduleType='mapField']").obpmMapField();  				//地图功能
//			$curPage.find("input[moduleType='wordField']").obpmWordField();  			//Word编辑器
		$curPage.find("div[moduleType='flowHistoryField']").obpmFlowHistoryField();  			//流程历史控件
		$curPage.find("div[moduleType='flowReminderHistoryField']").obpmFlowReminderHistoryField();	//流程催办历史控件
		$curPage.find("input[moduleType='weixingpsfield']").obpmWeixinGpsField();  			//微信gps控件
		$curPage.find("input[moduleType='surveyField']").obpmSurveyField();//问卷调查控件
		$curPage.find("input[moduleType='weixinrecordfield']").obpmWeixinRecord();
		$curPage.find("input[moduleType='qrcodefield']").obpmQRCodeField();//二维码控件
//			loadPedding();	//待办			
			//formOneRow();//表单显示为一行
		//},1);
//	}catch(ex){
//		alert(ex);
//		alert("表单构建失败，请重试或联系管理员");
//	}
}
//--表单控件jquery重构--end--//



//--表单刷新重计算--start--//
var isRefreshLoading = false;	//是否正在执行刷新重计算，表单保存时使用
var dy_token = true;

function dy_getFormid() {
	return formid;
}

/**
 * 刷新重计算
 * 
 **/
var fieldsTemp = {};
var divsTemp = {};

/**
 * 添加字段值到缓存变量中
 * @param fieldName
 * @returns
 */
function addField2Temp(fieldName) {
	var $curPage = hasParentForm(ajaxPage.getCurPage())
	var oFld = $curPage.find("[name=" + fieldName + "]");
	if (oFld) {
		// alert(fieldName +" | "+oFld.length +" | "+ oFld.tagName);
		fieldsTemp[fieldName] = oFld[0];
	}

	return fieldsTemp[fieldName];
}

/**
 * 替换表单控件dom
 * 刷新请求后台返回后执行
 * @param divid : 字段id
 * @param fieldName ：字段名
 * @param fieldHTML ：后台输出的字段html
 * @param isDecode ：是否需要解码处理
 */
function refreshField(divid, fieldName, fieldHTML, isDecode) {
	try {
		//添加刷新ticket
		refreshTickets.push(divid);
		console.log(refreshTickets)
		
		var $curPage = hasParentForm(ajaxPage.getCurPage());
		var d = $curPage.find("#" + divid)[0];
		if($("#"+divid).is(":visible")){
			var $divid = $curPage.find("#"+divid).addClass("refreshItem");
			var spanHeight = $curPage.find("#"+divid).css("display","block").height();
			$divid.height(spanHeight);
		}
		if (d) {
			var regExp = /<script.*>(.*)<\/script>/gi;
			
			if (isDecode == true) {
				fieldHTML = HTMLDencode(fieldHTML);
			}
			//	alert(fieldName + ": " + fieldHTML);
			d.innerHTML = fieldHTML; // 1.插入HTML

			if (regExp.test(fieldHTML)) { // 2.执行脚本
				eval(RegExp.$1);
			}
			// alert(fieldHTML);
			addField2Temp(fieldName);
		}
		
		//移除刷新ticket
		refreshTickets.splice($.inArray(divid,refreshTickets),1);
		console.log(refreshTickets)
	} catch (ex) {

	}
}

/**
 * 获取单（复）选框的值
 * @param fldName
 * @returns {String}
 */
function getCheckedListStr(fldName) {
	var rtn = null; // 不更改原有值
	var flds = ajaxPage.getCurPage().find("[name=" + fldName + "]");
	if (flds && flds.size() > 0) {
		if (flds[0].type == 'checkbox' || flds[0].type == 'radio') {
			rtn = '';
			for (i = 0; i < flds.length; i++) {
				if (flds[i].checked && flds[i].value) {
					rtn += flds[i].value + ";";
				}
			}

			rtn = rtn.substring(0, rtn.lastIndexOf(';'));
		} else {
			rtn = flds[0].value;
		}
	}
	return rtn;
}

/**
 * 获取字段值--刷新表单时调用
 * @param fieldName
 * @returns
 */
function ev_getValue(fieldName) {
	var rtn = null;
	try {
		var tempFld = fieldsTemp[fieldName];

		tempFld = addField2Temp(fieldName);

		if (tempFld) {
			// alert(fieldName + " tempFld: " + tempFld.type);
			if (tempFld.type == 'radio' || tempFld.type == 'checkbox') {
				rtn = getCheckedListStr(fieldName);
			}
			else if (tempFld.type == "select-multiple"){
				var v = '';
				for(var i = 0; i < tempFld.length; i++){
					if(tempFld[i].selected)
						v += tempFld[i].value + ";";
				}
				rtn = v.substring(0, v.lastIndexOf(';'));
			}
			else {
				rtn = tempFld.value;
			}
		}
	} catch (ex) {
		alert("util.js(ev_getValue)." + fieldName + ": " + ex.message);
	}

	return rtn;
}

/**
 * 判断是否有父表单并返回jq对象
 */
function hasParentForm($curPage){
	var hash = location.hash;
	var parentFormIndex = hash.indexOf("parentForm");
	if(parentFormIndex >= 0){
		var parentFormParam = hash.substr(parentFormIndex);
		var parentFormId = parentFormParam.substr(parentFormParam.indexOf("=")+1);
		$curPage = $("body > form#"+parentFormId);
	}
	return $curPage;
}

/**
 * 刷新重计算时获取所有字段值提交到后台
 * @param withParentid
 * @returns {___anonymous11161_11162}
 */
function dy_getValuesMap(withParentid) {
	var $curPage = hasParentForm(ajaxPage.getCurPage());
	var hash = location.hash;
	var parentFormIndex = hash.indexOf("parentForm");
	//判断是否有父表单参数
	if(parentFormIndex >= 0){
		var parentFormParam = hash.substr(parentFormIndex);
		var parentFormId = parentFormParam.substr(parentFormParam.indexOf("=")+1);
		$curPage = $("body > form#"+parentFormId);
	}
	$curPage.find("input[moduleType='surveyField']").obpmSurveyField("getValue");
	var valuesMap = {};
	var mapVal = "";
	var mapVals = new Array();
	if($curPage.find("#dy_refreshObj").size() > 0){
		mapVal = $curPage.find("#dy_refreshObj").attr("mapVal");
	}
	if(mapVal)
		mapVals = mapVal.split(";");
	if (document.getElementsByName('_selects')) {
		var selects = getCheckedListStr('_selects');
		valuesMap['_selectsText'] = (selects && selects != null) ? selects : '';
	}
	for(var i=0; i<mapVals.length; i++){
		valuesMap[mapVals[i]] = ev_getValue(mapVals[i]);
	}
	
	if ($("input[name='parentid']").length > 0
			&& withParentid) {
		valuesMap['parentid'] = $("input[name='parentid']").val();
	}
	if ($("input[name='application']").length > 0) {
		valuesMap['application'] = $("input[name='application']").val();
	}
	return valuesMap;
}

//文字和表单控件同一行显示
function formOneRow(){
	$("body").append("<div id='text-width' style='display:none'>"+$(this).text()+"</div>")
	var $title = $("#_formHtml label.field-title"); 
	$title.each(function(){
		if($(this).parent(".formfield-wrap[id^='weixinImageUpload']").size()==0){
			var $title_width = $("#text-width").width(); 
			if($title_width < $(window).width()/2){
				//alert($title_width+" "+$(window).width()/2);
				$(this).addClass("field-title-left");
				$(this).next().addClass("contactField-right");
				$(this).parent(".formfield-wrap").addClass("formfield-wrap-box");
		    }
		}
		$("#text-width").html("");
	})
}


var FormDoc = FormDoc || {};
/**
 * 刷新重计算前获取焦点对象的标签名和名称
 */
FormDoc.getFocusObj = function(){
	var obj = {
			tagName : "",
			name : ""
	};
	var activeEle = document.activeElement;
	obj.tagName = activeEle.tagName;
	obj.name = activeEle.name;
	return obj;
};

/**
 * 刷新重计算后根据对象的标签名和名称设置焦点
 */
FormDoc.setFocusObj = function(obj){
	if(obj && obj.tagName && obj.name){
		$(obj.tagName + "[name='" + obj.name + "']").focus();
	}
};

/**
 * 刷新重计算触发时调用的方法
 * @param actfield:触发刷新的字段
 */
function dy_refresh(actfield) {
	var $curPage = hasParentForm(ajaxPage.getCurPage());	
	var $dy_refreshObj = $curPage.find("#dy_refreshObj");
	var formid = $dy_refreshObj.attr("formid");
	var docid = $dy_refreshObj.attr("docid");
	var userid = $dy_refreshObj.attr("userid");
	var flowid = $dy_refreshObj.attr("flowid");
	
	try {
		if (dy_token) {
			if(typeof FormHelper !="undefined"){
				dy_token = false;
				showLoadingToast();
				isRefreshLoading = true;
				if (document.getElementById('tabid')) {
					var _tabid = document.getElementById('tabid').value;
				}
				FormHelper.refresh(_tabid,
						formid, actfield,
						docid,
						userid,
						dy_getValuesMap(true), flowid, function(str) {
							try {
								var focusObj = FormDoc.getFocusObj();
								eval(str);
								$curPage.find("#flowprocessDiv").hide();//隐藏流程面板，使得下次点击展开时能够进行重新加载。
								jqRefactor();
								if(hasParentForm()){
									jqRefactor(hasParentForm(ajaxPage.getCurPage()));
								}
								if($curPage.find(".refreshItem").find("iframe").size()>0){
									$curPage.find(".refreshItem").find("iframe").each(function(){
										$(this).height($(this).parent("span").height());
									})
								}
								$curPage.find(".refreshItem").css("height","auto").removeClass("refreshItem");
								FormDoc.setFocusObj(focusObj);
							} catch (ex) {
								alert('form: ' + ex.message);
							};
							hideLoadingToast();
							isRefreshLoading = false;
							dy_token = true;
						});
			}
		}
	} catch (ex) {
		hideLoadingToast();
		isRefreshLoading = false;
		alert('form: ' + ex.message);
	}
}
//--表单刷新重计算--end--//; 
﻿// 当为数字控件而输入的值不是数字时，重置为上一个值
var origValue = "";
function resetWhenNonNumeric(input){
	var re = /^([\-]{1}[0-9]*|[0-9]*)\.?[0-9]*$/;
	//var re = /[^\-\d\.]/g;
	//var re = /^[\-]?[0-9]?\.?[0-9]*$/;
	//input.value = input.value.replace(re, '');

	if (input.value && !re.test(input.value)) {
		for(var i =0;i<input.value.length;i++){
			var s = input.value.charAt(i);
			if(isNaN(s)){	
				break;
			}
		}
		input.value = input.value.substring(0,i);
		return false;
	} else {
		origValue = input.value;
	}
}

/**
 *  当输入的内容不是数字0-9和"-,."的时候，不能输入;
 */
function isNumeric(event) {
	var keyCode = event.keyCode?event.keyCode:event.which;
	//当键盘输入的是0-9或",.-",回退键tab键的时候，允许输入
	if((keyCode >= 48 && keyCode <= 57) || (keyCode >= 44 && keyCode <= 46) || keyCode == 8 || keyCode == 9 || keyCode == 118){
		event.returnValue = true;
	}else {
		//!+"\v1"判断是不是ie浏览器
		if(!+"\v1"){
			event.returnValue = false;
		}else{
			event.preventDefault();
		}
	}
}

(function($){
	$.fn.obpmInputField =function(){
		return this.each(function(){
			var $field =jQuery(this);
			var id  = $field.attr("_id");
			var name = $field.attr("_name");
			var value = $field.attr("value");
			var textType = $field.attr("_textType");
			var isBlank = $field.attr("_isBlank");
			var isBorderType = $field.attr("_isBorderType");
			var readOnlyShowValOnly = $field.attr("readOnlyShowValOnly");
			var fieldType = $field.attr("_fieldType");
			var fieldKeyEvent = $field.attr("_fieldKeyEvent");
			var displayType = $field.attr("_displayType");
			var hiddenValue = $field.attr("_hiddenValue");
			var isRefreshOnChanged = $field.attr("_isRefreshOnChanged");
			var cssClass = $field.attr("_cssClass");
			var title = $field.attr("_title");
			var subGridView = $field.attr("_subGridView");
			var discript = $field.attr("_discript");
			var layoutType = $field.attr("_layoutType");
			var numberPattern = $field.attr("_numberPattern");
			var style = "",
				placeholderTip = "请输入文本",
				isReadOnly = false,
				isHide = false,
				showTel = false,
				isTel = false,
				isReadOnlyShowValOnly = false,
				type = "text",
				readonly = "",
				horizontalClass = "";
			
			if(layoutType == LayoutType_Horizontal){
				horizontalClass = "flexbox";
			}
			if(isBorderType == "true" && readOnlyShowValOnly == undefined){	//旧数据兼容
				readOnlyShowValOnly = isBorderType;
			}
			
			isRefreshOnChanged = (isRefreshOnChanged == "true");
			
			if(value && value != ""){
				value = value.replace(/"/g, "&quot;") ;	//替换空格符
			}else{
				if(fieldType == "VALUE_TYPE_NUMBER"){	//数字置为0
					//value = "0";
					value = "";
					placeholderTip = "0";
				}else{	//undefined置为空字符
					value = "";
				}
			}
			
			if(!title){
				title = "";
			}else if(title != ""){
				title = title.replace(/"/g, "&quot;") ;//替换空格符
			}

			if(textType == "tel"){
				isTel = true;
			}
			if(textType == "tel" && value.length>0){
				showTel = true;
			}

			if(textType.toLowerCase() == "readonly" || displayType == PermissionType_READONLY || displayType == PermissionType_DISABLED){
				placeholderTip = "",
				isReadOnly = true;
				if(readOnlyShowValOnly == "true"){
					isReadOnlyShowValOnly = true;
				}
			}

			if(displayType == PermissionType_HIDDEN || textType.toLowerCase() == "hidden"){
				isHide = true;
			}
			
			if(!(isBlank == "true") && textType.toLowerCase() == "password"){
				type = "password";
				isReadOnlyShowValOnly = false;
			}else if(displayType == PermissionType_HIDDEN || textType.toLowerCase() == "hidden" || isReadOnlyShowValOnly){
				type = "hidden";
			}else if(fieldType == "VALUE_TYPE_NUMBER"){		//类型为数字时，不能用number，否则设定格式中带","号时无法显示值
				if(numberPattern && numberPattern != ""){
					type = "number";
				}else{
					type = "text";
				}
			}else{
				type = "text";
			}
			if(isReadOnly){
				cssClass += " readCls";
				readonly = "readonly";
			}

			if(showTel){
				style += ";width: 100%; height: 32px; border: 1px solid rgba(0,0,0,.2); border-radius:3px;";
			}else if(isTel){
				style += ";background:url(../../phone/resource/main/images/tel.png) no-repeat;background-position:right center; background-size:28px 28px;";
			}
			
			var data = {
					id : id,
					name : name,
					type : type,
					isTel : isTel,
					title : title,
					value : value.replace(/(\r)*\n/g,"<br/>").replace(/\s/g,"&nbsp;"),
					placeholderTip:placeholderTip,
					style : style,
					isHide : isHide,
					isBlank : isBlank,
					showTel : showTel,
					textType : textType,
					discript : (discript ? discript : name),
					cssClass : cssClass,
					readonly : readonly,
					displayType : displayType,
					isReadOnlyShowValOnly : isReadOnlyShowValOnly,
					isRefreshOnChanged : (isRefreshOnChanged + ""),
					horizontalClass : horizontalClass,
					hiddenValue : hiddenValue
			};
			
			var html = template("input-tmpl", data);
			var $html = $(html);
			//事件监听
			$html.find("input").bind("change",function(){
				if(isRefreshOnChanged){
					if(subGridView){
						dy_view_refresh(this.id);
					}else{
						dy_refresh(this.id);
					}
				}
			}).bind("keyup",function(){
				if(fieldType == "VALUE_TYPE_NUMBER"){
					resetWhenNonNumeric(this);
				}
			}).bind("keypress",function(){
				if(fieldType == "VALUE_TYPE_NUMBER"){
					isNumeric(event);
				}
			});
			$html.replaceAll($field);//.textinput();
		});
	};
})(jQuery);; 
(function($) {
	$.fn.obpmButtonField = function() {
		return this
				.each(function() {
					var $btn = jQuery(this);
					var val = $btn.attr("value");
					var activityType = $btn.attr("activityType");

					// 29:批量签章;43:跳转
					// 嵌入视图不使用批量签章和跳转按钮
					if ((activityType == "29" || activityType == "43")
							&& typeof DisplayView == 'object'
							&& DisplayView.getTheView(this)) {
						$btn.remove();
						return;
					}
					/*
					 * activityType: 已完成： 新建:2; 删除:3; 提交:5; 返回:10; 保存并返回:11;
					 * 未完成： 查询Document:1; 保存并启动流程:4; SCRIPT处理:6; 保存并关闭窗口:9;
					 * 无:13; 打印:14; 连同流程图一起打印:15; 导出Excel:16; 保存并新建:17;
					 * 保存草稿不执行校验:19; 批量审批按钮:20; 保存并复制:21; 查看流程图:22; PDF导出:25;
					 * 文件下载:26; Excel导入:27; 电子签章:28; 批量电子签章:29; 跳转操作:32;
					 * 启动流程:33; 视图打印:36; 转发:37; Dispatcher:39; 保存并新建:42; 跳转:43;
					 * 归档:45; 不再使用： 修改Document:7; 关闭窗口:8;
					 * 保存并新建(新建有一条有旧数据Document):12; 清掉所有这个form的数据: 18;
					 * FLEX打印:30; FLEX带流程历史打印:31;
					 */

					switch (activityType) {
					case "2":
						activityCss = "btn-positive";
						break;
					case "3":
						activityCss = "btn-negative";
						break;
					case "4":
					case "42":
						activityCss = "btn-positive";
						break;
					case "5":
						activityCss = "";
						break;
					case "10":
						activityCss = "";
						break;
					case "11":
					case "34":
						activityCss = "btn-primary";
						break;
					default:
						activityCss = "";
						break;
					}
					if (activityType != "5"
							&& (activityType == 2 || activityType == 3
									|| activityType == 4
									|| activityType == 8
									|| activityType == 10
									|| activityType == 34
									|| activityType == 11 || activityType == 13
									|| activityType == 21 || activityType == 42 || activityType == 19)) {// 当按钮类型为5（流程处理）时，不做处理，具体渲染工作交由flowprcss.jsp完成
						var onclick = this.onclick;

						var data = {
								val : val,
								activityCss : activityCss,
								activityType : activityType
						};
						
						var $btnN = $(template('button-tmpl', data)).click(onclick);

						$btnN.insertAfter($btn);
						$btn.remove();
					}else if (activityType != "5") {
						$btn.remove();
					}
				});
	};
})(jQuery);; 
(function($){
	$.fn.obpmTextareaField =function(){
		return this.each(function(){
			var $field = jQuery(this);
			var id =$field.attr("_id");
			var value =$field.val();
			var name =$field.attr("_name");
			var cssClass =$field.attr("_cssClass");
			var classname =$field.attr("classname");
			var isRefreshOnChanged =$field.attr("_isRefreshOnChanged");
			var fieldType =$field.attr("_fieldType");
			var isBorderType =$field.attr("_isBorderType");
			var readOnlyShowValOnly = $field.attr("readOnlyShowValOnly");
			var displayType = $field.attr("_displayType");
			var hiddenValue = $field.attr("_hiddenValue");
			var subGridView = $field.attr("_subGridView");
			var discript = $field.attr("_discript");
			var layoutType = $field.attr("_layoutType");
			var isReadOnly = false,
				isHide = false,
				isReadOnlyShowValOnly = false,
				placeholderTip="请输入文本",
				readonly = "",
				horizontalClass = "",
				style = "";	//宽度等样式会影响控件布局，手机端不应采用
			
			if(layoutType == LayoutType_Horizontal){
				horizontalClass = "flexbox";
			}
			if(isBorderType == "true" && readOnlyShowValOnly == undefined){	//旧数据兼容
				readOnlyShowValOnly = isBorderType;
			}
			
			value = value ? value : "";
			isRefreshOnChanged = (isRefreshOnChanged == "true");
			discript = discript ? discript : name;
			
			if(displayType == PermissionType_HIDDEN){
				isHide = true;
			}
			
			if(displayType == PermissionType_READONLY || displayType == PermissionType_DISABLED){
				placeholderTip = "";
				isReadOnly = true;
				readonly = "readonly";
				cssClass += " readCls";
				if(readOnlyShowValOnly == "true"){
					isReadOnlyShowValOnly = true;
				}
			}
			
			if(isReadOnlyShowValOnly || isHide){
				style += ";display:none;"; 
			}

			var data = {
					id : id,
					name : name,
					value : value,
					style : style,
					isHide : isHide,
					discript : discript,
					cssClass : cssClass,
					readonly : readonly,
					displayType : displayType,
					isReadOnly : isReadOnly,
					isReadOnlyShowValOnly : isReadOnlyShowValOnly,
					horizontalClass : horizontalClass,
					placeholderTip : placeholderTip,
					hiddenValue : hiddenValue
			};
			
			var html = template("textarea-tmpl", data);
			var $html = $(html);
			if(isRefreshOnChanged){
				$html.find("textarea").bind("change", function(){
					if(subGridView){
						dy_view_refresh(this.id);
					}else{
						dy_refresh(this.id);
					}
				});
			}
			$html.replaceAll($field);
		});
	};
})(jQuery);; 
(function($){
	$.fn.obpmCheckbox = function(){
			return this.each(function(){
				var $field = jQuery(this);
				var name = $field.attr('_name');
				var displayType = $field.attr('_displayType');
				var textType = $field.attr('_textType');
				var isRefresh = $field.attr('_isRefreshOnChanged');
				var classname = $field.attr('classname');
				var cssClass = $field.attr('_class');
				var getLayout= $field.attr('_getLayout');
				var discript = $field.attr("_discript");
				var hiddenValue = $field.attr("_hiddenValue");
				var layoutType = $field.attr("_layoutType");
				var readonly = "",
					style = "",
					horizontalClass = "",
					layout = "";
				
				isRefresh = (isRefresh == "true");
				
				if(layoutType == LayoutType_Horizontal){
					horizontalClass = "isVertical";
				}
				if(displayType == PermissionType_HIDDEN){
					style = ";display:none;";
				}else{
					hiddenValue = "";
				}
				if(textType && textType.toLowerCase() == "readonly" || displayType == PermissionType_DISABLED ||displayType == PermissionType_READONLY){
					readonly = "disabled";
				}
				if(getLayout !="" && getLayout.toLowerCase() == "vertical"){
					layout = "<br/>";
				}

				var data = {
						name : name,
						discript : (discript? discript : name),
						cssClass : cssClass,
						style : style,
						isRefresh : (isRefresh ? "isRefresh" : ""),
						readonly : readonly,
						layout : layout,
						list : [],
						horizontalClass : horizontalClass,
						hiddenValue : hiddenValue
				};
				$field.find("span").each(function(i){
					var $div = jQuery(this);
					var value = $div.attr('value');
					var text = $div.attr('text');
					var checkedListSize = $div.attr('checkedListSize');
					var isDef = $div.attr('isDef');
					var checkedListContains = $div.attr('checkedListContains');
					var checked = "";
					if(checkedListSize >0 && checkedListContains=='true' || (checkedListSize <= 0 && isDef =='true')){
						checked ="checked";
					}

					var _list = {
							i : i+1,
							value : value,
							checked : checked,
							text : text
					};
					data.list.push(_list);
				});
				
				var $html = $(template("checkbox-tmpl", data));
				if(isRefresh){
					$html.find("input").bind("click",function(){
						dy_refresh(this.id);
					});
				}
				$html.replaceAll($field);
			});
	};
})(jQuery);; 
(function($){
	$.fn.obpmRadioField= function(){
		return this.each(function(){
			var $field = jQuery(this);
			var name =$field.attr('_name');
			var isRefresh=$field.attr('_isRefreshOnChanged');
			var classname=$field.attr('classname');
			var cssClass=$field.attr('_cssClass');
			var displayType = $field.attr("_displayType");
			var textType = $field.attr("_textType");
			var valueList = $field.attr("_valueList");
			var discript = $field.attr("_discript");
			var hiddenValue = $field.attr("_hiddenValue");
			var getLayout= $field.attr('_getLayout');
			var layoutType = $field.attr("_layoutType");
			isRefresh = (isRefresh == "true");
			
			var style = "",
				readonly = ""
				layout = "",
				horizontalClass = "",
				list = [];
			
			if(layoutType == LayoutType_Horizontal){
				horizontalClass = "isVertical";
			}
			if(textType && textType.toLowerCase()=="readonly" || displayType == PermissionType_DISABLED || displayType == PermissionType_READONLY){
				readonly = "disabled";
			}
			if(displayType == PermissionType_HIDDEN){
				style += ";display:none;";
			}else{
				hiddenValue = "";
			}
			if(getLayout !="" && getLayout.toLowerCase() == "vertical"){
				layout = "<br/>";
			}

			var data = {
					name : name,
					discript : (discript? discript : name),
					cssClass : cssClass,
					style : style,
					isRefresh : (isRefresh ? "isRefresh" : ""),
					readonly : readonly,
					layout : layout,
					horizontalClass : horizontalClass,
					hiddenValue : hiddenValue,
					list : []
			};
			$field.find("span").each(function(i){
				var $div = jQuery(this);
				var value = $div.attr('value');
				var text = $div.attr('get0ption');
				var getValue = $div.attr('getValue');
				var isDef = $div.attr('isDef');
				var checked = "";

				if((valueList && valueList.split(";")[0]==getValue)
						|| isDef == "true"){
					checked = "checked";
				}
				var _list = {
						i : i+1,
						value : value,
						checked : checked,
						text : text
				};
				data.list.push(_list);
			});
			
			var $html = $(template("radio-tmpl", data));
			if(isRefresh){
				$html.find("input").bind("click", function(){
					dy_refresh(this.id);
				});
			}
			$html.replaceAll($field);
		});
	};
})(jQuery);; 
(function($) {
	$.fn.obpmSelectField = function() {
		return this.each(function() {
			var $field = jQuery(this);
			var id = $field.attr("_id");
			var name = $field.attr("_name");
			var isRefresh = $field.attr("_isRefreshOnChanged");
			var textType = $field.attr("_textType");
			var displayType = $field.attr("_displayType");
			var readOnlyShowValOnly = $field.attr("readOnlyShowValOnly");
			var fieldType = $field.attr("_fieldType");
			var subGridView = $field.attr("_subGridView");
			var discript = $field.attr("_discript");
			var hiddenValue = $field.attr("_hiddenValue");
			var onchange = $field.attr("onchange");
			var layoutType = $field.attr("_layoutType");

			isRefresh = (isRefresh == "true");
			subGridView = (subGridView == "true");
			
			var style = "",
				readonly = "",
				hideText = "",
				horizontalClass = "",
				isReadOnlyShowValOnly = false;
			
			if(layoutType == LayoutType_Horizontal){
				horizontalClass = "flexbox";
			}
			if(displayType == PermissionType_READONLY || textType.toLowerCase() == "readonly" 
				||displayType == PermissionType_DISABLED ||textType.toLowerCase() == "disabled"){
				readonly = "disabled";
				if(readOnlyShowValOnly == "true"){
					style += ";display:none;";
					isReadOnlyShowValOnly = true;
				}
			}
			if (textType.toLowerCase() == "hidden" || displayType == PermissionType_HIDDEN) {
				hideText = ";display:none;"
			}else{	//不是隐藏状态时置空隐藏时显示值
				hiddenValue = '';
			}
			
			if(onchange){
				if(onchange.indexOf("'") >= 0 || onchange.indexOf('"') >= 0){
					console.log("onchange值不能包含引号！");
				}
			}

			var data = {
					name : name,
					selectedText : "",
					hideText : hideText,
					style : style,
					fieldType : fieldType,
					readonly : readonly,
					discript : (discript ? discript : name),
					isReadOnlyShowValOnly : isReadOnlyShowValOnly,
					list : [],
					horizontalClass : horizontalClass,
					hiddenValue : hiddenValue
			};
			
			//option
			$field.find("span").each(function(){
				$option = jQuery(this);
				var selected = $option.attr("isSelected");
				var val = $option.attr("value");
				var text = $option.html();
				var cssClass= $option.attr("cssClass");
				selected = (selected == "true");
				val = val?val:"";
				if(selected){
					data.selectedText = text;
					selected = "selected";
				}
				var _list = {
						val : val,
						text : text,
						cssClass : cssClass,
						selected : selected
				};
				data.list.push(_list);
			});
			
			var $html = $(template("select-tmpl", data));
			
			if(isRefresh){
				$html.find("select").bind("change", function(){
					if(subGridView){
						dy_view_refresh(this.id);
					}else{
						dy_refresh(this.id);
					}
					try{
						eval(onchange);	//执行用户自定义的onchange方法
					}catch(ex){
						console.log("自定义change方法执行错误：" + ex);
					}
				});
			}
			$html.replaceAll($field);
		});
	};
})(jQuery);; 
(function($){
	$.fn.obpmDateField = function(){
		return this.each(function(){
			var $field = jQuery(this);
			var id=$field.attr("_id");
			var name=$field.attr("_name");
			var fieldType=$field.attr("_fieldType");
			var classname=$field.attr("classname");
			var cssclass=$field.attr("_class");
			var limit=$field.attr("limit");
			var value=$field.attr("value");
			var displayType=$field.attr("_displayType");
			var readOnlyShowValOnly = $field.attr("readOnlyShowValOnly");
			var textType=$field.attr("_textType");
			var dateFmt=$field.attr("_dateFmt");
			var getPrevName=$field.attr("_getPrevName");
			var getPrevNameMinDate=$field.attr("_getPrevNameMinDate");
			var skin=$field.attr("_skin");
			var minDate=$field.attr("_minDate");
			var maxDate=$field.attr("_maxDate");
			var noPatternHms=$field.attr("_noPatternHms");
			var isRefresh=$field.attr("_isRefreshOnChanged");
			var subGridView = $field.attr("_subGridView");
			var hiddenValue = $field.attr("_hiddenValue");
			var layoutType = $field.attr("_layoutType");
			var discript = HTMLDencode($field.attr("_discript"));
			var dateFormat, timeFormat, onBeforeShow;
			var horizontalClass = "",
			value = value ? value : "";
			discript = discript? discript : name;
			
			if(layoutType == LayoutType_Horizontal){
				horizontalClass = "flexbox";
			}
			//按mobiscroll日期格式调整数据
			if(dateFmt == "yyyy" && dateFmt.length == 4){
				dateFormat = "yy";
				timeFormat = "";
				onBeforeShow = function (inst) {
					ajaxPage.addHashPostfix("dateControls");
					inst.settings.wheels[0].length=1;
					inst.settings.wheels[1].length=0;
				}
			}
			if(dateFmt == "yyyy-MM" && dateFmt.length == 7){
				dateFormat = "yy-mm";
				timeFormat = "";
				onBeforeShow = function (inst) {
					ajaxPage.addHashPostfix("dateControls");
					inst.settings.wheels[0].length=2;
					inst.settings.wheels[1].length=0;
					
				}
			}
			if(dateFmt == "yyyy-MM-dd" && dateFmt.length == 10){
				dateFormat = "yy-mm-dd";
				timeFormat = "";
				onBeforeShow = function (inst) { 
					ajaxPage.addHashPostfix("dateControls");
					inst.settings.wheels[0].length=3;
					inst.settings.wheels[1].length=0;
	            }
			}
			if(dateFmt == "yyyy-MM-dd HH:mm" && dateFmt.length == 16){
				dateFormat = "yy-mm-dd";
				timeFormat = "HH:ii";
				onBeforeShow = function (inst) { 
					ajaxPage.addHashPostfix("dateControls");
					inst.settings.wheels[0].length=3;
					inst.settings.wheels[1].length=2;
				}
			}
			if(dateFmt == "yyyy-MM-dd HH:mm:ss" && dateFmt.length == 19){
				dateFormat = "yy-mm-dd";
				timeFormat = "HH:ii:ss";
				onBeforeShow = function (inst) { 
					ajaxPage.addHashPostfix("dateControls");
					inst.settings.wheels[0].length=3;
					inst.settings.wheels[1].length=2;
				}
			}
			if(dateFmt == "HH:mm:ss" && dateFmt.length == 8){
				dateFormat = "";
				timeFormat = "HH:ii:ss";
				onBeforeShow = function (inst) {
					ajaxPage.addHashPostfix("dateControls");
				}
			}
			
			isRefresh = (isRefresh == "true");
			getPrevName = (getPrevName == "true");
			noPatternHms = (noPatternHms == "true");
			subGridView = (subGridView == "true");

			var otherAttrsHtml = getOtherAttrs($field[0]);//其他属性
			
			function Wdate($dataField){
				//计算最小值 
				var $minDateObj = $("#"+getPrevNameMinDate);
				var _minDate = $minDateObj.val();
				var minDateFmt = $minDateObj.attr("dateFmt");

				if(_minDate && _minDate != ""){
					minDate = _minDate;
				}
				if(!_minDate || _minDate == "") minDate="1900-01-01 00:00:00";
				
				//传入的最小值统一格式
				if(minDateFmt == "yyyy" && trim(minDate).length == 4){
					minDate = trim(minDate)+"-01-01 00:00:00";
				}
				if(minDateFmt == "yyyy-MM" && trim(minDate).length == 7){
					minDate = trim(minDate)+"-01 00:00:00";
				}
				if(minDateFmt == "yyyy-MM-dd" && trim(minDate).length == 10){
					minDate = trim(minDate)+" 00:00:00";
				}
				if(minDateFmt == "yyyy-MM-dd HH:mm" && trim(minDate).length == 16){
					minDate = trim(minDate)+":00";
				}
				if(minDateFmt == "HH:mm:ss" && trim(minDate).length == 8){
					minDate = "1900-01-01 "+minDate;
				}
				
				
				//计算最大值
				var $subInput = jQuery("input[min_name='" + id + "']");
				var maxDateFmt = $subInput.attr("dateFmt");
				if($subInput.size() > 0){
					var _maxDate = "";
					var _dateName = "";
					$subInput.each(function(){
						var curVal = jQuery(this).val();
						var curName = jQuery(this).attr("name");
						if(curVal != ""){
							var cur_Date = new Date(curVal.replace(/-/g,"\/"));
							var max_Date = new Date(_maxDate.replace(/-/g,"\/"));
							_maxDate = (cur_Date > max_Date)?_maxDate:curVal;
							_dateName = (cur_Date > max_Date)?_dateName:curName;
						}
					});
					_maxDate
					maxDate = _maxDate;
					dateName = _dateName;
				}
				if(!maxDate || maxDate == ""){maxDate = "2099-12-31 23:59:59";}
				
				//传入的最大值统一格式
				if(maxDateFmt == "yyyy" && trim(maxDate).length == 4){
					maxDate = trim(maxDate)+"-01-01 00:00:00";
				}
				if(maxDateFmt == "yyyy-MM" && trim(maxDate).length == 7){
					maxDate = trim(maxDate)+"-01 00:00:00";
				}
				if(maxDateFmt == "yyyy-MM-dd" && trim(maxDate).length == 10){
					maxDate = trim(maxDate)+" 00:00:00";
				}
				if(maxDateFmt == "yyyy-MM-dd HH:mm" && trim(maxDate).length == 16){
					maxDate = trim(maxDate)+":00";
				}
				if(maxDateFmt == "HH:mm:ss" && trim(maxDate).length == 8){
					maxDate = "0000-00-00 "+maxDate;
				}
				
				var now_min_Date = new Date(minDate.replace(/-/g,"\/"));
				var now_max_Date = new Date(maxDate.replace(/-/g,"\/"));
				if(now_min_Date > now_max_Date){
					var starDate = jQuery("#"+getPrevNameMinDate).attr("name");
					alert(starDate +" 不能大于 " + dateName);
					return false;
				}
				
				//ios[xxxx-xx-xx]格式不识别 转时间格式为[xxxx,xx,xx] -- 20151126 by tank 
				var maxarr = maxDate.split(/[- :]/); 
				msMaxDate = new Date(maxarr[0], maxarr[1]-1, maxarr[2], maxarr[3], maxarr[4], maxarr[5]);
				var minarr = minDate.split(/[- :]/); 
				msMinDate = new Date(minarr[0], minarr[1]-1, minarr[2], minarr[3], minarr[4], minarr[5]);
				
				
				
				if(dateFmt == "HH:mm:ss" && dateFmt.length == 8){
					$dataField.unbind().mobiscroll().time({
					    timeFormat: timeFormat,
		                theme: 'ios', 
		                mode: 'mixed', 
		                display: 'bottom',
		                lang: 'zh', 
		                minDate: msMinDate?msMinDate:null,
				        maxDate: msMaxDate?msMaxDate:null,
				        stepMinute: 5 , 
		                onBeforeShow: onBeforeShow,
		                onSelect : function(){
		                	$dataField.unbind().bind("click",function(){
		                		Wdate(jQuery(this));
		                	});
		                },
		                onClose : function(){
		                	ajaxPage.clearHashPostfix("dateControls");
		                }
					}).trigger("click");
				}else{
					$dataField.unbind().mobiscroll().datetime({
						dateFormat: dateFormat,
					    timeFormat: timeFormat,
		                theme: 'ios', 
		                buttons: ['set','clear','cancel'],
		                clearText: '清除',
		                mode: 'mixed',  
		                display: 'bottom', 
		                lang: 'zh', 
		                minDate: msMinDate?msMinDate:null,
		                maxDate: msMaxDate?msMaxDate:null, 
		                stepMinute: 5 ,
		                onBeforeShow:  onBeforeShow,
		                onSelect : function(){
		                	$dataField.unbind().bind("click",function(){
		                		Wdate(jQuery(this));
		                	});
		                },
		                onClose : function(){
		                	ajaxPage.clearHashPostfix("dateControls");
		                }
					}).trigger("click");
				}
			
				return $dataField.bind("change",function(){
                	if (isRefresh) {
						subGridView ? dy_view_refresh($(this).attr("id")):dy_refresh($(this).attr("id"));
					}
                });
			};
			
			var readonly = "",
				hideText = "",
				style = "",
				isReadOnlyShowValOnly = false;

			getPrevNameMinDate = getPrevNameMinDate ? getPrevNameMinDate : "";
			if(textType.toLowerCase()=="hidden" || displayType == PermissionType_HIDDEN){
				hideText = ";display:none;";
			}else{	//不是隐藏状态时置空隐藏时显示值
				hiddenValue = '';
			}

			if(displayType == PermissionType_READONLY || textType.toLowerCase()=="readonly" || displayType == PermissionType_DISABLED){
				readonly = "readonly";
				if(readOnlyShowValOnly == "true"){
					style = ";display:none;";
					isReadOnlyShowValOnly = true;
				}
			}
			
			var data = {
					id : id,
					limit : limit,
					name : name,
					discript : discript,
					minName : getPrevNameMinDate,
					value : value,
					hideText : hideText,
					style : style,
					dateFmt : dateFmt,
					isRefresh : isRefresh,
					readonly : readonly,
					cssclass : cssclass,
					fieldType : fieldType,
					otherAttrsHtml : otherAttrsHtml,
					isReadOnlyShowValOnly : isReadOnlyShowValOnly,
					horizontalClass : horizontalClass,
					hiddenValue : hiddenValue
			};

			var $html = $(template("date-tmpl", data));
			if(readonly != "readonly"){
				$html.find("input").bind("click", function(){
					Wdate($(this));
				});
				if(!subGridView){
					$html.find("input").bind("blur",function(){
						if(typeof(dateCompareVal)=="function") dateCompareVal(this);	//普通表单时设置表单是否更改
					});
				}
			}
			
			$html.replaceAll($field);
		});
	};
})(jQuery);; 
(function($) {
	var isNoDeleteFile = true;
	var isReloadFile = false;
	map = {};

	function FMFileInfo(file) {
		var webIndex = file.path.lastIndexOf("/");
		var urlIndex = file.path.lastIndexOf("_/uploads");

		this.webPath = file.path;
		if (urlIndex >= 0) {
			this.webPath = file.path.substring(urlIndex + 1);
		}

		this.realName = file.path.substring(webIndex + 1, file.path.length);
		this.showName = file.name;
		this.url = contextPath + this.webPath;
	}

	function File(name, path) {
		this.name = name;
		this.path = path;
	}

	function refreshUploadListSub(fileFullName, uploadListId, readonly,
			refresh, applicationid, subGridView, disabled) {
		var $uploadList = $("#" + uploadListId);
		$uploadList.html(''); // 清空显示值
		
		switch(fileFullName){
		case "clear":
			//与""相同
		case "":
			jQuery("#" + uploadListId.substring(uploadListId.indexOf("_") + 1)).val("");
			break;
		default :
			var $html = getDivContent(fileFullName, uploadListId,
					readonly, refresh, applicationid, 
					subGridView, disabled)
					
			$uploadList.append($html);
			$html.find(".fileTitle").each(function(){
				var $title = $(this);
				var titleWidthDefault = $title.width();
				$title.css("display","table");
				var titleWidth = $title.width();
				
				if(titleWidth > titleWidthDefault){
					$title.css("display","block");
				}
			})			
		}
	}

	// 文件附件
	function refreshUploadList(fileFullName, uploadListId, readonly, refresh,
			applicationid, subGridView, disabled) {
		refreshUploadListSub(fileFullName, uploadListId, readonly, refresh,
				applicationid, subGridView, disabled);
		if (refresh != 'false') {
			if (subGridView) {
				dy_view_refresh(uploadListId);
			} else {
				window.setTimeout("dy_refresh('"
						+ uploadListId.substring(uploadListId.indexOf("_") + 1)
						+ "')", 500);
			}
		}
	}

	// 显示文件列表
	function showUploadPic(index, id, webPath, applicationid) {
		var $picDiv = jQuery("#" + id + "pic" + index);
		if ($picDiv.size() != 0) {
			var url = encodeURI(encodeURI(contextPath
					+ "/portal/upload/fileInfor.action?applicationid="
					+ applicationid + "&fileFullName=" + webPath));
			jQuery.post(url, function(x) {
				// 提交成功回调
					var oldTitle = $picDiv.attr("title");
					$picDiv.attr("title", oldTitle + x);
				});
		}
	}
	
	//根据文件扩展名返回不同的class
	function fileTypeJudge(fileType){
		var imgCss = "other";
		
		if (fileType == ".pdf") {
			imgCss = "pdf";
		} else if (fileType == ".doc" || fileType == ".docx") {
			imgCss = "word";
		} else if (fileType == ".xls" || fileType == ".xlsx") {
			imgCss = "excel";
		} else if (fileType == ".txt") {
			imgCss = "txt";
		} else if (fileType == ".mp3" || fileType == ".wav"
				|| fileType == ".wma" || fileType == ".ra"
				|| fileType == ".rm" || fileType == ".cd") {
			imgCss = "audio";
		} else if (fileType == ".avi" || fileType == ".3gp"
				|| fileType == ".mkv" || fileType == ".rmvb"
				|| fileType == ".mp4" || fileType == ".mpg"
				|| fileType == ".swf" || fileType == ".dvd") {
			imgCss = "video";
		} else if (fileType == ".ppt" || fileType == ".pptx") {
			imgCss = "ppt";
		} else if (fileType == ".ipa") {
			imgCss = "ios";
		} else if (fileType == ".apk") {
			imgCss = "android";
		} else if (fileType == ".psd") {
			imgCss = "psd";
		} else if (fileType == ".ai") {
			imgCss = "ai";
		} else if (fileType == ".rar" || fileType == ".zip") {
			imgCss = "rar";
		} else if (fileType == ".jpg" || fileType == ".png"
				|| fileType == ".jpeg" || fileType == ".gif") {
			imgCss = "img";
		}
		return imgCss;
	}

	//是否支持预览
	function isPreViewFile(_file){
		var isPreView = false;
		DWREngine.setAsync(false);
		FormHelper.hasSwfFile(_file.webPath, _file.realName, function(result) {
			isPreView = result;
		});
		DWREngine.setAsync(true);
		return isPreView;
	}
	
	// 获得显示列表
	function getDivContent(fileFullName, uploadListId, readonly, refresh,
			applicationid, subGridView, disabled) {
		
		var data = {
				uploadListId : uploadListId,
				readonly : readonly,
				files : []
		};

		var files = JSON.parse(fileFullName);
		for ( var i = 0; i < files.length; i++) {	//循环文件列表
			var _file = new FMFileInfo(files[i]);
			var isImg = false;
			var imgCss = "";

			var isPreView = false;	// 判断文档是否可预览(OFFIC文档)
			isPreView = isPreViewFile(_file);
			isPreView = (isPreView || imgCss == "img");	//图片可预览

			// 获取文件类型 根据类型给文件赋予前置图标
			var _id = _file.showName.substring(0,
					_file.showName.lastIndexOf(".")).toLowerCase();
			var fileType = _file.showName.substring(
					_file.showName.lastIndexOf(".")).toLowerCase();
			
			imgCss = fileTypeJudge(fileType);	//根据文件扩展名返回不同的class
			
			var title = _file.showName;
			var fileType = title.substring(title.lastIndexOf("."))
					.toLowerCase();
			var fileName = title.substring(0, title.lastIndexOf("."));
			/*if (fileName != null && fileName.length > 8) {
				title = fileName.substring(0, 7) + ".."
						+ fileName.charAt(fileName.length - 1) + fileType;
			}*/
			title = fileName;
			var file = _file;

			file = {
					_id : _id,
					title : title,
					url : _file.url,
					imgCss : imgCss,
					fileType : fileType,
					isPreView : fileTypeJudge(fileType) == "img" ? "true" : isPreView + "",
					webPath : _file.webPath,
					showName : _file.showName,
					realName : _file.realName,
					fileType : fileType
			};
			data.files.push(file);
		}

		var $html = $(template("fileUploadCon-tmpl", data));
		

		$html.find(".fileRow").each(function(index) {
			$(this).bind("click",function() {
				var $me = $(this);
				var isPreView = $me.attr("isPreView");
				var file = {
						 webPath : $me.attr("data-webPath"),
						 showName : $me.attr("data-showName"),
						 realName : $me.attr("data-realName")
				};
				
				if(isPreView == "false" ){
					isPreView = isPreViewFile(file) ? "true" : "false";
					$me.attr("isPreView",isPreView);
				}
				
				if(isPreView == "true"){
					previewFile(file);
				}else{
					downloadFile(file);
				}
			}).find(".del").bind("click", function(){	//删除文件
				deleteOneFile(index,uploadListId,refresh,
						applicationid,subGridView,disabled);
				return false;
			});
		});
		
		return $html;
	}

	/**
	 * 文件预览
	 */
	function previewFile(file) {
		var url = encodeURI(encodeURI(contextPath
				+ "/portal/phone/resource/component/upload/preview.jsp?name="
				+ file.realName + "&path=" + file.webPath + "&showName="+file.showName));
		var fileType = file.realName.substr(file.realName.indexOf(".")).toLowerCase();
		if(
			fileType == ".doc" ||
			fileType == ".docx" ||
			fileType == ".xls" ||
			fileType == ".xlsx" ||
			fileType == ".pdf" ||
			fileType == ".txt" ||
			fileType == ".rtf" ||
			fileType == ".et" ||
			fileType == ".ppt" ||
			fileType == ".pptx" ||
			fileType == ".dps" ||
			fileType == ".pot" ||
			fileType == ".pps" ||
			fileType == ".wps" ||
			fileType == ".html" ||
			fileType == ".htm" 
		){
			if(fileType == ".pdf"){
				window.location.href = contextPath + file.webPath;
			}else{
				window.location.href = contextPath + file.webPath.substr(0,file.webPath.lastIndexOf("/")+1) + 'swf/' + file.realName.substr(0,file.realName.indexOf(".")) + '.pdf'
			}
			
		}else{
			OBPM.dialog.show({
				url : url,
				title : "文件预览",
				close : function(result) {
					
				}
			});
		}
		
		
		
	}

	/**
	 * 文件下载
	 */
	function downloadFile(file) {
		var url = encodeURI(contextPath + "/portal/dynaform/document/fileDownload.action?filename="+ file.realName + "&filepath=" + file.webPath);
		window.open(url,"_blank");
	}
	
	/**
	 * 获取文字长度
	 */
	function GetCurrentStrWidth(text) {
		var currentObj = $('<pre>').hide().appendTo(document.body);
		$(currentObj).html(text);
		var width = currentObj.width();
		currentObj.remove();
		return width;
	}

	// 删除一个文件
	function deleteOneFile(index, id, refresh, applicationid, 
			subGridView, disabled) {
		
		jQuery.confirm({
			trueCall : function(){

				var files = [];
				var filefullname = "";
				var oldstr = jQuery("#" + id.substring(id.indexOf("_") + 1)).val();// 用于恢复数据

				var oField = jQuery("#" + id.substring(id.indexOf("_") + 1));
				if(oField.val() == ""){
					console.error("字段值为空，无法继续删除！")
					return false;
				}
				files = JSON.parse(oField.val());
				var webpath = files[index].path;
				files.splice(index, 1);
				if (files.length > 0) {
					filefullname = JSON.stringify(files);
				}

				oField.val(filefullname);

				jQuery.ajax( {
							type : 'POST',
							async : false,
							url : encodeURI(encodeURI(contextPath
									+ "/portal/upload/deleteOne.action?fileFullName="
									+ webpath)),
							dataType : 'text',
							data : ajaxPage.getParams(),
							success : function(x) {
								refreshUploadList(filefullname, id, false, refresh,
										applicationid, subGridView,
										disabled);
								filefullname = "";
							},
							error : function(x) {
								jQuery("#" + id.substring(id.indexOf("_") + 1))
										.val(oldstr);
							}
						});
			},
			falseCall : function(){
				
			}
		});
	}


	/**
	 * 其他类别显示
	 */
	function showTextDialog(webPath,name) {
		OBPM.dialog.show( {
			opener : window.parent.parent,
			width : 1000,
			height : 580,
			url : webPath,
			args : {},
			title : name,
			close : function(result) {

			}
		});
	}
	
	function previewInNewTab(webPath){
		var _tmpwin = window.open(webPath, "_blank");
		_tmpwin.location.href = webPath;
	}

	// 弹出层来加载文件为了处理乱码问题
	function showFileDialog(obj, name, webPath, readonly) {
		var url = "";
		var fileType = name.substring(name.lastIndexOf(".")).toLowerCase();
		if (fileType == ".doc" || fileType == ".docx" || fileType == ".xls"
				|| fileType == ".xlsx") {
			url = contextPath + '/portal/dynaform/document/doViewWordFile.action';
			OBPM.dialog.show( {
				opener : window.parent.parent,
				width : 1000,
				height : 550,
				url : url,
				args : {
					"webPath" : contextPath + webPath,
					"readonly" : readonly
				},
				title : name,
				close : function(result) {

				}
			});
		} else {
			url = contextPath + webPath;
			obj.target = "_blank";
			obj.href = url;
			obj.triggerHandler("click");
		}
	}

	/**
	 * 图片预览窗口
	 * 
	 * url 图片路径
	 */
	function showImageEffect(url) {
		// 构造外围窗体 将窗体改为隐藏
		$("body").append('<div id="showImageDialog"></div>');
		var $div = $("#showImageDialog");
		$div.css( {
			"display" : "none",
			"position" : "fixed",
			"z-index" : "999",
			"top" : "0px",
			"right" : "0px",
			"bottom" : "0px",
			"left" : "0px"
		});
		$div
				.append('<div style="filter:alpha(opacity=70);-moz-opacity:0.7;-khtml-opacity: 0.7;position: fixed; z-index: 101; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; background-color: rgb(0, 0, 0);"></div>');

		// 添加关闭按钮
		$div
				.append('<div id="imageClose" style="color: rgb(255, 255, 255); padding: 4px 10px ;  background-color: rgb(0, 0, 0);cursor: pointer;right: 0px;position: absolute;z-index:104;font-size:20px;">x</div>');
		// 添加图片外围div
		var imgdiv = '<div style="position: absolute; width: 300%; height: 100%; left: -100%;">';
		// 添加图片
		imgdiv += '<img style="position: absolute; z-index: 102; margin: auto; width: auto; top: 0px; right: 0px; bottom: 0px; left: 0px; display: block; cursor: pointer; max-width: 32%; max-height: 95%;" src="' + url + '"/>';
		imgdiv += "</div>";
		$div.append(imgdiv);

		// 鼠标滑进关闭按钮样式
		$("#imageClose").mouseover(function(e) {
			$("#imageClose").css("background-color", "rgb(55, 55, 55)");
		});
		$("#imageClose").mouseout(function(e) {
			$("#imageClose").css("background-color", "rgb(0, 0, 0)");
		});

		// 点击后淡出然后remove
		$("#imageClose").click(function(e) {
			$("#showImageDialog").fadeOut(50, function() {
				$div.remove();
			});
		});

		// 淡入显示
		$("#showImageDialog").fadeIn(50);
	}

	/**
	 * 前台删除文件
	 * 
	 * @param {}
	 *            valueField 文件路径保存字段
	 * @param {}
	 *            uploadListId
	 */
	function deleteFrontFile(valueField, uploadListId, applicationid) {
		// 删除URL
		if (confirm("你确定删除全部文件吗？此操作不可恢复！")) {
			var fileFullName = "";
			if (valueField.val() != '') {
				var files = JSON.parse(valueField.val());
				for ( var i = 0; i < files.length; i++) {
					fileFullName += files[i].path + ";";
				}
				if (fileFullName.length > 1) {
					fileFullName = fileFullName.substring(0,
							fileFullName.length - 1);
				}
			}
			this.url = contextPath
					+ "/portal/upload/delete.action?fileFullName="
					+ fileFullName;
			fileFullName = "";
			deleteFileCommon(valueField, uploadListId, url);
		}
	}

	/**
	 * 后台删除文件
	 * 
	 * @param {}
	 *            valueField 文件路径保存字段
	 * @param {}
	 *            uploadListId
	 */
	function deleteFile(valueField, uploadListId, applicationid) {
		// 删除URL
		this.url = contextPath + "/core/upload/delete.action?applicationid="
				+ applicationid + "&fileFullName=" + valueField.val();
		deleteFileCommon(valueField, uploadListId, url);
	}

	/**
	 * 前后台共有的删除文件方法
	 * 
	 * @param {}
	 *            valueField 文件路径保存字段
	 * @param {}
	 *            uploadListId
	 * @param {}
	 *            url 删除文件请求的路径
	 */
	function deleteFileCommon(valueField, uploadListId, URL) {
		// 保存原来的值用于删除发生异常时可以恢复数据
		var uploadListIdHTML = jQuery("#" + uploadListId).html();
		var uploadListIdValue = jQuery(
				"#" + uploadListId.substring(uploadListId.indexOf("_") + 1))
				.val();

		jQuery("#" + uploadListId).html(''); // 清空显示值
		jQuery("#" + uploadListId.substring(uploadListId.indexOf("_") + 1))
				.val("");

		jQuery.ajax( {
			type : 'POST',
			async : false,
			url : encodeURI(url),
			dataType : 'text',
			data : ajaxPage.getParams(),
			success : function(x) {
			},
			error : function(x) {
				// 恢复数据
			jQuery("#" + uploadListId).html(uploadListIdHTML);
			jQuery("#" + uploadListId.substring(uploadListId.indexOf("_") + 1))
					.val(uploadListIdValue);
		}
		});
		// jQuery("#" + uploadListId).html(''); // 清空显示值
		// valueField.val(''); // 清空值
		// map[uploadListId] = "";

	}

	/**
	 * 后台文件上传
	 * 
	 * @param {}
	 *            pathname 文件目录
	 * @param {}
	 *            pathFieldId 文件路径域ID
	 * @param {}
	 *            viewid 视图ID
	 * @param {}
	 *            allowedTypes 允许上传的类型
	 * @param {}
	 *            maximumSize 最大值
	 * @param {}
	 *            fileSaveMode 文件保存模式
	 * @return {} 文件网络路径
	 */
	function uploadFile(pathname, pathFieldId, viewid, allowedTypes,
			maximumSize, layer, fileSaveMode, applicationid) {
		var url = contextPath + '/core/upload/upload.jsp?path=' + pathname
				+ "&applicationid=" + applicationid;

		var oField = jQuery("#" + pathFieldId);
		OBPM.dialog.show( {
			opener : window.parent.parent,
			width : 800,
			height : 450,
			url : url,
			args : {},
			title : '文件上传',
			close : function(result) {
				if (result == null || result == undefined
						|| result == "undefined") {

				} else {
					if (oField != null) {
						oField.val(result);
					}
					return resutl;
				}
			}
		});
	}

	/**
	 * 前台文件上传
	 * 
	 * @param {}
	 *            pathname 文件目录
	 * @param {}
	 *            pathFieldId 文件路径域ID
	 * @param {}
	 *            viewid 视图ID
	 * @param {}
	 *            allowedTypes 允许上传的类型
	 * @param {}
	 *            maximumSize 最大值
	 * 
	 * @param {}
	 *            fileSaveMode 文件保存模式
	 * @param {}
	 *            callback 回调函数
	 * @return {} 文件网络路径
	 */
	function uploadFrontFile(title, pathname, pathFieldId, viewid,
			allowedTypes, maximumSize, fileSaveMode, callback, applicationid,
			limitNumber, fileType, customizeType) {
		hiddenDocumentFieldIncludeIframe();// in util.js
		var files = [];
		var oField = jQuery("#" + pathFieldId);
		var ifiles = oField.val();
		if(ifiles!=""){
			files = JSON.parse(ifiles);
		}
		var url = contextPath
				+ '/portal/phone/resource/component/upload/obpm.fileUpload.jsp?path=' + pathname;
		url = addParameters(pathname, pathFieldId, viewid, allowedTypes,
				maximumSize, fileSaveMode, url);
		url += '&applicationid=' + applicationid;
		url += '&limitNumber=' + (limitNumber-files.length);
		url += '&fileType=' + fileType;
		url += '&customizeType=' + customizeType;
		if(limitNumber-files.length>0){
			OBPM.dialog.show( {
				url : url,
				args : {
					"webPath" : "aaaaaaaa",
					"readonly" : "222222"
				},
				title : title,
				close : function(result) {
	//				showDocumentFieldIncludeIframe();//显示被隐藏的iframe，phone中不需要 //in util.js
					var oField = jQuery("#" + pathFieldId);
					var rtn = getReturnValue(oField, result);
					// 把上传的文件json格式 [{'name':'aaa.doc','path':'XXX'}] 放进文件上传控件的value
					var files = [];
					if (isReloadFile) {
						var fileStrs = result.split(";");
						if (oField && oField.attr("value") && allowedTypes != 'image') {
							files = JSON.parse(oField.attr("value"));
						}
						for ( var i = 0; i < fileStrs.length; i++) {
							var fileStr = fileStrs[i].split(",");
							var file = new File(fileStr[0], fileStr[1]);
							files.push(file);
						}
					}
					if (files.length > 0) {
						rtn = JSON.stringify(files);
					}
					oField.attr("value", rtn);
					$("input[name=" + oField.attr("name") + "]").val(rtn);
					if (callback && typeof (callback) == "function") {
						callback();
					}
				}
			});
		} else {
			alert("文件上传超出数量限制。");
		}
	}
	/**
	 * 简单上传
	 * 
	 * @param {}
	 *            pathname 文件存放路径名称
	 * @param {}
	 *            pathFieldId 文件路径域ID
	 * @param {}
	 *            callback 回调函数
	 */
	function uploadFrontSimple(pathname, pathFieldId, applicationid) {
		var url = contextPath
				+ '/portal/phone/resource/component/upload/obpm.fileUpload.jsp?path=' + pathname
				+ '&applicationid=' + applicationid;
		var oField = jQuery("#" + pathFieldId);
		OBPM.dialog.show( {
			opener : window.parent.parent,
			width : 800,
			height : 450,
			url : url,
			args : {},
			title : 'upload',
			close : function(result) {
				if (result == null || result == undefined
						|| result == "undefined" || result == "clear") {
					oField.val('');
				} else {
					oField.val(result);
				}

			}
		});
		/*
		 * showfrontframe({ title : "upload", url : url, w : 650, h : 500,
		 * callback : callback });
		 */
	}

	/**
	 * 为URL添加参数
	 * 
	 * @param {}
	 *            pathname
	 * @param {}
	 *            pathFieldId
	 * @param {}
	 *            viewid
	 * @param {}
	 *            allowedTypes
	 * @param {}
	 *            maximumSize
	 * @param {}
	 *            fileSaveMode
	 * @param {}
	 *            url
	 * @return {}
	 */
	function addParameters(pathname, pathFieldId, viewid, allowedTypes,
			maximumSize, fileSaveMode, url) {
		var oField = jQuery("#" + pathFieldId);
		var oView = jQuery("#" + viewid);

		if (allowedTypes) {
			url += '&allowedTypes=' + allowedTypes;
		}

		if (maximumSize) {
			url += '&maximumSize=' + maximumSize;
		}

		if (fileSaveMode) {
			// 自定义
			url += '&fileSaveMode=' + fileSaveMode;
		} else {
			// 系统
			url += '&fileSaveMode=00';
		}

		return url;
	}

	/**
	 * 获取返回值
	 * 
	 * @param {}
	 *            oField
	 * @return {}
	 */
	function getReturnValue(oField, rtn) {
		if (rtn == null || rtn == 'undefined') {
			isReloadFile = false;
			if (oField && oField.val()) {
				rtn = oField.val();
			} else {
				rtn = '';
			}
		} else {
			isReloadFile = true;
		}
		return rtn;
	}

	$.fn.obpmUploadField = function() {
		return this.each(function() {
			var $field = jQuery(this);
			var tagName = $field.attr("tagName");
			if(tagName=="ImageUploadField"){
				$field.obpmWeixinImageUpload();
				return;
			}
			var id = $field.attr("id");
			var disabled = $field.attr("disabled");
			var readonly = (disabled == 'disabled');
			var callbakFunction = $field.attr("callbakFunction");
			var path = $field.attr("path");
			var fileSaveMode = $field.attr("fileSaveMode");
			var application = $field.attr("application");
			var value = $field.attr("value");
			var name = $field.attr("name");
			var maxsize = $field.attr("maxsize");
			var uploadList = $field.attr("uploadList");
			var text = $field.html();
			var refreshOnChanged = $field.attr("refreshOnChanged");

			var uploadLabel = $field.attr("uploadLabel");
			var filelabel = $field.attr("filelabel");
			var deleteLabel = $field.attr("deleteLabel");
			var limitsize = $field.attr("limitsize");
			var limitNumber = $field.attr("limitNumber");
			
			var fileType = $field.attr("fileType");
			var customizeType = $field.attr("customizeType");
			var limitType = $field.attr("limitType");
			var readOnlyShowValOnly = $field.attr("readOnlyShowValOnly");

			var imgHeight = $field.attr("imgHeight");
			var imgWidth = $field.attr("imgWidth");
			var layoutType = $field.attr("_layoutType");
			
			var subGridView = $field.attr("subGridView");
			var discript = $field.attr("discript");

			value = value ? value : "";
			subGridView = (subGridView == 'true');
			discript = discript ? HTMLDencode(discript) : name;
			
			text = text ? text : "";
			var horizontalClass = "";
			if(layoutType == LayoutType_Horizontal){
				horizontalClass = "flexbox";
			}
			var data = {
					id : id,
					name : name,
					tagName : tagName,
					value : value,
					discript : discript,
					uploadList : uploadList,
					uploadLabel : uploadLabel,
					readonly : readonly,
					readOnlyShowValOnly : (readOnlyShowValOnly == "true"),
					horizontalClass : horizontalClass
			};

			var _callback = function() {

				refreshUploadList(jQuery("#" + id).attr("value"), uploadList,
					readonly, refreshOnChanged, application,subGridView, disabled);
			};
			
			var $html = $(template("fileUpload-tmpl", data));
			if(!readonly){

				$html.find(".btnAdd").bind("click", function() {
					uploadFrontFile(filelabel + uploadLabel, path, id,
						'_viewid', limitType, maxsize,fileSaveMode, _callback, 
						application,limitNumber, fileType, customizeType);
				});
			}
			
			$field.before($html);
			// 描述
			if($field.attr("moduleType") != "uploadFileRefresh"){
				$field.attr("moduleType","uploadFileRefresh").css("display","none");
			}
			
			refreshUploadListSub(jQuery("#" + id).attr("value"), uploadList, 
				readonly, refreshOnChanged,
				application, subGridView, disabled);
		});
	};
	$.fn.obpmViewImageUpload = function() {
		return this
				.each(function() {
					var $field = jQuery(this);
					var imgw = $field.attr("imgw");
					var imgh = $field.attr("imgh");
					var viewReadOnly = $field.attr("viewReadOnly");
					var docId = $field.attr("docId");
					var docFormid = $field.attr("docFormid");
					var url = $field.attr("url");
					var fileName = $field.attr("fileName");

					viewReadOnly = (viewReadOnly == "true") ? true : false;
					var imgwHalf = imgh / 2;
					var isSubGridView = jQuery("#obpm_subGridView").size() > 0 ? true
							: false;

					var html = "<div  class='bigImg' style='position:relative;width:"
							+ imgw + "; height:" + imgh + "'>";
					if (viewReadOnly) {
						html += "<img alt='" + fileName + "' border='0' src='"
								+ url + "' width='" + imgw + "' height='"
								+ imgh + "' />";
					} else {
						html += "<a ";
						if (!isSubGridView) {
							html += " href=\"javaScript:viewDoc('" + docId
									+ "','" + docFormid + "')\"";
						}
						html += " title='" + fileName + "'>";
						html += "<img alt='" + fileName + "' border='0' src='"
								+ url + "' width='" + imgw + "' height='"
								+ imgh + "' />";
						html += "</a>";
					}
					html += "<div  class='smallIcon' style='display:none;position:absolute;right:0px;top:"
							+ imgwHalf
							+ "px;z-index:100;'><a class='imgClick' href='"
							+ url + "' target='blank'>";
					html += "<img alt='"
							+ fileName
							+ "' border='0' src='../resource/images/picture_go.png' title='点击查看原图' /></a><div>";
					html += "</div>";
					var $html = $(html);
					$html.mouseover(function(event) {
						event.stopPropagation();
						jQuery(this).find(".smallIcon").show();
					}).mouseout(function(event) {
						event.stopPropagation();
						jQuery(this).find(".smallIcon").hide();
					});
					$field.replaceWith($html);
				});
	};

})(jQuery);; 
(function($) {
	var ALBUM = false;//指定来源不能为相册

    function takePhoto(el){
        var $this = $(el);
        if($this.find(".pan").length>0) return;
        var id = $this.data("id");
        var oField = jQuery("#"+ id);
        var img = jQuery("#"+ id+"_img");

        //判断接口
        var ua = window.navigator.userAgent;
		//indexOf() 方法可返回某个指定的字符串值在字符串中首次出现的位置
        if(ua.indexOf("myApps") >= 0){
            var _nativeAPI = top.nativeAPI ? top.nativeAPI : nativeAPI;
            _nativeAPI.upload({
                fileSaveMode: '00',//存盘模式，默认值‘00’
                path: 'ITEM_PATH',//存盘路径，默认值‘ITEM_PATH’
                fieldId: id,//表单控件 id
                applicationId: appId,//软件应用 id
                count: 1, // 文件数量，默认 9，当文件数量 1 时，仅允许选择一个文件
                sourceType: ['camera'],//['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有
                success: function (res) {
                    var datas = JSON.parse(res);
                    for (var i=0;i<datas.length;i++) {
                        var path = datas[i].path; // 路径 url
                        var name = datas[i].name; // 文件名称
                        var size = datas[i].size; // 文件大小
                        var type = datas[i].type; // 文件类型（拓展名）

                        oField.val(path);
                        //attr() 方法设置或返回被选元素的属性值。
						img.attr("src",contextPath+path).show();

                    }

                }
            });

        }else{
            var _wx = top.wx ? top.wx : wx;
            _wx.chooseImage({
                count: 1, // 默认9
                sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
                sourceType: ALBUM? ['album','camera']:['camera'], // 可以指定来源是相册还是相机，默认二者都有
                success: function (res) {
                    var localIds = res.localIds;
                    setTimeout(function(){
                        _wx.uploadImage({
                            localId: localIds[0],
                            success: function (res) {
                                var serverId = res.serverId;
                                $.get(contextPath+"/portal/weixin/jsapi/upload.action",{"serverId":serverId},function(result){
                                    if(result.status==1){
                                        //todo 构建json
                                        oField.val(result.data);
                                        img.attr("src",localIds[0]).show();
                                    }
                                });
                            },
                            fail: function (res) {
                                alert("网络异常，请再次尝试！");
                            }
                        });
                    }, 100)
                }
            });
        }

    }

	function previewImage(el){
		var $this = $(el);
		var current = $this.attr("src");
		if(current && current.length>0){
			var _wx = top.wx ? top.wx : wx;
			_wx.previewImage({
			    current: current, // 当前显示图片的http链接
			    urls: [] // 需要预览的图片http链接列表
			});
		}
	}
	$.fn.obpmTakePhoto = function() {
		return this.each(function() {
			
			var $field = jQuery(this);
			var contextPath = $field.attr("contextPath");
			var value = $field.attr("value");
			var id = $field.attr("id");
			var imgw = $field.attr("imgw");
			var imgh = $field.attr("imgh");
			var name = $field.attr("name");
			var tagName = $field.attr("tagName");
			var discript = HTMLDencode($field.attr("discript"));
			var disabled = $field.attr("disabled");
			var displayType = $field.attr("displayType");
			var layoutType = $field.attr("_layoutType");
			var hiddenValue = $field.attr("_hiddenValue");
			
			ALBUM = $field.attr("album")=="true"; 
			
			var hideStyle = "",
				style = "",
				btnHideStyle = "",
				readonly = false,
				disabledClazz = "",
				PhotoIcon = "&#xe60f;",
				horizontalClass = "";
				
			
			discript = discript? discript : name;
			
			if(layoutType == LayoutType_Horizontal){
				horizontalClass = "flexbox";
			}
			if(displayType == PermissionType_HIDDEN){
				hideStyle = ";display:none;";
			}else{
				hiddenValue = "";
			}
			if(displayType == PermissionType_DISABLED || displayType == PermissionType_READONLY){
				readonly = true, disabledClazz = "ban", PhotoIcon = "&#xe610;";
				btnHideStyle = ";display:none;";
			}
			
			if(value.indexOf("photo.png")>=0){
				style = ";display:none;";
			}
			
			var data = {
				id : id,
				name : name,
				value : value,
				style : style,
				btnHideStyle : btnHideStyle,
				tagName : tagName,
				discript : discript,
				photoIcon : PhotoIcon,
				hideStyle : hideStyle,
				contextPath : contextPath,
				disabledClazz : disabledClazz,
				horizontalClass : horizontalClass,
				hiddenValue : hiddenValue
			};
			var $html = $(template("takePhoto-tmpl", data));
			if(!readonly){
				$html.find(".btn-photo").bind("click",function(){
					if(displayType != PermissionType_DISABLED && displayType != 1){
						takePhoto(this);
					}
				});
			}
			$html.replaceAll($field);
			$html.find("div.btn-box-pic").each(function () {  				
  				new RTP.PinchZoom($(this));
  			});
		});
	};
})(jQuery);; 

(function($){
	//表单Baidumap处理
	function FormBaiduMap(FieldID,applicationid,displayType){
		var oField = jQuery("#"+ FieldID);
		var url=contextPath+"/portal/share/component/map/form/baiduMap.jsp?type=dialog&applicationid="+applicationid+"&displayType="+displayType;
		hiddenDocumentFieldIncludeIframe();//in util.js
		OBPM.dialog.show({
			title : title_map,
			url : url,
			args: {"fieldID":FieldID,"mapData":oField.val()},
			width : 1000,
			height : 600,
			close : function(result) {
				showDocumentFieldIncludeIframe();////in util.js
				var rtn = result;
				if (result == null || result == 'undefined') {
					
				} else {
					oField.val(rtn);
				}
			}
	});
	}
	$.fn.obpmMapField= function(){
		return this.each(function(){
			var $field=jQuery(this);
			var id=$field.attr("id");
			var name=$field.attr("name");
			var fieldType=$field.attr("fieldType");
			var value=$field.attr("value");
			var mapLabel=$field.attr("mapLabel");
			var application=$field.attr("application");
			var displayType=$field.attr("displayType");
			var discript = HTMLDencode($field.attr("discript"));
			var srcEnvironment=$field.attr("srcEnvironment");
			var openType=$field.attr("openType");
			
			discript = discript? discript : name;
			var readonly = "";

			if(displayType == PermissionType_READONLY || displayType == PermissionType_DISABLED){
				readonly = "readonly";
			}
			var paramname = encodeURI(encodeURI(id)); 
			var iframeH = window.innerHeight/2;
			var data = {
					iframeH : iframeH,
					id : id,
					name : name,
					value : value,
					isReadonly : false,
					openType : openType,
					mapLabel : mapLabel,
					discript : discript,
					readonly : readonly,
					fieldType : fieldType,
					paramname : paramname,
					displayType : displayType,
					application : application,
					srcEnvironment : srcEnvironment
			};
			
			var $html = $(template("map-tmpl", data));
			$html.find("input").click(function(){
				FormBaiduMap(id,application,displayType);
			});
			$field.replaceWith($html);
		});
	};
	
})(jQuery);; 
(function($){
	$.fn.obpmDepartmentField = function(){
		return this.each(function(){
			var $field =jQuery(this);
			var id=$field.attr("_id");
			var name=$field.attr("_name");
			var fieldType=$field.attr("_fieldType");
			var classname=$field.attr("classname");
			var cssclass=$field.attr("class");
			var isRefresh=$field.attr("_isRefreshOnChanged");
			var displayType=$field.attr("_displayType");
			var readOnlyShowValOnly = $field.attr("readOnlyShowValOnly");
			var textType=$field.attr("_textType");
			var subGridView = $field.attr("_subGridView");
			var hiddenValue = $field.attr("_hiddenValue");
			var layoutType = $field.attr("_layoutType");
			var discript = $field.attr("_discript");
			
			discript = discript ? discript : name;
			isRefresh = (isRefresh == "true");
			subGridView = (subGridView == "true");

			var style = "",
				hideText = "",
				readonly = "",
				horizontalClass = "",
				isReadOnlyShowValOnly = false;
			
			if(layoutType == LayoutType_Horizontal){
				horizontalClass = "flexbox";
			}
			if(displayType == PermissionType_HIDDEN || textType.toLowerCase() == "hidden"){
				hideText = ";display:none;";
			}else{	//不是隐藏状态时置空隐藏时显示值
				hiddenValue = '';
			}
			var otherAttrsHtml = getOtherAttrs($field[0]);//其他属性			

			if(textType.toLowerCase() == "readonly" || displayType == PermissionType_READONLY || displayType == PermissionType_DISABLED){
				readonly = "readonly";
				isReadOnlyShowValOnly = true;
				style += ";display:none;";
			}

			var data = {
					id : id,
					name : name,
					style : style,
					hideText : hideText,
					discript : discript,
					readonly : readonly,
					fieldType : fieldType,
					isRefresh : isRefresh,
					selectedText : "",
					isReadOnlyShowValOnly : isReadOnlyShowValOnly,
					list : [],
					horizontalClass : horizontalClass,
					hiddenValue : hiddenValue
			}
			
			//option
			$field.find("option").each(function(){
				$opt = $(this);
				var selected = $opt.attr("selected");
				var val = $opt.attr("value");
				var cssClass= $opt.attr("class");
				var text = $opt.html();
				val = val ? val : "";
				if(selected){
					data.selectedText = text;
					selected = "selected";
				}
				var _list = {
						val : val,
						text : text,
						cssClass : cssClass,
						selected : selected
				};
				data.list.push(_list);
			});
			
			var $html = $(template("depart-tmpl", data));

			if (isRefresh){
				$html.find("select").bind("change", function(){
					if(subGridView){
						dy_view_refresh(this.id);
					}else{
						dy_refresh(this.id);
					}
				});
			}
			$html.replaceAll($field);
		});
	};
})(jQuery);; 
(function($){
	$.fn.obpmViewDialog =function(){
		return this.each(function(){
			var $field =jQuery(this);
			var name=$field.attr("name");
			var allow = $field.attr("allow");
			var mutil = $field.attr("mutil");
			var selectOne=$field.attr("selectOne");
			var parentid=$field.attr("parentid");
			var clsName = $field.attr("clsName");
			var formid = $field.attr("formid");
			var fieldid=$field.attr("fieldid");
			var isEdit=$field.attr("isEdit");
			var viewTitle=$field.attr("viewTitle");
			var dialogView=$field.attr("dialogView");
			var mapping=$field.attr("mapping");
			var openType=$field.attr("openType");
			var viewType=$field.attr("viewType");
			var divWidth=$field.attr("divWidth");
			var divHeight=$field.attr("divHeight");
			var isMaximization=$field.attr("isMaximization");
			var isRefreshOnChanged=$field.attr("isRefreshOnChanged");
			var caption=$field.attr("caption");
			var isDisable=$field.attr("isDisable");
			
			isDisable = (isDisable == "true");
			isRefreshOnChanged = (isRefreshOnChanged == "true");
			isMaximization = (isMaximization == "true");
			selectOne = (selectOne == "true");
			mutil = (mutil == "true");
			isEdit = (isEdit == "true");
			
			var value = "更多",
				readonly = "";
			
			if (isDisable || !isEdit) {
				readonly = "disabled";
			}
			if(caption && caption.replace(/(^\s*)|(\s*$)/g, "").length > 0){
				value = caption;
			}
			
			var data = {
					name : name,
					value : value,
					readonly : readonly
			};
			var $html = $(template('viewDialog-tmpl', data));
			$html.bind("click",function(){
				ViewHelper.convertValuesMapToPage(dy_getValuesMap(),function(text){
					var params= {
							allow:allow,
							mutil:mutil,
							selectOne:selectOne,
							parentid:parentid,
							className:clsName,
							formid:formid,
							fieldid:fieldid,
							isEdit:isEdit
					};
					var url = contextPath + '/portal/phone/dynaform/view/dialogTemp.jsp';
					url += '?_viewid=' + dialogView;
					url += '&datetime=' + new Date().getTime();
					url += '&' + jQuery.param(params,true);
					if(divWidth == null || divWidth == "" && isMaximization == false){
						url += '&_defaultSize=true';//后台显示大小为默认时，允许页面根据内容设置弹出层大小
					}
					var width = 640;
					var height = 400;
					if(divWidth != "" && divWidth.length > 0){
						width = divWidth;
					}
					if(divHeight != "" && divHeight.length > 0){
						height = divHeight;
					}
					showLoadingToast();
					OBPM.dialog.show({
								width : width, // 默认宽度
								height : height, // 默认高度
								url : url,
								args : {'html': new String(text), 'parent': window},
								maximization: isMaximization,
								maximized: true, // 是否支持最大化
								title : viewTitle,
								close : function(result) {
									//执行确定回调脚本
									if(!result) return;
									DWREngine.setAsync(false);
									var arr = ajaxPage.getParamsArray();
									var _params=new Object;
						            $.each(arr,function(k,v){
						            	_params[v.name]=v.value;  
						            });
						            _params = $.extend(_params,result.params? result.params:{});
						            _params["selectedValue"] = result.selectedValue ? result.selectedValue:"";
									ViewHelper.runViewDialogCallbackscript(_params,function(value){});
									DWREngine.setAsync(true);
									//映射字段
									var rtn = result.selectedValue;
										if(params.selectOne=="false"|| params.selectOne==false){
											getDialogValue(mapping, rtn);
										}else{
											getDialogSelectValue(mapping, rtn);
										}
									if(isRefreshOnChanged) {
										//刷新表单
										dy_refresh(name)
										};
								}
							});
				});
			}).replaceAll($field);
		});
	};
	
})(jQuery);; 
(function($){
	$.fn.obpmTreeDepartmentField =function(){
		return this.each(function(){
			var $field =jQuery(this);
			var textType=$field.attr("_textType");
			var fieldId = $field.attr("_fieldId");
			var fieldType = $field.attr("_fieldType");
			var cssClass=$field.attr("_cssClass");
			var fieldText=$field.attr("_fieldText");
			var limit = $field.attr("_limit");
			var isRefresh = $field.attr("_isRefreshOnChanged");
			var name=$field.attr("_name");
			var fieldValue=$field.attr("_fieldValue");
			var title=$field.attr("_title");
			var textFieldId = fieldId + "_text";
			var valueFieldId = fieldId;
			var displayType = $field.attr("_displayType");
			var readOnlyShowValOnly = $field.attr("readOnlyShowValOnly");
			var treeTip = $field.attr("_treeTip");
			var subGridView = $field.attr("_subGridView");
			var discript = HTMLDencode($field.attr("_discript"));
			var hiddenValue = $field.attr("_hiddenValue");
			var layoutType = $field.attr("_layoutType");
			var discript = $field.attr("_discript");

			discript = discript ? discript : name;
			isRefresh = (isRefresh == "true");
			subGridView = (subGridView == "true");

			var style = "",
				isHide = false,
				hideText = "",
				readonly = "",
				readonly1 = false,
				isReadOnlyShowValOnly = false,
				horizontalClass = "",
				otherAttrsHtml = getOtherAttrs($field[0]);//其他属性
			
			if(layoutType == LayoutType_Horizontal){
				horizontalClass = "flexbox";
			}
			//文本框
			if(textType.toLowerCase() == "hidden" || displayType == PermissionType_HIDDEN){
				isHide = true,
				hideText = ";display:none;";
			}else{
				hiddenValue = "";
			}
			if(displayType == PermissionType_READONLY || displayType == PermissionType_DISABLED || textType.toLowerCase() == "readonly"){
				readonly = "readonly";
				readonly1 = true;
				if(readOnlyShowValOnly == "true"){
					style += ";display:none;";
					isReadOnlyShowValOnly = true;
				}
			}

			var data = {
				isHide : isHide,
				hideText : hideText,
				name : name,
				style : style,
				treeTip : treeTip,
				readonly : readonly,
				discript : discript,
				isRefresh : isRefresh,
				textFieldId : textFieldId,
				valueFieldId : valueFieldId,
				cssClass : cssClass,
				fieldType : fieldType,
				fieldText : fieldText,
				fieldValue : fieldValue,
				otherAttrsHtml : otherAttrsHtml,
				isReadOnlyShowValOnly : isReadOnlyShowValOnly,
				horizontalClass : horizontalClass,
				hiddenValue : hiddenValue
			};
			
			var $html = $(template("treeDepart-tmpl", data));

			if(!isHide && !readonly1){
				$html.find("span").bind("click", function(){
					showLoadingToast();
					var settings = { textField : textFieldId,
							valueField : valueFieldId,
							limit : limit,
							callback : (isRefresh ? (subGridView ? dy_view_refresh : dy_refresh) : ""),
							readonly : readonly1
					};
					showDepartmentSelect("actionName", settings);
				});
			}
			$html.replaceAll($field);
		});
	};
})(jQuery);; 
(function($){
	$.fn.obpmUserfield = function(){
		return this.each(function(){
			var $field =jQuery(this);
			var id=$field.attr("_id");
			var name=$field.attr("_name");
			var fieldType=$field.attr("_fieldType");
			var cssClass=$field.attr("class");
			var value=$field.attr("value");
			var idValues=$field.attr("_getFieldValue");
			var limitSum=$field.attr("_limitSum");
			var isRefresh=$field.attr("_isRefreshOnChanged");
			var roleid=$field.attr("_roleid");
			var selectUser=$field.attr("_selectUser");
			var add=$field.attr("_add");
			var clearlabel=$field.attr("_clearlabel");
			var subGridView=$field.attr("_subGridView");
			var selectMode=$field.attr("_selectMode");
			var displayType=$field.attr("_displayType");
			var readOnlyShowValOnly = $field.attr("readOnlyShowValOnly");
			var textType = $field.attr("_textType");
			var hiddenValue = $field.attr("_hiddenValue");
			var layoutType = $field.attr("_layoutType");
			var discript = $field.attr("_discript");
			
			fieldType = fieldType?fieldType:'';
			cssClass = cssClass?cssClass:'';
			idValues = idValues?idValues:'';
			limitSum = limitSum?limitSum:'';
			isRefresh = (isRefresh == 'true');
			subGridView = (subGridView == 'true');
			roleid = roleid?roleid:'';
			selectUser = selectUser?selectUser:'';
			add = add?add:'';
			clearlabel = clearlabel?clearlabel:'';
			selectMode = selectMode?selectMode:'';
			displayType = displayType?displayType:'';
			textType = textType?textType:'';
			hiddenValue = hiddenValue?hiddenValue:'';
			value = value?value:'';
			discript = discript? discript : name;
			readOnlyShowValOnly = (readOnlyShowValOnly == "true");
			
			var readonly = false,
				hideText = "",
				readonly = "",
				discript = discript,
				title = bulitTitle(value),
				style = "",
				isReadOnlyShowValOnly = false,
				horizontalClass = "",
				otherAttrsHtml = getOtherAttrs($field[0]);	//其他属性
			
			if(layoutType == LayoutType_Horizontal){
				horizontalClass = "flexbox";
			}
			if (displayType == PermissionType_READONLY || textType.toLowerCase() == "readonly" || displayType == PermissionType_DISABLED) {
				readonly = true;
				readonly = "readonly";
				if(readOnlyShowValOnly){
					style += ";display:none;";
					isReadOnlyShowValOnly = true;
				}
			}
			if(textType.toLowerCase() == "hidden" || displayType == PermissionType_HIDDEN){
				hideText = "display:none;";
			}else{	//不是隐藏状态时置空隐藏时显示值
				hiddenValue = '';
			}
			
			var data = {
				id : id,
				name : name,
				title : title,
				value : value,
				style : style,
				discript : discript,
				cssClass : cssClass,
				idValues : idValues,
				hideText : hideText,
				readonly : readonly,
				isRefresh : isRefresh,
				fieldType : fieldType,
				subGridView : subGridView,
				otherAttrsHtml : otherAttrsHtml,
				isReadOnlyShowValOnly : isReadOnlyShowValOnly,
				horizontalClass : horizontalClass,
				hiddenValue : hiddenValue
			};
			var $html = $(template("user-tmpl", data));
			var multiple = !(selectMode == "selectOne");
			var $selectBtn = $html.find(".select"),
				$clearBtn = $html.find(".clear");
			
			var $ub = $html.find("input.userField").userbox({
				//属性和事件回调可自定义，无自定义需求可完全不填，具体用法参考说明文档
				id : id,//必须，存放回选的用户value值的input的id
				textId : id+"_text",//必须，存放回选的用户text值的input的id
				isPhone : true,		//是否手机端
				multiple: multiple,//是否多选模式
				limitSum : limitSum,	//可选的最大用户数
				mode: 'all',//simple:精简模式|all:完整模式
				width: 'auto',//宽度
				disabled: readonly,//是否禁用
				readOnlyShowValOnly : readOnlyShowValOnly,//只读是否只显示值
				required: false,//是否必填
				selectUser : selectUser,	//已选择的用户
				selectBtn : $selectBtn,	//选择按钮
				clearBtn : $clearBtn,	//清除按钮
				separator: ';',//多选模式下的分隔符
				onSuccess : function(result, rtnValue, rtnText){
					$("#" + id).val(rtnValue);
					$("#" + (id + "_text")).val(rtnText);
					//回选已选择用户
					if(result.data.length >0){
						$("#" + (id + "_text")).attr("result",rtnText);
					}else{
						$("#" + (id + "_text")).attr("result","");
					}
					if(isRefresh){
						if(subGridView){
							dy_view_refresh(id);
						}else{
							dy_refresh(name);
						}
					}
				},
				onClear : function(){
					jQuery("#" + id).val("");
					jQuery("#" + (id + "_text")).val("");
					jQuery("#" + (id + "_text")).attr("title","");
					jQuery("#" + (id + "_text")).attr("result","");
					if(isRefresh){
						if(subGridView){
							dy_view_refresh(id);
						}else{
							dy_refresh(name);
						}
								
					}
				},
				onOpen : function(){
					showLoadingToast();
				},
				onClose : function(){
				}
			});
			$html.replaceAll($field);
		});
	};
			
})(jQuery);

function bulitTitle(names){
	if(names != null && names != ''){
		var array = names.split(";");
		var title = '';
		for(var i = 0; i < array.length; i++){
			if(i != 0 && i%10 == 0){
				title += "\n";
			}
			title += array[i] + ";";
		}
		return title == ''?title:title.substring(0,title.length-1);
	}
	return '';
}; 
/**
 * userbox 
 * 
 * Copyright 2016 Teemlink
 * Vsrsion 0.1
 * 
 */
(function($){
	/**
	 * 初始化,构建用户选择组件DOM
	 */
	function _createBox(target){
		var $t = $(target);
		var state = $t.data('userbox');
		var opts = state.options;
		
		if(!opts.disabled){
			//清除
			if(opts.clearBtn){
				opts.clearBtn.bind("click",function(){
					_clear(target);
				});
			}
			
			//打开
			if(opts.selectBtn){
				opts.selectBtn.bind("click",function(){
					_open(target);
				});
			}
		}
	}
	
	/**
	 * 打开用户选择面板（完整模式下可用）
	 */
	function _open(target){
		var $t = $(target);
		
		var state = $t.data('userbox');
		var opts = state.options;
		
		var oApp = document.getElementsByName("application")[0];
		var url = "";
		if(opts.isPhone){
			url = contextPath + "/contacts/index.jsp?mode=select";
		}else{
			url = contextPath + "/portal/phone/resource/component/dialog/selectUserByAll.jsp?application="+oApp.value;
		}
		var inputValueId = opts.id;
		var inputTextId = opts.textId;
		var selecteds = getUserSelected(opts.separator, inputValueId, inputTextId);	//获取已选用户的json结构
		
		var args = {
				// p1:当前窗口对象
				"parentObj" : window,
				// p4:默认选中值, 格式为[userid1,userid2]
				"defValue": opts.defValue,
				//选择用户数
				"limitSum": opts.limitSum,
				//选择模式
				"multiple" : opts.multiple,
				// 存放userEmail的容器id
				"receiverEmail" : opts.showUserEmail,
				// 存放userEmail的容器id
				"receiverEmailAccount" : opts.showUserEmailAccount,
				// 存放userTelephone的容器id
				"receiverTelephone" : opts.showUserTelephone,
				//{id:{}};回选已选择的用户
				selecteds : selecteds,
				//[]待选择的静态用户数据
				toChooseUsers : opts.toChooseUsers,
				// [] 配置显示的tab，全部、部门、职务、常用
				tabs : opts.tabs
			};
		
		OBPM.dialog.show({
					width : 610,
					height : 450,
					url : url,
					args : args,
					title : title_uf,
					close : function(result) {
						if(result){
							if(result.state == "success"){
								_success(target, result);
							}else {
								_close(target);
							}
						}
					}
				});
		if(opts.onOpen){
			if(typeof opts.onOpen == "function"){
				opts.onOpen.apply(this,arguments);
			}else{
				eval(opts.onOpen);
			}
			
		}
	}
	/**
	 * 关闭用户选择面板（完整模式下可用）
	 */
	function _close(target){
		var state = $(target).data('userbox');
		var opts = state.options;
		if(opts.onClose){
			if(typeof opts.onClose == "function"){
				opts.onClose.apply(this,arguments);
			}else{
				eval(opts.onClose);
			}
		}
	}

	/**
	 * 成功完成选择，关闭用户选择面板（完整模式下可用）
	 */
	function _success(target, result){
		var $t = $(target).data('userbox');
		var opts = $t.options;

		var rtnValue = "";
		var rtnText = "";
		if(result){
			var data = result.data;
			if(data && data.length>0){
				for(var i = 0; i < data.length; i++){
					rtnValue += data[i].value + opts.separator;
				}

				for(var i = 0; i < data.length; i++){
					rtnText += data[i].text + opts.separator;
				}
			}
			rtnValue = rtnValue.substring(0,rtnValue.length-1);
			rtnText = rtnText.substring(0,rtnText.length-1);
		}
		if (opts.onSuccess) {
			if(typeof opts.onSuccess == "function"){
				opts.onSuccess(result, rtnValue, rtnText);
			}else{//用户选择框控件
				eval(opts.onSuccess);
			}
		}
	}
	/**
	 * 选中用户
	 */
	function _select(target,user){
		var state = $(target).data('userbox');
		var opts = state.options;
		//TODO
		
		if(opts.onSelect){
			opts.onSelect.apply(this,arguments);
		}
	}
	/**
	 * 取消选中用户
	 */
	function _unSelect(target,user){
		var state = $(target).data('userbox');
		var opts = state.options;
		//TODO
		
		if(opts.onUnSelect){
			opts.onUnSelect.apply(this,arguments);
		}
	}
	
	/**
	 * 设置已选用户
	 */
	function _setSelects(target,users){
		var state = $(target).data('userbox');
		var opts = state.options;
		//TODO
		alert('call setSelects method');
	}
	/**
	 * 获取已选中用户集合
	 */
	function _getSelects(target){
		var state = $(target).data('userbox');
		var opts = state.options;
		//TODO
		alert('call getSelects method');
		return [];
	}
	/**
	 * 清空已选中用户
	 */
	function _clear(target){
		var $t = $(target);
		var state = $t.data('userbox');
		var opts = state.options;
		
		if(opts.onClear){
			if(typeof opts.onClear == "function"){
				opts.onClear.apply(this,arguments);
			}else{
				eval(opts.onClear);
			}
			
		}
	}
	/**
	 * 获取已选用户的json结构
	 *
	 * @param {string} separator 返回值的拼接符号
	 * @param {string} inputValueId 存放已选择用户id的容器id
	 * @param {string} inputTextId 存放已选择用户name的容器id
	 * @return {Object} 返回已选用户的json
	 */
	function getUserSelected(separator, inputValueId, inputTextId){
		var _selectedsOjb = {};
		var selectedValue = $("#"+inputValueId).val();
		var selectedText = $("#"+inputTextId).attr("result") ? $("#"+inputTextId).attr("result") : $("#"+inputTextId).val();
		if(selectedValue != "" && selectedText != ""){
			selectedValue = selectedValue.split(separator);
			selectedText = selectedText.split(separator);
			for(var i=0;i<selectedValue.length;i++){
				var name = selectedText[i];
				var avatar = Common.Util.getAvatar(selectedValue[i]);
				var id = selectedValue[i];
				var obj = {
						'id' : id,
						'name' : name,
						'dept' : '',
						'mobile' : '',
						'mobile2' : '',
						'email' : '',
						'avatar' : avatar
				}
				_selectedsOjb[id] = obj;
			}
		}
		return _selectedsOjb;
	}
	/**
	 * 解析属性
	 */
	function parseOptions(target){
		var t = $(target);
		return {
			multiple: (t.attr('multiple') ? (t.attr('multiple') == 'true' || t.attr('multiple') == true) : undefined),
			mode: (t.attr('mode') || undefined),
			options: (t.attr('options') || undefined),
			tabs: (t.attr('tabs') || undefined),
			width: (t.attr('width') || undefined),
			disabled: (t.attr('disabled') ? true : undefined),
			required: (t.attr('required') ? (t.attr('required') == 'true' || t.attr('required') == true) : undefined),
			separator: (t.attr('separator') || undefined),
		};
	}
	$.fn.userbox = function(options, param){
		if (typeof options == 'string'){
			var method = $.fn.userbox.methods[options];
			if (method){
				return method(this, param);
			}
		}
		
		options = options || {};
		return this.each(function(){
			var state = $(this).data('userbox');
			if (state){
				$.extend(state.options, options);
			} else {
				var _options = options;
				if(!options.tabs){	//未传值时使用合并参数
					_options = $.extend({}, $.fn.userbox.defaults, $.fn.userbox.parseOptions(this), options);
				}
				$(this).data('userbox', {
					options: _options
				});
			}
			_createBox(this);
		});
	};
	
	$.fn.userbox.methods = {
		
		open: function(target){
			return target.each(function(){
				_open(this);
			});
		},
		close: function(target){
			return target.each(function(){
				_close(this);
			});
		},
		setSelects: function(target, value){
			return target.each(function(){
				_setSelects(this, value);
			});
		},
		getSelects: function(target){
			return _getSelects(target[0]);
		},
		clear: function(target){
			return target.each(function(){
				_clear(this);
			});
		},
	};
	
	$.fn.userbox.parseOptions = function(target){
		return parseOptions(target);
	};
	
	$.fn.userbox.defaults = {
			id:"",//必须，存放回选的用户value值的input的id
			textId:"",//必须，存放回选的用户text值的input的id
			multiple: false,//是否多选模式
			mode: 'all',//simple:精简模式|all:完整模式
			tabs: {		// [] 配置显示的tab，全部、部门、职务、常用
				all : {name:'全部',url: 'getAllUser.action'},
				dept : {name:'部门',url: 'getContactsTree.action'},
			    role : {name:'角色',url: 'getApplicationAndRoleContactsTree.action'},
			    favorite : {name:'常用',url: 'getFavoriteContacts.action'}
			},
			width: 'auto',//宽度
			disabled: false,//是否禁用
			required: false,//是否必填
			separator: ';',//多选模式下的分隔符
			selectUser : [],
			toChooseUsers : [],	//待选择的静态用户数据，结构：[{avatar : "",	dept : "行政部2",email : "",	id : "",mobile : "",mobile2 : "",name : "邢儿",type : 1},{...}]
			
			onSelect: undefined,
			onUnSelect: undefined,
			onSuccess: undefined,
			onOpen: undefined,
			onClose: undefined,
			onClear: undefined
	};
})(jQuery);
; 
if(window.jQuery || window.Zepto){
	(function($){
		"use strict";

		var NAMESPACE = 'obpm.includedView';
		var EVENT_REFRESH = 'refresh.' + NAMESPACE;
		var EVENT_LOAD = 'load.' + NAMESPACE;
		var EVENT_LOADED = 'loaded.' + NAMESPACE;
		var EVENT_SHOW = 'show.' + NAMESPACE;
		var EVENT_SHOWN = 'shown.' + NAMESPACE;
		var EVENT_HIDE = 'hide.' + NAMESPACE;
		var EVENT_HIDDEN = 'hidden.' + NAMESPACE;

		var IncludedView = function(element, options){
			this.$body = $(document.body);
			this.$element = $(element);
			this.options = options;
	    };
	    
	    IncludedView.DEFAULTS = {};

	    //刷新
	    IncludedView.prototype.refresh = function(){
	    	var $this = this.$element;
	        $this.trigger(EVENT_REFRESH);  
	    };

	    //读取
	    IncludedView.prototype.load = function(){
	    	var $this = this.$element;
	        $this.trigger(EVENT_LOAD);
	        this.loaded();  
	    };

	    //读取后
	    IncludedView.prototype.loaded = function(){
	    	var $this = this.$element;
	        $this.trigger(EVENT_LOADED);
	    };

	    //显示
	    IncludedView.prototype.show = function(){
	    	var $this = this.$element;
	        $this.trigger(EVENT_SHOW);
	        this.shown();  
	    };

	    //显示后
	    IncludedView.prototype.shown = function(){
	    	var $this = this.$element;
	        $this.trigger(EVENT_SHOWN);
	    };

	    //隐藏
	    IncludedView.prototype.hide = function(){
	    	var $this = this.$element;  
	        $this.trigger(EVENT_HIDE);  
	        this.hidden(); 
	    };

	    //隐藏后
	    IncludedView.prototype.hidden = function(){
	    	var $this = this.$element;
	        $this.trigger(EVENT_HIDDEN);
	    };

	    function Plugin(option){
	        //return this.each(function(){
				var $this = $(this)
				// 判断是否初始化过的依据
				var data = $this.data('obpm.includedView');
			    var options = $.extend({}, IncludedView.DEFAULTS, $this.data(), typeof option == 'object' && option)
				// 如果没有初始化过, 就初始化它
				if (!data){
					$this.data('obpm.includedView', (data = new IncludedView(this,options)));
				} 

				if (typeof option == 'string'){
					data[option](this);
				}
				
	        //})
	    };

		//这里的 $.fn.IncludedView 有可能是之前已经有定义过的插件，在这里做无冲突处理使用。
	    var old = $.fn.includedView; 

	    //暴露类名, 可以自定义扩展
	    $.fn.includedView = Plugin;
	    $.fn.includedView.Constructor = IncludedView;

	    //无冲突处理
	    $.fn.includedView.noConflict = function(){
	        $.fn.includedView = old;
	        return this
	    };
	})(window.jQuery || window.Zepto);
}; 
(function($){
	$.fn.obpmIncludedView = function(){
		return this.each(function(){
			
			var $curPage = ajaxPage.getCurPage();
			var pageId = $curPage.attr("id");
			
			var $field = jQuery(this);
			var $tabContent = $field.parents(".tabcontent");
			
			var action = $field.attr("action");
			var application = $field.attr("application");
			var divId = $field.attr("divid");
			var fieldId = $field.attr("_fieldid");
			var fixation = $field.attr("fixation");
			var fixationHeight = $field.attr("fixationHeight");
			var getName = $field.attr("getName");
			var getEditMode = ($field.attr("getEditMode") == "true");
			var id = $field.attr("id");
			var isRefreshOnChanged = ($field.attr("isRefreshOnChanged") == "true");
			var isRelate = $field.attr("isRelate");
			var openType = 227;//$field.attr("_opentype");
			var parentId = $field.attr("parentid");
			var userType = ($field.attr("userType") == "true");
			var viewId = $field.attr("_viewid");
			var viewTotalNum = $field.attr("viewTotalNum");

			if(fixation){
				height = "height:" + fixationHeight + ";";
			}else {
				height = "";
			}
			
			if($tabContent.size() > 0){
				var isTab = "true";
				/*var formId = $tabContent.attr("formid");
				var tabVisibleStyle = "";
				if($tabContent.is(":visible")){
					tabVisibleStyle = "display:block;";
				}else{
					tabVisibleStyle = "display:none;";
				}*/
			}else{
				var isTab = "false";
			}		

			var url = "";
			if(userType){
				url = "../dynaform/view/preView.action?application=" + application + "&_skinType=" + $field.attr("skinType") + "";
			}else{
				url = "../dynaform/view/" + action + "?application=" + application + "";
			}
			url+="&_viewid=" + viewId + "";
			url+="&_fieldid=" + fieldId + "";
			url+="&_opentype=" + openType + "";
			url+="&parentid=" + parentId + "";
			url+="&isRelate=" + isRelate + "";
			url+="&divid=" + divId + "";
			url+="&_from=includedView";

			if(getEditMode){
				url+="&isedit=false";
			}
			
			if(isRefreshOnChanged){
				url+="&refreshparent=true";
			}

			var data = {
				id : fieldId,
				isRelate : isRelate,
				url : url,
				istab : isTab,
				name : getName,
				fixation : fixation,
				userType : userType,
				height : height,
				isRefreshOnChanged : isRefreshOnChanged,
				fixationHeight : fixationHeight,
				viewTotalNum : viewTotalNum
			};

			var $html = $(template("included-tmpl", data));

			$html.on({
				'load.obpm.includedView': function (e) {
					var $this = $(e.target);
					var url = $this.attr("src");
					var title = $this.attr("getname");
					var id = $this.attr("id");
					var $curPage = ajaxPage.getCurPage();
					var curPageId = $curPage.attr("id");
					var newUrl = url + "&parentForm=" + curPageId;
					
					if(isRefreshOnChanged){
						$this.attr("refresh","true");
					}
					
					
					ajaxPage.getDisplayViewHash(newUrl,id);
				},
				'refresh.obpm.includedView': function (e) {
					if(isRefreshOnChanged){
						var $this = $(e.target);
						var id = $this.attr("id");
						dy_refresh(id);
					}
				},
				'click': function(e){
					$(this).includedView("load");
				}
			}).includedView(data);

			$field.before($html);
			$field.remove();
		})
	};
})(jQuery);; 
(function($){
	$.fn.obpmWordField=function(){
		return this.each(function(){
			var $field = jQuery(this);
			var name = $field.attr("name");
			var id= $field.attr("id");
			var getItemValue = $field.attr("getItemValue");
			var getId = $field.attr("getId");
			var wordid = $field.attr("wordid");
			var getOpenTypeEquals = $field.attr("getOpenTypeEquals");
			var showWord = $field.attr("showWord");
			var secondvalue = $field.attr("secondvalue");
			var docgetId = $field.attr("docgetId");
			var docgetFormname = $field.attr("docgetFormname");
			var openType = $field.attr("openType");
			var displayType = $field.attr("displayType");
			var discript = HTMLDencode($field.attr("discript"));
			var saveable = $field.attr("saveable");
			var isSignature = $field.attr("isSignature");
			var filename = $field.attr("filename");
			var _docid = $field.attr("_docid");
			var _type = $field.attr("_type");
			var fieldname = $field.attr("fieldname");
			var formname = $field.attr("formname");
			var versions = $field.attr("content.versions");
			var application = $field.attr("application");
			var _isEdit = $field.attr("_isEdit");
			var signature = $field.attr("signature");
			var isReadonly = (displayType == PermissionType_READONLY || displayType == PermissionType_DISABLED);
			
			saveable = (saveable == "true");
			isSignature = (isSignature == "true");
			discript = discript? discript : name;
			
			var url = "",
				style = "",
				readonly = "",
				openInDiv = false;
			if(displayType == PermissionType_HIDDEN){
				style = ";display:none;";
			}

			if(openType && openType=="2" || openType=="3"){
				openInDiv = true;
			}
			if(getItemValue && getItemValue !=""){
				secondvalue = getItemValue;
				filename = getItemValue;
			}else{
				getItemValue = wordid;
			}
			if(displayType == PermissionType_READONLY){
				readonly = "readonly";
			}
			if (isReadonly) {
				_isEdit=1;
			}

			url = contextPath + "/portal/dynaform/document/newword.action?id=" + getId
				+ "&filename=" + filename
				+ "&_docid=" + _docid
				+ "&_type=" + _type
				+ "&fieldname=" + fieldname
				+ "&formname=" + formname
				+ "&content.versions=" + versions
				+ "&application=" + application
				+ "&_isEdit=" + _isEdit
				+ "&isSignature=" + isSignature
				+ "&isReadonly=" + isReadonly
				+ "&signature=" + signature;

			var data = {
					id : id,
					name : name,
					getId : getId,
					url : url,
					_isEdit : _isEdit,
					style : style,
					wordid : wordid,
					readonly : readonly,
					isReadonly : isReadonly,
					discript : discript,
					openType : openType,
					getItemValue : getItemValue,
					secondvalue : secondvalue
			};
			var $html = $(template("wordOld-tmpl", data));
			if(openInDiv){
				$html.find("button").bind("click",function(){
					showWordDialog(showWord,
							'WordControl',
							docgetId,
							docgetFormname,
							secondvalue,
							id,
							'content.versions',
							openType,
							displayType,
							saveable,
							isReadonly,
							signature,
							(isSignature?true:false));
				})
			}
			$html.replaceAll($field);
		});
	};
	
})(jQuery);; 
/**
 * 流程历史
 */
(function($){
	
	var ShowMode = {
			SHOW_MODE_TEXT : 'text',//只显示文本
			SHOW_MODE_DIAGRAM : 'diagram',//只显示图表
			SHOW_MODE_TEXT_AND_DIAGRAM : 'textAndDiagram'//显示文本与图表
	};
	
	function buildFlowHistoryTextList($field){
		//TODO html中的css样式代码抽离到css文件

		var trLists = [];
		$field.find("table tr").each(function(i){//行<tr>
			var _trList = {
					i : i,
					tdLists : []
			};
			var tdLists = [];
			var $trField = jQuery(this);
			if(i==0){//列头
				$trField.children().each(function(){
					var $tdField = jQuery(this);
					var _tdList = {
							width : $tdField.attr("width"),
							text : $tdField.text()
					};
					_trList.tdLists.push(_tdList);
				});
			}else{
				$trField.children().each(function(){
					var $tdField = jQuery(this);

					var _tdList = {
							width : $tdField.attr("width"),
							text : $tdField.text(),
							isSign : false,
							type : "",
							_data : ""
					};
					if($tdField.hasClass('attitude') && $tdField.find("span").length==1){
						var data = $tdField.find("span").data("datas");
						_tdList.isSign = true;
						_tdList.type = data['type'];
						_tdList._data = data['data'];
					}
					_trList.tdLists.push(_tdList);
				});
			}
			trLists.push(_trList);
		});
		
		return trLists;
	}
	
	
	$.fn.obpmFlowHistoryField = function(){
		return this.each(function(){
			var $field = jQuery(this);
			var showMode = $field.attr("showMode");
			var flowDiagram = $field.attr("flowDiagram");
			var mobile = $field.attr("mobile");
			var name = $field.attr("_name");
			var discript = $field.attr("_discript");
			discript = discript? HTMLDencode(discript) : name;
			var showText = false,
				showDiagram = false,
				show = false;
			if(showMode == ShowMode.SHOW_MODE_TEXT){
				showText = true;
			}else if(showMode == ShowMode.SHOW_MODE_DIAGRAM){
				showDiagram = true;
			}else if(showMode == ShowMode.SHOW_MODE_TEXT_AND_DIAGRAM){
				showText = true;
				showDiagram = true;
			}
			if(mobile=="true"){
				show = true;
			}
			var data = {
					name : name,
					show : show,
					mobile : mobile,
					showText : showText,
					discript : discript,
					showDiagram : showDiagram,
					flowDiagram : flowDiagram,
					trLists : []
			};
			data.trLists = buildFlowHistoryTextList($field);
			var $html = $(template("history-tmpl", data));
			$field.replaceWith($html);
		});
	};
})(jQuery);

; 
;
/**
 * 流程催办历史控件
 * @author Happy
 * @param $
 */
(function($){
	
	
	/**
	 * 控件初始化
	 */
	function _init(t){
		var options = _parseOptions(t);
		
		var data = {
				id : options.id,
				name : options.name,
				trLists : []
		};
		data.trLists = _buildHistoryTableHTML(t);
		var $html = $(template("reminderHistory-tmpl", data));
		t.replaceWith($html);
		return $html;
	}
	
	function _buildHistoryTableHTML(t){
		var $field = $(t);
		var name = $field.data("name");
		var discript = $field.data("discription");
		discript = discript? discript : name;

		var trLists = [];
		$field.find("table tr").each(function(i){//行<tr>
			var _trList = {
					i : i,
					tdLists : []
			};
			var $trField = jQuery(this);
			if(i==0){//列头
				$trField.children().each(function(){
					var $tdField = jQuery(this);
					var _tdList = {
							width : $tdField.attr("width"),
							text : $tdField.text()
					};
					_trList.tdLists.push(_tdList);
				});
			}else{
				$trField.children().each(function(){
					var $tdField = jQuery(this);
					var _tdList = {
							text : $tdField.text(),
					};
					_trList.tdLists.push(_tdList);
					
				});
			}
			trLists.push(_trList);
		});
		return trLists;
	}
	
	
	/**
	 * 事件绑定
	 */
	function _bindEvents(t){
	}
	
	/**
	 * 解析控件参数
	 */
	function _parseOptions(t){
		var options = {};
		options.id = t.attr("id");
		options.name = t.data("name");
		options.discription = t.data("discription");
		return options;
	}
	
	$.fn.obpmFlowReminderHistoryField = function(options, param){
		if(typeof options=="string"){
			return $.fn.obpmFlowReminderHistoryField.method[options](this,param);
		}
		options = options || {};
		return this.each(function(){
			var t = $(this);
			var state = t.data("flowReminderHistoryField");
			if(state){
				$.extend(state.options,options);
			}else{
				var r =_init(t);
				state = t.data('flowReminderHistoryField', {
					options: $.extend({}, $.fn.obpmFlowReminderHistoryField.defaults, _parseOptions(t), options),
					panel: r
				});
				_bindEvents(t);
			}
		});
	},
	
	$.fn.obpmFlowReminderHistoryField.defaults = {
			id:'',
			name:undefined,
			discription:''
	},
	
	$.fn.obpmFlowReminderHistoryField.method= {
			
		setValue:function(jq,value){
			
		},
		getValue:function(jq){
			jq.each(function(){
				//nothing
			});
		}
	}
	
})(jQuery);
; 
;
/**
 * 微信gps位置控件
 * @author Happy
 * @param $
 */
(function($){
	
	/**
	 * 获取位置
	 */
	function getLocation(t,callback){

        //判断接口
        var ua = window.navigator.userAgent;
        //indexOf() 方法可返回某个指定的字符串值在字符串中首次出现的位置
        if(ua.indexOf("myApps") >= 0) {
            var _nativeAPI = top.nativeAPI ? top.nativeAPI : nativeAPI;
            _nativeAPI.getLocation({
                type: 'wgs84', // 默认为 wgs84 的 gps 坐标
                success: function (res) {
                    var datas = JSON.parse(res);
                    var latitude = datas.latitude; // 纬度，浮点数，范围为 90 ~ -90
                    var longitude = datas.longitude; // 经度，浮点数，范围为 180 ~ -180。

                    $.post(contextPath+"/attendance/attendance/convertGps2Baidu.action",{"from":"0","x":longitude,"y":latitude},function(result){
                        if(1==result.status){
                            var bdPoint = new BMap.Point(result.data.x,result.data.y);
                            var geoc = new BMap.Geocoder();
                            //坐标逆解析为地址
                            geoc.getLocation(bdPoint, function(rs){
                                var addComp = rs.addressComponents;
                                var locationName = addComp.province+ addComp.city + addComp.district + addComp.street + addComp.streetNumber;
                                var location ={
                                    latitude:latitude,
                                    longitude:longitude,
                                    address:locationName
                                };
                                var options = t.data("weixinGpsField").options;
                                $("input[name='"+options.name+"']").val(JSON.stringify(location));
                                t.data("weixinGpsField").panel.find(".address-text").text(location.address);
                                if(callback && typeof callback=="function"){
                                    callback(result);
                                }
                            });
                        }else{
                        }
                    },"json");


                }
            });
        }else {
            wx.getLocation({
                //type: 'gcj02', // 默认为wgs84的gps坐标，如果要返回直接给openLocation用的火星坐标，可传入'gcj02'
                success: function (res) {
                    var latitude = res.latitude; // 纬度，浮点数，范围为90 ~ -90
                    var longitude = res.longitude ; // 经度，浮点数，范围为180 ~ -180。

                    $.post(contextPath+"/attendance/attendance/convertGps2Baidu.action",{"from":"0","x":longitude,"y":latitude},function(result){
                        if(1==result.status){
                            var bdPoint = new BMap.Point(result.data.x,result.data.y);
                            var geoc = new BMap.Geocoder();
                            //坐标逆解析为地址
                            geoc.getLocation(bdPoint, function(rs){
                                var addComp = rs.addressComponents;
                                var locationName = addComp.province+ addComp.city + addComp.district + addComp.street + addComp.streetNumber;
                                var location ={
                                    latitude:latitude,
                                    longitude:longitude,
                                    address:locationName
                                };
                                var options = t.data("weixinGpsField").options;
                                $("input[name='"+options.name+"']").val(JSON.stringify(location));
                                t.data("weixinGpsField").panel.find(".address-text").text(location.address);
                                if(callback && typeof callback=="function"){
                                    callback(result);
                                }
                            });
                        }else{
                        }
                    },"json");
                }
            });
		}


	}

	/**
	 * 打开位置
	 */
	function openLocation(t){
		var v = t.val();
		if(!v || v.length<=0)return;
		
		var location = $.parseJSON(v);
		wx.openLocation({
		    latitude: location.latitude, // 纬度，浮点数，范围为90 ~ -90
		    longitude: location.longitude, // 经度，浮点数，范围为180 ~ -180。
		    name: '', // 位置名
		    address: location.address, // 地址详情说明
		    scale: 25, // 地图缩放级别,整形值,范围从1~28。默认为最大
		    infoUrl: '' // 在查看位置界面底部显示的超链接,可点击跳转
		});
		
			
	}
	/**
	 * gps控件初始化
	 */
	function _init(t){

		var options = _parseOptions(t);
		var name = options.name;
		var layoutType = options._layoutType;
		var hiddenValue = options.hiddenValue;
		var discript = options.discript;
		discript = discript ? discript : name;
		
		var style = "",
			horizontalClass = "",
			showLocation = false;
		if(layoutType == LayoutType_Horizontal){
			horizontalClass = "flexbox";
		}
		if(options.displayType==2){//可编辑
			showLocation = true;
		}
		
		var options = _parseOptions(t);
		if(options.displayType==3){//隐藏
			style = ";display:none;";
		}else{
			hiddenValue = "";
		}
		
		var data = {
				name : name,
				style : style,
				discript : discript,
				showLocation : showLocation,
				horizontalClass : horizontalClass,
				hiddenValue : hiddenValue
		};
		
		var $html = $(template("gps-tmpl", data));
		$html.insertAfter(t);
		var v = t.val();
		if(v.length<=0 && (options.displayType==2 || options.displayType==3)){//值为空，且可编辑状态下
			setTimeout(function(){
				getLocation(t,function(){
					//刷新表单
					if(options.isRefreshOnChanged){
						dy_refresh(options.id);
					}
				});
			}, 3000);
			
		}else{
			if(v && v!=""){
				var location = $.parseJSON(v);
				$html.find(".address-text").text(location.address);
			}
		}
		return $html;
	}
	
	/**
	 * 事件绑定
	 */
	function _bindEvents(t){
		var panel = t.data("weixinGpsField").panel;
		var options = t.data("weixinGpsField").options;
		panel.find(".refresh").on("click",function(e){
			e.preventDefault();
			e.stopPropagation();
			panel.find(".address-text").html(" &nbsp;");
			getLocation(t,function(){
				//刷新表单
				if(options.isRefreshOnChanged){
					dy_refresh(options.id);
				}
			});
		});
		panel.find(".location").on("click",function(e){
			e.preventDefault();
			e.stopPropagation();
			openLocation(t);
		});
	}
	
	/**
	 * 解析gps控件设置参数
	 */
	function _parseOptions(t){
		var options = {}
		options.id = t.attr("id");
		options.name = t.attr("name");
		options.displayType = t.attr("displayType");
		options.isRefreshOnChanged = t.attr("isRefreshOnChanged");
		options._layoutType = t.attr("_layoutType");
		options.discript = t.attr("discript");
		options.hiddenValue = t.attr("_hiddenValue");
		
		return options;
	}
	
	$.fn.obpmWeixinGpsField = function(options, param){
		
		if(typeof options=="string"){
			return $.fn.obpmWeixinGpsField.method[options](this,param);
		}
		options = options || {};
		return this.each(function(){
			var t = $(this);
			var state = t.data("weixinGpsField");
			if(state){
				$.extend(state.options,options);
			}else{
				var r =_init(t);
				state = t.data('weixinGpsField', {
					options: $.extend({}, $.fn.obpmWeixinGpsField.defaults, _parseOptions(t), options),
					panel: r
				});
				
				_bindEvents(t);
			}
		});
	},
	
	$.fn.obpmWeixinGpsField.defaults = {
			id:'',
			isRefreshOnChanged:false,
			name:undefined
	},
	
	$.fn.obpmWeixinGpsField.method= {
			
		setValue:function(jq,value){
			
		},
		getValue:function(jq){
		}
	}
	
})(jQuery);
; 
;
/**
 * 调查问卷控件
 * @author Happy
 * @param $
 */
(function($){
	
	
	/**
	 * 控件初始化
	 */
	function _init(t){
		var options = _parseOptions(t);
		
		var v = t.val();
		var questions = options.questions;
		var displayType = options.displayType;
		var disabled = (displayType==4 || displayType==1) ? "disabled" : ""; //只读?
		var data = {
				id : options.id,
				disabled : disabled,
				list : []
			};
		//问题
		for(i in questions){
			var question = questions[i];
			var ques = {
				id : question.id,
				topic : question.topic,
				subList : []
			};

			//问题选项
			for(i in question.options){
				var opt = question.options[i];
				opt.tagName = "input";
				opt.i = i;
				
				if(opt.type == "textarea"){
					opt.tagName = "textarea";
				}
				ques.subList.push(opt);
			}
			data.list.push(ques);
		}
		var $panel = $(template("survey-tmpl", data));
		
		$panel.insertAfter(t);
		return $panel;
	}
	
	/**
	 * 事件绑定
	 */
	function _bindEvents(t){
		//var panel = t.data("surveyField").panel;
	}
	
	/**
	 * 解析控件参数
	 */
	function _parseOptions(t){
		var options = {};
		options.id = t.attr("id");
		options.name = t.attr("name");
		options.displayType = t.data("displayType");
		options.discription = t.data("discription");
		options.questions = t.data("questions");
		return options;
	}
	
	/**
	 * 获取答案
	 */
	function _getValue(jq){
		var values =[];
		var state = jq.data("surveyField");
		var options = state.options;
		var panel = state.panel;
		
		var questions = options.questions;
		
		for(i in  questions){
			var question = questions[i];
			var value = {
				question:question.id,
				answers :[]
			}
			
			panel.find("input[name='question-"+question.id+"-answer']:checked").each(function(index){
				var $t = $(this);
				var type = $t.data("type");
				var custom = $t.data("custom");
				var text = $t.data("text");
				var v = custom? $t.parent().find("input[name='"+$t.attr("name")+"-value']").val() :$t.val();
				/**
				switch (type) {
				case "checkbox":
				case "radio":
					
					break;
				default:
					break;
				}
				**/
				var answer ={
						type :type,
						custom :custom,
						text:text,
						value:v
				}
				value.answers.push(answer);
			});
			
			values.push(value);
		}
		jq.val(JSON.stringify(values));
		return values;
		
	}
	
	function _setValue(jq,v){
		if(typeof v == "string" && v.length>0){
			v = $.parseJSON(v);
		}
		var values = v || [];
		var state = jq.data("surveyField");
		var options = state.options;
		var panel = state.panel;
		
		var questions = options.questions;
		
		for(i in  values){
			var value = values[i];
			var questionId = value.question;
			var answers = value.answers;
			
			panel.find("input[name='question-"+questionId+"-answer']").each(function(index){
				var $t = $(this);
				for(k in answers){
					var answer = answers[k];
					if(!answer.custom && answer.value==$t.val()){
						$t.attr("checked",'true');
						break;
					}
					if(answer.custom && $t.data("custom") && answer.text==$t.data("text")){
						$t.attr("checked",'true');
						$t.parent().find("input[name='"+$t.attr("name")+"-value']").val(answer.value);
						break;
					}
				}
			});
		}
	}
	
	$.fn.obpmSurveyField = function(options, param){
		
		if(typeof options=="string"){
			return $.fn.obpmSurveyField.method[options](this,param);
		}
		options = options || {};
		return this.each(function(){
			var t = $(this);
			var state = t.data("surveyField");
			if(state){
				$.extend(state.options,options);
			}else{
				var r =_init(t);
				state = t.data('surveyField', {
					options: $.extend({}, $.fn.obpmSurveyField.defaults, _parseOptions(t), options),
					panel: r
				});
				_bindEvents(t);
				_setValue(t,t.val());
			}
		});
	},
	
	$.fn.obpmSurveyField.defaults = {
			id:'',
			name:undefined,
			displayType:2,
			discription:'',
			questions:[]
	},
	
	$.fn.obpmSurveyField.method= {
			
		setValue:function(jq,value){
			
		},
		getValue:function(jq){
			jq.each(function(){
				_getValue($(this));
			});
		}
	}
	
})(jQuery);
; 
(function () {
    'use strict';
    var definePinchZoom = function ($) {
    	
        var PinchZoom = function (el, options) {
                this.el = $(el);
                this.zoomFactor = 1;
                this.lastScale = 1;
                this.offset = {
                    x: 0,
                    y: 0
                };
                this.options = $.extend({}, this.defaults, options);
                this.setupMarkup();
                this.bindEvents();
                this.update();
                // default enable.
                this.enable();

            },
            sum = function (a, b) {
                return a + b;
            },
            isCloseTo = function (value, expected) {
                return value > expected - 0.01 && value < expected + 0.01;
            };

        PinchZoom.prototype = {

            defaults: {
                tapZoomFactor: 2,
                zoomOutFactor: 1.3,
                animationDuration: 300,
                animationInterval: 5,
                maxZoom: 4,
                minZoom: 0.5,
                lockDragAxis: false,
                use2d: true,
                zoomStartEventName: 'pz_zoomstart',
                zoomEndEventName: 'pz_zoomend',
                dragStartEventName: 'pz_dragstart',
                dragEndEventName: 'pz_dragend',
                doubleTapEventName: 'pz_doubletap'
            },

            /**
             * Event handler for 'dragstart'
             * @param event
             */
            handleDragStart: function (event) {
                this.el.trigger(this.options.dragStartEventName);
                this.stopAnimation();
                this.lastDragPosition = false;
                this.hasInteraction = true;
                this.handleDrag(event);
            },

            /**
             * Event handler for 'drag'
             * @param event
             */
            handleDrag: function (event) {

                if (this.zoomFactor > 1.0) {
                    var touch = this.getTouches(event)[0];
                    this.drag(touch, this.lastDragPosition);
                    this.offset = this.sanitizeOffset(this.offset);
                    this.lastDragPosition = touch;
                }
            },

            handleDragEnd: function () {
                this.el.trigger(this.options.dragEndEventName);
                this.end();
            },

            /**
             * Event handler for 'zoomstart'
             * @param event
             */
            handleZoomStart: function (event) {
                this.el.trigger(this.options.zoomStartEventName);
                this.stopAnimation();
                this.lastScale = 1;
                this.nthZoom = 0;
                this.lastZoomCenter = false;
                this.hasInteraction = true;
            },

            /**
             * Event handler for 'zoom'
             * @param event
             */
            handleZoom: function (event, newScale) {

                // a relative scale factor is used
                var touchCenter = this.getTouchCenter(this.getTouches(event)),
                    scale = newScale / this.lastScale;
                this.lastScale = newScale;

                // the first touch events are thrown away since they are not precise
                this.nthZoom += 1;
                if (this.nthZoom > 3) {

                    this.scale(scale, touchCenter);
                    this.drag(touchCenter, this.lastZoomCenter);
                }
                this.lastZoomCenter = touchCenter;
            },

            handleZoomEnd: function () {
                this.el.trigger(this.options.zoomEndEventName);
                this.end();
            },

            /**
             * Event handler for 'doubletap'
             * @param event
             */
            handleDoubleTap: function (event) {
                var center = this.getTouches(event)[0],
                    zoomFactor = this.zoomFactor > 1 ? 1 : this.options.tapZoomFactor,
                    startZoomFactor = this.zoomFactor,
                    updateProgress = (function (progress) {
                        this.scaleTo(startZoomFactor + progress * (zoomFactor - startZoomFactor), center);
                    }).bind(this);

                if (this.hasInteraction) {
                    return;
                }
                if (startZoomFactor > zoomFactor) {
                    center = this.getCurrentZoomCenter();
                }

                this.animate(this.options.animationDuration, this.options.animationInterval, updateProgress, this.swing);
                this.el.trigger(this.options.doubleTapEventName);
            },

            /**
             * Max / min values for the offset
             * @param offset
             * @return {Object} the sanitized offset
             */
            sanitizeOffset: function (offset) {
                var maxX = (this.zoomFactor - 1) * this.getContainerX(),
                    maxY = (this.zoomFactor - 1) * this.getContainerY(),
                    maxOffsetX = Math.max(maxX, 0),
                    maxOffsetY = Math.max(maxY, 0),
                    minOffsetX = Math.min(maxX, 0),
                    minOffsetY = Math.min(maxY, 0);

                return {
                    x: Math.min(Math.max(offset.x, minOffsetX), maxOffsetX),
                    y: Math.min(Math.max(offset.y, minOffsetY), maxOffsetY)
                };
            },

            /**
             * Scale to a specific zoom factor (not relative)
             * @param zoomFactor
             * @param center
             */
            scaleTo: function (zoomFactor, center) {
                this.scale(zoomFactor / this.zoomFactor, center);
            },

            /**
             * Scales the element from specified center
             * @param scale
             * @param center
             */
            scale: function (scale, center) {
                scale = this.scaleZoomFactor(scale);
                this.addOffset({
                    x: (scale - 1) * (center.x + this.offset.x),
                    y: (scale - 1) * (center.y + this.offset.y)
                });
            },

            /**
             * Scales the zoom factor relative to current state
             * @param scale
             * @return the actual scale (can differ because of max min zoom factor)
             */
            scaleZoomFactor: function (scale) {
                var originalZoomFactor = this.zoomFactor;
                this.zoomFactor *= scale;
                this.zoomFactor = Math.min(this.options.maxZoom, Math.max(this.zoomFactor, this.options.minZoom));
                return this.zoomFactor / originalZoomFactor;
            },

            /**
             * Drags the element
             * @param center
             * @param lastCenter
             */
            drag: function (center, lastCenter) {
                if (lastCenter) {
                  if(this.options.lockDragAxis) {
                    // lock scroll to position that was changed the most
                    if(Math.abs(center.x - lastCenter.x) > Math.abs(center.y - lastCenter.y)) {
                      this.addOffset({
                        x: -(center.x - lastCenter.x),
                        y: 0
                      });
                    }
                    else {
                      this.addOffset({
                        y: -(center.y - lastCenter.y),
                        x: 0
                      });
                    }
                  }
                  else {
                    this.addOffset({
                      y: -(center.y - lastCenter.y),
                      x: -(center.x - lastCenter.x)
                    });
                  }
                }
            },

            /**
             * Calculates the touch center of multiple touches
             * @param touches
             * @return {Object}
             */
            getTouchCenter: function (touches) {
                return this.getVectorAvg(touches);
            },

            /**
             * Calculates the average of multiple vectors (x, y values)
             */
            getVectorAvg: function (vectors) {
                return {
                    x: vectors.map(function (v) { return v.x; }).reduce(sum) / vectors.length,
                    y: vectors.map(function (v) { return v.y; }).reduce(sum) / vectors.length
                };
            },

            /**
             * Adds an offset
             * @param offset the offset to add
             * @return return true when the offset change was accepted
             */
            addOffset: function (offset) {
                this.offset = {
                    x: this.offset.x + offset.x,
                    y: this.offset.y + offset.y
                };
            },

            sanitize: function () {
                if (this.zoomFactor < this.options.zoomOutFactor) {
                    this.zoomOutAnimation();
                } else if (this.isInsaneOffset(this.offset)) {
                    this.sanitizeOffsetAnimation();
                }
            },

            /**
             * Checks if the offset is ok with the current zoom factor
             * @param offset
             * @return {Boolean}
             */
            isInsaneOffset: function (offset) {
                var sanitizedOffset = this.sanitizeOffset(offset);
                return sanitizedOffset.x !== offset.x ||
                    sanitizedOffset.y !== offset.y;
            },

            /**
             * Creates an animation moving to a sane offset
             */
            sanitizeOffsetAnimation: function () {
                var targetOffset = this.sanitizeOffset(this.offset),
                    startOffset = {
                        x: this.offset.x,
                        y: this.offset.y
                    },
                    updateProgress = (function (progress) {
                        this.offset.x = startOffset.x + progress * (targetOffset.x - startOffset.x);
                        this.offset.y = startOffset.y + progress * (targetOffset.y - startOffset.y);
                        this.update();
                    }).bind(this);

                this.animate(
                    this.options.animationDuration,
                    this.options.animationInterval,
                    updateProgress,
                    this.swing
                );
            },

            /**
             * Zooms back to the original position,
             * (no offset and zoom factor 1)
             */
            zoomOutAnimation: function () {
                var startZoomFactor = this.zoomFactor,
                    zoomFactor = 1,
                    center = this.getCurrentZoomCenter(),
                    updateProgress = (function (progress) {
                        this.scaleTo(startZoomFactor + progress * (zoomFactor - startZoomFactor), center);
                    }).bind(this);

                this.animate(
                    this.options.animationDuration,
                    this.options.animationInterval,
                    updateProgress,
                    this.swing
                );
            },

            /**
             * Updates the aspect ratio
             */
            updateAspectRatio: function () {
                this.setContainerY(this.getContainerX() / this.getAspectRatio());
            },

            /**
             * Calculates the initial zoom factor (for the element to fit into the container)
             * @return the initial zoom factor
             */
            getInitialZoomFactor: function () {
                // use .offsetWidth instead of width()
                // because jQuery-width() return the original width but Zepto-width() will calculate width with transform.
                // the same as .height()
                return this.container[0].offsetWidth / this.el[0].offsetWidth;
            },

            /**
             * Calculates the aspect ratio of the element
             * @return the aspect ratio
             */
            getAspectRatio: function () {
                return this.el[0].offsetWidth / this.el[0].offsetHeight;
            },

            /**
             * Calculates the virtual zoom center for the current offset and zoom factor
             * (used for reverse zoom)
             * @return {Object} the current zoom center
             */
            getCurrentZoomCenter: function () {

                // uses following formula to calculate the zoom center x value
                // offset_left / offset_right = zoomcenter_x / (container_x - zoomcenter_x)
                var length = this.container[0].offsetWidth * this.zoomFactor,
                    offsetLeft  = this.offset.x,
                    offsetRight = length - offsetLeft -this.container[0].offsetWidth,
                    widthOffsetRatio = offsetLeft / offsetRight,
                    centerX = widthOffsetRatio * this.container[0].offsetWidth / (widthOffsetRatio + 1),

                // the same for the zoomcenter y
                    height = this.container[0].offsetHeight * this.zoomFactor,
                    offsetTop  = this.offset.y,
                    offsetBottom = height - offsetTop - this.container[0].offsetHeight,
                    heightOffsetRatio = offsetTop / offsetBottom,
                    centerY = heightOffsetRatio * this.container[0].offsetHeight / (heightOffsetRatio + 1);

                // prevents division by zero
                if (offsetRight === 0) { centerX = this.container[0].offsetWidth; }
                if (offsetBottom === 0) { centerY = this.container[0].offsetHeight; }

                return {
                    x: centerX,
                    y: centerY
                };
            },

            canDrag: function () {
                return !isCloseTo(this.zoomFactor, 1);
            },

            /**
             * Returns the touches of an event relative to the container offset
             * @param event
             * @return array touches
             */
            getTouches: function (event) {
                var position = this.container.offset();
                return Array.prototype.slice.call(event.touches).map(function (touch) {
                    return {
                        x: touch.pageX - position.left,
                        y: touch.pageY - position.top
                    };
                });
            },

            /**
             * Animation loop
             * does not support simultaneous animations
             * @param duration
             * @param interval
             * @param framefn
             * @param timefn
             * @param callback
             */
            animate: function (duration, interval, framefn, timefn, callback) {
                var startTime = new Date().getTime(),
                    renderFrame = (function () {
                        if (!this.inAnimation) { return; }
                        var frameTime = new Date().getTime() - startTime,
                            progress = frameTime / duration;
                        if (frameTime >= duration) {
                            framefn(1);
                            if (callback) {
                                callback();
                            }
                            this.update();
                            this.stopAnimation();
                            this.update();
                        } else {
                            if (timefn) {
                                progress = timefn(progress);
                            }
                            framefn(progress);
                            this.update();
                            setTimeout(renderFrame, interval);
                        }
                    }).bind(this);
                this.inAnimation = true;
                renderFrame();
            },

            /**
             * Stops the animation
             */
            stopAnimation: function () {
                this.inAnimation = false;
            },

            /**
             * Swing timing function for animations
             * @param p
             * @return {Number}
             */
            swing: function (p) {
                return -Math.cos(p * Math.PI) / 2  + 0.5;
            },

            getContainerX: function () {
                return this.container[0].offsetWidth;
            },

            getContainerY: function () {
                return this.container[0].offsetHeight;
            },

            setContainerY: function (y) {
                return this.container.height(y);
            },

            /**
             * Creates the expected html structure
             */
            setupMarkup: function () {
                this.container = $('<div class="pinch-zoom-container"></div>');
                this.el.before(this.container);
                this.container.append(this.el);

                this.container.css({
                    'overflow': 'hidden',
                    'position': 'relative',
                    'width': '100%',
                	'height': '100%'
                });

                // Zepto doesn't recognize `webkitTransform..` style
                this.el.css({
                    '-webkit-transform-origin': '0% 0%',
                    '-moz-transform-origin': '0% 0%',
                    '-ms-transform-origin': '0% 0%',
                    '-o-transform-origin': '0% 0%',
                    'transform-origin': '0% 0%',
                    'position': 'absolute'
                });
            },

            end: function () {
                this.hasInteraction = false;
                this.sanitize();
                this.update();
            },

            /**
             * Binds all required event listeners
             */
            bindEvents: function () {
                detectGestures(this.container.get(0), this);
                // Zepto and jQuery both know about `on`
                $(window).on('resize', this.update.bind(this));
                $(this.el).find('img').on('load', this.update.bind(this));
            },

            /**
             * Updates the css values according to the current zoom factor and offset
             */
            update: function () {

                if (this.updatePlaned) {
                    return;
                }
                this.updatePlaned = true;

                setTimeout((function () {
                    this.updatePlaned = false;
                    this.updateAspectRatio();

                    var zoomFactor = this.getInitialZoomFactor() * this.zoomFactor,
                        offsetX = -this.offset.x / zoomFactor,
                        offsetY = -this.offset.y / zoomFactor,
                        transform3d =   'scale3d('     + zoomFactor + ', '  + zoomFactor + ',1) ' +
                            'translate3d(' + offsetX    + 'px,' + offsetY    + 'px,0px)',
                        transform2d =   'scale('       + zoomFactor + ', '  + zoomFactor + ') ' +
                            'translate('   + offsetX    + 'px,' + offsetY    + 'px)',
                        removeClone = (function () {
                            if (this.clone) {
                                this.clone.remove();
                                delete this.clone;
                            }
                        }).bind(this);

                    // Scale 3d and translate3d are faster (at least on ios)
                    // but they also reduce the quality.
                    // PinchZoom uses the 3d transformations during interactions
                    // after interactions it falls back to 2d transformations
                    if (!this.options.use2d || this.hasInteraction || this.inAnimation) {
                        this.is3d = true;
                        removeClone();
                        this.el.css({
                            '-webkit-transform':  transform3d,
                            '-o-transform':       transform2d,
                            '-ms-transform':      transform2d,
                            '-moz-transform':     transform2d,
                            'transform':        transform3d
                        });
                    } else {

                        // When changing from 3d to 2d transform webkit has some glitches.
                        // To avoid this, a copy of the 3d transformed element is displayed in the
                        // foreground while the element is converted from 3d to 2d transform
                        if (this.is3d) {
                            this.clone = this.el.clone();
                            this.clone.css('pointer-events', 'none');
                            this.clone.appendTo(this.container);
                            setTimeout(removeClone, 200);
                        }
                        this.el.css({
                            '-webkit-transform':  transform2d,
                            '-o-transform':       transform2d,
                            '-ms-transform':      transform2d,
                            '-moz-transform':     transform2d,
                            'transform':        transform2d
                        });
                        this.is3d = false;
                    }
                }).bind(this), 0);
            },

            /**
             * Enables event handling for gestures
             */
            enable: function() {
              this.enabled = true;
            },

            /**
             * Disables event handling for gestures
             */
            disable: function() {
              this.enabled = false;
            }
        };

        var detectGestures = function (el, target) {
            var interaction = null,
                fingers = 0,
                lastTouchStart = null,
                startTouches = null,

                setInteraction = function (newInteraction, event) {
                    if (interaction !== newInteraction) {

                        if (interaction && !newInteraction) {
                            switch (interaction) {
                                case "zoom":
                                    target.handleZoomEnd(event);
                                    break;
                                case 'drag':
                                    target.handleDragEnd(event);
                                    break;
                            }
                        }

                        switch (newInteraction) {
                            case 'zoom':
                                target.handleZoomStart(event);
                                break;
                            case 'drag':
                                target.handleDragStart(event);
                                break;
                        }
                    }
                    interaction = newInteraction;
                },

                updateInteraction = function (event) {
                    if (fingers === 2) {
                        setInteraction('zoom');
                    } else if (fingers === 1 && target.canDrag()) {
                        setInteraction('drag', event);
                    } else {
                        setInteraction(null, event);
                    }
                },

                targetTouches = function (touches) {
                    return Array.prototype.slice.call(touches).map(function (touch) {
                        return {
                            x: touch.pageX,
                            y: touch.pageY
                        };
                    });
                },

                getDistance = function (a, b) {
                    var x, y;
                    x = a.x - b.x;
                    y = a.y - b.y;
                    return Math.sqrt(x * x + y * y);
                },

                calculateScale = function (startTouches, endTouches) {
                    var startDistance = getDistance(startTouches[0], startTouches[1]),
                        endDistance = getDistance(endTouches[0], endTouches[1]);
                    return endDistance / startDistance;
                },

                cancelEvent = function (event) {
                    event.stopPropagation();
                    event.preventDefault();
                },

                detectDoubleTap = function (event) {
                    var time = (new Date()).getTime();

                    if (fingers > 1) {
                        lastTouchStart = null;
                    }

                    if (time - lastTouchStart < 300) {
                        cancelEvent(event);

                        target.handleDoubleTap(event);
                        switch (interaction) {
                            case "zoom":
                                target.handleZoomEnd(event);
                                break;
                            case 'drag':
                                target.handleDragEnd(event);
                                break;
                        }
                    }

                    if (fingers === 1) {
                        lastTouchStart = time;
                    }
                },
                firstMove = true;

            el.addEventListener('touchstart', function (event) {
                if(target.enabled) {
                    firstMove = true;
                    fingers = event.touches.length;
                    detectDoubleTap(event);
                }
            });

            el.addEventListener('touchmove', function (event) {
                if(target.enabled) {
                    if (firstMove) {
                        updateInteraction(event);
                        if (interaction) {
                            cancelEvent(event);
                        }
                        startTouches = targetTouches(event.touches);
                    } else {
                        switch (interaction) {
                            case 'zoom':
                                target.handleZoom(event, calculateScale(startTouches, targetTouches(event.touches)));
                                break;
                            case 'drag':
                                target.handleDrag(event);
                                break;
                        }
                        if (interaction) {
                            cancelEvent(event);
                            target.update();
                        }
                    }

                    firstMove = false;
                }
            });

            el.addEventListener('touchend', function (event) {
                if(target.enabled) {
                    fingers = event.touches.length;
                    updateInteraction(event);
                }
            });
        };

        return PinchZoom;
    };

    if (typeof define !== 'undefined' && define.amd) {
        define(['jquery'], function ($) {
            return definePinchZoom($);
        });
    } else {
        window.RTP = window.RTP || {};
        window.RTP.PinchZoom = definePinchZoom(window.$);
    }
}).call(this);
; 
;
/**
 * 微信端图片上传控件
 * @author Happy
 * @param $
 */
(function($){

	
	/**
	 * 控件初始化
	 */
	function _init(t){
		var options = _parseOptions(t);
		options.value = options.value || '';
		
		var images = options.value ? JSON.parse(options.value) :[];
		var showBtn = !(options.readonly && options.readOnlyShowValOnly == "true");
		var layoutType = options._layoutType;
		var horizontalClass = "";
		
		if(layoutType == LayoutType_Horizontal){
			horizontalClass = "flexbox";
		}
		var data = {
				id : options.id,
				discript : options.discript,
				discription : options.discription,
				name : options.name,
				value : options.value,
				readonly : options.readonly,
				showBtn : showBtn,
				contextPath : contextPath,
				list : images,
				horizontalClass : horizontalClass
		};
		
		var $html = $(template("imageUpload-tmpl", data));
		$html.replaceAll(t);
		$("body").append($(template("imageUploadPrev-tmpl", data)));
		return $html;
		
	}
	
	
	/**
	 * 事件绑定
	 */
	function _bindEvents(t){
		var panel = t.data("weixinImageUpload").panel;
		var options = _parseOptions(t);
		var $bigView = $("body").find(".preview-panel[_pid='"+t.attr("id")+"']");
		if(!(options.readonly)){
			//上传图片
			panel.on("click", ".btn-upload", function(){
				var options = t.data("weixinImageUpload").options;
				var vf = $("#"+options.id);
				var json = vf.val();
				var images = json? JSON.parse(json):[];
				if(images.length>=options.limitnumber){
					alert('最大只能上传'+options.limitnumber+'张图片哦，不能再继续添加啦！');
					return;
				}

                //判断接口
                var ua = window.navigator.userAgent;
//indexOf() 方法可返回某个指定的字符串值在字符串中首次出现的位置
                if(ua.indexOf("myApps") >= 0){
					_uploadImageWithNative(t);//手机系统原生上传接口
				}else{
					_chooseImage(t);//微信选择图片
				}
				
			});
			//删除
			$bigView.on("click", ".btn-delete-popup", function(){
				jQuery.confirm({
					trueCall:function(){
						var name = $bigView.find(".preview-item").data("name");
						_removeImage(t,name);
						$bigView.removeClass("active");
					},
					falseCall:function(){
						
					}
				})
			});
		}

		//预览图片
		panel.on("click", ".image-item", function(){
			var pid = $(this).parent().siblings("input").attr("id");
			var src = $(this).find("img").attr("src");
			var name = $(this).data("name");
			$bigView.find(".preview-item").attr("src",src);
			$bigView.find(".preview-item").data("name",name);
			$bigView.addClass("active");
			$("div.lookImg").each(function () {
  				new RTP.PinchZoom($(this), {});
  			});
		});
		
		//退出预览
		$bigView.on("click", ".btn-close", function(){
			$bigView.removeClass("active");
		});
		
	}
	
	function _onImageItemClick(item){
		var src = item.find("img").attr("src");
		var name = item.data("name");
		panel.find(".preview-item").attr("src",src);
		panel.find(".preview-item").data("name",name);
		panel.find(".preview-panel").addClass("active");
	}
	
	/**
	 * 解析控件参数
	 */
	function _parseOptions(t){
		var options = {};
		options.id = t.attr("id");
		options.name = t.attr("name");
		options.discript = t.attr("discript");
		options.discription = HTMLDencode(t.attr("discript"))? HTMLDencode(t.attr("discript")):options.name;
		options.value = t.attr("value");
		options.limitnumber = parseInt(t.attr("limitNumber"));
		options.maxsize = t.attr("maxsize");
		options.refreshOnChanged = t.attr("refreshOnChanged");
		options.readOnlyShowValOnly = t.attr("readOnlyShowValOnly");
		options.readonly = (t.attr("disabled") == 'disabled');
		options.filesavemode = t.attr("filesavemode");
		options.path = t.attr("path");
		options._layoutType = t.attr("_layoutType");
		return options;
	}
	
	
	function _chooseImage(t){
		var panel = t.data("weixinImageUpload").panel;
		var options = t.data("weixinImageUpload").options;
		
		var vf = $("#"+options.id);
		var json = vf.val();
		var images = json? JSON.parse(json):[];
		var count = options.limitnumber - images.length;
		
		var _wx = top.wx ? top.wx : wx;
		 _wx.chooseImage({
			 count: count,
			 sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
			 sourceType: ['album','camera'], // 可以指定来源是相册还是相机，默认二者都有
		     success: function (res) {
		        var localIds = res.localIds;
		        setTimeout(function(){
		        	_uploadImage(t,panel,_wx,localIds);
		        }, 200);
		      }
		    });
	}
	
	function _uploadImage(t,panel,_wx,localIds){
		var options = t.data("weixinImageUpload").options;
		var vf = $("#"+options.id);
		var json = vf.val();
		var images = json? JSON.parse(json):[];
		if(images.length>=options.limitnumber){
			alert('最大只能上传'+options.limitnumber+'张图片哦，不能再继续添加啦！');
			return;
		}
		var localId = localIds.pop();
		 _wx.uploadImage({
		        localId: localId,
		        isShowProgressTips: 1,// 默认为1，显示进度提示
		        success: function (res) {
		          var serverId = res.serverId;
		          var folder = options.filesavemode=="01"? options.path : "";//自定义存储路径
		          $.ajax({
		        	  url:contextPath+"/portal/weixin/jsapi/upload.action",
		        	  async:false,
		        	  type:"get",
		        	  data:{"serverId":serverId,"folder":folder},
		        	  dataType:"json",
		        	  success:function(result){
				          if(result.status==1){
				        	  var path = result.data;
				        	  var name = result.data.substring(result.data.lastIndexOf("/")+1,result.data.length);
				        	  var imageItem = $('<a data-ignore="push" class="image-item" data-name="'+name+'" data-path="'+path+'" ><img src="'+localId+'"/></a>');
				        	  imageItem.on("click",function(){
				        		  	var src = $(this).find("img").attr("src");
				      				var name = $(this).data("name");
					      			panel.find(".preview-item").attr("src",src);
					      			panel.find(".preview-item").data("name",name);
					      			panel.find(".preview-panel").addClass("active");
				        	  });
				        	  panel.find(".btn-upload").before(imageItem);
				        	  try {
				        		  _addImage(t,{name:name,path:path});
				        	  } catch (e) {
				        		  alert(e.stack.toString());
				        	  }
				        	  if(localIds.length>0){
				        		  _uploadImage(t,panel,_wx,localIds);
				        	  }
				          }
				       },
				       error : function (XMLHttpRequest, textStatus, errorThrown) {
				    	    // 通常 textStatus 和 errorThrown 之中
				    	    // 只有一个会包含信息
				    	    //this; // 调用本次AJAX请求时传递的options参数
				    	}
		          });
		        },
		        fail: function (res) {
		          alert("网络异常，请再次尝试！");
		        }
		      });
	}
	
	function _uploadImageWithNative(t){
		var panel = t.data("weixinImageUpload").panel;
		var options = t.data("weixinImageUpload").options;
		
		var vf = $("#"+options.id);
		var json = vf.val();
		var images = json? JSON.parse(json):[];
		var count = options.limitnumber - images.length;
		var appId = $(t).attr("application");

        var _nativeAPI = top.nativeAPI ? top.nativeAPI : nativeAPI;
		_nativeAPI.upload({
			fileSaveMode: '00',//存盘模式，默认值‘00’ 
			path: 'ITEM_PATH',//存盘路径，默认值‘ITEM_PATH’ 
			fieldId: options.id,//表单控件id 
			applicationId: appId,//软件应用id 
			count: count, // 文件数量，默认9，当文件数量1时，仅允许选择一个文件
			sourceType: ['album'],  //['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有
			success: function (res) {
				var datas = JSON.parse(res);
				for (var i = 0; i < datas.length; i++) { 
					var path = datas[i].path; // 路径url 
					var name = datas[i].name; // 文件名称 
					var size = datas[i].size; // 文件大小
					var type = datas[i].type; // 文件类型（拓展名） 
					var imageItem = $('<a data-ignore="push" class="image-item" data-name="'+name+'" data-path="'+path+'" ><img src="'+ contextPath + path +'"/></a>');
					imageItem.on("click",function(){
						var src = $(this).find("img").attr("src");
						var name = $(this).data("name");
						panel.find(".preview-item").attr("src",src);
						panel.find(".preview-item").data("name",name);
						panel.find(".preview-panel").addClass("active");
					});
					panel.find(".btn-upload").before(imageItem);
					try {
						_addImage(t,{name:name,path:path});
					} catch (e) {
						alert(e.stack.toString());
					}
				} 
			} 
		})
	}
	
	function _addImage(t,data){
		var options = t.data("weixinImageUpload").options;
		var vf = $("#"+options.id);
		var json = vf.val();
		var images = json? JSON.parse(json):[];
		images.push(data);
		vf.val(JSON.stringify(images));
	}
	
	function _removeImage(t,name){
		var state = t.data("weixinImageUpload");
		var panel =state.panel;
		var options = state.options;
		panel.find(".image-item").each(function(){
			var $this = $(this);
			if($this.data("name")==name){
				$this.remove();
				var vf = $("#"+options.id);
				var images = JSON.parse(vf.val());
				for(var i=0;i<images.length;i++){
					if(images[i].name==name){
						images.splice(i,1);
						vf.val(JSON.stringify(images));
						break;
					}
				}
			}
		});
	}
	
	
	
	$.fn.obpmWeixinImageUpload = function(options, param){
		if(typeof options=="string"){
			return $.fn.obpmWeixinImageUpload.method[options](this,param);
		}
		options = options || {};
		return this.each(function(){
			var t = $(this);
			
			var state = t.data("weixinImageUpload");
			if(state){
				$.extend(state.options,options);
			}else{
				var r =_init(t);
				state = t.data('weixinImageUpload', {
					options: $.extend({}, $.fn.obpmWeixinImageUpload.defaults, _parseOptions(t), options),
					panel: r
				});
				_bindEvents(t);
			}
		});
	},
	
	$.fn.obpmWeixinImageUpload.defaults = {
			id:'',
			name:'',
			value:null,
			discription:'',
			limitnumber:10,
			maxsize:10240,
			path:"ITEM_PATH",
			refreshOnChanged:null,
			readonly:false
			
	},
	
	$.fn.obpmWeixinImageUpload.method= {
			
		setValue:function(jq,value){
			
		},
		getValue:function(jq){
			jq.each(function(){
				//nothing
			});
		}
	}
	
})(jQuery);
; 
;
/**
 * 微信录音控件
 * @author Happy
 * @param $
 */
(function($){
	
	/**
	 * 显示类型. 分别：1.只读(READONLY)2.修改(MODIFY),3.隐藏(HIDDEN),4.禁用(DISABLED)
	 */
	var DisplayType = {
			READONLY:1,//只读
			MODIFY:2,//修改
			HIDDEN:3,//隐藏
			DISABLED:4 //禁用
	};
	var timer = "";
	
	/**
	 * 控件初始化
	 */
	function _init(t){
		var options = _parseOptions(t);
		var name = options.name;
		var layoutType = options._layoutType;
		var discript = options.discript ? options.discript : name;
		var path = "",
			count = 0,
			hasValue = false,
			style = "";
			delStyle = "",
			playStyle = ";display:none;",
			horizontalClass = "",
			isReadonly = false;

		if(layoutType == LayoutType_Horizontal){
			horizontalClass = "flexbox";
		}	
		if(options.displayType ==DisplayType.READONLY || options.displayType ==DisplayType.DISABLED){
			style = ";display:none;";
			delStyle = ";display:none;";
			isReadonly = true;
		}
		if(options.value && options.value.length>0){
			style = ";display:none;";
			playStyle = "";
			hasValue = true;
			var voice = JSON.parse(options.value);
			path = contextPath + voice.path;
			count = voice.count ? voice.count : 0;
		}
		
		var data = {
				id : options.id,
				name : name,
				path : path,
				count : count,
				style : style,
				delStyle : delStyle,
				hasValue : hasValue,
				playStyle : playStyle,
				discript : discript,
				isReadonly : isReadonly,
				horizontalClass : horizontalClass
		};

		var $panel = $(template("recordPanel-tmpl", data));
		$bigRecBox = $(template("recordControl-tmpl", data));
		
		ajaxPage.getCurPage().append($bigRecBox);
		if(hasValue){
			if(isiOS){
				$panel.find("audio").load();
			}
		}
		
		$panel.insertAfter(t);
		
		return $panel;
	}
	
	
	/**
	 * 事件绑定
	 */
    function _bindEvents(t){
        var panel = t.data("weixinRecord").panel;
        var options = _parseOptions(t);
        var $bigRecBox = $("#wxRec_" + t.attr("id"));
        //触发录音
        panel.find(".startRecord").on("click",function(e){
            var options = t.data("weixinRecord").options;

            //判断接口
            var ua = window.navigator.userAgent;
            //indexOf() 方法可返回某个指定的字符串值在字符串中首次出现的位置
            if(ua.indexOf("myApps") >= 0) {
                _uploadRecordWithNative(t);//手机系统原生上传接口
            }else{
                _startRecord(t);//微信选择录音
                $bigRecBox.show();
                setTimeout(function(){
                    $bigRecBox.find(".recording-panel").addClass("active");
                },100);
                $bigRecBox.find(".record-play-ico").addClass("animate-play");
                timer = _getTimer(t);
                _startRecord(t,timer,$bigRecBox);
            }
        });
		
		$bigRecBox.find(".stopRecord").on("click",function(e){
			$bigRecBox.find(".recording-panel").removeClass("active");
			setTimeout(function(){
				$bigRecBox.hide();
			},1000);
			clearInterval(timer);
			t.data("timer",null);
			_stopRecord(t);
		});
		
		panel.find(".sound-play-box").on("click",function(e){
			if($(this).find(".sound-stop").size() > 0){
				_playVoice(t);
			}else if($(this).find(".sound-play").size() > 0){
				_stopVoice(t);
			}
		});

		panel.find(".btn-sound-delete").on("click",function(e){
			panel.find(".sound-delete-box").show().addClass("animated bounceIn");
		});
		panel.find(".btn-delete").on("click",function(e){
			_removeRecord(t);
		});
		panel.find(".btn-cancel").on("click",function(e){
			panel.find(".sound-delete-box").hide();
		});
		
	}
	
	/**
	 * 解析控件参数
	 */
	function _parseOptions(t){
		var options = {};
		options.id = t.attr("id");
		options.name = t.attr("name");
		options.discript = HTMLDencode(t.data("discription"))? HTMLDencode(t.data("discription")):options.name;
		options.value = t.val();
		options.displayType = t.data("displayType");
		options._layoutType = t.attr("_layoutType");
		return options;
	}
	
	/**
	 *	开始微信录音
	 */
	function _startRecord(t,timer,$bigRecBox){
		var _wx = top.wx ? top.wx : wx;
		_wx.startRecord();
		_wx.onVoiceRecordEnd({
			
		    // 录音时间超过一分钟没有停止的时候会执行 complete 回调
		    complete: function (res) {
		    	 var localId = res.localId;
		    	
		    	$bigRecBox.find(".recording-panel").removeClass("active");
				setTimeout(function(){
					$bigRecBox.hide();
				},1000);
				clearInterval(timer);
				t.data("timer",null);
		    	 
			    _uploadVoice(t,_wx,localId);
		    }
		});
	}
	
	/**
	 *	停止微信录音
	 */
	function _stopRecord(t){
		var _wx = top.wx ? top.wx : wx;
		_wx.stopRecord({
		    success: function (res) {
		        var localId = res.localId;
		        _uploadVoice(t,_wx,localId);
		    }
		});
	}
	/**
	 * 上传录音
	 */
	function _uploadVoice(t,_wx,localId){
		 _wx.uploadVoice({
	            localId: localId, // 需要上传的音频的本地ID，由stopRecord接口获得
	            isShowProgressTips: 1,// 默认为1，显示进度提示
	                success: function (res) {
	                var serverId = res.serverId; // 返回音频的服务器端ID
	                $.ajax({
			        	  url:contextPath+"/portal/weixin/jsapi/upload.action",
			        	  async:false,
			        	  type:"get",
			        	  data:{"serverId":serverId,"folder":"voice","fileType":"amr"},
			        	  dataType:"json",
			        	  success:function(result){
				    		  if(result.status==1){
					        	  var $bigRecBox = $("#wxRec_" + t.attr("id"));
					        	  var path = result.data.replace(".amr",".mp3");
					        	  var name = result.data.substring(result.data.lastIndexOf("/")+1,result.data.length);
					        	  var vioceItem = $('<audio><source src="'+contextPath+path+'" type="audio/mpeg" /></audio>');
					        	  t.data("voice",{"localId":localId,"path":path});
					      		  var panel = t.data("weixinRecord").panel;
					        	 panel.append(vioceItem);
					        	 _addRecord(t,{"path":path,"count":$bigRecBox.find(".time-total").text()});
					        	 $bigRecBox.find(".time-total").text(0);
					          }
					       }
			          });
	            },
	            fail: function (res) {
			          alert("网络异常，请再次尝试！");
		        }
	        });
	}

    //手机原生接口
    function _uploadRecordWithNative(t){
        var panel = t.data("weixinRecord").panel;
        var options = t.data("weixinRecord").options;

        var _nativeAPI = top.nativeAPI ? top.nativeAPI : nativeAPI;
        _nativeAPI.startRecord({
            success: function (res) {
                var datas = JSON.parse(res);
                var path = datas.path;//.replace(".amr",".mp3");//音频文件路径
                var size = datas.size;//文件大小
                var length = datas.len;//音频文件时长（秒）
                var $bigRecBox = $("#wxRec_" + t.attr("id"));
                var name = datas.path.substring(datas.path.lastIndexOf("/")+1,datas.path.length);
                var vioceItem = $('<audio><source src="'+contextPath+path+'" type="audio/mpeg" /></audio>');
                var panel = t.data("weixinRecord").panel;
                panel.append(vioceItem);
                _addRecord(t,{"path":path,"count":$bigRecBox.find(".time-total").text()});
                $bigRecBox.find(".time-total").text(0);
            }
        });
    }

	/**
	 * 播放录音
	 */
	function _playVoice(t){
		var panel = t.data("weixinRecord").panel;
		panel.find(".play-ico").removeClass("sound-stop").addClass("sound-play");
		var voice = t.data("voice");
		var count = JSON.parse(t.val()).count;
		if(voice){
			var _wx = top.wx ? top.wx : wx;
			_wx.playVoice({
			    localId: voice.localId // 需要播放的音频的本地ID，由stopRecord接口获得
			});
		}else{
			var panel = t.data("weixinRecord").panel;
			panel.find("audio")[0].play();
			
		}
		setTimeout(function(){
			panel.find(".play-ico").removeClass("sound-play").addClass("sound-stop");
		},count*1000)
	}
	/**
	 * 暂停播放录音
	 */
	function _stopVoice(t){
		var panel = t.data("weixinRecord").panel;
		panel.find(".play-ico").removeClass("sound-play").addClass("sound-stop");
		var voice = t.data("voice");
		if(voice && false){
			var _wx = top.wx ? top.wx : wx;
			_wx.stopVoice({
			    localId: voice.localId // 需要播放的音频的本地ID，由stopRecord接口获得
			});
		}else{
			panel.find("audio")[0].pause();
		}
	}
	
	/**
	 * 添加录音记录
	 */
	function _addRecord(t,data){
		var state = t.data("weixinRecord");
		var options = state.options;
		var panel = state.panel;
		var vf = $("#"+options.id);
		vf.val(JSON.stringify(data));
		var vioceItem = panel.find("audio");
		if(isiOS){
			vioceItem.load();
		}
		vioceItem.on("canplay", function(){
			panel.find(".sound-play-time").text(Math.round(this.duration)+"\"");
		});
		panel.find(".sound-play-time").text(data.count);
		panel.find(".player-panel").show();
		panel.find(".record-panel").hide();
	}
	/**
	 * 删除录音记录
	 */
	function _removeRecord(t){
		var state = t.data("weixinRecord");
		var panel =state.panel;
		var options = state.options;
		var vf = $("#"+options.id);
		vf.val("");
		panel.find(".sound-delete-box").hide();
		panel.find(".player-panel").hide();
		panel.find(".record-panel").show();
	}
	
	/**
	 * 获取录音计时器
	 */
	function _getTimer(t){
		var panel = t.data("weixinRecord").panel;
		var $bigRecBox = $("#wxRec_" + t.attr("id"));
		var timer = setInterval(function(){
				var tl = $bigRecBox.find(".time-total");
				tl.text(parseInt(tl.text())+1);
		},1000);
		return timer;
	} 
	
	$.fn.obpmWeixinRecord = function(options, param){
		
		if(typeof options=="string"){
			return $.fn.obpmWeixinRecord.method[options](this,param);
		}
		options = options || {};
		return this.each(function(){
			var t = $(this);
			var state = t.data("weixinRecord");
			if(state){
				$.extend(state.options,options);
			}else{
				var r =_init(t);
				state = t.data('weixinRecord', {
					options: $.extend({}, $.fn.obpmWeixinRecord.defaults, _parseOptions(t), options),
					panel: r
				});
				_bindEvents(t);
			}
		});
	},
	
	$.fn.obpmWeixinRecord.defaults = {
			id:'',
			name:'',
			value:'',
			discription:'',
			displayType:null
	},
	
	$.fn.obpmWeixinRecord.method= {
			
		setValue:function(jq,value){
			
		},
		getValue:function(jq){
			jq.each(function(){
				//nothing
			});
		}
	}
	
})(jQuery);
; 
;
/**
 * 二维码控件
 * @author Happy
 * @param $
 */
(function($){
	
	/**
	 * 扫码结果处理类型
	 */
	var HandleType={
			HANDLE_TYPE_TEXT : "text",//显示值
			HANDLE_TYPE_LINK : "link",//打开链接
			HANDLE_TYPE_CALLBACK_EVENT : "callback_event"//执行扫码事件回调脚本
	};
	
	
	/**
	 * 控件初始化
	 */
	function _init(t,options){
		var name = options.name;
		var discript = options.discription ? options.discription : name;
		var layoutType = options._layoutType;
		var text = "";
		var horizontalClass = "";
		if(layoutType == LayoutType_Horizontal){
			horizontalClass = "flexbox";
		}
		var data = {
				id : options.id,
				name : name,
				discript : discript,
				horizontalClass : horizontalClass
		};
		var $panel = $(template("qrcode-tmpl", data));
		
		
		switch (options.handleType) {
		case HandleType.HANDLE_TYPE_TEXT:
			text = options.value;
			break;
		case HandleType.HANDLE_TYPE_LINK:
		case HandleType.HANDLE_TYPE_CALLBACK_EVENT:
			var formId = $("input[name='formid']").val();
			if($("input[name='_templateForm']").val().length>0){
				formId = $("input[name='_templateForm']").val();
			}
			var domainId = $("input[name='domain']").val();
			var docId = $("input[name='content.id']").val();
			var fieldId = options.fieldId;
			var applicationId = $("input[name='application']").val();
			var host = options.serverHost.length==0? window.location.protocol+"//"+window.location.host+contextPath : options.serverHost;
			text = host+"/portal/document/qrcodefield/ready?domainId="+domainId+"&formId="+formId+"&docId="+docId+"&fieldId="+fieldId+"&applicationId="+applicationId+"&_randomCode="+options.randomCode;
			break;
		default:
			break;
		}
		
		var opt = {
			    // render method: 'canvas', 'image' or 'div'
			    render: 'canvas',
			    // version range somewhere in 1 .. 40
			    minVersion: 1,
			    maxVersion: 40,
			    // error correction level: 'L', 'M', 'Q' or 'H'
			    ecLevel: 'L',
			    // offset in pixel if drawn onto existing canvas
			    left: 0,
			    top: 0,
			    // size in pixel
			    size: options.size,
			    // code color or image element
			    fill: '#000',
			    // background color or image element, null for transparent background
			    background: null,
			    // content
			    text: text,
			    // corner radius relative to module width: 0.0 .. 0.5
			    radius: 0,
			    // quiet zone in modules
			    quiet: 0,
			    // modes
			    // 0: normal
			    // 1: label strip
			    // 2: label box
			    // 3: image strip
			    // 4: image box
			    mode: 0,
			    mSize: 0.1,
			    mPosX: 0.5,
			    mPosY: 0.5,
			    label: 'no label',
			    fontname: 'sans',
			    fontcolor: '#000',
			    image: null
			};
		$panel.insertAfter(t);
		$panel.find(".qrcode_canvas").qrcode(opt);
		
		return $panel;
	}
	
	
	/**
	 * 事件绑定
	 */
	function _bindEvents(t){
		var options = t.data("qrcode").options;
		if(options.handleType==HandleType.HANDLE_TYPE_CALLBACK_EVENT){
			_refreshOnCallback(t);
		}
	}
	
	function _refreshOnCallback(t){
		var options = t.data("qrcode").options;
		var docId = $("input[name='content.id']").val();
		var tid = window.setInterval(function(){
			$.get(contextPath + '/portal/document/qrcodefield/handle?action=track&_randomCode='+options.randomCode, function(data){
				  if(data=="success"){
					  window.clearInterval(tid);
					  Activity.refreshForm();
				  }
				});
		}, 5*1000);
	}
	
	/**
	 * 解析控件参数
	 */
	function _parseOptions(t){
		var options = {};
		options.id = t.attr("id");
		options.fieldId = t.data("fieldId");
		options.handleType= t.data("handleType");
		options.serverHost = t.data("serverHost");
		options.name = t.attr("name");
		options.discription = HTMLDencode(t.data("discription"))? HTMLDencode(t.data("discription")):options.name;
		options.value = t.val();
		options.refreshOnChanged = (t.data("refreshOnChanged") ? (t.data("refreshOnChanged") == 'true' || t.data("refreshOnChanged") == true) : undefined),
		options.displayType = t.data("displayType");
		options.size = t.data("size");
		options._layoutType = t.attr("_layoutType");
		
		var uuid = "";
		var len = 16;
		var chars = 'ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678';
		var maxPos = chars.length;
		for (i = 0;i<len;i++){
			uuid+=chars.charAt(Math.floor(Math.random()*maxPos));
		}
		options.randomCode = uuid;
		return options;
	}
	
	$.fn.obpmQRCodeField = function(_options, param){
		
		if(typeof _options=="string"){
			return $.fn.obpmQRCodeField.method[_options](this,param);
		}
		return this.each(function(){
			var options = _options || {};
			var t = $(this);
			var state = t.data("qrcode");
			if(state){
				$.extend(state.options,options);
			}else{
				options = $.extend({}, $.fn.obpmQRCodeField.defaults, _parseOptions(t), options);
				var r =_init(t,options);
				state = t.data('qrcode', {
					options: options,
					panel: r
				});
				_bindEvents(t);
			}
		});
	},
	
	/**
	 * 定义二维码控件默认值
	 */
	$.fn.obpmQRCodeField.defaults = {
			id:'',
			fieldId:'',
			handleType:HandleType.HANDLE_TYPE_TEXT,
			serverHost:'',
			name:'',
			value:'',
			refreshOnChanged:false,
			discription:'',
			displayType:null
	},
	/**
	 * 定义二维码控件方法
	 */
	$.fn.obpmQRCodeField.method= {
			
		setValue:function(jq,value){
			
		},
		getValue:function(jq){
			jq.each(function(){
				//nothing
			});
		}
	}
	
})(jQuery);
; 
/* jQuery.qrcode 0.12.0 - http://larsjung.de/jquery-qrcode/ - uses //github.com/kazuhikoarase/qrcode-generator (MIT) */
!function(r){"use strict";function t(t,e,n,o){function i(r,t){return r-=o,t-=o,0>r||r>=u||0>t||t>=u?!1:a.isDark(r,t)}var a=r(n,e);a.addData(t),a.make(),o=o||0;var u=a.getModuleCount(),f=a.getModuleCount()+2*o,c=function(r,t,e,n){var o=this.isDark,i=1/f;this.isDark=function(a,u){var f=u*i,c=a*i,l=f+i,g=c+i;return o(a,u)&&(r>l||f>e||t>g||c>n)}};this.text=t,this.level=e,this.version=n,this.moduleCount=f,this.isDark=i,this.addBlank=c}function e(r,e,n,o,i){n=Math.max(1,n||1),o=Math.min(40,o||40);for(var a=n;o>=a;a+=1)try{return new t(r,e,a,i)}catch(u){}}function n(r,t,e){var n=e.size,o="bold "+e.mSize*n+"px "+e.fontname,i=w("<canvas/>")[0].getContext("2d");i.font=o;var a=i.measureText(e.label).width,u=e.mSize,f=a/n,c=(1-f)*e.mPosX,l=(1-u)*e.mPosY,g=c+f,s=l+u,h=.01;1===e.mode?r.addBlank(0,l-h,n,s+h):r.addBlank(c-h,l-h,g+h,s+h),t.fillStyle=e.fontcolor,t.font=o,t.fillText(e.label,c*n,l*n+.75*e.mSize*n)}function o(r,t,e){var n=e.size,o=e.image.naturalWidth||1,i=e.image.naturalHeight||1,a=e.mSize,u=a*o/i,f=(1-u)*e.mPosX,c=(1-a)*e.mPosY,l=f+u,g=c+a,s=.01;3===e.mode?r.addBlank(0,c-s,n,g+s):r.addBlank(f-s,c-s,l+s,g+s),t.drawImage(e.image,f*n,c*n,u*n,a*n)}function i(r,t,e){w(e.background).is("img")?t.drawImage(e.background,0,0,e.size,e.size):e.background&&(t.fillStyle=e.background,t.fillRect(e.left,e.top,e.size,e.size));var i=e.mode;1===i||2===i?n(r,t,e):(3===i||4===i)&&o(r,t,e)}function a(r,t,e,n,o,i,a,u){r.isDark(a,u)&&t.rect(n,o,i,i)}function u(r,t,e,n,o,i,a,u,f,c){a?r.moveTo(t+i,e):r.moveTo(t,e),u?(r.lineTo(n-i,e),r.arcTo(n,e,n,o,i)):r.lineTo(n,e),f?(r.lineTo(n,o-i),r.arcTo(n,o,t,o,i)):r.lineTo(n,o),c?(r.lineTo(t+i,o),r.arcTo(t,o,t,e,i)):r.lineTo(t,o),a?(r.lineTo(t,e+i),r.arcTo(t,e,n,e,i)):r.lineTo(t,e)}function f(r,t,e,n,o,i,a,u,f,c){a&&(r.moveTo(t+i,e),r.lineTo(t,e),r.lineTo(t,e+i),r.arcTo(t,e,t+i,e,i)),u&&(r.moveTo(n-i,e),r.lineTo(n,e),r.lineTo(n,e+i),r.arcTo(n,e,n-i,e,i)),f&&(r.moveTo(n-i,o),r.lineTo(n,o),r.lineTo(n,o-i),r.arcTo(n,o,n-i,o,i)),c&&(r.moveTo(t+i,o),r.lineTo(t,o),r.lineTo(t,o-i),r.arcTo(t,o,t+i,o,i))}function c(r,t,e,n,o,i,a,c){var l=r.isDark,g=n+i,s=o+i,h=e.radius*i,v=a-1,d=a+1,w=c-1,m=c+1,p=l(a,c),y=l(v,w),T=l(v,c),B=l(v,m),A=l(a,m),E=l(d,m),k=l(d,c),M=l(d,w),C=l(a,w);p?u(t,n,o,g,s,h,!T&&!C,!T&&!A,!k&&!A,!k&&!C):f(t,n,o,g,s,h,T&&C&&y,T&&A&&B,k&&A&&E,k&&C&&M)}function l(r,t,e){var n,o,i=r.moduleCount,u=e.size/i,f=a;for(p&&e.radius>0&&e.radius<=.5&&(f=c),t.beginPath(),n=0;i>n;n+=1)for(o=0;i>o;o+=1){var l=e.left+o*u,g=e.top+n*u,s=u;f(r,t,e,l,g,s,n,o)}if(w(e.fill).is("img")){t.strokeStyle="rgba(0,0,0,0.5)",t.lineWidth=2,t.stroke();var h=t.globalCompositeOperation;t.globalCompositeOperation="destination-out",t.fill(),t.globalCompositeOperation=h,t.clip(),t.drawImage(e.fill,0,0,e.size,e.size),t.restore()}else t.fillStyle=e.fill,t.fill()}function g(r,t){var n=e(t.text,t.ecLevel,t.minVersion,t.maxVersion,t.quiet);if(!n)return null;var o=w(r).data("qrcode",n),a=o[0].getContext("2d");return i(n,a,t),l(n,a,t),o}function s(r){var t=w("<canvas/>").attr("width",r.size).attr("height",r.size);return g(t,r)}function h(r){return w("<img/>").attr("src",s(r)[0].toDataURL("image/png"))}function v(r){var t=e(r.text,r.ecLevel,r.minVersion,r.maxVersion,r.quiet);if(!t)return null;var n,o,i=r.size,a=r.background,u=Math.floor,f=t.moduleCount,c=u(i/f),l=u(.5*(i-c*f)),g={position:"relative",left:0,top:0,padding:0,margin:0,width:i,height:i},s={position:"absolute",padding:0,margin:0,width:c,height:c,"background-color":r.fill},h=w("<div/>").data("qrcode",t).css(g);for(a&&h.css("background-color",a),n=0;f>n;n+=1)for(o=0;f>o;o+=1)t.isDark(n,o)&&w("<div/>").css(s).css({left:l+o*c,top:l+n*c}).appendTo(h);return h}function d(r){return m&&"canvas"===r.render?s(r):m&&"image"===r.render?h(r):v(r)}var w=jQuery,m=function(){var r=document.createElement("canvas");return Boolean(r.getContext&&r.getContext("2d"))}(),p="[object Opera]"!==Object.prototype.toString.call(window.opera),y={render:"canvas",minVersion:1,maxVersion:40,ecLevel:"L",left:0,top:0,size:200,fill:"#000",background:null,text:"no text",radius:0,quiet:0,mode:0,mSize:.1,mPosX:.5,mPosY:.5,label:"no label",fontname:"sans",fontcolor:"#000",image:null};w.fn.qrcode=function(r){var t=w.extend({},y,r);return this.each(function(){"canvas"===this.nodeName.toLowerCase()?g(this,t):w(this).append(d(t))})}}(function(){var r=function(){function r(t,e){if("undefined"==typeof t.length)throw new Error(t.length+"/"+e);var n=function(){for(var r=0;r<t.length&&0==t[r];)r+=1;for(var n=new Array(t.length-r+e),o=0;o<t.length-r;o+=1)n[o]=t[o+r];return n}(),o={};return o.getAt=function(r){return n[r]},o.getLength=function(){return n.length},o.multiply=function(t){for(var e=new Array(o.getLength()+t.getLength()-1),n=0;n<o.getLength();n+=1)for(var i=0;i<t.getLength();i+=1)e[n+i]^=a.gexp(a.glog(o.getAt(n))+a.glog(t.getAt(i)));return r(e,0)},o.mod=function(t){if(o.getLength()-t.getLength()<0)return o;for(var e=a.glog(o.getAt(0))-a.glog(t.getAt(0)),n=new Array(o.getLength()),i=0;i<o.getLength();i+=1)n[i]=o.getAt(i);for(var i=0;i<t.getLength();i+=1)n[i]^=a.gexp(a.glog(t.getAt(i))+e);return r(n,0).mod(t)},o}var t=function(t,e){var o=236,a=17,l=t,g=n[e],s=null,h=0,d=null,w=new Array,m={},p=function(r,t){h=4*l+17,s=function(r){for(var t=new Array(r),e=0;r>e;e+=1){t[e]=new Array(r);for(var n=0;r>n;n+=1)t[e][n]=null}return t}(h),y(0,0),y(h-7,0),y(0,h-7),A(),B(),k(r,t),l>=7&&E(r),null==d&&(d=D(l,g,w)),M(d,t)},y=function(r,t){for(var e=-1;7>=e;e+=1)if(!(-1>=r+e||r+e>=h))for(var n=-1;7>=n;n+=1)-1>=t+n||t+n>=h||(e>=0&&6>=e&&(0==n||6==n)||n>=0&&6>=n&&(0==e||6==e)||e>=2&&4>=e&&n>=2&&4>=n?s[r+e][t+n]=!0:s[r+e][t+n]=!1)},T=function(){for(var r=0,t=0,e=0;8>e;e+=1){p(!0,e);var n=i.getLostPoint(m);(0==e||r>n)&&(r=n,t=e)}return t},B=function(){for(var r=8;h-8>r;r+=1)null==s[r][6]&&(s[r][6]=r%2==0);for(var t=8;h-8>t;t+=1)null==s[6][t]&&(s[6][t]=t%2==0)},A=function(){for(var r=i.getPatternPosition(l),t=0;t<r.length;t+=1)for(var e=0;e<r.length;e+=1){var n=r[t],o=r[e];if(null==s[n][o])for(var a=-2;2>=a;a+=1)for(var u=-2;2>=u;u+=1)-2==a||2==a||-2==u||2==u||0==a&&0==u?s[n+a][o+u]=!0:s[n+a][o+u]=!1}},E=function(r){for(var t=i.getBCHTypeNumber(l),e=0;18>e;e+=1){var n=!r&&1==(t>>e&1);s[Math.floor(e/3)][e%3+h-8-3]=n}for(var e=0;18>e;e+=1){var n=!r&&1==(t>>e&1);s[e%3+h-8-3][Math.floor(e/3)]=n}},k=function(r,t){for(var e=g<<3|t,n=i.getBCHTypeInfo(e),o=0;15>o;o+=1){var a=!r&&1==(n>>o&1);6>o?s[o][8]=a:8>o?s[o+1][8]=a:s[h-15+o][8]=a}for(var o=0;15>o;o+=1){var a=!r&&1==(n>>o&1);8>o?s[8][h-o-1]=a:9>o?s[8][15-o-1+1]=a:s[8][15-o-1]=a}s[h-8][8]=!r},M=function(r,t){for(var e=-1,n=h-1,o=7,a=0,u=i.getMaskFunction(t),f=h-1;f>0;f-=2)for(6==f&&(f-=1);;){for(var c=0;2>c;c+=1)if(null==s[n][f-c]){var l=!1;a<r.length&&(l=1==(r[a]>>>o&1));var g=u(n,f-c);g&&(l=!l),s[n][f-c]=l,o-=1,-1==o&&(a+=1,o=7)}if(n+=e,0>n||n>=h){n-=e,e=-e;break}}},C=function(t,e){for(var n=0,o=0,a=0,u=new Array(e.length),f=new Array(e.length),c=0;c<e.length;c+=1){var l=e[c].dataCount,g=e[c].totalCount-l;o=Math.max(o,l),a=Math.max(a,g),u[c]=new Array(l);for(var s=0;s<u[c].length;s+=1)u[c][s]=255&t.getBuffer()[s+n];n+=l;var h=i.getErrorCorrectPolynomial(g),v=r(u[c],h.getLength()-1),d=v.mod(h);f[c]=new Array(h.getLength()-1);for(var s=0;s<f[c].length;s+=1){var w=s+d.getLength()-f[c].length;f[c][s]=w>=0?d.getAt(w):0}}for(var m=0,s=0;s<e.length;s+=1)m+=e[s].totalCount;for(var p=new Array(m),y=0,s=0;o>s;s+=1)for(var c=0;c<e.length;c+=1)s<u[c].length&&(p[y]=u[c][s],y+=1);for(var s=0;a>s;s+=1)for(var c=0;c<e.length;c+=1)s<f[c].length&&(p[y]=f[c][s],y+=1);return p},D=function(r,t,e){for(var n=u.getRSBlocks(r,t),c=f(),l=0;l<e.length;l+=1){var g=e[l];c.put(g.getMode(),4),c.put(g.getLength(),i.getLengthInBits(g.getMode(),r)),g.write(c)}for(var s=0,l=0;l<n.length;l+=1)s+=n[l].dataCount;if(c.getLengthInBits()>8*s)throw new Error("code length overflow. ("+c.getLengthInBits()+">"+8*s+")");for(c.getLengthInBits()+4<=8*s&&c.put(0,4);c.getLengthInBits()%8!=0;)c.putBit(!1);for(;;){if(c.getLengthInBits()>=8*s)break;if(c.put(o,8),c.getLengthInBits()>=8*s)break;c.put(a,8)}return C(c,n)};return m.addData=function(r){var t=c(r);w.push(t),d=null},m.isDark=function(r,t){if(0>r||r>=h||0>t||t>=h)throw new Error(r+","+t);return s[r][t]},m.getModuleCount=function(){return h},m.make=function(){p(!1,T())},m.createTableTag=function(r,t){r=r||2,t="undefined"==typeof t?4*r:t;var e="";e+='<table style="',e+=" border-width: 0px; border-style: none;",e+=" border-collapse: collapse;",e+=" padding: 0px; margin: "+t+"px;",e+='">',e+="<tbody>";for(var n=0;n<m.getModuleCount();n+=1){e+="<tr>";for(var o=0;o<m.getModuleCount();o+=1)e+='<td style="',e+=" border-width: 0px; border-style: none;",e+=" border-collapse: collapse;",e+=" padding: 0px; margin: 0px;",e+=" width: "+r+"px;",e+=" height: "+r+"px;",e+=" background-color: ",e+=m.isDark(n,o)?"#000000":"#ffffff",e+=";",e+='"/>';e+="</tr>"}return e+="</tbody>",e+="</table>"},m.createImgTag=function(r,t){r=r||2,t="undefined"==typeof t?4*r:t;var e=m.getModuleCount()*r+2*t,n=t,o=e-t;return v(e,e,function(t,e){if(t>=n&&o>t&&e>=n&&o>e){var i=Math.floor((t-n)/r),a=Math.floor((e-n)/r);return m.isDark(a,i)?0:1}return 1})},m};t.stringToBytes=function(r){for(var t=new Array,e=0;e<r.length;e+=1){var n=r.charCodeAt(e);t.push(255&n)}return t},t.createStringToBytes=function(r,t){var e=function(){for(var e=s(r),n=function(){var r=e.read();if(-1==r)throw new Error;return r},o=0,i={};;){var a=e.read();if(-1==a)break;var u=n(),f=n(),c=n(),l=String.fromCharCode(a<<8|u),g=f<<8|c;i[l]=g,o+=1}if(o!=t)throw new Error(o+" != "+t);return i}(),n="?".charCodeAt(0);return function(r){for(var t=new Array,o=0;o<r.length;o+=1){var i=r.charCodeAt(o);if(128>i)t.push(i);else{var a=e[r.charAt(o)];"number"==typeof a?(255&a)==a?t.push(a):(t.push(a>>>8),t.push(255&a)):t.push(n)}}return t}};var e={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},n={L:1,M:0,Q:3,H:2},o={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},i=function(){var t=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],n=1335,i=7973,u=21522,f={},c=function(r){for(var t=0;0!=r;)t+=1,r>>>=1;return t};return f.getBCHTypeInfo=function(r){for(var t=r<<10;c(t)-c(n)>=0;)t^=n<<c(t)-c(n);return(r<<10|t)^u},f.getBCHTypeNumber=function(r){for(var t=r<<12;c(t)-c(i)>=0;)t^=i<<c(t)-c(i);return r<<12|t},f.getPatternPosition=function(r){return t[r-1]},f.getMaskFunction=function(r){switch(r){case o.PATTERN000:return function(r,t){return(r+t)%2==0};case o.PATTERN001:return function(r,t){return r%2==0};case o.PATTERN010:return function(r,t){return t%3==0};case o.PATTERN011:return function(r,t){return(r+t)%3==0};case o.PATTERN100:return function(r,t){return(Math.floor(r/2)+Math.floor(t/3))%2==0};case o.PATTERN101:return function(r,t){return r*t%2+r*t%3==0};case o.PATTERN110:return function(r,t){return(r*t%2+r*t%3)%2==0};case o.PATTERN111:return function(r,t){return(r*t%3+(r+t)%2)%2==0};default:throw new Error("bad maskPattern:"+r)}},f.getErrorCorrectPolynomial=function(t){for(var e=r([1],0),n=0;t>n;n+=1)e=e.multiply(r([1,a.gexp(n)],0));return e},f.getLengthInBits=function(r,t){if(t>=1&&10>t)switch(r){case e.MODE_NUMBER:return 10;case e.MODE_ALPHA_NUM:return 9;case e.MODE_8BIT_BYTE:return 8;case e.MODE_KANJI:return 8;default:throw new Error("mode:"+r)}else if(27>t)switch(r){case e.MODE_NUMBER:return 12;case e.MODE_ALPHA_NUM:return 11;case e.MODE_8BIT_BYTE:return 16;case e.MODE_KANJI:return 10;default:throw new Error("mode:"+r)}else{if(!(41>t))throw new Error("type:"+t);switch(r){case e.MODE_NUMBER:return 14;case e.MODE_ALPHA_NUM:return 13;case e.MODE_8BIT_BYTE:return 16;case e.MODE_KANJI:return 12;default:throw new Error("mode:"+r)}}},f.getLostPoint=function(r){for(var t=r.getModuleCount(),e=0,n=0;t>n;n+=1)for(var o=0;t>o;o+=1){for(var i=0,a=r.isDark(n,o),u=-1;1>=u;u+=1)if(!(0>n+u||n+u>=t))for(var f=-1;1>=f;f+=1)0>o+f||o+f>=t||(0!=u||0!=f)&&a==r.isDark(n+u,o+f)&&(i+=1);i>5&&(e+=3+i-5)}for(var n=0;t-1>n;n+=1)for(var o=0;t-1>o;o+=1){var c=0;r.isDark(n,o)&&(c+=1),r.isDark(n+1,o)&&(c+=1),r.isDark(n,o+1)&&(c+=1),r.isDark(n+1,o+1)&&(c+=1),(0==c||4==c)&&(e+=3)}for(var n=0;t>n;n+=1)for(var o=0;t-6>o;o+=1)r.isDark(n,o)&&!r.isDark(n,o+1)&&r.isDark(n,o+2)&&r.isDark(n,o+3)&&r.isDark(n,o+4)&&!r.isDark(n,o+5)&&r.isDark(n,o+6)&&(e+=40);for(var o=0;t>o;o+=1)for(var n=0;t-6>n;n+=1)r.isDark(n,o)&&!r.isDark(n+1,o)&&r.isDark(n+2,o)&&r.isDark(n+3,o)&&r.isDark(n+4,o)&&!r.isDark(n+5,o)&&r.isDark(n+6,o)&&(e+=40);for(var l=0,o=0;t>o;o+=1)for(var n=0;t>n;n+=1)r.isDark(n,o)&&(l+=1);var g=Math.abs(100*l/t/t-50)/5;return e+=10*g},f}(),a=function(){for(var r=new Array(256),t=new Array(256),e=0;8>e;e+=1)r[e]=1<<e;for(var e=8;256>e;e+=1)r[e]=r[e-4]^r[e-5]^r[e-6]^r[e-8];for(var e=0;255>e;e+=1)t[r[e]]=e;var n={};return n.glog=function(r){if(1>r)throw new Error("glog("+r+")");return t[r]},n.gexp=function(t){for(;0>t;)t+=255;for(;t>=256;)t-=255;return r[t]},n}(),u=function(){var r=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],t=function(r,t){var e={};return e.totalCount=r,e.dataCount=t,e},e={},o=function(t,e){switch(e){case n.L:return r[4*(t-1)+0];case n.M:return r[4*(t-1)+1];case n.Q:return r[4*(t-1)+2];case n.H:return r[4*(t-1)+3];default:return void 0}};return e.getRSBlocks=function(r,e){var n=o(r,e);if("undefined"==typeof n)throw new Error("bad rs block @ typeNumber:"+r+"/errorCorrectLevel:"+e);for(var i=n.length/3,a=new Array,u=0;i>u;u+=1)for(var f=n[3*u+0],c=n[3*u+1],l=n[3*u+2],g=0;f>g;g+=1)a.push(t(c,l));return a},e}(),f=function(){var r=new Array,t=0,e={};return e.getBuffer=function(){return r},e.getAt=function(t){var e=Math.floor(t/8);return 1==(r[e]>>>7-t%8&1)},e.put=function(r,t){for(var n=0;t>n;n+=1)e.putBit(1==(r>>>t-n-1&1))},e.getLengthInBits=function(){return t},e.putBit=function(e){var n=Math.floor(t/8);r.length<=n&&r.push(0),e&&(r[n]|=128>>>t%8),t+=1},e},c=function(r){var n=e.MODE_8BIT_BYTE,o=t.stringToBytes(r),i={};return i.getMode=function(){return n},i.getLength=function(r){return o.length},i.write=function(r){for(var t=0;t<o.length;t+=1)r.put(o[t],8)},i},l=function(){var r=new Array,t={};return t.writeByte=function(t){r.push(255&t)},t.writeShort=function(r){t.writeByte(r),t.writeByte(r>>>8)},t.writeBytes=function(r,e,n){e=e||0,n=n||r.length;for(var o=0;n>o;o+=1)t.writeByte(r[o+e])},t.writeString=function(r){for(var e=0;e<r.length;e+=1)t.writeByte(r.charCodeAt(e))},t.toByteArray=function(){return r},t.toString=function(){var t="";t+="[";for(var e=0;e<r.length;e+=1)e>0&&(t+=","),t+=r[e];return t+="]"},t},g=function(){var r=0,t=0,e=0,n="",o={},i=function(r){n+=String.fromCharCode(a(63&r))},a=function(r){if(0>r);else{if(26>r)return 65+r;if(52>r)return 97+(r-26);if(62>r)return 48+(r-52);if(62==r)return 43;if(63==r)return 47}throw new Error("n:"+r)};return o.writeByte=function(n){for(r=r<<8|255&n,t+=8,e+=1;t>=6;)i(r>>>t-6),t-=6},o.flush=function(){if(t>0&&(i(r<<6-t),r=0,t=0),e%3!=0)for(var o=3-e%3,a=0;o>a;a+=1)n+="="},o.toString=function(){return n},o},s=function(r){var t=r,e=0,n=0,o=0,i={};i.read=function(){for(;8>o;){if(e>=t.length){if(0==o)return-1;throw new Error("unexpected end of file./"+o)}var r=t.charAt(e);if(e+=1,"="==r)return o=0,-1;r.match(/^\s$/)||(n=n<<6|a(r.charCodeAt(0)),o+=6)}var i=n>>>o-8&255;return o-=8,i};var a=function(r){if(r>=65&&90>=r)return r-65;if(r>=97&&122>=r)return r-97+26;if(r>=48&&57>=r)return r-48+52;if(43==r)return 62;if(47==r)return 63;throw new Error("c:"+r)};return i},h=function(r,t){var e=r,n=t,o=new Array(r*t),i={};i.setPixel=function(r,t,n){o[t*e+r]=n},i.write=function(r){r.writeString("GIF87a"),r.writeShort(e),r.writeShort(n),r.writeByte(128),r.writeByte(0),r.writeByte(0),r.writeByte(0),r.writeByte(0),r.writeByte(0),r.writeByte(255),r.writeByte(255),r.writeByte(255),r.writeString(","),r.writeShort(0),r.writeShort(0),r.writeShort(e),r.writeShort(n),r.writeByte(0);var t=2,o=u(t);r.writeByte(t);for(var i=0;o.length-i>255;)r.writeByte(255),r.writeBytes(o,i,255),i+=255;r.writeByte(o.length-i),r.writeBytes(o,i,o.length-i),r.writeByte(0),r.writeString(";")};var a=function(r){var t=r,e=0,n=0,o={};return o.write=function(r,o){if(r>>>o!=0)throw new Error("length over");for(;e+o>=8;)t.writeByte(255&(r<<e|n)),o-=8-e,r>>>=8-e,n=0,e=0;n=r<<e|n,e+=o},o.flush=function(){e>0&&t.writeByte(n)},o},u=function(r){for(var t=1<<r,e=(1<<r)+1,n=r+1,i=f(),u=0;t>u;u+=1)i.add(String.fromCharCode(u));i.add(String.fromCharCode(t)),i.add(String.fromCharCode(e));var c=l(),g=a(c);g.write(t,n);var s=0,h=String.fromCharCode(o[s]);for(s+=1;s<o.length;){var v=String.fromCharCode(o[s]);s+=1,i.contains(h+v)?h+=v:(g.write(i.indexOf(h),n),i.size()<4095&&(i.size()==1<<n&&(n+=1),i.add(h+v)),h=v)}return g.write(i.indexOf(h),n),g.write(e,n),g.flush(),c.toByteArray()},f=function(){var r={},t=0,e={};return e.add=function(n){if(e.contains(n))throw new Error("dup key:"+n);r[n]=t,t+=1},e.size=function(){return t},e.indexOf=function(t){return r[t]},e.contains=function(t){return"undefined"!=typeof r[t]},e};return i},v=function(r,t,e,n){for(var o=h(r,t),i=0;t>i;i+=1)for(var a=0;r>a;a+=1)o.setPixel(a,i,e(a,i));var u=l();o.write(u);for(var f=g(),c=u.toByteArray(),s=0;s<c.length;s+=1)f.writeByte(c[s]);f.flush();var v="";return v+="<img",v+=' src="',v+="data:image/gif;base64,",v+=f,v+='"',v+=' width="',v+=r,v+='"',v+=' height="',v+=t,v+='"',n&&(v+=' alt="',v+=n,v+='"'),v+="/>"};return t}();return function(r){"function"==typeof define&&define.amd?define([],r):"object"==typeof exports&&(module.exports=r())}(function(){return r}),!function(r){r.stringToBytes=function(r){function t(r){for(var t=[],e=0;e<r.length;e++){var n=r.charCodeAt(e);128>n?t.push(n):2048>n?t.push(192|n>>6,128|63&n):55296>n||n>=57344?t.push(224|n>>12,128|n>>6&63,128|63&n):(e++,n=65536+((1023&n)<<10|1023&r.charCodeAt(e)),t.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n))}return t}return t(r)}}(r),r}());; 
(function($) {
	var isNoDeleteFile = true;
	var isReloadFile = false;
	map = {};

	function FMFileInfo(file) {
		var webIndex = file.path.lastIndexOf("/");
		var urlIndex = file.path.lastIndexOf("_/uploads");

		this.webPath = file.path;
		if (urlIndex >= 0) {
			this.webPath = file.path.substring(urlIndex + 1);
		}

		this.realName = file.path.substring(webIndex + 1, file.path.length);
		this.showName = file.name;
		this.url = contextPath + this.webPath;
	}

	function File(name, path) {
		this.name = name;
		this.path = path;
	}

	function refreshUploadListSub(fileFullName, uploadListId, readonly,
			refresh, applicationid, subGridView, disabled) {
		var $uploadList = $("#" + uploadListId);
		$uploadList.html(''); // 清空显示值
		
		switch(fileFullName){
		case "clear":
			//与""相同
		case "":
			jQuery("#" + uploadListId.substring(uploadListId.indexOf("_") + 1)).val("");
			break;
		default :
			var $html = getDivContent(fileFullName, uploadListId,
					readonly, refresh, applicationid, 
					subGridView, disabled)
					
			$uploadList.append($html);
			$html.find(".fileTitle").each(function(){
				var $title = $(this);
				var titleWidthDefault = $title.width();
				$title.css("display","table");
				var titleWidth = $title.width();
				
				if(titleWidth > titleWidthDefault){
					$title.css("display","block");
				}
			})			
		}
	}

	// 文件附件
	function refreshUploadList(fileFullName, uploadListId, readonly, refresh,
			applicationid, subGridView, disabled) {
		refreshUploadListSub(fileFullName, uploadListId, readonly, refresh,
				applicationid, subGridView, disabled);
		if (refresh != 'false') {
			if (subGridView) {
				dy_view_refresh(uploadListId);
			} else {
				window.setTimeout("dy_refresh('"
						+ uploadListId.substring(uploadListId.indexOf("_") + 1)
						+ "')", 500);
			}
		}
	}

	// 显示文件列表
	function showUploadPic(index, id, webPath, applicationid) {
		var $picDiv = jQuery("#" + id + "pic" + index);
		if ($picDiv.size() != 0) {
			var url = encodeURI(encodeURI(contextPath
					+ "/portal/upload/fileInfor.action?applicationid="
					+ applicationid + "&fileFullName=" + webPath));
			jQuery.post(url, function(x) {
				// 提交成功回调
					var oldTitle = $picDiv.attr("title");
					$picDiv.attr("title", oldTitle + x);
				});
		}
	}
	
	//根据文件扩展名返回不同的class
	function fileTypeJudge(fileType){
		var imgCss = "other";
		
		if (fileType == ".pdf") {
			imgCss = "pdf";
		} else if (fileType == ".doc" || fileType == ".docx") {
			imgCss = "word";
		} else if (fileType == ".xls" || fileType == ".xlsx") {
			imgCss = "excel";
		} else if (fileType == ".txt") {
			imgCss = "txt";
		} else if (fileType == ".mp3" || fileType == ".wav"
				|| fileType == ".wma" || fileType == ".ra"
				|| fileType == ".rm" || fileType == ".cd") {
			imgCss = "audio";
		} else if (fileType == ".avi" || fileType == ".3gp"
				|| fileType == ".mkv" || fileType == ".rmvb"
				|| fileType == ".mp4" || fileType == ".mpg"
				|| fileType == ".swf" || fileType == ".dvd") {
			imgCss = "video";
		} else if (fileType == ".ppt" || fileType == ".pptx") {
			imgCss = "ppt";
		} else if (fileType == ".ipa") {
			imgCss = "ios";
		} else if (fileType == ".apk") {
			imgCss = "android";
		} else if (fileType == ".psd") {
			imgCss = "psd";
		} else if (fileType == ".ai") {
			imgCss = "ai";
		} else if (fileType == ".rar" || fileType == ".zip") {
			imgCss = "rar";
		} else if (fileType == ".jpg" || fileType == ".png"
				|| fileType == ".jpeg" || fileType == ".gif") {
			imgCss = "img";
		}
		return imgCss;
	}

	//是否支持预览
	function isPreViewFile(_file){
		var isPreView = false;
		DWREngine.setAsync(false);
		FormHelper.hasSwfFile(_file.webPath, _file.realName, function(result) {
			isPreView = result;
		});
		DWREngine.setAsync(true);
		return isPreView;
	}
	
	// 获得显示列表
	function getDivContent(fileFullName, uploadListId, readonly, refresh,
			applicationid, subGridView, disabled) {
		
		var data = {
				uploadListId : uploadListId,
				readonly : readonly,
				files : []
		};

		var files = JSON.parse(fileFullName);
		for ( var i = 0; i < files.length; i++) {	//循环文件列表
			var _file = new FMFileInfo(files[i]);
			var isImg = false;
			var imgCss = "";

			var isPreView = false;	// 判断文档是否可预览(OFFIC文档)
			isPreView = isPreViewFile(_file);
			isPreView = (isPreView || imgCss == "img");	//图片可预览

			// 获取文件类型 根据类型给文件赋予前置图标
			var _id = _file.showName.substring(0,
					_file.showName.lastIndexOf(".")).toLowerCase();
			var fileType = _file.showName.substring(
					_file.showName.lastIndexOf(".")).toLowerCase();
			
			imgCss = fileTypeJudge(fileType);	//根据文件扩展名返回不同的class
			
			var title = _file.showName;
			var fileType = title.substring(title.lastIndexOf("."))
					.toLowerCase();
			var fileName = title.substring(0, title.lastIndexOf("."));
			/*if (fileName != null && fileName.length > 8) {
				title = fileName.substring(0, 7) + ".."
						+ fileName.charAt(fileName.length - 1) + fileType;
			}*/
			title = fileName;
			var file = _file;

			file = {
					_id : _id,
					title : title,
					url : _file.url,
					imgCss : imgCss,
					fileType : fileType,
					isPreView : fileTypeJudge(fileType) == "img" ? "true" : isPreView + "",
					webPath : _file.webPath,
					showName : _file.showName,
					realName : _file.realName,
					fileType : fileType
			};
			data.files.push(file);
		}

		var $html = $(template("fileUploadCon-tmpl", data));
		

		$html.find(".fileRow").each(function(index) {
			$(this).bind("click",function() {
				var $me = $(this);
				var isPreView = $me.attr("isPreView");
				var file = {
						 webPath : $me.attr("data-webPath"),
						 showName : $me.attr("data-showName"),
						 realName : $me.attr("data-realName")
				};
				
				if(isPreView == "false" ){
					isPreView = isPreViewFile(file) ? "true" : "false";
					$me.attr("isPreView",isPreView);
				}
				
				if(isPreView == "true"){
					previewFile(file);
				}else{
					downloadFile(file);
				}
			}).find(".del").bind("click", function(){	//删除文件
				deleteOneFile(index,uploadListId,refresh,
						applicationid,subGridView,disabled);
				return false;
			});
		});
		
		return $html;
	}

	/**
	 * 文件预览
	 */
	function previewFile(file) {
		var url = encodeURI(encodeURI(contextPath
				+ "/portal/phone/resource/component/upload/preview.jsp?name="
				+ file.realName + "&path=" + file.webPath + "&showName="+file.showName));
		var fileType = file.realName.substr(file.realName.indexOf(".")).toLowerCase();
		if(
			fileType == ".doc" ||
			fileType == ".docx" ||
			fileType == ".xls" ||
			fileType == ".xlsx" ||
			fileType == ".pdf" ||
			fileType == ".txt" ||
			fileType == ".rtf" ||
			fileType == ".et" ||
			fileType == ".ppt" ||
			fileType == ".pptx" ||
			fileType == ".dps" ||
			fileType == ".pot" ||
			fileType == ".pps" ||
			fileType == ".wps" ||
			fileType == ".html" ||
			fileType == ".htm" 
		){
			if(fileType == ".pdf"){
				window.location.href = contextPath + file.webPath;
			}else{
				window.location.href = contextPath + file.webPath.substr(0,file.webPath.lastIndexOf("/")+1) + 'swf/' + file.realName.substr(0,file.realName.indexOf(".")) + '.pdf'
			}
			
		}else{
			OBPM.dialog.show({
				url : url,
				title : "文件预览",
				close : function(result) {
					
				}
			});
		}
		
		
		
	}

	/**
	 * 文件下载
	 */
	function downloadFile(file) {
		var url = encodeURI(contextPath + "/portal/dynaform/document/fileDownload.action?filename="+ file.realName + "&filepath=" + file.webPath);
		window.open(url,"_blank");
	}
	
	/**
	 * 获取文字长度
	 */
	function GetCurrentStrWidth(text) {
		var currentObj = $('<pre>').hide().appendTo(document.body);
		$(currentObj).html(text);
		var width = currentObj.width();
		currentObj.remove();
		return width;
	}

	// 删除一个文件
	function deleteOneFile(index, id, refresh, applicationid, 
			subGridView, disabled) {
		
		jQuery.confirm({
			trueCall : function(){

				var files = [];
				var filefullname = "";
				var oldstr = jQuery("#" + id.substring(id.indexOf("_") + 1)).val();// 用于恢复数据

				var oField = jQuery("#" + id.substring(id.indexOf("_") + 1));
				if(oField.val() == ""){
					console.error("字段值为空，无法继续删除！")
					return false;
				}
				files = JSON.parse(oField.val());
				var webpath = files[index].path;
				files.splice(index, 1);
				if (files.length > 0) {
					filefullname = JSON.stringify(files);
				}

				oField.val(filefullname);

				jQuery.ajax( {
							type : 'POST',
							async : false,
							url : encodeURI(encodeURI(contextPath
									+ "/portal/upload/deleteOne.action?fileFullName="
									+ webpath)),
							dataType : 'text',
							data : ajaxPage.getParams(),
							success : function(x) {
								refreshUploadList(filefullname, id, false, refresh,
										applicationid, subGridView,
										disabled);
								filefullname = "";
							},
							error : function(x) {
								jQuery("#" + id.substring(id.indexOf("_") + 1))
										.val(oldstr);
							}
						});
			},
			falseCall : function(){
				
			}
		});
	}


	/**
	 * 其他类别显示
	 */
	function showTextDialog(webPath,name) {
		OBPM.dialog.show( {
			opener : window.parent.parent,
			width : 1000,
			height : 580,
			url : webPath,
			args : {},
			title : name,
			close : function(result) {

			}
		});
	}
	
	function previewInNewTab(webPath){
		var _tmpwin = window.open(webPath, "_blank");
		_tmpwin.location.href = webPath;
	}

	// 弹出层来加载文件为了处理乱码问题
	function showFileDialog(obj, name, webPath, readonly) {
		var url = "";
		var fileType = name.substring(name.lastIndexOf(".")).toLowerCase();
		if (fileType == ".doc" || fileType == ".docx" || fileType == ".xls"
				|| fileType == ".xlsx") {
			url = contextPath + '/portal/dynaform/document/doViewWordFile.action';
			OBPM.dialog.show( {
				opener : window.parent.parent,
				width : 1000,
				height : 550,
				url : url,
				args : {
					"webPath" : contextPath + webPath,
					"readonly" : readonly
				},
				title : name,
				close : function(result) {

				}
			});
		} else {
			url = contextPath + webPath;
			obj.target = "_blank";
			obj.href = url;
			obj.triggerHandler("click");
		}
	}

	/**
	 * 图片预览窗口
	 * 
	 * url 图片路径
	 */
	function showImageEffect(url) {
		// 构造外围窗体 将窗体改为隐藏
		$("body").append('<div id="showImageDialog"></div>');
		var $div = $("#showImageDialog");
		$div.css( {
			"display" : "none",
			"position" : "fixed",
			"z-index" : "999",
			"top" : "0px",
			"right" : "0px",
			"bottom" : "0px",
			"left" : "0px"
		});
		$div
				.append('<div style="filter:alpha(opacity=70);-moz-opacity:0.7;-khtml-opacity: 0.7;position: fixed; z-index: 101; top: 0px; right: 0px; bottom: 0px; left: 0px; opacity: 0.7; background-color: rgb(0, 0, 0);"></div>');

		// 添加关闭按钮
		$div
				.append('<div id="imageClose" style="color: rgb(255, 255, 255); padding: 4px 10px ;  background-color: rgb(0, 0, 0);cursor: pointer;right: 0px;position: absolute;z-index:104;font-size:20px;">x</div>');
		// 添加图片外围div
		var imgdiv = '<div style="position: absolute; width: 300%; height: 100%; left: -100%;">';
		// 添加图片
		imgdiv += '<img style="position: absolute; z-index: 102; margin: auto; width: auto; top: 0px; right: 0px; bottom: 0px; left: 0px; display: block; cursor: pointer; max-width: 32%; max-height: 95%;" src="' + url + '"/>';
		imgdiv += "</div>";
		$div.append(imgdiv);

		// 鼠标滑进关闭按钮样式
		$("#imageClose").mouseover(function(e) {
			$("#imageClose").css("background-color", "rgb(55, 55, 55)");
		});
		$("#imageClose").mouseout(function(e) {
			$("#imageClose").css("background-color", "rgb(0, 0, 0)");
		});

		// 点击后淡出然后remove
		$("#imageClose").click(function(e) {
			$("#showImageDialog").fadeOut(50, function() {
				$div.remove();
			});
		});

		// 淡入显示
		$("#showImageDialog").fadeIn(50);
	}

	/**
	 * 前台删除文件
	 * 
	 * @param {}
	 *            valueField 文件路径保存字段
	 * @param {}
	 *            uploadListId
	 */
	function deleteFrontFile(valueField, uploadListId, applicationid) {
		// 删除URL
		if (confirm("你确定删除全部文件吗？此操作不可恢复！")) {
			var fileFullName = "";
			if (valueField.val() != '') {
				var files = JSON.parse(valueField.val());
				for ( var i = 0; i < files.length; i++) {
					fileFullName += files[i].path + ";";
				}
				if (fileFullName.length > 1) {
					fileFullName = fileFullName.substring(0,
							fileFullName.length - 1);
				}
			}
			this.url = contextPath
					+ "/portal/upload/delete.action?fileFullName="
					+ fileFullName;
			fileFullName = "";
			deleteFileCommon(valueField, uploadListId, url);
		}
	}

	/**
	 * 后台删除文件
	 * 
	 * @param {}
	 *            valueField 文件路径保存字段
	 * @param {}
	 *            uploadListId
	 */
	function deleteFile(valueField, uploadListId, applicationid) {
		// 删除URL
		this.url = contextPath + "/core/upload/delete.action?applicationid="
				+ applicationid + "&fileFullName=" + valueField.val();
		deleteFileCommon(valueField, uploadListId, url);
	}

	/**
	 * 前后台共有的删除文件方法
	 * 
	 * @param {}
	 *            valueField 文件路径保存字段
	 * @param {}
	 *            uploadListId
	 * @param {}
	 *            url 删除文件请求的路径
	 */
	function deleteFileCommon(valueField, uploadListId, URL) {
		// 保存原来的值用于删除发生异常时可以恢复数据
		var uploadListIdHTML = jQuery("#" + uploadListId).html();
		var uploadListIdValue = jQuery(
				"#" + uploadListId.substring(uploadListId.indexOf("_") + 1))
				.val();

		jQuery("#" + uploadListId).html(''); // 清空显示值
		jQuery("#" + uploadListId.substring(uploadListId.indexOf("_") + 1))
				.val("");

		jQuery.ajax( {
			type : 'POST',
			async : false,
			url : encodeURI(url),
			dataType : 'text',
			data : ajaxPage.getParams(),
			success : function(x) {
			},
			error : function(x) {
				// 恢复数据
			jQuery("#" + uploadListId).html(uploadListIdHTML);
			jQuery("#" + uploadListId.substring(uploadListId.indexOf("_") + 1))
					.val(uploadListIdValue);
		}
		});
		// jQuery("#" + uploadListId).html(''); // 清空显示值
		// valueField.val(''); // 清空值
		// map[uploadListId] = "";

	}

	/**
	 * 后台文件上传
	 * 
	 * @param {}
	 *            pathname 文件目录
	 * @param {}
	 *            pathFieldId 文件路径域ID
	 * @param {}
	 *            viewid 视图ID
	 * @param {}
	 *            allowedTypes 允许上传的类型
	 * @param {}
	 *            maximumSize 最大值
	 * @param {}
	 *            fileSaveMode 文件保存模式
	 * @return {} 文件网络路径
	 */
	function uploadFile(pathname, pathFieldId, viewid, allowedTypes,
			maximumSize, layer, fileSaveMode, applicationid) {
		var url = contextPath + '/core/upload/upload.jsp?path=' + pathname
				+ "&applicationid=" + applicationid;

		var oField = jQuery("#" + pathFieldId);
		OBPM.dialog.show( {
			opener : window.parent.parent,
			width : 800,
			height : 450,
			url : url,
			args : {},
			title : '文件上传',
			close : function(result) {
				if (result == null || result == undefined
						|| result == "undefined") {

				} else {
					if (oField != null) {
						oField.val(result);
					}
					return resutl;
				}
			}
		});
	}

	/**
	 * 前台文件上传
	 * 
	 * @param {}
	 *            pathname 文件目录
	 * @param {}
	 *            pathFieldId 文件路径域ID
	 * @param {}
	 *            viewid 视图ID
	 * @param {}
	 *            allowedTypes 允许上传的类型
	 * @param {}
	 *            maximumSize 最大值
	 * 
	 * @param {}
	 *            fileSaveMode 文件保存模式
	 * @param {}
	 *            callback 回调函数
	 * @return {} 文件网络路径
	 */
	function uploadFrontFile(title, pathname, pathFieldId, viewid,
			allowedTypes, maximumSize, fileSaveMode, callback, applicationid,
			limitNumber, fileType, customizeType) {
		hiddenDocumentFieldIncludeIframe();// in util.js
		var files = [];
		var oField = jQuery("#" + pathFieldId);
		var ifiles = oField.val();
		if(ifiles!=""){
			files = JSON.parse(ifiles);
		}
		var url = contextPath
				+ '/portal/phone/resource/component/upload/obpm.fileUpload.jsp?path=' + pathname;
		url = addParameters(pathname, pathFieldId, viewid, allowedTypes,
				maximumSize, fileSaveMode, url);
		url += '&applicationid=' + applicationid;
		url += '&limitNumber=' + (limitNumber-files.length);
		url += '&fileType=' + fileType;
		url += '&customizeType=' + customizeType;
		if(limitNumber-files.length>0){
			OBPM.dialog.show( {
				url : url,
				args : {
					"webPath" : "aaaaaaaa",
					"readonly" : "222222"
				},
				title : title,
				close : function(result) {
	//				showDocumentFieldIncludeIframe();//显示被隐藏的iframe，phone中不需要 //in util.js
					var oField = jQuery("#" + pathFieldId);
					var rtn = getReturnValue(oField, result);
					// 把上传的文件json格式 [{'name':'aaa.doc','path':'XXX'}] 放进文件上传控件的value
					var files = [];
					if (isReloadFile) {
						var fileStrs = result.split(";");
						if (oField && oField.attr("value") && allowedTypes != 'image') {
							files = JSON.parse(oField.attr("value"));
						}
						for ( var i = 0; i < fileStrs.length; i++) {
							var fileStr = fileStrs[i].split(",");
							var file = new File(fileStr[0], fileStr[1]);
							files.push(file);
						}
					}
					if (files.length > 0) {
						rtn = JSON.stringify(files);
					}
					oField.attr("value", rtn);
					$("input[name=" + oField.attr("name") + "]").val(rtn);
					if (callback && typeof (callback) == "function") {
						callback();
					}
				}
			});
		} else {
			alert("文件上传超出数量限制。");
		}
	}
	/**
	 * 简单上传
	 * 
	 * @param {}
	 *            pathname 文件存放路径名称
	 * @param {}
	 *            pathFieldId 文件路径域ID
	 * @param {}
	 *            callback 回调函数
	 */
	function uploadFrontSimple(pathname, pathFieldId, applicationid) {
		var url = contextPath
				+ '/portal/phone/resource/component/upload/obpm.fileUpload.jsp?path=' + pathname
				+ '&applicationid=' + applicationid;
		var oField = jQuery("#" + pathFieldId);
		OBPM.dialog.show( {
			opener : window.parent.parent,
			width : 800,
			height : 450,
			url : url,
			args : {},
			title : 'upload',
			close : function(result) {
				if (result == null || result == undefined
						|| result == "undefined" || result == "clear") {
					oField.val('');
				} else {
					oField.val(result);
				}

			}
		});
		/*
		 * showfrontframe({ title : "upload", url : url, w : 650, h : 500,
		 * callback : callback });
		 */
	}

	/**
	 * 为URL添加参数
	 * 
	 * @param {}
	 *            pathname
	 * @param {}
	 *            pathFieldId
	 * @param {}
	 *            viewid
	 * @param {}
	 *            allowedTypes
	 * @param {}
	 *            maximumSize
	 * @param {}
	 *            fileSaveMode
	 * @param {}
	 *            url
	 * @return {}
	 */
	function addParameters(pathname, pathFieldId, viewid, allowedTypes,
			maximumSize, fileSaveMode, url) {
		var oField = jQuery("#" + pathFieldId);
		var oView = jQuery("#" + viewid);

		if (allowedTypes) {
			url += '&allowedTypes=' + allowedTypes;
		}

		if (maximumSize) {
			url += '&maximumSize=' + maximumSize;
		}

		if (fileSaveMode) {
			// 自定义
			url += '&fileSaveMode=' + fileSaveMode;
		} else {
			// 系统
			url += '&fileSaveMode=00';
		}

		return url;
	}

	/**
	 * 获取返回值
	 * 
	 * @param {}
	 *            oField
	 * @return {}
	 */
	function getReturnValue(oField, rtn) {
		if (rtn == null || rtn == 'undefined') {
			isReloadFile = false;
			if (oField && oField.val()) {
				rtn = oField.val();
			} else {
				rtn = '';
			}
		} else {
			isReloadFile = true;
		}
		return rtn;
	}

	$.fn.obpmUploadField = function() {
		return this.each(function() {
			var $field = jQuery(this);
			var tagName = $field.attr("tagName");
			if(tagName=="ImageUploadField"){
				$field.obpmWeixinImageUpload();
				return;
			}
			var id = $field.attr("id");
			var disabled = $field.attr("disabled");
			var readonly = (disabled == 'disabled');
			var callbakFunction = $field.attr("callbakFunction");
			var path = $field.attr("path");
			var fileSaveMode = $field.attr("fileSaveMode");
			var application = $field.attr("application");
			var value = $field.attr("value");
			var name = $field.attr("name");
			var maxsize = $field.attr("maxsize");
			var uploadList = $field.attr("uploadList");
			var text = $field.html();
			var refreshOnChanged = $field.attr("refreshOnChanged");

			var uploadLabel = $field.attr("uploadLabel");
			var filelabel = $field.attr("filelabel");
			var deleteLabel = $field.attr("deleteLabel");
			var limitsize = $field.attr("limitsize");
			var limitNumber = $field.attr("limitNumber");
			
			var fileType = $field.attr("fileType");
			var customizeType = $field.attr("customizeType");
			var limitType = $field.attr("limitType");
			var readOnlyShowValOnly = $field.attr("readOnlyShowValOnly");

			var imgHeight = $field.attr("imgHeight");
			var imgWidth = $field.attr("imgWidth");
			var layoutType = $field.attr("_layoutType");
			
			var subGridView = $field.attr("subGridView");
			var discript = $field.attr("discript");

			value = value ? value : "";
			subGridView = (subGridView == 'true');
			discript = discript ? HTMLDencode(discript) : name;
			
			text = text ? text : "";
			var horizontalClass = "";
			if(layoutType == LayoutType_Horizontal){
				horizontalClass = "flexbox";
			}
			var data = {
					id : id,
					name : name,
					tagName : tagName,
					value : value,
					discript : discript,
					uploadList : uploadList,
					uploadLabel : uploadLabel,
					readonly : readonly,
					readOnlyShowValOnly : (readOnlyShowValOnly == "true"),
					horizontalClass : horizontalClass
			};

			var _callback = function() {

				refreshUploadList(jQuery("#" + id).attr("value"), uploadList,
					readonly, refreshOnChanged, application,subGridView, disabled);
			};
			
			var $html = $(template("fileUpload-tmpl", data));
			if(!readonly){

				$html.find(".btnAdd").bind("click", function() {
					uploadFrontFile(filelabel + uploadLabel, path, id,
						'_viewid', limitType, maxsize,fileSaveMode, _callback, 
						application,limitNumber, fileType, customizeType);
				});
			}
			
			$field.before($html);
			// 描述
			if($field.attr("moduleType") != "uploadFileRefresh"){
				$field.attr("moduleType","uploadFileRefresh").css("display","none");
			}
			
			refreshUploadListSub(jQuery("#" + id).attr("value"), uploadList, 
				readonly, refreshOnChanged,
				application, subGridView, disabled);
		});
	};
	$.fn.obpmViewImageUpload = function() {
		return this
				.each(function() {
					var $field = jQuery(this);
					var imgw = $field.attr("imgw");
					var imgh = $field.attr("imgh");
					var viewReadOnly = $field.attr("viewReadOnly");
					var docId = $field.attr("docId");
					var docFormid = $field.attr("docFormid");
					var url = $field.attr("url");
					var fileName = $field.attr("fileName");

					viewReadOnly = (viewReadOnly == "true") ? true : false;
					var imgwHalf = imgh / 2;
					var isSubGridView = jQuery("#obpm_subGridView").size() > 0 ? true
							: false;

					var html = "<div  class='bigImg' style='position:relative;width:"
							+ imgw + "; height:" + imgh + "'>";
					if (viewReadOnly) {
						html += "<img alt='" + fileName + "' border='0' src='"
								+ url + "' width='" + imgw + "' height='"
								+ imgh + "' />";
					} else {
						html += "<a ";
						if (!isSubGridView) {
							html += " href=\"javaScript:viewDoc('" + docId
									+ "','" + docFormid + "')\"";
						}
						html += " title='" + fileName + "'>";
						html += "<img alt='" + fileName + "' border='0' src='"
								+ url + "' width='" + imgw + "' height='"
								+ imgh + "' />";
						html += "</a>";
					}
					html += "<div  class='smallIcon' style='display:none;position:absolute;right:0px;top:"
							+ imgwHalf
							+ "px;z-index:100;'><a class='imgClick' href='"
							+ url + "' target='blank'>";
					html += "<img alt='"
							+ fileName
							+ "' border='0' src='../resource/images/picture_go.png' title='点击查看原图' /></a><div>";
					html += "</div>";
					var $html = $(html);
					$html.mouseover(function(event) {
						event.stopPropagation();
						jQuery(this).find(".smallIcon").show();
					}).mouseout(function(event) {
						event.stopPropagation();
						jQuery(this).find(".smallIcon").hide();
					});
					$field.replaceWith($html);
				});
	};

})(jQuery);; 
(function($){
	$.fn.obpmHtmlEditorField=function(){
		return this.each(function() {
			var $field = jQuery(this);
			var displayType = $field.attr("displayType");
			var originalText = URLDecode($field.html());
			var name = $field.attr("name");
			var hiddenValue = $field.attr("_hiddenValue");
			var discript = $field.attr("discript");
			discript = discript? HTMLDencode(discript) : name;
			var style = "",
				isReadonly = false,
				readonly = "";
				html = "";
			
			var $div_text = $("<div></div>");	
			$div_text.html(originalText);
			$div_text.find("img").each(function(){
				var img_src = $(this).attr("src"); 
				if(img_src.indexOf("../../../")>-1) {
					img_src = img_src.replace("../../../","../../");
					$(this).attr("src",img_src);
				}
			});
			var text = $div_text.html();
			
			if (displayType == PermissionType_HIDDEN) {
				style = ";display:none;";
			}else{
				hiddenValue = "";
			}
			
			if(displayType == PermissionType_READONLY || displayType == PermissionType_DISABLED){
				isReadonly = true;
				readonly = "readonly";
			}
			
			var data = {
					name : name,
					text : text,
					style : style,
					readonly : readonly,
					discript : discript,
					isReadonly : isReadonly,
					hiddenValue : hiddenValue
			};
			var $html = $(template("html-tmpl", data));
			$field.after($html);
			$field.attr("moduletype","htmlEditorSave");
			if(!isReadonly){
				var doc = $html.find("iframe")[0].contentDocument;
				doc.designMode = "On";
				doc.body.style.fontSize='16px';
				doc.body.setAttribute("_textarea",$field.attr("id"));
				$(doc).on("input",function(){
		               var _textarea_id = $(this).find("body").attr("_textarea");
		               $('#'+_textarea_id, window.parent.document).val($(this).find("body").html());
		        });
				
				if (text != "null" && text != ""){
					setTimeout(function(){
						//doc.write(text);
						doc.body.style.fontSize='16px';
						$(doc).find("body").html(text);
					},15);
				}
			}
		});
	};
})(jQuery);
; 
(function($){
	$.fn.obpmSelectAboutField =function(){
		return this.remove();//左右选择框在手机端不显示
		return this.each(function(){
			var $field =jQuery(this);
			var id=$field.attr("id");
			var name =$field.attr('name');
			var isRefreshOnChanged = $field.attr("isRefreshOnChanged");
			var displayType=$field.attr("displayType");
			var hiddenValue =  $field.attr("hiddenValue");
			var textType=$field.attr("textType");
			var value = $field.val();
			var discript = $field.attr("_discript");
			
			value = value ? value : "";
			discript = discript? HTMLDencode(discript) : name;
			isRefreshOnChanged=(isRefreshOnChanged=='true');
			
			var html = "";
			if(displayType != PermissionType_HIDDEN){
				//刷新重计算时不重构
				if(!$field.attr("isLoaded"))
					$field.attr("isLoaded",true);
				else return;
				$field.before("<label for='" + name + "'>" + discript + "</label>");
				$field.bind("change",function(){
					if(isRefreshOnChanged){
						//dy_refresh(this.id);刷新方法在jquery.multiselect2side.js调用
					}
				});
				if(displayType == PermissionType_READONLY || textType.toLowerCase() == "readonly" || displayType == PermissionType_DISABLED){
					jQuery('#'+id).multiselect2side({selectedPosition: 'right',moveOptions: false,labelsx: '',labeldx: '',readOnly:true});
				}else{
					jQuery('#'+id).multiselect2side({selectedPosition: 'right',moveOptions: false,labelsx: '',labeldx: '',readOnly:false});
				}
			}else{
				html +="<input type='hidden' name='" + name + "' id='" + id + "' value='" + value + "' />";
				html +="<div>" + hiddenValue + "</div>";
				$field.after(html);
				$field.remove();
			}
		});
	};
	
})(jQuery);

//刷新方法，在jquery.multiselect2side.js调用
function callRefresh(el){
	var $field = jQuery(el);
	var isRefreshOnChanged = $field.attr("isRefreshOnChanged");
	isRefreshOnChanged=(isRefreshOnChanged=='true');
	if(isRefreshOnChanged){
		dy_refresh($field.id);
	}
}; 
/*
 * multiselect2side jQuery plugin
 *
 * Copyright (c) 2010 Giovanni Casassa (senamion.com - senamion.it)
 *
 * Dual licensed under the MIT (MIT-LICENSE.txt)
 * and GPL (GPL-LICENSE.txt) licenses.
 *
 * http://www.senamion.com
 *
 */

(function($)
{
	jQuery.fn.multiselect2side = function (o) {

		o = $.extend({
			selectedPosition: 'right',
			moveOptions: true,
			labelTop: 'Top',
			labelBottom: 'Bottom',
			labelUp: 'Up',
			labelDown: 'Down',
			labelSort: 'Sort',
			labelsx: 'Available',
			labeldx: 'Selected',
			maxSelected: -1,
			readOnly:false
		}, o);

		// 当没有选项时，为控件选中一个空文本的选项
		var addEmptyOptionWhenNoSelect = function(oSelect) {
			if (oSelect.find("option:selected").size() == 0){
				oSelect.find("[text='']").attr("selected", true);
			} else {
				oSelect.find("[text='']").attr("selected", false);
			}
		};
		
		return this.each(function () {
			var	el = $(this);

			var	originalName = $(this).attr("name");
			if (originalName.indexOf('[') != -1)
				originalName = originalName.substring(0, originalName.indexOf('['));

			var	nameDx = originalName + "ms2side__dx";
			var	nameSx = originalName + "ms2side__sx";
			var size = $(this).attr("size");
			// SIZE MIN
			if (size < 5) {
				$(this).attr("size", "5");
				size = 5;
			}

			// UP AND DOWN
			var divUpDown =
					"<div class='ms2side__updown'>" +
						"<p class='SelSort' title='Sort'>" + o.labelSort + "</p>" +
						"<p class='MoveTop' title='Move on top selected option'>" + o.labelTop + "</p>" +
						"<p class='MoveUp' title='Move up selected option'>" + o.labelUp + "</p>" +
						"<p class='MoveDown' title='Move down selected option'>" + o.labelDown + "</p>" +
						"<p class='MoveBottom' title='Move on bottom selected option'>" + o.labelBottom + "</p>" +
					"</div>";

			// CREATE NEW ELEMENT (AND HIDE IT) AFTER THE HIDDED ORGINAL SELECT
			var htmlToAdd = 
				"<span class='ms2side__div'>" +
						((o.selectedPosition != 'right' && o.moveOptions) ? divUpDown : "") +
						"<table><tbody><tr><td class='ms2side__select'>" +
						(o.labelsx ? ("<span class='ms2side__header'>" + o.labelsx + "</span>") : "");
			if(o.readOnly){
				htmlToAdd += "<select data-enhance='false' title='" + o.labelsx + "' name='" + nameSx + "' id='" + nameSx + "' size='" + size + "' multiple='multiple' disabled='disabled'></select>";
			}else{
				htmlToAdd += "<select data-enhance='false' title='" + o.labelsx + "' name='" + nameSx + "' id='" + nameSx + "' size='" + size + "' multiple='multiple'></select>";
			}
			
			htmlToAdd += "</td>" +
					"<td class='ms2side__options'>" +
						((o.selectedPosition == 'right')
						?
						("<table style='display: inline;vertical-align:bottom;'><tr><td><p class='AddOne' title='Add Selected'>&rsaquo;</p></td></tr>" +
						"<tr><td><p class='AddAll' title='Add All'>&raquo;</p></td></tr>" +
						"<tr><td><p class='RemoveOne' title='Remove Selected'>&lsaquo;</p></td></tr>" +
						"<tr><td><p class='RemoveAll' title='Remove All'>&laquo;</p></td></tr></table>")
						:
						("<table style='display: inline;vertical-align:bottom'><tr><td><p class='AddOne' title='Add Selected'>&lsaquo;</p></td></tr>" +
						"<tr><td><p class='AddAll' title='Add All'>&laquo;</p></td></tr>" +
						"<tr><td><p class='RemoveOne' title='Remove Selected'>&rsaquo;</p></td></tr>" +
						"<tr><td><p class='RemoveAll' title='Remove All'>&raquo;</p></td></tr></table>")
						) +
					"</td>" +
					"<td class='ms2side__select'>" +
						(o.labeldx ? ("<span class='ms2side__header'>" + o.labeldx + "</span>") : "");
			if(o.readOnly){
				htmlToAdd += "<select data-enhance='false' title='" + o.labeldx + "' name='" + nameDx + "' id='" + nameDx + "' size='" + size + "' multiple='multiple' disabled='disabled'></select>";
			}else{
				htmlToAdd += "<select data-enhance='false' title='" + o.labeldx + "' name='" + nameDx + "' id='" + nameDx + "' size='" + size + "' multiple='multiple'></select>";
			}
			htmlToAdd += "</td></tr></tbody></table>" +
					((o.selectedPosition == 'right' && o.moveOptions) ? divUpDown : "") +
				"</span>";
			$(this).after(htmlToAdd).hide();

			// ELEMENTS
			var allSel = $(this).next().find("select");
			var	leftSel = (o.selectedPosition == 'right') ? allSel.eq(0) : allSel.eq(1);
			var	rightSel = (o.selectedPosition == 'right') ? allSel.eq(1) : allSel.eq(0);
			// HEIGHT DIV
			var	heightDiv = $(".ms2side__select").eq(0).height();
			
			// CENTER MOVE OPTIONS AND UPDOWN OPTIONS
			$(this).next().find('.ms2side__options, .ms2side__updown').each(function(){
				var	top = ((heightDiv/2) - ($(this).height()/2));
				if (top > 0)
					$(this).css('padding-top',  top + 'px' );
			})

			// MOVE SELECTED OPTION TO RIGHT, NOT SELECTED TO LEFT
			// 初始化时过滤掉空文本选项
			$(this).find("option:selected[text!='']").clone().appendTo(rightSel);
			$(this).find("option:not(:selected)[text!='']").clone().appendTo(leftSel);

			// SELECT FIRST LEFT ITEM
//			if (!($.browser.msie && $.browser.version == '6.0'))
				leftSel.find("option").eq(0).attr("selected", true);

			// ON CHANGE REFRESH ALL BUTTON STATUS
			allSel.change(function() {
				var	div = $(this).parent().parent();
				var	selectSx = leftSel.children();
				var	selectDx = rightSel.children();
				var	selectedSx = leftSel.find("option:selected");
				var	selectedDx = rightSel.find("option:selected");

				if (selectedSx.size() == 0 ||
						(o.maxSelected >= 0 && (selectedSx.size() + selectDx.size()) > o.maxSelected))
					div.find(".AddOne").addClass('ms2side__hide');
				else
					div.find(".AddOne").removeClass('ms2side__hide');

				// FIRST HIDE ALL
				div.find(".RemoveOne, .MoveUp, .MoveDown, .MoveTop, .MoveBottom, .SelSort").addClass('ms2side__hide');
				if (selectDx.size() > 1)
					div.find(".SelSort").removeClass('ms2side__hide');
				if (selectedDx.size() > 0) {
					div.find(".RemoveOne").removeClass('ms2side__hide');
					// ALL SELECTED - NO MOVE
					if (selectedDx.size() < selectDx.size()) {	// FOR NOW (JOE) && selectedDx.size() == 1
						if (selectedDx.val() != selectDx.val())	// FIRST OPTION, NO UP AND TOP BUTTON
							div.find(".MoveUp, .MoveTop").removeClass('ms2side__hide');
						if (selectedDx.last().val() != selectDx.last().val())	// LAST OPTION, NO DOWN AND BOTTOM BUTTON
							div.find(".MoveDown, .MoveBottom").removeClass('ms2side__hide');
					}
				}

				if (selectSx.size() == 0 ||
						(o.maxSelected >= 0 && selectSx.size() >= o.maxSelected))
					div.find(".AddAll").addClass('ms2side__hide');
				else
					div.find(".AddAll").removeClass('ms2side__hide');

				if (selectDx.size() == 0)
					div.find(".RemoveAll").addClass('ms2side__hide');
				else
					div.find(".RemoveAll").removeClass('ms2side__hide');
				
				if(o.readOnly){
					div.find(".AddOne, .AddAll, .RemoveOne, .RemoveAll").addClass('ms2side__hide');
				}
			});

			// DOUBLE CLICK ON LEFT SELECT OPTION
			leftSel.dblclick(function () {
				$(this).find("option:selected").each(function(i, selected){

					if (o.maxSelected < 0 || rightSel.children().size() < o.maxSelected) {
						$(this).remove().appendTo(rightSel);
						el.find("[value=\"" + $(selected).val() + "\"]").attr("selected", true).remove().appendTo(el);
					}
				});
				$(this).trigger('change');
				//调用刷新方法  obpm.selectAboutField.js
				callRefresh(el);
			});

			// DOUBLE CLICK ON RIGHT SELECT OPTION
			rightSel.dblclick(function () {
				$(this).find("option:selected").each(function(i, selected){
					$(this).remove().appendTo(leftSel);
					el.find("[value=\"" + $(selected).val() + "\"]").attr("selected", false).remove().appendTo(el);
				});
				addEmptyOptionWhenNoSelect(el);
				$(this).trigger('change');
				//调用刷新方法  obpm.selectAboutField.js
				callRefresh(el);
			});

			// CLICK ON OPTION
			$(this).next().find('.ms2side__options p').click(function () {
				if (!$(this).hasClass("ms2side__hide")) {
					if ($(this).hasClass("AddOne")) {
						leftSel.find("option:selected").each(function(i, selected){
							$(this).remove().appendTo(rightSel);
							el.find("[value=\"" + $(selected).val() + "\"]").attr("selected", true).remove().appendTo(el);
						});
					}
					else if ($(this).hasClass("AddAll")) {	// ALL SELECTED
						leftSel.children().appendTo(rightSel);
						leftSel.children().remove();
						el.find('option').attr("selected", true);
						// el.children().attr("selected", true); -- PROBLEM WITH OPTGROUP
					}
					else if ($(this).hasClass("RemoveOne")) {
						rightSel.find("option:selected").each(function(i, selected){
							$(this).remove().appendTo(leftSel);
							el.find("[value=\"" + $(selected).val() + "\"]").attr("selected", false).remove().appendTo(el);
						});
						addEmptyOptionWhenNoSelect(el);
					}
					else if ($(this).hasClass("RemoveAll")) {	// ALL REMOVED
						rightSel.children().appendTo(leftSel);
						rightSel.children().remove();
						el.find('option').each(function(){
							if(jQuery(this).val())
								jQuery(this).attr("selected",false);
							else
								jQuery(this).attr("selected",true);//没有选中只是设置空值
						});
						addEmptyOptionWhenNoSelect(el);
						//el.children().attr("selected", false); -- PROBLEM WITH OPTGROUP
					}
					//调用刷新方法  obpm.selectAboutField.js
					callRefresh(el);

				}

				leftSel.trigger('change');
			});

			// CLICK ON UP - DOWN
			$(this).next().find('.ms2side__updown').children().click(function () {
				var	selectedDx = rightSel.find("option:selected");
				var	selectDx = rightSel.find("option");

				if (!$(this).hasClass("ms2side__hide")) {
					if ($(this).hasClass("SelSort")) {
						// SORT SELECTED ELEMENT
						selectDx.sort(function(a, b) {
							 var compA = $(a).text().toUpperCase();
							 var compB = $(b).text().toUpperCase();
							 return (compA < compB) ? -1 : (compA > compB) ? 1 : 0;
						})
						// FIRST REMOVE FROM ORIGINAL SELECT
						el.find("option:selected").remove();
						// AFTER ADD ON ORIGINAL AND RIGHT SELECT
						selectDx.each(function() {
							rightSel.append($(this).clone().attr("selected", true));
							el.append($(this).attr("selected", true));
						});
					}
					else if ($(this).hasClass("MoveUp")) {
						var	prev = selectedDx.first().prev();
						var	hPrev = el.find("[value=" + prev.val() + "]");

						selectedDx.each(function() {
							$(this).insertBefore(prev);
							el.find("[value=" + $(this).val() + "]").insertBefore(hPrev);	// HIDDEN SELECT
						});
					}
					else if ($(this).hasClass("MoveDown")) {
						var	next = selectedDx.last().next();
						var	hNext = el.find("[value=" + next.val() + "]");

						selectedDx.each(function() {
							$(this).insertAfter(next);
							el.find("[value=" + $(this).val() + "]").insertAfter(hNext);	// HIDDEN SELECT
						});
					}
					else if ($(this).hasClass("MoveTop")) {
						var	first = selectDx.first();
						var	hFirst = el.find("[value=" + first.val() + "]");

						selectedDx.each(function() {
							$(this).insertBefore(first);
							el.find("[value=" + $(this).val() + "]").insertBefore(hFirst);	// HIDDEN SELECT
						});
					}
					else if ($(this).hasClass("MoveBottom")) {
						var	last = selectDx.last();
						var	hLast = el.find("[value=" + last.val() + "]");

						selectedDx.each(function() {
							last = $(this).insertAfter(last);	// WITH last = SAME POSITION OF SELECTED OPTION AFTER MOVE
							hLast = el.find("[value=" + $(this).val() + "]").insertAfter(hLast);	// HIDDEN SELECT
						});
					}
				}

				leftSel.trigger('change');
			});

			// HOVER ON OPTION
			$(this).next().find('.ms2side__options, .ms2side__updown').children().hover(
				function () {
					$(this).addClass('ms2side_hover');
				},
				function () {
					$(this).removeClass('ms2side_hover');
				}
			);

			// UPDATE BUTTON ON START
			leftSel.trigger('change');
			// SHOW WHEN ALL READY
			$(this).next().show();
		});
	};
})(jQuery);; 
(function($) {
	$.fn.obpmSuggestField = function() {
		return this.each(function(i) {
			var TEXT_TYPE_HIDDEN = "hidden",
				TEXT_TYPE_READONLY = "readonly",
				TEXT_TYPE_TEXT = "text",
				TEXT_TYPE_PASSWORD = "password";
			
			var $field = jQuery(this);
			var fieldId = $field.attr("_fieldId");
			var name = $field.attr("_name");
			var isRefresh = $field.attr("_isRefreshOnChanged");
			var displayType = $field.attr("_displayType");
			var readOnlyShowValOnly = $field.attr("readOnlyShowValOnly");
			var textType = $field.attr("_textType");
			var value = $field.attr("value");
			var text = $field.attr("text");
			if(text == "" || text == null){
				text = value;
			}
			var json = $field.attr("_json")? $field.attr("_json") : '{}';
			var otherAttrs = $field.attr("_otherAttrs");
			var style=$field.attr("style");
			var fieldType = $field.attr("_fieldType");
			var fieldId2 = fieldId.replace(/\-/g, "_");
			var subGridView = $field.attr("_subGridView");
			var discript = $field.attr("_discript");
			var hiddenValue = $field.attr("_hiddenValue");
			var dataMode = $field.attr("_dataMode");
			var formId = $field.attr("_formid");
			var _fieldId4sych = $field.attr("_fieldId4sych");
			var domainId = $field.attr("_domainId");
			var layoutType = $field.attr("_layoutType");
			
			isRefresh = (isRefresh == "true");
			subGridView = (subGridView == "true");
			value = value ? value : "";
			discript = discript? HTMLDencode(discript) : name;
			var style = "z-index:97;",
				hideText = "",
				readonly = "",
				horizontalClass = "",
				isReadOnlyShowValOnly = false;
			
			var otherAttrsHtml = getOtherProps(otherAttrs) + " " + getOtherAttrs($field[0]);	//其他属性
			
			if(layoutType == LayoutType_Horizontal){
				horizontalClass = "flexbox";
			}
			if(textType.toLowerCase() == TEXT_TYPE_HIDDEN || displayType == PermissionType_HIDDEN){
				hideText =  "display:none;";
			}else{	//不是隐藏状态时置空隐藏时显示值
				hiddenValue = '';
			}

			if(displayType == PermissionType_READONLY || TEXT_TYPE_READONLY == textType.toLowerCase() 
					|| displayType == PermissionType_DISABLED){
				readonly = true;
				readonly = "readonly";
				if(readOnlyShowValOnly){
					style += ";display:none;";
					isReadOnlyShowValOnly = true;
				}
			}
			
			var data = {
					id : fieldId,
					name : name,
					text : text,
					value : value,
					style : style,
					discript : discript,
					hideText : hideText,
					readonly : readonly,
					isRefresh : isRefresh,
					fieldType : fieldType,
					subGridView : subGridView,
					otherAttrsHtml : otherAttrsHtml,
					isReadOnlyShowValOnly : isReadOnlyShowValOnly,
					horizontalClass : horizontalClass,
					hiddenValue : hiddenValue
			};
			var $html = $(template("suggest-tmpl", data));
			var $input = $html.find("input[type=text]");
			if(dataMode == "local"){
				var source = eval(json) || [];
				$input.typeahead({
					source:source, 
					autoSelect: true,
					menu: '<ul class="typeahead dropdown-menu" style="width:95%" role="listbox"></ul>',
					item: '<li><a href="#" role="option"></a></li>',
					delay: 100,
					afterSelect : function(current){
		                  if (current) {
		                      if (current.id != $("#"+fieldId).val()) {
		                    	  $("#"+fieldId).val(current.id);//设值
		                    	  if(isRefresh){
										if(subGridView)
											dy_view_refresh(fieldId + "_show");
										else
											dy_refresh(fieldId + "_show");
									}
		                      }
		                  }
					}
				}); 
			}else if(dataMode == "remote"){
				var url = contextPath + "/portal/document/suggestfield/query?_formFieldId="+_fieldId4sych;
				$input.typeahead({
					source:function(query,process) {
						var data = ajaxPage.getParams()+"&__keyword="+query;
						$.post(url,data,function(json){
							process(eval(json));
						});
				    }, 
					autoSelect: true,
					menu: '<ul class="typeahead dropdown-menu" style="width:95%" role="listbox"></ul>',
					item: '<li><a href="#" role="option"></a></li>',
					delay: 500,
					afterSelect : function(current){
		                  if (current) {
		                      if (current.id != $("#"+fieldId).val()) {
		                    	  $("#"+fieldId).val(current.id);//设值
		                    	  if(isRefresh){
										if(subGridView)
											dy_view_refresh(fieldId + "_show");
										else
											dy_refresh(fieldId + "_show");
									}
		                      }
		                  }
					}
				}); 
			}
			$html.replaceAll($field);
		});
	};

})(jQuery);
; 
!function(a,b){"use strict";"undefined"!=typeof module&&module.exports?module.exports=b(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],function(a){return b(a)}):b(a.jQuery)}(this,function(a){"use strict";var b=function(b,c){this.$element=a(b),this.options=a.extend({},a.fn.typeahead.defaults,c),this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.select=this.options.select||this.select,this.autoSelect="boolean"==typeof this.options.autoSelect?this.options.autoSelect:!0,this.highlighter=this.options.highlighter||this.highlighter,this.render=this.options.render||this.render,this.updater=this.options.updater||this.updater,this.displayText=this.options.displayText||this.displayText,this.source=this.options.source,this.delay=this.options.delay,this.$menu=a(this.options.menu),this.$appendTo=this.options.appendTo?a(this.options.appendTo):null,this.shown=!1,this.listen(),this.showHintOnFocus="boolean"==typeof this.options.showHintOnFocus?this.options.showHintOnFocus:!1,this.afterSelect=this.options.afterSelect,this.addItem=!1};b.prototype={constructor:b,select:function(){var a=this.$menu.find(".active").data("value");if(this.$element.data("active",a),this.autoSelect||a){var b=this.updater(a);this.$element.val(this.displayText(b)||b).change(),this.afterSelect(b)}return this.hide()},updater:function(a){return a},setSource:function(a){this.source=a},show:function(){var b,c=a.extend({},this.$element.position(),{height:this.$element[0].offsetHeight});return b="function"==typeof this.options.scrollHeight?this.options.scrollHeight.call():this.options.scrollHeight,(this.$appendTo?this.$menu.appendTo(this.$appendTo):this.$menu.insertAfter(this.$element)).css({top:c.top+c.height+b,left:c.left}).show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(b){if(this.query="undefined"!=typeof b&&null!==b?b:this.$element.val()||"",this.query.length<this.options.minLength)return this.shown?this.hide():this;var c=a.proxy(function(){a.isFunction(this.source)?this.source(this.query,a.proxy(this.process,this)):this.source&&this.process(this.source)},this);clearTimeout(this.lookupWorker),this.lookupWorker=setTimeout(c,this.delay)},process:function(b){var c=this;return b=a.grep(b,function(a){return c.matcher(a)}),b=this.sorter(b),b.length||this.options.addItem?(b.length>0?this.$element.data("active",b[0]):this.$element.data("active",null),this.options.addItem&&b.push(this.options.addItem),"all"==this.options.items?this.render(b).show():this.render(b.slice(0,this.options.items)).show()):this.shown?this.hide():this},matcher:function(a){var b=this.displayText(a);return~b.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(a){for(var b,c=[],d=[],e=[];b=a.shift();){var f=this.displayText(b);f.toLowerCase().indexOf(this.query.toLowerCase())?~f.indexOf(this.query)?d.push(b):e.push(b):c.push(b)}return c.concat(d,e)},highlighter:function(b){var c,d,e,f,g,h=a("<div></div>"),i=this.query,j=b.toLowerCase().indexOf(i.toLowerCase());if(c=i.length,0===c)return h.text(b).html();for(;j>-1;)d=b.substr(0,j),e=b.substr(j,c),f=b.substr(j+c),g=a("<strong></strong>").text(e),h.append(document.createTextNode(d)).append(g),b=f,j=b.toLowerCase().indexOf(i.toLowerCase());return h.append(document.createTextNode(b)).html()},render:function(b){var c=this,d=this,e=!1;return b=a(b).map(function(b,f){var g=d.displayText(f);return b=a(c.options.item).data("value",f),b.find("a").html(c.highlighter(g)),g==d.$element.val()&&(b.addClass("active"),d.$element.data("active",f),e=!0),b[0]}),this.autoSelect&&!e&&(b.first().addClass("active"),this.$element.data("active",b.first().data("value"))),this.$menu.html(b),this},displayText:function(a){return a.name||a},next:function(b){var c=this.$menu.find(".active").removeClass("active"),d=c.next();d.length||(d=a(this.$menu.find("li")[0])),d.addClass("active")},prev:function(a){var b=this.$menu.find(".active").removeClass("active"),c=b.prev();c.length||(c=this.$menu.find("li").last()),c.addClass("active")},listen:function(){this.$element.on("focus",a.proxy(this.focus,this)).on("blur",a.proxy(this.blur,this)).on("keypress",a.proxy(this.keypress,this)).on("keyup",a.proxy(this.keyup,this)),this.eventSupported("keydown")&&this.$element.on("keydown",a.proxy(this.keydown,this)),this.$menu.on("click",a.proxy(this.click,this)).on("mouseenter","li",a.proxy(this.mouseenter,this)).on("mouseleave","li",a.proxy(this.mouseleave,this))},destroy:function(){this.$element.data("typeahead",null),this.$element.data("active",null),this.$element.off("focus").off("blur").off("keypress").off("keyup"),this.eventSupported("keydown")&&this.$element.off("keydown"),this.$menu.remove()},eventSupported:function(a){var b=a in this.$element;return b||(this.$element.setAttribute(a,"return;"),b="function"==typeof this.$element[a]),b},move:function(a){if(this.shown){switch(a.keyCode){case 9:case 13:case 27:a.preventDefault();break;case 38:if(a.shiftKey)return;a.preventDefault(),this.prev();break;case 40:if(a.shiftKey)return;a.preventDefault(),this.next()}a.stopPropagation()}},keydown:function(b){this.suppressKeyPressRepeat=~a.inArray(b.keyCode,[40,38,9,13,27]),this.shown||40!=b.keyCode?this.move(b):this.lookup()},keypress:function(a){this.suppressKeyPressRepeat||this.move(a)},keyup:function(a){switch(a.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}a.stopPropagation(),a.preventDefault()},focus:function(a){this.focused||(this.focused=!0,this.options.showHintOnFocus&&this.lookup(""))},blur:function(a){this.focused=!1,!this.mousedover&&this.shown&&this.hide()},click:function(a){a.stopPropagation(),a.preventDefault(),this.select(),this.$element.focus()},mouseenter:function(b){this.mousedover=!0,this.$menu.find(".active").removeClass("active"),a(b.currentTarget).addClass("active")},mouseleave:function(a){this.mousedover=!1,!this.focused&&this.shown&&this.hide()}};var c=a.fn.typeahead;a.fn.typeahead=function(c){var d=arguments;return"string"==typeof c&&"getActive"==c?this.data("active"):this.each(function(){var e=a(this),f=e.data("typeahead"),g="object"==typeof c&&c;f||e.data("typeahead",f=new b(this,g)),"string"==typeof c&&(d.length>1?f[c].apply(f,Array.prototype.slice.call(d,1)):f[c]())})},a.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu" role="listbox"></ul>',item:'<li><a href="#" role="option"></a></li>',minLength:1,scrollHeight:0,autoSelect:!0,afterSelect:a.noop,addItem:!1,delay:0},a.fn.typeahead.Constructor=b,a.fn.typeahead.noConflict=function(){return a.fn.typeahead=c,this},a(document).on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(b){var c=a(this);c.data("typeahead")||c.typeahead(c.data())})});; 
; 
(function($){
	$.fn.obpmTabNormalField =function(){
		return this.each(function(){

			var $curPage = ajaxPage.getCurPage();
			var pageId = $curPage.attr("id");
			if($curPage.find("#form_tab > a[name=baseInfo]").size() == 0){
				$curPage.find("#form_tab").append('<a name="baseInfo" class="control-item swiper-slide active" href="#tabInfo_'+pageId+'" style="width:auto;" title="基本信息">基本信息</a>')
				.show();
				//$curPage.find(".contact-form").css("padding-top","52px");
				$curPage.find("#form_continer>span[data-id='item1mobile']").attr("id","tabInfo_"+pageId);
			}

			var $field = jQuery(this);
			$field.removeAttr("moduleType");
			
			//选项卡嵌套时递归重构
			$field.find("[moduleType='TabNormal']").filter(function(){
				return (jQuery(this).parents("[moduleType='TabNormal']").size() == 0);
			}).obpmTabNormalField();  		//页签选项卡
			//选项卡嵌套时递归重构
			$field.find("[moduleType='TabCollapse']").filter(function(){
				return (jQuery(this).parents("[moduleType='TabCollapse']").size() == 0);
			}).obpmTabCollapseField();  		//折叠选项卡
			
			var html = "";
			// title
			var $fieldTitle = $field.find("[id='title']");

			var tabId=$field.attr("tabId");
			var fieldId=$fieldTitle.attr("fieldId");

			$fieldTitle.find("div").each(function(){
				var formId=$(this).attr("formId");
				var isHidden=$(this).attr("isHidden");
				var isRefresh=$(this).attr("isRefreshOnChanged");
				var name=$(this).attr("name");
				isRefresh = (isRefresh == "true");
				isHidden = (isHidden == "true");
								
				// 判断选项卡内是否含有非包含元素的控件
				var style = "";
				if(isHidden){
					style = "display:none;";
				}
			
				var $tab = $curPage.find("#content_"+formId);
				if($tab.length==0){
					var $tab = $field.find(".tabcontainer").find(">div[formId='"+formId+"']");
					$newTab = $('<span id="content_'+formId+'" class="control-content"></span>').append($tab.addClass("contact-form"));
                    var $newTabNav = $('<a _tid='+formId+' class="control-item swiper-slide" href="#content_'+formId+'" style="'+style+'" title="'+name+'">'+name+'</a>').on('touchend',function(){
                        window.scroll(0,0);
					});
                    $curPage.find("#form_tab").append($newTabNav);
                    $curPage.find("#form_continer").append($newTab);
                    $curPage.find("#form_continer").find("[moduleType='IncludedView']").obpmIncludedView();


                }

			});
			
			
			

			

			//页签切换选项--start
			var tabBox_width = 0;
			var tab_num = $curPage.find("#form_tab").find(".control-item").size();
			for(var i=0;i < tab_num;i++){
				$curPage.find(".segmented-control").removeAttr("style");
				var $tabItem = $curPage.find("#form_tab").find(".control-item:eq("+i+")");
				$tabItem.width("auto");
				var tabItemWidth = $tabItem.outerWidth();
				if($tabItem.is(":visible")){
					$tabItem.css("display","block");
				}else{
					$tabItem.attr("data-isHide","true").css("display","block");
					
					tabItemWidth = $tabItem.outerWidth()
					
					$tabItem.css("display","none");
				}
				tabBox_width = tabItemWidth + tabBox_width;
			}
			
			$curPage.find(".tab-box").width($(window).width());
			$curPage.find(".segmented-control").removeAttr("style");
			

			if(tab_num <= 1){
				$curPage.find("#form_tab").find("[_tid]").hide();
				$curPage.find("#form_tab").find("a[name='baseInfo']").hide();
				$curPage.find(".control-content").css("padding-top","0px")
			}else{
				var fixTopHeight = $curPage.find(".fix_top_panel").outerHeight();
				$curPage.find("#form_continer").css("padding-top",fixTopHeight);
			}

			var btnNum = $curPage.find("#div_button_box input[moduletype='activityButton']").size();
			if(btnNum > 0){
				$curPage.find(".control-content .contact-form").css("padding-bottom","57px");
			}
			
			$field.parent().attr("data-type","tab");
			var spanSize = $curPage.find("#_formHtml").find(">span").not("span[data-type='tab']").size();
			
			if(spanSize <= 0){
				$curPage.find("#form_tab").find("[name='baseInfo']").removeClass("active").hide();
				var $firstTabNav;
				$curPage.find("#form_tab a:visible").each(function(i){
					if(i == 0){
						$firstTabNav = $(this);
					}
				})
				var contentId = $firstTabNav.attr("href");
				$firstTabNav.addClass("active");
				
				$curPage.find(contentId).parent().find(">span").removeClass("active");
				$curPage.find(contentId).addClass("active");
			}
			
			if(tabBox_width <= $(window).width()){
				$curPage.find(".segmented-control").css("display","table");
				$curPage.find("#form_tab .control-item:visible").css("display","table-cell");
			}else{				
				$curPage.find(".segmented-control").width(tabBox_width);
				$curPage.find("#form_tab .control-item:visible").css("display","block");
				$curPage.find("#form_tab .control-item[data-isHide='true']").css("display","block");
				if(isiOS){
					var swiper = new Swiper('#'+pageId+' .swiper-container', {
				        slidesPerView: 'auto',
				        spaceBetween: 0,
				        freeMode: true
				    });
				}else{
					$curPage.find("#form_tab").parent().css("overflow","auto");
				}
				
				$curPage.find("#form_tab .control-item[data-isHide='true']").css("display","none");
			}
		});
	};

	$.fn.obpmTabCollapseField =function(){
		return this.each(function(){

			var $field = jQuery(this);
			var $fieldTitle = $field.find("[id='title']");
			var $fieldContent = $field.find("[id='content']");
			var fieldId = $fieldTitle.attr("fieldId");

			var data = {
				fieldId : fieldId,
				list_title : [],
				list_content : []
			}
			
			$fieldTitle.each(function(){
				var formId=$(this).attr("formId");
				var isHidden=$(this).attr("isHidden");
				var isRefresh=$(this).attr("isRefreshOnChanged");
				var name=$(this).attr("tabname");
				
				var list_title = {
					"formid" : formId,
					"ishidden" : isHidden,
					"isrefreshonchanged" : isRefresh,
					"name" : name
				}
				data.list_title.push(list_title);
			});

			$fieldContent.each(function(){
				var formId=$(this).attr("formId");
				var isHidden=$(this).attr("isHidden");
				var content = $(this).html();	
				
				var list_content = {
					"formid" : formId,
					"ishidden" : isHidden,
					"content" : content
				}
				data.list_content.push(list_content);
			});
			var $html = $(template("tabCollapse-tmpl", data));
			
			$field.after($html);
			$field.remove();
			
			jQuery("div[moduleType='TabNormal']").filter(function(){
				return (jQuery(this).parents("div[moduleType='TabNormal']").size() == 0);
			}).obpmTabNormalField(); 
		});
	};
})(jQuery);

//兼容刷新重计算时选项卡的刷新方法--膏药
var ddtabmenu = ddtabmenu || {};
ddtabmenu.showMenus = function(tabid, menuids){
	var noTabShow = true;//记录是否有tab被选中
	for (var i = 0; i < menuids.length; i++) {
		var $menu = $("a[_tid='"+menuids[i]+"']");
		var $content = $("#content_" + menuids[i]);
		$menu.show();
		if($menu.hasClass("active")){
			$content.show();
			noTabShow = false;
		}
	}
};
ddtabmenu.definemenu = function(){};
ddtabmenu.hideMenus = function(tabid, menuids){
	for (var i = 0; i < menuids.length; i++) {
		var $menu = $("a[_tid='"+menuids[i]+"']");
		var $content = $("#content_" + menuids[0]);
		$menu.hide();
		$content.removeClass("active");
	}
};
ddtabmenu.showsubmenuById = function(tabid, targetId){
	var menuitems=this[tabid+"-menuitems"];
 	if (!menuitems) {
 		return;
 	}
 	//当所有选项都隐藏时，没有默认选中项
 	if(targetId != ""){
 		ddtabmenu.showsubmenu(tabid, document.getElementById(targetId));
 	}
};


/**
 * 选中某一个页签
 * @param {} tabid
 * @param {} targetitem 目标页签
 */
ddtabmenu.showsubmenu = function(tabid, targetitem){
	if(document.getElementById("tabid")){
		var tempTabid = document.getElementById("tabid").value;
		if(tempTabid == ""){ 
			document.getElementById("tabid").value = tabid + "#" + targetitem.getAttribute("id");
		}else{
			var ids = document.getElementById("tabid").value.split(";");
			var flag = true;
			for(var i=0; i<ids.length; i++){
				var _ids = ids[i].split("#");
				if(tabid == _ids[0]){
					_ids[1] = targetitem.getAttribute("id");
					ids[i] = _ids.join("#");
					flag = false;
					break;
				}
			}
			
			if(flag){
				document.getElementById("tabid").value = tempTabid + ";" + tabid + "#" + targetitem.getAttribute("id");
			}else{
				document.getElementById("tabid").value = ids.join(";");
			}
		}
	}
	var menuitems=this[tabid+"-menuitems"];
 	if (!menuitems) {
 		return;
 	}
	// 运行计算时使用同步,使用了DWR库
	DWREngine.setAsync(false);
	if(targetitem != null)
		eval(targetitem.callback);
	DWREngine.setAsync(true);
	
	for (i=0; i<menuitems.length; i++){
		
		if (menuitems[i].getAttribute("rel")){
			if(document.getElementById(menuitems[i].getAttribute("rel")).style.display=='block'){
				menuitems[i].className="";
				document.getElementById(menuitems[i].getAttribute("rel")).style.display="none";
			}
		}
	}
	if (targetitem) {
		if (targetitem.getAttribute("rel")){
			var id =targetitem.getAttribute("rel");
		}
		var oContent = document.getElementById(targetitem.getAttribute("rel"));

		if(oContent != null || oContent != undefined){
			if(oContent.style.display !='block'){
				targetitem.className="current";
				oContent.style.display="block";
				
				//jack for iframe lazy load
				jQuery(oContent).find("[moduleType='IncludedView']").obpmIncludedView();
			}
		}
		var isloaded = oContent!=null?oContent.isloaded:false;
	}
	//选项卡iframe中引用（前台管理界面）时重新加载一次iframe页面，以解决宽高问题。
	var iframeObj = document.getElementsByTagName("iframe")[0];
	if(iframeObj){
		if(typeof iframeObj.contentWindow.adjustUserSetupPageLayout=="function"){
			iframeObj.contentWindow.document.location.reload(); 
		};
	}
}; 
; 
(function($){
	$.fn.obpmPending=function(){
		return this.each(function(){
			var $field =jQuery(this);
			var id = $field.attr("id");
			var formId = $field.attr("formId");
			var summaryCfgId = $field.attr("summaryCfgId");
			var Summary = $field.attr("Summary");
			var isread = $field.attr("isread");
			isread =(isread=="true");
			var html="";
			
			var clsName = "";
			var pngName = "";
			
			if(isread){
				clsName = "pd";
				pngName = "16x16_0700/pencil";
				alt = "己读";
			}else{
				clsName = "pdread";
				pngName = "16x16_0380/email_edit";
				alt = "未读";
			}

			html+="<a title='" + alt + "' class='" + clsName + "' href=\"javaScript:viewDoc('" + id + "', '" + formId + "','" + summaryCfgId + "')\" " +
					"style='background:url(\"../../lib/icon/" + pngName + ".png" + "\") " +
							"no-repeat;display: block;background-position: 0 50%;padding-left: 20px;margin-bottom:5px;'>";
			html+="&nbsp;" + Summary + "&nbsp;";
			html+="</a>";
			jQuery(html).replaceAll($field);
				
		});
	};
})(jQuery);; 
/**
 * 选择当前节点审批人
 * 
 * @param {}
 *            actionName
 * @param {}
 *            fieldId
 */
function selectField(actionName, fieldId) {
	var oCurridArray = document.getElementsByName("_currid");
	// 当前节点ID
	var currid = '';
	if (oCurridArray && oCurridArray.length > 0) {
		currid = oCurridArray[0].value;
	}
	// 目标文本框
	var oFiled = document.getElementById(fieldId);
	if (oFiled) {
		var map = oFiled.value ? jQuery.parseJSON(oFiled.value) : {};
		
		var defValue = oFiled.value;
		var rtn = showUserSelectNoFlow('', {
					defValue: map[currid],
					callback: function(result) {
						// prototype1_6.js
						if (result) {
							var userlist = result.split(",");
							// 为当前节点设置
							map[currid] = userlist;
							oFiled.value = jQuery.json2Str(map);
						}
					}
				});
	}
}

/**
 * 选择用户
 * 
 * @param {}
 *            actionName
 * @param {}
 *            settings
 */
function showUserSelectNoFlow(actionName, settings, roleid) {
	var oApp = document.getElementsByName("application")[0];
	//var url = contextPath + "/portal/phone/resource/component/dialog/selectUserByAll.jsp?application="+oApp.value;
	var url = contextPath + "/contacts/index.jsp?mode=select";
	var setValueOnSelect = true;
	if (settings.setValueOnSelect == false) {
		setValueOnSelect = settings.setValueOnSelect;
	}
	
	OBPM.dialog.show({
				width : 610,
				height : 450,
				url : url,
				args : {
					// p1:当前窗口对象
					"parentObj" : window,
					// p2:存放userid的容器id
					"targetid" : settings.valueField,
					// p3:存放username的容器id
					"receivername" : settings.textField,
					// p4:默认选中值, 格式为[userid1,userid2]
					"defValue": settings.defValue,
					//是否多选模式
					"multiple": true,
					//选择用户数
					"limitSum": settings.limitSum,
					//选择模式
					"selectMode":settings.selectMode,
					// 存放userEmail的容器id
					"receiverEmail" : settings.showUserEmail,
					// 存放userEmail的容器id
					"receiverEmailAccount" : settings.showUserEmailAccount,
					// 存放userTelephone的容器id
					"receiverTelephone" : settings.showUserTelephone
				},
				title : title_uf,
				close : function(rtn) {
					if(rtn){
						if(rtn.state == "success"){
		//					var textObj = document.getElementById(settings.textField);
		//					if(textObj != null){
		//						textObj.style.border = "1px solid #ff0000";
		//					}
							var result = rtn.data;
							if(result){
								var rtnValue = "";
								for(var i = 0; i < result.length; i++){
									rtnValue += result[i].value + ';';
								}
								var rtnText = "";
								for(var i = 0; i < result.length; i++){
									rtnText += result[i].text + ';';
								}
								rtnValue = rtnValue.substring(0,rtnValue.length-1);
								rtnText = rtnText.substring(0,rtnText.length-1);
								$("#"+settings.valueField).val(rtnValue);
								$("#"+settings.textField).val(rtnText);
							}
							if (settings.callback) {
								if(typeof settings.callback == "function"){
									settings.callback(rtnValue);
								}else{//用户选择框控件
									eval(settings.callback);
								}
							}
						}
					}
				}
			});
}

/**
 * 选择部门
 * 
 * @param {}
 *            actionName
 * @param {}
 *            settings
 */
function showDepartmentSelect(actionName, settings) {
	var url = contextPath + '/portal/phone/resource/component/dialog/select.jsp';
	var valueField = document.getElementById(settings.valueField);
	var value = "";
	if (valueField) {
		value = valueField.value;
	}
	// 使用jquery-adapter
	OBPM.dialog.show({
				width : 300,
				height : 400,
				url : url,
				args : {
					value : value,
					readonly : settings.readonly,
					limit : settings.limit
				},
				title : title_df,
				close : function(result) {
					var textObj = document.getElementById(settings.textField);
//					if(textObj != null){
//						textObj.style.border = "1px solid #ff0000";
//					}
					var rtn = result;
					var field = document.getElementById(settings.textField);
					if (field) {
						if (rtn) {
							if(rtn =="clear"){// 清空
								field.value = '';
								valueField.value = '';
							}else{
								var rtnValue = '';
								var rtnText = '';

								if (rtn[0] && rtn.length > 0) {
									for (var i = 0; i < rtn.length; i++) {
										rtnValue += rtn[i].value + ";";
										rtnText += rtn[i].text + ";";
									}

									rtnValue = rtnValue.substring(0, rtnValue
													.lastIndexOf(";"));
									rtnText = rtnText.substring(0, rtnText
													.lastIndexOf(";"));
								}
								field.value = rtnText;
								valueField.value = rtnValue;
							}
						}

						if (settings.callback) {
							settings.callback(valueField.name);
						}
					}
					
				}
			});
}
; 
jQuery.extend({
	par2Json : function(string,overwrite){//param to json
		var obj = {}, pairs = string.split('&'), d = decodeURIComponent, name, value;
		jQuery.each(pairs, function(i, pair) {
			pair = pair.split('=');
			name = d(pair[0]);
			value = pair[1];
			obj[name] = overwrite || !obj[name] ? value : [].concat(obj[name])
					.concat(value);
		});
		return obj;
	},

	json2Par : function(o, pre) {//json to param
		var undef, buf = [], key, e = encodeURIComponent;
		for (key in o) {
			undef = o[key] == 'undefined';
			$.each(undef ? key : o[key], function(val, i) {
				buf.push("&", e(key), "=", (val != key || !undef) ? e(val) : "");
			});
		}
		if (!pre) {
			buf.shift();
			pre = "";
		}
		return pre + buf.join('');
	},
	
	obj2Str : function(o){//obj to str
		var r = [];
		if (typeof o == "string" || o == null) {
			return o;
		}
		if (typeof o == "object") {
			if (!o.sort) {
				r[0] = "{";
				for ( var i in o) {
					var str = HTMLEncode(jQuery.obj2Str(o[i]));
					
					r[r.length] = "\"" + i + "\"";
					r[r.length] = ":";
					r[r.length] = "\"" + str + "\"";
					r[r.length] = ",";
				}
				r[r.length - 1] = "}";
			} else {
				r[0] = "[";
				for ( var i = 0; i < o.length; i++) {
					r[r.length] = jQuery.obj2Str(o[i]);
					r[r.length] = ",";
				}
				r[r.length - 1] = "]";
			}
			return r.join("");
		}
		return o.toString();
	},
	json2Str: function(o) { //json数组转换成json字符串
        if (o == undefined) {
            return "";
        }
        var r = [];
        if (typeof o == "string") return "\"" + o.replace(/([\"\\])/g, "\\$1").replace(/(\n)/g, "\\n").replace(/(\r)/g, "\\r").replace(/(\t)/g, "\\t") + "\"";
        if (typeof o == "object") {
            if (!o.sort) {
                for (var i in o)
                    r.push("\"" + i + "\":" + jQuery.json2Str(o[i]));
                if (navigator.userAgent.indexOf("MSIE 9.0")<0 && !!document.all && !/^\n?function\s*toString\(\)\s*\{\n?\s*\[native code\]\n?\s*\}\n?\s*$/.test(o.toString)) {
                    r.push("toString:" + o.toString.toString());
                }
                r = "{" + r.join() + "}";
            } else {
                for (var i = 0; i < o.length; i++)
                    r.push(jQuery.json2Str(o[i]));
                r = "[" + r.join() + "]";
            }
            return r;
        }
        return o.toString().replace(/\"\:/g, '":""');
    },
	  jQueryValues: function(object) {
	    var values = [];
	    for (var property in object)
	      values.push(object[property]);
	    return values;
	  }
});

jQuery.cachedScript = function( url, options ) {
 
  // Allow user to set any option except for dataType, cache, and url
  options = $.extend( options || {}, {
    dataType: "script",
    cache: true,
    url: url
  });
 
  // Use $.ajax() since it is more flexible than $.getScript
  // Return the jqXHR object so we can chain callbacks
  return jQuery.ajax( options );
};
 
; 
var OBPM = top.jQuery;
(function($) {
	// 弹出框 
	OBPM.dialog = OBPM.dialog ? OBPM.dialog : {
		_allOptions: [],
		opts : {
			args:{},					//弹出层中通过args参数名传过来的参数(兼容原弹出层插件)
			content: '',				// 消息内容
			title: '',					// 标题. 默认'消息'
			button: null,				// 自定义按钮
			ok: null,					// 确定按钮回调函数
			cancel: null,				// 取消按钮回调函数
			init: null,					// 对话框初始化后执行的函数
			close: null,				// 对话框关闭前执行的函数
			okVal: '\u786E\u5B9A',		// 确定按钮文本. 默认'确定'
			cancelVal: '\u53D6\u6D88',	// 取消按钮文本. 默认'取消'
			width: '',					// 内容宽度
			height: '',					// 内容高度
			minWidth: 96,				// 最小宽度限制
			minHeight: 32,				// 最小高度限制
			padding: '20px 25px',		// 内容与边界填充距离
			skin: '',					// 皮肤名(预留接口,尚未实现)
			icon: '',					// 消息图标名称
			time: null,					// 自动关闭时间
			esc: true,					// 是否支持Esc键关闭
			focus: true,				// 是否支持对话框按钮自动聚焦
			show: true,					// 初始化后是否显示对话框
			follow: null,				// 跟随某元素(即让对话框在元素附近弹出)
			path: '',					// artDialog路径
			lock: true,					// 是否锁屏
			background: '#000',			// 遮罩颜色
			opacity: 0.5,				// 遮罩透明度
			duration: 300,				// 遮罩透明度渐变动画速度
			fixed: true,				// 是否静止定位
			left: '0%',				// X轴坐标
			top: '0%',				// Y轴坐标
			zIndex: 1987,				// 对话框叠加高度值(重要：此值不能超过浏览器最大限制)
			resize: true,				// 是否允许用户调节尺寸
			drag: true					// 是否允许用户拖动位置
		},
		/**
		 * 显示弹出框
		 */
		show : function(options) {
			if(!options.args)options.args = {};
			
			//初始化时最大化
			if(options.maximization == true){
				options.height = $(top.window).height()-50;
				options.width = $(top.window).width();
			}
			
			
			//宽度和高度值处理
			if(options.width && options.width>0){
				options.width = options.width+"";	//转成字符
				options.width = (options.width.indexOf("%")>0 && options.width.indexOf("px")>0)?options.width:(options.width+"px");
			}
			if(options.height && options.height>0){
				options.height = options.height+"";	//转成字符
				options.height = (options.width.indexOf("%")>0 && options.width.indexOf("px")>0)?options.height:(options.height+"px");
			}

			//设置args参数
			//artDialog.data("args",options.args);
			
			//打开弹出层
			//artDialog.open(options.url,options,false);
			//this.hideWord();
			var $body = $(top.document).find("body");
			var _index = $body.find(".dialog").size() + 1000 + 1;
			
			this._allOptions[_index] = options;
			
			$body.append("<div id='dlg_"+_index+"' class='modal modal-iframe dialog' style='z-index:"+_index+"'></div>")
			$body.find("#dlg_"+_index).addClass("active");
			$body.find("#dlg_"+_index).append("<header class='bar bar-nav'><span id='close' data-ignore='push' class='icon icon-left-nav pull-left'></span><h1 class='title'>"+options.title+"</h1></header>");
			
			var closeObj = document.getElementById('close');
			closeObj.addEventListener('touchend', function(event) {
				event.preventDefault();
				OBPM.dialog.doExit();
			}, false);
			
			var ts = + new Date;
			if(!options.args.url){
				var ret = options.url.replace(/([?&])_=[^&]*/, "$1_=" + ts );
					url = ret + ((ret === options.url) ? (/\?/.test(options.url) ? "&" : "?") + "_=" + ts : "");
			}else{
				var ret = options.args.url.replace(/([?&])_=[^&]*/, "$1_=" + ts );
					url = ret + ((ret === options.args.url) ? (/\?/.test(options.args.url) ? "&" : "?") + "_=" + ts : "");
			}
			$body.find("#dlg_"+_index).append("<div class='content' " +
					"style=''>" +
					"<iframe src='"+url+"' frameborder='0' allowtransparency='true' " +
							"style='position:absolute;z-index:1;top:0px;width: 100%; height: 100%; border: 0px none;'></iframe>" +
							"</div>");
			var pageYoffset = window.pageYOffset;
			
			$("#document_content").hide();
			$("#myModalexample").hide();
			$("#dlg_"+_index).find(".content").css({"position":"static","height":$(window).height()-44})
			$("#dlg_"+_index).find(".content>iframe").css({"position":"absolute","z-index":"1","top":"44px","height":$(window).height()-44})			
			
			$body.find("#dlg_"+_index).find(">div>iframe").load(function(){
				options._pageYOffset = pageYoffset;
				//window.scrollTo(0,0);
				});
			this.setHash();
		},
		/**
		 * 打开时设置hash
		 */
		setHash : function(){
			ajaxPage.addHashPostfix("popUpLayer");
		},
		/**
		 * 关闭时重置hash
		 */
		resetHash : function(){
			ajaxPage.clearHashPostfix("popUpLayer");
		},
		/**
		 * 打开弹出层时隐藏处于显示状态的word控件
		 */
		hideWord : function(){
			//嵌入表单的word控件
			jQuery("iframe[type=word]").each(function(){
				if(jQuery(this).css("display")!="none"){
					jQuery(this).attr("artDialogHide","true").css("display","none");
				}
			});
			//包含元素中嵌入的word控件
			jQuery("iframe").contents().find("iframe[type=word]").each(function(){
				if(jQuery(this).css("display")!="none"){
					jQuery(this).attr("artDialogHide","true").css("display","none");
				}
			});
			//弹出层显示的word控件中点击印章管理等弹出层时
			jQuery("#editmain_right").attr("artDialogHide","true").css("display","none");
		},
		/**
		 * 设置返回值并关闭窗口
		 */	
		doReturn : function(result) {
			var $body = $(top.document).find("body");
			var _index = $body.find(".dialog").size() + 1000;
			var _options = this._allOptions[_index] ;
			this.doExit(result);
		},

		doExit : function(result) {
			var $body = $(top.document).find("body");
			var _index = $body.find(".dialog").size() + 1000;
			var _options = this._allOptions[_index] ;

			if (_options && _options.close) {
				var fn = _options.close;					
				if (typeof fn === 'function' && fn.call(this, result) === false) {
					return;
				};
			}
			$("#document_content").show();
			$("#myModalexample").show();
			if(_options){
				window.scrollTo(0, _options._pageYOffset);
			}
			
			var $dialog_box = $body.find("#dlg_"+_index);
			$dialog_box.removeClass("active");
			$dialog_box.remove();
			this.resetHash();
		},

		doClear : function(val) {
			if(!val){
				val = "";
			}
			var $body = $(top.document).find("body");
			var _index = $body.find(".dialog").size() + 1000;
			var _options = this._allOptions[_index] ;
			if (_options && _options.close) {
				var fn = _options.close;					
				if (typeof fn === 'function' && fn.call(this, val) === false) {
					return;
				};
			}
			
			this.doExit();
		},

		//doClearUpload : function() {// 清空文件上传
		//	var winArtDialog = artDialog.getOpenApi();
		//	winArtDialog.close('clear');
		//},

		/**
		 * 获取弹出框参数
		 */
		getArgs : function() {
			var $body = $(top.document).find("body");
			var _index = $body.find(".dialog").size() + 1000;
			var _options = this._allOptions[_index] ;
			return _options.args;
		},

		/**
		 * 调整弹出框高度宽度, 小于等于-1表示不更改
		 */
		resize : function(width, height) {
		}
	};
})(jQuery);; 
/**
 * phone 皮肤弹出层组件、在页面上已单例的形式存在
 */
var MyPopup = MyPopup || {
	
	_initialized : false,
	
	_modal : undefined,
	
	_callback : undefined,
	
	init : function(){
		//MyPopup.cache.clear();
		this._modal = $("#myModalexample");
		
		$("#myModalexample").on("popup",function(e){
			alert('popup');
		});

		$("#myModalexample").on("close",function(e){
			$(this).removeClass("active");
			if(MyPopup._callback && typeof MyPopup._callback == "function"){
				MyPopup._callback();
			}
		});
		
		
		
	},
		
	open : function(settings){
		settings = settings || {};
		var url = settings.url;
		var title = settings.title;
		var successCallback = settings.success;
		var closeCallback = settings.close;
		var options = settings.options || {};
		MyPopup._callback = successCallback;
		//MyPopup.cache.set("success",successCallback);
		$("#myModalexample .title").html(title);
		$("#myModalexample").find("iframe").attr("src",url);
		$("#myModalexample").addClass("active");
	},
	
	MyPopupClose : function(){
		Activity.closeWindow();
	},
	
};

/**
 * 缓存
 */
MyPopup.cache = {
	
		get:function(key){
			var top = window.top, 
			cache = top['_CACHE'] || {}; 
			top['_CACHE'] = cache;
			return cache[key];
		},
		
		set:function(key,value){
			var top = window.top, 
			cache = top['_CACHE'] || {}; 
			top['_CACHE'] = cache;
			cache[key]=value;
		},
		clear:function(key){
			var top = window.top, 
			cache = top['_CACHE'] || {}; 
			top['_CACHE'] = cache;
			if(cache[key]) delete cache[key];
			if(!key) top['_CACHE'] = {};
		}
};

//if(!MyPopup._initialized){
//	$(document).ready(function(){
//		$("body").append('<div id="myModalexample" class="modal modal-iframe">'+
//				  '<header class="bar bar-nav">'+
//				    '<a class="icon icon-close pull-right" id="btn-modal-close" onclick="MyPopup.MyPopupClose()"></a>'+
//				    '<h1 class="title">创建</h1>'+
//				  '</header>'+
//				  '<div class="content">'+
//				    '<iframe src="about:blank" width="100%" height="100%"></iframe>'+
//				  '</div>'+
//				'</div>');
//		MyPopup.init();
//		MyPopup._initialized = true;
//	});
//	
//}; 
(function($) {
	$.fn.obpmButton = function() {
		return this
				.each(function() {
					var $btn = jQuery(this);
					var val = $btn.attr("value");
					var activityType = $btn.attr("activityType");

					// 29:批量签章;43:跳转
					// 嵌入视图不使用批量签章和跳转按钮
					if ((activityType == "29" || activityType == "43")
							&& typeof DisplayView == 'object'
							&& DisplayView.getTheView(this)) {
						$btn.remove();
						return;
					}
					/*
					 * activityType: 已完成： 新建:2; 删除:3; 提交:5; 返回:10; 保存并返回:11;
					 * 未完成： 查询Document:1; 保存并启动流程:4; SCRIPT处理:6; 关闭:8; 保存并关闭窗口:9;
					 * 返回:10; 保存并返回:11; 无:13; 打印:14; 连同流程图一起打印:15; 导出Excel:16; 保存并新建:17;
					 * 保存草稿不执行校验:19; 批量审批按钮:20; 保存并复制:21; 查看流程图:22; PDF导出:25;
					 * 文件下载:26; Excel导入:27; 电子签章:28; 批量电子签章:29; 跳转操作:32;
					 * 启动流程:33; 保存:34; 视图打印:36; 转发:37; Dispatcher:39; 保存并新建:42; 跳转:43;
					 * 归档:45; 不再使用： 修改Document:7; 关闭窗口:8;
					 * 保存并新建(新建有一条有旧数据Document):12; 清掉所有这个form的数据: 18;
					 * FLEX打印:30; FLEX带流程历史打印:31;
					 */

					switch (activityType) {
					case "1":
					case "2":
					case "5":
						activityCss = "btn-primary";
						break;
					case "3":
						activityCss = "btn-negative";
						break;
					case "4":
					case "11":
					case "19": 
					case "21": 
					case "34":
					case "42":
						activityCss = "btn-positive";
						break;
					case "8":
						activityCss = "btn-orange";
						break;
					default:
						activityCss = "";
						break;
					}
					
					//按钮样式，默认值则保持不变
					switch($btn.attr("colorType")){
					case "primary":
						activityCss = "btn-primary";
						break;
					case "success":
						activityCss = "btn-positive";
						break;
					case "info":
						break;
					case "warning":
						activityCss = "btn-orange";
						break;
					case "danger":
						activityCss = "btn-negative";
						break;
					default:
						break;
					}

					if (activityType != "5"
							&& (activityType == 1 || activityType == 2 || activityType == 3
									|| activityType == 4
									|| activityType == 34
									|| activityType == 8
									|| activityType == 10
									|| activityType == 11 || activityType == 13
									|| activityType == 21 || activityType == 42 || activityType == 19)) {// 当按钮类型为5（流程处理）时，不做处理，具体渲染工作交由flowprcss.jsp完成

						var onclick = this.onclick;
						var $btnN = jQuery(
								"<td><a class='btn " + activityCss
										+ " btn-block' data-transition='fade' title='"+val+"'>"
										+ val + "</a></td>").click(onclick);

						$btnN.insertAfter($btn);
						$btn.remove();
					} else if (activityType != "5") {
						$btn.remove();
					}
				});
	};
})(jQuery);; 
/**
 * 前台皮肤表单页面私有
 */
var activityAction = contextPath + '/portal/dynaform/activity/action.action';
var printAction = contextPath + '/portal/dynaform/document/print.action';

var OPEN_TYPE_DIV = 0x0000115;

/**
 * save and start workflow button
 */
var SAVE_SARTWORKFLOW = 4;
/**
 * 按钮类型保存并新建(新建有一条有旧数据Document)
 */
var SAVE_NEW_WITH_OLD=12;
/**
 * 按钮类型为保存并新建(新建一条空Document)
 */
var SAVE_NEW_WITHOUT_OLD = 17;
/**
 * 按钮类型为更新Document.
 */
var DOCUMENT_UPDATE = 34;

/**
 * 按钮类型为关闭窗口.
 */
var CLOSE_WINDOW = 8;
/**
 * 按钮类型为跳转.
 */
var JUMP = 32;
/**
 * 按钮类型为跳转页面.
 */
var JUMP_PAGE = 39;
/**
 * 按钮类型为转发.
 */
var DISPATCHER  = 37;
/**
 * 按钮类型为返回.
 */
var BACK = 10;
/**
 * 离开表单页面是否检验
 */
var fieldValChanged = false;

/**
 * 表单修改后，是否保存
 */
function ifSubSaveForm(){
	var ifSubSave = true;
	jQuery("#toAll").find("iframe[name='display_view']").each(function(){
		var $conWin = jQuery(this)[0].contentWindow;
		if($conWin && typeof $conWin.getFieldValChanged=="function"){
			if($conWin.getFieldValChanged()){   //表单修改过返回true;
				if(confirm("确实要保存主表单吗?\r\n子表单数据已修改且未保存！\r\n按“确定”继续，或按“取消”留在当前页面。")){
					$conWin.getFieldValChanged(false);
					return false;
				}else{
					ifSubSave = false;
					return false;
				}
			}
		}
	});
	return ifSubSave;
}

function doSave(type, actid) {
	if(isRefreshLoading){	//刷新重计算未执行完时延时保存
		setTimeout(function(){
			doSave(type, actid);
		},200);
		return false;
	}
	var oOperation = document.getElementById("operation");
	if (oOperation) {
		oOperation.value = "doSave";
	}
	ev_action(type, actid);
}

function ev_action(types, actid) {
	ev_action2(types, actid);
}

function ev_action2(type, actid) {
	if(type==10){
		window.history.back();
	}else{
		var url = activityAction;
		if (actid) {
			var view_id = document.getElementById("view_id").value;
			//待办页表单不是弹出框时，关闭窗口的处理
			/*if(view_id==null||view_id.length<1){
				var appid=jQuery("#applicationid").val();
				//location.href=contextPath+"/portal/share/welcome.jsp?application="+appid;
				//return false;
			}*/
			var newUrl = url + '?_activityid=' + actid + '&view_id=' + view_id;
		}
		try {
			$.post(newUrl
					,$(document.forms[0]).serialize()
					,function(result){
			    	//$("span").html(result);
				var keyStr = '<div class="msgSub" msgType="error">';
				var pos = result.indexOf(keyStr);
				if (pos > 0) {
					var msg = result.substring(result.indexOf(keyStr)+keyStr.length);
					msg = msg.substring(0,msg.indexOf('</div>'));

					showMessage("error",'<div class="msgSub" msgType="error">'+ msg + '</div>');
				}
				else {
//					if (result.indexOf("<script>ev_close();</script>") > 0) {
//						ev_close();
//					}
					$("#msg").html(result);
					//alert(result);
					//$(document).html(result);
				}
			});
			
			//document.forms[0].action = newUrl;
			//document.forms[0].submit();
		} catch (ex) {
		}
	}
}

function beforeAct(actTypes){
	var actType = parseInt(actTypes);
	if(actType==CLOSE_WINDOW || actType==JUMP || actType==JUMP_PAGE || actType==DISPATCHER || actType==BACK){
		if(fieldValChanged){//表单内容被修改
			if(!confirm('确实要离开该页面吗?\r\n数据已修改！\r\n按“确定”继续，或按“取消”留在当前页面。')){
				return false;
			}else{
				unbindBeforeUnload();//取消绑定beforeunload事件
			};
		}
	}else{
		unbindBeforeUnload();//取消绑定beforeunload事件
	}
	return true;
}

//ajax执行操作按钮的执行前脚本
function ev_runbeforeScript(actid){
	var flag = false;//执行完脚本后,是否进行下一步提交
	jQuery.ajax({
		type: 'POST',
		async:false, 
		url: contextPath + '/portal/dynaform/activity/runbeforeactionscript.action?_actid=' + actid,
		dataType : 'text',
		timeout: 3000,
		data: ajaxPage.getParams(),
		success:function(result) {
			if(result != null && result != ""){
				result = result.replace(/\n/g,"<br/>");
				result = result.replace(/\r/g,"<br/>");
	        	var jsmessage = eval("(" + result + ")");
	        	var type = jsmessage.type;
	        	var content = jsmessage.content;
	        	
	        	if(type){
	        		if(type == '16'){
		        		alert(content);
		        		flag = false;
		        	}
		        	
		        	if(type == '32'){
		        		var rtn = window.confirm(content);
		        		if(!rtn){
		        			flag = false;
		        		}else {
		        			flag = true;
		        		}
		        	}
	        	}else {
	        		flag = true;
	        	}
	        	
	        	if(flag){
	        		var changedField = jsmessage.changedField;
	        		if(changedField){
	        			var fields = changedField.split(";");
	        			for(var i=0; i<fields.length; i++){
	        				var field = fields[i].split(":");
	        				if(document.getElementsByName(field[0])){
	        					document.getElementsByName(field[0])[0].value = field[1];
	        				}
	        			}
	        		}
	        	}
	        }else {
	        	flag = true;
	        }
		},
		error: function(result) {
			alert("运行脚本出错");
		}
	});
	
	return flag;
}

//查看流程图表
function ev_viewFlow(title) {
	var dateTime = new Date().getTime();
	var _instanceId = document.getElementsByName("content.stateid")[0].value;
	var url = contextPath + "/portal/dynaform/document/viewFlow.action?_docid=" + contentId + "&_instanceId=" + _instanceId + "&dateTime=" + dateTime;
	OBPM.dialog.show({
		width: 600,
		height: 420,
		url: url,
		args: {},
		title: title,
		ok:true,
		okVal:'Close',
		close: function(result) {
			var rtn = result;
		}
	});
}

//查看流程历史
function ev_viewHistory(title) {
	var flag = true;
	var dateTime = new Date().getTime();
	var _instanceId = document.getElementsByName("content.stateid")[0].value;
	var application = document.getElementById("applicationid").value;
	//var url = "<ww:url value='/portal/share/workflow/runtime/flowhis.jsp' />?_docid=<ww:property value='content.id' />&flowStateId=<ww:property value='content.stateid' />&application=<%=dochtmlBean.getDoc().getApplicationid()%>&dateTime=" + dateTime;
	var url = contextPath + "/portal/dynaform/document/showFlowHistory.action?flowStateId=" + _instanceId + "&application=" + application + "&dateTime=" + dateTime;
	//showFrameByDiv(url, '{*[Workflow_History]*}', 700, 550);
	OBPM.dialog.show({
		width: 510,
		height: 540,
		url: url,
		args: {},
		title: title,
		ok:true,
		okVal:'Close',
		close: function(result) {
		}
	});
}

//文件下载
function downloadFile(name,path){
	var url = encodeURI(contextPath + "/portal/dynaform/document/fileDownload.action?filename="+ encodeURI(name) + "&filepath=" + path);
	var _tmpwin = window.open(url,"_blank");
	_tmpwin.location.href = url;
}

//流程挂起
function ev_flowHandup(nodertId){
	unbindBeforeUnload();
	document.forms[0].action = contextPath + '/portal/dynaform/document/flowHandup.action?nodertId=' + nodertId;
	if(toggleButton("button_act")) return false;//提交前把按钮变成灰色
//	makeAllFieldAble();
	document.forms[0].submit();
}

//设置表格高度--兼容ios弹出层打开表单无滚动条
function setHeight(){
	/*var winH = $(window).height();
	$("#card_app").height(winH-57);*/
}

/*
 * 表单公用的初始化方法
 */
function initFormCommon(){
	setHeight();	//设置表格高度--兼容ios弹出层打开表单无滚动条
	//重构表单
	jqRefactor(); //表单控件jquery重构
}

/**
 * Word文档保存
 * @return
 */
function doWordSave(){
	var retvalue = true;
	var objs = document.getElementsByTagName("iframe");
	if (objs) {
		for (var i = 0; i < objs.length; i++) {
			if (objs[i].type) {
				if (objs[i].type == 'word'
						|| objs[i].type.indexOf('word') != -1) {// word文档保存
					isword = true;
					var fieldName = objs[i].fieldName;
					//重新加载word控件
					if (document.frames[objs[i].id] 
					                    && document.frames[objs[i].id].OFFICE_CONTROL_OBJ){
						//document.frames[objs[i].id].init_documenet();
					}
					retvalue = document.frames[objs[i].id].doSave();
					if(retvalue){
						if(retvalue.indexOf("$$")>=0){
							retvalue = false;
							break;
						}else{
							//document.getElementsByName(fieldName)[0].value = retvalue;
							document.getElementsByName("content.versions")[0].value = retvalue;
							retvalue = true;
						}
					}
				}
			}
		}
	}
	return retvalue;
}

/**
 * html编码转换
 * @param str
 * @return
 */
function htmlEncode(str){
   return str.replace(/</g,"&lt;").replace(/>/g,"&gt;");
}

/**
 * 保存时设置值
 * @return
 */
function setHTMLValue(){
	jQuery("textarea[moduleType='htmlEditorSave']").each(function(){
		var ifr = jQuery(this).parent().find(".html-edit-panel");
		if(ifr && ifr.size() > 0){	//只读时不存在iframe，不能修改内容不需要保存
			var str = ifr[0].contentDocument.body.innerHTML;
			jQuery(this).html(htmlEncode(str));
		}
	});
}

//消息提醒
function showMessage(msgType, content) {
	content = jQuery.trim(content);

	if(content != ""){
		/**根据提示信息长度计算倒计时时间--start**/
		var sum = 0;
		var timeSize = 1.2;
		for(var i=0;i<content.length;i++) { 
		    if((content.charCodeAt(i)>=0) && (content.charCodeAt(i)<=255)) {
		      	sum=sum+1;
		    }else {
		      	sum=sum+2;
		    }
		}
		timeSize += (sum>20)?Math.round((sum-20)/10):0;
		/**根据提示信息长度计算倒计时时间--end**/
		
		var $msgObj = jQuery("#msg");
		var $msgBack = jQuery("#msgBack");
		var $msgDivObj = $msgObj.find(".msgSub");
	
		if(!$msgDivObj.size()>0){
			$msgObj.find(".msg-box").append(jQuery('<div class="msgSub"></div>'));
			$msgDivObj = $msgObj.find(".msgSub");
		}
		$msgDivObj.html(content);	//初始化提示内容
		
		//根据提示消息类型改变背景颜色
		if(msgType == "error"){
			$msgObj.find("#tip").html('<span class="icon icon-close"></span>');
		}else{
			$msgObj.find("#tip").html('<span class="icon icon-check"></span>');
		}
		
		$msgBack.show();
		$msgObj.find("#tip")
			.end().addClass("bounceIn").removeClass("bounceOut").show()
			.bind("click",function(){//鼠标点击时隐藏
				$msgObj.addClass("bounceOut").removeClass("bounceIn");
				$msgObj.delay(1200).hide(0);
				$msgBack.hide();
			}).bind("mouseover",function(){
				isOut = false;
			}).bind("mouseout",function(){
				isOut = true;
			});

		//0.8秒后自动隐藏
		setTimeout(function(){
			$msgObj.addClass("bounceOut").removeClass("bounceIn");
			$msgObj.delay(3000).hide(0);
			$msgBack.hide();
		},800);
	}
}
function initSubDoc(){

    if (self != top) {
    	$("#formContent").prepend("<div class='formContent-Box'><div class='formContent-is'></div></div>")
    	$("#formContent>.card_app").each(function(){
    		$(this).appendTo($(".formContent-is"))
    	});
    	$(".formContent-Box").next().appendTo($(".formContent-is"));
		var	screenHeight = window.screen.availHeight
    	var buttonHeight = $("#div_button_box").outerHeight();
    	
    	$("#formContent").css({"position":"absolute","width":"100%","top":"0px","bottom":"0px"});
    	$("#div_button_box").css({"position":"absolute"});
    	
    	var u = navigator.userAgent, app = navigator.appVersion;
		var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);
		if(isiOS){
			var myScroll;				
	    	window.onload = function() {	
	    		setTimeout(
	    			function(){
	    				myScroll = new IScroll('.formContent-Box', { 
							preventDefault: false,
							preventDefaultException: { tagName: /^(INPUT|TEXTAREA|BUTTON|SELECT|A|SPAN|IMG)$/ }
						})
	    				hideLoadingToast();
	    			}
	    			,2000); 
	    	}; 
	    	document.addEventListener('touchmove', function (e) {
	    		e.preventDefault(); 
	    	}, false);

		}else{
			$(".formContent-Box").css("overflow","auto");
			hideLoadingToast();
		}
		setTimeout(function(){
			if($("#form_tab").find("a").size()>0){
				$(".formContent-Box").css("top","37px");
			}
		},2000); 
    }else{
    	hideLoadingToast();
    }
}

; 
var subFlowApproverInfo =[];
var subFlowApproverInfoAll =[];
var $sigdiv;
var circulatorInfos =[];
var defaultSignature;

//window.onhashchange = BackAction;
/**
 * 流程初始化方法
 */
function flowInit() {

	FlowPanel.bindEvent();
	FlowProcess.bindEvent();

	var $curPage = ajaxPage.getCurPage();
	var _flowStateId = $curPage.find("input[name='content.stateid']").val();//流程实例id
	var curNodeName = $curPage.find("input[name='targetNodeRT_name']").val();//当前节点name
	var curNodeId = $curPage.find("input[name='targetNodeRT_id']").val();//当前节点id
	var _HAS_FLOW = _flowStateId && _flowStateId.length>0;//表单是否已启动流程
	
	if(!_HAS_FLOW) return;
	$.ajax({
		type:"get",
		url:contextPath+"/portal/document/flow/getHistory.action",
		data:{_flowStateId:_flowStateId,_applicationId:$("input[name='application']").val()},
		cache:false,
		dataType:"json",
		success:function(result){
			if(result.status==1){
				renderFlowHisModal(result.data);
			}
		}
		}); 
	
	
	$.getJSON(contextPath+"/portal/document/flow/getFlowInstanceJson.action",
			{_flowStateId:_flowStateId,_applicationId:$curPage.find("input[name='application']").val(),_curNodeName:curNodeName,_curNodeId:curNodeId},
			function(result){
		if(result.status==1){
			renderFlowHisPanel(result.data.historys);
		}
	});
};

/**
 * 流程相关按钮渲染
 */
function flowBtn(){

	if(ajaxPage.getCurPage().find("input[activityType='5']").size()==0) return;
	FlowPanel.refreshFlowPanel("init");
	signatureInit();	//手写签批初始化
}

/**
 * 手写签批初始化
 */
function signatureInit(){

	var $curPage = ajaxPage.getCurPage();
	var $signature = $curPage.find("#signature");
	$sigdiv = $signature.jSignature({'UndoButton':false,width:$(window).width()-26,height:$(window).height()-300,color:'#000',lineWidth:0});
	//临时保存默认值 用于提交时判断是否手写
	defaultSignature = ($sigdiv.jSignature('getData', "image"))[1];
	$signature[0].addEventListener("touchstart",function(e){
		$curPage.find("[name=_attitude]").blur();	//签批时意见框取消聚集，避免弹出键盘体验不好
		$(this).parents(".flowPro_con").find(".requiredField").blur();
		e.preventDefault();
		e.stopPropagation();
	},false);
}

/**
 * Phone皮肤 表单流程历史
 */
		
/**
**渲染表单上方流程历史面板
**/
function renderFlowHisPanel(flowHistorys){
	/*JSON格式
	 * [{"nodeType":"hisNode","nodeJson":[{"auditorId":"11e5-975b-abcfab55-8df7-f9d0d3fc48f4","auditorName":"邢儿（行政专员）","startNodeName":"起草","processtime":"2016-07-06 11:50:49.0","currentNode":"0"}]},{"nodeType":"curNode","nodeJson":[{"auditorId":"11e4-7b56-045d6210-a888-6d6b162bf5de","auditorName":"邢主管（行政主管）","startNodeName":"审核","processtime":"","currentNode":"1"},{"auditorId":"11e6-292f-c98bc185-9a78-9b801f3f5251","auditorName":"周杰伦（项目专员）","startNodeName":"审核","processtime":"","currentNode":"1"},{"auditorId":"5e120165-cb23-4131-aade-123ad00893da","auditorName":"李四","startNodeName":"审核","processtime":"","currentNode":"1"},{"auditorId":"880832b0-b0a6-47c0-9bb6-1f8c2debcad8","auditorName":"peng","startNodeName":"审核","processtime":"","currentNode":"1"},{"auditorId":"b5a8cc3d-dc1c-4c56-b27b-8704f4f1689a","auditorName":"张三","startNodeName":"审核","processtime":"","currentNode":"1"}]}]
	 * */
	var $curPage = ajaxPage.getCurPage();
	var $panel_content = $curPage.find("#flowhis_panel_content");
	$panel_content.append("<div class='flowhis_panel_hisnode'></div>");
	var $hisnode = $panel_content.find(".flowhis_panel_hisnode");
	
	$.each(flowHistorys,function(i,node){   // 渲染逻辑需要改
		if(node.nodeType == "hisNode"){
			var hisNodeLength = node.nodeJson.length;
			$.each(node.nodeJson,function(i,his){
				if(i>3){	//审批人超过4个时只获取前四个的头像
					return;
				}
				if(i == "0" || i == hisNodeLength - 1){
					var nodeItem = renderFlowHisPanelItem(i,his,node.nodeType,hisNodeLength);
					$hisnode.append(nodeItem.join(""));
				}else{
					if($panel_content.find(".point-node").size()<=0){
						var nodePoint = '<span class="point-node">'
							+'<div class="icon-box"><i class="iconfont iconfont-e615"></i><div class="icon-line icon-line-left"></div><div class="icon-line icon-line-right"></div>'
							+'</div></span>';
						$hisnode.append(nodePoint);
					}
				}
			});
		}else if(node.nodeType == "curNode"){
			var curNodeLength = node.nodeJson.length;
			var curNodeName = (node.nodeJson.length != 0) ? node.nodeJson[0].startNodeName : "";
			var curNodes = false;
			var $curNodes = "";
			$.each(node.nodeJson,function(i,his){
				if(i>3){	//审批人超过4个时只获取前四个的头像
					return;
				}
				var nodeItem = renderFlowHisPanelItem(i,his,node.nodeType,curNodeLength);
				//是否多节点
				if(his.startNodeName != curNodeName){
					curNodes = true;
				}
				//是否完结
				if(his.isComplete && his.isComplete != "true"){
					//是否多审批人
					if(curNodeLength > 1){
						if($panel_content.find(".curNodes").size()<=0){
							$hisnode.append(nodeItem.join(""));
						}
						$curNodes = $panel_content.find(".curNodes");
						//头像
						var avatar = Common.Util.getAvatar(his.auditorId);
						var avatarHtml = "";
						if(avatar!="" && avatar!=undefined){
							avatarHtml = '<img class="avatar" src="'+avatar+'" >';
						}else{
							avatarHtml = '<div class="noAvatar">'+ his.auditorName.substr(his.auditorName.length-2, 2) +'</div>';
						}
						$curNodes.append(avatarHtml);
					}else{
						$hisnode.append(nodeItem.join(""));
					}
					
				}else{
					$hisnode.append(nodeItem.join(""));
				}
			});
			//是否多节点
			if(curNodes){
				var nodesShadow = "<div class='nodesShadow2'></div><div class='nodesShadow1'></div>"
					$curNodes.parent().append(nodesShadow);
			}
			
		}
	});
	var $a = $('<span class="td more"><a data-ignore="push">更多<span class="icon icon-right"></span></a></span>').bind("click", function(){
		showViewHistory(this);
	});
	
	$panel_content.append($a);
	$curPage.find("#flowhis_panel").show();

	var fixTopHeight = $curPage.find(".fix_top_panel").outerHeight();
	$curPage.find("#form_continer").css("padding-top",fixTopHeight);
}

/**
**渲染表单上方流程历史面板中一项数据
**/
function renderFlowHisPanelItem(i,his,type,length){
	var html = [];
	//头像
	var avatar = Common.Util.getAvatar(his.auditorId);
	var avatarHtml = "";
	if(avatar!="" && avatar!=undefined){
		avatarHtml = '<img class="avatar" src="'+avatar+'" >';
	}else{
		avatarHtml = '<div class="noAvatar">'+ his.auditorName.substr(his.auditorName.length-2, 2) +'</div>';
	}
	//动作图标
	var actionIcon = "";
	switch (his.flowOperation){
		case "1":
		case "80"://"流转"
			actionIcon = "<i class='iconfont iconfont-e631 icon-09bb07'></i>"
			break;
		case "81"://"回退"
			actionIcon = "<i class='iconfont iconfont-e630 icon-f76260'></i>"
			break;
		case "85"://"回撤"
			actionIcon = "<i class='iconfont iconfont-e633 icon-ffc107'></i>"
			break;
		case "88"://"挂起"
			actionIcon = "<i class='iconfont iconfont-e628 icon-ff6600'></i>"
			break;
		case "89"://"恢复"
			actionIcon = "<i class='iconfont iconfont-e629 icon-10aeff'></i>"
			break;
		default://"当前"
			actionIcon = "<i class='iconfont iconfont-e627 icon-8c8c8c'></i>";
			break;
	}	
	
	//是否当前节点
	if(type == "hisNode"){
		//判断流程历史第一和最后节点
		if(i==0){
			html.push('<span><div class="face-name-box"><div class="face"><span class="face-box">');
      	}else{
      		html.push('<span class="show-node"><div class="face-name-box"><div class="face"><span class="face-box">');
      	}
		html.push(avatarHtml);
		html.push('</span></div>');
      	html.push('<div class="start-node-name">'+his.startNodeName+'</div></div>');
      	if(i==0){
      		html.push('<div class="icon-box">'+actionIcon+'<div class="icon-line icon-line-right"></div></div>')
      	}else{
      		html.push('<div class="icon-box">'+actionIcon+'<div class="icon-line icon-line-left"></div><div class="icon-line icon-line-right"></div></div>')
      	}
        html.push('<div>'+his.processtime.substring(5,10)+'</div>');
        html.push('</span>');
	}else if(type == "curNode"){
		html.push('<span><div class="face-name-box"><div class="face"><span class="face-box">');
		//是否完结
		if(his.isComplete && his.isComplete == "true"){
			actionIcon = "<i class='iconfont iconfont-e632 icon-364046'></i>";
		}else{
			//是否多审批人
			if(length > 1){
				html.push('<div class="curNodes"></div>');
			}else{
				html.push(avatarHtml);
			}
		}
		html.push('</span></div>');
      	html.push('<div class="start-node-name">'+his.startNodeName+'</div></div>');
        html.push('<div class="icon-box">'+actionIcon+'<div class="icon-line icon-line-left"></div></div>')
        html.push('<div>'+his.processtime.substring(5,10)+'</div>');
        html.push('</span>');
	}
    return html;
}

/**
**渲染弹出的流程历史模态框
**/
function renderFlowHisModal(data){
	var isComplate = data.isComplete;
	
	var prevNodeTime;
	var $curPage = ajaxPage.getCurPage();
	
	$.each(data.historys,function(i,his){
		var html = [];
		
		//审批节点
		var _startNodeName = his.startNodeName;
		//目标节点
		var _targetNodeName =  his.targetNodeName;
		//办理人
		var _auditorName = his.auditorName;
		if(!his.agentAuditorName){
			_auditorName = his.auditorName;
		}else{
			_auditorName = his.agentAuditorName + "(代理:"+ his.auditorName +")" ;
		}
		//办理人头像
		var avatar = Common.Util.getAvatar(his.auditorId,contextPath);
		var _avatar = "";
		if(avatar!="" && avatar!=undefined){
			_avatar = '<img class="avatar" src="'+avatar+'" >';
		}else{
			_avatar = '<div class="noAvatar">'+ his.auditorName.substr(his.auditorName.length-2, 2) +'</div>';
		}
		
		//签核动作
		var _flowOperation = "";
		switch (his.flowOperation){
			case "81":
				_flowOperation = "回退"
				break;
			case "85":
				_flowOperation = "回撤"
				break;
			case "88":
				_flowOperation = "挂起"
				break;
			case "89":
				_flowOperation = "恢复"
				break;
			default:
				_flowOperation = "流转"
				break;
		}
		
		
		//办理时间
		var _time = his.processtime.replace("T"," ");
		var _processtime = new Date(_time);
		var timeFixArr = _time.split(/[- :]/); 
		var timeFixDate = new Date(timeFixArr[0], timeFixArr[1]-1, timeFixArr[2], timeFixArr[3], timeFixArr[4]);
		var _timeAgo;
		var Month = timeFixDate.getMonth() + 1; 
		var Day = timeFixDate.getDate(); 
		var Hour = timeFixDate.getHours(); 
		var Minute = timeFixDate.getMinutes(); 
		
		var comTime = Common.Util.daysCalc(_time);
		if(comTime.days > 2){
			if (Month >= 10){ 
				_timeAgo = Month + "-"; 
			}else{ 
				_timeAgo = "0" + Month + "-"; 
			} 
			if (Day >= 10) 
			{ 
				_timeAgo += Day + " "; 
			}else{ 
				_timeAgo += "0" + Day; 
			} 
		}else if(comTime.days == 2){ 
			_timeAgo = "前天 ";
			if (Hour >= 10) 
			{ 
				_timeAgo += Hour + ":" ; 
			}else{ 
				_timeAgo += "0" + Hour + ":" ; 
			} 
			if (Minute >= 10) 
			{ 
				_timeAgo += Minute ; 
			}else{ 
				_timeAgo += "0" + Minute ; 
			} 
		}else if(comTime.days == 1){
			_timeAgo = "昨天 ";
			if (Hour >= 10) 
			{ 
				_timeAgo += Hour + ":" ; 
			}else{ 
				_timeAgo += "0" + Hour + ":" ; 
			} 
			if (Minute >= 10) 
			{ 
				_timeAgo += Minute ; 
			}else{ 
				_timeAgo += "0" + Minute ; 
			} 
		}else if(comTime.days <= 0 && comTime.hours > 0){
			_timeAgo = comTime.hours + " 小时前 ";
		}else if(comTime.days <= 0 && comTime.hours <= 0){
			if(comTime.minutes < 5){
				_timeAgo = " 刚刚";
			}else{
				_timeAgo = comTime.minutes + " 分钟前 ";
			}
		}
		
		//动作图标
		var actionIcon = "";
		if(_flowOperation == "回退"){
			actionIcon = '<span class="flowOperation back-f76260"><i class="fa fa-reply"></i>'+_flowOperation+'</span>'
		}else if(_flowOperation == "回撤"){
			actionIcon = '<span class="flowOperation back-ffc107"><i class="fa fa-share-square-o"></i>'+_flowOperation+'</span>'
		}else if(_flowOperation == "挂起"){
			actionIcon = '<span class="flowOperation back-ff6600"><i class="fa fa-coffee"></i>'+_flowOperation+'</span>'
		}else if(_flowOperation == "恢复"){
			actionIcon = '<span class="flowOperation back-10aeff"><i class="fa fa-undo"></i>'+_flowOperation+'</span>'
		}else if(_flowOperation == "流转"){
			actionIcon = '<span class="flowOperation back-09bb07"><i class="fa fa-sign-in"></i>'+_flowOperation+'</span>'
		}
		
		//节点间耗时
		if(i > 0){
			var _prevNodeTime = Common.Util.daysCalc(prevNodeTime,_time);
			var _prevNodeTimeContent = "耗时"
			if(_prevNodeTime.days > 0){
				_prevNodeTimeContent += _prevNodeTime.days + "天";
			}
			if(_prevNodeTime.hours > 0){
				_prevNodeTimeContent += _prevNodeTime.hours + "小时";	
			}
			if(_prevNodeTime.minutes > 0){
				_prevNodeTimeContent += _prevNodeTime.minutes + "分";
			}
			if(_prevNodeTime.seconds > 0){
				_prevNodeTimeContent += _prevNodeTime.seconds + "秒";
			}
		}
		if(!_prevNodeTimeContent){
			_prevNodeTimeContent = "";
		}else if(_prevNodeTimeContent=="耗时"){
			_prevNodeTimeContent = "耗时1分钟";
		}
		prevNodeTime = _time;

		html.push('<div class="leave-list"><div class="leave-list-tr"><div class="leave-list-td w50"></div><div class="leave-list-td"><span style="padding-left:10px">');
		html.push(_timeAgo);
		html.push('</span><span class="pull-right" style="padding-right:10px">'+_prevNodeTimeContent+'</span></div></div>');
		html.push('<div class="leave-list-tr"><div class="leave-list-td w50"><div class="face text-center"><span class="face-box">');
		html.push(_avatar);
		html.push('<div class="arrow"><i class="arrow1"></i><i class="arrow-m"></i></div></span>');
		html.push('<div class="auditor-name">'+his.auditorName+'</div>');
		html.push('</div></div><div class="leave-list-td"><div class="talk-box">');
		html.push('<div class="state">'+ _startNodeName + actionIcon + _targetNodeName +'</div>');
		html.push('<div><br/>'+(his.attitude? his.attitude : '')+'<br/><img onclick="showbig(this);" style="max-height:128px" src="'+his.signatureImageDate+'"></div>');
		html.push('<div class="talk-horn"></div></div></div></div> </div>');
		$curPage.find("#flowhis_modal_content").prepend(html.join(""));
	});
	
	/*if(isComplate){
		var endHis = data.historys[data.historys.length-1];
		var html = [];
		html.push(' <div class="leave-list text-center"><div class="leave-list-tr"><div class="leave-list-td w50" style="line-height: 15px;"><img src="'+contextPath+'/portal/phone/resource/images/ico-03.png" style="margin-top:15px;width: 15px;height: 15px;"><br />');
		html.push(endHis.endNodeName);
		html.push('</div><div class="leave-list-td"><span></span></div></div></div></div>');
		$("#flowhis_modal_content").append(html.join(""));
	}*/

	var leave_list_num = $curPage.find(".leave-list").length;				
	for(i=0;i<leave_list_num;i++){
		var $listArrow = $curPage.find(".leave-list .arrow").eq(i);
		var $listArrowLine = $curPage.find(".leave-list .arrow-m").eq(i);
		if(i==leave_list_num-1){
			$listArrow.remove();
		}else{
			var reverseFaceH = $listArrow.parents(".face").outerHeight();
			$listArrow.height($curPage.find(".leave-list .talk-box").eq(i).height()-reverseFaceH + 40);
			$listArrowLine.height($curPage.find(".leave-list .talk-box").eq(i).height()-reverseFaceH + 40);
		}
    	
    }
}
		

var FlowPanel = {

	bindEvent : function(){
		var $curPage = ajaxPage.getCurPage();
		$curPage.find("#viewHistory").find("a[name='btn_act_committo'], #btn-modal-close").bind("click", function(){
			ajaxPage.clearHashPostfix("popUpLayer");
			$curPage.find("#viewHistory").hide();
		});
		
		var $flowSubmitPanel = $curPage.find(".flow-submit");

		//移除审批人
		$flowSubmitPanel.on("click",".flow-submit__user",function(){
			var $this = $(this);
			var id = $this.data("id");
			var name = $this.data("name");
			var inputID = $this.data("input");
			var $valueField = $this.parents(".weui-cells_checkbox").find("#"+inputID);
			var $textField = $this.parents(".weui-cells_checkbox").find("#"+inputID+"_text");
			var $circulator = $curPage.find("input[name='_circulatorInfo']");
			var $submitStr = $curPage.find("#submitTo");

			if(inputID == "freeflow"){
				$valueField.val("");
				$textField.val("");
				$textField.attr("result","");
				$this.parent().find(".flow-submit__user-select").parent().show();
			}else if(inputID == "_circulator"){
				var value = $circulator.val();
				var valueArr = JSON.parse(value);
				
				for(var i = 0;i < valueArr.length;i++){
					var circulator = valueArr[i].circulator;
					for(var j = 0;j < circulator.length;j++){
						var userid = circulator[j];
						if(userid == id){
							circulator.splice(j, 1);
						}
					}
				}
				$circulator.val(JSON.stringify(valueArr));
				FlowPanel.removeSelectedUser(id,$valueField,$textField);	//移除指定已选用户后的更新已选用户的id以及name的集合
			}else{
				var value = $valueField.val();
				var text = $textField.val();
				var submitStr = $submitStr.val();
				var submitArr = JSON.parse(submitStr);
				var newValue = (value+";").replace(id+";","").substr(0,(value+";").replace(id+";","").length-1);
				var newText = (text+";").replace(name+";","").substr(0,(text+";").replace(name+";","").length-1);
				for(var i = 0;i < submitArr.length;i++){
					var userids = JSON.parse(submitArr[i].userids);
					for(var j = 0;j < userids.length;j++){
						var userid = userids[j];
						if(userid == id){
							userids.splice(j, 1);
							submitArr[i].userids = JSON.stringify(userids);
						}
					}
				}
				$submitStr.val(JSON.stringify(submitArr));
				FlowPanel.removeSelectedUser(id,$valueField,$textField);	//移除指定已选用户后的更新已选用户的id以及name的集合
			}	
			$this.remove();
		})
		
		//隐藏显示常用意见
		$flowSubmitPanel.on("click",".flow-submit__proposal",function(){
			$(this).find(".fa").toggleClass("fa-rotate-180")
			$flowSubmitPanel.find(".flow-submit__proposal-box").slideToggle();
		})
		
		$flowSubmitPanel.on("click",".flow-submit__proposal-box .weui-cell",function(){
			var $this = $(this);
			var $textarea = $(this).parents(".weui-cells_form").find(".weui-textarea");
			var _text = $this.find(".weui-cell__bd").text();
			var oText = $textarea.val();
	
			if(!oText){
				$textarea.val(_text);
			}else{
				$textarea.val($textarea.val() + "," + _text);
			}
			$textarea.trigger("focus");
		})

		//隐藏显示意见文本框
		$flowSubmitPanel.on("focus",".weui-textarea",function(){
			$(this).height(100);
		})
	},
	/**
	 * 移除指定已选用户后的更新已选用户的id以及name的集合
	 *
	 * @param {string} removeUserId 被移除的用户的id
	 * @param {Object} $valueField 存放已选用户id的对象
	 * @param {Object} $textField 存放已选用户name的对象
	 * @return {Object} 返回值描述
	 */ 
	removeSelectedUser : function(removeUserId,$valueField,$textField){
		var selectedText = $textField.attr("result");
		var selectedValue = $valueField.val();
		var separator = ";";
		selectedValue = selectedValue.split(separator);
		selectedText = selectedText.split(separator);
		$.each(selectedValue, function(i,val){ 
			if(removeUserId == val){
				selectedValue.splice(i,1);
				selectedText.splice(i,1);
			}
		});
		var newSelectVal = "";
		var newSelectText = "";
		if(selectedValue.length > 0 ){
			$.each(selectedValue, function(i,val){ 
				newSelectVal += val + separator;
			});
			$.each(selectedText, function(i,val){ 
				newSelectText += val + separator;
			});
			$textField.attr("result",newSelectText.substr(0,newSelectText.length-1));
			$valueField.val(newSelectVal.substr(0,newSelectVal.length-1));
		}else{
			$textField.attr("result","");
			$valueField.val("");
		}
	},
	/**
	 * 指定审批人的可选的静态用户数据
	 */
	getChooseUsers : function(url){
		var toChooseUsers = [];
		$.ajax({
			url : url,
			async : false,
			type : "POST",
			success : function(result){
				if(result.status == 1){
					toChooseUsers = result.data;
				}
			}
		});
		return toChooseUsers;
	},
	renderCommonOpitions : function(){
		var $curPage = ajaxPage.getCurPage();
		var params = {
				userId : USER.id
		};
		$.ajax({
			url : contextPath + "/portal/usersetup/getCommonOpinion.action",
			data : params,
			dataType : "json",
			success : function(result){
				if(result && result.status == 1){					
					var html = template("atp-flowpanel-commonOpitions", result);
					$curPage.find(".flow-submit__proposal-box").html(html);
				}
			}
		});
		
	},
	renderSelectUser : function(id,result){
		var $curPage = ajaxPage.getCurPage();
		result.inputID = id;	
		var $nodePanel = $curPage.find(".flow-submit__panel").find("[data-id='"+id+"']");		
		var $userPanel = $nodePanel.find(".flow-submit__user-panel");
		var $userSelectBtn = $userPanel.find(".flow-submit__user-select").parent();
		var selectUserHtml = template("atp-flowpanel-selectUser",result);
		$userPanel.find(".flow-submit__user").remove();
		$userSelectBtn.before(selectUserHtml);
		if(id == "freeflow"){
			$userSelectBtn.hide();
		}
	},
	//将后端返回的html代码拼接成json
	flowHtmlToJson : function(str){
		var $html = $("<div>"+str+"</div>");
		var isToPerson = $html.find("input#isToPerson").val();
		var currentNodeId = $html.find("#_currentNodeId").val();
		var splitToken = $html.find("input[name='splitToken']").val();
		
		
		var flowPanelJson = {
		    "isToPerson": isToPerson,
		    "currentNodeId": currentNodeId,
		    "splitToken": splitToken,
		    "nodeSelectList": [],
		    "nodeCopyList": []
		}

		//审批
		$html.find("div[data-type='nodeItem']").each(function(i){
			var $this = $(this);
			var $input = $this.find(".flowToPerson-Input-agrs");
			var id = $input.attr("_id");
			var docId = $input.attr("docid");
			var flowid = $input.attr("flowid");
			var hiddenIds = $input.attr("hiddenIds");
			var nextNodeId = $this.find("label").find("input").val();
			var nextNodeType = $this.find("label").find("input").attr("type");
			var nextNodeName = $this.find("label").text();
			var nodeToPerson = $this.find("input[nodeToPerson]").val();
			var value = $input.attr("value");
			var checked = $this.find("label").find("input").attr("checked") || '';
			var lock = $this.find("label").find("input").attr("locked");	//默认选中且锁定

			var nodeItem = {
				"id": id,
				"docId": docId,
				"flowId": flowid,
				"hiddenIds": hiddenIds,
				"nextNodeType":nextNodeType,
				"nextNodeId": nextNodeId,
				"nextNodeName": nextNodeName,
				"nodeToPerson": nodeToPerson,
				"value": value,
				"checked": checked,
				"lock" : lock
			}
			flowPanelJson.nodeSelectList.push(nodeItem);
		});

		//抄送
		$html.find(".copyToPerson").each(function(i){
			var $this = $(this);
			var $input = $this.find(".flowToPerson-Input-agrs");
			var id = $input.attr("_id");
			var docId = $input.attr("docid");
			var flowid = $input.attr("flowid");
			var nextNodeId = $input.attr("nextNodeId");
			
			var nodeItem = {
				"id": id,
				"docId": docId,
				"flowId": flowid,
				"nextNodeId": nextNodeId
			}
			flowPanelJson.nodeCopyList.push(nodeItem);
		});
		
		return flowPanelJson;
	},
	/**
 * 选择审批人后回选用户的id，返回数组
 *
 * @param {string} str 已选所有用户id
 */
	commitUserids : function(str){
		var separator = ";";
		var userIds = []
		if(str != ""){
			userIds = str.split(separator);
		}
		return  userIds;
	},
	/**刷新流程面板， e变量为场景，1、刷新：e=init；2、提交：e=commitTo；3、回退：e=returnTo*/
	refreshFlowPanel : function(actionType,act) {
		
		var $curPage = ajaxPage.getCurPage();
		var $dy_refreshObj = $curPage.find("#dy_refreshObj");
		var formid = $dy_refreshObj.attr("formid");
		var docid = $dy_refreshObj.attr("docid");
		var userid = $dy_refreshObj.attr("userid");
		var flowid = $dy_refreshObj.attr("flowid");
		
		var $auditorList = $curPage.find("#auditorList");

		//当为新建文档（$auditorList.size()==0）、或当前用户在【编辑人】中，显示流程按钮
		if ($auditorList.size()==0 || ($auditorList.size()>0 && $auditorList.val().indexOf(userid)>0)){}
		else{//反向代码写法，方便理解
			//return;
		}
		
		try {
			var url = contextPath + "/portal/dynaform/document/refreshFlowPanelHTML.action";
			var datas = dy_getValuesMap(true);
			datas["formid"]=formid;
			datas["docid"]=docid;
			datas["stateid"] = $curPage.find("input[name='content.stateid']").val();
			datas["userid"]=userid;
			datas["flowid"]=flowid;
			datas["actionType"]=actionType;
			jQuery.ajax({
				    type:"POST",      
				    url:url,      
				    data:datas,
				    cache:false,
				    dataType:"text",//预期服务器返回的数据类型。如果不指定，jQuery 将自动根据 HTTP 包 MIME 信息来智能判断
				    async:true,   //true为异步请求，false为同步请求
				    success:function(str){
				    	try {
				    		var $curPage = ajaxPage.getCurPage();
				    		var flowPanelJson = FlowPanel.flowHtmlToJson(str);
				    		var $currid = $curPage.find("#_currid");
				    		

				    		//var $flowHtmlText = $curPage.find("#flowHtmlText").html(str);
				    		
				    		var $flowHtmlText = $("<div>"+str+"</div>");

							if ($currid.size()>0 && $currid.val()=="") {
								$currid.val(flowPanelJson.currentNodeId);
							}
							switch(actionType) {
								case "commitTo":
									var $nodeBox = $curPage.find(".flow-submit__panel").find("#flow-submit__node-box");

									var nodeSelectList = flowPanelJson.nodeSelectList;

									var html = template("atp-flowpanel-committo", flowPanelJson);
									$nodeBox.html(html);
									
									$nodeBox.find("input[islock='true']").bind("click",function(){	//默认选中且锁定
										return false;
									});
									
									for(var i = 0;i < nodeSelectList.length;i++){
										var id = nodeSelectList[i].id;
										var textField = id + "_text";
										var nextNodeId = nodeSelectList[i].nextNodeId;
										var docId = nodeSelectList[i].docId;
										var flowId = nodeSelectList[i].flowId;
										var value = nodeSelectList[i].value;
										var hiddenIds = nodeSelectList[i].hiddenIds;
										var nodeToPerson = nodeSelectList[i].nodeToPerson || false;
										
										if(!nodeToPerson || nodeToPerson == "false") {
											// 如果不能指定流程审批人，则下一个循环
											continue;
										}
										
										var _url = contextPath + '/contacts/getContactsByFlow.action?flowid='+flowid+'&docid='+docid+'&nodeid='+nextNodeId+'&type=3';
										var toChooseUsers = [];
										toChooseUsers = FlowPanel.getChooseUsers(_url);
										$curPage.find(".flowToPerson-Input:eq("+i+")").userbox({
											//属性和事件回调可自定义，无自定义需求可完全不填，具体用法参考说明文档
											id : id,//必须，存放回选的用户value值的input的id
											textId : textField,//必须，存放回选的用户text值的input的id
											isPhone : true,		//是否手机端
											multiple: true,//是否多选模式
											mode: 'all',//simple:精简模式|all:完整模式
											width: 'auto',//宽度
											disabled: false,//是否禁用
											readOnlyShowValOnly : true,//只读是否只显示值
											required: false,//是否必填
											toChooseUsers : toChooseUsers,
											tabs: {},	// [] 配置显示的tab，全部、部门、职务、常用
											selectUser : value,	//已选择的用户
											clearlabel : "清除",	//清除按钮的title
											selectBtn: $nodeBox.find(".flow-submit__nextNode:eq("+i+")").find(".flow-submit__user-select"),
											separator: ';',//多选模式下的分隔符
											onSuccess : function(result, rtnValue, rtnText){
											
												var submitStr = $curPage.find("#submitTo").val();
												
												var $input = $(this.selectBtn);
												var $nextNodeInput = $input.parents(".weui-cell").prev().find("input");
												var nextNodeId = $nextNodeInput.val();
												//判断是否存在提交数据
												if(submitStr == null || submitStr == ""){
													var submitObj = [];
													var userIds = FlowPanel.commitUserids(rtnValue);
													var userObj = {
														"nodeid":nextNodeId,
														"isToPerson":"true",
														"userids":JSON.stringify(userIds)
													}
													submitObj.push(userObj);
												}else{
													submitObj = JSON.parse(submitStr);
													var hasNode = false;
													//查找是否存在当前节点的提交数据
													for(var i = 0;i < submitObj.length;i++){
														var nodeid = submitObj[i].nodeid;
														if(nodeid == nextNodeId){
															hasNode = true;
															var userids = JSON.parse(submitObj[i].userids);
															submitObj[i].userids = JSON.stringify(FlowPanel.commitUserids(rtnValue));
														}
													}
													//不存在当前节点提交数据时插入新数据
													if(!hasNode){
														var userIds = FlowPanel.commitUserids(rtnValue);
														
														var userObj = {
															"nodeid":nextNodeId,
															"isToPerson":"true",
															"userids":JSON.stringify(userIds)
														}
														submitObj.push(userObj);
													}
												} 
												submitStr = JSON.stringify(submitObj);
												$curPage.find("#submitTo").val(submitStr);
												$curPage.find("#"+this.id).val(rtnValue);
												FlowPanel.renderSelectUser(this.id,result);
												if(result.data.length >0){
													$("#" + (this.id + "_text")).attr("result",rtnText);
												}else{
													$("#" + (this.id + "_text")).attr("result","");
												}
											},
											onOpen : function(){
												
											},
											onClose : function(){
												
											}
										});
										
									}

									var nodeCopyList = flowPanelJson.nodeCopyList;
									
									
									
									for(var i = 0;i < nodeCopyList.length;i++){
										var id = nodeCopyList[i].id;
										var textField = id + "_text";
										var nextNodeId = nodeCopyList[i].nextNodeId;
										var docId = nodeCopyList[i].docId;
										var flowId = nodeCopyList[i].flowId;
										var _copyUrl = contextPath + '/contacts/getContactsForCirculator.action?_flowId='+flowid+'&_docId='+docid+'&_nodeId='+nextNodeId+'&_isGetCirculator=true';
										var toCopyChooseUsers = [];
										toCopyChooseUsers = FlowPanel.getChooseUsers(_copyUrl);
										$curPage.find(".copyToPerson-Input").userbox({
											//属性和事件回调可自定义，无自定义需求可完全不填，具体用法参考说明文档
											id : id,//必须，存放回选的用户value值的input的id
											textId : textField,//必须，存放回选的用户text值的input的id
											isPhone : true,		//是否手机端
											multiple: true,//是否多选模式
											mode: 'all',//simple:精简模式|all:完整模式
											width: 'auto',//宽度
											disabled: false,//是否禁用
											readOnlyShowValOnly : true,//只读是否只显示值
											required: false,//是否必填
											clearlabel : "清除",	//清除按钮的title
											selectBtn: $nodeBox.find(".flow-submit__copyTo .flow-submit__user-select"),
											separator: ';',//多选模式下的分隔符
											toChooseUsers : toCopyChooseUsers,
											tabs: {},	// [] 配置显示的tab，全部、部门、职务、常用
											onSuccess : function(result, rtnValue, rtnText){
												if(id == "_circulator"){	//指定抄送人的回调方法
													if(result.data.length>0){
														var circulatorArr = [];
														for (var i = 0; i < result.data.length; i++) {
															circulatorArr.push(result.data[i].value);
														}
														var circulatorInfo = [{
															"circulator": circulatorArr
														}];
														var circulatorStr = JSON.stringify(circulatorInfo)
														$curPage.find("input[name='_circulatorInfo']").val(circulatorStr);
														
													}else{
														circulatorInfos[0] = '';
														$curPage.find("input[name='_circulatorInfo']").val("");
													}
													FlowPanel.renderSelectUser(this.id,result);
													$curPage.find("#"+id).val(rtnValue);
													$curPage.find("#"+textField).attr("result",rtnText);
												}
											},
											onOpen : function(){
												
											},
											onClose : function(){
												
											}
										});
									}
								
									break;
								case "returnTo":
									var $nodeBox = $curPage.find(".flow-submit__panel").find("#flow-submit__node-box");
									$nodeBox.html($flowHtmlText);
									break;
								case "init":
									var isFlowComplete = $curPage.find("#isComplete").val();
									if(isFlowComplete == "" || isFlowComplete == "false"){
										FlowPanel._renderButtons($flowHtmlText);
									}
									FlowPanel.renderCommonOpitions();
									break;
								default:
							}

							//判断是否展开面板
							if(act){
								var isToPerson_Flag = FlowPanel._checkHideSubmitPanel();
								if(isToPerson_Flag){
									FlowPanel.flowCommitTo();
								}else{
									
									var $page_flowPro = ajaxPage.getCurPage().find("#page_flowPro");
									$page_flowPro.show();
									FlowPanel.refreshFlowPanel("commitTo");
									
									
									var $btn = $("<div class='weui-flex__item'><a name='btn_act_committo' class='btn btn-positive btn-block' title='提交'>提交</a></div>").click(function(){
										$(this).attr("disabled", "disabled");//锁住当前操作，避免重复提交
										FlowPanel.flowCommitTo();
									});
									var $cancel = $("<div class='weui-flex__item'><a name='btn_act_committo' class='btn btn-block' title='取消'>取消</a></div>").click(function(){
										FlowPanel.cancelAction();
										$curPage.find("#page_flowPro").hide();
									});
			
			//						var $page_flowPro = ajaxPage.addPage();	//false:添加但暂不显示
			//						$page_flowPro.attr("role", "main").addClass("ui-content");
			//						$page_flowPro.append($page_flowProOld.children());
									
									//$page_flowPro显示后再初始化手写签批
									$page_flowPro.find("#div_button_place").empty().append($btn).append($cancel);
									
									var title = $page_flowPro.find(".flow-submit").data("title");
									var curFormId = $curPage.attr("id");
									var curPage_title = ajaxPage.title[curFormId];
									document.title = curPage_title + "-" + title;
									ajaxPage.addHashPostfix("flowPro");
								}
							}
							
						} catch (ex) {
							alert('refreshFlowPanel.callback(): ' + ex.message);
						}
				    },
				    error:function(){ 
				        alert("请求失败");
				    }
				});
		} catch (ex) {
			alert('refreshFlowPanel: ' + ex.message);
		}
	},
	
	/**检查是否选择抄送人*/
	_checkIsSelectCirculator : function (){
		var $curPage = ajaxPage.getCurPage();
		var obj = $curPage.find("#_circulator")[0];
		var _flowType = $curPage.find("#_flowType").val();
		/*if(obj && _flowType != '81'){
			if(obj.val() && obj.val().length<=0){
				alert("请选择抄送人！");
				return false;
			}
		}*/
		return true;
	},
	
	/**检验选择指定审批人的节点是否已选择审批人*/
	_checkToPerson : function (){
		var $curPage = ajaxPage.getCurPage();
		var $nextids = $curPage.find("[name='_nextids']");
		var _flowType = "";
		var $_flowType = $curPage.find("#_flowType");
		if($_flowType && $_flowType.size()>0){
			_flowType = $_flowType.val();
		}
		
		for (var i=0; i<$nextids.length; i++) {
			var nodeid = $nextids[i].value;
			//是否指定审批人
			var $isToPerson = $curPage.find("#isToPerson");
			if(($isToPerson && $isToPerson.val() == 'true') && $nextids[i].checked){
				var isNullUser = false;
				var $input = $curPage.find("#input_"+i);
				if($input && $input.val()==""){
					isNullUser=true;
				}else{
					isNullUser=false;
				}

				// 提交到下一步
				if(_flowType == '80'){
					if(isNullUser){
						alert ('请选择指定审批人');
						return false;
					}
				}
			}
		}

		return true;
	},
	
	_checkHideSubmitPanel : function (){
		var $curPage = ajaxPage.getCurPage();
		var $nodeBox = $curPage.find(".flow-submit__panel").find("#flow-submit__node-box");
		var $nextids = $nodeBox.find("[name='_nextids']");
		var _flowType = '';
		if($nodeBox.find("#_flowType").size() > 0){
			_flowType = $nodeBox.find("#_flowType").val();
		}
		
		var $isToPerson = $nodeBox.find("#isToPerson");
		var multiNodes = $nextids.size() > 1 ? true : false ;
		isToPerson = $isToPerson && $isToPerson.val() == 'true' ? true : false ;

		if(_flowType == '80'){
			if(!isToPerson && !multiNodes){
				return true;
			}
		}
		return false;
	},
	
	/**流程处理*/
	flowCommitTo : function() {		//提交

			var $curPage = ajaxPage.getCurPage();
			var data = $sigdiv.jSignature('getData', "image");
			if(data && data.length==2){
				if(data[1] != defaultSignature){
					var signatureJson = '{"type":"'+data[0]+'","data":"'+data[1]+'"}';
					$curPage.find("input[name='_signature']").val(signatureJson);
				}
			}
		
			if(!FlowPanel._checkIsSelectCirculator()){
				return;
			}
			var $nextids = $curPage.find("[name='_nextids']");
			var isToPersonStr = '';
			var $isToPerson = $curPage.find("#isToPerson");
			if($isToPerson && $isToPerson.size() > 0){
				isToPersonStr = $isToPerson.val();
			}
			var flag = false;
			var parameters ='';
			
			if ($nextids && $nextids.size()>0) {
				if (!FlowPanel._checkToPerson()){
					return;
				}
				
				for (var i=0; i<$nextids.length; i++) {
					if ($nextids[i].type != 'select-one') {
						if ($nextids[i].checked) {
							flag = true;
							break;
						}
					} else {
						if ($nextids[i].value != null 
						&& $nextids[i].value != '') {
							flag = true;
							break;
						}
					}
				}

				if (flag) {
					//设置流程类型为【提交-80】
					var $_flowType = $curPage.find("#_flowType");
					if($_flowType && $_flowType.size()>0){
						$_flowType.val("80");
					}
					var actid = $curPage.find("input[activityType='5']").attr("actid");
					Activity.doExecute(actid,5);
				}
				else {
					alert('请选择一项操作');
				}
			}
			else {
				alert ('没有操作能被执行');
			}
		},
		
		flowReturnTo : function() {		//回退
			var $curPage = ajaxPage.getCurPage();
			if ($curPage.find("#back").val()=='') {
				alert('请选择需要回退的结点！');
				return;
			}
			var data = $sigdiv.jSignature('getData', "image");
			if(data && data.length==2){
				if(data[1] != defaultSignature){
					var signatureJson = '{"type":"'+data[0]+'","data":"'+data[1]+'"}';
					$curPage.find("input[name='_signature']").val(signatureJson);
				}
			}

			//设置流程类型为【回退-81】
			var $_flowType = $curPage.find("#_flowType");
			if($_flowType && $_flowType.size()>0){
				$_flowType.val("81");
			}

			var actid = $curPage.find("input[activityType='5']").attr("actid");
			Activity.doExecute(actid,5);
		},
	
		/**子流程审批信息文本JSON格式*/
		_biuldsubFlowApproverInfoStr : function (){
			var $curPage = ajaxPage.getCurPage();
			var result ='';
			if(subFlowApproverInfo.length>0){
				result+='[';
			}
			for(var i=0;i<subFlowApproverInfo.length;i++){
				result+=subFlowApproverInfo[i]+',';
			}
			if(result.length>0){
				result = result.substring(0,result.length-1);
				result+=']';
				
				$curPage.find("input[name='_subFlowApproverInfo']").val(result);
			}
		},
		
		/**构建抄送信息文本JSON格式*/
		_biuldCirculatorInfoStr : function (){
			var $curPage = ajaxPage.getCurPage();
			var result ='';
			if(circulatorInfos.length>0){
				result+='[';
			}
			for(var i=0;i<circulatorInfos.length;i++){
				result+=circulatorInfos[i]+',';
			}
			if(result.length>0){
				result = result.substring(0,result.length-1);
				result+=']';
				
				$curPage.find("input[name='_circulatorInfo']").val(result);
			}
		},
		
		/**
		 * 流程相关的按钮渲染
		 */
	_renderButtons : function($flowHtmlText) {
		var $ = jQuery;
		var $curPage = ajaxPage.getCurPage();
		var $div_button_box = $curPage.find("#div_button_box");
		$div_button_box.find("td.flowTd").remove();
		
		var curFormId = $curPage.attr("id");
		var curPage_title = ajaxPage.title[curFormId];
		
		var $flowProcessBtn = $curPage.find("input[activityType='5']");
		
		if($flowHtmlText.find("#btn_flow_reminder").size() > 0 && $flowHtmlText.find("#act_flow_reminder").size() == 0){//渲染催办按钮
			var html = "<td><a id='act_flow_reminder' name='button_act' class='btn btn-orange btn-block' title='催办'>"
				+ "催办"
				+ "</a></td>";
			var $b = $(html);
			var $flowhis_panel_hisnode = $curPage.find(".flowhis_panel_hisnode").children();
			var $start_node = $flowhis_panel_hisnode.first();
			var $current_node = $flowhis_panel_hisnode.last();
			var start_node_name = $start_node.find(".start-node-name").html();
			var current_node_name = $current_node.find(".start-node-name").html();
			$curPage.find('#flowReminderDiv').find(".pull-left").html(start_node_name);
			var $t =  $flowHtmlText.find("#btn_flow_reminder");
			var $noderts = $t.data("nodes");
			for(var i = 0; i < $noderts.length ; ++i){
				$('<lable><input type="checkbox" name="_nodertIds" value="'
						+ $noderts[i].nodertId
						+ '" checked="checked" />'
						+ $noderts[i].nodeName 
						+ '</lable></br>').appendTo($curPage.find("#flowReminderDiv").find(".pull-right"));
			}

			$b.click(function(){
				ajaxPage.addHashPostfix("popUpLayer");
				var hasClick = false;	//防止重复点击
				$curPage.find(".flowReminderDiv").show().on('click', '.flowReminder_submit', function () {
					if(!hasClick){
						hasClick = true;
						showLoadingToast();
						var url = contextPath + "/portal/dynaform/document/flowReminder.action";
						var data = ajaxPage.getParams();
						$.ajax({
							type : "post",
							url : url,
							data : data,
							success : function(result){
								ajaxPage.clearHashPostfix("popUpLayer");
								
								$curPage.find('#toast').show();
				                setTimeout(function () {
				                	$curPage.find('#toast').hide();
				                    ajaxPage.reloadPage();
				                }, 2000);
				                $curPage.find('#flowReminderDiv').off('click').hide();
				                hideLoadingToast();
								hasClick = false;
							},
							error:function(){
								$curPage.find('#error_message').show();
				                setTimeout(function () {
				                	$curPage.find('#error_message').hide();
				                }, 2000);
				                $curPage.find('#flowReminderDiv').off('click').hide();
				                hideLoadingToast();
								hasClick = false;
							}
						});
					}
                }).on('click', '.flowReminder_cancel', function () {
                	ajaxPage.clearHashPostfix("popUpLayer");
                	$curPage.find('#flowReminderDiv').off('click').hide();
                });
				$curPage.find("#flowReminderDiv .flowReminder_content").bind('input oninput', function(){
					$curPage.find("#flow-reminder-counter .flow-reminder-num").html($("#flowReminderDiv .flowReminder_content").val().length); 
				});
			});
			$flowProcessBtn.after($b);
		}
		
		if($flowHtmlText.find("#_handup").size() > 0){//流程挂起
			var buttonName = $flowHtmlText.find("input[moduleType='handup']").attr("buttonname");
			var nodertId = $flowHtmlText.find("#_handup").attr("nodertId");
			var html = "<td class='flowTd'><a id='act_flow_retracement' name='button_act' title='挂起'  onclick='ev_flowHandup(\"" + nodertId + "\")' class='btn btn-orange btn-block'>"
				+ buttonName
				+ "</a></td>"
			var $b = $(html);
			$flowProcessBtn.after($b);
		}else if($flowHtmlText.find("#_recover").size() > 0){//流程恢复
			var buttonName = $flowHtmlText.find("input[moduleType='recover']").attr("buttonname");
			var nodertId = $flowHtmlText.find("#_recover").attr("nodertId");
			var html = "<td class='flowTd'><a id='act_flow_retracement' name='button_act' title='恢复'  onclick='ev_flowRecover(\"" + nodertId + "\")' class='btn btn-orange btn-block'>"
				+ buttonName
				+ "</a></td> ";
			var $b = $(html);
			$flowProcessBtn.after($b);
		}
		if($flowHtmlText.find("#btn_retracement").size() > 0 && $flowHtmlText.find('#act_flow_retracement').size() == 0){//渲染回撤按钮
			var html = "<td class='flowTd'><a id='act_flow_retracement' name='button_act' title='回撤' onclick='doRetracement()' class='btn btn-orange btn-block' >"
			+ "回撤"
			+ "</a></td>";
			var $b = $(html);
			$flowProcessBtn.after($b);
		}
		/* 手机端不显示加签按钮，这里屏蔽掉。 */
		/*if($flowHtmlText.find("#btn_addAuditor").size() > 0 && $flowHtmlText.find('#act_flow_addAuditor').size() == 0){//渲染流程加签按钮
			var html = "<td class='flowTd'><a id='act_flow_addAuditor' name='button_act' title='加签' onclick='addAuditor()'  class='btn btn-primary btn-block'>"
			+ "加签"
			+ "</a></td>";
			var $b = $(html);
			$flowProcessBtn.after($b);
		}*/
		if($flowHtmlText.find("#btn_editAuditor").size() > 0 && $flowHtmlText.find('#act_flow_editAuditor').size() == 0){//渲染编辑审批人按钮
			var html = "<td class='flowTd'><a id='act_flow_editAuditor' name='button_act' title='编辑流程审批人' onclick='editAuditor()'  class='btn btn-orange btn-block' >"
			+ "编辑流程审批人"
			+ "</a></td>";
			var $b = $(html);
			$flowProcessBtn.after($b);
		}
		if($flowHtmlText.find("#btn_editFlow").size() > 0 && $flowHtmlText.find('#act_flow_editFlow').size() == 0){//渲染调整流程按钮
			var html = "<td class='flowTd'><a id='act_flow_editFlow' name='button_act' title='流程调整' onclick='editFlowByFrontUser()'  class='btn btn-orange btn-block'>"
			+ "流程调整"
			+ "</a></td>";
			var $b = $(html);
			//$flowProcessBtn.after($b);
		}
		if($flowHtmlText.find("#btn_termination").size() > 0 && $flowHtmlText.find('#act_flow_termination').size() == 0){//渲染终止流程按钮
			var html = "<td class='flowTd'><a id='act_flow_termination' name='button_act' title='终止流程' onclick='terminateFlow()'  class='btn btn-negative btn-block'>"
			+ "终止流程"
			+ "</a></td>";
			var $b = $(html);
			$flowProcessBtn.after($b);
		}
		if($flowHtmlText.find("#btn_back").size() > 0 && $flowHtmlText.find('#act_flow_back').size() == 0){//渲染回退流程按钮
			var html = "<td class='flowTd'><a id='act_flow_back' name='button_act' class='btn btn-orange btn-block' title='回退'>"
			+ "回退"
			+ "</a></td>";
			var $b = $(html);
			$b.click(function(){
				var $page_flowPro = $curPage.find("#page_flowPro");
				$page_flowPro.show();
				//点击按钮时需要重新刷新面板
				FlowPanel.refreshFlowPanel("returnTo");

				var $btn = $("<div class='weui-flex__item'><a name='btn_act_returnto' class='btn btn-orange btn-block' data-transition='fade' title='回退'>回退</a></div>").click(function(){
					$(this).attr("disabled", "disabled");
					FlowPanel.flowReturnTo();
				});
				var $cancel = $("<div class='weui-flex__item'><a name='btn_act_committo' class='btn btn-block' data-transition='fade' title='取消'>取消</a></div>").click(function(){
					FlowPanel.cancelAction();
					$("#page_flowPro").hide();
				});
				$page_flowPro.find("#div_button_place").empty().append($btn).append($cancel);
				document.title = curPage_title + "-回退";
				ajaxPage.addHashPostfix("flowPro");
			});
			$flowProcessBtn.after($b);
		}

		$.each($flowProcessBtn , function(i,target){
			
			var showtype = $(target).attr("flowshowtype");
			var title = $(target).val();
			var $b; 
			var workFlowType = $(target).attr("workflowtype");	
			if(workFlowType == 0){ //预定流程
				if($flowHtmlText.find("#btn_commit").size() > 0 && $flowHtmlText.find("#act_flow_submit").size() == 0){//渲染提交流程按钮
					var html = '<td><a class="btn btn-positive btn-block" data-transition="fade" title="'+title+'">' + title + '</a></td>';
					var $b = $(html);
					$b.click(function(){
						if(showtype == "ST03"){
							//点击按钮时需要重新刷新面板
							FlowPanel.refreshFlowPanel("commitTo",true);
						}else{
							//点击按钮时需要重新刷新面板
							var $page_flowPro = $curPage.find("#page_flowPro");
							$page_flowPro.show();
							FlowPanel.refreshFlowPanel("commitTo");
							
							var $btn = $("<div class='weui-flex__item'><a name='btn_act_committo' class='btn btn-positive btn-block' title='提交'>提交</a></div>").click(function(){
								$(this).attr("disabled", "disabled");//锁住当前操作，避免重复提交
								FlowPanel.flowCommitTo();
							});
							var $cancel = $("<div class='weui-flex__item'><a name='btn_act_committo' class='btn btn-block' title='取消'>取消</a></div>").click(function(){
								FlowPanel.cancelAction();
								$("#page_flowPro").hide();
							});
	
	//						var $page_flowPro = ajaxPage.addPage();	//false:添加但暂不显示
	//						$page_flowPro.attr("role", "main").addClass("ui-content");
	//						$page_flowPro.append($page_flowProOld.children());
							
							//$page_flowPro显示后再初始化手写签批
							$page_flowPro.find("#div_button_place").empty().append($btn).append($cancel);
							document.title = curPage_title + "-" + title;
							ajaxPage.addHashPostfix("flowPro");
						}
					});
					$(target).after($b);
				}
			}else if(workFlowType == 1){
				
			  var flag = false ;
				 var auditorList = $curPage.find("#auditorList").val();
				 var userId = WebUser.id;
				 
				 if(auditorList){
					 var author =  JSON.parse(auditorList);
					 for(var index in author){
						 if(index == userId){
							 flag = true ;
							 break ;
						 }
					 }
				 }else{ //新建表单
					 flag = true ;
				 }
				 if(flag){
						 
				var stateid = $curPage.find("input[name='content.stateid']").val();
		     	var actid = $(this).attr("actid");
		     	/**
		     	* 通过判断stateid,渲染不同的按钮（【提交、回退、结束】/【发起】 ）
		     	*/
				if(stateid){
					//-- 提交按钮 -- start 
					var html = '<td><a id="act_flow_commitTo" class="btn btn-positive btn-block" title="'
						+title+'" name="button_act" _flowType = "80" data-transition="fade">'+title+'</a></td>';
					$b = $(html);
					$b.click(function(){
						var type = "commit";
						FlowProcess.renderFreePanel(actid,type);
					});
					$(target).after($b);
					//-- 提交按钮 -- end
					    
					//-- 回退按钮  -- start
					var html = '<td><a id="act_flow_backOff" class="btn btn-orange btn-block" title="回退'
						+'" name="button_act" _flowType = "80" data-transition="fade">回退</a></td>';
					$b = $(html);
					$b.click(function(){
						var type = "back";
						FlowProcess.renderFreePanel(actid,type);
					});
					$(target).after($b);
					//-- 回退按钮  -- end 

					//-- 结束流程按钮  -- start
					var html = '<td><a id="act_flow_complete" class="btn btn-primary btn-block" title="结束流程"'
						+' name="button_act" _flowType = "7" data-transition="fade">结束流程</a></td>';
					$b = $(html);
					$b.click(function(){
						var type = "end";
						FlowProcess.renderFreePanel(actid,type);
					});
					$(target).after($b);
					//--  结束流程按钮  -- end 
				}else{
					//-- 发起按钮 -- start 
					var html = '<td><a id="act_flow_startup" class="btn btn-positive btn-block" title="'
						+title+'" name="button_act" _flowType = "1" data-transition="fade">'+title+'</a></td>';
					$b = $(html);
					$b.click(function(){
						var type = "start";
						FlowProcess.renderFreePanel(actid,type);
					});
					$(target).after($b);
					//-- 提交按钮 -- end
				}
			 }
			}		 
			
		})
		
		
//    	$sigdiv = $("#signature").html("").jSignature({'UndoButton':false,width:$(window).width()-26,height:$(window).height()-300,color:'#000',lineWidth:0});
//    	
//    	var obj = document.getElementById('signature'); 
//    	obj.addEventListener("touchstart",function(e){
//    		e.preventDefault();
//    		e.stopPropagation();
//    	},false);
	},
	/**
		取消流程提交或回退操作
	**/

	cancelAction : function(){
//		console.info("back");
		var curFormId = ajaxPage.getCurPage().attr("id");
		var curPage_title = ajaxPage.title[curFormId];
		document.title = curPage_title;
		history.back();
	},
	
	/*
	*	子流程节点选择审批人	
	*/       
	showUserSelectOnSubFlow : function (actionName, settings){
		var $curPage = ajaxPage.getCurPage();
		var appId =  $curPage.find("input[activityType='5']").attr("applicationid");
		var url = contextPath + '/portal/phone/user/selectApprover4Subflow.jsp?application='+appId;
		url += "&docid=" + settings.docid + "&instanceId=" + settings.instanceId+"&numberSetingType=" + settings.numberSetingType+"&instanceTotal=" + settings.instanceTotal+"&nodeid=" + settings.nextNodeId+"&flowid="+ settings.flowid;
		//var jsonStr = jQuery("input[name='_subFlowApproverInfoAll']").val();
		var jsonStr = getSubFlowApproverInfo(settings.nextNodeId);
		//var nodeid = "123456789";
		var value = '';
		OBPM.dialog.show({
			width: 700,
			height:500,
			url: url,
			args: {value: value, readonly: settings.readonly,numberSetingType: settings.numberSetingType,instanceTotal: settings.instanceTotal,nodeid: settings.nextNodeId,jsonStr: jsonStr},
			//args: {"instanceTotal": 5,"nodeid": nodeid,"jsonStr": jsonStr},
			title: '用户选择',
			close: function(jsonObj) {
				if(jsonObj != null){
					//alert(JSON.stringify(jsonObj));
					
					
					FlowPanel._addSubFlowApproverInfo(subFlowApproverInfoAll,settings.nextNodeId,JSON.stringify(jsonObj));
					
					//jQuery("input[name='_subFlowApproverInfoAll']").val(JSON.stringify(jsonObj));
					//去除names属性
					var approverObj = JSON.parse(jsonObj.approver);
					var nameStr = "";
					//alert(approverObj.length);
					for(var i = 0; i < approverObj.length; i++){
						if(i != 0)nameStr += ',';
						nameStr += approverObj[i].names;
						delete approverObj[i].names;
					}
					$curPage.find("input[name="+ settings.textField +"]").val(nameStr);
					jsonObj.approver = approverObj;
					//alert("after delete ==> " + JSON.stringify(jsonObj));
					//-----------------------------------------------------
					//alert(JSON.stringify(jsonObj));
					FlowPanel._addSubFlowApproverInfo(subFlowApproverInfo,settings.nextNodeId,JSON.stringify(jsonObj));
					
					//biuldsubFlowApproverInfoStr();
					
					
					
					
					//-----------------------------------------------------
					
					//jQuery("input[name='_subFlowApproverInfo']").val(JSON.stringify(jsonObj));
				}
				//组装 json 字符串 并赋值到 一个name为“_subFlowApproverInfo”隐藏域里 作为参数提交到后台处理
			}
		});
	},
	_addSubFlowApproverInfo : function(Obj,nodeId,info){
		var falg =true;
		for(var i=0;i<Obj.length;i++){
			var tmp =Obj[i];
			if(tmp.indexOf(nodeId)>0){
				Obj[i] =info;
				falg = false;
				break;
			}
		}
		if(falg){
			Obj.push(info);
		}
	},

	
	showUserSelect : function(actionName, settings) {
		var $curPage = ajaxPage.getCurPage();
		var appId =  $curPage.find("input[activityType='5']").attr("applicationid");
		var url = contextPath + '/portal/phone/resource/component/dialog/selectUserByAll.jsp?application='+appId;
		url += "&docid=" + settings.docid + "&nodeid=" + settings.nextNodeId+"&flowid="+ settings.flowid +'&flow=true';
		var valueField = $curPage.find("#" + settings.valueField)[0];
		var value = "";
		if (valueField){
			value = valueField.value;
		}
		var ids = $curPage.find("#" + settings.hiddenIds).val();
		OBPM.dialog.show({
			width: 640,
			height: 480,
			url: url,
			//args: {parentObj: window, idField: "submitTo", nameField: settings.textField, readonly: settings.readonly},
			args: {parentObj: window, value: value, readonly: settings.readonly,"applicationid":appId,"defValue":ids},
			title: '用户选择',
			close: function(result) {
				selectFlag = true;
				var rtn = result.data;
				var field = $curPage.find("#" + settings.textField)[0];
				if (field) {
					if (rtn) {
						isToPerson = true;
						if (rtn[0] && rtn.length > 0) {
							var rtnValue = '';
							var rtnText = '';
							//userid多个以","分隔
							var selectedNode = $curPage.find("#" + settings.nextNodeId)[0];
							//用户选择曾经选过的节点
							var submitTo = $curPage.find("#submitTo").val();
							if(submitTo==null || submitTo==""){
                                 submitTo = "[";
							}else{
								if(submitTo.lastIndexOf("]")!=-1){
								 	submitTo = submitTo.substr(0,submitTo.lastIndexOf("]"));
								 	submitTo = submitTo +',';
								}
							}
							var start=submitTo.indexOf(settings.nextNodeId)+settings.nextNodeId.length+34;
							if(submitTo.indexOf(settings.nextNodeId)>0){
								var strfront=submitTo.substr(0,start);
								var strtemp=submitTo.substr(start+1,submitTo.length);
								if(strtemp.substr(strtemp.length-1,strtemp.length)==","){
									strtemp = strtemp.substr(0,strtemp.length-1);
								}
								var strfoot=strtemp.substr(strtemp.indexOf("]",0)-1,strtemp.length);
								submitTo=strfront;
								for (var i = 0; i < rtn.length; i++) {
									rtnValue += rtn[i].value + ";";
									rtnText += rtn[i].text + ";";
									submitTo+="'"+rtn[i].value+"',";
								}
								//submitTo= submitTo.replace('"userids":"','"userids":"[');
								submitTo=submitTo.substring(0,submitTo.length-2);
								submitTo+=strfoot;

								$curPage.find("#" + settings.hiddenIds).val(rtnValue.substring(0, rtnValue.lastIndexOf(";")));
							}
							else{
								submitTo+="{\"nodeid\":'"+settings.nextNodeId+"',\"isToPerson\":'true',\"userids\":\"[";
								var userids="";
								for (var i = 0; i < rtn.length; i++) {
									rtnValue += rtn[i].value + ";";
									rtnText += rtn[i].text + ";";
									userids+="'"+rtn[i].value+"',";
								}
								userids=userids.substring(0,userids.length-1); 
								submitTo+=userids+"]\"}";

								$curPage.find("#" + settings.hiddenIds).val(rtnValue.substring(0, rtnValue.lastIndexOf(";")));
							}
							$curPage.find("#submitTo").val(submitTo+"]");
							valueField.value = rtnValue.substring(0, rtnValue.lastIndexOf(";"));
							var text = rtnText.substring(0, rtnText.lastIndexOf(";"));
							field.value = text;
							field.title = text;
						}else{
							valueField.value = '';
							field.value = '';
							field.title = '';
							$curPage.find("#submitTo").val('');
							$curPage.find("#" + settings.hiddenIds).val('');
							isToPerson = false;
						}
					} else {
						
					}
			
					if (settings.callback) {
						settings.callback(valueField.name);
					}
				}
			}
		});
		
	}
};

function BackAction(){
	if(location.hash != "#flowPro"){
		ajaxPage.getCurPage().find("#page_flowPro").removeClass("active");
	}
}

/*
*	子流程节点选择审批人	
*/       
function showUserSelectOnSubFlow(actionName, settings){
	FlowPanel.showUserSelectOnSubFlow(actionName, settings);
}

/**不想改变服务器端输出HTML文本结构（虽然并不喜欢），在此保留一个接口*/
function showUserSelect(actionName, settings) {
	FlowPanel.showUserSelect(actionName, settings);
} 
/**
 *设置流程类型 
 *服务器端输出的html中输出的组件会调用此JavaScript方法，
 * 不想改变服务器端输出，因此保留一个空的方法接口，避免浏览器错误
 */
function ev_setFlowType(isOthers, element, flowOperation) {
	//Nothing...
}
 
function ev_validation(el, actid) {
	var $nextids = ajaxPage.getCurPage().find("[name='_nextids']");
	var flag = false;
	
//	makeAllFieldAble();
	
	if ($nextids && $nextids.size()>0) {
		for (var i=0; i<$nextids.length; i++) {
			if ($nextids[i].type != 'select-one') {
				if ($nextids[i].checked) {
					flag = true;
					break;
				}
			} else {
				if ($nextids[i].value != null 
				&& $nextids[i].value != '') {
					flag = true;
					break;
				}
			}
		}
		
		if (flag) {
			var action='<s:url action="action" namespace="/portal/dynaform/activity" />?_activityid=' + actid;
			ajaxPage.submitPage(action);
		}
		else {
			alert('{*[page.workflow.chooseaction]*}');
		}
	}
	else {
		alert ('{*[page.workflow.noaction]*}');
	}
}


 function getSubFlowApproverInfo(nodeId){
		for(var i=0;i<subFlowApproverInfoAll.length;i++){
			var tmp =subFlowApproverInfoAll[i];
			if(tmp.indexOf(nodeId)>0){
				return tmp;
			}
		}
		return '';
	}
 
/**
*指定抄送人
*
**/
function selectCirculator(actionName, settings) {
	var $curPage = ajaxPage.getCurPage();
	var url = contextPath + '/portal/phone/user/selectCirculatorByFlow.jsp?application='+application;
	url += "&docid=" + settings.docid + "&nodeid=" + settings.nextNodeId+"&flowid="+ settings.flowid;
	var valueField = $curPage.find("#" + settings.valueField)[0];
	var value = "";
	if (valueField){
		value = valueField.value;
	}
	OBPM.dialog.show({
		width: 610,
		height: 450,
		url: url,
		args: {
			// p1:当前窗口对象
			"parentObj" : window,
			// p2:存放userid的容器id
			"targetid" : "_circulatorInfo",
			// p3:存放username的容器id
			"receivername" : settings.textField,
			// p4:默认选中值, 格式为[userid1,userid2]
			"defValue": settings.defValue,
			//选择用户数
			"limitSum": settings.limitSum,
			//选择模式
			"selectMode":settings.selectMode
		},
		title: '用户选择',
		close: function(result) {
			selectFlag = true;
			var rtn = result;
			var field = $curPage.find("#" + settings.textField)[0];
			if (field) {
				if (rtn) {
					var rtnValue = '';
					var rtnText = '';
					for (var i = 0; i < rtn.length; i++) {
						rtnValue += '"'+ rtn[i].value + '",';
						rtnText += rtn[i].text + ";";
					}
					if(rtnValue.length>0){
						rtnValue = rtnValue.substring(0,rtnValue.length-1);
						rtnValue = '['+rtnValue+']';
						var circulatorInfo ='{circulator:'+rtnValue+'}';
						circulatorInfos[0] = circulatorInfo;
						//addCirculatorInfo(circulatorInfos,settings.nextNodeId,circulatorInfo);
						biuldCirculatorInfoStr();
					}
					var text = (rtnText == ''? rtnText:rtnText.substring(0,rtnText.length-1));
					field.value = text;
					field.title = text;
				}else {
					if (rtn == '') { // 清空
						field.value = '';
						field.title = '';
						circulatorInfos[0] ='';
						$curPage.find("#_circulatorInfo").val('');
					}
				}
			}
		}
	});
}

function addCirculatorInfo(Obj,nodeId,info){
	var falg =true;
	for(var i=0;i<Obj.length;i++){
		var tmp =Obj[i];
		if(tmp.indexOf(nodeId)>0){
			Obj[i] =info;
			falg = false;
			break;
		}
	}
	if(falg){
		Obj.push(info);
	}
}

function biuldCirculatorInfoStr(){
	var result ='';
	if(circulatorInfos.length>0){
		result+='[';
	}
	for(var i=0;i<circulatorInfos.length;i++){
		result+=circulatorInfos[i]+',';
	}
	if(result.length>0){
		result = result.substring(0,result.length-1);
		result+=']';
		
		ajaxPage.getCurPage().find("input[name='_circulatorInfo']").val(result);
	}
}

function checkIsSelectCirculator(){
	var $curPage = ajaxPage.getCurPage();
	var obj = $curPage.find("#_circulator")[0];
	var _flowType = $curPage.find("#_flowType").val();
	/*if(obj && _flowType != '81'){
		if(obj.value.length<=0){
			alert("请选择抄送人！");
			return false;
		}
	}*/
	return true;
}

//流程回撤
function doRetracement() {
	var action = contextPath + '/portal/dynaform/document/retracement.action';
	ajaxPage.getCurPage().find("[name=_flowType]").val("retracement");
	ajaxPage.submitPage(action);
}

//流程终止
function terminateFlow() {

	$.confirm({
			tip : "你确定要终止流程? 终止后将不可恢复!<br/>请输入审批意见：<textarea></textarea>",
			trueCall : function(val){
				ajaxPage.getCurPage().find('[name=_attitude]').val(val);
		
				var url = contextPath + '/portal/dynaform/document/terminateFlow.action';
				ajaxPage.submitPage(url);
			},
			returnVal : true
	});
}

//流程恢复
function ev_flowRecover(nodertId){
	var url = contextPath + '/portal/dynaform/document/flowRecover.action?nodertId=' + nodertId;
	ajaxPage.submitPage(url);
}

//流程挂起
function ev_flowHandup(nodertId){
	var url = contextPath + '/portal/dynaform/document/flowHandup.action?nodertId=' + nodertId;
	ajaxPage.submitPage(url);
}

/**
 * 加签
 */
function addAuditor(){
	var docid = ajaxPage.getCurPage().find("#_docid").val();
	var url = contextPath + "/portal/share/dynaform/document/addAuditor.jsp?_docid=" + docid + "&application=" + application.value;
	var actionUrl = contextPath
	+ "/portal/dynaform/document/addAuditor.action";
	
	var oCurridArray = ajaxPage.getCurPage().find("[name='_currid']");
	// 当前节点ID
	var currid = '';
	if (oCurridArray && oCurridArray.length > 0) {
		currid = oCurridArray[0].value;
	}
	OBPM.dialog.show({
		width: 580,
		height: 400,
		url: url,
		args: {},
		title: title_addAuditor,
		close: function(result) {
			if(result){
				var map = {};
				var obj = eval('(' + result + ')');
				map[currid] = obj.userlist;
				ajaxPage.getCurPage().find("#auditorList").val(jQuery.json2Str(map));
				makeAllFieldAble();
				document.forms[0].action = actionUrl;
				document.forms[0].submit();
			}
		}
	});
}

/**
编辑审批人
*/
function editAuditor(){
	var actionUrl = contextPath	+ "/portal/dynaform/document/editAuditor.action";

	var $curPage = ajaxPage.getCurPage();
	var oCurridArray = $curPage.find("[name=_currid]");
	// 当前节点ID
	var currid = '';
	if (oCurridArray && oCurridArray.length > 0) {
		currid = oCurridArray[0].value;
	}
	// 目标文本框
	var $oFiled = $curPage.find("#auditorList");
	if ($oFiled && $oFiled.size() > 0) {
		var map = $oFiled.val() ? jQuery.parseJSON($oFiled.val()) : {};
		showUserSelectNoFlow('', {
					defValue: map[currid],
					callback: function(result) {
						// prototype1_6.js
						if (result) {
							if(result && result.length>0 && result.indexOf(';')<0){
								result = result+';';
							}
							var tUserList = new Array();
							var userlist = result.split(";");  
							
							if(userlist.length > 0){   //选择的数据
								for(var key in userlist){      
									var userid = $.trim(userlist[key]);
									if(userid != null  && userid != "" && userid != undefined ){
										tUserList.push(userid);
									}
								}
							}
							var tmpUserList = map[currid] ? map[currid] : {};  //旧数据
							if(tmpUserList.length > 0){
								for(var key in tmpUserList){
									var userid = tmpUserList[key]
									if($.trim(userid)!= null){
										var index = tUserList.toString().indexOf(userid);
										if(index == -1){
											tUserList.push(userid);
										}
									}
								}
							}
							
							// 为当前节点设置
							map[currid] = tUserList;
							$oFiled.val(jQuery.json2Str(map));
							ajaxPage.submitPage(actionUrl);
//							document.forms[0].action = actionUrl;
//							makeAllFieldAble();
//							document.forms[0].submit();
						}
					}
				});
	}
}

/**
 * 显示流程历史信息
 */
function showViewHistory(){
	ajaxPage.addHashPostfix("popUpLayer");
	var $curPage = ajaxPage.getCurPage();
	$curPage.find("#viewHistory").show();
}

function showbig(obj){
	var $curPage = ajaxPage.getCurPage();
	var showPicPanel = "<div class='showPicPanel' style='text-align: center;padding-top: 50%;position: fixed;top: 0px;left: 0px;right: 0px;bottom: 0px;background-color: rgba(0, 0, 0, 0.48);z-index: 100;'><img src='' onclick='hideBig(this);' style='background:#fff'></div>";
	$curPage.find("#viewHistory").append(showPicPanel);
	$curPage.find(".showPicPanel").find("img").attr("src",$(obj).attr("src"));
	
}
function hideBig(obj){
	var $curPage = ajaxPage.getCurPage();
	$curPage.find("#viewHistory").find(".showPicPanel").remove();
}
; 
var FlowProcess = {
	bindEvent : function(){

	},
	//渲染自由流程
	renderFreePanel : function(actid,type){

		var $page_flowPro = ajaxPage.getCurPage().find("#page_flowPro");
		$page_flowPro.show();
		
		
		var $nodeBox = $(".flow-submit__panel").find("#flow-submit__node-box");
		
		
		
		var $start = $("<div class='weui-flex__item'><a name='btn_act_committo' class='btn btn-positive btn-block' title='发起'>发起</a></div>").click(function(){
			$(this).attr("disabled", "disabled");//锁住当前操作，避免重复操作
			FlowProcess.active.freeFlowStartUp(actid);
		});
		
		var $commit = $("<div class='weui-flex__item'><a name='btn_act_committo' class='btn btn-positive btn-block' title='提交'>提交</a></div>").click(function(){
			$(this).attr("disabled", "disabled");//锁住当前操作，避免重复操作
			FlowProcess.active.freeFlowCommitTo(actid);
		});
		
		var $back = $("<div class='weui-flex__item'><a name='btn_act_committo' class='btn btn-positive btn-block' title='回退'>回退</a></div>").click(function(){
			$(this).attr("disabled", "disabled");//锁住当前操作，避免重复操作
			FlowProcess.active.freeFlowBackOff(actid);
			$("#page_flowPro").hide();
		});
		var $end = $("<div class='weui-flex__item'><a name='btn_act_committo' class='btn btn-positive btn-block' title='结束'>结束</a></div>").click(function(){
			$(this).attr("disabled", "disabled");//锁住当前操作，避免重复操作
			FlowProcess.active.freeFlowComplete(actid);
			$("#page_flowPro").hide();
		});
		var $cancel = $("<div class='weui-flex__item'><a name='btn_act_committo' class='btn btn-block' title='取消'>取消</a></div>").click(function(){
			FlowPanel.cancelAction();
			$("#page_flowPro").hide();
		});
		
		
		if(type == "start"){//开始
			var html = '<div class="weui-cells weui-cells_checkbox" style="margin-top:-1px" data-id="freeflow">'
				+'<label class="weui-cell  weui-check__label">'
				+'<div class="weui-cell__bd">审批人</div></label>'
				+'<div class="weui-cell">'
				+'<div class="flow-submit__user-panel">'
				+'<div class="flow-submit__user-select-box">'
				+'<div name="free_flow" class="flow-submit__user-avatar flow-submit__user-select"></div>'
				+'</div></div></div>'
				+'<input type="hidden" id="freeflow_text" name="nextUser" />'
				+'<input type="hidden" id="freeflow" name="nextUserId" />'
				+'</div>';
			$nodeBox.html(html);
			$page_flowPro.find("#div_button_place").empty().append($start).append($cancel);
		}else if(type == "commit"){//提交
			var html = '<div class="weui-cells weui-cells_checkbox" style="margin-top:-1px" data-id="freeflow">'
				+'<label class="weui-cell  weui-check__label">'
				+'<div class="weui-cell__bd">审批人</div></label>'
				+'<div class="weui-cell">'
				+'<div class="flow-submit__user-panel">'
				+'<div class="flow-submit__user-select-box">'
				+'<div name="free_flow" class="flow-submit__user-avatar flow-submit__user-select"></div>'
				+'</div></div></div>'
				+'<input type="hidden" id="freeflow_text" name="nextUser" />'
				+'<input type="hidden" id="freeflow" name="nextUserId" />'
				+'</div>';
			$nodeBox.html(html);
			$page_flowPro.find("#div_button_place").empty().append($commit).append($cancel);
		}else if(type == "back"){//回退
			var html = '<div class="weui-cells weui-cells_checkbox" style="margin-top:-1px" data-id="freeflow">'
				+'<label class="weui-cell  weui-check__label">'
				+'<div class="weui-cell__bd">审批人</div></label>'
				+'<div class="weui-cell">'
				+'<div class="flow-submit__user-panel">'
				+'<div class="flow-submit__user-select-box">'
				+'<div name="free_flow" class="flow-submit__user-avatar flow-submit__user-select"></div>'
				+'</div></div></div>'
				+'<input type="hidden" id="freeflow_text" name="nextUser" />'
				+'<input type="hidden" id="freeflow" name="nextUserId" />'
				+'</div>';
			$nodeBox.html(html);
			$page_flowPro.find("#div_button_place").empty().append($back).append($cancel);
		}else if(type == "end"){//结束
			$nodeBox.html("");
			$page_flowPro.find("#div_button_place").empty().append($end).append($cancel);
		}
		ajaxPage.addHashPostfix("flowPro");
		var toChooseUsers = [];
		var tabs = {
				// [] 配置显示的tab，全部、部门、职务、常用
				all : {name:'全部',url: 'contacts/getAllUser.action'},
				dept : {name:'部门',url: 'contacts/getContactsTree.action'},
			    role : {name:'角色',url: 'contacts/getApplicationAndRoleContactsTree.action'},
			    favorite : {name:'常用',url: 'contacts/getFavoriteContacts.action'}
			}
		if(type == "back"){
			tabs = {
				// [] 配置显示的tab，全部、部门、职务、常用
				all : {name:'全部',url: 'contacts/getAllUser.action'}
			}
			var params = {
				"stateId":$("#content_stateid").val(),
				"applicationId":$("#application").val()
			}	
			$.ajax({
	    		url: contextPath+"/contacts/getHisActors4FreeFlow.action",
	    		type:"post",
	    		async: false,
	    		cache:false,
				data:params,
				success: function(result){
					toChooseUsers = result.data;
	    		}
	    	})	
		}
		$nodeBox.find("#freeflow").userbox({
			//属性和事件回调可自定义，无自定义需求可完全不填，具体用法参考说明文档
			id : 'freeflow',//必须，存放回选的用户value值的input的id
			textId : 'freeflow_text',//必须，存放回选的用户text值的input的id
			isPhone : true,		//是否手机端
			multiple: false,//是否多选模式
			mode: 'all',//simple:精简模式|all:完整模式   
			tabs : tabs,
			width: 'auto',//宽度
			disabled: false,//是否禁用
			readOnlyShowValOnly : true,//只读是否只显示值
			required: false,//是否必填
			clearlabel : "清除",	//清除按钮的title
			separator: ';',//多选模式下的分隔符
			selectBtn: $nodeBox.find(".flow-submit__user-select"),
			toChooseUsers: toChooseUsers,
			onSuccess : function(result){
				var userValue = "";
				if(result.data.length>0){
					for(var i = 0;i < result.data.length;i++){
						var id = result.data[i].value;
						userValue += id + ";";
					}
					$("#freeflow").val(userValue.substr(0,userValue.length-1));
					FlowPanel.renderSelectUser("freeflow",result);
				}
			},
			onOpen : function(){
				
			},
			onClose : function(){
				
			}
		});
	},
	active : {
		/**自由流程启动**/
		freeFlowStartUp : function(actid) {
			//指定下一节点审批人
			if ($("input[name='nextUserId']").val()=='') {
				Activity.showMessage('请选择审批人！',"error");
				return;
			}
			//手写签名
			var data = $sigdiv.jSignature('getData', "image");
			if(data && data.length==2){
				if(data[1] != defaultSignature){
					var signatureJson = '{"type":"'+data[0]+'","data":"'+data[1]+'"}';
					$("input[name='_signature']").val(signatureJson);
				}
			}
			
			//设置流程类型为【自由流程启动-1】
			if(document.getElementById("_flowType")){
				document.getElementById("_flowType").value = "1";
			}
			//执行提交流程按钮操作
			Activity.doExecute(actid,5);
		},
		
		/**自由流程提交**/
		freeFlowCommitTo : function(actid) {
			//指定下一节点审批人
			if ($("input[name='nextUserId']").val()=='') {
				Activity.showMessage('请选择审批人！',"error");
				return;
			}
			//手写签名
			var data = $sigdiv.jSignature('getData', "image");
			if(data && data.length==2){
				if(data[1] != defaultSignature){
					var signatureJson = '{"type":"'+data[0]+'","data":"'+data[1]+'"}';
					$("input[name='_signature']").val(signatureJson);
				}
			}
			
			//设置流程类型为【自由流程提交-80】
			if(document.getElementById("_flowType")){
				document.getElementById("_flowType").value = "80";
			}
			//执行提交流程按钮操作
			Activity.doExecute(actid,5);
		},
		
		/**自由流程回退**/
		freeFlowBackOff : function(actid) {
			//指定下一节点审批人
			if ($("input[name='nextUserId']").val()=='') {
				Activity.showMessage('请选择审批人！',"error");
				return;
			}
			//手写签名
			var data = $sigdiv.jSignature('getData', "image");
						
			if(data && data.length==2){
				if(data[1] != defaultSignature){
					var signatureJson = '{"type":"'+data[0]+'","data":"'+data[1]+'"}';
					$("input[name='_signature']").val(signatureJson);
				}
			}
			
			//设置流程类型为【自由流程回退-81】
			if(document.getElementById("_flowType")){
				document.getElementById("_flowType").value = "81";
			}
			//执行提交流程按钮操作
			Activity.doExecute(actid,5);
		},
		
		/**自由流程结束**/
		freeFlowComplete : function(actid) {
			//设置流程类型为【自由流程结束-7】
			if(document.getElementById("_flowType")){
				document.getElementById("_flowType").value = "7";
			}
			//手写签名
			var data = $sigdiv.jSignature('getData', "image");
			if(data && data.length==2){
				if(data[1] != defaultSignature){
					var signatureJson = '{"type":"'+data[0]+'","data":"'+data[1]+'"}';
					$("input[name='_signature']").val(signatureJson);
				}
			}
			//执行提交流程按钮操作
			Activity.doExecute(actid,5);
		}
	}
}; 
/*
 
jSignature v2 "2012-11-01T22:48" "commit ID 1c15dfafecc75925c3b7d529356a558b59220edb"
Copyright (c) 2012 Willow Systems Corp http://willow-systems.com
Copyright (c) 2010 Brinley Ang http://www.unbolt.net
MIT License <http://www.opensource.org/licenses/mit-license.php> 


Simplify.js BSD 
(c) 2012, Vladimir Agafonkin
mourner.github.com/simplify-js


base64 encoder
MIT, GPL
http://phpjs.org/functions/base64_encode
+   original by: Tyler Akins (http://rumkin.com)
+   improved by: Bayron Guevara
+   improved by: Thunder.m
+   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
+   bugfixed by: Pellentesque Malesuada
+   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
+   improved by: Rafal Kukawski (http://kukawski.pl)


jSignature v2 jSignature's Undo Button and undo functionality plugin


jSignature v2 jSignature's custom "base30" format export and import plugins.


jSignature v2 SVG export plugin.

*/
(function(){function q(b){for(var j,s=b.css("color"),g,b=b[0],c=!1;b&&!g&&!c;){try{j=$(b).css("background-color")}catch(d){j="transparent"}"transparent"!==j&&"rgba(0, 0, 0, 0)"!==j&&(g=j);c=b.body;b=b.parentNode}var b=/rgb[a]*\((\d+),\s*(\d+),\s*(\d+)/,c=/#([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})([AaBbCcDdEeFf\d]{2})/,a;j=void 0;(j=s.match(b))?a={r:parseInt(j[1],10),g:parseInt(j[2],10),b:parseInt(j[3],10)}:(j=s.match(c))&&(a={r:parseInt(j[1],16),g:parseInt(j[2],16),b:parseInt(j[3],16)});var f;g?
(j=void 0,(j=g.match(b))?f={r:parseInt(j[1],10),g:parseInt(j[2],10),b:parseInt(j[3],10)}:(j=g.match(c))&&(f={r:parseInt(j[1],16),g:parseInt(j[2],16),b:parseInt(j[3],16)})):f=a?127<Math.max.apply(null,[a.r,a.g,a.b])?{r:0,g:0,b:0}:{r:255,g:255,b:255}:{r:255,g:255,b:255};j=function(b){return"rgb("+[b.r,b.g,b.b].join(", ")+")"};a&&f?(b=Math.max.apply(null,[a.r,a.g,a.b]),a=Math.max.apply(null,[f.r,f.g,f.b]),a=Math.round(a+-0.75*(a-b)),a={r:a,g:a,b:a}):a?(a=Math.max.apply(null,[a.r,a.g,a.b]),b=1,127<a&&
(b=-1),a=Math.round(a+96*b),a={r:a,g:a,b:a}):a={r:191,g:191,b:191};return{color:s,"background-color":f?j(f):g,"decor-color":j(a)}}function m(b,j){this.x=b;this.y=j;this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)};this._length=null;this.getLength=function(){this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)));return this._length};var s=function(b){return Math.round(b/Math.abs(b))};this.resizeTo=function(b){if(0===this.x&&0===this.y)this._length=0;else if(0===
this.x)this._length=b,this.y=b*s(this.y);else if(0===this.y)this._length=b,this.x=b*s(this.x);else{var j=Math.abs(this.y/this.x),a=Math.sqrt(Math.pow(b,2)/(1+Math.pow(j,2))),j=j*a;this._length=b;this.x=a*s(this.x);this.y=j*s(this.y)}return this};this.angleTo=function(b){var j=this.getLength()*b.getLength();return 0===j?0:Math.acos(Math.min(Math.max((this.x*b.x+this.y*b.y)/j,-1),1))/Math.PI}}function k(b,j){this.x=b;this.y=j;this.getVectorToCoordinates=function(b,j){return new m(b-this.x,j-this.y)};
this.getVectorFromCoordinates=function(b,j){return this.getVectorToCoordinates(b,j).reverse()};this.getVectorToPoint=function(b){return new m(b.x-this.x,b.y-this.y)};this.getVectorFromPoint=function(b){return this.getVectorToPoint(b).reverse()}}function t(b,j,a,g,c){this.data=b;this.context=j;if(b.length)for(var d=b.length,f,l,i=0;i<d;i++){f=b[i];l=f.x.length;a.call(j,f);for(var e=1;e<l;e++)g.call(j,f,e);c.call(j,f)}this.changed=function(){};this.startStrokeFn=a;this.addToStrokeFn=g;this.endStrokeFn=
c;this.inStroke=!1;this._stroke=this._lastPoint=null;this.startStroke=function(b){if(b&&"number"==typeof b.x&&"number"==typeof b.y){this._stroke={x:[b.x],y:[b.y]};this.data.push(this._stroke);this._lastPoint=b;this.inStroke=!0;var j=this._stroke,a=this.startStrokeFn,g=this.context;setTimeout(function(){a.call(g,j)},3);return b}return null};this.addToStroke=function(b){if(this.inStroke&&"number"===typeof b.x&&"number"===typeof b.y&&4<Math.abs(b.x-this._lastPoint.x)+Math.abs(b.y-this._lastPoint.y)){var j=
this._stroke.x.length;this._stroke.x.push(b.x);this._stroke.y.push(b.y);this._lastPoint=b;var a=this._stroke,g=this.addToStrokeFn,s=this.context;setTimeout(function(){g.call(s,a,j)},3);return b}return null};this.endStroke=function(){var b=this.inStroke;this.inStroke=!1;this._lastPoint=null;if(b){var j=this._stroke,a=this.endStrokeFn,g=this.context,s=this.changed;setTimeout(function(){a.call(g,j);s.call(g)},3);return!0}return null}}function r(b,j,a){var g=this.$parent=$(b),b=this.eventTokens={};this.events=
new v(this);var c=$.fn[e]("globalEvents"),d={width:"ratio",height:"ratio",sizeRatio:4,color:"#000","background-color":"#fff","decor-color":"#eee",lineWidth:0,minFatFingerCompensation:-10,showUndoButton:!1,data:[]};$.extend(d,q(g));j&&$.extend(d,j);this.settings=d;for(var f in a)a.hasOwnProperty(f)&&a[f].call(this,f);this.events.publish(e+".initializing");this.$controlbarUpper=$('<div style="padding:0 !important;margin:0 !important;width: 100% !important; height: 0 !important;margin-top:-1em !important;margin-bottom:1em !important;"></div>').appendTo(g);
this.isCanvasEmulator=!1;a=this.canvas=this.initializeCanvas(d);j=$(a);this.$controlbarLower=$('<div style="padding:0 !important;margin:0 !important;width: 100% !important; height: 0 !important;margin-top:-1.5em !important;margin-bottom:1.5em !important;"></div>').appendTo(g);this.canvasContext=a.getContext("2d");j.data(e+".this",this);g=(g=d.lineWidth)?g:Math.max(Math.round(a.width/400),2);d.lineWidth=g;this.lineCurveThreshold=3*d.lineWidth;d.cssclass&&""!=$.trim(d.cssclass)&&j.addClass(d.cssclass);
this.fatFingerCompensation=0;var g=function(b){var j,a,g=function(g){g=g.changedTouches&&0<g.changedTouches.length?g.changedTouches[0]:g;return new k(Math.round(g.pageX+j),Math.round(g.pageY+a)+b.fatFingerCompensation)},d=new y(750,function(){b.dataEngine.endStroke()});this.drawEndHandler=function(j){try{j.preventDefault()}catch(a){}d.clear();b.dataEngine.endStroke()};this.drawStartHandler=function(c){c.preventDefault();var s=$(b.canvas).offset();j=-1*s.left;a=-1*s.top;b.dataEngine.startStroke(g(c));
d.kick()};this.drawMoveHandler=function(j){j.preventDefault();b.dataEngine.inStroke&&(b.dataEngine.addToStroke(g(j)),d.kick())};return this}.call({},this),l=g.drawEndHandler,i=g.drawStartHandler,p=g.drawMoveHandler,h=this.canvas,j=$(h);this.isCanvasEmulator?(j.bind("mousemove."+e,p),j.bind("mouseup."+e,l),j.bind("mousedown."+e,i)):(h.ontouchstart=function(b){h.onmousedown=void 0;h.onmouseup=void 0;h.onmousemove=void 0;this.fatFingerCompensation=d.minFatFingerCompensation&&-3*d.lineWidth>d.minFatFingerCompensation?
-3*d.lineWidth:d.minFatFingerCompensation;i(b);h.ontouchend=l;h.ontouchstart=i;h.ontouchmove=p},h.onmousedown=function(b){h.ontouchstart=void 0;h.ontouchend=void 0;h.ontouchmove=void 0;i(b);h.onmousedown=i;h.onmouseup=l;h.onmousemove=p});b[e+".windowmouseup"]=c.subscribe(e+".windowmouseup",g.drawEndHandler);this.events.publish(e+".attachingEventHandlers");var n=this,b=d.width.toString(10),w=e;if("ratio"===b||"%"===b.split("")[b.length-1])this.eventTokens[w+".parentresized"]=c.subscribe(w+".parentresized",
function(b,j,a){return function(){var g=j.width();if(g!==a){for(var d in b)b.hasOwnProperty(d)&&(c.unsubscribe(b[d]),delete b[d]);var s=n.settings;n.$parent.children().remove();for(d in n)n.hasOwnProperty(d)&&delete n[d];d=s.data;var g=1*g/a,f=[],l,i,e,h,k,p;i=0;for(e=d.length;i<e;i++){p=d[i];l={x:[],y:[]};h=0;for(k=p.x.length;h<k;h++)l.x.push(p.x[h]*g),l.y.push(p.y[h]*g);f.push(l)}s.data=f;j[w](s)}}}(this.eventTokens,this.$parent,this.$parent.width(),1*this.canvas.width/this.canvas.height));this.resetCanvas(d.data);
this.events.publish(e+".initialized");return this}var e="jSignature",y=function(b,j){var a;this.kick=function(){clearTimeout(a);a=setTimeout(j,b)};this.clear=function(){clearTimeout(a)};return this},v=function(b){this.topics={};this.context=b?b:this;this.publish=function(b,a,g,d){if(this.topics[b]){var c=this.topics[b],f=Array.prototype.slice.call(arguments,1),l=[],i,e,h,p;e=0;for(h=c.length;e<h;e++)p=c[e],i=p[0],p[1]&&(p[0]=function(){},l.push(e)),i.apply(this.context,f);e=0;for(h=l.length;e<h;e++)c.splice(l[e],
1)}};this.subscribe=function(b,a,g){this.topics[b]?this.topics[b].push([a,g]):this.topics[b]=[[a,g]];return{topic:b,callback:a}};this.unsubscribe=function(b){if(this.topics[b.topic])for(var a=this.topics[b.topic],g=0,d=a.length;g<d;g++)a[g][0]===b.callback&&a.splice(g,1)}},z=function(b){var a=this.canvasContext,d=b.x[0],b=b.y[0],g=this.settings.lineWidth,c=a.fillStyle;a.fillStyle=a.strokeStyle;a.fillRect(d+g/-2,b+g/-2,g,g);a.fillStyle=c},u=function(b,a){var d=new k(b.x[a-1],b.y[a-1]),g=new k(b.x[a],
b.y[a]),c=d.getVectorToPoint(g);if(1<a){var f=new k(b.x[a-2],b.y[a-2]),l=f.getVectorToPoint(d),i;if(l.getLength()>this.lineCurveThreshold){i=2<a?(new k(b.x[a-3],b.y[a-3])).getVectorToPoint(f):new m(0,0);var e=0.35*l.getLength(),h=l.angleTo(i.reverse()),p=c.angleTo(l.reverse());i=(new m(i.x+l.x,i.y+l.y)).resizeTo(Math.max(0.05,h)*e);var n=(new m(l.x+c.x,l.y+c.y)).reverse().resizeTo(Math.max(0.05,p)*e),l=this.canvasContext,e=f.x,p=f.y,h=d.x,w=d.y,A=f.x+i.x,f=f.y+i.y;i=d.x+n.x;n=d.y+n.y;l.beginPath();
l.moveTo(e,p);l.bezierCurveTo(A,f,i,n,h,w);l.stroke()}}c.getLength()<=this.lineCurveThreshold&&(c=this.canvasContext,f=d.x,d=d.y,i=g.x,g=g.y,c.beginPath(),c.moveTo(f,d),c.lineTo(i,g),c.stroke())},x=function(b){var a=b.x.length-1;if(0<a){var d=new k(b.x[a],b.y[a]),g=new k(b.x[a-1],b.y[a-1]),c=g.getVectorToPoint(d);if(c.getLength()>this.lineCurveThreshold){if(1<a){var b=(new k(b.x[a-2],b.y[a-2])).getVectorToPoint(g),f=(new m(b.x+c.x,b.y+c.y)).resizeTo(c.getLength()/2),c=this.canvasContext,b=g.x,a=g.y,
l=d.x,i=d.y,e=g.x+f.x,g=g.y+f.y,f=d.x,d=d.y;c.beginPath();c.moveTo(b,a);c.bezierCurveTo(e,g,f,d,l,i)}else c=this.canvasContext,b=g.x,g=g.y,a=d.x,d=d.y,c.beginPath(),c.moveTo(b,g),c.lineTo(a,d);c.stroke()}}};r.prototype.resetCanvas=function(b){var a=this.canvas,d=this.settings,c=this.canvasContext,f=this.isCanvasEmulator,l=a.width,i=a.height;c.clearRect(0,0,l+30,i+30);c.shadowColor=c.fillStyle=d["background-color"];f&&c.fillRect(0,0,l+30,i+30);c.lineWidth=Math.ceil(parseInt(d.lineWidth,10));c.lineCap=
c.lineJoin="round";c.strokeStyle=d["decor-color"];c.shadowOffsetX=0;c.shadowOffsetY=0;var h=Math.round(i/5),p=1.5*h,k=i-h,l=l-1.5*h,i=i-h;c.beginPath();c.moveTo(p,k);c.lineTo(l,i);c.stroke();c.strokeStyle=d.color;f||(c.shadowColor=c.strokeStyle,c.shadowOffsetX=0.5*c.lineWidth,c.shadowOffsetY=-0.6*c.lineWidth,c.shadowBlur=0);b||(b=[]);c=this.dataEngine=new t(b,this,z,u,x);d.data=b;$(a).data(e+".data",b).data(e+".settings",d);var n=this.$parent,w=this.events,A=e;c.changed=function(){w.publish(A+".change");
n.trigger("change")};c.changed();return!0};r.prototype.initializeCanvas=function(b){var a=document.createElement("canvas"),c=$(a);b.width===b.height&&"ratio"===b.height&&(b.width="100%");c.css("margin",0).css("padding",0).css("border","none").css("height","ratio"===b.height||!b.height?1:b.height.toString(10)).css("width","ratio"===b.width||!b.width?1:b.width.toString(10));c.appendTo(this.$parent);"ratio"===b.height?c.css("height",Math.round(c.width()/b.sizeRatio)):"ratio"===b.width&&c.css("width",
Math.round(c.height()*b.sizeRatio));c.addClass(e);a.width=c.width();a.height=c.height();b=a;if(b.getContext)b=!1;else{var c=b.ownerDocument.parentWindow,d=c.FlashCanvas?b.ownerDocument.parentWindow.FlashCanvas:"undefined"===typeof FlashCanvas?void 0:FlashCanvas;if(d){b=d.initElement(b);d=1;c&&(c.screen&&c.screen.deviceXDPI&&c.screen.logicalXDPI)&&(d=1*c.screen.deviceXDPI/c.screen.logicalXDPI);if(1!==d)try{$(b).children("object").get(0).resize(Math.ceil(b.width*d),Math.ceil(b.height*d)),b.getContext("2d").scale(d,
d)}catch(f){}b=!0}else throw Error("Canvas element does not support 2d context. jSignature cannot proceed.");}this.isCanvasEmulator=b;a.onselectstart=function(b){b&&b.preventDefault&&b.preventDefault();b&&b.stopPropagation&&b.stopPropagation();return!1};return a};var p=window,h=function(b,a){var c=new Image,d=this;c.onload=function(){d.getContext("2d").drawImage(c,0,0,c.width<d.width?c.width:d.width,c.height<d.height?c.height:d.height)};c.src="data:"+a+","+b},a=function(b){this.find("canvas."+e).add(this.filter("canvas."+
e)).data(e+".this").resetCanvas(b);return this},f=function(b,a){if(void 0===a&&("string"===typeof b&&"data:"===b.substr(0,5))&&(a=b.slice(5).split(",")[0],b=b.slice(6+a.length),a===b))return;var c=this.find("canvas."+e).add(this.filter("canvas."+e));if(n.hasOwnProperty(a))0!==c.length&&n[a].call(c[0],b,a,function(b){return function(){return b.resetCanvas.apply(b,arguments)}}(c.data(e+".this")));else throw Error(e+" is unable to find import plugin with for format '"+String(a)+"'");return this},d=new v,
c=e,l,i=function(){d.publish(c+".parentresized")};$(p).bind("resize."+c,function(){l&&clearTimeout(l);l=setTimeout(i,500)}).bind("mouseup."+c,function(){d.publish(c+".windowmouseup")});var w={},A={"default":function(){return this.toDataURL()},"native":function(b){return b},image:function(){var b=this.toDataURL();if("string"===typeof b&&4<b.length&&"data:"===b.slice(0,5)&&-1!==b.indexOf(",")){var a=b.indexOf(",");return[b.slice(5,a),b.substr(a+1)]}return[]}},n={"native":function(b,a,c){c(b)},image:h,
"image/png;base64":h,"image/jpeg;base64":h,"image/jpg;base64":h},B={"export":A,"import":n,instance:w},C={init:function(b){return this.each(function(){var a,c=!1;for(a=this.parentNode;a&&!c;)c=a.body,a=a.parentNode;!c||new r(this,b,w)})},getSettings:function(){return this.find("canvas."+e).add(this.filter("canvas."+e)).data(e+".this").settings},clear:a,reset:a,addPlugin:function(b,a,c){B.hasOwnProperty(b)&&(B[b][a]=c);return this},listPlugins:function(b){var a=[];if(B.hasOwnProperty(b)){var b=B[b],
c;for(c in b)b.hasOwnProperty(c)&&a.push(c)}return a},getData:function(b){var a=this.find("canvas."+e).add(this.filter("canvas."+e));void 0===b&&(b="default");if(0!==a.length&&A.hasOwnProperty(b))return A[b].call(a.get(0),a.data(e+".data"))},importData:f,setData:f,globalEvents:function(){return d},events:function(){return this.find("canvas."+e).add(this.filter("canvas."+e)).data(e+".this").events}};$.fn[e]=function(b){if(!b||"object"===typeof b)return C.init.apply(this,arguments);if("string"===typeof b&&
C[b])return C[b].apply(this,Array.prototype.slice.call(arguments,1));$.error("Method "+String(b)+" does not exist on jQuery."+e)}})();
(function(){$.fn.jSignature("addPlugin","instance","UndoButton",function(q){this.events.subscribe("jSignature.attachingEventHandlers",function(){if(this.settings[q]){var m=this.settings[q];"function"!==typeof m&&(m=function(){var e=$('<input type="button" value="Undo last stroke" style="position:absolute;display:none;margin:0 !important;top:auto" />').appendTo(this.$controlbarLower),k=e.width();e.css("left",Math.round((this.canvas.width-k)/2));k!==e.width()&&e.width(k);return e});var k=m.call(this),
t=this;t.events.subscribe("jSignature.change",function(){t.dataEngine.data.length?k.show():k.hide()});var r=this,e=(this.events.topics.hasOwnProperty("jSignature.undo")?q:"jSignature")+".undo";k.bind("click",function(){r.events.publish(e)});r.events.subscribe(e,function(){var e=r.dataEngine.data;e.length&&(e.pop(),r.resetCanvas(e))})}})})})();
(function(){for(var q={},m={},k="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWX".split(""),t=k.length/2,r=t-1;-1<r;r--)q[k[r]]=k[r+t],m[k[r+t]]=k[r];var e=function(e){for(var e=e.split(""),h=e.length,a=1;a<h;a++)e[a]=q[e[a]];return e.join("")},y=function(k){for(var h=[],a=0,f=1,d=k.length,c,l,i=0;i<d;i++)c=Math.round(k[i]),l=c-a,a=c,0>l&&0<f?(f=-1,h.push("Z")):0<l&&0>f&&(f=1,h.push("Y")),c=Math.abs(l),c>=t?h.push(e(c.toString(t))):h.push(c.toString(t));return h.join("")},v=function(e){for(var h=
[],e=e.split(""),a=e.length,f,d=1,c=[],l=0,i=0;i<a;i++)f=e[i],f in q||"Z"===f||"Y"===f?(0!==c.length&&(c=parseInt(c.join(""),t)*d+l,h.push(c),l=c),"Z"===f?(d=-1,c=[]):"Y"===f?(d=1,c=[]):c=[f]):c.push(m[f]);h.push(parseInt(c.join(""),t)*d+l);return h},z=function(e){for(var h=[],a=e.length,f,d=0;d<a;d++)f=e[d],h.push(y(f.x)),h.push(y(f.y));return h.join("_")},u=function(e){for(var h=[],e=e.split("_"),a=e.length/2,f=0;f<a;f++)h.push({x:v(e[2*f]),y:v(e[2*f+1])});return h},k=function(e){return["image/jsignature;base30",
z(e)]},r=function(e,h,a){"string"===typeof e&&("image/jsignature;base30"===e.substring(0,23).toLowerCase()&&(e=e.substring(24)),a(u(e)))};if(null==this.jQuery)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");var x=this.jQuery.fn.jSignature;x("addPlugin","export","base30",k);x("addPlugin","export","image/jsignature;base30",k);x("addPlugin","import","base30",r);x("addPlugin","import","image/jsignature;base30",r);this.jSignatureDebug&&(this.jSignatureDebug.base30=
{remapTailChars:e,compressstrokeleg:y,uncompressstrokeleg:v,compressstrokes:z,uncompressstrokes:u,charmap:q})}).call("undefined"!==typeof window?window:this);
(function(){function q(a,f){this.x=a;this.y=f;this.reverse=function(){return new this.constructor(-1*this.x,-1*this.y)};this._length=null;this.getLength=function(){this._length||(this._length=Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)));return this._length};var d=function(a){return Math.round(a/Math.abs(a))};this.resizeTo=function(a){if(0===this.x&&0===this.y)this._length=0;else if(0===this.x)this._length=a,this.y=a*d(this.y);else if(0===this.y)this._length=a,this.x=a*d(this.x);else{var f=Math.abs(this.y/
this.x),e=Math.sqrt(Math.pow(a,2)/(1+Math.pow(f,2))),f=f*e;this._length=a;this.x=e*d(this.x);this.y=f*d(this.y)}return this};this.angleTo=function(a){var d=this.getLength()*a.getLength();return 0===d?0:Math.acos(Math.min(Math.max((this.x*a.x+this.y*a.y)/d,-1),1))/Math.PI}}function m(a,f){this.x=a;this.y=f;this.getVectorToCoordinates=function(a,c){return new q(a-this.x,c-this.y)};this.getVectorFromCoordinates=function(a,c){return this.getVectorToCoordinates(a,c).reverse()};this.getVectorToPoint=function(a){return new q(a.x-
this.x,a.y-this.y)};this.getVectorFromPoint=function(a){return this.getVectorToPoint(a).reverse()}}function k(a,f){var d=Math.pow(10,f);return Math.round(a*d)/d}function t(a,f,d){var f=f+1,c=new m(a.x[f-1],a.y[f-1]),e=new m(a.x[f],a.y[f]),e=c.getVectorToPoint(e),i=new m(a.x[f-2],a.y[f-2]),c=i.getVectorToPoint(c);return c.getLength()>d?(d=2<f?(new m(a.x[f-3],a.y[f-3])).getVectorToPoint(i):new q(0,0),a=0.35*c.getLength(),i=c.angleTo(d.reverse()),f=e.angleTo(c.reverse()),d=(new q(d.x+c.x,d.y+c.y)).resizeTo(Math.max(0.05,
i)*a),e=(new q(c.x+e.x,c.y+e.y)).reverse().resizeTo(Math.max(0.05,f)*a),e=new q(c.x+e.x,c.y+e.y),["c",k(d.x,2),k(d.y,2),k(e.x,2),k(e.y,2),k(c.x,2),k(c.y,2)]):["l",k(c.x,2),k(c.y,2)]}function r(a,f){var d=a.x.length-1,c=new m(a.x[d],a.y[d]),e=new m(a.x[d-1],a.y[d-1]),c=e.getVectorToPoint(c);if(1<d&&c.getLength()>f){var d=(new m(a.x[d-2],a.y[d-2])).getVectorToPoint(e),e=c.angleTo(d.reverse()),i=0.35*c.getLength(),d=(new q(d.x+c.x,d.y+c.y)).resizeTo(Math.max(0.05,e)*i);return["c",k(d.x,2),k(d.y,2),k(c.x,
2),k(c.y,2),k(c.x,2),k(c.y,2)]}return["l",k(c.x,2),k(c.y,2)]}function e(a,e,d){for(var e=["M",k(a.x[0]-e,2),k(a.y[0]-d,2)],d=1,c=a.x.length-1;d<c;d++)e.push.apply(e,t(a,d,1));0<c?e.push.apply(e,r(a,d,1)):0===c&&e.push.apply(e,["l",1,1]);return e.join(" ")}function y(a){var f=['<?xml version="1.0" encoding="UTF-8" standalone="no"?>','<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'],d,c=a.length,l,i=[],h=[],k=l=d=0,n=0,p=[];if(0!==c){for(d=0;d<c;d++){k=
a[d];n=[];l={x:[],y:[]};for(var m=void 0,b=void 0,m=0,b=k.x.length;m<b;m++)n.push({x:k.x[m],y:k.y[m]});n=simplify(n,0.7,!0);m=0;for(b=n.length;m<b;m++)l.x.push(n[m].x),l.y.push(n[m].y);p.push(l);i=i.concat(l.x);h=h.concat(l.y)}a=Math.min.apply(null,i)-1;c=Math.max.apply(null,i)+1;i=Math.min.apply(null,h)-1;h=Math.max.apply(null,h)+1;k=0>a?0:a;n=0>i?0:i;d=c-a;l=h-i}f.push('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="'+d.toString()+'" height="'+l.toString()+'">');d=0;for(c=p.length;d<
c;d++)l=p[d],f.push('<path fill="none" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="'+e(l,k,n)+'"/>');f.push("</svg>");return f.join("")}function v(a){return[p,y(a)]}function z(a){return[h,x(y(a))]}var u=window;"use strict";("undefined"!=typeof exports?exports:u).simplify=function(a,e,d){e=void 0!==e?e*e:1;if(!d){for(var c=a.length,l,i=a[0],h=[i],d=1;d<c;d++){l=a[d];var k=l.x-i.x,n=l.y-i.y;k*k+n*n>e&&(h.push(l),i=l)}a=(i!==l&&h.push(l),h)}l=a;var d=l.length,
c=new ("undefined"!=typeof Uint8Array?Uint8Array:Array)(d),i=0,h=d-1,m,p,b=[],j=[],s=[];for(c[i]=c[h]=1;h;){n=0;for(k=i+1;k<h;k++){m=l[k];var g=l[i],r=l[h],q=g.x,t=g.y,g=r.x-q,u=r.y-t,v=void 0;if(0!==g||0!==u)v=((m.x-q)*g+(m.y-t)*u)/(g*g+u*u),1<v?(q=r.x,t=r.y):0<v&&(q+=g*v,t+=u*v);m=(g=m.x-q,u=m.y-t,g*g+u*u);m>n&&(p=k,n=m)}n>e&&(c[p]=1,b.push(i),j.push(p),b.push(p),j.push(h));i=b.pop();h=j.pop()}for(k=0;k<d;k++)c[k]&&s.push(l[k]);return a=s,a};if("function"!==typeof x)var x=function(a){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".split(""),
d,c,h,i,k=0,m=0,n="",n=[];do d=a.charCodeAt(k++),c=a.charCodeAt(k++),h=a.charCodeAt(k++),i=d<<16|c<<8|h,d=i>>18&63,c=i>>12&63,h=i>>6&63,i&=63,n[m++]=e[d]+e[c]+e[h]+e[i];while(k<a.length);n=n.join("");a=a.length%3;return(a?n.slice(0,a-3):n)+"===".slice(a||3)};var p="image/svg+xml",h="image/svg+xml;base64";if("undefined"===typeof $)throw Error("We need jQuery for some of the functionality. jQuery is not detected. Failing to initialize...");u=$.fn.jSignature;u("addPlugin","export","svg",v);u("addPlugin",
"export",p,v);u("addPlugin","export","svgbase64",z);u("addPlugin","export",h,z)})();; 
/**
 * 微信 js API类库
 */
var WeixinApi = {
	
	_initialized : false,
	
	/**
	 * 初始化
	 */
	init : function() {
		this.bindEvent();
		this.config();
		
	},
	/**
	 * 绑定事件
	 */
	bindEvent : function() {
	},
	
	config : function(_url){
		showLoadingToast();
		_url = _url || location.href.split('#')[0];
		$.getJSON(contextPath+"/portal/weixin/jsapi/getJsapiConfig.action",{"_url":_url},function(result){
			if(result.status==1){
				wx.config({
				      debug: false,
				      appId: result.data.appId,
				      timestamp: result.data.timestamp,
				      nonceStr: result.data.nonceStr,
				      signature: result.data.signature,
				      jsApiList: [
				        'checkJsApi',
				        'onMenuShareTimeline',
				        'onMenuShareAppMessage',
				        'onMenuShareQQ',
				        'onMenuShareWeibo',
				        'hideMenuItems',
				        'showMenuItems',
				        'hideAllNonBaseMenuItem',
				        'showAllNonBaseMenuItem',
				        'translateVoice',
				        'startRecord',
				        'stopRecord',
				        'onRecordEnd',
				        'playVoice',
				        'pauseVoice',
				        'stopVoice',
				        'uploadVoice',
				        'downloadVoice',
				        'chooseImage',
				        'previewImage',
				        'uploadImage',
				        'downloadImage',
				        'getNetworkType',
				        'openLocation',
				        'getLocation',
				        'hideOptionMenu',
				        'showOptionMenu',
				        'closeWindow',
				        'scanQRCode',
				        'chooseWXPay',
				        'openProductSpecificView',
				        'addCard',
				        'chooseCard',
				        'openCard'
				      ]
				  });
				wx.ready(function () {
					//alert('weixin jsAPI ready!');
				});
				wx.error(function(res){
				    // config信息验证失败会执行error函数，如签名过期导致验证失败，具体错误信息可以打开config的debug模式查看，也可以在返回的res参数中查看，对于SPA可以在这里更新签名。
					//alert('error');
				});
			}
		});
	}
	
		
};

function weixinApiInit(){
	if(!WeixinApi._initialized){
		if(visit_from_weixin=="true"){
			WeixinApi.init();
			WeixinApi._initialized = true;
		}
	}
}
; 
/**
 * 按钮操作URL
 */
var activityAction = contextPath + "/portal/dynaform/activity/action.action";
var docviewAction = contextPath + '/portal/dynaform/document/view.action';

/**
 * 文件下载按钮对应的Function
 */
function doFileDonwload(actid) {
	if (actid) {
		var url = activityAction;
		var newUrl = url + '?_activityid=' + actid;
		
		if(ev_runbeforeScriptforview(actid)){
			document.forms[0].action = newUrl;
			document.forms[0].target = "_blank";
			document.forms[0].submit();
			document.forms[0].target = "";
		}
	}
}

/**
 * Excel导入按钮事件
 * 
 * @param {}
 *            actid 按钮ID
 * @param {}
 *            impcfgid 导入配置ID
 */
function ev_excelImport(actid, impcfgid) {
	var parentid = "";
	if (document.getElementsByName("parentid")) {
		parentid = document.getElementsByName("parentid")[0].value;
	}
	
	var application = "";
	if (document.getElementsByName("application")) {
		application = document.getElementsByName("application")[0].value;
	}

	var isRelate = "";
	if(document.getElementsByName("isRelate")){
		var relateObj = document.getElementsByName("isRelate");
		if(relateObj.length != 0)
			isRelate = relateObj[0].value;
	}
	var _viewid = document.getElementsByName("_viewid")[0].value;
	if (impcfgid) {
		var url = importURL; // importURL在各页面中定义
		url += "?parentid=" + parentid;
		url += "&id=" + impcfgid;
		url += "&application=" + application;
		url += "&isRelate=" + isRelate;
		url += "&_activityid=" + actid;
		url += "&_viewid=" + _viewid;
		OBPM.dialog.show({
			width : 530,
			height : 420,
			url : url,
			args : {},
			title : 'Excel导入',
			close : function(result) {
				document.forms[0].submit();
			}
		});
	}
}

/**
 * 打开下载窗口
 * 
 * @param {}
 *            fileName 文件名称
 */
function openDownloadWindow(fileName) {
	if (fileName) {
		var url = downloadURL + '?filename=' + encodeURI(fileName);
		top.window.open(url);
	}
}

/**
 * 页面重载
 */
function ev_reload() {
	// window.location.href = window.location.href+'&';
	document.forms[0].submit();
}
//视图选择框也用到此方法，拷贝此到dialogView.js里并更改方法名
function ev_search() {
	$(document).find("form:eq(0)").find("[name='_currpage']").val("1");
	document.forms[0].submit();
}

/**
 * 清空字段内容
 */
function ev_resetAll() {
	var $formTable = ajaxPage.getCurPage().find("#searchFormTable");
	
	var elements = $formTable.wrap("<form></form>").parent()[0].elements;
	
//	document.forms[0].elements;
	for (var i = 0; i < elements.length; i++) {
		if(jQuery(elements[i]).attr('fieldType')=='TextAreaField'){
			elements[i].value = "";
		}
		if(jQuery(elements[i]).attr('fieldType')=='UserField'){
			elements[i].value = "";
			
			if(jQuery(elements[i]).attr('readonlyshowvalonly') == "true"){
				jQuery(elements[i]).text("");
			}
		}
		if(jQuery(elements[i]).attr('fieldType')=='SelectAboutField'){
			var	originalName = elements[i].name;
			var	idDx = originalName + "ms2side__dx";
			var	idSx = originalName + "ms2side__sx";
			jQuery("#" + idDx).children().appendTo(jQuery("#" + idSx));
			jQuery("#" + idDx).children().remove();
			jQuery(elements[i]).find('option').attr("selected", false);
			jQuery(elements[i]).find("[text='']").attr("selected", true);
		}
		if(elements[i].type == 'checkbox'){
			elements[i].checked = false;
		}
		if(elements[i].type == 'radio'){
			elements[i].checked = false;
		}
		if(elements[i].type == 'textarea'){
			elements[i].value = "";
		}
		if(jQuery(elements[i]).attr('fieldType')=='TreeDepartmentField'){
			elements[i].value = "";
			elements[i+1].value = "";
		}
		// alert(elements[i].id + ": "+elements[i].type + " resetable-->" +
		// elements[i].resetable);
		if (elements[i].type == 'text'|| elements[i].resetable) {
			elements[i].value = "";
			
		} else if (elements[i].type == 'select-one') {
			// 还原至第一个选项
			if (elements[i].options.length >= 1) {
				elements[i].options[0].selected = true;
			}
		}
		
		//清空只读值
		var readOnlySpanId = "#"+jQuery(elements[i]).attr('name')+"_show";
		if(jQuery(readOnlySpanId)){
			jQuery(readOnlySpanId).text("");
		}
	}
	$formTable.unwrap();
	$formTable.find("input[type='hidden'][id!='dy_refreshObj']").val("");//清除隐藏文本框控件的值
	/*
	for (var i = 0; i < arrObject.length; i++) {
		arrObject[i].save("");
	}
	*/
}

/**
 * 表单提交(由按钮触发的事件)
 * 
 * @param {}
 *            activityId 操作ID
 * @param {}
 *            isCheckSelect 是否检查有选择项
 */
function ev_submit(activityId, isCheckSelect, operation,isConfirm,confirmMsg) {
	var flag = true;
	if (isCheckSelect) {
		flag = isSelectedOne("_selects");
	}
	if (flag) {
		if(ev_runbeforeScriptforview(activityId)){
			var formAction = contextPath + '/portal/dynaform/activity/handle.action' + '?_activityid=' + activityId;
			if (operation) {
				formAction += "&operation=" + operation;
			}
			if(isConfirm){
				var rtn = window.confirm(confirmMsg);
				if (!rtn){
					if(toggleButton("button_act")) return false;
					return;
				}
			}
			if(toggleButton("button_act")) return false;
			document.forms[0].action = formAction;
			document.forms[0].submit();
		}
	} else {
		if(toggleButton("button_act")) return false;
	}
	//hidden();
}

var ifExpToExl = true;
function ev_expToExl(activityId, filename, expSub){
	var oldActionUrl = document.forms[0].action;
	if(!ifExpToExl){
		alert("已导出，需要再次导出请刷新页面！");
		return;
	}

	if(ev_runbeforeScriptforview(activityId)){
		var url = contextPath + '/portal/dynaform/activity/handle.action' + '?_activityid=' + activityId + "&filename=" + filename + "&isExpSub=" + expSub;
		document.forms[0].action = url;
		document.forms[0].submit();
		ifExpToExl = false;
	}
	
	document.forms[0].action = oldActionUrl;
	
}

//批量提交
function doBatchApprove(activityId,isCheckSelect){
	if(!isSelectedOne("_selects","至少选择一条记录！")){
		return;
	}
	if(jQuery("#inputAuditRemarkDiv" + activityId).attr("id")){
		artDialog.prompt('请输入审批意见：',function(val,win){
			jQuery('#_attitude' + activityId).val(val);
			ev_submit(activityId,true);
		},true);
	}
}

// 键盘事件
function setEnter(event) {
	if (event.keyCode == 13) {
		event.keyCode = 9;
	}
}

function enterKeyDown(e) {
	if (e.keyCode == 13 || e.which == 13) { // 13 代表Enter
		document.getElementsByName('_currpage')[0].value = 1;
		document.forms[0].submit();
	}
}

//loading show
function showLoadingToast() {
    $('#loadingToast').show();
}

//loading hide
function hideLoadingToast() {
	//setTimeout(function(){
		$('#loadingToast').hide();
	//},300);
}

function ev_exportToExcel(activityId, isConfirm, content){
	if(isConfirm){
		var rtn = window.confirm(content);
		if(!rtn){
			return;
		}
	}
	ev_submit(activityId);
}

/** 调整包含元素iframe高度--所有皮肤视图
 * iframeid: iframeid
 * viewType：1:列表视图(LISTVIEW),
 * 			 2:日历视图(CALENDARVIEW), 
 * 			 3:树形视图(TREEVIEW),
 * 			 4:地图视图(MAPVIEW),
 * 			 5:网格视图(GRIDVIEW),
 * 			 6:甘特视图(GANTTVIEW).
 */
function ev_resize4IncludeView(divid,iframeid,type){
	if(divid != "" && type != ""){
		var spanObj = parent.document.getElementById(divid);
		if(spanObj){
			var iframeObj = spanObj.getElementsByTagName("iframe");
			//jQuery("#" + divid + " iframe[id=" + iframeid + "]",parent.document)
			jQuery(iframeObj).each(function(){
				switch(type){
					case "MAPVIEW"://地图视图
						try{
							var activityH = jQuery("#activityTable").height();
							var searchH = 0;
							if(jQuery("#searchFormTable").size() != 0)
								searchH = jQuery("#searchFormTable").height();
							jQuery(this).css("height",(searchH + 670));
						}catch(ex){
							setTimeout(function(){
								jQuery(this).css("height",(searchH + 670));
							},300);
						}
						break;
						
					case "DISPLAYVIEW"://嵌入视图
						var formListH= document.getElementById('formList').offsetHeight;
						if(formListH > 410){
							formListH = 450;
						}else if(formListH < 100){
							formListH = 150;
						}else{
							formListH = formListH + 40;
						}
						//包含元素固定高度时不重新布局
						var fixation = jQuery(this).attr("fixation");
						if(fixation=="true"){
							jQuery(this).css("height",jQuery(this).attr("fixationHeight"));
						}else {
							jQuery(this).css("height",formListH);
						}
						break;
					case "CALENDARVIEW"://日历视图
						var actH = jQuery("#activityTable").height();
						var dataH= jQuery('#cal_viewcontent').height();
						var bodyH = actH + dataH;
						if(bodyH > 100){
							jQuery(this).css("height",(bodyH + 20));
						}
						break;
					case "TREEVIEW"://树形视图
						var bodyW = jQuery("body").width();
						jQuery(this).css("height",700);
						if(ie) jQuery(this).css("width",bodyW-4);
						break;
					case "GANTTVIEW"://甘特视图
						var iframeH = jQuery("#container").height();
						if(iframeH > 100)
							jQuery(this).css("height",(iframeH + 20));
						break;
					case "GRIDVIEW"://网格视图
						var acttableH = jQuery("#acttable").height();
						var dataTableH = jQuery("#gridTable").height();
						var formListH = acttableH + dataTableH;
						if(formListH > 380){
							formListH = 420;
						}else if(formListH < 100){
							formListH = 150;
						}else{
							formListH = formListH + 40;
						}
						jQuery(this).css("height",formListH);
						break;
					case "LISTVIEW"://列表视图
						break;
				}
			});
		}
	}
}

function ev_runbeforeScriptforview(actid){
	var flag = false;
	jQuery.ajax({
		type: 'POST',
		async:false, 
		url: contextPath + '/portal/dynaform/activity/runbeforeactionscript.action?_actid=' + actid,
		dataType : 'text',
		timeout: 3000,
		data: jQuery("#formList").serialize(),
		success:function(result) {
			if(result != null && result != ""){
	        	var jsmessage = eval("(" + result + ")");
	        	var type = jsmessage.type;
	        	var content = jsmessage.content;
	        	
	        	if(type){
	        		if(type == '16'){
		        		alert(content);
		        		flag = false;
		        	}
		        	
		        	if(type == '32'){
		        		var rtn = window.confirm(content);
		        		if(!rtn){
		        			flag = false;
		        		}else {
		        			flag = true;
		        		}
		        	}
	        	}else {
	        		flag = true;
	        	}
	        }else {
	        	flag = true;
	        }
		},
		error: function(result) {
			alert("运行脚本出错");
		}
	});
	
	return flag;
}

/** 当菜单视图显示记录数时，视图数据增删会刷新菜单记录数
 * for: default/dwz/fresh/gentle
 * viewType：1:列表视图(LISTVIEW),
 * 			 2:网格视图(GRIDVIEW).
 */
function refreshMenuTotalRows(){
	var menuId = "menu_" + jQuery("#resourceid").val();
	jQuery("body",parent.document).find("#" + menuId).html("(" + totalRows + ")");
}; 
/**
 * 窗口打开类型 为普通模式打开新的窗口
 */
var OPEN_TYPE_NORMAL = 0x0000001;
/**
 * 窗口打开类型 弹出框显示
 */
var OPEN_TYPE_POP = 0x0000010;
/**
 * 窗口打开类型 在父窗口区域显示
 */
var OPEN_TYPE_PARENT = 0x0000100;
/**
 * 窗口打开类型 当前区域显示
 */
var OPEN_TYPE_OWN = 0x0000110;
/**
 * 窗口打开类型 网格显示
 */
var OPEN_TYPE_GRID = 0x0000120;
/**
 * 窗口打开类型 弹出层显示
 */
var OPEN_TYPE_DIV = 0x0000115;
/**
 * 一般视图
 * 
 * @type Number
 */
var VIEW_TYPE_NORMAL = 0x0000010;
/**
 * 子视图
 * 
 * @type Number
 */
var VIEW_TYPE_SUB = 0x0000011;

var activityAction = contextPath + '/portal/dynaform/activity/action.action';
var importURL = contextPath
		+ '/portal/share/dynaform/dts/excelimport/importbyid.jsp';
var downloadURL = contextPath + '/portal/share/download.jsp'; // Excel下载URL

/**
* 查看文档
*/
function viewDoc(docid, formid ,signatureExist,templateForm,isEdit,instanceId,nodeId) {
	// 查看/script/view.js
	var url = docviewAction;
	url += '?_docid=' + docid;
	if (formid) {
		url += '&_formid=' +  formid;
	}
	if (templateForm) {
		url += '&_templateForm=' +  templateForm;
	}
	if(signatureExist){
		url += '&signatureExist=' +  signatureExist;
	}
	if(isedit){
		url += '&isedit=' +  isedit+"";
	}
	if(instanceId){
		url += '&_targetInstance=' +  instanceId;
	}
	if(nodeId){
		url += '&_targetNode=' +  nodeId;
	}
	
	openWindowByType(url,selectStr, VIEW_TYPE_NORMAL); 
}

/**
 * 文档新建 (DocumentCreate)
 * 
 * @param {}
 *            activityId 按钮ID
 */
function doNew(activityId) {
	createDoc(activityId); // obpm.listView.js
}

function openWindowByType(action, title, viewType, actid) {
	var flag = false;
	
	if(actid){
		jQuery.ajax({
			type: 'POST',
			async:false, 
			url: contextPath + '/portal/dynaform/activity/runbeforeactionscript.action?_actid=' + actid,
			dataType : 'text',
			timeout: 3000,
			data: ajaxPage.getParams(),
			success:function(result) {
				
				if(result != null && result != ""){
		        	var jsmessage = eval("(" + result + ")");
		        	var type = jsmessage.type;
		        	var content = jsmessage.content;
		        	
		        	if(type == '16'){
		        		alert(content);
//		        		document.forms[0].submit();
		        	}
		        	
		        	if(type == '32'){
		        		var rtn = confirm(content);
		        		if(!rtn){
		        			alert("rtn");
//		        			document.forms[0].submit();
		        		}else {
		        			flag = true;
		        		}
		        	}
		        }else {
		        	flag = true;
		        }
			},
			error: function(result) {
				alert("运行脚本出错");
			}
		});
	} else {
		flag = true;
	}

	if(flag){
		// View的openType(打开类型)
		var openType = OPEN_TYPE_NORMAL;
		var url = action;
	
		if (viewType == VIEW_TYPE_SUB) {
			var isRelate = ajaxPage.getParamsByName("isRelate");
			url += "&isSubDoc=true";
			if (isRelate){
	            if (isRelate.length>0){
	            	var relate = isRelate[0].value;
	            	url += "&isRelate="+relate;
	            }
			}
		}

		var _openType = ajaxPage.getParamsByName("_openType")[0];
		if(_openType){
			if(_openType.tagName && _openType.tagName.toUpperCase() == "INPUT"){
				openType = _openType.value;
			}
		}else{	//子表视图用span存储参数
			openType = OPEN_TYPE_DIV;
		}
	
		var parameters = getQueryString();
	
		resetBackURL(); // view.js
		if (openType == OPEN_TYPE_NORMAL || openType == OPEN_TYPE_GRID) {
//			if (isHomePage()) { // 首页单独处理
//				url += "&_backURL="
//						+ encodeURIComponent(contextPath
//								+ "/portal/dispatch/homepage.jsp");
//				url += "&" + parameters;
//				parent.location = appendApplicationidByView(url);
//			} else {
//				document.forms[0].action = url;
//				document.forms[0].submit();
//				url = 'http://localhost:8080/obpm/portal/dynaform/document/view.action?_docid=11e6-0b8e-cb803f86-8a97-a7676f8f5cd9&_formid=11e5-760a-47a00d51-853f-67435bc5549a&signatureExist=false';
				ajaxPage.loadPage(url);
//			}
		} else if (openType == OPEN_TYPE_POP || openType == OPEN_TYPE_DIV
				|| openType == OPEN_TYPE_OWN || openType == OPEN_TYPE_NORMAL || openType == OPEN_TYPE_GRID) {//所有类型都用弹出层方式
			/*var oSelects = ajaxPage.getParamsByName("_selects");
			var _selects="";
			if(oSelects){
				for(var i=0;i<oSelects.length;i++){
					if(oSelects[i].checked){
						_selects+="&_selects="+oSelects[i].value;
					}
				}
			}
			url += "&" + parameters + "&openType=" + openType+_selects;
			url = appendApplicationidByView(url);*/
			ajaxPage.loadPage(url);
			
//			MyPopup.open({
//				url:url,
//				title:"编辑",
//				success:function(){
//					$("[name='_fieldid']").each(function(){
//						$("#document_content").show();
//						$("#"+$(this).text()).trigger("refresh");
//						
//					})
//					dy_refresh(name);
//					
//					/*var _fieldid = $(".control-content.active").find("input[name='_fieldid']").val();
//					$("#"+_fieldid).trigger("refresh");
//					$("#document_content").show();
//					dy_refresh(name);*/
//				}
//			});
			
//			var w = document.body.clientWidth - 25;
//			showfrontframe({
//						title : "",
//						url : url,
//						w : w,
//						h : 30,
//						windowObj : window.parent,
//						callback : function(result) {
//							setTimeout(function(){//通过右上角的关闭图标关闭弹出层后会显示加载进度条，加延迟后没有这个问题
//								document.forms[0].submit();
//							},1);
//						}
//					});
//		} else if (openType == OPEN_TYPE_OWN) {
//			alert("had't own type")
//			var id = ajaxPage.getParamsByName("_viewid")[0].value;
//			if (viewType == VIEW_TYPE_SUB) {
//				var sub_divid = parent.document.getElementById('sub_divid');
//				var doc_obj = parent.document.getElementById(id);
//				if (sub_divid) {
//					sub_divid.value = doc_obj.src;
//				}
//	//			if (doc_obj) {
//					//url += "&" + parameters;
//					//doc_obj.src = url;
//					document.forms[0].action = url;
//					document.forms[0].submit();
//	//			}
//			} else {
//				document.forms[0].action = url;
//				document.forms[0].submit();
//			}
//	
		}
		event.stopPropagation();
	}
	
}

/**
 * 检查URL是否带上application参数，没有就添加
 * <p>提交表单不能使用本方法：<code>document.forms[0].submit()</code></p>;
 * @param url 返回带有application参数的URL
 * @returns
 */
function appendApplicationidByView(url) {
	var appObject = ajaxPage.getParamsByName("application")[0];
	if (appObject && url.indexOf("application") < 0) {
		if (url.indexOf("?") >= 0) {
			url += "&application=" + appObject.value;
		} else {
			url += "?application=" + appObject.value;
		}
	}
	return url;
}

/**
 * 父窗口是否为首页
 * 
 * @return {如果是返回true,否则false}
 */
function isHomePage() {
	if (parent
			&& parent.location.href.toLowerCase().substring(0,parent.location.href.toLowerCase().indexOf("?")).indexOf("homepage.jsp") != -1) {
		return true;
	}
	return false;
}

/**
 * 获取查询表单中的参数
 * 
 * @return {}
 */
function getQueryString(viewType) {
	var $curPage = ajaxPage.getCurPage();
	var parameters = "";
	var isrelate = $curPage.find(".control-content.active").find("[name='display_view']").attr("isrelate");
	if($curPage.find(".control-content.active").length>0){
		var $controlContent = $curPage.find(".control-content.active");
		if($controlContent.size() > 0){
			var viewId = $controlContent.find("span[name='_viewid']").text();
		}else{
			var viewId = $curPage.find("span[name='_viewid']").text();
		}
		parameters += "_viewid="+viewId;
		
		if (isrelate != "false"){
			var parentid = $curPage.find("[name='parentid']").val() || $curPage.find("[name='parentid']").text();
			if (parentid != null && typeof(parentid) != "undefined" && typeof(parentid) != "" ) {
				parameters += "&parentid="+ parentid;
			}
		}
		
	}else if ($curPage.find("[name='_viewid']")) {
		/*
		 * 主子表刷新时，新建按钮获取参数
		 * 另，主表存参数是input,子表存参数是span
		 * 需统一
		 * */
		var _viewId = $curPage.find("[name='_viewid']").val()?$curPage.find("[name='_viewid']").val() : $curPage.find("[name='_viewid']").text();
		parameters += "_viewid=" + _viewId;
		var parentid = $curPage.find("[name='parentid']").val() || $curPage.find("[name='parentid']").text();
		if (parentid != null && typeof(parentid) != "undefined" && typeof(parentid) != "" ) {
			parameters += "&parentid="+ parentid;
		}
	}
	
	
	//子视图不拼接主表数据
	if (!viewType || viewType != "277") {
		if (typeof(dy_getValuesMap) == "function") {
			// dy_getValuesMap为SearchForm中的方法
			parameters += "&" + jQuery.param(dy_getValuesMap(false),true);
		}
	}
	return parameters;
}

/**
 * 文档删除 (DocumentDelete)
 * 
 * @param {}
 *            activityId 按钮ID
 */
function doRemove(activityId) {
	var checkboxs = document.getElementsByName("_selects");
	var isSelect = false;
	for (var i = 0; i < checkboxs.length; i++) {
		if (checkboxs[i].checked == true) {
			isSelect = true;
			break;
		}
	}
	if (isSelect) {
		if (activityId != null && activityId != "") {
			var rtn = window.confirm("确定要删除您选择的记录吗？");
			if (!rtn)
				return;
		}
	} else {
		alert("请选择要删除的数据！");
		return false;
	}

	ev_submit(activityId, false, "doDelete");
}

/**
 * 文档查询 (DocumentQuery)
 * 
 * @param {}
 *            activityId 按钮ID
 */
function doQuery(activityId) {
	ev_submit(activityId);
}

/**
 * 重新设置BackURL
 */
function resetBackURL() {
	var oBackURL = ajaxPage.getParamsByName("_backURL")[0];
	if (oBackURL && oBackURL.value) {
		// 序列化查询表单字段
		var params = ajaxPage.getParams();
		//jQuery("form").serialize(); 
		//var backURL = oBackURL.value.substring(0, oBackURL.value.indexOf("?"));
		if (oBackURL.value.indexOf("?") != -1) {
			oBackURL.value = oBackURL.value;
			if (params) { // 没有查询表单
				var paramArrary = params.split("&");
				for(var i=0;i<paramArrary.length;i++){
					if(oBackURL.value.indexOf(paramArrary[i])!=-1 || paramArrary[i].indexOf("_backURL") != -1){//防止在backURL后面再拼多一次backURL,导致第二个backURL后面的参数不生效
					}else{
						oBackURL.value += "&" + paramArrary[i];
					}
				}
				
			}
		} else {
			oBackURL.value = oBackURL.value;
			if (params) {
				oBackURL.value += "?" + params;
			}
		}
	}
}

/**
 * 批量签章按钮对应的Function
 */
function DoBatchSignature() {
	if(navigator.userAgent.indexOf("MSIE")<0){
		alert("金格iSignature电子签章HTML版只支持IE，如果要签章请用IE浏览器");
		return;
	}
	var mLength = document.getElementsByName("_selects").length;
	var vItem;
	var DocumentList = "";
	for (var i = 0; i < mLength; i++) {
		vItem = document.getElementsByName("_selects")[i];
		if (vItem.checked) {
			if (i != mLength - 1) {
				DocumentList = DocumentList + vItem.value + ";";
			} else {
				DocumentList = DocumentList + vItem.value;
			}
		}
	}
	// alert(DocumentList);
	var ajax = null;

	if (window.ActiveXObject) {

		try {

			ajax = new ActiveXObject("Microsoft.XMLHTTP");

		} catch (e) {

			alert("创建Microsoft.XMLHTTP对象失败,AJAX不能正常运行.请检查您的浏览器设置.");
		}

	} else {

		if (window.XMLHttpRequest) {

			try {

				ajax = new XMLHttpRequest();

			} catch (e) {

				alert("创建XMLHttpRequest对象失败,AJAX不能正常运行.请检查您的浏览器设置.");
			}

		}
	}

	var url = document.getElementById("mGetBatchDocumentUrl").value;
	var mLoginname = document.getElementById("mLoginname").value;
	var DocumentID = document.getElementById("DocumentID").value;
	var ApplicationID = document.getElementById("ApplicationID").value
	var FormID = document.getElementById("FormID").value
	url = url + "?DocumentID=" + DocumentID + "&ApplicationID2="
			+ ApplicationID + "&FormID2=" + FormID;

	ajax.onreadystatechange = function() {

		if (ajax.readyState == 4 && ajax.status == 200) {

			if (ajax.responseText == "false") {

				return;
			}

			var documentName = ajax.responseText.split(',');
			// var buffer = [];
			var fildsList = "";
			for (var i = 0; i < documentName.length; i++) {

				if (i != documentName.length - 1) {
					// buffer.push(documentName[i]+"="+documentName[i]);
					fildsList = fildsList
							+ (documentName[i] + "=" + documentName[i] + ";");
				} else {
					// buffer.push(documentName[i]+"="+documentName[i]);
					fildsList = fildsList
							+ (documentName[i] + "=" + documentName[i]);
				}

			}
			// alert(fildsList);
			// buffer.join("");
			// alert(buffer);
			// alert(formList.SignatureControl);
			if (formList.SignatureControl != null) {
				if (DocumentList == "") {
					alert("请选择需要签章的文档。");
				}
				formList.SignatureControl.FieldsList = fildsList; // 所保护字段
				formList.SignatureControl.Position(460, 275); // 签章位置
				formList.SignatureControl.DocumentList = DocumentList; // 签章页面ID
				formList.SignatureControl.WebSetFontOther("True", "同意通过", "0",
						"宋体", "11", "000128", "True"); // 默认签章附加信息及字体,具体参数信息参阅技术白皮书
				formList.SignatureControl.SaveHistory = "false"; // 是否自动保存历史记录,true保存
				// false不保存
				// 默认值false
				formList.SignatureControl.UserName = "lyj"; // 文件版签章用户
				formList.SignatureControl.WebCancelOrder = 0; // 签章撤消原则设置,
				// 0无顺序 1先进后出
				// 2先进先出 默认值0
				// formList.SignatureControl.DivId = "contentTable"; //签章所在层
				formList.SignatureControl.AutoCloseBatchWindow = true;
				formList.SignatureControl.RunBatchSignature();
			} else {
				alert("请安装金格iSignature电子签章HTML版软件");
				document.getElementById("hreftest2").click();
			}

		}

	};

	ajax.open("POST", url);

	ajax.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
	ajax.send(null);

}

/**
 * 刷新父窗口
 */
function ev_reloadParent() {
	try {
		// operation属性在detail.jsp页面中获取
		if (operation != 'doSave' && operation != 'doDelete') {
			return;
		}

		if (parent) {
			if (parent.treeview) { // 刷新父窗口树型对象
				parent.selectedNode = OBPM("#treedocid").val();
//				parent.treeview.jstree("refresh", "#"
//								+ OBPM("#treedocid").val());
				parent.treeview.jstree("refresh", "#root");//替代了上面的方法，刷新整棵树，临时处理，会影响性能
			}
		}
	} catch (ex) {
	}
}

/** *********front js********* */
function showAction(viewMode, addType) {
	document.getElementsByName("viewMode")[0].value = viewMode;

	// var url = '<%=request.getAttribute("backURL")%>';
	//var url = document.getElementById("backURL").value;
	var url = formList.action;
	var index = url.indexOf('?');
	if(index > -1){
		url = url.substring(0, index);
	}
	if (addType) {
		url += '?addType=' + addType;
		//url += '&application=' + document.getElementsByName("_application")[0].value;
	}else{
		//url += '?application=' + document.getElementsByName("_application")[0].value;
	}
	formList.action = url;
	formList.submit();
}

function showActions(viewMode) {
	showAction(viewMode, null);
}

function ShowDayView(currDate) {
	document.forms[0].action = 'displayView.action?_viewid='
			+ document.getElementById("displayView__viewid").value + '&currentDate='
			+ currDate + '&isinner=true';
	document.formList.submit();
}

// valueMap是一个对象。
function ev_selectone(valueMap) {
	var value = jQuery.json2Str(valueMap);
	if (isEdit != false && isEdit != 'false') {
		OBPM.dialog.doReturn("{id:" + value + "}");
	}
}

// 隐藏iframe
function hidden() {
	var id = document.getElementById("_viewid").value;
	var doc_obj = parent.document.getElementById(id);
	// alert(doc_obj);
	if (doc_obj) {
		doc_obj.style.display = 'none';
	}
}

// 调整窗口
function adjustDataIteratorSize() {
	var container = document.getElementById("container");
	var searchForm = document.getElementById("searchFormTable");
	var pageTable = document.getElementById("pageTable");
	var activityTable = document.getElementById("activityTable");
	var dataTable = document.getElementById("dataTable");
	var containerHeight = document.body.clientHeight;
	if (containerHeight > 0) {
		container.style.height = containerHeight + 'px';
		var dataTableHeight = containerHeight;
	}
	
	if (dataTableHeight > 0) {
		if (activityTable) {
			dataTableHeight = dataTableHeight - activityTable.offsetHeight;
		}
		if (searchForm) {
			dataTableHeight = dataTableHeight - searchForm.offsetHeight;
		}
		if (pageTable) {
			dataTableHeight = dataTableHeight - pageTable.offsetHeight;
		}
		dataTable.style.width = "100%";
		if(dataTableHeight > 7)
			dataTable.style.height = dataTableHeight - 7 + 'px';
	}
	
	container.style.visibility = "visible";
}

/**
 * 生成帮助 BuildHelp
 * 
 * @param {}
 *            activityId 按钮ID
 */
function doBuild(activityId) {
	ev_submit(activityId, false, "");
}

/*
 * 视图打印
 */

function ev_printview(actid) {
	var viewid = document.getElementsByName("_viewid")[0].value;
	var signatureExist = document.getElementById("signatureExist").value;
	var url = activityAction;
	url += '?_signatureExist=' + signatureExist;
	url += '&_activityid=' + actid;  
	url += '&isprint=true';
	
	if(ev_runbeforeScriptforview(actid)){
		var fmmy = document.forms[0]; 
		fmmy.action=url;
		fmwin = window.open("about:blank", "_my_submit_win");   
		fmmy.target="_my_submit_win"; 
		fmmy.submit();
		fmmy.target="";
	}
	
//	var viewid = document.getElementsByName("_viewid")[0].value;
//	var signatureExist = document.getElementById("signatureExist").value;
//	
//	var url = activityAction;
//	url += '?_signatureExist=' + signatureExist;
//	url += '&_activityid=' + actid;  
//	url += '&isprint=true';
//	 var fmmy = document.forms[0]; 
//	 fmmy.action=url;
//	 fmwin = window.open("about:blank", "_my_submit_win");   
//	 fmmy.target="_my_submit_win"; 
//	 fmmy.submit();
	 
}
/*
 * 显示右边任务内容
 */
function showTaskContent(index){
}

//JumpTo操作按钮 点击事件
function ev_JumpTo(activityId, jumpType, targetList, jumpMode) {
	ev_dispatcherPage(activityId);
}

/**
 * Dispatcher按钮
 * @param actid
 * @return
 */
function ev_dispatcherPage(actid){
	if(ev_runbeforeScriptforview(actid)){
		var url = activityAction + '?_activityid=' + actid;
    	document.forms[0].action = url;
    	//document.forms[0].target = '_blank';
    	document.forms[0].submit();
    	//document.forms[0].target = '';
	}
}

/**
 * 把查询表单中只读的控件设置成非只读
 * 仅在视图查询表单执行时使用
 */
function makeAllFieldAble(){
	var $search = ajaxPage.getCurPage().find("#_searchPanel");
	var _form = $search.wrap("<form></form>").parent()[0];

	var elements = _form.elements;
	for (var i = 0; i < elements.length; i++) {
		var element = elements[i];
		if (element.disabled == true) {
			element.disabled = false;
		}
	}
	$search.unwrap();
}

function modifyActionBack(){
	showLoadingToast();
	makeAllFieldAble();	//把表单中只读的控件设置成非只读
	ajaxPage.clearHashPostfix("_searchForm");
	document.getElementsByName('_currpage')[0].value=1;
	var viewid = jQuery("input[name='_viewid']").val();
	var url = contextPath + "/portal/dynaform/view/displayView.action?isQueryButton=true&_viewid=" + viewid;
	jQuery("input[name='_viewid']").remove();
	ajaxPage.submitPage(url);
}

function ev_subFormView(){
	document.getElementsByName('_currpage')[0].value=1;
	document.forms[0].action=contextPath + "/portal/dynaform/view/subFormView.action?isQueryButton=true";
	document.forms[0].target="";
	document.forms[0].submit();
}

function runscript(docid, colid,obj){
	var data = {};
	var url = contextPath + '/portal/dynaform/view/runScript.action' + '?docid=' + docid + '&columnId=' + colid;
	if(obj){
		var view = jQuery(obj).parents("div[type=includedView]");
		var data = DisplayView.span2Json(obj);
	}else{
		data = jQuery(document.forms[0]).serialize();
	}
	
	jQuery.post(url,data,function(result){
		if(result && result.length>0){
			alert(result);
		}
		if(obj){
			var action = DisplayView.getAction(obj);
			DisplayView.postForm(obj,action,json);
		}else{
			document.forms[0].submit();
		}
		
	});
}

//操作列跳转按钮的方法
function jumptoform(formId, jumpMapping, title){
	var showW = top.document.documentElement.clientWidth;
	showW = showW - showW/10;
	var showH = top.document.documentElement.clientHeight;
	showH = showH - showH/10;
	var obj = eval(jumpMapping);
	var str = "";
	if(obj){
		str += "&";
		for(var i=0; i<obj.length; i++){
			var agr = obj[i].name;
			var colValue = obj[i].value;
			str += encodeURIComponent(agr) + "=" + encodeURIComponent(colValue) + "&";
		}
		str = str.substring(0, str.length-1);
	}

	var applicationid = document.getElementById("ApplicationID").value;
	var view_id = document.getElementsByName("_viewid")[0].value;
	var newAction = contextPath + '/portal/dynaform/document/newWithJump.action';
	var url = newAction + "?applicationid=" + applicationid + "&application=" + applicationid 
				+ "&_formid=" + formId + "&view_id=" + view_id + "&_isJump=1" + str
				+ "&_backURL=isJumpToForm";
	
	showfrontframe({
		title : title,
		url : url,
		w : showW,
		h : showH,
		windowObj : window.parent,
		callback : function(result) {
		}
	});
}

/**
 * 视图操作列提交方法
 * @param colId : 文档id
 */
function on_doflow(colId , approveLimit){
	event.stopPropagation();
	var $remark = $("#doFlowRemarkDiv").find("#temp_remark");
	$.confirm({
		tip : $remark,
		trueCall : function(){

			var $cur = ajaxPage.getCurPage();
			
			$cur.find('#_remark').val($remark.val());
			if($remark.val()!=''){

				$cur.find("[name=_selects][value=" + colId + "]").attr("checked", true);
				$cur.append("<input type='hidden' name='_approveLimit' value='" + approveLimit + "'/>");
				ajaxPage.submitPage("../dynaform/view/doflow.action");
			}else{
				alert(someInformation);
				return false;
			}
		},
		falseCall : function(){
			$("#doFlowRemarkDiv").append($remark);
		}
	});
}

/**
 * 视图操作列删除方法
 * @param colId : 文档id
 */
function on_delete(colId){

	event.stopPropagation();
	$.confirm({
		trueCall : function(){
			var $cur = ajaxPage.getCurPage();
			$cur.find("[name=_selects][value=" + colId + "]").attr("checked", true);
			ajaxPage.submitPage("../dynaform/view/delete.action");
		},
	});
}; 
/**
 * 	后台预览的时候判断页面是否重构完成
 */
var isComplete = false; 

/**
 * 	判断视图是否设置了列宽
 */
var isSetWidth = false;

//视图委托事件
function listViewBindEvent(){
	$("#_searchForm").bind("click", function(){	//点击查询按钮展开查询表单
		$("#_searchPanel").addClass("active");
		ajaxPage.addHashPostfix("_searchForm");
	});
	
	$("#_searchPanel #btn-modal-close").bind("click", function(){	//查询表单界面关闭按钮
		$("#_searchPanel").removeClass("active");
		ajaxPage.clearHashPostfix("_searchForm");
	});
}


function filterList(header, list) {
	$("input.search")
	.change(function(){
    	var filter = $(this).val();
    	if(filter) {
			$matches = $(list).find('a:Contains(' + filter + ')').parent();
			$('li', list).not($matches).slideUp();
			$matches.slideDown();
	    } else {
			$(list).find("li").slideDown();
		}
    	return false;
  	})
	.keyup( function () {
		$(this).change();
	});
}

/**
 * 列表视图公用初始化方法
 * @return
 */
function initListComm(){
	jqRefactor();			//表单控件jquery重构
	jqRefactor4ListView();	//视图jquery重构
	tableListColumn();		//table列显示隐藏操作
	listViewBindEvent();	//事件委托

	$(window).on("orientationchange",function(){
		$(".dataTableDiv").width($(window).width());
	}).on("resize",function(){
		$(".dataTableDiv").width($(window).width());
	})
}

/**
 * 重构列表视图
 */
(function($){
	$.fn.obpmListView = function(){
		return this.each(function(){
			
			var config = {
					viewId : "",			//视图id
					isSetWidth : false,		//判断视图是否设置了列宽
					hideCol : {},			//隐藏列配置信息
					sortCol : "",			//排序字段
					sortStatus : "",		//排序状态
					isSum : "",				//是否汇总
					sumTrIsHidden : true	//汇总行是否隐藏
			},
			Column = {
					COLUMN_TYPE_SCRIPT : 'COLUMN_TYPE_SCRIPT',	//脚本编辑模式
					COLUMN_TYPE_FIELD : 'COLUMN_TYPE_FIELD',	//视图编辑模式
					COLUMN_TYPE_OPERATE : 'COLUMN_TYPE_OPERATE',//操作列
					COLUMN_TYPE_LOGO : 'COLUMN_TYPE_LOGO',		//图标列
					COLUMN_TYPE_ROWNUM : 'COLUMN_TYPE_ROWNUM',	//序号列
					DISPLAY_ALL : '00',//列显示全部文本
					DISPLAY_PART : '01'//列显示部分文本
			},
			Setting = {
					TABLE_CLASS : 'listDataTable',		//表格class
					TH_CLASS : 'listDataTh',						//标题行class
					TH_FIRST_TD_CLASS : 'listDataThFirstTd',			//标题行第一个单元格class
					TH_TD_CLASS : 'listDataThTd',		//标题行其他单元格class
					TR_FIRST_TD_CLASS : 'listDataTrFirstTd',		//数据行第一个单元格class
					TR_TD_CLASS : 'listDataTrTd',		//数据行其他单元格class
					TR_CLASS : 'listDataTr',				//数据行class
					TR_OVER_CLASS : 'listDataTr_over'	//数据行滑过class
			},
			View = {
					DISPLAY_TYPE_TEMPLATEFORM : "templateForm"
			},
			ColumnOperaType = {
					BUTTON_TYPE_DELETE : "00",
					BUTTON_TYPE_DOFLOW : "01",
					BUTTON_TYPE_TEMPFORM : "03",
					BUTTON_TYPE_SCRIPT : "04",
					BUTTON_TYPE_JUMP : "05"//操作列增加跳转类型按钮
			},

			//查看表单
			openDoc = function($me){
				var docid = $me.attr("docId");
				var formid = $me.attr("docFormid");
				var signatureExist = $me.attr("isSignatureExist");
				var viewDisplayType = $me.find(".listDataTrTd").attr("viewDisplayType");
				var viewTemplateForm = $me.find(".listDataTrTd").attr("viewTemplateForm");
				var isEdit = $me.attr("isEdit");
				var instanceId = $me.attr("instanceId");
				var nodeId = $me.attr("nodeId");
				
				var url = docviewAction;
				url += '?_docid=' + docid;
				if (formid) {
					url += '&_formid=' +  formid;
				}
				if (viewDisplayType === "templateForm" && viewTemplateForm) {
					url += '&_templateForm=' +  viewTemplateForm;
				}
				if(signatureExist){
					url += '&signatureExist=' +  signatureExist;
				}
				if(isedit){
					url += '&isedit=' +  isedit+"";
				}
				if(instanceId){
					url += '&_targetInstance=' +  instanceId;
				}
				if(nodeId){
					url += '&_targetNode=' +  nodeId;
				}
				ajaxPage.useFormAction(url);
			},

			//操作列跳转按钮的方法
			jump2form = function(formId, jumpMapping, title){
				var showW = top.document.documentElement.clientWidth;
				showW = showW - showW/10;
				var showH = top.document.documentElement.clientHeight;
				showH = showH - showH/10;
				var obj = eval(jumpMapping);
				var str = "";
				if(obj){
					str += "&";
					for(var i=0; i<obj.length; i++){
						var agr = obj[i].name;
						var colValue = obj[i].value;
						str += encodeURIComponent(agr) + "=" + encodeURIComponent(colValue) + "&";
					}
					str = str.substring(0, str.length-1);
				}

				var applicationid = document.getElementById("ApplicationID").value;
				var view_id = document.getElementsByName("_viewid")[0].value;
				var newAction = contextPath + '/portal/dynaform/document/newWithJump.action';
				var url = newAction + "?applicationid=" + applicationid + "&application=" + applicationid 
							+ "&_formid=" + formId + "&view_id=" + view_id + "&_isJump=1" + str
							+ "&_backURL=isJumpToForm";
				
				ajaxPage.routerLoadPage(url);
			},
			/**
			 * 脚本类型操作列
			 */
			runScript = function(docid, colid, obj){
				var data = {};
				var url = contextPath + '/portal/dynaform/view/runScript.action' + '?docid=' + docid + '&columnId=' + colid;
				if(obj){
					var view = jQuery(obj).parents("div[type=includedView]");
					var data = DisplayView.span2Json(obj);
				}else{
					data = jQuery(document.forms[0]).serialize();
				}
				
				jQuery.post(url,data,function(result){
					if(result && result.length>0){
						alert(result);
					}
					if(obj){
						var action = DisplayView.getAction(obj);
						DisplayView.postForm(obj,action,json);
					}else{
						document.forms[0].submit();
					}
					
				});
			},

			//查看模板表单
			openTemplateDoc = function(docid, formid, signatureExist, templateForm){

				var url = docviewAction;
				url += '?_docid=' + docid;
				if (formid) {
					url += '&_formid=' +  formid;
				}
				if(signatureExist){
					url += '&signatureExist=' +  signatureExist;
				}
				if (templateForm) {
					url += '&_templateForm=' +  templateForm;
				}
				ajaxPage.routerLoadPage(url);
			},

			/**
			 * 视图操作列提交方法
			 * @param colId : 文档id
			 */
			doFlow = function(colId , approveLimit){
				var $remark = $("#doFlowRemarkDiv").find("#temp_remark");
				$.confirm({
					tip : $remark,
					trueCall : function(){

						var $cur = ajaxPage.getCurPage();
						
						$cur.find('#_remark').val($remark.val());
						if($remark.val()!=''){

							$cur.find("[name=_selects][value=" + colId + "]").attr("checked", true);
							$cur.append("<input type='hidden' name='_approveLimit' value='" + approveLimit + "'/>");
							ajaxPage.submitPage("../dynaform/view/doflow.action");
						}else{
							alert(someInformation);
							return false;
						}
					},
					falseCall : function(){
						$("#doFlowRemarkDiv").append($remark);
					}
				});
			}
			/**
			 * 视图操作列删除方法
			 * @param colId : 文档id
			 */
			doDelete = function(colId){

				$.confirm({
					trueCall : function(){
						var $cur = ajaxPage.getCurPage();
						$cur.find("[name=_selects][value=" + colId + "]").attr("checked", true);
						ajaxPage.submitPage("../dynaform/view/delete.action");
					},
				});
			}
			//事件绑定
			bindEvent = function(){
				$("#listView").on("click", ".table-column-toggle tr[editType=edit]", function(){//点击行时打开查看表单
					openDoc($(this));
					
				}).on("click", ".table-column-toggle input[name=_selects]", function(e){	//点击复选框时阻止事件冒泡
					e.stopPropagation();
					
				}).on("click", ".table-column-toggle input[type=button][colBtnType=" 
						+ ColumnOperaType.BUTTON_TYPE_DELETE + "]", function(e){	//操作列为删除类型时
					e.stopPropagation();
					doDelete($(this).attr("docId"));
					
				}).on("click", ".table-column-toggle input[type=button][colBtnType=" 
						+ ColumnOperaType.BUTTON_TYPE_DOFLOW + "]", function(e){	//操作列为提交流程类型时
					e.stopPropagation();
					doFlow($(this).attr("docId"), $(this).attr("colApproveLimit"));
					
				}).on("click", ".table-column-toggle input[type=button][colBtnType=" 
						+ ColumnOperaType.BUTTON_TYPE_TEMPFORM + "]", function(e){	//操作列为打开模板类型时
					e.stopPropagation();
					openTemplateDoc($(this).attr("docId"), $(this).attr("docFormid"), $(this).attr("isSignatureExist"), $(this).attr("colTemplateForm"));
					
				}).on("click", ".table-column-toggle input[type=button][colBtnType=" 
						+ ColumnOperaType.BUTTON_TYPE_SCRIPT + "]", function(e){	//操作列为脚本类型时
					e.stopPropagation();
					runScript($(this).attr("docId"), $(this).attr("colId"));

				}).on("click", ".table-column-toggle input[type=button][colBtnType=" 
						+ ColumnOperaType.BUTTON_TYPE_JUMP + "]", function(e){	//操作列为跳转流程类型时
					e.stopPropagation();
					jump2form($(this).attr("colMappingform"), $(this).attr("jumpMapping"), $(this).attr("colButtonName"));

				}).on("click", ".table-column-toggle img[fieldType='word']", function(e){	//列为word字段时
					e.stopPropagation();
					showWordDialogWithView($(this).attr("showword"),'WordControl', $(this).attr("docId"), 
							$(this).attr("result"), $(this).attr("colFieldName"),3,2,false,true);

				}).on("click", ".table-column-toggle img[fieldType='map']", function(e){	//列为地图字段时
					e.stopPropagation();
					FormBaiduMap(($(this).attr("docId")+"_"+$(this).attr("colFieldName")), $(this).attr("appid"),"1");
					
				}).on("click", ".listDataThTd[isorderby='true']", function(e){	//排序
					e.stopPropagation();
					var colFieldName = $(this).attr("colFieldName");
					var $sortCol = $("#_sortCol");
					var $sortStatus = $("#_sortStatus");
					var sortCol = $sortCol.val();
					var sortStatus = $sortStatus.val();
					if (sortCol != colFieldName && sortCol.toUpperCase() != colFieldName.toUpperCase()) {
						$sortStatus.val("ASC");
					} else {
						if (sortStatus == "ASC") {
							$sortStatus.val("DESC");
						}else{
							$sortStatus.val("ASC");
						}
					}
					$sortCol.val(colFieldName);
					ajaxPage.reloadPage();
				});
			},
			//判断是否输出汇总行
			sumTrIsShow = function($field){
				$field.find("#sumTrId").find("td").each(function(){
					if(jQuery(this).attr("isSum") == "true" || jQuery(this).attr("isTotal") == "true"){
						config.sumTrIsHidden = false;
						return;
					}
				});
			},
			toDataTdHtml = function($td,row){
				var tdObj = parseAttrs($td,row);
			},
			//根据列文本显示方式的配置，截取文本
			truncationText = function(input,displayType,displayLength,isShowIcon){
				if(displayType == Column.DISPLAY_PART && !isShowIcon){
					displayLength = displayLength.match("\\d+");
					if(displayLength){	//显示部分列名
						if(input != "" && input.indexOf("<img") != -1){	//包含流程回退标识时
							var $resultDiv = $("<div></div>");
							$resultDiv.html(input);
							var $textFont = $resultDiv.find("font");
							var text = $textFont.text();
							if(text.length > displayLength){
								text = text.substring(0,displayLength) + "...";
							}
							$textFont.text(text);
							input = $resultDiv.html();
						}else{
							if(input.length > displayLength){
								input = input.substring(0,displayLength) + "...";
							}
						}
					}
				}
				return input;
			},
			//格式化html标签
			convert2HTMLEncode = function(tdObj, str){
				var s = str;
				if(Column.COLUMN_TYPE_FIELD == tdObj.colType && !tdObj.colFieldName.substr(0,1) == "$" && !tdObj.colFlowReturnCss){
					s = s.replace(new RegExp(">","gm"),"&gt;");
					s = s.replace(new RegExp("<","gm"),"&lt;");
				}
				return s;
			},
			//处理多状态字段值
			processMulState = function(tdObj){
				var docId = tdObj.docId;
				var docFormid = tdObj.docFormid;
				var templateForm = tdObj.viewTemplateForm;
				var result = tdObj.result;
				var _result = "";
				var data = {
						instances : []	
				};
				if("$StateLabel" == tdObj.colFieldName && (result.indexOf("[")==0 || result.indexOf("<img")==0)){//视图列绑定流程状态字段类型
					var instances;
					var imgHtml = "",
						fontStart = "",
						fontEnd = "";
					if(result.indexOf("[")==0){
						instances = JSON.parse(result);
					}else if(result.indexOf("<img")==0){
						var jsonStartIndex = result.indexOf("[{"),
							jsonEndIndex = result.lastIndexOf("}]");
						fontStart = result.substring(result.indexOf("<font"),jsonStartIndex);
						fontEnd = result.substring(jsonEndIndex + 2,result.length);
						imgHtml = result.substring(0,result.indexOf("<font"));
						instances = result.substring(jsonStartIndex,jsonEndIndex + 2);
						instances = eval("(" + instances + ")");
					}
					for(var i=0;i<instances.length;i++){

						var instance = instances[i];
						var nodes = instance.nodes;
						instance._nodes = [];
						for(var j=0;j<nodes.length;j++){
							var node = nodes[j];
							var nodeId = node.nodeId;
							var stateLable = truncationText(node.stateLabel,tdObj.displayType,tdObj.colDisplayLength,tdObj.showIcon);
							if(!tdObj.isReadonly){
								if(result.indexOf("<img")==0){
									stateLable = fontStart + stateLable + fontEnd;
								}
								stateLable = "<a href=\"javaScript:viewDoc('"
									+ docId + "', '"
									+ docFormid + "', '"
									+ tdObj.isSignatureExist + "', '"
									+ templateForm + "', '"
									+ tdObj.isEdit + "', '"
									+ instanceId + "', '"
									+ nodeId + "')\">" + stateLable + "</a>&nbsp;&nbsp;";
							}
							
							node.stateLable = stateLable;
							//instance._nodes.push(node);
						}
						data.instances.push(instance);
					}
					_result = template("listViewFlowCol-tmpl", data);
				}else if("$PrevAuditNode" == tdObj.colFieldName && result.indexOf("[")==0){//视图列绑定上一环节流程处理节点名称字段
					var instances = JSON.parse(result);
					for(var i=0;i<instances.length;i++){
						var instance = instances[i];
						var instanceId = instance.instanceId;
						var prevAuditNode = instance.prevAuditNode;
						var prevNode = truncationText(prevAuditNode,tdObj.displayType,tdObj.colDisplayLength,tdObj.showIcon);
						if(!tdObj.isReadonly){
							prevNode = "<a href=\"javaScript:viewDoc('"
								+ docId + "', '"
								+ docFormid + "', '"
								+ tdObj.isSignatureExist + "', '"
								+ templateForm + "', '"
								+ tdObj.isEdit + "', '"
								+ instanceId + "')\">" + prevNode + "</a>&nbsp;&nbsp;";
						}
						instance.prevNode = prevNode;
						data.instances.push(instance);
					}
					_result = template("listViewPrevAuditNode-tmpl", data);
				}else if("$PrevAuditUser" == tdObj.colFieldName && result.indexOf("[")==0){//视图列绑定上一环节流程处理节点名称字段
					var instances = JSON.parse(result);
					for(var i=0;i<instances.length;i++){
						var instance = instances[i];
						var instanceId = instance.instanceId;
						var prevAuditUser = instance.prevAuditUser;
						var prevUser = truncationText(prevAuditUser,tdObj.displayType,tdObj.colDisplayLength,tdObj.showIcon);
						if(!tdObj.isReadonly){
							prevUser = "<a href=\"javaScript:viewDoc('"
								+ docId + "', '"
								+ docFormid + "', '"
								+ tdObj.isSignatureExist + "', '"
								+ templateForm + "', '"
								+ tdObj.isEdit + "', '"
								+ instanceId + "')\">" + prevUser + "</a>&nbsp;&nbsp;";
						}
						instance.prevUser = prevUser;
						data.instances.push(instance);
					}
					_result = template("listViewPrevAuditUser-tmpl", data);
				}else {
					_result = truncationText(result,tdObj.displayType,tdObj.colDisplayLength,tdObj.showIcon);
				}
				return _result;
			},
			//处理操作、LOGO、地图、word列
			processResultByField = function(tdObj){

				var aHtml = "";
				var result = tdObj.result;
				result = convert2HTMLEncode(tdObj,result);
				if(tdObj.fieldtype=="weixingpsfield" && jQuery.trim(result).indexOf("{")==0){//微信gps定位控件
					var location = jQuery.parseJSON(result);
					aHtml+='<div class="gps_col">';
					if(tdObj.showType=="00"){//真实值
						aHtml+='<a href="#" class="gps_col_link" data-location=\''+result+'\'>';
						aHtml+='<span class="gps_col_text">'+location.address+'</span>';
						aHtml+='</a>';
					}else{//显示值
						aHtml+='<span class="gps_col_text">'+location.address+'</span>';
					}
					aHtml+='</div>';
				}else if(tdObj.fieldtype=="weixinrecordfield" && jQuery.trim(result).indexOf("{")==0){	//录音控件
					aHtml += '<div class="weixin_record">'
								+ '<img src="../share/images/view/voice.png" width="21px"/>'
							+ '</div>';
				}else if(tdObj.fieldtype=="imageupload"){
					if(result && result != " "){
						var _images = JSON.parse(result);
						for(var i = 0; i < _images.length; i++){
							var _url = contextPath + _images[i].path;
							var _picHtml = "<div class='images-preview' data-src='"+_url+"' style='display: inline-block;margin:3px;'>" +
									"<img style='max-height:50px;max-width:50px;' src='"+_url+"' />" +
									"</div>";
							aHtml += _picHtml;
						}
					}
				}else if(tdObj.fieldtype=="attachmentupload"){
					if(result && result != " "){
						var _images = JSON.parse(result);
						for(var i = 0; i < _images.length; i++){
							var _url = contextPath + _images[i].path;
							var _name = _images[i].name;
							var _picHtml = "<a href='" + _url + "' target='_about'>" + _name + "</a>";
							aHtml += _picHtml;
						}
					}
				}else if(tdObj.fieldtype=="onlinetakephoto"){
					if(result && result != " "){
						var _url = "";
						if(result.indexOf("<div") != -1){
							_url = $(result).attr("url").replace(/\\'/g,"");
						}else{
							_url = result;
						}
						
						var _picHtml = "<div class='images-preview' data-src='"+_url+"' style='display: inline-block;margin:3px;'>" +
								"<img style='max-height:50px;max-width:50px;' src='"+_url+"' />" +
								"</div>";
						aHtml += _picHtml;
					}
				}else if((tdObj.fieldInstanceOfWordField || tdObj.fieldInstanceOfgenericWordField) && jQuery.trim(result).indexOf("{")==0){
					aHtml = "<img src='resource/images/view/genericword.jpg' fieldType='genericWord' />";
				}else if(tdObj.fieldInstanceOfMapField && jQuery.trim(result).indexOf("{")==0){
					aHtml = "<img src='resource/images/view/map.png' fieldType='map'/>";
				}else{
					aHtml = result;
				}
				return aHtml;
			},
			parseTbodyTdObj = function($td){
				var tdObj = {};
				tdObj.fieldtype = $td.attr('fieldtype');
				tdObj.displayType = $td.attr('displayType');
				tdObj.colWidth = $td.attr('colWidth');
				tdObj.colGroundColor = $td.attr('colGroundColor');
				tdObj.colColor = $td.attr('colColor');
				tdObj.colFontSize = $td.attr('colFontSize');
				tdObj.isVisible = $td.attr('isVisible');
				tdObj.isReadonly = $td.attr('isReadonly');
				tdObj.colType = $td.attr('colType');
				tdObj.fieldInstanceOfWordField = $td.attr('fieldInstanceOfWordField');
				tdObj.fieldInstanceOfgenericWordField = $td.attr('fieldInstanceOfgenericWordField');
				tdObj.fieldInstanceOfMapField = $td.attr('fieldInstanceOfMapField');
				tdObj.displayType = $td.attr('displayType');
				tdObj.isShowTitle = $td.attr('isShowTitle');
				tdObj.isHidden = $td.attr('isHidden');
				tdObj.colDisplayLength = $td.attr('colDisplayLength');
				tdObj.colFieldName = $td.attr('colFieldName');
				tdObj.colFlowReturnCss = $td.attr('colFlowReturnCss');
				tdObj.viewDisplayType = $td.attr('viewDisplayType');

				tdObj.isSignatureExist = $td.attr('isSignatureExist');
				tdObj.isEdit = $td.attr('isEdit');
				tdObj.colButtonType = $td.attr('colButtonType');
				tdObj.colApproveLimit = $td.attr('colApproveLimit');
				tdObj.colButtonName = $td.attr('colButtonName');
				tdObj.colMappingform = $td.attr('colMappingform');
				
				tdObj.colIcon = $td.attr('colIcon');
				tdObj.docId = $td.attr("docId");
				tdObj.colTemplateForm = $td.attr("colTemplateForm");
				tdObj.showword = $td.attr("showword");
				
				tdObj.showIcon =  ($td.attr('showIcon') != null) ? $td.attr('showIcon'):'';
				tdObj.docId = $td.attr('docId');
				tdObj.viewTemplateForm = $td.attr('viewTemplateForm');
				tdObj.docFormid = $td.attr('docFormid');
				tdObj.jumpMapping = $td.find("div[name='jumpMapping']").html();
				tdObj.result = $td.find("div[name='result']").html();
			
				//tdObj.displayType = (tdObj.displayType == 'true'?true:false);
				tdObj.colWidth = (tdObj.colWidth != "null")?tdObj.colWidth:'';
				tdObj.colGroundColor = (tdObj.colGroundColor && tdObj.colGroundColor != "null" && tdObj.colGroundColor != "FFFFFF")?tdObj.colGroundColor:'';
				tdObj.colColor = (tdObj.colColor && tdObj.colColor != "null" && tdObj.colColor != "000000")?tdObj.colColor:'';
				tdObj.colFontSize = (tdObj.colFontSize && tdObj.colFontSize != "null" && tdObj.colFontSize != "12")?tdObj.colFontSize:'';
				tdObj.isVisible = (tdObj.isVisible == 'true'?true:false);
				tdObj.isReadonly = (tdObj.isReadonly == 'true'?true:false);
				tdObj.colType = tdObj.colType?tdObj.colType:"";
				tdObj.fieldInstanceOfWordField = (tdObj.fieldInstanceOfWordField == 'true');				
				tdObj.fieldInstanceOfgenericWordField = (tdObj.fieldInstanceOfgenericWordField == 'true');
				tdObj.fieldInstanceOfMapField = (tdObj.fieldInstanceOfMapField == 'true');
				//tdObj.displayType = tdObj.displayType?tdObj.displayType:"";
				tdObj.isShowTitle = (tdObj.isShowTitle == 'true');
				
				tdObj.isOperateCol = ("COLUMN_TYPE_OPERATE" == tdObj.colType);	//是否操作列
				tdObj.isRowNumCol = ("COLUMN_TYPE_ROWNUM" == tdObj.colType);	//是否序号列
				tdObj.isLogoCol = ("COLUMN_TYPE_LOGO" == tdObj.colType && tdObj.colIcon && tdObj.colIcon != "");	//是否logo列

				tdObj.colDisplayLength = tdObj.colDisplayLength?tdObj.colDisplayLength:"";
				tdObj.colFieldName = tdObj.colFieldName?tdObj.colFieldName:"";
				tdObj.colFlowReturnCss = (tdObj.colFlowReturnCss == 'true'?true:false);
				tdObj.viewDisplayType = (tdObj.viewDisplayType != "null")?tdObj.viewDisplayType:'';
				
				tdObj.isSignatureExist = (tdObj.isSignatureExist == 'true'?true:false);
				tdObj.isEdit = (tdObj.isEdit == 'true'?true:false);
				tdObj.isHidden = (tdObj.isHidden == 'true'?true:false);
				tdObj.colButtonType = (tdObj.colButtonType != "null")?tdObj.colButtonType:'';
				tdObj.colApproveLimit = (tdObj.colApproveLimit != "null")?tdObj.colApproveLimit:'';
				tdObj.colButtonName = (tdObj.colButtonName != "null")?tdObj.colButtonName:'';
				tdObj.colMappingform = (tdObj.colMappingform != "null")?tdObj.colMappingform:'';
				tdObj.colIcon = (tdObj.colIcon != "null")?tdObj.colIcon:'';
				
				return tdObj;
			},
			//解析属性值
			parseTbodyTd = function($td){
				var tdObj = parseTbodyTdObj($td);

				var result = tdObj.result; 
				if(result && result != "" && result.indexOf("<table>") == -1){
					tdObj.title = $td.find("div[name='result']").text();
				}
				
				//是否隐藏字段
				if((tdObj.colWidth && tdObj.colWidth == '0') || !tdObj.isVisible || tdObj.isHidden ){
					tdObj.isHide = true;
					tdObj.display = "none";
				}

				if(tdObj.displayType){

					if(View.DISPLAY_TYPE_TEMPLATEFORM == tdObj.viewDisplayType){
						tdObj.templateForm = tdObj.viewTemplateForm;
					}
					//是否添加事件
					if(!(tdObj.isReadonly || tdObj.colType == "COLUMN_TYPE_LOGO") && result.indexOf("<TABLE>") == -1){
						tdObj.click = true;
					}
					
					if(tdObj.isReadonly){
						tdObj.tagName = "p";
						tdObj.editType = "readonly";
					}else{
						tdObj.tagName = "a";
						tdObj.editType = "edit";	//事件委托时使用
					}

					if(result.toLowerCase().indexOf("<a ") != -1 
							|| result.toLowerCase().indexOf("<a>") != -1
							|| (result.toLowerCase().indexOf("<input ") != -1 
							&& (result.toLowerCase().indexOf("type='button'") != -1 
							|| result.toLowerCase().indexOf("type=button") != -1))
							|| result.toLowerCase().indexOf("viewdoc") != -1){
					}else{
						if(tdObj.colType == "COLUMN_TYPE_FIELD"){
							tdObj.result = processMulState(tdObj);	//流程多状态、多审批人等处理
							tdObj.result = processResultByField(tdObj);	//字段列处理
						}
					}
				}
				
				return tdObj;
			},
			//解析列头th数据
			parseHeadTh = function($tdField, i){
				var thObj = {};
				thObj.upImg = "<img border=\"0\" src='../share/images/view/up.gif'/>";
				thObj.downImg = "<img border=\"0\" src='../share/images/view/down.gif'/>";
				
				thObj.colName = $tdField.attr("colName");
				thObj.colText = $tdField.attr("colText");
				thObj.isVisible = $tdField.attr("isVisible");
				thObj.isHiddenColumn = $tdField.attr("isHiddenColumn");
				thObj.colWidth = $tdField.attr("colWidth");
				thObj.colType = $tdField.attr("colType");
				thObj.colFieldName = $tdField.attr("colFieldName");
				thObj.isOrderByField = $tdField.attr("isOrderByField");
				thObj.isVisible = (thObj.isVisible == "true")?true:false;
				thObj.isHiddenColumn = (thObj.isHiddenColumn == "true")?true:false;
				thObj.colWidth = (thObj.colWidth == "null") ? "" : thObj.colWidth;
				thObj.cls = Setting.TH_TD_CLASS;
				thObj.thArrow = "";
				
				if(!thObj.isVisible || thObj.isHiddenColumn || thObj.colWidth == "0"){
					thObj.isHide = "true";
					thObj.display = "none";
				}
				if(i>2){
					thObj.priority = 6;
				}else{
					thObj.priority = 1;
				}

				var $sortCol = $("#_sortCol");
				var $sortStatus = $("#_sortStatus");
				var sortCol = $sortCol.val();
				var sortStatus = $sortStatus.val();
				
				if(sortCol != "" && sortCol.toUpperCase() == thObj.colFieldName.toUpperCase()){
					if(sortStatus == "ASC"){
						thObj.thArrow = thObj.upImg;
					}else if(sortStatus == "DESC"){
						thObj.thArrow = thObj.downImg;
					}
				}
				
				
				if(thObj.colWidth != ""){
					config.isSetWidth = true;
				}
				return thObj;
			},
			//解析汇总列td数据
			parseFootTd = function($tdField, i){
				var tdObj = {};
				tdObj.isvisible = $tdField.attr("isvisible");
				tdObj.ishiddencolumn = $tdField.attr("ishiddencolumn");
				tdObj.issum = $tdField.attr("issum");
				tdObj.istotal = $tdField.attr("istotal");
				tdObj.colname = $tdField.attr("colname");
				tdObj.sumbydatas = $tdField.attr("sumbydatas");
				tdObj.sumtotal = $tdField.attr("sumtotal");
				tdObj.isvisible = (tdObj.isvisible == "true")?true:false;
				tdObj.ishiddencolumn = (tdObj.ishiddencolumn == "true")?true:false;
				
				tdObj.colWidth = (tdObj.colWidth == "null") ? "" : tdObj.colWidth;
				//是否隐藏字段
				if((tdObj.colWidth && tdObj.colWidth == '0') || !tdObj.isVisible || tdObj.isHidden ){
					tdObj.display = "none";
				}
				return tdObj;
			},
			//获取表头数据
			getHeadData = function($head){
				var tr = {
						cls : Setting.TH_CLASS,
						ths : []
				}
				$head.find(">td").each(function(i){
					var $me = $(this);
					config.hideCol[i] = $me.attr("isHiddenColumn");
					tr.ths.push(parseHeadTh($me, i));
				});
				
				return tr;
			},
			//获取数据行数据
			getBodyData = function($trs){
				var tbody = {
						trs : []
				};

				$trs.each(function(){
					var $tr = $(this);
					var tr = {
							docId : $tr.attr("docId"),
							docFormid : $tr.attr("docFormid"),
							isSignatureExist : $tr.attr("isSignatureExist"),
							editType : config.editType,
							appid : jQuery("body",parent.document).find("#application").val(),
							tds : []
					};
					$tr.find(">td").each(function(){
						var $td = $(this);
						
						var td = parseTbodyTd($td);
						tr.tds.push(td);
					});
					tbody.trs.push(tr);
				});
				return tbody;
			},
			//获取汇总行数据
			getFootData = function($foot){
				
				
				
				var tr = {
						tds : []
				}
				var td = {};
				
				$foot.find(">td").each(function(i){
					var $td = $(this);
//					var td = {
//							textContent : $td.text()
//					}
					tr.tds.push(parseFootTd($td, i));
				});
				
				
				//tr.tds.push(td);
				return tr;
			},
			$field = $(this);

			config.viewId = $field.attr("_viewId"),
			config.sortCol = $field.attr("_sortCol"),
			config.sortStatus = $field.attr("_sortStatus"),
			//isReadonly = $field.isReadonly;
			isReadonly = $field.attr("isReadonly");
			isReadonly = (isReadonly == "true");
			
			if(isReadonly){
				config.editType = "readonly";
			}else{
				config.editType = "edit";
			}
			sumTrIsShow($field);
			var data = {
					viewId : config.viewId,
					head : {},
					tbody : {},
					foot : {},
					sumTrIsHidden : config.sumTrIsHidden
			};
			var $head = $field.find("tr.header"),
				$tbody = $field.find("tr[trType='dataTr']"),
				$foot = $field.find("#sumTrId");
			data.head = getHeadData($head);						//获取表头数据
			data.tbody = getBodyData($tbody);					//获取数据行数据
			data.foot = getFootData($foot);						//获取汇总行数据
			$(".dataTableDiv").append(template("listView-tmpl", data))
			//$field.remove();
			bindEvent();
		});
	};
})(jQuery);


//视图翻到第一页
function showFirstPage(FO) {
	var _currpage = ajaxPage.getParamsByName("_currpage");
	var _pagelines = ajaxPage.getParamsByName("_pagelines");
	var _rowcount = ajaxPage.getParamsByName("_rowcount");
	
	if (isNaN(parseInt(_currpage.val()))
			|| isNaN(parseInt(_pagelines.val()))
			|| isNaN(parseInt(_rowcount.val()))) {
		return;
	}
	var pageNo = parseInt(_currpage.val());
	var pageCount = Math.ceil(parseInt(_rowcount.val()) / parseInt(_pagelines.val()));
	if (pageCount > 1 && pageNo > 1) {
		_currpage.val(1);	//设置成第一页
		ajaxPage.reloadPage();
	}
}

//视图翻到上一页
function showPreviousPage(FO) {
	var _currpage = ajaxPage.getParamsByName("_currpage");
	var _pagelines = ajaxPage.getParamsByName("_pagelines");
	var _rowcount = ajaxPage.getParamsByName("_rowcount");
	
	if (isNaN(parseInt(_currpage.val()))
			|| isNaN(parseInt(_pagelines.val()))
			|| isNaN(parseInt(_rowcount.val()))) {
		return;
	}
	var pageNo = parseInt(_currpage.val());
	var pageCount = Math.ceil(parseInt(_rowcount.val()) / parseInt(_pagelines.val()));
	if (pageCount > 1 && pageNo > 1) {
		_currpage.val(pageNo - 1);	//增加一页
		ajaxPage.reloadPage();
	}
}

//视图翻到下一页
function showNextPage() {
	var _currpage = ajaxPage.getParamsByName("_currpage");
	var _pagelines = ajaxPage.getParamsByName("_pagelines");
	var _rowcount = ajaxPage.getParamsByName("_rowcount");
	
	if (isNaN(parseInt(_currpage.val()))
			|| isNaN(parseInt(_pagelines.val()))
			|| isNaN(parseInt(_rowcount.val()))) {
		return;
	}
	var pageNo = parseInt(_currpage.val());
	var pageCount = Math.ceil(parseInt(_rowcount.val()) / parseInt(_pagelines.val()));
	if (pageCount > 1 && pageCount > pageNo) {
		_currpage.val(pageNo + 1);	//增加一页
		ajaxPage.reloadPage();
	}
}


//视图翻到最后一页
function showLastPage() {
	var _currpage = ajaxPage.getParamsByName("_currpage");
	var _pagelines = ajaxPage.getParamsByName("_pagelines");
	var _rowcount = ajaxPage.getParamsByName("_rowcount");
	
	if (isNaN(parseInt(_currpage.val()))
			|| isNaN(parseInt(_pagelines.val()))
			|| isNaN(parseInt(_rowcount.val()))) {
		return;
	}

	var pageNo = parseInt(_currpage.val());
	var pageCount = Math.ceil(parseInt(_rowcount.val()) / parseInt(_pagelines.val()));
	if (pageCount > 1 && pageCount > pageNo) {
		_currpage.val(pageCount);	//设置成最后一页
		ajaxPage.reloadPage();
	}
}

var dialogView = {
		//翻页ajax,不用form的sumbit（会改变浏览器的历史）
		loadDialogViewList : function(){
			var $iframeBody = $("body");
			var $iframeForm = $("body form");
			var url = $iframeForm.attr("action");
			var params = $iframeForm.serialize();
			$.ajax({
				url : url,
				data : params,
				dataType : "html",
				cache : false,
				type : "POST",
				success : function(html){
					var $div = $("<div></div>");
					$div.append(html);
					//获取table的内容并替换
					var $view_iframe = $div.find("#view_iframe").html();
					$iframeForm.find("#view_iframe").html($view_iframe);
					//获取分页内容并替换
					var $navPage = $div.find("#footer .pagination").html();
					$iframeForm.find("#footer .pagination").html($navPage);
					tableListColumn();
				},
				error : function(ex){
					console.error("ajax页面加载报错：" + ex);
				}
			});
		},
		sendSelectList : function(){
			var $selectList = $("#selectList");
			if($selectList.size()>0){
				var $selectListInput = $("<input type='hidden' name='_selectlist' />")
				var selectList = $selectList.text();
				$selectListInput.val(selectList);
				$selectList.append($selectListInput)
			}
		},
		
		
		//视图翻到第一页
		showFirstPage : function(FO) {
			this.sendSelectList();
			var _currpage = $("body").find("input[name='_currpage']");
			var _pagelines = $("body").find("input[name='_pagelines']");
			var _rowcount = $("body").find("input[name='_rowcount']");
			
			if (isNaN(parseInt(_currpage.val()))
					|| isNaN(parseInt(_pagelines.val()))
					|| isNaN(parseInt(_rowcount.val()))) {
				return;
			}
			var pageNo = parseInt(_currpage.val());
			var pageCount = Math.ceil(parseInt(_rowcount.val()) / parseInt(_pagelines.val()));
			if (pageCount > 1 && pageNo > 1) {
				_currpage.val(1);	//设置成第一页
				this.loadDialogViewList();
			}
		},

		//视图翻到上一页
		showPreviousPage : function(FO) {
			this.sendSelectList();
			var _currpage = $("body").find("input[name='_currpage']");
			var _pagelines = $("body").find("input[name='_pagelines']");
			var _rowcount = $("body").find("input[name='_rowcount']");
			
			if (isNaN(parseInt(_currpage.val()))
					|| isNaN(parseInt(_pagelines.val()))
					|| isNaN(parseInt(_rowcount.val()))) {
				return;
			}
			var pageNo = parseInt(_currpage.val());
			var pageCount = Math.ceil(parseInt(_rowcount.val()) / parseInt(_pagelines.val()));
			if (pageCount > 1 && pageNo > 1) {
				_currpage.val(pageNo - 1);	//增加一页
				this.loadDialogViewList();
			}
		},

		//视图翻到下一页
		showNextPage : function() {
			this.sendSelectList();
			var _currpage = $("body").find("input[name='_currpage']");
			var _pagelines = $("body").find("input[name='_pagelines']");
			var _rowcount = $("body").find("input[name='_rowcount']");
			
			if (isNaN(parseInt(_currpage.val()))
					|| isNaN(parseInt(_pagelines.val()))
					|| isNaN(parseInt(_rowcount.val()))) {
				return;
			}
			var pageNo = parseInt(_currpage.val());
			var pageCount = Math.ceil(parseInt(_rowcount.val()) / parseInt(_pagelines.val()));
			if (pageCount > 1 && pageCount > pageNo) {
				_currpage.val(pageNo + 1);	//增加一页
				this.loadDialogViewList();
			}
		},


		//视图翻到最后一页
		showLastPage : function() {
			this.sendSelectList();
			var _currpage = $("body").find("input[name='_currpage']");
			var _pagelines = $("body").find("input[name='_pagelines']");
			var _rowcount = $("body").find("input[name='_rowcount']");
			
			if (isNaN(parseInt(_currpage.val()))
					|| isNaN(parseInt(_pagelines.val()))
					|| isNaN(parseInt(_rowcount.val()))) {
				return;
			}

			var pageNo = parseInt(_currpage.val());
			var pageCount = Math.ceil(parseInt(_rowcount.val()) / parseInt(_pagelines.val()));
			if (pageCount > 1 && pageCount > pageNo) {
				_currpage.val(pageCount);	//设置成最后一页
				this.loadDialogViewList();
			}
		}
}

/**
 * jquery重构列表视图
 * for:列表视图
 */
function jqRefactor4ListView(){
	var $curPage = ajaxPage.getCurPage();
	$curPage.find("table[moduleType='viewList']").obpmListView();
}; 
/**
 * 	后台预览的时候判断页面是否重构完成
 */
var isComplete = false; 

/**
 * 子视图公用初始化方法
 * @return
 */
function initDispComm(){

	openDownloadWindow(openDownWinStr);	// 打开Excel下载窗口
	setTimeout(function(){
		jqRefactor4DisplayView(); //DisplayView重构
	},50);
	setTimeout(function(){
		jqRefactor();//表单控件jquery重构
	},10);
	selectData4Doc(); //回选列表数据
	setTimeout(function(){
		showPromptMsg();	//显示提示信息
	},300);
	document.ondblclick=handleDbClick;
	setTimeout(function(){
		dataTableSize();
		//ev_resize4IncludeViewPar();	//包含元素包含视图时调整iframe高度
	},300);
	ev_reloadParent();	//刷新父窗口	
	isComplete = true; //后台预览的时候判断页面是否重构完成
}

//给后台preview.jsp视图预览的时候判断页面是否重构完成
function getIsComplete(){
	return isComplete ;
}


function zoompage() {
 	var typeflage = typeof(dialogArguments);
 	if(typeflage != 'undefined' ) {    
    	
    }else if(window.opener){
    	
    }else{
        window.top.IsResize();
    }
 	ev_resize4IncludeViewPar();	//包含元素包含视图时调整iframe高度
}
//设置数据容器的高度。
function dataTableSize(){
	//包含元素固定高度时不重新布局
	var divid = document.getElementsByName("divid")[0].value;
	var pSpan = parent.document.getElementById(divid);
	var pIframe = "";
	var fixation = "false";
	if(pSpan){
		pIframe = pSpan.getElementsByTagName("iframe")[0];
		if(pIframe){
			fixation = pIframe.getAttribute("fixation");
		}
	}
	if(fixation=="true") return;
	
	var dataTableH = jQuery("#dataTable").height();
	if(dataTableH < 100){
		dataTableH = 120;
	}else if(dataTableH >300){
		dataTableH = 300;
	}else{
		dataTableH = dataTableH + 20;
	}
	jQuery("#table_container").height(dataTableH);
}
function handleDbClick(){
	if(event.srcElement.onclick){
	}else if(event.srcElement.type!=null&&(event.srcElement.type.toUpperCase()=='SUBMIT'
		||event.srcElement.type.toUpperCase()=='BUTTON'
		||event.srcElement.type.toUpperCase()=='CHECKBOX'
		||event.srcElement.type.toUpperCase()=='RADIO'
		||event.srcElement.type.toUpperCase()=='SELECT'
		||event.srcElement.type.toUpperCase()=='IMG')){
	  
	}else{
		zoompage();
	}
}

/**
 * 显示提示信息
 * for:default/gentle/fresh/dwz/brisk/blue
 */
function showPromptMsg(){
	var funName = typeName;
	var url = urlValue;
	url+="&_refreshDocument=true";
	var msg = document.getElementsByName("message")[0].value;
	if (msg) {
		try{
			eval("do" + funName + "(msg , url);");
		} catch(ex) {
		}
	}
}

function on_unload() {
	ev_reloadParent();	//刷新父窗口
}

function createDoc(activityid) {
	// 查看/script/view.js
	var action = activityAction + "?_activityid=" + activityid;
	openWindowByType(action,newStr, VIEW_TYPE_SUB, activityid); 
}

/**
 * 包含元素包含视图时调整iframe高度
 * from:blue/brisk/default/dwz/fresh/gentle
 */
function ev_resize4IncludeViewPar(){
	var divid = document.getElementsByName("divid")[0].value;
	var _viewid = document.getElementsByName("_viewid")[0].value;
	ev_resize4IncludeView(divid,_viewid,'DISPLAYVIEW');
}

/**
 * 重构displayView
 */
(function($){
	$.fn.obpmDisplayView = function(){
		return this.each(function(){
			
			var $dvid = ajaxPage.getCurPage().find("title").attr("id");
			$(this).next(".ui-content").attr("id","view_"+$dvid);
			
			var Column = {
					COLUMN_TYPE_SCRIPT : 'COLUMN_TYPE_SCRIPT',	//脚本编辑模式
					COLUMN_TYPE_FIELD : 'COLUMN_TYPE_FIELD',	//视图编辑模式
					COLUMN_TYPE_OPERATE : 'COLUMN_TYPE_OPERATE',//操作列
					COLUMN_TYPE_LOGO : 'COLUMN_TYPE_LOGO',		//图标列
					COLUMN_TYPE_ROWNUM : 'COLUMN_TYPE_ROWNUM',	//序号列
					DISPLAY_ALL : '00',//列显示全部文本
					DISPLAY_PART : '01'//列显示部分文本
			},
			ColumnOperaType = {
					BUTTON_TYPE_DELETE : "00",
					BUTTON_TYPE_DOFLOW : "01",
					BUTTON_TYPE_TEMPFORM : "03",
					BUTTON_TYPE_SCRIPT : "04",
					BUTTON_TYPE_JUMP : "05"//操作列增加跳转类型按钮
			},
			View = {
					DISPLAY_TYPE_TEMPLATEFORM : "templateForm"
			},
			Setting = {//
					TABLE_CLASS : 'listDataTable',		//表格class
					TH_CLASS : 'listDataTh',						//标题行class
					TH_FIRST_TD_CLASS : 'listDataThFirstTd',			//标题行第一个单元格class
					TH_TD_CLASS : 'listDataThTd',		//标题行其他单元格class
					TR_FIRST_TD_CLASS : 'listDataTrFirstTd',		//数据行第一个单元格class
					TR_TD_CLASS : 'listDataTrTd',		//数据行其他单元格class
					TR_CLASS : 'listDataTr',				//数据行class
					TR_OVER_CLASS : 'listDataTr_over'	//数据行滑过class
			},
			
			/**
			 * 重构数据行td
			 */
			toDataTdHtml = function($tdField, i){
					var tdAttrs = {};
					tdAttrs.fieldtype = $tdField.attr('fieldtype');
					tdAttrs.displayType = $tdField.attr('displayType');
					tdAttrs.isHidden = $tdField.attr('isHidden');
					tdAttrs.colWidth = $tdField.attr('colWidth');
					tdAttrs.colGroundColor = $tdField.attr('colGroundColor');
					tdAttrs.colColor = $tdField.attr('colColor');
					tdAttrs.colFontSize = $tdField.attr('colFontSize');
					tdAttrs.isVisible = $tdField.attr('isVisible');
					tdAttrs.isReadonly = $tdField.attr('isReadonly');
					tdAttrs.colType = $tdField.attr('colType');
					tdAttrs.fieldInstanceOfWordField = $tdField.attr('fieldInstanceOfWordField');
					tdAttrs.fieldInstanceOfgenericWordField = $tdField.attr('fieldInstanceOfgenericWordField');
					tdAttrs.fieldInstanceOfMapField = $tdField.attr('fieldInstanceOfMapField');
					tdAttrs.displayType = $tdField.attr('displayType');
					tdAttrs.isShowTitle = $tdField.attr('isShowTitle');
					tdAttrs.colDisplayLength = $tdField.attr('colDisplayLength');
					tdAttrs.colFieldName = $tdField.attr('colFieldName');
					tdAttrs.colFlowReturnCss = $tdField.attr('colFlowReturnCss');
					tdAttrs.viewDisplayType = $tdField.attr('viewDisplayType');

					tdAttrs.isSignatureExist = $tdField.attr('isSignatureExist');
					tdAttrs.isEdit = $tdField.attr('isEdit');
					tdAttrs.colButtonType = $tdField.attr('colButtonType');
					tdAttrs.colApproveLimit = $tdField.attr('colApproveLimit');
					tdAttrs.colButtonName = $tdField.attr('colButtonName');
					tdAttrs.colMappingform = $tdField.attr('colMappingform');
					
					tdAttrs.result = $tdField.find("div[name='result']").html();
					tdAttrs.colIcon = $tdField.attr('colIcon');
					tdAttrs.colId = $tdField.attr("colId");
					tdAttrs.colTemplateForm = $tdField.attr("colTemplateForm");
					tdAttrs.showword = $tdField.attr("showword");
				
					var tdHtml = '';
					var pHtml = '';
					var aHtml = '';
				
					//tdAttrs.displayType = (tdAttrs.displayType == 'true'?true:false);
					tdAttrs.isShowTitle = (tdAttrs.isShowTitle == 'true'?true:false);
					tdAttrs.result = (tdAttrs.result?tdAttrs.result:'');
					
					tdAttrs.colWidth = (tdAttrs.colWidth != "null")?tdAttrs.colWidth:'';
					tdAttrs.colGroundColor = (tdAttrs.colGroundColor && tdAttrs.colGroundColor != "null" && tdAttrs.colGroundColor != "FFFFFF")?tdAttrs.colGroundColor:'';
					tdAttrs.colColor = (tdAttrs.colColor && tdAttrs.colColor != "null" && tdAttrs.colColor != "000000")?tdAttrs.colColor:'';
					tdAttrs.colFontSize = (tdAttrs.colFontSize && tdAttrs.colFontSize != "null" && tdAttrs.colFontSize != "12")?tdAttrs.colFontSize:'';
					tdAttrs.isVisible = (tdAttrs.isVisible == 'true'?true:false);
					tdAttrs.isReadonly = (tdAttrs.isReadonly == 'true'?true:false);
					tdAttrs.colType = tdAttrs.colType?tdAttrs.colType:"";
					tdAttrs.fieldInstanceOfWordField = (tdAttrs.fieldInstanceOfWordField == 'true'?true:false);
					tdAttrs.fieldInstanceOfgenericWordField = (tdAttrs.fieldInstanceOfgenericWordField == 'true'?true:false);
					tdAttrs.fieldInstanceOfMapField = (tdAttrs.fieldInstanceOfMapField == 'true'?true:false);
					//tdAttrs.displayType = tdAttrs.displayType?tdAttrs.displayType:"";
					tdAttrs.isShowTitle = (tdAttrs.isShowTitle == 'true'?true:false);

					tdAttrs.colDisplayLength = tdAttrs.colDisplayLength?tdAttrs.colDisplayLength:"";
					tdAttrs.colFieldName = tdAttrs.colFieldName?tdAttrs.colFieldName:"";
					tdAttrs.colFlowReturnCss = (tdAttrs.colFlowReturnCss == 'true'?true:false);
					tdAttrs.viewDisplayType = (tdAttrs.viewDisplayType != "null")?tdAttrs.viewDisplayType:'';
					
					tdAttrs.isSignatureExist = (tdAttrs.isSignatureExist == 'true'?true:false);
					tdAttrs.isEdit = (tdAttrs.isEdit == 'true'?true:false);
					tdAttrs.isHidden = (tdAttrs.isHidden == 'true'?true:false);
					tdAttrs.colButtonType = (tdAttrs.colButtonType != "null")?tdAttrs.colButtonType:'';
					tdAttrs.colApproveLimit = (tdAttrs.colApproveLimit != "null")?tdAttrs.colApproveLimit:'';
					tdAttrs.colButtonName = (tdAttrs.colButtonName != "null")?tdAttrs.colButtonName:'';
					tdAttrs.colMappingform = (tdAttrs.colMappingform != "null")?tdAttrs.colMappingform:'';
					tdAttrs.colIcon = (tdAttrs.colIcon != "null")?tdAttrs.colIcon:'';
					tdAttrs.showIcon =  ($tdField.attr('showIcon') != null) ? $tdField.attr('showIcon'):'';
					
					if(tdAttrs.result.indexOf("[")==0){
						tdAttrs.title = $tdField.find("div[name='result']").text();
					}

				var docId = $tdField.attr('docId');
				docId = docId?docId:'';
				
				//var title = $tdField.attr('title');
				var tip = "";
				//if(title.indexOf("<table>") == -1)
				//	tip = title;
				
				var viewTemplateForm = $tdField.attr('viewTemplateForm');
				viewTemplateForm = (viewTemplateForm != "null")?viewTemplateForm:'';
									
				var docFormid = $tdField.attr('docFormid');
				docFormid = docFormid?docFormid:'';
				
				var jumpMapping = $tdField.find("div[name='jumpMapping']").html();
				jumpMapping = jumpMapping?jumpMapping:'';
				
				var result = $tdField.find("div[name='result']").html();
				result = (result?result:'');
				
				if(tdAttrs.showIcon){
					result = "<img style='' src='../../../lib/icon/" + tdAttrs.showIcon+ "'/>";
				}

				var convert2HTMLEncode = function(str){
					var s = str;
					if(Column.COLUMN_TYPE_FIELD == tdAttrs.colType && !tdAttrs.colFieldName.substr(0,1) == "$" && !tdAttrs.colFlowReturnCss){
						s = s.replace(new RegExp(">","gm"),"&gt;");
						s = s.replace(new RegExp("<","gm"),"&lt;");
					}
					return s;
				};
				//多流程状态时数据处理
				var result2tdHtml = function(){
					var templateForm = "";
					if(View.DISPLAY_TYPE_TEMPLATEFORM == tdAttrs.viewDisplayType){
						templateForm = viewTemplateForm;
					}
					var resHtml = "";
					if("$StateLabel" == tdAttrs.colFieldName && (result.indexOf("[")==0 || result.indexOf("<img")==0)){//视图列绑定流程状态字段类型
						//解析json数据生成html
						resHtml += "<TABLE style=\"width:100%;border:0;\">";
						var instances;
						if(result.indexOf("[")==0){
							instances = JSON.parse(result);
						}else if(result.indexOf("<img")==0){
							var jsonStartIndex = result.indexOf("[{"),
								jsonEndIndex = result.lastIndexOf("}]"),
								imgHtml = result.substring(0,result.indexOf("<font")),
								fontStart = result.substring(result.indexOf("<font"),jsonStartIndex),
								fontEnd = result.substring(jsonEndIndex + 2,result.length);
							instances = result.substring(jsonStartIndex,jsonEndIndex + 2);
							instances = eval("(" + instances + ")");
						}
						for(var i=0;i<instances.length;i++){
							if(i+1==instances.length){
								resHtml += "<tr><td style=\"line-height:16px;border-right-width:0;border-bottom-width:0; border-right-style: none;\">";
							}else{
								resHtml += "<tr><td style=\"line-height:16px;border-right-width: 0px; border-right-style: none;\">";
							}
							var instance = instances[i];
							var instanceId = instance.instanceId;
							
							var nodes = instance.nodes;
							if(result.indexOf("<img")==0){
								resHtml += imgHtml;
							}
							for(var j=0;j<nodes.length;j++){
								var node = nodes[j];
								var nodeId = node.nodeId;
								var stateLable = truncationText(node.stateLabel,tdAttrs.displayType,tdAttrs.colDisplayLength,tdAttrs.showIcon);
								//只读
								if(tdAttrs.isReadonly){
									resHtml += stateLable;
								}else {
									resHtml += "<a href=\"javaScript:DisplayView.viewDoc(this, '";
									resHtml += docId + "', '";
									resHtml += docFormid + "', '";
									resHtml += tdAttrs.isSignatureExist + "', '";
									resHtml += templateForm + "', '";
									resHtml += tdAttrs.isEdit + "', '";
									resHtml += instanceId + "', '";
									resHtml += nodeId + "')\">";
									if(result.indexOf("<img")==0){
										stateLable = fontStart + stateLable + fontEnd;
									}
									resHtml += stateLable+"</a>&nbsp;&nbsp;";
								}
							}
							resHtml += "</td></tr>";
						}
						resHtml += "</TABLE>";
					
					}else if("$PrevAuditNode" == tdAttrs.colFieldName && result.indexOf("[")==0){//视图列绑定上一环节流程处理节点名称字段
						//解析json数据生成html
						resHtml += "<TABLE style=\"width:100%;border:0;\">";
						var instances = JSON.parse(result);
						for(var i=0;i<instances.length;i++){
							var instance = instances[i];
							var instanceId = instance.instanceId;
							var prevAuditNode = instance.prevAuditNode;

							if(i+1==instances.length){
								resHtml += "<tr><td title=\""+prevAuditNode+"\" style=\"line-height:16px;border-right-width:0;border-bottom-width:0; border-right-style: none;\">";
							}else{
								resHtml += "<tr><td title=\""+prevAuditNode+"\" style=\"line-height:16px;border-right-width: 0px; border-right-style: none;\">";
							}
							//只读
							if(tdAttrs.isReadonly){
								resHtml += truncationText(prevAuditNode,tdAttrs.displayType,tdAttrs.colDisplayLength,tdAttrs.showIcon);
							}else {
								resHtml += "<a href=\"javaScript:DisplayView.viewDoc(this, '";
								resHtml += docId + "', '";
								resHtml += docFormid + "', '";
								resHtml += tdAttrs.isSignatureExist + "', '";
								resHtml += templateForm + "', '";
								resHtml += tdAttrs.isEdit + "', '";
								resHtml += instanceId + "')\">";
								resHtml += truncationText(prevAuditNode,tdAttrs.displayType,tdAttrs.colDisplayLength,tdAttrs.showIcon)+"</a>&nbsp;&nbsp;";
							}
							resHtml += "</td></tr>";
						}
						resHtml += "</TABLE>";
					
					}else if("$PrevAuditUser" == tdAttrs.colFieldName && result.indexOf("[")==0){//视图列绑定上一环节流程处理节点名称字段
						//解析json数据生成html
						resHtml += "<TABLE style=\"width:100%;border:0;\">";
						var instances = JSON.parse(result);
						for(var i=0;i<instances.length;i++){
							var instance = instances[i];
							var instanceId = instance.instanceId;
							var prevAuditUser = instance.prevAuditUser;

							if(i+1==instances.length){
								resHtml += "<tr><td title=\""+prevAuditUser+"\" style=\"line-height:16px;border-right-width:0;border-bottom-width:0; border-right-style: none;\">";
							}else{
								resHtml += "<tr><td title=\""+prevAuditUser+"\" style=\"line-height:16px;border-right-width: 0px; border-right-style: none;\">";
							}
							//只读
							if(tdAttrs.isReadonly){
								resHtml += truncationText(prevAuditUser,tdAttrs.displayType,tdAttrs.colDisplayLength,tdAttrs.showIcon);
							}else {
								resHtml += "<a href=\"javaScript:DisplayView.viewDoc(this, '";
								resHtml += docId + "', '";
								resHtml += docFormid + "', '";
								resHtml += tdAttrs.isSignatureExist + "', '";
								resHtml += templateForm + "', '";
								resHtml += tdAttrs.isEdit + "', '";
								resHtml += instanceId + "')\">";
								resHtml += truncationText(prevAuditUser,tdAttrs.displayType,tdAttrs.colDisplayLength,tdAttrs.showIcon)+"</a>&nbsp;&nbsp;";
							}
							resHtml += "</td></tr>";
						}
						resHtml += "</TABLE>";
					
					}else {
						resHtml = truncationText(result,tdAttrs.displayType,tdAttrs.colDisplayLength,tdAttrs.showIcon);
					}
					return resHtml;
				};
				//序号列处理
				var processColumnNum = function(){
					return i + "";
				};
				
				if(!tdAttrs.isHidden){
					// 宽度为0时隐藏
					if((tdAttrs.colWidth && tdAttrs.colWidth == '0') || !tdAttrs.isVisible || tdAttrs.isHidden ){
						tdHtml += "<td class='" + Setting.TR_TD_CLASS + "' style='display: none;'";
					}else if(tdAttrs.colGroundColor != ""){//如果设置了底色,加上底色
						tdHtml += "<td class='" + Setting.TR_TD_CLASS + "' style='background-color:" + tdAttrs.colGroundColor + ";word-break: break-all;'";
					}else{
						tdHtml += "<td class='" + Setting.TR_TD_CLASS + "' style='word-break: break-all;'";
					}
					
					if(!(tdAttrs.isReadonly || tdAttrs.colType == "COLUMN_TYPE_LOGO") && result.indexOf("<TABLE>") == -1){
						tdHtml += " onClick=\"DisplayView.viewDoc(this, '"
							+ docId + "', '"
							+ docFormid + "', '"
							+ tdAttrs.isSignatureExist + "', '"
							+ templateForm + "', '"
							+ tdAttrs.isEdit + "')\"";
					}
					
					tdHtml += ">";
					
					//只读或logo列或列字段或word控件字段
					if(tdAttrs.isReadonly || tdAttrs.colType == "COLUMN_TYPE_LOGO" || tdAttrs.fieldInstanceOfWordField || tdAttrs.fieldInstanceOfMapField || tdAttrs.fieldInstanceOfgenericWordField ){//|| !tdAttrs.isEdit  ) {
						if(!tdAttrs.fieldInstanceOfWordField && !tdAttrs.fieldInstanceOfMapField && !tdAttrs.fieldInstanceOfgenericWordField){
							var pHtml = "";
							pHtml += "<p";
							if(tdAttrs.isShowTitle)
								pHtml += " title='" + title + "'";

							//如果有设置字体大小及颜色
							if((tdAttrs.colColor != "") || (tdAttrs.colFontSize != "")){
								pHtml += " style='";
								if(tdAttrs.colColor != ""){
									pHtml += "color:" + tdAttrs.colColor + ";";
								}
								if(tdAttrs.colFontSize != ""){
									pHtml += "font-size:" + tdAttrs.colFontSize + "px;";
								}
								pHtml += "'";
							}
							pHtml += " >";
							
							//子流程标签和处理人数据处理
							if(tdAttrs.isReadonly){
								if(result != null){
									result = result2tdHtml();
								}
							}
							
							//序号列处理
							if(tdAttrs.colType == Column.COLUMN_TYPE_ROWNUM){
								result = processColumnNum();
							}
							
							if(Column.DISPLAY_ALL == tdAttrs.displayType){
								pHtml += convert2HTMLEncode(result) + "</p>";
							}else{
								pHtml += convert2HTMLEncode(result) + "</p>";
							}
							tdHtml += pHtml;
						}
					}else{
						if(result != null){
							var aHtml = "";
							if(result.toLowerCase().indexOf("<a ") != -1 
									|| result.toLowerCase().indexOf("<a>") != -1
									|| (result.toLowerCase().indexOf("<input ") != -1 
									&& (result.toLowerCase().indexOf("type='button'") != -1 
									|| result.toLowerCase().indexOf("type=button") != -1))
									|| result.toLowerCase().indexOf("viewdoc") != -1){
								aHtml += result;
							}else{
								//子流程标签和处理人数据处理
								result = result2tdHtml();

								//序号列处理
								if(tdAttrs.colType == Column.COLUMN_TYPE_ROWNUM){
									result = processColumnNum();
								}
								
								var templateForm = "";
								if(View.DISPLAY_TYPE_TEMPLATEFORM == tdAttrs.viewDisplayType){
									templateForm = viewTemplateForm;
								}
								if(result.indexOf("<TABLE>") != -1  || !tdAttrs.isEdit){
//									aHtml += "<div style=\"cursor:pointer;\" onclick=\"javaScript:DisplayView.viewDoc(this, '";
									aHtml += "<div style=\"cursor:pointer;\" ";
								}else{
									aHtml += "<a ";
//									aHtml += "<a href=\"javaScript:DisplayView.viewDoc(this, '";
//									aHtml += docId + "', '";
//									aHtml += docFormid + "', '";
//									aHtml += tdAttrs.isSignatureExist + "', '";
//									aHtml += templateForm + "', '";
//									aHtml += tdAttrs.isEdit + "')\"";
								}
								
								//如果有设置字体大小及颜色
								if((tdAttrs.colColor != "") || (tdAttrs.colFontSize != "")){
									aHtml += " style='";
									if(tdAttrs.colColor != ""){
										aHtml += "color:#" + tdAttrs.colColor + ";";
									}
									if(tdAttrs.colFontSize != ""){
										aHtml += "font-size:" + tdAttrs.colFontSize + "px;";
									}
									aHtml += "'";
								}
									
								if(result.indexOf("img") != -1) {
									if(tdAttrs.isShowTitle)
										aHtml += " title='" + tdAttrs.title + "'";
										
									aHtml += " >";
									if(result.indexOf("<TABLE>") != -1){
										aHtml += convert2HTMLEncode(result) + "</div>";
									}else{
										var _result = convert2HTMLEncode(result);
										if($(_result).attr("moduletype") == "viewImageUpload" || ($(_result).attr("moduletype") != null && $(_result).attr("moduletype").indexOf("viewTakePhoto") >= 0)){
											var _url = $(_result).attr("url").replace(/\\'/g,"");
											var _picHtml = "<div class='images-preview' data-index='"+i+"' data-src='"+_url+"' style='display: inline-block;margin:3px;'>" +
															"<img style='max-height:50px;max-width:50px;' src='"+_url+"' />" +
															"</div>";
											aHtml += _picHtml + "</p>";
										}
									}
								}else{
									if(tdAttrs.isShowTitle)
										aHtml += " title='" + tdAttrs.title + "'";
									aHtml += " >";
									if(result.indexOf("<TABLE>") != -1){
										aHtml += convert2HTMLEncode(result) + "</div>";
									}else{
										if(tdAttrs.colType == "COLUMN_TYPE_FIELD"){
											if(tdAttrs.fieldtype=="weixinrecordfield" && jQuery.trim(result).indexOf("{")==0){
												aHtml+='<div class="weixin_record">';
												aHtml+= '<img src="../share/images/view/voice.png" width="21px"/>';
												aHtml+='</div>';
											} else if(tdAttrs.fieldtype=="weixingpsfield" && jQuery.trim(result).indexOf("{")==0){//微信gps定位控件
												var location = jQuery.parseJSON(result);
												aHtml+='<div class="gps_col">';
												if(tdAttrs.showType=="00"){//真实值
													aHtml+='<a href="#" class="gps_col_link" data-location=\''+result+'\'>';
													aHtml+='<span class="gps_col_text">'+location.address+'</span>';
													aHtml+='</a>';
												}else{//显示值
													aHtml+='<span class="gps_col_text">'+location.address+'</span>';
												}
												aHtml+='</div>';
											} else if(tdAttrs.fieldtype=="imageupload"){
												var _result = convert2HTMLEncode(result);
												if(_result && _result != "" && _result != " "){
													var _images = JSON.parse(convert2HTMLEncode(result));
													for(var i = 0; i < _images.length; i++){
														var _url = contextPath + _images[i].path;
														var _picHtml = "<div class='images-preview' data-src='"+_url+"' style='display: inline-block;margin:3px;'>" +
																"<img style='max-height:50px;max-width:50px;' src='"+_url+"' />" +
																"</div>";
														aHtml += _picHtml;
													}
												}
											} else if(tdAttrs.fieldtype=="attachmentupload"){
												var _result = convert2HTMLEncode(result);
												if(_result && _result != "" && _result != " "){
													var _images = JSON.parse(convert2HTMLEncode(result));
													for(var i = 0; i < _images.length; i++){
														var _url = contextPath + _images[i].path;
														var _name = _images[i].name;
														var _picHtml = "<a href='" + _url + "' target='_about'>" + _name + "</a>";
														aHtml += _picHtml;
													}
												}
											} else if(tdAttrs.fieldtype=="onlinetakephoto"){
												var _result = convert2HTMLEncode(result);
												if(_result && _result != "" && _result != " "){
													var _url = $(_result).attr("url");
													var _picHtml = "<div class='images-preview' data-src='"+_url+"' style='display: inline-block;margin:3px;'>" +
															"<img style='max-height:50px;max-width:50px;' src='"+_url+"' />" +
															"</div>";
													aHtml += _picHtml;
												}
											}else {
												aHtml += convert2HTMLEncode(result);
											}
										}else {
											aHtml += convert2HTMLEncode(result);
										}
										aHtml += "</a>";
									}
								}
							}
						}
						tdHtml += aHtml;
					}
					
					//操作列
					if("COLUMN_TYPE_OPERATE" == tdAttrs.colType && ColumnOperaType.BUTTON_TYPE_DELETE == tdAttrs.colButtonType){
						var inputHtml = "<input type=button value='" + tdAttrs.colButtonName;
						
						inputHtml += "' onclick=\"on_delete('"+docId+"')\" ";
						inputHtml += "/>";
						
						tdHtml += inputHtml;
						
					}else if("COLUMN_TYPE_OPERATE" == tdAttrs.colType && ColumnOperaType.BUTTON_TYPE_DOFLOW == tdAttrs.colButtonType){
						var inputHtml = "<input type=button value='" + tdAttrs.colButtonName;

						inputHtml += "' onclick=\"on_doflow('"+docId+"','"+tdAttrs.colApproveLimit+"')\" ";
						inputHtml += "/>";
						
						tdHtml += inputHtml;
						
					}else if("COLUMN_TYPE_OPERATE" == tdAttrs.colType && ColumnOperaType.BUTTON_TYPE_TEMPFORM == tdAttrs.colButtonType){
						var inputHtml = "<input type=button value='" + tdAttrs.colButtonName;
						
						inputHtml += "' onclick=\"DisplayView.viewDoc(this, '"+docId+"','"+docFormid+"','"+tdAttrs.isSignatureExist+"','"+tdAttrs.colTemplateForm+"')\" ";
						inputHtml += "/>";
						
						tdHtml += inputHtml;
						
					}else if("COLUMN_TYPE_OPERATE" == tdAttrs.colType && ColumnOperaType.BUTTON_TYPE_SCRIPT == tdAttrs.colButtonType){
						var inputHtml = "<input type=button value='" + tdAttrs.colButtonName;

						inputHtml += "' onclick=\"runscript('"+docId+"','"+tdAttrs.colId+"')\" ";
						inputHtml += "/>";
						
						tdHtml += inputHtml;
						
					}else if("COLUMN_TYPE_OPERATE" == tdAttrs.colType && ColumnOperaType.BUTTON_TYPE_JUMP == tdAttrs.colButtonType){
						var inputHtml = "<input type=button value='" + tdAttrs.colButtonName;

						inputHtml += "' onclick=\"jumptoform('"+tdAttrs.colMappingform+"',"+jumpMapping+",'"+tdAttrs.colButtonName+"')\" ";
						inputHtml += "/>";
						
						tdHtml += inputHtml;						
					}
					//logo列
					if("COLUMN_TYPE_LOGO" == tdAttrs.colType && tdAttrs.colIcon && tdAttrs.colIcon != ""){
						tdHtml += "<img style='' src='../../../lib/icon/" + tdAttrs.colIcon+ "'/>";
					}
					
					if(tdAttrs.fieldInstanceOfWordField){
						var btnHtml = "<img src='resource/images/view/word.gif'";						
						btnHtml += " onclick=\"showWordDialogWithView('"+tdAttrs.showword+"','WordControl','"+docId+"','"+result+"','"+tdAttrs.colFieldName+"',3,2,false,true)\" ></img>";
						
						tdHtml += btnHtml;					
					}else if(tdAttrs.fieldInstanceOfgenericWordField){//通用word控件
						var btnHtml = "<img src='resource/images/view/genericword.jpg'></img>";
						tdHtml += btnHtml;		
					}else if(tdAttrs.fieldInstanceOfMapField){
						var application = jQuery("body",parent.document).find("#application").val();
						var fieldVal = "";
						var displayType = 1;
						var f_id = docId + "_" + tdAttrs.colFieldName;
						var valhtml = tdAttrs.title == " "?"":"value = '" + tdAttrs.title + "'";
						var btnHtml = "<input type='hidden' id = '" + f_id + "' " + valhtml + ">";
						btnHtml += "<img src='../../share/images/view/map.png' style='margin: 0 5px;'";
						btnHtml += " onclick=\"FormBaiduMap('";
						btnHtml += f_id + "', '";
						btnHtml += application + "', '";
						btnHtml += displayType + "')\"";
						
						tdHtml += btnHtml;
					}else if (result && result.length == 0) {
						tdHtml += "&nbsp;";
					}
					tdHtml += "</td>";
				}
				
				return tdHtml;
			},//重构数据行td----end
			/**
			 * 重构表头
			 */
			toFirstTdHtml = function($tdField,i){
				var tdHtml = "";
				var thAttrs = {};
				thAttrs.upImg = "<img border=\"0\" src='../share/images/view/up.gif'/>";
				thAttrs.downImg = "<img border=\"0\" src='../share/images/view/down.gif'/>";
				
				thAttrs.colName = $tdField.attr("colName");
				thAttrs.colText = $tdField.attr("colText");
				thAttrs.isVisible = $tdField.attr("isVisible");
				thAttrs.isHiddenColumn = $tdField.attr("isHiddenColumn");
				thAttrs.colWidth = $tdField.attr("colWidth");
				thAttrs.colType = $tdField.attr("colType");
				thAttrs.colFieldName = $tdField.attr("colFieldName");
				thAttrs.isOrderByField = $tdField.attr("isOrderByField");
				thAttrs.isVisible = (thAttrs.isVisible == "true")?true:false;
				thAttrs.isHiddenColumn = (thAttrs.isHiddenColumn == "true")?true:false;
				thAttrs.colWidth = (thAttrs.colWidth == "null") ? "" : thAttrs.colWidth;
				if(thAttrs.isVisible && !thAttrs.isHiddenColumn){
					if(thAttrs.colWidth != "0"){
						if(thAttrs.colWidth != ""){
							isSetWidth = true;
						}
						if(i>2){
							i++;
							tdHtml += "<th colFieldName=\"" + thAttrs.colFieldName + "\" isOrderBy=\"" + thAttrs.isOrderByField + "\" isVisible=\"" + thAttrs.isVisible + "\" isHiddenColumn=\"" + thAttrs.isHiddenColumn + "\" class=\"" + Setting.TH_TD_CLASS + "\" data-priority='6'>"+thAttrs.colText+"</th>";
						}else {
							tdHtml += "<th colFieldName=\"" + thAttrs.colFieldName + "\" isOrderBy=\"" + thAttrs.isOrderByField + "\" isVisible=\"" + thAttrs.isVisible + "\" isHiddenColumn=\"" + thAttrs.isHiddenColumn + "\" class=\"" + Setting.TH_TD_CLASS + "\" data-priority='1'>"+thAttrs.colText+"</th>";
						}
					}else{
						tdHtml = "<th colFieldName=\"" + thAttrs.colFieldName + "\" isOrderBy=\"" + thAttrs.isOrderByField + "\" isVisible=\"" + thAttrs.isVisible + "\" isHiddenColumn=\"" + thAttrs.isHiddenColumn + "\" class=\"" + Setting.TH_TD_CLASS + "\" style=\"display:none;\">" + thAttrs.colName + "</th>";
					}
//				}else{
//					tdHtml = "<th isVisible=\"" + thAttrs.isVisible + "\"  isHiddenColumn=\"" + thAttrs.isHiddenColumn + "\" class=\"" + Setting.TH_TD_CLASS + "\" style=\"display:none;\">" + thAttrs.colName + "</th>";
				}
				
				var $tdHtml = jQuery(tdHtml);
				
				if(thAttrs.colType == "COLUMN_TYPE_FIELD"){
					if(_sortCol != "null"){
						if(_sortCol != "" && _sortCol.toUpperCase() == thAttrs.colFieldName.toUpperCase()){
							if(_sortStatus == "ASC"){
								$tdHtml.append(thAttrs.upImg);
							}else if(_sortStatus == "DESC"){
								$tdHtml.append(thAttrs.downImg);
							}
						}
						$tdHtml.bind("click",function(){
							DisplayView.sortTable(this,thAttrs.colFieldName);
						});
					}else{
						if(thAttrs.isOrderByField != "null" && thAttrs.isOrderByField != "" && thAttrs.isOrderByField == "true"){
							//可排序图标
							if(_sortStatus == "ASC"){
								$tdHtml.append(thAttrs.upImg);
							}else if(_sortStatus == "DESC"){
								$tdHtml.append(thAttrs.downImg);
							}
							$tdHtml.bind("click",function(){
								DisplayView.sortTable(this,thAttrs.colFieldName);
							})
						}
					}
				}				
				return $tdHtml;
			};//重构表头----end
			//根据列文本显示方式的配置，截取文本
			truncationText = function(input,displayType,displayLength,isShowIcon){
				if(displayType == Column.DISPLAY_PART && !isShowIcon){
					if(displayLength.match("\\d+") && displayLength < input.length){
						return input.substring(0,displayLength) + "...";
					}
				}
				return input;
			};
			
			var $field = jQuery(this);
			var _sortCol = $field.attr("_sortCol");
			var _sortStatus = $field.attr("_sortStatus");
			var isSum = $field.attr("isSum");
			isSum = (isSum == "true")?true:false;
			var $tableHtml = jQuery("<table data-column-btn-text=\"显示列\" class=\"table-column-toggle ui-responsive table-stroke\" data-role=\"table\" data-mode=\"columntoggle\"></table>");
			var sumTrIsHidden = true;

			//判断是否输出汇总行
			$field.find("#sumTrId").find("td").each(function(){
				if(jQuery(this).attr("isSum") == "true" || jQuery(this).attr("isTotal") == "true"){
					sumTrIsHidden = false;
					return;
				}
			});
			
			$field.children().children().each(function(i){//行<tr>
				var $trHtml = "";
				var $trField = jQuery(this);
				
				if(i == 0){//首行（列头）
					var $head = $("<thead></thead>");
					$trHtml = jQuery("<tr class=\"" + Setting.TH_CLASS + "\"></tr>");
					//首列
					var tdHtml = "";
					tdHtml = "<th class=\"" + Setting.TH_FIRST_TD_CLASS + "\" scope=\"col\"></th>";
					var inputHtml = "";
//						inputHtml += "<input type=\"checkbox\">";
					jQuery(tdHtml).append(jQuery(inputHtml).bind("click",function(){
						selectAll(this.checked);
					})).appendTo($trHtml);
					//其他列
					$trField.children().each(function(i){//单元格<td>
						var $tdField = jQuery(this);
						
						//根据列头的显示隐藏值设置数据行对应列的显示和隐藏值
						$field.find("tr:gt(0)").each(function(){
							$(this).find(" td:eq("+i+")").attr("isHidden", $tdField.attr("isHiddenColumn"));
						});
						
						$trHtml.append(toFirstTdHtml($tdField,i));
					});
					$tableHtml.append($head.append($trHtml));
					$trHtml = null;
					$head = null;
					
				}else if(isSum && !sumTrIsHidden && (i == $field.children().children().size()-1)){//末行(字段值汇总)
					$trHtml = jQuery("<tr class=\"" + Setting.TR_CLASS + "\" >");
					//首列
					var tdHtml = "<th class=\"" + Setting.TR_FIRST_TD_CLASS + "\">";
					tdHtml += "&nbsp;</th>";
					$trHtml.append(tdHtml);
					//其他列
					$trField.children().each(function(i){//单元格<td>
						var tdHtml = "";
						var $tdField = jQuery(this);
						var sumTdAttrs = {};
						sumTdAttrs.isVisible = $tdField.attr("isVisible");
						sumTdAttrs.isHiddenColumn = $tdField.attr("isHiddenColumn");
						sumTdAttrs.isSum = $tdField.attr("isSum");
						sumTdAttrs.isTotal = $tdField.attr("isTotal");
						sumTdAttrs.colName = $tdField.attr("colName");
						sumTdAttrs.sumByDatas = $tdField.attr("sumByDatas");
						sumTdAttrs.sumTotal = $tdField.attr("sumTotal");
						sumTdAttrs.isVisible = (sumTdAttrs.isVisible == "true")?true:false;
						sumTdAttrs.isHiddenColumn = (sumTdAttrs.isHiddenColumn == "true")?true:false;
						sumTdAttrs.isSum = (sumTdAttrs.isSum == "true")?true:false;
						sumTdAttrs.isTotal = (sumTdAttrs.isTotal == "true")?true:false;
						
						if(sumTdAttrs.isVisible && !sumTdAttrs.isHiddenColumn){
							tdHtml += "<td class=\"" + Setting.TR_TD_CLASS + "\" >";
							if(sumTdAttrs.isSum || sumTdAttrs.isTotal)
								tdHtml += sumTdAttrs.colName;
							if(sumTdAttrs.isSum){
								tdHtml += sumTdAttrs.sumByDatas + "&nbsp;";
							}
							if(sumTdAttrs.isTotal){
								tdHtml += sumTdAttrs.sumTotal + "&nbsp;";
							}
							tdHtml += "</td>";
						}
						$trHtml.append(tdHtml);
					});
					$tableHtml.append($trHtml);
					$trHtml = null;
				}else if($trField.attr("trType") =="dataTr"){//数据行
					var dtrHtml = "<tr class=\"" + Setting.TR_CLASS + "\">";
					//首列
					var docId = $trField.attr("docId");
					var tdHtml =  "<th class=\"" + Setting.TR_FIRST_TD_CLASS + "\">";
						tdHtml += "<input data-enhance='false' type=\"checkbox\" name=\"_selects\" value=\"" + docId + "\"/>";

						tdHtml += "</th>";
					dtrHtml += tdHtml;
					$trField.children().each(function(j){//单元格<td>
						var $tdField = jQuery(this);
						//其他列
						dtrHtml += toDataTdHtml($tdField, i);//重构数据单元格
					});
					
					dtrHtml += "</tr>";
					$tableHtml.append(dtrHtml);
					dtrHtml = "";
				}
			});
			
			var $viewID = ajaxPage.getCurPage().find("#view_"+$dvid);
			$tableHtml.attr("id","tableList_"+$dvid);
			$tableHtml.appendTo($viewID);
			if($tableHtml.find(".listDataTr").size()<= 0){
				var contentIsNum = "<div class='content-load-panel'><div class='contentIsNull'></div></div>";
				$viewID.append($(contentIsNum));
			}
			$field.remove();
			tableListColumn();
		});
	};
})(jQuery);



/**
 * jquery重构列表视图
 * for:列表视图
 */
function jqRefactor4DisplayView(){
	jQuery("table[moduleType='viewList']").obpmDisplayView();
	var $subPage = ajaxPage.getCurPage();
	$subPage.find("#searchFormTableSub").html($subPage.find('#searchFormTable').html());
	jqRefactor();
}

/**
 * 
 * @param url
 * @param id
 * @param isQueryButton: 是否查询按钮，子表查询时为tru，子表页面加载时为undefined
 */
function refreshDisplayView(url, id, isQueryButton){
	//获取查询表单数据作为load的参数
	var param = {};
	if(isQueryButton){
		param["isQueryButton"] = isQueryButton;
	}
	var $searchFormTable = ajaxPage.getCurPage().find("#searchFormTableSub");
	if($searchFormTable.size() > 0){
		$searchFormTable.find("input,select,textarea").not("#dy_refreshObj").each(function(){
			param[$(this).attr("name")] = $(this).val();
		});
	}
	ajaxPage.reloadPage(url,param,function(){
		Activity.showMessage(ajaxPage.getCurPage().find("#msg").html(), "error");
		var $tabParameter = ajaxPage.getCurPage().find(".tab_parameter_Display");
		var viewid = id + "_params";
		var $viewDiv = $("<div></div>").attr("id",id+"_params").attr("_action",url).css("display","none");
		//表单元素转成span标签存入dom中
		$.each($tabParameter.find("input[type!=button],select,textarea").serializeArray(),function(){
			$viewDiv.append("<span name='" + this.name + "'>" + this.value + "</span>"); 
		});
	
		//去掉表单元素
		$tabParameter.find("input[type!=button],select,textarea").each(function(){
			if(!$(this).attr("moduleType")) $(this).remove();
		});
		
		ajaxPage.getCurPage().find("title").attr("id",id);
		ajaxPage.getCurPage().append($viewDiv);
		
		//刷新时设置表单包含元素控件badge数字
		var _rowcount = $viewDiv.find("span[name='_rowcount']").text();
		$("[name='display_view']").each(function(){
			if($(this).attr("id") == id){
				$(this).includedView("refresh");
				if(_rowcount == ""){
					_rowcount = 0;
				}
				$(this).find(".weui-cell__ft").find(".weui-badge").text(_rowcount);
			}
		});
		
		setTimeout(function(){
			hideLoadingToast();
		},1000)
		
//		jqRefactor();
		//initDispComm();
	});
}

//子表翻页
function turnPage(act,obj){
	showLoadingToast();
	var url = DisplayView.actPagination(act,obj);
	var id = ajaxPage.getCurPage().find("title").attr("id");
	var isQueryButton = ajaxPage.getCurPage().find("title").attr("isQueryButton");
	refreshDisplayView(url,id,isQueryButton);
}

//===============================重构包含元素去掉iframe改用div--start

/**
* 子视图执行框架
*/
var DisplayView = {
	
	bindEven : function(){
		var $curPage = ajaxPage.getCurPage();
		//点击查询按钮展开查询表单
		$curPage.find(".searchForm_sub").unbind().bind("click", function(){	
			var $subPage = ajaxPage.getCurPage();
			//$subPage.find("#searchFormTableSub").html($subPage.find('#searchFormTable').html());
			//jqRefactor();
			$subPage.find(".searchPanel_sub").addClass("active");
			ajaxPage.addHashPostfix("_searchForm");
		});
		//查询表单界面关闭按钮
		$curPage.find(".searchPanel_sub #btn-modal-close").unbind().bind("click", function(){	
			var $subPage = ajaxPage.getCurPage();
			$subPage.find(".searchPanel_sub").removeClass("active");
			ajaxPage.clearHashPostfix("_searchForm");
		});
		//查询
		$curPage.find(".sub_modifyActionBack").unbind().bind("click",function(){
			var $subPage = ajaxPage.getCurPage();
			$subPage.find(".searchPanel_sub").removeClass("active");
			ajaxPage.clearHashPostfix("_searchForm");
			var url = $subPage.attr("href");
			var id = $subPage.find("title").attr("id");
			var isQueryButton = $subPage.find("title").attr("isQueryButton");
			refreshDisplayView(url, id, isQueryButton);
		});
		//重置
		$curPage.find(".sub_resetAll").unbind().bind("click",function(){
			//if(window.location.hash == "#_searchForm"){
			if(window.location.hash.indexOf("/_searchForm") >= 0){
				DisplayView.reset(this);
	    	}
		});
	},
	//返回子表翻页url
	actPagination : function(act,obj){
		var $thisTab =  ajaxPage.getCurPage();
		var viewId = $thisTab.find("title").attr("id")
		var $pageParameter = $thisTab.find("#"+ viewId + "_params");
		var $_currpage = parseInt($pageParameter.find("span[name='_currpage']").text()),
			$_pagelines = parseInt($pageParameter.find("span[name='_pagelines']").text()),
			$_rowcount = parseInt($pageParameter.find("span[name='_rowcount']").text());
		var totalPage = Math.ceil($_rowcount/$_pagelines);
		
		switch (act){
		case "showNextPage":
			return $thisTab.attr("href")+"&_currpage="+($_currpage+1);
			break;
		case "showFirstPage":
			return $thisTab.attr("href")+"&_currpage=1";
			break;
		case "showPreviousPage":
			return $thisTab.attr("href")+"&_currpage="+($_currpage-1);
			break;
		case "showLastPage":
			return $thisTab.attr("href")+"&_currpage="+totalPage;
			break;
		default:
			break;
		}	
	},
	/**
	 * 是否子页面
	 * @param obj
	 * @returns {Boolean}
	 */
	isSubPage : function(obj){
		//return (typeof ($(obj).parents("div[name='display_view']")[0]) == "object");
		return (ajaxPage.getCurPage().find("title").attr("title") == "displayView");
	},
	
	/**
	 * @param obj
	 * @returns 子表视图Div的js对象
	 */
	getTheView : function(obj){
		var title = ajaxPage.getCurPage().find("title").attr("title");
		return (title == "listView" ? false : ajaxPage.getCurPage());
	},
	//返回原来form中的action属性值
	getAction : function(obj){
		var view = DisplayView.getTheView(obj);
		return $(view).find("#"+$(view).attr("id") + "_params").attr("_action");
	},
	//获取存在dom中的参数，以json格式返回
	span2Json : function(obj){
		var view = DisplayView.getTheView(obj);
		var json = {};
		$(view).find("#"+$(view).find("title").attr("id") + "_params span").each(function(){			
		//$(view).find(".tab_parameter_Display>input").each(function(){
			var name = $(this).attr("name");
			//var val = $(this).val();
			var val = $(this).text();
			if(!json[name] || json[name] == ''){
				json[name] = val;
			}else {
				json[name] += ';' + val;
			}
		});
		return json;
	},
	//在json对象中添加元素值
	addVal2Params : function(json, elems){
		var params = '';
		params = this.json2Params(json);
		$(elems).each(function(){
			var name = this.name;
			var val = this.value;
			if(params == ''){
				params = name + '=' + val;
			}else {
				params += '&' + name + '=' + val;
			}
		});
		return params;
	},
	//获取存在dom中的参数，以params字符串返回
	span2Params : function(obj){
		var view = DisplayView.getTheView(obj);
		var params = '';
		$(view).find("#"+$(view).attr("id") + "_params span").each(function(){
			var name = $(this).attr("name");
			var val = encodeURIComponent($(this).text());
			if(params == ''){
				params = name + '=' + val;
			}else {
				params += '&' + name + '=' + val;
			}
		});
		$(view).find("input[name='_selects']:checked").each(function(){
			var name = $(this).attr("name");
			var val = $(this).val();
			if(params == ''){
				params = name + '=' + val;
			}else {
				params += '&' + name + '=' + val;
			}
		});
		return params;
	},
	//获取存在dom中的参数，以params字符串返回
	input2Span : function(){	
		var $tabParameter = ajaxPage.getCurPage().find(".tab_parameter_Display");
		var viewid = id + "_params";
		var $viewDiv = $("<div></div>").attr("id",id+"_params").attr("_action",url).css("display","none");
		//表单元素转成span标签存入dom中
		$.each($tabParameter.find("input[type!=button],select,textarea").serializeArray(),function(){
			$viewDiv.append("<span name='" + this.name + "'>" + this.value + "</span>"); 
		});
	
		//去掉表单元素
		$tabParameter.find("input[type!=button],select,textarea").each(function(){
			if(!$(this).attr("moduleType")) $(this).remove();
		});

		ajaxPage.getCurPage().find("title").attr("id",id);
		ajaxPage.getCurPage().append($viewDiv);
	},
	//获取存在dom中的参数，以params字符串返回
	refreshSpan : function(obj,name,val){
		var view = DisplayView.getTheView(obj);
		$(view).find("span[name=" + name + "]").each(function(){
			$(this).text(val);
		});
	},
	//把json转换成params字符串
	json2Params : function(json){
		var params = '';
		$.each(json,function(name,val){
			val = encodeURIComponent(val);
			if(params == ''){
				params = name + '=' + val;
			}else {
				params += '&' + name + '=' + val;
			}
		});
		return params;
	},
	//触发重计算
	doCalculation : function(container){
		var isrefreshonchanged = $(container).attr('isrefreshonchanged');
		if(isrefreshonchanged == true || isrefreshonchanged=='true'){
			var name = $(container).attr('getName');
			dy_refresh(name);
		}
	},
	//刷新页面内容
	refreshPage : function(obj,container,html){
		var $this = DisplayView.getTheView(obj);
		var $html = $("<div></div>").append(html);
		var $form = $html.find(".tab_parameter_Display");
		var _includeId = $this.id;
		var includeId = _includeId + "_params";
		var $viewDiv = $("<div></div>").attr("id",includeId).attr("_action",$form.attr("action")).css("display","none");

		//表单元素转成span标签存入dom中
		$.each($form.find("input[type!=button],select,textarea").serializeArray(),function(){
			$viewDiv.append("<span name='" + this.name + "'>" + this.value + "</span>"); 
		});
		$html.append($viewDiv);
		//去掉表单元素
		$form.find("input[type!=button],select,textarea").each(function(){
			if(!$(this).attr("moduleType")) $(this).remove();
		});
		//插入dom中
		$(container).html($html.html());
		if(typeof(initDispComm)=='function'){
			initDispComm();	//子视图公用初始化方法
			this.doCalculation(container);	//执行刷新重计算方法
		}
	},
	//ajax提交
	postForm : function(obj,url,json){
		$.ajax({
			type : 'POST',
			url : url,
			async : false,
			dataType : 'html',
			data : json,
			context : this.getTheView(obj),
			success : function(html){
				DisplayView.refreshPage(obj,this,html);
			}
		});
	},
	//把json数据转成dom元素(导出Excel时模拟form提交)
	json2Textarea : function(json) {
		var html = '';
		$.each(json,function(name,val){
			html += '<textarea name="'+name+'">'+val+'</textarea>';
		});
		return html;
	},
	//文件下载
	downloadFile : function(url,json){
		$('<form></form>').attr('method','post').attr('action',url).append(this.json2Textarea(json)).submit().remove();
	},
	//打印预览
	printView : function(url,json){
		$('<form></form>').attr('action',url).attr('target','_my_submit_win').append(this.json2Textarea(json)).submit();
	},
	//打开查询页面
	openSearch : function(obj){
		var $div = $('<div id="searchFormTableSub"></div>').append($('#searchFormTable').html());
		artDialog({
			content:$('<div></div>').append($div).html(),
			lock:true,
			width:800,
			height:150,
			okVal:'查询'
		    },
		    function(){
		    	DisplayView.search(obj);
		    },
		    function(){
		    	//取消
		    }
		);
	},
	//查询按钮
	search : function(obj){
		var $subPage = obj.parents("[type='includedView']");
		var json = this.span2Json(obj);
		json['_currpage'] = 1;	//重置页码
		//添加控件参数
		$subPage.find("#searchFormTableSub").find("input,select,textarea").each(function(){
			json[this.name] = this.value;
		});
		var url = contextPath + "/portal/dynaform/view/displayView.action";
		this.postForm(obj,url,json);
	},
	//重置按钮
	reset : function(obj){
		var $subPage = ajaxPage.getCurPage();
		$subPage.find('#searchFormTableSub').find("input,select,textarea").each(function(){
			$(this).val("");
			$(this).text("");
		});
	},
	// 改变排序状态
	changeStatus : function(json, oCol, nCol) {
		if (oCol != nCol && oCol.toUpperCase() != nCol.toUpperCase()) {
			json['_sortStatus'] = "ASC";
			json['_sortCol'] = nCol;
		} else {
			if (json['_sortStatus'] == "ASC") {
				json['_sortStatus'] = "DESC";
				json['_sortCol'] = nCol;
			} 
			else {
				json['_sortStatus'] = "ASC";
				json['_sortCol'] = nCol;
			}
		}
		return json;
	},
	//单击列头排序
	sortTable : function(obj,nColName) {
		var json = this.span2Json(obj);
		var oColName = json['_sortCol'];
		json = this.changeStatus(json, oColName, nColName);
		var url = $(DisplayView.getTheView(obj)).attr("src");		
		this.postForm(obj,url,{"_sortStatus":json['_sortStatus'],"_sortCol":json['_sortCol']});
	},
	//设置按钮为灰色且不能再操作
	toggleButton : function(obj,btnName) {
		var theBody = this.getTheBody(obj);
		var isBreak = false;
		var button_acts = $(theBody).find('[name=btnName]');
		$(theBody).find('[name=btnName]').each(function(){
			if($(this).attr("isLoad") == "false"){
				isBreak = true;
			}else{
				$(this).attr('isLoad','false');
				$(this).css('color','gray');
			}
		});
		return isBreak;
	},
	//获取选中的行数据
	getCheckedListStr : function(obj,fldName) {
		var view = this.getTheView(obj);
		var rtn = '';
		var flds = $(view).find('[name='+fldName+']');
		$(view).find('[name='+fldName+']').each(function(){
			if($(this).attr('type') == 'checkbox' || $(this).attr('type') == 'radio'){
				if (this.checked && this.value) {
					if(rtn==''){
						rtn += this.value;
					}else {
						rtn += ';' + this.value;
					}
				}
			}else{
				rtn = this.value;
			}
		});
		return rtn;
	},
	//获取选中值
	getValuesMap : function(obj,json) {
		var valuesMap = {};
		var mapVal = "";
		var mapVals = new Array();
		var view = this.getTheView(obj);
		if ($(view).find('[name=_selects]')) {
			var selects = this.getCheckedListStr(obj,'_selects');
			json['_selectsText'] = selects ? selects : '';
		}
		return this.json2Params(json);
	},
	addSearchFormParams : function(obj,json){
		var view = this.getTheView(obj);
		$(view).find("#searchFormTable").find("input,select,textarea").each(function(){
			json[this.name] = this.value;
		});
		return json;
	},
	//重置backurl
	resetBackURL : function(obj,_backURL){
		var view = this.getTheView(obj);
		//添加控件参数
		var isHasAdd = false;	//url是否已添加参数
		if(_backURL!='' && (_backURL.indexOf('&')>=0 || _backURL.indexOf('?')>=0)){
			isHasAdd = true;
		}
		$(view).find("#searchFormTable").find("input,select,textarea").each(function(){
			if(isHasAdd){
				_backURL += "&";
			}else{
				_backURL += "?";
				isHasAdd = true;
			}
			_backURL += this.name + "=" + this.value;;
		});

		return _backURL;
	},
	//获取选中的列表数据
	getSelects : function(view){
		var oSelects = $(view).find("[name='_selects']");
		var _selects="";
		if(oSelects){
			for(var i=0;i<oSelects.length;i++){
				if(oSelects[i].checked){
					_selects+="&_selects="+oSelects[i].value;
				}
			}
		}
		return _selects;
	},
	//查看数据子方法
	viewDocSub : function(obj,action, title, viewType, actid) {
		var openType = OPEN_TYPE_DIV;	//全部使用弹出层方式打开
		var view = this.getTheView(obj);
		var flag = false;
		var _action = this.getAction(obj);
		var json = this.span2Json(obj);
		//执行前脚本
		if(actid){
			jQuery.ajax({
				type: 'POST',
				async:false, 
				url: contextPath + '/portal/dynaform/activity/runbeforeactionscript.action?_actid=' + actid,
				dataType : 'html',
				timeout: 3000,
				data: json,
				success:function(result) {
					if(result != null && result != ""){
			        	var jsmessage = eval("(" + result + ")");
			        	var type = jsmessage.type;
			        	var content = jsmessage.content;
			        	
			        	if(type == '16'){
			        		this.postForm(obj,_action,json);
			        	}
			        	
			        	if(type == '32'){
			        		var rtn = window.confirm(content);
			        		if(!rtn){
				        		this.postForm(obj,_action,json);
			        		}else {
			        			flag = true;
			        		}
			        	}
			        }else {
			        	flag = true;
			        }
				},
				error: function(result) {
					alert("运行脚本出错");
				}
			});
		} else {
			flag = true;
		}

		if(flag){
			var url = action;
		
			if (viewType == VIEW_TYPE_SUB) {
				url += "&isSubDoc=true";
			}
			
			json['_backURL'] = this.resetBackURL(obj,json['_backURL']);	//添加查询表单中的参数
			this.addSearchFormParams(obj,json);	//添加查询表单中的参数
			
			var _json = json;
			var _backURL = json['_backURL'];
			delete json['_backURL'];
			
			var parameters = this.getValuesMap(obj,json);
		
			if (openType == OPEN_TYPE_DIV) {
				var oSelects = $(view).find("[name='_selects']");
				var _selects="";
				if(oSelects){
					for(var i=0;i<oSelects.length;i++){
						if(oSelects[i].checked){
							_selects+="&_selects="+oSelects[i].value;
						}
					}
				}
				url += "&" + parameters + "&openType=" + openType+_selects;
				ajaxPage.getSubViewFormHash(url);
			}
		}
	},
	//查看数据
	viewDoc : function(obj,docid, formid ,signatureExist,templateForm,isEdit,instanceId,nodeId) {
		// 查看/script/view.js
		var url = docviewAction;
		url += '?_docid=' + docid;
		if (formid) {
			url += '&_formid=' +  formid;
		}
		if (templateForm) {
			url += '&_templateForm=' +  templateForm;
		}
//		if(signatureExist){
//			url += '&signatureExist=' +  signatureExist;
//		}
		if(isedit){
			url += '&isedit=' +  isedit+"";
			//url += '&show_act=' +  isedit+"";
			
		}
		if(instanceId){
			url += '&_targetInstance=' +  instanceId;
		}
		if(nodeId){
			url += '&_targetNode=' +  nodeId;
		}
		this.viewDocSub(obj,url,selectStr, VIEW_TYPE_SUB);
	}
};


//===============================重构包含元素去掉iframe改用div--end; 
/**
 * 操作按钮执行框架
 * <p>框架主要封装操作按钮的执行流程，和一些通用操作接口，在执行过程中，具体的行为实现由具体的按钮类型实例完成</p>
 * @author Happy
 */
var Activity ={
		
		_LOCK:false,//操作按钮触发锁，用于避免多次触发执行
		
		/**
		 * 触发按钮点击动作
		 * @param actId
		 * 		操作id
		 * @param actType
		 * 		操作类型代码
		 * @param params
		 * 		额外参数设置
		 */
		doExecute:function(actId,actType,params){
			var activityType = null;//操作类型实例
			switch (actType) {
			case 1://载入视图
				activityType = new QueryBtn(actId,params);
				break;
			case 2://新建
				activityType = new CreateBtn(actId,params);
				break;
			case 3://删除
				activityType = new DeleteBtn(actId,params);
				break;
			case 4://保存并启动流程
				activityType = new SaveStartWorkflow(actId,params);
				break;
			case 5://流程处理
				activityType = new WorkflowProcess(actId,params);
				break;
			case 8://关闭窗口
				activityType = new CloseWindowBtn(actId,params);
				break;
			case 9://保存并关闭窗口
				activityType = new SaveCloseWindowBtn(actId,params);
				break;
				case 10://返回
				activityType = new BackBtn(actId,params);
				break;
			case 11://保存并返回
				activityType = new SaveBackBtn(actId,params);
				break;
			case 13://无类型
				activityType = new NoneBtn(actId,params);
				break;
			case 14://html打印
				activityType = new HtmlPrintBtn(actId,params);
				break;
			case 16://导出excel
				activityType = new ExportToExcelBtn(actId,params);
				break;
			case 15://html打印(带流程历史)
				activityType = new HtmlPrintWithHisBtn(actId,params);
				break;
			case 18://清空数据
				activityType = new ClearAllBtn(actId,params);
				break;
			case 19://保存草稿（不校验）
				activityType = new SaveWithoutValidateBtn(actId,params);
				break;
			case 20://批量提交
				activityType = new BatchApproveBtn(actId,params);
				break;
			case 21://保存并复制
				activityType = new SaveCopyBtn(actId,params);
				break;
			case 25://导出pdf
				activityType = new ExportToPdfBtn(actId,params);
				break;
			case 26://文件下载
				activityType = new FileDownloadBtn(actId,params);
				break;
			case 27://文件下载
				activityType = new ExcelImportBtn(actId,params);
				break;
			case 28://电子签章
				activityType = new SignatureBtn(actId,params);
				break;
			case 29://批量电子签章
				activityType = new BatchSignatureBtn(actId,params);
				break;
			case 30://自定义打印（套打）
				activityType = new FlexPrintBtn(actId,params);
				break;
			case 33://启动流程
				activityType = new StartWorkflow(actId,params);
				break;
			case 34://保存
				activityType = new SaveBtn(actId,params);
				break;
			case 36://打印视图
				activityType = new PrintViewBtn(actId,params);
				break;
			case 37://通过手机邮件转发
				activityType = new TranspondBtn(actId,params);
				break;	
			case 42://保存并新建
				activityType = new SaveNewBtn(actId,params);
				break;
			case 43://跳转
				activityType = new JumpToBtn(actId,params);
				break;
			case 45://归档
				activityType = new ArchiveBtn(actId,params);
				break;
			default:
				
				break;
			}
			if(!activityType) return;
			
			Activity.doBefore(activityType);
			
		},
		
		/**
		 * 执行前操作
		 * @param activityType
		 * 		操作类型实例
		 * @returns {Boolean}
		 */
		doBefore : function(activityType){

			if(Activity._LOCK) return;
			
			Activity._LOCK = true;
			showLoadingToast();
			setTimeout(function(){
				//一分钟后自动释放锁
				Activity._LOCK = false;
				hideLoadingToast();
			}, 60*1000);
			
			if(activityType.doBefore){//按钮动作执行前的准备与校验操作
				if(!activityType.doBefore()) {
					Activity._LOCK = false;
					hideLoadingToast();
					return;
				}
			}
			
			//refreshTickets为局部刷新时暂存刷新控件id的数组
			//初始化于obpm.form.util.js文件
			if(refreshTickets.length > 0){
				Activity.showMessage("页面准备中","error");
				return;
			}

			var flag = false;//执行完脚本后,是否进行下一步提交
			jQuery.ajax({
				type: 'POST',
				async:false, 
				url: contextPath + '/portal/dynaform/activity/runbeforeactionscript.action?_actid=' + activityType.actId,
				dataType : 'text',
				data: activityType.getBeforePostData(),
				success:function(result) {
					if(result != null && result != ""){
						result = result.replace(/\n/g,"<br/>");
						result = result.replace(/\r/g,"<br/>");
			        	var jsmessage = eval("(" + result + ")");
			        	var type = jsmessage.type;
			        	var content = jsmessage.content;
			        	
			        	if(type){
			        		if(type == '16'){
				        		//alert(content);
			        			Activity.showMessage(content,"error");
				        		flag = false;
				        	}
				        	
				        	if(type == '32'){
				        		var rtn = window.confirm(content);
				        		if(!rtn){
				        			flag = false;
				        		}else {
				        			flag = true;
				        		}
				        	}
			        	}else {
			        		flag = true;
			        	}
			        	
			        	if(flag){
			        		var changedField = jsmessage.changedField;
			        		if( typeof(changedField) != "undefined" && changedField != null && changedField.length > 0){
			        			for(var i=0; i<changedField.length; i++){
			        				var field = changedField[i];
				        			for(var key in field)	{
				        				if(ajaxPage.getParamsByName(key).length>0){
				        					ajaxPage.getParamsByName(key)[0].value = field[key];
				        				}
				        			}
			        			}
			        		}
			        	}
			        }else {
			        	flag = true;
			        }
				},
				error: function(XMLHttpRequest, textStatus, errorThrown) {
					Activity._LOCK = false;
					hideLoadingToast();
					if(XMLHttpRequest.readyState == 0){
						Activity.showMessage("网络已断开！","error");
						Activity.refreshForm();
					}else{
						Activity.showMessage(errorThrown.message,"error");
					}
				}
			});
			if(!flag){
				Activity._LOCK = false;
				hideLoadingToast();
			}else{
				Activity.doAction(activityType);
			}
		},
		/**
		 * 执行按钮操作
		 * @param activityType
		 * 		操作类型实例
		 */
		doAction:function(activityType){
			if(activityType.doAction){
				//按钮动作时执行的其他业务操作
				if(!activityType.doAction()) {
					Activity._LOCK = false;
					hideLoadingToast();
					return;
				}
			}
			
			//refreshTickets为局部刷新时暂存刷新控件id的数组
			//初始化于obpm.form.util.js文件
			if(refreshTickets.length > 0){
				Activity.showMessage("页面准备中","error");
				return;
			}
			
			jQuery.ajax({
				type: 'POST',
				async:true, 
				url: contextPath + '/portal/dynaform/activity/execute.action?_activityid=' + activityType.actId,
				dataType : 'json',
				data: activityType.getActionPostData(),
				success:function(result) {
					if(result.status==1){
						if(result.message && result.message.length>3){
							Activity.showMessage(result.message,"info");
						}
						switch (result.data.resultType) {//结果处理类型
						case "form":
							if(activityType.actType!=13){//非自定义按钮可刷新表单
								Activity.refreshForm(activityType);
							}
							break;
						case "view":
							Activity.refreshView(activityType);
							break;
						case "back":
//							var backUrl = $("#_backURL").val();
//							ajaxPage.history.go();
//							if(backUrl && backUrl.length>0){
////								window.location.href = backUrl;
//								history.back();
//							}else{
//								var opentype = $("input[name='openType']").val();
//								if("277"==opentype || "16"==opentype){//弹出层打开
////									Activity.closeWindow();
//									history.back();
//								}else{
//									history.back();
//								}
//								
//							}
							break;
						case "close":
//							ajaxPage.history.go();
//							var backUrl = $("#_backURL").val();
//							var opentype = $("input[name='openType']").val();
//							if(!opentype || ""==opentype){
//								if(backUrl && backUrl.length>0){
////									window.location.href = backUrl;
//									history.back();
//								}
//								return;
//							}
//							Activity.closeWindow();
							break;
						case "message":
							if(result.data.resultData.type==16){//alert
								Activity.showMessage(result.data.resultData.content,"error");
							}else if(result.data.resultData.type==32){//confirm
								
							}else if(result.data.resultData.type==1){//success
								Activity.showMessage(result.data.resultData.content,"success");
							}else if(result.data.resultData.type==2){//info
								Activity.showMessage(result.data.resultData.content,"info");
							}else if(result.data.resultData.type==3){//warning
								Activity.showMessage(result.data.resultData.content,"warning");
							}else if(result.data.resultData.type==4){//Error
								Activity.showMessage(result.data.resultData.content,"error");
							}
							Activity._LOCK = false;
							break;
						case "setParameter"://给activityType传参
							activityType.params.parameter = result.data.resultData;
							break;
						case "validate":
							var fieldErrors = result.data.resultData;
							var content = "";
							for(var name in fieldErrors){
								var fr = fieldErrors[name];
								for(var i in fr){
									var m = fr[i];
									content+=m+";";
								}
							}
							Activity.showMessage(content,"error");
							Activity._LOCK = false;
							hideLoadingToast();
							hideLoadingToast();
							return;
							break;
						case "exception":
							Activity.showMessage(result.data.resultData,"error",60*1000);
							return;
							break;

						default:
							break;
						}



						//按钮动作执行后的其他业务操作
						if(activityType.doAfter && typeof activityType.doAfter == "function"){
							activityType.doAfter(result.data);
						}
					}else{
						Activity.showMessage(result.message,"error");
					}
					Activity._LOCK = false;
					hideLoadingToast();
				},
				error: function(XMLHttpRequest, textStatus, errorThrown) {
					Activity._LOCK = false;
					hideLoadingToast();
					if(XMLHttpRequest.readyState == 0){
						Activity.showMessage("网络已断开！","error");
					}else{
						Activity.showMessage(errorThrown.message,"error");
					}
				}
			});


		},
		
		/**
		 * 刷新表单
		 * @param activityType
		 * 		操作类型实例
		 */
		refreshForm:function(activityType){
			jQuery.ajax({
				type: 'POST',
				async:true, 
				url: contextPath + '/portal/dynaform/activity/refreshForm.action',
				dataType : 'json',
				data: ajaxPage.getParams(),
				success:function(result) {
					if(result.status==1){
						var datas = result.data;
						var activityHtml = datas["activityHtml"];
						if(activityHtml){
//							$("#btn_flow_reminder").remove();
//							$(".flow-reminder-panel-node-list").empty();
							ajaxPage.getCurPage().find(".formActBtn").html(activityHtml);
						}
						var formHtml = datas["formHtml"];
						if(formHtml){
							//清理选项卡控件渲染的dom结构
							var $formHtml = ajaxPage.getCurPage().find("#_formHtml");
							var $formContiner = $formHtml.parents('#form_continer');
							var $formTab = $formContiner.siblings(".fix_top_panel").find("#form_tab");
							var $item1mobile = $formContiner.find('[data-id="item1mobile"]');
							$formTab.children().remove();
							$formContiner.children(':not(#div_button_box,[data-id="item1mobile"])').remove();
							if(!$item1mobile.hasClass('active')){
								$item1mobile.addClass('active')
							}
							ajaxPage.getCurPage().find("#_formHtml").html(formHtml);
						}
						//---
						showLoadingToast();//显示loading层
						//填充系统字段
						if(datas["systemFields"]){
							for(var n in datas["systemFields"]){
								ajaxPage.getCurPage().find("input[name='"+n+"']").val(datas["systemFields"][n]);
							}
						}
						
						//渲染流程处理人列表、流程状态标签、流程历史按钮
						if(datas["processorHtml"]){
							$("#processorHtml").html('<div class="processor"><b>'+datas["processorHtml"]+'</b></div>');
						}
						if(datas["flowStateHtml"]){
							$("#flowStateHtml").html('<div class="flowstate" onmouseover="showFlowState(\'flowstate\');"><b>'+datas["flowStateHtml"]+'</b></div>');
						}
						if(ajaxPage.getCurPage().find("input[name='content.stateid']").val().length>0){
							jQuery(".flowbtn").show();
						}
						initFormCommon();//表单公用的初始化方法
						//渲染流程提交按钮
						if(ajaxPage.getCurPage().find("input[activityType='5']")){
							FlowPanel.refreshFlowPanel("init");
						}
//						adjustDocumentLayout4form();//调整相关文档布局
						hideLoadingToast();//隐藏loading层
						
						//---
						/**
						if(callback && typeof callback == "function"){
							callback(result.data);
						}
						**/
					}else{
						Activity.showMessage(result.message,"error");
						Activity._LOCK = false;
					}

				},
				error: function(XMLHttpRequest, textStatus, errorThrown) {
					if(XMLHttpRequest.readyState == 0){
						Activity.showMessage("网络已断开！","error");
					}else{
						Activity.showMessage(errorThrown.message,"error");
					}
					Activity._LOCK = false;
				}
			});
		},
		
		/**
		 * 刷新视图
		 * @param activityType
		 * 		操作类型实例
		 */
		refreshView:function(activityType){
			alert("refreshView error");
			jQuery.ajax({
				type: 'POST',
				async:true, 
				url: contextPath + '/portal/dynaform/activity/refreshView.action',
				dataType : 'json',
				data: jQuery(document.forms[0]).serialize(),
				success:function(result) {
					if(result.status==1){
						var datas = result.data;
						var activityHtml = datas["activityHtml"];
						if(activityHtml){
							//$(".formActBtn").html(activityHtml);
						}
						var viewHtml = datas["viewHtml"];
						if(viewHtml){
							$("#viewHtml").html(viewHtml)
						}
						//---
						showLoadingToast();//显示loading层
						initListComm();	//列表视图公用初始化方法
						adjustDataIteratorSize();
						setTimeout(function(){
							listViewAdjustLayout();
						},10);	//调整当前窗口布局
						hideLoadingToast();//隐藏loading层
						
						//---
						/**
						if(callback && typeof callback == "function"){
							callback(result.data);
						}
						**/
					}else{
						Activity.showMessage(result.message,"error");
						Activity._LOCK = false;
					}
					Activity._LOCK = false;
				},
				error: function(XMLHttpRequest, textStatus, errorThrown) {
					if(XMLHttpRequest.readyState == 0){
						Activity.showMessage("网络已断开！","error");
					}else{
						Activity.showMessage(errorThrown.message,"error");
					}
					Activity._LOCK = false;
				}
			});
		},
		/**
		 * 返回
		 * @param activityType
		 * 		操作类型实例
		 */
		back:function(activityType){
			var _time = 0;
			if(activityType.actType == 11 || activityType.actType == 13){
				_time = 1000;
			}
					
			setTimeout(function(){
				history.go(-1);
//				var backUrl = $("#_backURL").val();
//				if(backUrl && backUrl.length>0){
//					window.location.href = backUrl;
//				}else{
//					var opentype = $("input[name='openType']").val();
//					if("277"==opentype || "16"==opentype){//弹出层打开
//						Activity.closeWindow();
//					}else{
//						history.back();
//					}
//					
//				}
			},_time);
		},
		/**
		 * 关闭窗口
		 */
		closeWindow:function() {
			
			if($("#myModalexample",parent.document).hasClass("active")){
				parent.MyPopup._modal.trigger("close");
				return;
			}
			
			
			var  view_id = ajaxPage.getCurPage().find("input[name='view_id']").val();
			if(parent){
			    var sub_divid  =parent.document.getElementById('sub_divid');
				var doc_obj = parent.document.getElementById(view_id);
				if (doc_obj) { // 本区域返回
					doc_obj.src= sub_divid.value;
					parent.ev_reloadParent();
					return;
				}
				
				if(parent.frames['main_iframe']){
					var viewiFrame = parent.frames['main_iframe'].frames['detail'].frames[view_id];
					if(viewiFrame){
						try{
						 	viewiFrame.ev_reload()
						 	hidden();
						}catch(ex){}
					}else{
					  parent.close();
					  parent.parentWindow.ev_reload();
					}
				}else{
				  OBPM.dialog.doExit();
				}
			} else {
				OBPM.dialog.doExit();
			}
		},
		
	    /**
		 * 显示消息提示
		 * @param msg
		 * 		消息内容
		 * @param type
		 * 		消息类型（'info','error'）
		 * @param hideAfter
		 * 		延时几秒后关闭消息窗体
		 */
		showMessage : function(msg, type,hideAfter) {
	    	if(!msg) return;
	    	window.showMessage(type,msg);
	    	hideLoadingToast();
	    	
	    	/**
		    var type = "undefined" == typeof type ? "info": type,
		    		hideAfter = "undefined" == typeof hideAfter ? 3 : hideAfter;//默认3秒停留时间
		    $._messengerDefaults = {
		        extraClasses: "messenger-fixed messenger-on-top",
		        theme: 'flat',
		        messageDefaults: {
		            showCloseButton: true,
		            hideAfter: hideAfter
		        }
		    },
		    $.globalMessenger().post({
		        message: msg,
		        type: type
		    });
		    **/
		},
//		makeAllFieldAble :function(elements) {
//			var fields = [];
//			if (!elements) {
//				elements = document.forms[0].elements;
//			}
//			for (var i = 0; i < elements.length; i++) {
//				var element = elements[i];
//				if (element.disabled == true) {
//					element.disabled = false;
//					fields.push(element);
//				}
//			}
//			
//			return fields;
//		},
		
//		setFieldDisabled : function(fields){
//			for (var i = 0; i < fields.length; i++) {
//				var element = fields[i];
//				if (element.disabled == false) {
//					element.disabled = true;
//				}
//			}
//			
//		},
		
		cache:{
			
		}
		
		
}; 
/**
 * 保存并提交流程操作
 * @author Happy
 */
function SaveStartWorkflow(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 4;
	
	
	if(typeof SaveStartWorkflow._initialized == "undefined"){
		
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		SaveStartWorkflow.prototype.getBeforePostData = function(){
//			var fields = Activity.makeAllFieldAble();
			jQuery("input[moduleType='surveyField']").obpmSurveyField("getValue");
			var data = ajaxPage.getParams();
//			Activity.setFieldDisabled(fields);
			return data;
		}
		
		/**
		 * 获取执行操作提交到后台的参数
		 */
		SaveStartWorkflow.prototype.getActionPostData = function(){
//			var fields = Activity.makeAllFieldAble();
			jQuery("input[moduleType='surveyField']").obpmSurveyField("getValue");
			var data = ajaxPage.getParams();
//			Activity.setFieldDisabled(fields);
			return data;
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		SaveStartWorkflow.prototype.doBefore = function(){
			var flag = true;
			
			var oOperation = document.getElementById("operation");
			if (oOperation) {
				oOperation.value = "doSave";
			}
			
			setHTMLValue();//设置html控件值
			
			return flag;
		}
		/**
		 * 按钮动作时执行的业务操作
		 */
		SaveStartWorkflow.prototype.doAction = function(){
			return true;
		}
		
		/**
		 * 按钮动作执行后的业务操作
		 */
		SaveStartWorkflow.prototype.doAfter = function(result){
		}
		
		SaveStartWorkflow._initialized = true;
	
	}
	
	
	
	return this;
}; 
/**
 * 流程处理
 * @author Happy
 */
function WorkflowProcess(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 5;
	
	
	if(typeof WorkflowProcess._initialized == "undefined"){
		
		
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		WorkflowProcess.prototype.getBeforePostData = function(){
			jQuery("input[moduleType='surveyField']").obpmSurveyField("getValue");
			var data = ajaxPage.getParams();
			return data;
		}
		
		/**
		 * 获取执行操作提交到后台的参数
		 */
		WorkflowProcess.prototype.getActionPostData = function(){
			jQuery("input[moduleType='surveyField']").obpmSurveyField("getValue");
			var data = ajaxPage.getParams();
			return data;
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		WorkflowProcess.prototype.doBefore = function(){
			showLoadingToast();
			setHTMLValue();
			var flag = true;
			return flag;
		}
		/**
		 * 按钮动作时执行的其他业务操作
		 */
		WorkflowProcess.prototype.doAction = function(){
			//doWordSave();
			return true;
		}
		
		/**
		 * 按钮动作执行后的其他业务操作
		 */
		WorkflowProcess.prototype.doAfter = function(result){
			hideLoadingToast();
			var openType = $("#openType").val();
			if($("#openType").val()=="from_weixin_message"){//从微信待办消息中打开
				if (typeof WeixinJSBridge == "undefined"){
				    if( document.addEventListener ){
				        document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
				    }else if (document.attachEvent){
				        document.attachEvent('WeixinJSBridgeReady', onBridgeReady); 
				        document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
				    }
				}
				try {
					if(WeixinJSBridge){
						WeixinJSBridge.invoke('closeWindow',{},function(res){
							//alert('关闭微信页面');
						});
					}
				} catch (e) {
				}
			}else if(GetReferrer()==""){//判断来路为空
				setTimeout(function(){
					ajaxPage.history.go(-1);
					//刷新待办和经办
					$("#pendingApp ul, #processingApp ul").trigger("refresh");	//流程中心
					Jh.Portal._eventRefresh();	//主页
				}, 700);
			}else if($("#myModalexample",parent.document).hasClass("active")){
				parent.MyPopup._modal.trigger("close");
				return;
			}else{
				setTimeout(function(){
					ajaxPage.history.go(-1);
					//刷新待办和经办
					$("#pendingApp ul, #processingApp ul").trigger("refresh");	//流程中心
					Jh.Portal._eventRefresh();	//主页
				}, 700);
			}
		}
	}
		
	WorkflowProcess._initialized = true;
	return this;
}

function GetReferrer() {//获取来路URL
	var ref = '';  
		if (document.referrer.length > 0) {  
			ref = document.referrer;  
		}  
	try {  
		if (ref.length == 0 && opener.location.href.length > 0) {  
			ref = opener.location.href;  
		}  
	} catch (e) {} 
	return ref;
}

; 
/**
 * 保存操作
 * 
 */
function SaveBtn(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 34;
	
	
	if(typeof SaveBtn._initialized == "undefined"){
		
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		SaveBtn.prototype.getBeforePostData = function(){
//			var fields = Activity.makeAllFieldAble();
			ajaxPage.getCurPage().find("input[moduleType='surveyField']").obpmSurveyField("getValue");
			var data = ajaxPage.getParams();
//			Activity.setFieldDisabled(fields);
			return data;
		}
		
		/**
		 * 获取执行操作提交到后台的参数
		 */
		SaveBtn.prototype.getActionPostData = function(){
//			var fields = Activity.makeAllFieldAble();
			ajaxPage.getCurPage().find("input[moduleType='surveyField']").obpmSurveyField("getValue");
			var data = ajaxPage.getParams();
//			Activity.setFieldDisabled(fields);
			return data;
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		SaveBtn.prototype.doBefore = function(){
			var flag = false;
			
			var oOperation = ajaxPage.getParamsByName("operation");
			if (oOperation) {
				oOperation.value = "doSave";
			}
			setHTMLValue();//设置html控件值
			var isword = false;

			if (!isword || isword == 'false') {
				flag = true;
			} else {
				if (retvalue >= 0) { // 有返回值才保存
					flag = true;
				}
			}
			/**
			if(flag){
				flag = ifSubSaveForm();
			}
			**/
			
			return flag;
		}
		/**
		 * 按钮动作时执行的业务操作
		 */
		SaveBtn.prototype.doAction = function(){
			return true;
		}
		
		/**
		 * 按钮动作执行后的业务操作
		 */
		SaveBtn.prototype.doAfter = function(result){
			if(result.resultType === "message"){
				var versions = ajaxPage.getParamsByName("content.versions");
				var versions = parseInt(versions.value);
				versions.value = (versions + 1);
			}
		}
		
		SaveBtn._initialized = true;
	
	}
	
	
	
	return this;
}; 
/**
 * 保存并返回操作
 * 
 */
function SaveBackBtn(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 11;
	
	
	if(typeof SaveBackBtn._initialized == "undefined"){
		
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		SaveBackBtn.prototype.getBeforePostData = function(){
//			var fields = Activity.makeAllFieldAble();
			jQuery("input[moduleType='surveyField']").obpmSurveyField("getValue");
			var data = ajaxPage.getParams();
//			Activity.setFieldDisabled(fields);
			return data;
		}
		
		/**
		 * 获取执行操作提交到后台的参数
		 */
		SaveBackBtn.prototype.getActionPostData = function(){
//			var fields = Activity.makeAllFieldAble();
			jQuery("input[moduleType='surveyField']").obpmSurveyField("getValue");
			var data = ajaxPage.getParams();
//			Activity.setFieldDisabled(fields);
			return data;
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		SaveBackBtn.prototype.doBefore = function(){
			var flag = false;
			
			var oOperation = document.getElementById("operation");
			if (oOperation) {
				oOperation.value = "doSave";
			}
			setHTMLValue();//设置html控件值
			//var retvalue = doWordSave();
			// if(!retvalue) {
			// 	alert('Word文档已经被其他用户更新， 请刷新页面加载最新的Word文档！');
			// 	return false;
			// }
			var isword = false;

			if (!isword || isword == 'false') {
				flag = true;
			} else {
				if (retvalue >= 0) { // 有返回值才保存
					flag = true;
				}
			}
			// if(flag){
			// 	flag = ifSubSaveForm();
			// }
			// if(flag){
			// 	flag = beforeAct(this.actType);
			// }
			return flag;
		}
		/**
		 * 按钮动作时执行的业务操作
		 */
		SaveBackBtn.prototype.doAction = function(){
			return true;
		}
		
		/**
		 * 按钮动作执行后的业务操作
		 */
		SaveBackBtn.prototype.doAfter = function(result){
			var backUrl = $("#_backURL").val();
			var openType = $("#openType").val();
			if($("#openType").val()=="from_weixin_message"){//从微信待办消息中打开
				if (typeof WeixinJSBridge == "undefined"){
				    if( document.addEventListener ){
				        document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
				    }else if (document.attachEvent){
				        document.attachEvent('WeixinJSBridgeReady', onBridgeReady); 
				        document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
				    }
				}
				try {
					WeixinJSBridge.invoke('closeWindow',{},function(res){
						//alert('关闭微信页面');
					});
				} catch (e) {
				}
			}else if(GetReferrer()==""){//判断来路为空
				setTimeout(function(){
					ajaxPage.history.go();
				}, 1000);
			}else if($("#myModalexample",parent.document).hasClass("active")){
				parent.MyPopup._modal.trigger("close");
				return;
			}
			else{
				setTimeout(function(){
					ajaxPage.history.go();
				}, 1000);
			}
		}
		
		SaveBackBtn._initialized = true;
	
	}
	
	
	
	return this;
}; 
/**
 * 保存草稿(不校验)操作
 * 
 */
function SaveWithoutValidateBtn(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 34;
	
	
	if(typeof SaveWithoutValidateBtn._initialized == "undefined"){
		
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		SaveWithoutValidateBtn.prototype.getBeforePostData = function(){
//			var fields = Activity.makeAllFieldAble();
			jQuery("input[moduleType='surveyField']").obpmSurveyField("getValue");
			jQuery("iframe[name='display_view']").trigger("save");
			var data = ajaxPage.getParams();
//			Activity.setFieldDisabled(fields);
			return data;
		}
		
		/**
		 * 获取执行操作提交到后台的参数
		 */
		SaveWithoutValidateBtn.prototype.getActionPostData = function(){
//			var fields = Activity.makeAllFieldAble();
			jQuery("input[moduleType='surveyField']").obpmSurveyField("getValue");
			var data = ajaxPage.getParams();
//			Activity.setFieldDisabled(fields);
			return data;
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		SaveWithoutValidateBtn.prototype.doBefore = function(){
			var flag = false;
			
			var oOperation = document.getElementById("operation");
			if (oOperation) {
				oOperation.value = "doSave";
			}
			setHTMLValue();//设置html控件值
			var retvalue = doWordSave();
			if(!retvalue) {
				alert('Word文档已经被其他用户更新， 请刷新页面加载最新的Word文档！');
				return false;
			}
			var isword = false;

			if (!isword || isword == 'false') {
				flag = true;
			} else {
				if (retvalue >= 0) { // 有返回值才保存
					flag = true;
				}
			}
			if(flag){
				flag = ifSubSaveForm();
			}
			return flag;
		}
		/**
		 * 按钮动作时执行的业务操作
		 */
		SaveWithoutValidateBtn.prototype.doAction = function(){
			return true;
		}
		
		/**
		 * 按钮动作执行后的业务操作
		 */
		SaveWithoutValidateBtn.prototype.doAfter = function(result){
		}
		
		SaveWithoutValidateBtn._initialized = true;
	
	}
	
	
	
	return this;
}; 
/**
 * 保存并关闭窗口
 * 
 */
function SaveCloseWindowBtn(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 9;
	
	
	if(typeof SaveCloseWindowBtn._initialized == "undefined"){
		
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		SaveCloseWindowBtn.prototype.getBeforePostData = function(){
//			var fields = Activity.makeAllFieldAble();
			jQuery("input[moduleType='surveyField']").obpmSurveyField("getValue");
			var data = ajaxPage.getParams();
//			Activity.setFieldDisabled(fields);
			return data;
		}
		
		/**
		 * 获取执行操作提交到后台的参数
		 */
		SaveCloseWindowBtn.prototype.getActionPostData = function(){
//			var fields = Activity.makeAllFieldAble();
			jQuery("input[moduleType='surveyField']").obpmSurveyField("getValue");
			var data = ajaxPage.getParams();
//			Activity.setFieldDisabled(fields);
			return data;
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		SaveCloseWindowBtn.prototype.doBefore = function(){
			var flag = false;
			
			var oOperation = document.getElementById("operation");
			if (oOperation) {
				oOperation.value = "doSave";
			}
			setHTMLValue();//设置html控件值
			var retvalue = doWordSave();
			if(!retvalue) {
				alert('Word文档已经被其他用户更新， 请刷新页面加载最新的Word文档！');
				return false;
			}
			var isword = false;

			if (!isword || isword == 'false') {
				flag = true;
			} else {
				if (retvalue >= 0) { // 有返回值才保存
					flag = true;
				}
			}
			if(flag){
				flag = ifSubSaveForm();
			}
			if(flag){
				flag = beforeAct(this.actType);
			}
			return flag;
		}
		/**
		 * 按钮动作时执行的业务操作
		 */
		SaveCloseWindowBtn.prototype.doAction = function(){
			return true;
		}
		
		/**
		 * 按钮动作执行后的业务操作
		 */
		SaveCloseWindowBtn.prototype.doAfter = function(result){
		}
		
		SaveCloseWindowBtn._initialized = true;
	
	}
	
	
	
	return this;
}; 
/**
 * 保存并返回操作
 * 
 */
function SaveNewBtn(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 10;
	this.withOld = params.withOld;//是否带旧数据
	
	
	if(typeof SaveNewBtn._initialized == "undefined"){
		
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		SaveNewBtn.prototype.getBeforePostData = function(){
//			var fields = Activity.makeAllFieldAble();
			jQuery("input[moduleType='surveyField']").obpmSurveyField("getValue");
			var data = ajaxPage.getParams();
//			Activity.setFieldDisabled(fields);
			return data;
		}
		
		/**
		 * 获取执行操作提交到后台的参数
		 */
		SaveNewBtn.prototype.getActionPostData = function(){
//			var fields = Activity.makeAllFieldAble();
			jQuery("input[moduleType='surveyField']").obpmSurveyField("getValue");
			var data = ajaxPage.getParams();
//			Activity.setFieldDisabled(fields);
			return data;
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		SaveNewBtn.prototype.doBefore = function(){
			var flag = true;
			
			var oOperation = ajaxPage.getCurPage().find("#operation");
			if (oOperation && oOperation.size() > 0) {
				oOperation.val("doSave");
			}
			setHTMLValue();//设置html控件值
			//flag = ifSubSaveForm();
			return flag;
		}
		/**
		 * 按钮动作时执行的业务操作
		 */
		SaveNewBtn.prototype.doAction = function(){
			return true;
		}
		
		/**
		 * 按钮动作执行后的业务操作
		 */
		SaveNewBtn.prototype.doAfter = function(result){
			
			jQuery.ajax({
				type: 'POST',
				async:true, 
				url: contextPath + '/portal/dynaform/activity/newDocument.action?_withOld='+this.withOld,
				dataType : 'json',
				timeout: 3000,
				data: ajaxPage.getParams(),
				success:function(result) {
					if(result.status==1){
						var datas = result.data;
						var activityHtml = datas["activityHtml"];
						var $curPage = ajaxPage.getCurPage();
						if(activityHtml){
							$curPage.find(".formActBtn").html(activityHtml);
						}
						var formHtml = datas["formHtml"];
						if(formHtml){
							$curPage.find("#_formHtml").html(formHtml)
						}
						showLoadingToast();//显示loading层
						//渲染流程提交按钮
						if($("input[activityType='5']")){
							FlowPanel.refreshFlowPanel("init");
						}
						//填充系统字段
						if(datas["systemFields"]){
							for(var n in datas["systemFields"]){
								$curPage.find("input[name='"+n+"']").val(datas["systemFields"][n]);
							}
						}
						$curPage.find("input[name='content.sign']").val("");
						$curPage.find(".isignature .sign").remove();
						//渲染流程处理人列表、流程状态标签、流程历史按钮
						$curPage.find("#processorHtml").html('');
						$curPage.find("#flowStateHtml").html('');
						$curPage.find(".flowbtn").hide();
						initFormCommon();//表单公用的初始化方法
//						adjustDocumentLayout4form();//调整相关文档布局
						hideLoadingToast();//隐藏loading层
					}else{
						Activity.showMessage(result.message,"error");
					}
				},
				error: function(XMLHttpRequest, textStatus, errorThrown) {
					if(XMLHttpRequest.readyState == 0){
						Activity.showMessage("网络已断开！","error");
					}else{
						Activity.showMessage(errorThrown.message,"error");
					}
				}
			});
			
		}
		
		SaveNewBtn._initialized = true;
	
	}
	
	
	
	return this;
}; 
/**
 * 保存并返回操作
 * 
 */
function BackBtn(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 10;
	
	
	if(typeof BackBtn._initialized == "undefined"){
		
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		BackBtn.prototype.getBeforePostData = function(){
			return ajaxPage.getParams();
		}
		
		/**
		 * 获取执行操作提交到后台的参数
		 */
		BackBtn.prototype.getActionPostData = function(){
			return ajaxPage.getParams();
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		BackBtn.prototype.doBefore = function(){
			var flag = false;
			
			flag = ifSubSaveForm();
			if(flag){
				flag = beforeAct(this.actType);
			}
			return flag;
		}
		/**
		 * 按钮动作时执行的业务操作
		 */
		BackBtn.prototype.doAction = function(){
			return true;
		}
		
		/**
		 * 按钮动作执行后的业务操作
		 */
		BackBtn.prototype.doAfter = function(result){
			var openType = $("#openType").val();
			if(openType=="from_weixin_message" && ajaxPage.pageArray.length <= 1){//从微信待办消息中打开
				if (typeof WeixinJSBridge == "undefined"){
				    if( document.addEventListener ){
				        document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
				    }else if (document.attachEvent){
				        document.attachEvent('WeixinJSBridgeReady', onBridgeReady); 
				        document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
				    }
				}
				try {
					if(WeixinJSBridge){
						WeixinJSBridge.invoke('closeWindow',{},function(res){
						});
					}
				} catch (e) {
				}
			}else{
				ajaxPage.history.go();
			}
		}
		
		BackBtn._initialized = true;
	
	}
	
	
	
	return this;
}; 
/**
 * 无类型操作
 * 
 */
function NoneBtn(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 13;
	this.actionType = params.actionType;
	this.actionDispatcherUrlScript = params.actionDispatcherUrlScript;
	this.actionSelection = params.actionSelection;
	this.relatedFormId = params.relatedFormId;
	this.actionPostData = null;
	
	if(typeof NoneBtn._initialized == "undefined"){
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		NoneBtn.prototype.getBeforePostData = function(){
//			var fields = Activity.makeAllFieldAble();
			jQuery("input[moduleType='surveyField']").obpmSurveyField("getValue");
			var data = ajaxPage.getParams();
//			Activity.setFieldDisabled(fields);
			return data;
		}
		/**
		 * 获取执行操作提交到后台的参数
		 */
		NoneBtn.prototype.getActionPostData = function(){
//			var fields = Activity.makeAllFieldAble();
			jQuery("input[moduleType='surveyField']").obpmSurveyField("getValue");
			var data = ajaxPage.getParams();
//			Activity.setFieldDisabled(fields);
			return data;
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		NoneBtn.prototype.doBefore = function(){
			return true;
		}
		/**
		 * 按钮动作时执行的业务操作
		 */
		NoneBtn.prototype.doAction = function(){
			return true;
		}
		/**
		 * 按钮动作执行后的业务操作
		 */
		NoneBtn.prototype.doAfter = function(result){
			switch (this.actionType) {
			case 0:  //无
				Activity.refreshForm(this.actionType); //刷新表单
				break;
			case 1:  //返回
				setTimeout(function(){
					Activity.back(this);
				},700);
				break;
			case 2:   //关闭
				setTimeout(function(){
					var opentype = $("input[name='openType']").val();
					if("277"==opentype || "16"==opentype){//弹出层打开
						Activity.closeWindow();
					}else{
						Activity.back(this);
					}
				},700);
				break;
			case 3:   //跳转
				var url = this.actionDispatcherUrlScript;
				var type = ajaxPage.judgeType(url);
				switch(type){
				case "form":
					ajaxPage.useFormAction(url);	//获取url拼接路由hash
					break;
				case "view":
					ajaxPage.getToViewHash(url);
					break;
				case "oReport":
					ajaxPage.getToOReportHash(url);
					break;
				}
				break;
			default:
				break;
			}
		}
		NoneBtn._initialized = true;
	
	}
	
	
	
	return this;
}; 
/**
 * 保存并复制操作
 * 
 */
function SaveCopyBtn(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 21;
	
	
	if(typeof SaveCopyBtn._initialized == "undefined"){
		
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		SaveCopyBtn.prototype.getBeforePostData = function(){
//			var fields = Activity.makeAllFieldAble();
			jQuery("input[moduleType='surveyField']").obpmSurveyField("getValue");
			var data = ajaxPage.getParams();
//			Activity.setFieldDisabled(fields);
			return data;
		}
		
		/**
		 * 获取执行操作提交到后台的参数
		 */
		SaveCopyBtn.prototype.getActionPostData = function(){
//			var fields = Activity.makeAllFieldAble();
			jQuery("input[moduleType='surveyField']").obpmSurveyField("getValue");
			var data = ajaxPage.getParams();
//			Activity.setFieldDisabled(fields);
			return data;
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		SaveCopyBtn.prototype.doBefore = function(){
			var flag = false;
			
			var oOperation = document.getElementById("operation");
			if (oOperation) {
				oOperation.value = "doSave";
			}
			setHTMLValue();//设置html控件值
			var retvalue = doWordSave();
			if(!retvalue) {
				alert('Word文档已经被其他用户更新， 请刷新页面加载最新的Word文档！');
				return false;
			}
			var isword = false;

			if (!isword || isword == 'false') {
				flag = true;
			} else {
				if (retvalue >= 0) { // 有返回值才保存
					flag = true;
				}
			}
			if(flag){
				flag = ifSubSaveForm();
			}
			return flag;
		}
		/**
		 * 按钮动作时执行的业务操作
		 */
		SaveCopyBtn.prototype.doAction = function(){
			return true;
		}
		
		/**
		 * 按钮动作执行后的业务操作
		 */
		SaveCopyBtn.prototype.doAfter = function(result){
			if(!result.resultData) return;
			var curPage = ajaxPage.getCurPage();
			curPage.find("input[name='content.id']").val(result.resultData);
			curPage.find("input[name='_docid']").val(result.resultData);
			Activity.refreshForm(this);
			
		}
		
		SaveCopyBtn._initialized = true;
	
	}
	
	
	
	return this;
}; 
/**
 * 关闭窗口操作
 * 
 */
function CloseWindowBtn(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 8;
	
	
	if(typeof CloseWindowBtn._initialized == "undefined"){
		
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		CloseWindowBtn.prototype.getBeforePostData = function(){
			return ajaxPage.getParams();
		}
		
		/**
		 * 获取执行操作提交到后台的参数
		 */
		CloseWindowBtn.prototype.getActionPostData = function(){
			return ajaxPage.getParams();
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		CloseWindowBtn.prototype.doBefore = function(){
			var flag = false;
			
			flag = ifSubSaveForm();
			if(flag){
				flag = beforeAct(this.actType);
			}
			return flag;
		}
		/**
		 * 按钮动作时执行的业务操作
		 */
		CloseWindowBtn.prototype.doAction = function(){
			return true;
		}
		
		/**
		 * 按钮动作执行后的业务操作
		 */
		CloseWindowBtn.prototype.doAfter = function(result){
			if(result.resultType && (result.resultType=="message" || result.resultType=="validate" || result.resultType=="exception")){
				return;
			}
			var opentype = $("input[name='openType']").val();
			if("277"==opentype || "16"==opentype){//弹出层打开
				top.OBPM.dialog.doExit();
			}else{
				//weixin or closeTab
				if($("#openType").val()=="from_weixin_message"){//从微信待办消息中打开
					if (typeof WeixinJSBridge == "undefined"){
					    if( document.addEventListener ){
					        document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
					    }else if (document.attachEvent){
					        document.attachEvent('WeixinJSBridgeReady', onBridgeReady); 
					        document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
					    }
					}
					try {
						WeixinJSBridge.invoke('closeWindow',{},function(res){
							//alert('关闭微信页面');
						});
					} catch (e) {
					}
					
				}
				else if(GetReferrer()==""){//判断来路为空
					ajaxPage.history.go();
				}
				else{
				    history.go(-2);
				}
			}
		}
		
		CloseWindowBtn._initialized = true;
	
	}
	
	
	
	return this;
}; 
/**
 * 网页打印操作
 * 
 */
function HtmlPrintBtn(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 14;
	
	
	if(typeof HtmlPrintBtn._initialized == "undefined"){
		
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		HtmlPrintBtn.prototype.getBeforePostData = function(){
			return ajaxPage.getParams();
		}
		
		/**
		 * 获取执行操作提交到后台的参数
		 */
		HtmlPrintBtn.prototype.getActionPostData = function(){
			return ajaxPage.getParams();
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		HtmlPrintBtn.prototype.doBefore = function(){
			
			return true;
		}
		/**
		 * 按钮动作时执行的业务操作
		 */
		HtmlPrintBtn.prototype.doAction = function(){
			return true;
		}
		
		/**
		 * 按钮动作执行后的业务操作
		 */
		HtmlPrintBtn.prototype.doAfter = function(result){
			var withFlowHis = false;
			var id = document.getElementsByName("content.id")[0].value;
			var applicationid = document.getElementsByName("content.applicationid")[0].value;
			var formid = document.getElementsByName("_formid")[0].value;
			var flowid = document.getElementsByName("_flowid")[0].value;
			var _templateForm = document.getElementsByName("_templateForm")[0].value;
			var signatureExist = document.getElementById("signatureExist").value;
			
			var url = contextPath + '/portal/dynaform/activity/print.action?_docid=' + id;
			url += '&_formid=' + formid;
			url += '&_signatureExist=' + signatureExist;
			url += '&application=' + applicationid;
			url += '&actType='+ this.actType;
			if (withFlowHis && flowid) {
				url += '&_flowid=' + flowid;
			}
			if(_templateForm){
				url += '&_templateForm=' + _templateForm;
			}
			if (parent != top) {
				parent.open(url);
			} else {
				window.open(url);
			}
		}
		
		HtmlPrintBtn._initialized = true;
	
	}
	
	
	
	return this;
}; 
/**
 * 网页打印(带流程历史)操作
 * 
 */
function HtmlPrintWithHisBtn(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 14;
	
	
	if(typeof HtmlPrintWithHisBtn._initialized == "undefined"){
		
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		HtmlPrintWithHisBtn.prototype.getBeforePostData = function(){
			return ajaxPage.getParams();
		}
		
		/**
		 * 获取执行操作提交到后台的参数
		 */
		HtmlPrintWithHisBtn.prototype.getActionPostData = function(){
			return ajaxPage.getParams();
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		HtmlPrintWithHisBtn.prototype.doBefore = function(){
			
			return true;
		}
		/**
		 * 按钮动作时执行的业务操作
		 */
		HtmlPrintWithHisBtn.prototype.doAction = function(){
			return true;
		}
		
		/**
		 * 按钮动作执行后的业务操作
		 */
		HtmlPrintWithHisBtn.prototype.doAfter = function(result){
			var withFlowHis = true;
			var id = document.getElementsByName("content.id")[0].value;
			var applicationid = document.getElementsByName("content.applicationid")[0].value;
			var formid = document.getElementsByName("_formid")[0].value;
			var flowid = document.getElementsByName("_flowid")[0].value;
			var _templateForm = document.getElementsByName("_templateForm")[0].value;
			var signatureExist = document.getElementById("signatureExist").value;
			
			var url = contextPath + '/portal/dynaform/activity/print.action?_docid=' + id;
			url += '&_formid=' + formid;
			url += '&_signatureExist=' + signatureExist;
			url += '&_activityid=' + this.actId;
			url += '&application=' + applicationid;
			url += '&actType='+ this.actType;
			if (withFlowHis && flowid) {
				url += '&_flowid=' + flowid;
			}
			if(_templateForm){
				url += '&_templateForm=' + _templateForm;
			}
			if (parent != top) {
				parent.open(url);
			} else {
				window.open(url);
			}
		}
		
		HtmlPrintWithHisBtn._initialized = true;
	
	}
	
	
	
	return this;
}; 
/**
 * 自定义打印操作
 * 
 */
function FlexPrintBtn(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 30;
	this.printerid = params.printerid;
	this.withFlowHis = params.withFlowHis;
	
	
	if(typeof FlexPrintBtn._initialized == "undefined"){
		
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		FlexPrintBtn.prototype.getBeforePostData = function(){
			return ajaxPage.getParams();
		}
		
		/**
		 * 获取执行操作提交到后台的参数
		 */
		FlexPrintBtn.prototype.getActionPostData = function(){
			return ajaxPage.getParams();
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		FlexPrintBtn.prototype.doBefore = function(){
			
			return true;
		}
		/**
		 * 按钮动作时执行的业务操作
		 */
		FlexPrintBtn.prototype.doAction = function(){
			return true;
		}
		
		/**
		 * 按钮动作执行后的业务操作
		 */
		FlexPrintBtn.prototype.doAfter = function(result){
			var id = document.getElementsByName("content.id")[0].value;
			var formid = document.getElementsByName("_formid")[0].value;
			var flowid = document.getElementsByName("_flowid")[0].value;
			var url = contextPath + '/portal/share/dynaform/printer/flexprint.jsp?_activityid='+this.actId+'&id='
			+ this.printerid + '&_docid=' + id+'&_formid='+formid+'&_flowid='+flowid+'&actType='+ this.actType;
			if (parent != top) {
				parent.open(url);
			} else {
				window.open(url);
			}
		}
		
		FlexPrintBtn._initialized = true;
	
	}
	
	
	
	return this;
}; 
/**
 * 导出pdf操作
 * 
 */
function ExportToPdfBtn(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 25;
	
	
	if(typeof ExportToPdfBtn._initialized == "undefined"){
		
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		ExportToPdfBtn.prototype.getBeforePostData = function(){
			return ajaxPage.getParams();
		}
		
		/**
		 * 获取执行操作提交到后台的参数
		 */
		ExportToPdfBtn.prototype.getActionPostData = function(){
			return ajaxPage.getParams();
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		ExportToPdfBtn.prototype.doBefore = function(){
			
			return true;
		}
		/**
		 * 按钮动作时执行的业务操作
		 */
		ExportToPdfBtn.prototype.doAction = function(){
			var id = document.getElementsByName("content.id")[0].value;
			var url = contextPath + '/portal/dynaform/activity/process.action' + '?_activityid=' + this.actId;
			document.forms[0].action = url;
			document.forms[0].submit();
			
			
			return false;
		}
		
		/**
		 * 按钮动作执行后的业务操作
		 */
		ExportToPdfBtn.prototype.doAfter = function(result){
		}
		
		ExportToPdfBtn._initialized = true;
	
	}
	
	
	
	return this;
}; 
/**
 * 文件下载操作
 * 
 */
function FileDownloadBtn(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 26;
	
	
	if(typeof FileDownloadBtn._initialized == "undefined"){
		
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		FileDownloadBtn.prototype.getBeforePostData = function(){
			return ajaxPage.getParams();
		}
		
		/**
		 * 获取执行操作提交到后台的参数
		 */
		FileDownloadBtn.prototype.getActionPostData = function(){
			return ajaxPage.getParams();
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		FileDownloadBtn.prototype.doBefore = function(){
			
			return true;
		}
		/**
		 * 按钮动作时执行的业务操作
		 */
		FileDownloadBtn.prototype.doAction = function(){
			var url = contextPath + '/portal/dynaform/activity/process.action' + '?_activityid=' + this.actId;
			document.forms[0].action = url;
			document.forms[0].submit();
			
			
			return false;
		}
		
		/**
		 * 按钮动作执行后的业务操作
		 */
		FileDownloadBtn.prototype.doAfter = function(result){
		}
		
		FileDownloadBtn._initialized = true;
	
	}
	
	
	
	return this;
}; 
/**
 * 电子签章操作
 * 
 */
function SignatureBtn(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 28;
	
	
	if(typeof SignatureBtn._initialized == "undefined"){
		
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		SignatureBtn.prototype.getBeforePostData = function(){
//			var fields = Activity.makeAllFieldAble();
			jQuery("input[moduleType='surveyField']").obpmSurveyField("getValue");
			var data = ajaxPage.getParams();
//			Activity.setFieldDisabled(fields);
			return data;
		}
		
		/**
		 * 获取执行操作提交到后台的参数
		 */
		SignatureBtn.prototype.getActionPostData = function(){
//			var fields = Activity.makeAllFieldAble();
			jQuery("input[moduleType='surveyField']").obpmSurveyField("getValue");
			var data = ajaxPage.getParams();
//			Activity.setFieldDisabled(fields);
			return data;
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		SignatureBtn.prototype.doBefore = function(){
			if(getBrowser().indexOf("ie") < 0) {
				alert("电子印章功能仅支持IE内核的浏览器!");
				return;
			}
			var ajax = null;
			if (window.ActiveXObject) {
				try {
					ajax = new ActiveXObject("Microsoft.XMLHTTP");
				} catch (e) {
					alert("创建Microsoft.XMLHTTP对象失败,AJAX不能正常运行.请检查您的浏览器设置.");
				}
			} else {
				if (window.XMLHttpRequest) {

					try {
						ajax = new XMLHttpRequest();
					} catch (e) {
						alert("创建XMLHttpRequest对象失败,AJAX不能正常运行.请检查您的浏览器设置.");
					}
				}
			}

			var url = document.getElementById("mGetDocumentUrl").value;
			var mLoginname = document.getElementById("mLoginname").value;
			var docid = document.getElementsByName("content.id")[0].value;
			var formid = document.getElementsByName("formid")[0].value;
			var applicationid = document.getElementsByName("applicationid")[0].value;
			url = url + "?_docid=" + docid + "&_formid=" + formid + "&_applicationid="
					+ applicationid;
			ajax.onreadystatechange = function() {
				if (ajax.readyState == 4 && ajax.status == 200) {
					if (ajax.responseText == "false") {
						return;
					}
					var documentName = ajax.responseText.split(',');
					var fildsList = "";
					for (var i = 0; i < documentName.length; i++) {
						if (i != documentName.length - 1) {
							fildsList = fildsList
									+ (documentName[i] + "=" + documentName[i] + ";");
						} else {
							fildsList = fildsList
									+ (documentName[i] + "=" + documentName[i]);
						}

					}
					//phone不支持电子签章，document_content指表单中的Form
					if (document_content.SignatureControl != null) {
						document_content.SignatureControl.FieldsList = fildsList; // 所保护字段
						document_content.SignatureControl.Position(460, 260); // 签章位置，屏幕坐标
						document_content.SignatureControl.UserName = "lyj"; // 文件版签章用户
						document_content.SignatureControl.DivId="contentTable"; //设置签章显示位置
						document_content.SignatureControl.RunSignature(); // 执行签章操作
					} else {
						alert("请安装金格iSignature电子签章HTML版软件");
						document.getElementById("hreftest").click();
					}

				}

			};

			ajax.open("POST", url);

			ajax.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
			ajax.send(null);
			return false;
		}
		/**
		 * 按钮动作时执行的业务操作
		 */
		SignatureBtn.prototype.doAction = function(){
			return false;
		}
		
		/**
		 * 按钮动作执行后的业务操作
		 */
		SignatureBtn.prototype.doAfter = function(result){
		}
		
		SignatureBtn._initialized = true;
	
	}
	
	
	
	return this;
}; 
/**
 * 分享操作
 * 
 */
function TranspondBtn(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 37;
	this.summaryCfg = params.summaryCfg;//分享摘要模板
	
	
	if(typeof TranspondBtn._initialized == "undefined"){
		
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		TranspondBtn.prototype.getBeforePostData = function(){
//			var fields = Activity.makeAllFieldAble();
			jQuery("input[moduleType='surveyField']").obpmSurveyField("getValue");
			var data = ajaxPage.getParams();
//			Activity.setFieldDisabled(fields);
			return data;
		}
		
		/**
		 * 获取执行操作提交到后台的参数
		 */
		TranspondBtn.prototype.getActionPostData = function(){
//			var fields = Activity.makeAllFieldAble();
			jQuery("input[moduleType='surveyField']").obpmSurveyField("getValue");
			var data = ajaxPage.getParams();
//			Activity.setFieldDisabled(fields);
			return data;
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		TranspondBtn.prototype.doBefore = function(){
			return true;
		}
		/**
		 * 按钮动作时执行的业务操作
		 */
		TranspondBtn.prototype.doAction = function(){
			var applicationid = document.getElementsByName("content.applicationid")[0].value;
			var docid = document.getElementsByName("content.id")[0].value;
			var formid = document.getElementsByName("_formid")[0].value;
			var signatureExist = document.getElementById("signatureExist").value;
			var handleUrl = window.location.toString();
			var url = "../share/dynaform/view/activity/emailTranspond.jsp?application=" + applicationid;
			OBPM.dialog.show({
	    		opener:window.parent.parent,
	    		width: 700,
	    		height: 300,
	    		args: {"_activityid":this.actId,"application":applicationid, "docid":docid, "formid":formid, "transpond":this.summaryCfg, "handleUrl":handleUrl, "signatureExist":signatureExist},
	    		url: url,
	    		title: '转发',
	    		close: function() {
	    			
	    		}
	    	});
			return false;
		}
		
		/**
		 * 按钮动作执行后的业务操作
		 */
		TranspondBtn.prototype.doAfter = function(result){
		}
		
		TranspondBtn._initialized = true;
	
	}
	
	
	
	return this;
}; 
/**
 * 跳转操作
 * 
 */
function JumpToBtn(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 43;
	this.jumpType = params.jumpType;
	this.targetList = params.targetList;
	this.jumpMode = params.jumpMode;
	
	
	if(typeof JumpToBtn._initialized == "undefined"){
		
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		JumpToBtn.prototype.getBeforePostData = function(){
			if(jQuery("#formList").size()>0){
				return jQuery("#formList").serialize();
			}else{
				return ajaxPage.getParams();
			}
		}
		
		/**
		 * 获取执行操作提交到后台的参数
		 */
		JumpToBtn.prototype.getActionPostData = function(){
			if(jQuery("#formList").size()>0){
				return jQuery("#formList").serialize();
			}else{
				return ajaxPage.getParams();
			}
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		JumpToBtn.prototype.doBefore = function(){
			
			return true;
		}
		/**
		 * 按钮动作时执行的业务操作
		 */
		JumpToBtn.prototype.doAction = function(){
			switch (this.jumpMode) {
			case 0 :
				var olist = this.targetList.split(";");
				var formId;
				for (var i = 0; i < olist.length; i++) {
					formId = olist[0].split("|")[0];
				}
				if(this.jumpType==0){
					var applicationid = document.getElementById("application").value;
					var docid = document.getElementsByName("content.id")[0].value;
					var view_id = document.getElementById("view_id").value;
					var signatureExist = document.getElementsByName("signatureExist")[0].value;
					var formid = document.getElementsByName("formid")[0].value;
					var backUrl = document.getElementsByName("_backURL")[0].value;
					var docviewAction = contextPath + '/portal/dynaform/document/view.action';
					var newAction = contextPath + '/portal/dynaform/activity/process.action?_activityid=' + this.actId;
					var url = newAction + "&applicationid=" + applicationid + "&application=" + applicationid + "&openType="+this.jumpActOpenType+"&_jumpForm=" + formid + "&_formid=" + formId + "&view_id=" + view_id + "&_isJump=1&_backURL="
							+ encodeURIComponent(docviewAction + "?_docid="+docid+"&application="+applicationid+"&_formid="+formid+"&view_id="+
									view_id+"&signatureExist="+signatureExist+"&_backURL="+encodeURIComponent(backUrl));
					
					var inputElem =$("input[iscommonfilter]");//可获取所有查询表单的input
					if(inputElem.size() > 0){
						inputElem.each(function(){
							var val = $(this).val();//获取控件值
							if(val != null){
								var _id = $(this).attr("id");
								var id = _id.substring(_id.indexOf("_")+1);//获取控件名称
								url+="&"+id+"="+val;
							}
						  });
					}
					
					
					window.location.href = url;
				}else{
					
				}
				
				break;
			case 1 :
				var datas = ajaxPage.getParams();
				var url = contextPath + '/portal/dynaform/activity/process.action?_activityid=' + this.actId;
				var html = '<input type="hidden" name="formData" value="'+datas+'" />';
				jQuery("body >div.cur #formParams").append(html);
				document.forms[0].action = url;
//				makeAllFieldAble();
				document.forms[0].submit();
				break;
			default :
				break;
		}
			
			return false;
		}
		
		/**
		 * 按钮动作执行后的业务操作
		 */
		JumpToBtn.prototype.doAfter = function(result){
			
		}
		
		JumpToBtn._initialized = true;
	
	}
	
	
	
	return this;
}; 
/**
 * 新建操作
 * 
 */
function CreateBtn(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 2;
	this.viewType = params.viewType;
	this.openType = 1;
	this.formId = params.formId;
	this.target = params.target;
	this.HAS_SUBFORM = false;
	
	if(typeof CreateBtn._initialized == "undefined"){
		
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		CreateBtn.prototype.getBeforePostData = function(){
			console.info("subform1-->" + this.HAS_SUBFORM);
			this.HAS_SUBFORM = DisplayView.isSubPage(this.target);
			console.info("subform2-->" + this.HAS_SUBFORM);
			
			if(typeof this.HAS_SUBFORM !="undefined" && this.HAS_SUBFORM){
				return DisplayView.span2Params(this.target);
			}else{
				return ajaxPage.getParams();
			}
			
		}
		
		/**
		 * 获取执行操作提交到后台的参数
		 */
		CreateBtn.prototype.getActionPostData = function(){
			if(typeof this.HAS_SUBFORM !="undefined" && this.HAS_SUBFORM){
				var application = $(".control-content.active").find("span[name='application']").text();
				//return $(".control-content.active").find("input,textarea,select").serialize()+"&application="+application+"&formId="+this.formId;
				var view = DisplayView.getTheView(this.target);
				var json = DisplayView.span2Json(this.target);
				json['formId'] = this.formId;
				var elems = $(view).find("[name=_selects]:checked");
				json['_backURL'] = '';
				return DisplayView.addVal2Params(json,elems);
			}else{
				return ajaxPage.getParams() + "&formId="+this.formId;
			}
			
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		CreateBtn.prototype.doBefore = function(){
			//createDoc(this.actId);
			//if(this.openType==288 && toggleButton("button_act")) return false;
			/**
			if(this.viewType!=1){
				doNew(this.actId);
			}
			**/
			//doNew(this.actId);
			return true;
		}
		/**
		 * 按钮动作时执行的业务操作
		 */
		CreateBtn.prototype.doAction = function(){
			if(this.openType==288){//网格显示
				this.openType = 1;
//				jQuery("#VIEW_OPEN_TYPE_GRID_BTN").css("display","");
//	        	DocumentUtil.doNew(this.actId, getGridParams(), function(rtn) {
//	        				var oTR = eval(rtn);
//	        				if (oTR) {
//	        					insertRow(oTR[0], oTable.rows.length);
//	        					newRows.push(oTR.attr("id"));
//	        					doRowEdit(oTR.attr("id"));
//	        				}
//
//    						jQuery("#" + oTR.attr("id")).bind('change',function(){
//    							setFieldValChanged(true);
//    						}).bind("keydown",function(e){
//    							 var key = e.which;
//    							 if (this.type != "textarea" && key == 13) {
//    							 	e.preventDefault(); //按enter键时阻止表单默认行为
//    							 }
//    						});
//	        				
//	        				//jquery重构按钮和控件
//	        				jqRefactor();
//	        				ev_resize4IncludeViewPar(); // 调整高度
//	        			});
//	        	return false;
			}
			return true;
		}
		
		/**
		 * 按钮动作执行后的业务操作
		 */
		CreateBtn.prototype.doAfter = function(result){
			// View的openType(打开类型)
			var url = contextPath + "/portal/dynaform/activity/process.action?_activityid="+this.actId+"&_formid="+this.formId;
			if(this.params.parameter){
				url += "&content.id="+this.params.parameter;
			}
			if (this.openType == 17) {
				var isRelate = ajaxPage.getParamsByName("isRelate");
				url += "&isSubDoc=true";
				if (isRelate){
		            if (isRelate.length>0){
		            	var relate = isRelate[0].value;
		            	url += "&isRelate="+relate;
		            }
				}
			}

			var _openType = ajaxPage.getParamsByName("_openType")[0];
			if(_openType && _openType.tagName){
				if(_openType.tagName.toUpperCase() == "INPUT"){
//					this.openType = _openType.value;
				}else {	//子表视图用span存储参数
					this.openType = _openType.innerText;
				}
			}

			var parameters = getQueryString(this.openType);
		
			resetBackURL(); // view.js
		
//			if (this.openType == 1) {
//				if (isHomePage()) { // 首页单独处理
//					url += "&_backURL="
//							+ encodeURIComponent(contextPath
//									+ "/portal/dispatch/homepage.jsp");
//					url += "&" + parameters;
//					parent.location = appendApplicationidByView(url);
//				} else {
//					ajaxPage.routerLoadPage(url);
//				}
//			} else 
			if (this.openType == 1 ||this.openType == OPEN_TYPE_POP || this.openType == OPEN_TYPE_DIV
					|| this.openType == OPEN_TYPE_OWN) {
				var oSelects = ajaxPage.getParamsByName("_selects");
				var _selects="";
				if(oSelects){
					for(var i=0;i<oSelects.length;i++){
						if(oSelects[i].checked){
							_selects+="&_selects="+oSelects[i].value;
						}
					}
				}
				url += "&" + parameters + "&openType=" + this.openType+_selects;
				url = appendApplicationidByView(url);
				
//				$("#document_content").hide();
//				$("#myModalexample").find(".content").css({"position":"static","height":$(window).height()-44})
//				$("#myModalexample").find(".content>iframe").css({"position":"absolute","z-index":"1","top":"44px","height":$(window).height()-44})
				
//				MyPopup.open({
//					url:url,
//					title:"新建",
//					success:function(){
//						$("[name='_fieldid']").each(function(){
//							$("#document_content").show();
//							$("#"+$(this).text()).trigger("refresh");
//						})
//					}
//				});
				ajaxPage.getCreateHash(url);

//			} else if (this.openType == OPEN_TYPE_OWN) {
//				var id = document.getElementsByName("_viewid")[0].value;
//				if (this.openType == VIEW_TYPE_SUB) {
//					var sub_divid = parent.document.getElementById('sub_divid');
//					var doc_obj = parent.document.getElementById(id);
//					if (sub_divid) {
//						sub_divid.value = doc_obj.src;
//					}
//					ajaxPage.loadPage(url);
//		//			if (doc_obj) {
//						//url += "&" + parameters;
//						//doc_obj.src = url;
//		//			}
//				} else {
//					ajaxPage.loadPage(url);
//				}
		
			} else {
				if(toggleButton("button_act")) return false;
			}
		}
		
		CreateBtn._initialized = true;
	
	}
	
	
	
	return this;
}; 
/**
 * 删除操作
 * 
 */
function DeleteBtn(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 3;
	this.target = params.target;
	
	if(typeof DeleteBtn._initialized == "undefined"){
		
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		DeleteBtn.prototype.getBeforePostData = function(){
			
			if(typeof DisplayView == 'object' && DisplayView.getTheView(this.target)){
				var view = DisplayView.getTheView(this.target);
				var json = DisplayView.span2Json(this.target);
				var elems = $(view).find("[name=_selects]:checked");
				return DisplayView.addVal2Params(json,elems);
			}else{
				return ajaxPage.getParams();
				
			};
		}
		
		/**
		 * 获取执行操作提交到后台的参数
		 */
		DeleteBtn.prototype.getActionPostData = function(){
			if(typeof DisplayView == 'object' && DisplayView.getTheView(this.target)){
				var view = DisplayView.getTheView(this.target);
				var json = DisplayView.span2Json(this.target);
				var elems = $(view).find("[name=_selects]:checked");
				return DisplayView.addVal2Params(json,elems);
			}else{
				return ajaxPage.getParams();
			}
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		DeleteBtn.prototype.doBefore = function(){
			var checkboxs = ajaxPage.getParamsByName("_selects");
			var isSelect = false;
			for (var i = 0; i < checkboxs.length; i++) {
				if (checkboxs[i].checked == true) {
					isSelect = true;
					break;
				}
			}
			if (isSelect) {
				var rtn = window.confirm("确定要删除您选择的记录吗？");
				if (!rtn)
					return false;
			} else {
				showMessage("info", "请选择要删除的数据！")
				return false;
			}
			
			return true;
		}
		/**
		 * 按钮动作时执行的业务操作
		 */
		DeleteBtn.prototype.doAction = function(){
			return true;
		}
		
		/**
		 * 按钮动作执行后的业务操作
		 */
		DeleteBtn.prototype.doAfter = function(result){
			
			//获取视图类型
			var viewType = ajaxPage.getCurPage().find("[name='_openType']:eq(0)").text();
			if(viewType && viewType == "277"){
				//刷新子视图
				//var $displayView = $("div[name='display_view']");
				//$displayView.bind("refresh", function(){
				//	$displayView.load($displayView.attr("src"), function(){
				//		dy_refresh(name);					
				//	});
				//}).trigger("refresh");
				
				var url = ajaxPage.getCurPage().attr("href");
				var viewId = ajaxPage.getCurPage().find("title").attr("id");
				refreshDisplayView(url,viewId)
				
			}else{
				ajaxPage.refreshPage();
//				document.forms[0].action = contextPath+"/portal/dynaform/view/displayView.action";
//				document.forms[0].submit();
			}

			
		}
		
		DeleteBtn._initialized = true;
	
	}
	
	
	
	return this;
}; 
/**
 * 清空操作
 * 
 */
function ClearAllBtn(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 18;
	
	
	if(typeof ClearAllBtn._initialized == "undefined"){
		
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		ClearAllBtn.prototype.getBeforePostData = function(){
			return jQuery(document.forms[0]).serialize();
		}
		
		/**
		 * 获取执行操作提交到后台的参数
		 */
		ClearAllBtn.prototype.getActionPostData = function(){
			return jQuery(document.forms[0]).serialize();
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		ClearAllBtn.prototype.doBefore = function(){
			return window.confirm("确定要清空表单的所有记录吗？");
		}
		/**
		 * 按钮动作时执行的业务操作
		 */
		ClearAllBtn.prototype.doAction = function(){
			return true;
		}
		
		/**
		 * 按钮动作执行后的业务操作
		 */
		ClearAllBtn.prototype.doAfter = function(result){
			document.forms[0].action = contextPath+"/portal/dynaform/view/displayView.action";
			document.forms[0].submit();
		}
		
		ClearAllBtn._initialized = true;
	
	}
	
	
	
	return this;
}; 
/**
 * 载入视图操作
 * 
 */
function QueryBtn(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 1;
	this.viewId = params.viewId;
	this.target = params.target;
	this.HAS_SUBFORM = false;
	
	
	if(typeof QueryBtn._initialized == "undefined"){
		
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		QueryBtn.prototype.getBeforePostData = function(){
			this.HAS_SUBFORM = DisplayView.isSubPage(this.target);
			if(typeof this.HAS_SUBFORM !="undefined" && this.HAS_SUBFORM){
				return DisplayView.span2Params(this.target);
			}else{
//				return jQuery(document.forms[0]).serialize();
				return ajaxPage.getParams();
			}
		}
		
		/**
		 * 获取执行操作提交到后台的参数
		 */
		QueryBtn.prototype.getActionPostData = function(){
			if(typeof this.HAS_SUBFORM !="undefined" && this.HAS_SUBFORM){
				var application = $(".control-content.active").find("span[name='application']").text();
				//return $(".control-content.active").find("input,textarea,select").serialize()+"&application="+application+"&formId="+this.formId;
				var view = DisplayView.getTheView(this.target);
				var json = DisplayView.span2Json(this.target);
				json['formId'] = this.formId;
				var elems = $(view).find("[name=_selects]:checked");
				json['_backURL'] = '';
				return DisplayView.addVal2Params(json,elems);
			}else{
				return ajaxPage.getParams()+"&formId="+this.formId;
			}
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		QueryBtn.prototype.doBefore = function(){
			return true;
		}
		/**
		 * 按钮动作时执行的业务操作
		 */
		QueryBtn.prototype.doAction = function(){
			return true;
		}
		
		/**
		 * 按钮动作执行后的业务操作
		 */
		QueryBtn.prototype.doAfter = function(result){
			var viewType = $("[name='_openType']:eq(0)").text();
			if(viewType && viewType == "277"){
				//刷新子视图
				//var $displayView = $("div[name='display_view']");
				//$displayView.bind("refresh", function(){
				//	$displayView.load($displayView.attr("src"), function(){
				//		dy_refresh(name);					
				//	});
				//}).trigger("refresh");
				
				var $thisTab = $(this.target).parents("div[name='display_view']");
				var $url = $thisTab.attr("src");

				$thisTab.load($url, function(){
					var $tabParameter = $(".tab_parameter_Display");
					var viewid = this.id + "_params";
					var $viewDiv = $("<div></div>").attr("id",viewid).attr("_action",$(this).attr("src")).css("display","none");
					//表单元素转成span标签存入dom中
					$.each($(this).find(".tab_parameter_Display").find("input[type!=button],select,textarea").serializeArray(),function(){
						$viewDiv.append("<span name='" + this.name + "'>" + this.value + "</span>"); 
					});
					$(this).append($viewDiv);
					//去掉表单元素
					$tabParameter.find("input[type!=button],select,textarea").each(function(){
						if(!$(this).attr("moduleType")) $(this).remove();
					});
					jqRefactor();					
				});
				
			}else{
//				document.forms[0].action = contextPath+"/portal/dynaform/view/displayView.action?_viewid=" + this.viewId;
//				document.forms[0].submit();
				var url = contextPath+"/portal/dynaform/view/displayView.action?_viewid=" + this.viewId;
				ajaxPage.submitPage(url);
			}
			
		}
		
		QueryBtn._initialized = true;
	
	}
	
	
	
	return this;
}; 
/**
 * 批量提交操作
 * 
 */
function BatchApproveBtn(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 20;
	this.hasRun = false;
	
	if(typeof BatchApproveBtn._initialized == "undefined"){
		
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		BatchApproveBtn.prototype.getBeforePostData = function(){
			return jQuery(document.forms[0]).serialize();
		}
		
		/**
		 * 获取执行操作提交到后台的参数
		 */
		BatchApproveBtn.prototype.getActionPostData = function(){
			return jQuery(document.forms[0]).serialize();
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		BatchApproveBtn.prototype.doBefore = function(){
			var checkboxs = document.getElementsByName("_selects");
			var isSelect = false;
			for (var i = 0; i < checkboxs.length; i++) {
				if (checkboxs[i].checked == true) {
					isSelect = true;
					break;
				}
			}
			if(!isSelect){
				alert("至少选择一条记录！");
			}
			return isSelect;
		}
		/**
		 * 按钮动作时执行的业务操作
		 */
		BatchApproveBtn.prototype.doAction = function(){
			if(this.hasRun) return true;
			var activityType = this;
			if(jQuery("#inputAuditRemarkDiv" + this.actId).attr("id")){
				artDialog.prompt('请输入审批意见：',function(val,win){
					jQuery('#_attitude' + activityType.actId).val(val);
					activityType.hasRun = true;
					Activity.doAction(activityType);
				},true);
				
			}
			
			return false;
			
		}
		
		/**
		 * 按钮动作执行后的业务操作
		 */
		BatchApproveBtn.prototype.doAfter = function(result){
			document.forms[0].action = contextPath+"/portal/dynaform/view/displayView.action";
			document.forms[0].submit();
		}
		
		BatchApproveBtn._initialized = true;
	
	}
	
	
	
	return this;
}; 
/**
 * 导出Excel操作
 * 
 */
function ExportToExcelBtn(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 16;
	this.fileName = params.fileName;
	this.expSub = params.expSub;
	this.hasRun = false;
	
	
	if(typeof ExportToExcelBtn._initialized == "undefined"){
		
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		ExportToExcelBtn.prototype.getBeforePostData = function(){
			return jQuery(document.forms[0]).serialize();
		}
		
		/**
		 * 获取执行操作提交到后台的参数
		 */
		ExportToExcelBtn.prototype.getActionPostData = function(){
			return jQuery(document.forms[0]).serialize();
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		ExportToExcelBtn.prototype.doBefore = function(){
			if(this.hasRun){
				alert("已导出，需要再次导出请刷新页面！");
				return false;
			}
			return true;
		}
		/**
		 * 按钮动作时执行的业务操作
		 */
		ExportToExcelBtn.prototype.doAction = function(){
			var oldActionUrl = document.forms[0].action;
			var url = contextPath + '/portal/dynaform/activity/process.action' + '?_activityid=' + this.actId+ "&filename=" + this.fileName + "&isExpSub=" + this.expSub;;
			document.forms[0].action = url;
			document.forms[0].submit();
			this.hasRun = true;
			document.forms[0].action = oldActionUrl;
			return false;
		}
		
		/**
		 * 按钮动作执行后的业务操作
		 */
		ExportToExcelBtn.prototype.doAfter = function(result){
		}
		
		ExportToExcelBtn._initialized = true;
	
	}
	
	
	
	return this;
}; 
/**
 * 打印视图操作
 * 
 */
function PrintViewBtn(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 14;
	
	
	if(typeof PrintViewBtn._initialized == "undefined"){
		
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		PrintViewBtn.prototype.getBeforePostData = function(){
			return jQuery(document.forms[0]).serialize();
		}
		
		/**
		 * 获取执行操作提交到后台的参数
		 */
		PrintViewBtn.prototype.getActionPostData = function(){
			return jQuery(document.forms[0]).serialize();
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		PrintViewBtn.prototype.doBefore = function(){
			
			return true;
		}
		/**
		 * 按钮动作时执行的业务操作
		 */
		PrintViewBtn.prototype.doAction = function(){
			return true;
		}
		
		/**
		 * 按钮动作执行后的业务操作
		 */
		PrintViewBtn.prototype.doAfter = function(result){
			var viewid = document.getElementsByName("_viewid")[0].value;
			var signatureExist = document.getElementById("signatureExist").value;
			var url = contextPath+'/portal/dynaform/view/printView.action';
			url += '?_signatureExist=' + signatureExist;
			url += '&_activityid=' + this.actId;  
			url += '&isprint=true';
			url += '&actType='+ this.actType;
			var fmmy = document.forms[0]; 
			fmmy.action=url;
			fmwin = window.open("about:blank", "_my_submit_win");   
			fmmy.target="_my_submit_win"; 
			fmmy.submit();
			fmmy.target="";
		}
		
		PrintViewBtn._initialized = true;
	
	}
	
	
	
	return this;
}; 
/**
 * 导入Excel操作
 * 
 */
function ExcelImportBtn(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 27;
	this.impmappingconfigid = params.impmappingconfigid;
	
	
	if(typeof ExcelImportBtn._initialized == "undefined"){
		
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		ExcelImportBtn.prototype.getBeforePostData = function(){
			return jQuery(document.forms[0]).serialize();
		}
		
		/**
		 * 获取执行操作提交到后台的参数
		 */
		ExcelImportBtn.prototype.getActionPostData = function(){
			return jQuery(document.forms[0]).serialize();
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		ExcelImportBtn.prototype.doBefore = function(){
			return true;
		}
		/**
		 * 按钮动作时执行的业务操作
		 */
		ExcelImportBtn.prototype.doAction = function(){
			var impcfgid = this.impmappingconfigid
			var parentid = "";
			if (document.getElementsByName("parentid")) {
				parentid = document.getElementsByName("parentid")[0].value;
			}
			
			var application = "";
			if (document.getElementsByName("application")) {
				application = document.getElementsByName("application")[0].value;
			}

			var isRelate = "";
			if(document.getElementsByName("isRelate")){
				var relateObj = document.getElementsByName("isRelate");
				if(relateObj.length != 0)
					isRelate = relateObj[0].value;
			}
			var _viewid = document.getElementsByName("_viewid")[0].value;
			if (impcfgid) {
				var url = importURL; // importURL在各页面中定义
				url += "?parentid=" + parentid;
				url += "&id=" + impcfgid;
				url += "&application=" + application;
				url += "&isRelate=" + isRelate;
				url += "&_activityid=" + this.actId;
				url += "&_viewid=" + _viewid;
				OBPM.dialog.show({
					width : 530,
					height : 420,
					url : url,
					args : {},
					title : 'Excel导入',
					close : function(result) {
						document.forms[0].submit();
					}
				});
			}
			return false;
		}
		
		/**
		 * 按钮动作执行后的业务操作
		 */
		ExcelImportBtn.prototype.doAfter = function(result){
		}
		
		ExcelImportBtn._initialized = true;
	
	}
	
	
	
	return this;
}; 
/**
 * 批量签章操作
 * 
 */
function BatchSignatureBtn(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 29;
	
	
	if(typeof BatchSignatureBtn._initialized == "undefined"){
		
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		BatchSignatureBtn.prototype.getBeforePostData = function(){
			return jQuery(document.forms[0]).serialize();
		}
		
		/**
		 * 获取执行操作提交到后台的参数
		 */
		BatchSignatureBtn.prototype.getActionPostData = function(){
			return jQuery(document.forms[0]).serialize();
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		BatchSignatureBtn.prototype.doBefore = function(){
			if(navigator.userAgent.indexOf("MSIE")<0){
				alert("金格iSignature电子签章HTML版只支持IE，如果要签章请用IE浏览器");
				return;
			}
			var mLength = document.getElementsByName("_selects").length;
			var vItem;
			var DocumentList = "";
			for (var i = 0; i < mLength; i++) {
				vItem = document.getElementsByName("_selects")[i];
				if (vItem.checked) {
					if (i != mLength - 1) {
						DocumentList = DocumentList + vItem.value + ";";
					} else {
						DocumentList = DocumentList + vItem.value;
					}
				}
			}
			var ajax = null;
			if (window.ActiveXObject) {
				try {
					ajax = new ActiveXObject("Microsoft.XMLHTTP");
				} catch (e) {
					alert("创建Microsoft.XMLHTTP对象失败,AJAX不能正常运行.请检查您的浏览器设置.");
				}
			} else {
				if (window.XMLHttpRequest) {
					try {
						ajax = new XMLHttpRequest();
					} catch (e) {
						alert("创建XMLHttpRequest对象失败,AJAX不能正常运行.请检查您的浏览器设置.");
					}
				}
			}

			var url = document.getElementById("mGetBatchDocumentUrl").value;
			var mLoginname = document.getElementById("mLoginname").value;
			var DocumentID = document.getElementById("DocumentID").value;
			var ApplicationID = document.getElementById("ApplicationID").value
			var FormID = document.getElementById("FormID").value
			url = url + "?DocumentID=" + DocumentID + "&ApplicationID2="
					+ ApplicationID + "&FormID2=" + FormID;

			ajax.onreadystatechange = function() {
				if (ajax.readyState == 4 && ajax.status == 200) {
					if (ajax.responseText == "false") {
						return;
					}
					var documentName = ajax.responseText.split(',');
					var fildsList = "";
					for (var i = 0; i < documentName.length; i++) {
						if (i != documentName.length - 1) {
							fildsList = fildsList
									+ (documentName[i] + "=" + documentName[i] + ";");
						} else {
							fildsList = fildsList
									+ (documentName[i] + "=" + documentName[i]);
						}
					}
					if (formList.SignatureControl != null) {
						if (DocumentList == "") {
							alert("请选择需要签章的文档。");
						}
						formList.SignatureControl.FieldsList = fildsList; // 所保护字段
						formList.SignatureControl.Position(460, 275); // 签章位置
						formList.SignatureControl.DocumentList = DocumentList; // 签章页面ID
						formList.SignatureControl.WebSetFontOther("True", "同意通过", "0",
								"宋体", "11", "000128", "True"); // 默认签章附加信息及字体,具体参数信息参阅技术白皮书
						formList.SignatureControl.SaveHistory = "false"; // 是否自动保存历史记录,true保存
						formList.SignatureControl.UserName = "lyj"; // 文件版签章用户
						formList.SignatureControl.WebCancelOrder = 0; // 签章撤消原则设置,
						// 0无顺序 1先进后出
						// 2先进先出 默认值0
						// formList.SignatureControl.DivId = "contentTable"; //签章所在层
						formList.SignatureControl.AutoCloseBatchWindow = true;
						formList.SignatureControl.RunBatchSignature();
					} else {
						alert("请安装金格iSignature电子签章HTML版软件");
						document.getElementById("hreftest2").click();
					}
				}
			};
			ajax.open("POST", url);
			ajax.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
			ajax.send(null);
			return false;
		}
		/**
		 * 按钮动作时执行的业务操作
		 */
		BatchSignatureBtn.prototype.doAction = function(){
			return false;
		}
		
		/**
		 * 按钮动作执行后的业务操作
		 */
		BatchSignatureBtn.prototype.doAfter = function(result){
		}
		
		BatchSignatureBtn._initialized = true;
	
	}
	
	
	
	return this;
}; 
/**
 * 保存操作
 * 
 */
function ArchiveBtn(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 45;
	
	
	if(typeof ArchiveBtn._initialized == "undefined"){
		
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		ArchiveBtn.prototype.getBeforePostData = function(){
//			var fields = Activity.makeAllFieldAble();
			jQuery("input[moduleType='surveyField']").obpmSurveyField("getValue");
			var data = ajaxPage.getParams();
//			Activity.setFieldDisabled(fields);
			return data;
		}
		
		/**
		 * 获取执行操作提交到后台的参数
		 */
		ArchiveBtn.prototype.getActionPostData = function(){
//			var fields = Activity.makeAllFieldAble();
			jQuery("input[moduleType='surveyField']").obpmSurveyField("getValue");
			var data = ajaxPage.getParams();
//			Activity.setFieldDisabled(fields);
			return data;
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		ArchiveBtn.prototype.doBefore = function(){
			return true;
		}
		/**
		 * 按钮动作时执行的业务操作
		 */
		ArchiveBtn.prototype.doAction = function(){
			return true;
		}
		
		/**
		 * 按钮动作执行后的业务操作
		 */
		ArchiveBtn.prototype.doAfter = function(result){
		}
		
		ArchiveBtn._initialized = true;
	
	}
	
	
	
	return this;
}; 
/**
 * 启动流程操作
 * 
 * @author Happy
 */
function StartWorkflow(actId,params) {
	this.actId = actId;
	this.params = params;
	this.actType = 33;
	this.editMode = params.editMode;
	this.title = params.title;
	this.hasRun = false;
	this.flowParams = "";
	
	
	if(typeof StartWorkflow._initialized == "undefined"){
		
		/**
		 * 获取执行前操作提交到后台的参数
		 */
		StartWorkflow.prototype.getBeforePostData = function(){
//			var fields = Activity.makeAllFieldAble();
			jQuery("input[moduleType='surveyField']").obpmSurveyField("getValue");
			var data = ajaxPage.getParams();
//			Activity.setFieldDisabled(fields);
			return data;
		}
		
		/**
		 * 获取执行操作提交到后台的参数
		 */
		StartWorkflow.prototype.getActionPostData = function(){
//			var fields = Activity.makeAllFieldAble();
			jQuery("input[moduleType='surveyField']").obpmSurveyField("getValue");
			var data = jQuery(document.forms[0]).serialize()+"&_editMode="+this.editMode+"&"+this.flowParams;
//			Activity.setFieldDisabled(fields);
			return data;
		}
		/**
		 * 按钮动作执行前的准备与校验操作
		 *（返回true时继续执行操作，返回false时停止当前操作）
		 */
		StartWorkflow.prototype.doBefore = function(){
			if(this.hasRun) return true;
			//jQuery(document.forms[0]).append("<input type='hidden' name='_editMode' value='"+this.editMode+"' />");
			if(this.editMode ==null || this.editMode==0){
				var docid = document.getElementById("_docid").value;
				var formid = document.getElementById("_formid").value;
				// var moduleid=document.getElementById("moduleid").value;
				var url = contextPath
						+ '/portal/share/workflow/runtime/startWorkFlow.jsp?_docid=' + docid
						+ '&formid=' + formid;
				var showtitle = this.title;
				if (showtitle == null || showtitle == "") {
					showtitle = "Undefind";
				}
				tempAllDisabledField();
				makeFieldState(false);
				var activityType = this;
				OBPM.dialog.show({
					width : 600, // 默认宽度
					height : 420, // 默认高度
					url : url,
					args : {},
					title : showtitle,
					close : function(result) {
						if (result) {
							activityType.flowParams = result;
							activityType.hasRun = true;
							Activity.doBefore(activityType);
						}
					}
				});
				return false;
			}else if(this.editMode==1){
				setHTMLValue(); //设置html控件值
				return true;
			}
			return false;
		}
		/**
		 * 按钮动作时执行的业务操作
		 */
		StartWorkflow.prototype.doAction = function(){
			return true;
		}
		
		/**
		 * 按钮动作执行后的业务操作
		 */
		StartWorkflow.prototype.doAfter = function(result){
		}
		
		StartWorkflow._initialized = true;
	
	}
	
	
	
	return this;
}; 
(function($){
	/**
	 * tip : 提示文字
	 * tTitle : trueTitle-确认文字
	 * fTitle : falseTitle-取消文字
	 * tCall : trueCall-确认时执行的回调方法
	 * fCall : falseCall-取消时执行的回调方法
	 */
	$.extend({
		confirm : function(opts){
			var tip = opts.tip,
				tTitle = opts.trueTitle,
				fTitle = opts.falseTitle,
				tCall = opts.trueCall,
				fCall = opts.falseCall,
				returnVal = opts.returnVal;
			
			tip = tip ? tip : "您确认删除吗？";
			tTitle = tTitle ? tTitle : "确认";
			fTitle = fTitle ? fTitle : "取消";
			
			var $conf = $('<div class="confirmPanel" id="confirmPanel">'
						+'	<div class="header">提示</div>'
						+'	<div class="contenter">'
						+'		<p></p>'
						+'	</div>'
						+'	<div class="foot">'
						+'		<a class="btn pull-right  btn-link red btn-delete" data-ignore="push">' + tTitle + '</a>'
						+'		<a class="btn pull-right btn-link gay btn-cancel">' + fTitle + '</a>'
						+'	</div>'
						+'</div>');
			$conf.find(".contenter p").append(tip);
			//确认
			$conf.find(".btn-delete").bind("click", function(){
				var rtn = true;
				if(typeof tCall == "function"){
					if(returnVal){
						tCall($conf.find("textarea").val());
					}else{
						rtn = tCall();
					}
				}
				if(rtn != false){
					if(window.location.hash == "#popUpLayer"){
		        		history.go(-1);
		        	}
					$conf.remove();
				}
			//取消
			}).end().find(".btn-cancel").bind("click", function(){
				var rtn = true;
				if(typeof fCall == "function"){
					rtn = fCall();
				}
				if(rtn != false){
					if(window.location.hash == "#popUpLayer"){
		        		history.go(-1);
		        	}
					$conf.remove();
				}
			}).end().addClass("animated bounceIn").appendTo($("body"));
			location.hash = "#popUpLayer";
		}
	});
}(jQuery));; 
var ie = document.all ? 1 : 0;

var screenWidthX = screen.availWidth + 'px';
var screenWidthY = screen.availHeight + 'px';

function doExit() {
	window.close();
}

function doEmpty() {
	window.returnValue = "";
	window.close();
}
// Trim whitespace from left and right sides of s.
function trim(s) {
	return s.replace(/^\s*/, "").replace(/\s*$/, "");
}

function showViewDialog(str, viewid, fieldname, className) {
	screenWidthX = '640px';
	screenWidthY = '480px';

	var url = contextPath
			+ '/portal/share/dynaform/view/dialogFram.jsp?_viewid=' + viewid;
	url += '&className=' + className;

	var rtn = window.showModalDialog(url, str, 'font-size:9pt;dialogWidth:'
					+ screenWidthX + ';dialogHeight:' + screenWidthY + ';status:no;scroll=no;');

	var field = document.getElementById(fieldname);
	if (field) {
		if (rtn) {
			field.value = rtn.id;
		} else {
			field.value = '';
		}
		dy_view_refresh();
	}
}

function showWordDialog(title, str, docid, formName, value, fieldname, versions, opentype, displayType, saveable, isOnlyRead,signature,isSignature) {
	screenWidthX = '900px';
	screenWidthY = '600px';
	var field = document.getElementById(fieldname);
	var _versions = document.getElementById(versions);
	var application = document.getElementById("application").value;
	var url = contextPath + '/portal/dynaform/document/dostart.action?_docid='
		+ docid + "&type=word&_fieldname=" + fieldname + "&_opentype="
		+ opentype+"&_displayType="+displayType
		+ "&saveable=" + saveable
		+ "&isSignature=" + isSignature
		+ "&application=" + application
		+ "&formname=" + encodeURI(formName)
		+"&isOnlyRead="+isOnlyRead
		+"&signature="+signature;
	
	if(_versions)url+= "&versions=" + _versions.value;
	
	if (field == null) {
		url += '&filename=' + value;
	} else {
		url += '&filename=' + field.value;
	}
	
	// div弹出式
	if (opentype == '3' || opentype == 3 ) {
		OBPM.dialog.show({
					width : 900,
					height : 600,
					url : url,
					args : {},
					title : title,
					close : function(result) {
						var fieldVal = '';
						if (result) {
							var rv = result.split(';');
							fieldVal = rv[0];
							if(_versions){
								_versions.value = rv[1];
							}
						}
						if (field && fieldVal != '') {
							field.value = fieldVal;
						}
					}
				});
	} else {
		var rtn = window.showModalDialog(url, str, 'font-size:9pt;dialogWidth:'
						+ screenWidthX + ';dialogHeight:' + screenWidthY + ';status:no;scroll=no;');
		if (field) {
			if (rtn) {
				field.value = rtn;
			} else {
				field.value = '';
			}
			doc.frames['main_iframe'].frames['detail'].dy_view_refresh("");
		}
	}

}

function showWordDialogWithView(title, str, docid, value, fieldname, opentype, displayType, saveable, isOnlyRead, signature, isSignature) {
	screenWidthX = '900px';
	screenWidthY = '600px';
	var field = document.getElementById(fieldname);
	var application = document.getElementById("application").value;
	var url = contextPath + '/portal/dynaform/document/dostart.action?_docid='
		+ docid + "&type=word&_fieldname=" + fieldname + "&_opentype="
		+ opentype+"&_displayType="+displayType
		+ "&saveable=" + saveable
		+ "&application=" + application
		+"&isOnlyRead="+isOnlyRead
		+"&signature="+signature
		+"&isSignature="+isSignature;
	   
	
	if (field == null) {
		url += '&filename=' + value;
	} else {
		url += '&filename=' + field.value;
	}
	// div弹出式
	OBPM.dialog.show({
				width : 900,
				height : 600,
				url : url,
				args : {},
				title : title,
				close : function() {
					
				}
			});

}
/**
 * 获取左右选择框值
 * 
 * @param {}
 *            fieldName
 */

function showViewDialogField(title, str, viewid, mappStr, params, openType, viewType, divWidth, divHeight, maximization) {
	var url = contextPath + '/portal/share/dynaform/view/dialogTemp.jsp';
	url += '?_viewid=' + viewid;
	url += '&datetime=' + new Date().getTime();
	url += '&' + jQuery.param(params,true);
	if(divWidth == null || divWidth == "" && maximization == false){
		url += '&_defaultSize=true';//后台显示大小为默认时，允许页面根据内容设置弹出层大小
	}
	var width = 640;
	var height = 400;
	divWidth = divWidth.replace(/(^\s*)|(\s*$)/g, "");
	if(divWidth.length > 0){
		width = divWidth;
	}

	divHeight = divHeight.replace(/(^\s*)|(\s*$)/g, "");
	if(divHeight.length > 0){
		height = divHeight;
	}
	OBPM.dialog.show({
				width : width, // 默认宽度
				height : height, // 默认高度
				url : url,
				args : {'html': new String(str), 'parent': window},
				maximization: maximization,
				title : title,
				close : function(result) {
					var rtn = result;
					// 0x0000011 为树形视图, 0x0000010为日历视图
					if (viewType!=0x0000011 && viewType!=0x0000010) {
						if(params.selectOne=="false"|| params.selectOne==false){
							getDialogValue(mappStr, rtn);
						}else{
							getDialogSelectValue(mappStr, rtn);
						}
					} else {
						getDialogValue(mappStr, rtn);
					}
				}
			});
}

function getDialogSelectValue(mappStr,rtn){
	var mappStr = HTMLDencode(mappStr);
	var mapps = mappStr.split(";");
	if (rtn != undefined) {
		for (var i = 0; i < mapps.length; i++) {
			var rel = mapps[i].split(":");
			var colName = rel[0];
			var fldName = rel[1];
			var valStr = rtn;
			
			//alert(valStr);
			var fields = document.getElementsByName(fldName);
			
			if (fields.length > 0
					&& fields[0].tagName.toUpperCase() == 'SELECT') {
				if (!isOptionExisted(fields[0], valStr)) {
					var oOption = document.createElement("OPTION");
					oOption.text = "";
					oOption.value = valStr;
					fields[0].add(oOption);
				}
				selectOne(fields[0], valStr);//选中text为valStr的选项
				DWREngine.setAsync(false);
				jQuery(fields[0]).change();//手动调用onchange方法
			} else if (fields.length > 0
					&& (fields[0].type.toUpperCase() == 'RADIO' || fields[0].type
							.toUpperCase() == 'CHECKBOX')) {
				for (n = 0; fields.length > n; n++) {
					var vals = valStr.split(";");
					if (vals.indexOf(fields[n].value) != -1) {
						fields[n].checked = true;
					} else {
						fields[n].checked = false;
					}
				}
			} else {
				var isRefreshOnChanged = jQuery(fields).attr("isRefreshOnChanged");
				isRefreshOnChanged = (isRefreshOnChanged == "true");
				if (fields.length == 0) {
					fields.value = valStr;
				} else {
					fields[0].value = valStr;
				}
				if(isRefreshOnChanged) {DWREngine.setAsync(false);dy_refresh(fldName);}
			}
		}
		return true;
	} else {
		return false;
	}
}

/**
 * 视图选择框单选和多选选择后执行的方法
 * @param mappStr：字段映射关系
 * @param rtn：视图选择框中的返回值
 * @returns {Boolean}
 */
function getDialogValue(mappStr, rtn) {

	if (!mappStr || !rtn) {
		return false;
	}
	
	//选项是否存在
	var isOptionExisted = function(oSel, selectedText) {
		for (var i = 0; i < oSel.options.length; i++) {
			if (oSel.options[i].text == selectedText) {
				return true;
			}
		}
		return false;
	};
	
	//选择选项
	var selectOne = function(oSel, selectedText) {
		for (n = 0; oSel.options.length > n; n++) {
			if (selectedText == oSel.options[n].text) {
				oSel.options[n].selected = true;
				return true;
			}
		}
		return false;
	};
	
	//数据转换
	var conversionVal = function(valStr){
		var reg = /&nbsp;/g;
		var reg1 = /%&0000/g;
		var reg2 = /%&0001/g;
		var reg3 = /%23/g;
		valStr = valStr.replace(reg, "");
		valStr = valStr.replace(reg1, "\r");
		valStr = valStr.replace(reg2, "\n");
		valStr = valStr.replace(reg3, "#");
		
		if(valStr=="&nbsp"){
			valStr = "";
		}
		return valStr;
	};
	
	//转换JSON格式的对象
	var conversionJSONVal = function(valStr) {
		if(valStr != null && valStr != "null" &&  valStr != null && valStr != ""){
			var json = "";
			try{
				json = JSON.parse(valStr);
			}catch(e){
				try{
					var jsonArray = new Array();
				    var strs= new Array();
				    strs = valStr.split(";");
				    for(var index = 0 ;  index < strs.length ; index ++ ){
				    	try{
				    		json = JSON.parse(strs[index]);
					    	for(var arr in json ){
					    		jsonArray.push(json[arr]);
					    	}
				    	}catch(e){
				    		
				    	}
				  }
				  valStr = JSON.stringify(jsonArray);
				}catch(e){
					valStr = ""
				}
			}
		   }
		return valStr ;
	};
	
	//从JSON格式的对象中获取显示值
	var getShowValFromValStr = function(valStr) {
		if(valStr != null && valStr != "null" &&  valStr != null && valStr != ""){
			if(valStr.indexOf("[{") >= 0 ){
                var _valStr = valStr.substring(1,valStr.length-1); 
				var json = "";
				try{
					json = JSON.parse(_valStr);
					valStr = json["key"];
				}catch(e){
					
				}
			}
		 }
		return valStr ;
	};
	
	//设置字段数据
	var setFieldVal = function(fldName, valStr){

		var fields = ajaxPage.getCurPage().find("[name='" + fldName + "']");
		
		if(!fields || fields.length == 0){
			console.error("视图选择框映射字段'" + fldName + "'不存在！");
			return false;
		}
		
		var _tagName = fields[0].tagName.toUpperCase();
		var _type = fields[0].type ? fields[0].type.toUpperCase() : "";
		var _fieldtype = fields[0].getAttribute("fieldtype");

		if (_tagName == 'SELECT' && _fieldtype != "DepartmentField") {	//下拉、左右选择
//			if (!isOptionExisted(fields[0], valStr)) {
//				var oOption = document.createElement("OPTION");
//				oOption.text = "";
//				oOption.value = valStr;
//				fields[0].add(oOption);
//			}
			var isSelect = selectOne(fields[0], valStr);//选中text为valStr的选项
			if(!isSelect){	//text未选中时使用value选中，value为真实值，text为显示值，保证两个有其一就可以选中
				$(fields[0]).val(valStr);
				valStr = $(fields[0]).find("option[value="+valStr+"]").text();
			}
			var fldShow = document.getElementById(fldName + "_show");
			if(fldShow){
				fldShow.innerText = valStr;
			}
			
			DWREngine.setAsync(false);
			jQuery(fields[0]).change();		//手动调用onchange方法
		} else if ((_type == 'RADIO' || _type == 'CHECKBOX')) {	//单（多）选框
			for (n = 0; fields.length > n; n++) {
				var vals = valStr.split(";");
				for(j=0;j<vals.length;j++){
					if(vals[j] == fields[n].value || vals[j] == fields[n].getAttribute("text")){
						fields[n].checked = true;
						break;
					} else {
						fields[n].checked = false;
					}
				}
			}
		}else if(_fieldtype == "AttachmentUploadField"){		//文件上传控件
			var $field ;
			$.each(fields,function (index){
				var uploadlist = $(this).attr("uploadlist");
				if( uploadlist != undefined && uploadlist != null &&  uploadlist != "" ){
					$field = $(this);
					return false;
				}
				});
			valStr = conversionJSONVal(valStr);
			$field.siblings().remove();
			$field.attr("value",valStr).obpmUploadField();  			//文件（图片）上传功能
		}else if(_fieldtype == "ImageUploadField"){		//图片上传控件
			valStr = conversionJSONVal(valStr);
			var $field = jQuery(fields[0]);
			$field.siblings().remove();
			$field.removeData("weixinImageUpload").attr("value",valStr).obpmUploadField();  			//文件（图片）上传功能
		}else if(_fieldtype == "UserField"){      // 用户选择框

			if(valStr != null){
				var userStr = eval("(" + valStr + ")");
				var rtnValue = fields[0].id;
				var rtnText = rtnValue+"_text";
				$("#"+rtnValue).val(userStr[0].value);
				$("#"+rtnText).append(userStr[0].key);
				$("#"+rtnText).attr("value", userStr[0].key);
				var fldShow = document.getElementById(fldName + "_show");
				if(fldShow){
					fldShow.innerText = userStr[0].key;
				}
			}
		}else if(_fieldtype == "DepartmentField"){

			if(valStr != null){
//				fields[0].value = valStr;
//				var textStr = $(fields[0]).find("option[value="+valStr+"]").text();	//显示值
//				var fldShow = document.getElementById(fldName + "_show");
//				if(fldShow){
//					fldShow.innerText = textStr;
//				}
				var userStr = eval("(" + valStr + ")");
				var rtnValue = fields[0].id;
				var rtnText = rtnValue+"_text";
				$("#"+rtnValue).val(userStr[0].value);
				$("#"+rtnText).append(userStr[0].key);
				$("#"+rtnText).attr("value", userStr[0].key);
				var fldShow = document.getElementById(fldName + "_show");
				if(fldShow){
					fldShow.innerText = userStr[0].key;
				}
			}
		}else if(_fieldtype == "DateField"){      //日期选择框
			fields[0].value = valStr;
			var fldShow = document.getElementById(fldName + "_show");
			if(fldShow){
				fldShow.innerText = valStr;
			}
		}else if(_fieldtype == "TreeDepartmentField"){
			
			if(valStr != null){
				var userStr = eval("(" + valStr + ")");
				var rtnValue = fields[0].id;
				var rtnText = rtnValue+"_text";
				$("#"+rtnValue).val(userStr[0].value);
				$("#"+rtnText).val(userStr[0].key);
				var fldShow = document.getElementById(fldName + "_show");
				if(fldShow){
					fldShow.innerText = userStr[0].key;
				}
			}
		}else if(_fieldtype == "SuggestField"){ // 智能搜索框
			
			if(valStr != null){
				var suggestStr = eval("(" + valStr + ")");
				var suggestField = fields[0].id;
				var suggestField_show = suggestField + "_show";
				var value = suggestStr.value? suggestStr.value:'';
				var key = suggestStr.key? suggestStr.key:'';
				$("#"+suggestField).val(value);
				$("#"+suggestField_show).val(key);
				var fldShow = document.getElementById(fldName + "_show1");
				if(fldShow){
					fldShow.innerText = key;
				}
			}
		} else {	//其他控件
			
			valStr = getShowValFromValStr(valStr);
			
			if(_tagName == "TEXTAREA"){
				fields[0].value = HTMLDencode(valStr);
			}else{
				fields[0].value = valStr;
			}
			if(_type.toUpperCase() == 'HIDDEN' || _tagName == "TEXTAREA" || _tagName == "INPUT"){	//hotfix 建议重构（控件只读时只显示值）
				var fldShow = document.getElementById(fldName + "_show");
				if(fldShow){
					if(_tagName == "TEXTAREA"){
						fldShow.innerText = HTMLDencode(valStr);
					}else if(_tagName == "INPUT" && _fieldtype != "SuggestField"){	//单行
						fldShow.innerText = valStr;
					}else{
						fldShow.value = valStr;
					}
				}
			}
			
			var isRefreshOnChanged = jQuery(fields).attr("isRefreshOnChanged");
			isRefreshOnChanged = (isRefreshOnChanged == "true");
			if(isRefreshOnChanged) {	//设置了触发刷新的控件，值修改后执行刷新动作
				DWREngine.setAsync(false);
				dy_refresh(fldName);
			}
		}
	};
	
	var mappStr = HTMLDencode(mappStr);
	var mapps = mappStr.split(";");

	rtn = eval("(" + rtn + ")");
//	rtn = JSON.parse(rtn);	//转成json对象
	/**
	 * 数据结构说明
	 * rtn:
	 * 单选：{id:{'字段id1':'val1','字段id2':'val2'}}
	 * 多选：	{"docid1":{
					"字段id1":"val1",
					"id1_doc":"val2"},
				"docid2":{
					"字段id1":"val21",
					"字段id2":"val22"}
				}
		rtnObj:
		单选：{'字段id1':'val1','字段id2':'val2'}
		多选：	{
					"字段id1":"val1;val21",
					"id1_doc":"val2;val22"}
	 */
	var rtnObj = {};
	for(var i in rtn){
		var tem = rtn[i];
		
		for(var o in tem){
			rtnObj[o] = rtnObj[o] ? (rtnObj[o] + ";" + tem[o]) : tem[o];
		}
	}
	
	for (var i = 0; i < mapps.length; i++) {	//循环字段
		var rel = mapps[i].split(":");
		var colName = rel[0];	//字段id
		var fldName = rel[1];	//字段name
		var valStr = '';
		
		valStr = rtnObj[colName];
		valStr = HTMLDencode(valStr);
		valStr = conversionVal(valStr);		//数据转换
		
		setFieldVal(fldName, valStr);			//设置字段值
	}
}

function selectAll(oldValue, multiSelect, selectChild) {
	screenWidthX = '600px';
	screenWidthY = '400px';
	var url = contextPath + '/core/department/select.action';

	// alert("oldValue->" + oldValue);
	var selectid = "";
	if (oldValue != null && oldValue != "") {
		oldValue = oldValue.replace("(", "");
		oldValue = oldValue.replace(")", "");
		oldValue = oldValue.replace("{", "");
		oldValue = oldValue.replace("}", "");
		var tmp = oldValue.split(";");
		for (var i = 0; i < tmp.length; i++) {
			var t = tmp[i].split("|");
			if (t != null && t[0] != '') {
				selectid = selectid + t[0] + ";";
			}
		}
	}
	url = url + '?SELECTEDID=' + selectid;

	if (multiSelect != null && multiSelect) {
		url = url + '&MULTISELECT=TRUE';
	}
	if (selectChild != null && selectChild) {
		url = url + '&SELECTCHILD=TRUE';
	}
	//
	// if (type == 'U' && parentDept != null) {
	// url = url + '&sm_deptid=' + parentDept;
	// }
	// alert("url->"+url);
	var rtn = showframe('', url);

	return rtn;
}


/**
 * 显示前台弹出框
 * 
 * @param {}
 *            options
 */
function showfrontframe(options) {
	var title = options.title;
	var querystr = options.url;
	var width = options.w ? options.w : 300;
	var height = options.h ? options.h : 400;
	
	var arg = new Object();
	arg.title = title;
	arg.url = querystr;
	arg.windowObj = options.windowObj;
	
	
	var url = contextPath + '/portal/share/frame.jsp?title=' + title;
	OBPM.dialog.show({
				width : width,
				height : height,
				url : url,
				args : arg,
				title : title,
				close : function(result) {
					var rtn = result;
					options.callback(rtn);
				}
			});
}

function showframe(title, querystr, isDiv) {
	var pth = window.location.pathname;
	var pos1 = pth.lastIndexOf("/");
	var pos2 = pth.lastIndexOf("\\");
	var pos = Math.max(pos1, pos2);
	querystr.title = title;
	if (querystr.url != null) {
		if (!(querystr.url.indexOf("/") == 0 || querystr.url.indexOf("\\") == 0))
			querystr.url = pth.substring(0, pos) + "/" + querystr.url;
	} else {
		if (!(querystr.indexOf("/") == 0 || querystr.indexOf("\\") == 0))
			querystr = pth.substring(0, pos) + "/" + querystr;
	}
	var arg = new Object();
	arg.title = title;
	arg.url = querystr;
	arg.window = this.window;
	// alert(isDiv);
	if (!isDiv) {
		return parent.showModalDialog(
				contextPath + '/portal/share/frame.jsp?title=' + title, arg,
				'resizable=yes;help=no;status=no;font-size:9pt;dialogWidth:'
						+ screenWidthX + ';dialogHeight:' + screenWidthY + ';status:no;scroll:no;');
	} else {
		showFrameByDiv(arg.url, arg.title);
	}
}


/* 显示鼠标右击菜单 */
function closeParentDiv() {
	var frameContent = window.frames['FrameContent'];
	var FrameContent_dialog = window.parent.frames['FrameContent_dialog'];
	if (frameContent) {
		try {
			if (window.document.getElementById('FrameContent')) {
				window.document.getElementById('FrameContent').style.display = 'none';
				window.document.getElementById('closeWindow_DIV').style.display = 'none';
				window.document.getElementById('PopWindows').style.display = 'none';
				window.document.getElementById('dbody').style.height = '100%';
				window.document.getElementById('PopWindows').style.height = '0px';
			}
			frameContent.closePopWindows();
		} catch (e) {

		}
	}
	if (FrameContent_dialog) {
		FrameContent_dialog.closePopWindows();
	}
}


function addParam(url, name, val) {
	if (url != null && name != null) {
		if (url.indexOf('?') == -1) {
			url = url + '?' + name + '=' + val;
		} else {
			url = url + '&' + name + '=' + val;
		}
	}
	return url;
}


function getSelectedValue(Obj) {
	if (Obj != null && Obj.options.length > 0) {
		return Obj.options[Obj.selectedIndex].value;
	}
	return "";
}

function selectOne(Obj, value, callback) {
	if (Obj != null) {
		for (i = 0; i < Obj.options.length; ++i)
			if (Obj.options[i].value == value) {
				Obj.selectedIndex = i;
				if (callback) {
					callback(Obj);
				}
				break;
			}
	}
}
function setCheck(els, value) {
	for (i = 0; i < els.length; ++i) {
		if (typeof(value) == "object") {
			els[i].checked = (value.indexOf(els[i].value) >= 0);
		} else {
			els[i].checked = els[i].value == value;
		}
	}
}

function putToValuesMap(valuesMap, fldName, value) {
	var oFld = document.getElementsByName(fldName)[0];
	if (oFld) {
		valuesMap[fldName] = value;
	}
}
// ????????????
function selectOrg(fieldId, fieldName, multiSelect, showLayer, selectLayer,
		DLayer, GLayer, ULayer) {
	screenWidthX = '500px';
	screenWidthY = '500px';
	var url = contextPath + '/framework/selectOrg.do?x=';
	if (fieldId != null)
		url = url + '&FieldID=' + fieldId.value;
	if (fieldName != null)
		url = url + '&FieldName=' + fieldName.value;
	if (multiSelect != null && multiSelect)
		url = url + '&MultiSelect=true';
	if (showLayer != null)
		url = url + '&ShowLayer=' + showLayer;
	if (selectLayer != null)
		url = url + '&SelectLayer=' + selectLayer;
	if (DLayer != null)
		url = url + '&DLayer=' + DLayer;
	if (GLayer != null)
		url = url + '&GLayer=' + GLayer;
	if (ULayer != null)
		url = url + '&ULayer=' + ULayer;
	var rtn = showframe('????', url);
	// var rtn = window.open(url,"_blank","");
	return (rtn == null ? "" : rtn);
}


function HTMLEncode(text) {
	var textold;
	do {
		textold = text;
		
		text = text.replace(/&/g, "@amp;") ;
		text = text.replace(/"/g, "@quot;") ;
		text = text.replace(/</g, "@lt;") ;
		text = text.replace(/>/g, "@gt;") ;
		text = text.replace(/'/g, "@#146;") ;
		text = text.replace(/\ /g,"@nbsp;");
		text = text.replace(/\r/g,'&#10;');
		text = text.replace(/\n/g,'&#13;');
	} while (textold != text);

	return text;
}

function HTMLDencode(text) {
	var textold;
	if(text){
		do {
			textold = text;
			
			text = text.replace("@amp;", "&");
			text = text.replace('@quot;', '"');
			text = text.replace("@lt;", "<");
			text = text.replace("@gt;", ">");
			text = text.replace("@#146;", "'");
			text = text.replace("@nbsp;", " ");
			text = text.replace("&nbsp;", " ");
			text = text.replace("&#10;", "\r");
			text = text.replace("&#13;", "\n");
		} while (textold != text);
		return text;
	}else return '';
	
}

function characterDencode(text){
	var textold;
	if(text){
		do {
			textold = text;
			
			text = text.replace("@amp;", "&");
			text = text.replace('@quot;', '"');
			text = text.replace("@lt;", "<");
			text = text.replace("@gt;", ">");
			text = text.replace("@#146;", "&apos;");
			text = text.replace("@nbsp;", " ");
			text = text.replace("&nbsp;", " ");
			text = text.replace("&#10;", "\r");
			text = text.replace("&#13;", "\n");
		} while (textold != text);
		return text;
	}else return '';
};

// 单击列头排序
function sortTable(nColName) {
	var colEl = document.getElementsByName("_sortCol")[0];
	var oColName = colEl.value;
	changeStatus(oColName, nColName);
	document.forms[0].submit();
}

// 改变排序状态
function changeStatus(oCol, nCol) {
	var statusEl = document.getElementsByName("_sortStatus")[0];
	var colEl = document.getElementsByName("_sortCol")[0];
	if (oCol != nCol && oCol.toUpperCase() != nCol.toUpperCase()) {
		statusEl.value = "ASC";
		colEl.value = nCol;
	} else {
		if (statusEl.value == "ASC") {
			statusEl.value = "DESC";
			colEl.value = nCol;
		} 
		/*
		else if (statusEl.value == "DESC") {
			statusEl.value = "";
			colEl.value = "";
		} 
		*/
		else {
			statusEl.value = "ASC";
			colEl.value = nCol;
		}
	}
}

function doAlert(msg) {
	if (msg) {
		alert(msg);
		if(isCloseDialog && isCloseDialog == 'true')
			OBPM.dialog.doExit();
	}
}

function doConfirm(msg, url) {
	if (msg) {
		if (confirm(msg)) {
			if(url){
//				makeAllFieldAble();
				document.forms[0].action = url;
				document.forms[0].submit();
			}
		}
	}
}

//function makeAllFieldAble(elements) {
//	if (!elements) {
//		elements = document.forms[0].elements;
//	}
//	for (var i = 0; i < elements.length; i++) {
//		var element = elements[i];
//		if (element.disabled == true) {
//			// alert("****type->" + element.type);
//			element.disabled = false;
//		}
//	}
//}
var fontColor = "";
//设置按钮为灰色且不能再操作
function toggleButton(btnName) {
	var isBreak = false;
	var button_acts = document.getElementsByName(btnName);
	for (var i = 0,length = button_acts.length; i < length; i++) {
		if(button_acts[i].getAttribute("isLoad") == "false"){
			isBreak = true;
		}else{
			button_acts[i].setAttribute("isLoad","false");
			button_acts[i].style.color = "gray";
		}
	}
	return isBreak;
}

//恢复按钮状态且可操作
function recoveryButSta(btnName) {
	var button_acts = document.getElementsByName(btnName);
	for (var i = 0,length = button_acts.length; i < length; i++) {
			button_acts[i].setAttribute("isLoad","");
			button_acts[i].style.color = "";
	}
}

/**
 * 所有校验
 */
var Validations = {
	"great-than" : function(v, els, args) { // 是否大于args.value
		var isPositiveNumber = Validations["is-positive-number"];
		if (isPositiveNumber(v)) {
			return new Number(v) > args.value;
		}
		return false;
	},
	"equal-great-than" : function(v, els, args) { // 是否大于args.value
		var isPositiveNumber = Validations["is-positive-number"];
		if (isPositiveNumber(v)) {
			return new Number(v) >= args.value;
		}
		return false;
	},
	"is-positive-number" : function(v) {// 是否为正数
		return /^\d+\.*\d*$/.test(v);
	},
	"required-one" : function(v, els) { // 是否必须选中一个
		return jQuery.each(els,function(n,value){
			if(!!value){
				return value;
			}
		});
	},
	"required" : function(v) { // 是否必须
		if (v && v != '0') {
			return true;
		}
		return false;
	}
}

/**
 * 通过返回true, 不通过返回false, 依赖Prototype validator = {fieldName: "需校验的字段名称", type:
 * "调用的校验function(如：required)", msg:"错误信息" }; validators = [validator1,
 * validator2];
 */
function doValidate(validators) {
	var msg = "";
	for (var i = 0; i < validators.length; i++) {
		var validator = validators[i];
		var els = document.getElementsByName(validator.fieldName);
		var validation = Validations[validator.type];
		var isPassed = false;
		if (els && els.length > 1) {
			isPassed = validation(jQuery(els[0]).val(), els);
		} else {
			isPassed = validation(jQuery(els[0]).val(), els, validator.args);
		}
		if (!isPassed)
			msg += validator.msg + ", ";
	}

	if (validators && validators.length > 0) {
		msg = msg.substring(0, msg.lastIndexOf(","));
	}

	var errorId = "error";
	if (msg) {
		alert(msg);
		return false;
	}
	return true;
}

/*
 * common js for front
 * 2010-9-25
 */
function showDialogByDiv(title,url,width,height,isReload) {
	if(!width || width == "") width = "800";
	OBPM.dialog.show({
				width : width, // 默认宽度
				height : height, // 默认高度
				url : url,
				args : {},
				title : title,
				close : function(result) {
					var rtn = result;
					//alert("test1");
					if(isReload)
//						window.location.reload();
						document.forms[0].submit();
				}
			});
}

/**
 * 刷新后台软件树形菜单,页面需要一个隐藏字段用作判断(<ww:hidden id="refreshid" name="refresh" />)
 * @param {} isRefreshField 是否刷新字段
 */
/**
 * 获取本地Cookie
 * @param cookie_name cookie名称
 * @return
 */
function getCookie(cookie_name) {
	var allcookies = document.cookie;
	var cookie_pos = allcookies.indexOf(cookie_name);
	// 如果找到了索引，就代表cookie存在，
	// 反之，就说明不存在。
	if (cookie_pos != -1) {
		// 把cookie_pos放在值的开始，只要给值加1即可。
		cookie_pos += cookie_name.length + 1;
		var cookie_end = allcookies.indexOf(";", cookie_pos);
		if (cookie_end == -1) {
			cookie_end = allcookies.length;
		}
		return unescape(allcookies.substring(cookie_pos, cookie_end));
	}
	return null;
}


/**
 * 隐藏的iframe控件，避免遮挡
 * @return
 */
function hiddenDocumentFieldIncludeIframe(){
	jQuery("iframe").each(function(){
		/*
		 * firebug报错:jQuery(this)... is undefined
		 * 
		if(jQuery(this).attr("src").indexOf("newword")>-1 || jQuery(this).attr("src").indexOf("baidumap")>-1){
			jQuery(this).css("visibility","hidden");
		}
		*/
		try{
			if(jQuery(this).attr("src").indexOf("newword")>-1 || jQuery(this).attr("src").indexOf("baidumap")>-1){
				jQuery(this).css("visibility","hidden");
			}
		}
		catch(e){
			return;
		}
	});
}

/*
 * 显示被隐藏的iframe控件
 */
function showDocumentFieldIncludeIframe(){
	jQuery("iframe").each(function(){
		if(jQuery(this).attr("src") != undefined && jQuery(this).attr("src") != "undefined"){
			if(jQuery(this).attr("src").indexOf("newword")>-1 || jQuery(this).attr("src").indexOf("baidumap")>-1){
				jQuery(this).css("visibility","visible");
			}
		}
	});
}

/**
 * 浏览器判断
 * return brow:ie6/ie7/ie8/ie9/firefox/chrome/safari
 */
function getBrowser(){
	var brow = "";
	if(navigator.userAgent.indexOf("MSIE")>0) { 
	   	var browser = navigator.appName 
		var version = navigator.appVersion.split(";"); 
		var trim_Version = version[1].replace(/[ ]/g,"");
		
		if(browser=="Microsoft Internet Explorer" && trim_Version=="MSIE6.0") 
		{ 
			brow = "ie6";
		} 
		else if(browser=="Microsoft Internet Explorer" && trim_Version=="MSIE7.0") 
		{ 
			brow = "ie7";
		} 
		else if(browser=="Microsoft Internet Explorer" && trim_Version=="MSIE8.0") 
		{ 
			brow = "ie8";
		} 
		else if(browser=="Microsoft Internet Explorer" && trim_Version=="MSIE9.0") 
		{ 
			brow = "ie9";
		}
	}  
	if(isFirefox=navigator.userAgent.indexOf("Firefox")>0){  
		brow = "firefox";
	}  
	if(isChrome=navigator.userAgent.indexOf("Chrome")>0) {  
		brow = "chrome";
	}
	if(isSafari=navigator.userAgent.indexOf("Safari")>0) {  
		brow = "safari";
	}
	return brow;
}

/*
 * URL转码
 */
function URLDecode( text ){
	if ( !text )
		return '' ;

	text = text.replace( /&gt;/g, '>' ) ;
	text = text.replace( /&lt;/g, '<' ) ;
	text = text.replace( /&amp;/g, '&' ) ;

	return text ;
}
; 
var listAction = "";
var actionMode = '<ww:property value="params.getParameterAsString(\'actionMode\')"/>';
window.onload = function() {
	if (document.forms[0]) {
		var url = document.forms[0].action;
		url = url.substring(url.indexOf(contextPath));
		if(url==contextPath+"/core/user/treelist.action"){
			try{
				var superiorid=window.parent.document.getElementById("selectnode").value;
				var name=window.parent.document.getElementById("name").value;
				var loginno=window.parent.document.getElementById("loginno").value;
				var roleid=window.parent.document.getElementById("roleid").value;
				var targetUrl = "?departid="+superiorid+"&sm_userRoleSets.roleId="+roleid;
				if(orderBy != null && orderBy != ''){
					var orderByField = document.getElementsByName("_orderby")[0];
					if(orderByField && orderByField.value==orderBy){
					}else{
						targetUrl = targetUrl + "&_orderby=orderByNo&&_orderby=id";
					}
				}
				listAction = document.forms[0].action+targetUrl;//原URL如下
				//listAction = document.forms[0].action+"?departid="+superiorid+"&sm_name="+name+"&sm_loginno="+loginno+"&sm_userRoleSets.roleId="+roleid;
			}catch(e){}
			
		}else if(url==contextPath+"/core/department/departmentlist.action"){
			try{
			var superiorid2=window.parent.document.getElementById("selectnode").value;
			var departmentname=window.parent.document.getElementById("departname").value;
			//listAction = document.forms[0].action+"?sm_superior.id="+superiorid2+"&sm_name="+departmentname;
			listAction = document.forms[0].action+"?sm_superior.id="+"&sm_name="+departmentname;
			 }catch(e){}
		}else if(url==contextPath+"/core/domain/list.action"){
			try{
				var userId=document.getElementById("usersId").value;
				listAction = document.forms[0].action+"?t_users.id="+userId;
				 }catch(e){}
		}else if(url==contextPath+"/portal/dynaform/work/workList.action"){
			listAction = document.forms[0].action + '?actionMode=' + actionMode;
		}else{
			listAction = document.forms[0].action;
		}
	}
}
function selectAll(b, isRefresh) {
	var c = document.getElementsByName("_selects");
	if (c == null)
		return;

	if (c.length != null) {
		for (var i = 0; i < c.length; ++i)
			c[i].checked = b && !(c[i].disabled);
	} else {
		c.checked = b;
	}
}

function selectAllByField(b, fieldName) {
	var c = document.getElementsByName(fieldName);

	if (c == null)
		return;

	if (c.length != null) {
		for (var i = 0; i < c.length; ++i)
			c[i].checked = b && !(c[i].disabled);
	} else {
		c.checked = b;
	}
}

//待办跳转页面
function jumpPage() {
	if (isNaN(parseInt(document.forms[0]._currpage.value))
			|| isNaN(parseInt(document.forms[0]._pagelines.value))
			|| isNaN(parseInt(document.forms[0]._jumppage.value))
			|| isNaN(parseInt(document.forms[0]._rowcount.value))) {
		return;
	}

	var pageNo = parseInt(document.forms[0]._jumppage.value);
	var _pageCount = parseInt(document.forms[0]._pageCount.value);
	var pageCount = Math.ceil(parseInt(document.forms[0]._rowcount.value)
			/ parseInt(document.forms[0]._pagelines.value));
	if (pageNo > _pageCount||pageNo<=0||isNaN(pageNo)) {
		alert(" 输入参数有误!");
		return;
	}
	if (pageCount > 1 && pageCount >= pageNo) {
		if (listAction) {
			document.forms[0].action = listAction;
		}
		document.forms[0]._currpage.value = pageNo;
		document.forms[0].submit();
	}
}

//回车触发页码跳转
function enterJump(){
	jQuery("input[name='_jumppage']").keydown(function(){
		if(event.keyCode == 13){
			jumpPage();
			return false;
		}
	});
}

//待阅翻到第一页
function showCirculatorFirstPage(FO) {
	listAction = contextPath+"/portal/workflow/storage/runtime/workList.action?actionMode=circulator";
	showFirstPage(FO);
}

//待阅翻到上一页
function showCirculatorPreviousPage(FO) {
	listAction = contextPath+"/portal/workflow/storage/runtime/workList.action?actionMode=circulator";
	showPreviousPage(FO);
}

//待阅翻到下一页
function showCirculatorNextPage(FO) {
	listAction = contextPath+"/portal/workflow/storage/runtime/workList.action?actionMode=circulator";
	showNextPage(FO);
}

//待阅翻到最后一页
function showCirculatorLastPage(FO) {
	listAction = contextPath+"/portal/workflow/storage/runtime/workList.action?actionMode=circulator";
	showLastPage(FO);
}

//待阅跳转页面
function jumpPageCirculator() {
	listAction = contextPath+"/portal/workflow/storage/runtime/workList.action?actionMode=circulator";
	jumpPage();
}

function resetPage(FO) {
	if (FO == null) {
		FO = document.formList;
	}
	FO[0]._currpage.value = '1';
}

function resetForm(FO) {
	if (FO == null) {
		FO = document.formList;
	}
	FO[0]._orderby.value = '';
	FO[0]._desc.value = '';
	FO[0]._currpage.value = '1';
}

function resetAll() {
	var elements = document.forms[0].elements;
	for (var i = 0; i < elements.length; i++) {
		var elementName = elements[i].name;
		if ((elementName.indexOf("sm_") > -1)
				|| (elementName.indexOf("d_") > -1) || (elementName.indexOf("s_") > -1)) {
			elements[i].value = "";
		}
	}
}
function resetQuery(clearName){
	var name;
	if(clearName){
		name = document.getElementsByName(clearName)[0];
	}else{
		name = document.getElementsByName("sm_name")[0];
	}
	name.value="";
}
//10.12.26 jack add param of "msg" for internationalization question of window tips
function isSelectedOne(fldName,msg) {
	var c = document.getElementsByName(fldName);
	var flag = false;
	if (c && c.length > 0) {
		for (var i = 0; i < c.length; i++) {
			if (c[i].checked) {
				flag = true;
				break;
			}
		}
	}

	if (!flag) {
		alert(msg);
		return false;
	}
	return true;
}


/*
 * 修饰table js方法
 * 1、隔行变色 2、mouseover变色
 * */
function cssListTable(){
	jQuery("#contentTable tr").css("background-color","white");
	jQuery("#contentTable tr:even").css("background-color","#EEF0F2");
	jQuery("#contentTable tr").mouseover(function(){
		jQuery(this).addClass("mouseontr");
	}).mouseout(function(){
		jQuery(this).removeClass("mouseontr");
	});
}

/*
 * 初始化list div的位置
 * */
; 
/*!art-template - Template Engine | http://aui.github.com/artTemplate/*/
!function(){function a(a){return a.replace(t,"").replace(u,",").replace(v,"").replace(w,"").replace(x,"").split(y)}function b(a){return"'"+a.replace(/('|\\)/g,"\\$1").replace(/\r/g,"\\r").replace(/\n/g,"\\n")+"'"}function c(c,d){function e(a){return m+=a.split(/\n/).length-1,k&&(a=a.replace(/\s+/g," ").replace(/<!--[\w\W]*?-->/g,"")),a&&(a=s[1]+b(a)+s[2]+"\n"),a}function f(b){var c=m;if(j?b=j(b,d):g&&(b=b.replace(/\n/g,function(){return m++,"$line="+m+";"})),0===b.indexOf("=")){var e=l&&!/^=[=#]/.test(b);if(b=b.replace(/^=[=#]?|[\s;]*$/g,""),e){var f=b.replace(/\s*\([^\)]+\)/,"");n[f]||/^(include|print)$/.test(f)||(b="$escape("+b+")")}else b="$string("+b+")";b=s[1]+b+s[2]}return g&&(b="$line="+c+";"+b),r(a(b),function(a){if(a&&!p[a]){var b;b="print"===a?u:"include"===a?v:n[a]?"$utils."+a:o[a]?"$helpers."+a:"$data."+a,w+=a+"="+b+",",p[a]=!0}}),b+"\n"}var g=d.debug,h=d.openTag,i=d.closeTag,j=d.parser,k=d.compress,l=d.escape,m=1,p={$data:1,$filename:1,$utils:1,$helpers:1,$out:1,$line:1},q="".trim,s=q?["$out='';","$out+=",";","$out"]:["$out=[];","$out.push(",");","$out.join('')"],t=q?"$out+=text;return $out;":"$out.push(text);",u="function(){var text=''.concat.apply('',arguments);"+t+"}",v="function(filename,data){data=data||$data;var text=$utils.$include(filename,data,$filename);"+t+"}",w="'use strict';var $utils=this,$helpers=$utils.$helpers,"+(g?"$line=0,":""),x=s[0],y="return new String("+s[3]+");";r(c.split(h),function(a){a=a.split(i);var b=a[0],c=a[1];1===a.length?x+=e(b):(x+=f(b),c&&(x+=e(c)))});var z=w+x+y;g&&(z="try{"+z+"}catch(e){throw {filename:$filename,name:'Render Error',message:e.message,line:$line,source:"+b(c)+".split(/\\n/)[$line-1].replace(/^\\s+/,'')};}");try{var A=new Function("$data","$filename",z);return A.prototype=n,A}catch(B){throw B.temp="function anonymous($data,$filename) {"+z+"}",B}}var d=function(a,b){return"string"==typeof b?q(b,{filename:a}):g(a,b)};d.version="3.0.0",d.config=function(a,b){e[a]=b};var e=d.defaults={openTag:"<%",closeTag:"%>",escape:!0,cache:!0,compress:!1,parser:null},f=d.cache={};d.render=function(a,b){return q(a,b)};var g=d.renderFile=function(a,b){var c=d.get(a)||p({filename:a,name:"Render Error",message:"Template not found"});return b?c(b):c};d.get=function(a){var b;if(f[a])b=f[a];else if("object"==typeof document){var c=document.getElementById(a);if(c){var d=(c.value||c.innerHTML).replace(/^\s*|\s*$/g,"");b=q(d,{filename:a})}}return b};var h=function(a,b){return"string"!=typeof a&&(b=typeof a,"number"===b?a+="":a="function"===b?h(a.call(a)):""),a},i={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},j=function(a){return i[a]},k=function(a){return h(a).replace(/&(?![\w#]+;)|[<>"']/g,j)},l=Array.isArray||function(a){return"[object Array]"==={}.toString.call(a)},m=function(a,b){var c,d;if(l(a))for(c=0,d=a.length;d>c;c++)b.call(a,a[c],c,a);else for(c in a)b.call(a,a[c],c)},n=d.utils={$helpers:{},$include:g,$string:h,$escape:k,$each:m};d.helper=function(a,b){o[a]=b};var o=d.helpers=n.$helpers;d.onerror=function(a){var b="Template Error\n\n";for(var c in a)b+="<"+c+">\n"+a[c]+"\n\n";"object"==typeof console&&console.error(b)};var p=function(a){return d.onerror(a),function(){return"{Template Error}"}},q=d.compile=function(a,b){function d(c){try{return new i(c,h)+""}catch(d){return b.debug?p(d)():(b.debug=!0,q(a,b)(c))}}b=b||{};for(var g in e)void 0===b[g]&&(b[g]=e[g]);var h=b.filename;try{var i=c(a,b)}catch(j){return j.filename=h||"anonymous",j.name="Syntax Error",p(j)}return d.prototype=i.prototype,d.toString=function(){return i.toString()},h&&b.cache&&(f[h]=d),d},r=n.$each,s="break,case,catch,continue,debugger,default,delete,do,else,false,finally,for,function,if,in,instanceof,new,null,return,switch,this,throw,true,try,typeof,var,void,while,with,abstract,boolean,byte,char,class,const,double,enum,export,extends,final,float,goto,implements,import,int,interface,long,native,package,private,protected,public,short,static,super,synchronized,throws,transient,volatile,arguments,let,yield,undefined",t=/\/\*[\w\W]*?\*\/|\/\/[^\n]*\n|\/\/[^\n]*$|"(?:[^"\\]|\\[\w\W])*"|'(?:[^'\\]|\\[\w\W])*'|\s*\.\s*[$\w\.]+/g,u=/[^\w$]+/g,v=new RegExp(["\\b"+s.replace(/,/g,"\\b|\\b")+"\\b"].join("|"),"g"),w=/^\d[^,]*|,\d[^,]*/g,x=/^,+|,+$/g,y=/^$|,+/;e.openTag="{{",e.closeTag="}}";var z=function(a,b){var c=b.split(":"),d=c.shift(),e=c.join(":")||"";return e&&(e=", "+e),"$helpers."+d+"("+a+e+")"};e.parser=function(a){a=a.replace(/^\s/,"");var b=a.split(" "),c=b.shift(),e=b.join(" ");switch(c){case"if":a="if("+e+"){";break;case"else":b="if"===b.shift()?" if("+b.join(" ")+")":"",a="}else"+b+"{";break;case"/if":a="}";break;case"each":var f=b[0]||"$data",g=b[1]||"as",h=b[2]||"$value",i=b[3]||"$index",j=h+","+i;"as"!==g&&(f="[]"),a="$each("+f+",function("+j+"){";break;case"/each":a="});";break;case"echo":a="print("+e+");";break;case"print":case"include":a=c+"("+b.join(",")+");";break;default:if(/^\s*\|\s*[\w\$]/.test(e)){var k=!0;0===a.indexOf("#")&&(a=a.substr(1),k=!1);for(var l=0,m=a.split("|"),n=m.length,o=m[l++];n>l;l++)o=z(o,m[l]);a=(k?"=":"=#")+o}else a=d.helpers[c]?"=#"+c+"("+b.join(",")+");":"="+a}return a},"function"==typeof define?define(function(){return d}):"undefined"!=typeof exports?module.exports=d:this.template=d}();; 
(function(root){
    var Route = root.Route = {
        init: function (map) {
            var defaultAction = map['*'];
            if(defaultAction){
                Route.defaultAction = defaultAction;
                delete map['*'];
            }
            Route.routes = map;
            init();
            onchange();
        },
        routes: {},
        defaultAction: null
    };
    function onchange(onChangeEvent){
        var newURL = onChangeEvent && onChangeEvent.newURL || window.location.hash;
        var url = newURL.replace(/.*#/, '');
        var found = false;
        for (var path in Route.routes) {
            var reg = getRegExp(path);
            var result = reg.exec(url);
            if(result && result[0] && result[0] != ''){
                var handler = Route.routes[path];
                handler && handler.apply(null, result.slice(1,result.length-1));
                found = true;
            }
        }
        if(!found && Route.defaultAction){
            Route.defaultAction();
        }
    }
    function getRegExp(route){
        var optionalParam = /\((.*?)\)/g;
        var namedParam    = /(\(\?)?:\w+/g;
        var splatParam    = /\*\w+/g;
        var escapeRegExp  = /[\-{}\[\]+?.,\\\^$|#\s]/g;
        route = route.replace(escapeRegExp, '\\$&')
            .replace(optionalParam, '(?:$1)?')
            .replace(namedParam, function(match, optional) {
                return optional ? match : '([^/?]+)';
            })
            .replace(splatParam, '([^?]*?)');
        return new RegExp('^' + route + '(?:\\?([\\s\\S]*))?$');
    }
    function init(){
        if ('onhashchange' in window && (document.documentMode === undefined
            || document.documentMode > 7)) {
            if (this.history === true) {
                setTimeout(function() {
                    window.onpopstate = onchange;
                }, 500);
            }
            else {
                window.onhashchange = onchange;
            }
            this.mode = 'modern';
        } else {
            throw new Error('sorry, your browser doesn\'t support route');
        }
    }
})(window);; 
ajaxPage.Router = {
	init : function (){
		Route.init({
			//首页
	        'homePage': function(){
	        	ajaxPage.hideCurPage();
	        	loadContent("homePage");
	        	ajaxPage.showCurPage("homePage");
	        	ajaxPage.closeOrHidePage("homePage");
	        	ajaxPage.setNavPanel("homePage");
	        },
	        //流程
	        'flowCenter': function(){
	        	ajaxPage.hideCurPage();
	        	loadContent("flowCenter");
	        	ajaxPage.showCurPage("flowCenter");
	        	ajaxPage.closeOrHidePage("flowCenter");
	        	ajaxPage.setNavPanel("flowCenter");
	        },
	        //菜单
	        'menu': function(){
	        	ajaxPage.hideCurPage();
	        	loadContent("menu");
	        	ajaxPage.showCurPage("menu");
	        	ajaxPage.closeOrHidePage("menu");
	        	ajaxPage.setNavPanel("menu");
	        },
	        //首页widget更多
	        'iconMore': function(){
	        	ajaxPage.hideCurPage();
	        	ajaxPage.showCurPage("iconMore");
	        	ajaxPage.closeOrHidePage("iconMore");
	        	ajaxPage.setNavPanel("iconMore");
	        },
	        //进表单
	        'form_view/*path': function(path){
	        	if(ajaxPage.refresh){	//为true时，加载页面
		        	var params = ajaxPage.Router.resolveHash(path);
		        	var url = contextPath+"/portal/dynaform/document/view.action";
		        	var urlParams = url+"?"+params;		//用于比较带参数的url是否已存在
		        	var closeOrHidePage = ajaxPage.closeOrHidePage("form_view",urlParams);	//关闭后打开的页面，打开当前页面，返回false
		        	if(closeOrHidePage){	//当浏览器刷新当前页面的时候，需重加载页面内容
		        		ajaxPage.routerLoadPage(url,params);
		        	}
		        	ajaxPage.hidePopUpLayer();	//隐藏当前页面的弹出层
		        	ajaxPage.setNavPanel("view");
		        }else{	//为false时，已存在
		        	ajaxPage.refresh = true;
	        	}
	        },
	        //从菜单进表单
	        'form_newWithPermission/*path': function(path){
	        	if(ajaxPage.refresh){
		        	var params = ajaxPage.Router.resolveHash(path);
		        	var url = contextPath+"/portal/dynaform/document/newWithPermission.action";
		        	var urlParams = url+"?"+params;		//用于比较带参数的url是否已存在
		        	var closeOrHidePage = ajaxPage.closeOrHidePage("form_newWithPermission",urlParams);
		        	if(closeOrHidePage){
		        		ajaxPage.routerLoadPage(url,params);
		        	}
		        	ajaxPage.hidePopUpLayer();	//隐藏当前页面的弹出层
		        	ajaxPage.setNavPanel("form_newWithPermission");
	        	}else{
	        		ajaxPage.refresh = true;
	        	}
	        },
	        
	        //进视图(主)
	        'view_displayViewWithPermission/*path': function(path){
	        	if(ajaxPage.refresh){
		        	var params = ajaxPage.Router.resolveHash(path);
		        	var url = contextPath+"/portal/dynaform/view/displayViewWithPermission.action";
		        	var urlParams = url+"?"+params;		//用于比较带参数的url是否已存在
		        	var closeOrHidePage = ajaxPage.closeOrHidePage("view_displayViewWithPermission",urlParams);
		        	if(closeOrHidePage){
		        		ajaxPage.routerLoadPage(url,params);
		        	}else{
		        		ajaxPage.refreshView();
		        	}
		        	ajaxPage.setNavPanel("view_displayViewWithPermission");
	        	}else{
	        		ajaxPage.refresh = true;
	        	}
	        },
	        //进视图，配置按钮跳转到视图(可能跳主视图，可以能跳子视图)
	        'view_displayView/*path': function(path){
	        	if(ajaxPage.refresh){
		        	var params = ajaxPage.Router.resolveHash(path);
		        	var url = contextPath+"/portal/dynaform/view/displayView.action";
		        	var urlParams = url+"?"+params;		//用于比较带参数的url是否已存在
		        	var closeOrHidePage = ajaxPage.closeOrHidePage("view_displayView",urlParams);
		        	if(closeOrHidePage){
		        		ajaxPage.routerLoadPage(url,params);
		        	}else{
		        		ajaxPage.refreshView();
		        	}
		        	ajaxPage.setNavPanel("view_displayView");
	        	}else{
	        		ajaxPage.refresh = true;
	        	}
	        },
	        //进子视图（子表）
	        'subView_displayView/:id/*path': function(id,path){
	        	if(ajaxPage.refresh){
		        	var params = ajaxPage.Router.resolveHash(path);
		        	var _action = "../dynaform/view/displayView.action?"+params;
		        	var url = contextPath+"/portal/dynaform/view/displayView.action";
		        	var urlParams = url+"?"+params;		//用于比较带参数的url是否已存在
		        	var closeOrHidePage = ajaxPage.closeOrHidePage("subView_displayView",urlParams);
		        	if(closeOrHidePage){
		        		ajaxPage.routerLoadPage(url,params,function(){
							var $tabParameter = ajaxPage.getCurPage().find(".tab_parameter_Display");
							var viewid = id + "_params";
							var $viewDiv = $("<div></div>").attr("id",id+"_params").attr("_action",_action).css("display","none");
							//表单元素转成span标签存入dom中
							$.each($tabParameter.find("input[type!=button],select,textarea").serializeArray(),function(){
								$viewDiv.append("<span name='" + this.name + "'>" + this.value + "</span>"); 
							});
						
							//去掉表单元素
							$tabParameter.find("input[type!=button],select,textarea").each(function(){
								if(!$(this).attr("moduleType")) $(this).remove();
							});
	
							ajaxPage.getCurPage().find("title").attr("id",id);
							ajaxPage.getCurPage().append($viewDiv);
						});
		        	}else{
		        		ajaxPage.refreshView();
		        	}
	        	
		        }else{
		        	ajaxPage.refresh = true;
	        	}
	        },
	        //子视图进表单
	        'subView_view/*path': function(path){
	        	if(ajaxPage.refresh){
		        	var params = ajaxPage.Router.resolveHash(path);
		        	var url = contextPath+"/portal/dynaform/document/view.action";
		        	var urlParams = url+"?"+params;		//用于比较带参数的url是否已存在
		        	var closeOrHidePage = ajaxPage.closeOrHidePage("subView_view",urlParams);
		        	if(closeOrHidePage){
		        		ajaxPage.routerLoadPage(url,params);
		        	}
		        	ajaxPage.hidePopUpLayer();	//隐藏当前页面的弹出层
		        	ajaxPage.setNavPanel("subView_view");
		        }else{
		        	ajaxPage.refresh = true;
	        	}
	        },
	        //新建
	        'activity_create/*path': function(path){
	        	if(ajaxPage.refresh){
		        	var params = ajaxPage.Router.resolveHash(path);
		        	var url = contextPath+"/portal/dynaform/activity/process.action";
		        	var urlParams = url+"?"+params;		//用于比较带参数的url是否已存在
		        	var closeOrHidePage = ajaxPage.closeOrHidePage("form_newWithPermission",urlParams);
		        	if(closeOrHidePage){
		        		ajaxPage.routerLoadPage(url,params);
		        	}
		        	ajaxPage.hidePopUpLayer();	//隐藏当前页面的弹出层
		        	ajaxPage.setNavPanel("activity_create");
		        }else{
		        	ajaxPage.refresh = true;
	        	}
	        },
	        'report_oReport/*path': function(path){
	        	var params = ajaxPage.Router.resolveHash(path);
	        	var url = contextPath+"/portal/phone/dynaform/report/oReport.jsp";
	        	var urlParams = url+"?"+params;		//用于比较带参数的url是否已存在
	        	ajaxPage.routerLoadPage(url,params,function(){	
	        		//回调函数
        			var $curPage = ajaxPage.getCurPage();
        			showReport();	//渲染报表图表
        			$curPage.find(".refreshMenuReport").bind("click",function(){	//渲染刷新按钮
        		  		showReport();
        		  	})
        		});
	        	ajaxPage.setNavPanel("report_oReport");
	        }
	        
	    });
	},
	//解析hash，/改拼成&形式传参,并且去掉popUpLayer,flowPro,_searchForm参数
	resolveHash : function(path){
		var arr = path.split("/");
		var params = "";
		$.each(arr, function(){
			if(this != "popUpLayer" && this != "flowPro" && this != "_searchForm"){
				params += this;
				params += "&"
			}
		});
		if(params.length>0){
			params = params.substring(0,params.length-1);
		}
		return params;
	}
}; 
(function (root, factory) {
    if (typeof define === 'function' && define.amd) {
        // AMD. Register as an anonymous module.
        define([], factory);
    } else if (typeof module === 'object' && module.exports) {
        // Node. Does not work with strict CommonJS, but
        // only CommonJS-like environments that support module.exports,
        // like Node.
        module.exports = factory();
    } else {
        // Browser globals (root is window)
        root.echarts = factory();
    }
}(this, function () {var require, define;
(function () {
    var mods = {};

    define = function (id, deps, factory) {
        mods[id] = {
            id: id,
            deps: deps,
            factory: factory,
            defined: 0,
            exports: {},
            require: createRequire(id)
        };
    };

    require = createRequire('');

    function normalize(id, baseId) {
        if (!baseId) {
            return id;
        }

        if (id.indexOf('.') === 0) {
            var basePath = baseId.split('/');
            var namePath = id.split('/');
            var baseLen = basePath.length - 1;
            var nameLen = namePath.length;
            var cutBaseTerms = 0;
            var cutNameTerms = 0;

            pathLoop: for (var i = 0; i < nameLen; i++) {
                switch (namePath[i]) {
                    case '..':
                        if (cutBaseTerms < baseLen) {
                            cutBaseTerms++;
                            cutNameTerms++;
                        }
                        else {
                            break pathLoop;
                        }
                        break;
                    case '.':
                        cutNameTerms++;
                        break;
                    default:
                        break pathLoop;
                }
            }

            basePath.length = baseLen - cutBaseTerms;
            namePath = namePath.slice(cutNameTerms);

            return basePath.concat(namePath).join('/');
        }

        return id;
    }

    function createRequire(baseId) {
        var cacheMods = {};

        function localRequire(id, callback) {
            if (typeof id === 'string') {
                var exports = cacheMods[id];
                if (!exports) {
                    exports = getModExports(normalize(id, baseId));
                    cacheMods[id] = exports;
                }

                return exports;
            }
            else if (id instanceof Array) {
                callback = callback || function () {};
                callback.apply(this, getModsExports(id, callback, baseId));
            }
        };

        return localRequire;
    }

    function getModsExports(ids, factory, baseId) {
        var es = [];
        var mod = mods[baseId];

        for (var i = 0, l = Math.min(ids.length, factory.length); i < l; i++) {
            var id = normalize(ids[i], baseId);
            var arg;
            switch (id) {
                case 'require':
                    arg = (mod && mod.require) || require;
                    break;
                case 'exports':
                    arg = mod.exports;
                    break;
                case 'module':
                    arg = mod;
                    break;
                default:
                    arg = getModExports(id);
            }
            es.push(arg);
        }

        return es;
    }

    function getModExports(id) {
        var mod = mods[id];
        if (!mod) {
            throw new Error('No ' + id);
        }

        if (!mod.defined) {
            var factory = mod.factory;
            var factoryReturn = factory.apply(
                this,
                getModsExports(mod.deps || [], factory, id)
            );
            if (typeof factoryReturn !== 'undefined') {
                mod.exports = factoryReturn;
            }
            mod.defined = 1;
        }

        return mod.exports;
    }
}());
define('echarts/echarts', ['require', 'zrender/core/env', './model/Global', './ExtensionAPI', './CoordinateSystem', './model/OptionManager', './model/Component', './model/Series', './view/Component', './view/Chart', './util/graphic', './util/model', './util/throttle', 'zrender', 'zrender/core/util', 'zrender/tool/color', 'zrender/mixin/Eventful', 'zrender/core/timsort', './visual/seriesColor', './preprocessor/backwardCompat', './loading/default', './data/List', './model/Model', './util/number', './util/format', 'zrender/core/matrix', 'zrender/core/vector'], function (require) {
    var env = require('zrender/core/env');
    var GlobalModel = require('./model/Global');
    var ExtensionAPI = require('./ExtensionAPI');
    var CoordinateSystemManager = require('./CoordinateSystem');
    var OptionManager = require('./model/OptionManager');
    var ComponentModel = require('./model/Component');
    var SeriesModel = require('./model/Series');
    var ComponentView = require('./view/Component');
    var ChartView = require('./view/Chart');
    var graphic = require('./util/graphic');
    var modelUtil = require('./util/model');
    var throttle = require('./util/throttle');
    var zrender = require('zrender');
    var zrUtil = require('zrender/core/util');
    var colorTool = require('zrender/tool/color');
    var Eventful = require('zrender/mixin/Eventful');
    var timsort = require('zrender/core/timsort');
    var each = zrUtil.each;
    var PRIORITY_PROCESSOR_FILTER = 1000;
    var PRIORITY_PROCESSOR_STATISTIC = 5000;
    var PRIORITY_VISUAL_LAYOUT = 1000;
    var PRIORITY_VISUAL_GLOBAL = 2000;
    var PRIORITY_VISUAL_CHART = 3000;
    var PRIORITY_VISUAL_COMPONENT = 4000;
    var PRIORITY_VISUAL_BRUSH = 5000;
    // Main process have three entries: `setOption`, `dispatchAction` and `resize`,
    // where they must not be invoked nestedly, except the only case: invoke
    // dispatchAction with updateMethod "none" in main process.
    // This flag is used to carry out this rule.
    // All events will be triggered out side main process (i.e. when !this[IN_MAIN_PROCESS]).
    var IN_MAIN_PROCESS = '__flagInMainProcess';
    var HAS_GRADIENT_OR_PATTERN_BG = '__hasGradientOrPatternBg';
    var OPTION_UPDATED = '__optionUpdated';
    function createRegisterEventWithLowercaseName(method) {
        return function (eventName, handler, context) {
            // Event name is all lowercase
            eventName = eventName && eventName.toLowerCase();
            Eventful.prototype[method].call(this, eventName, handler, context);
        };
    }
    /**
     * @module echarts~MessageCenter
     */
    function MessageCenter() {
        Eventful.call(this);
    }
    MessageCenter.prototype.on = createRegisterEventWithLowercaseName('on');
    MessageCenter.prototype.off = createRegisterEventWithLowercaseName('off');
    MessageCenter.prototype.one = createRegisterEventWithLowercaseName('one');
    zrUtil.mixin(MessageCenter, Eventful);
    /**
     * @module echarts~ECharts
     */
    function ECharts(dom, theme, opts) {
        opts = opts || {};
        // Get theme by name
        if (typeof theme === 'string') {
            theme = themeStorage[theme];
        }
        /**
         * @type {string}
         */
        this.id;
        /**
         * Group id
         * @type {string}
         */
        this.group;
        /**
         * @type {HTMLDomElement}
         * @private
         */
        this._dom = dom;
        /**
         * @type {module:zrender/ZRender}
         * @private
         */
        var zr = this._zr = zrender.init(dom, {
                renderer: opts.renderer || 'canvas',
                devicePixelRatio: opts.devicePixelRatio,
                width: opts.width,
                height: opts.height
            });
        /**
         * Expect 60 pfs.
         * @type {Function}
         * @private
         */
        this._throttledZrFlush = throttle.throttle(zrUtil.bind(zr.flush, zr), 17);
        /**
         * @type {Object}
         * @private
         */
        this._theme = zrUtil.clone(theme);
        /**
         * @type {Array.<module:echarts/view/Chart>}
         * @private
         */
        this._chartsViews = [];
        /**
         * @type {Object.<string, module:echarts/view/Chart>}
         * @private
         */
        this._chartsMap = {};
        /**
         * @type {Array.<module:echarts/view/Component>}
         * @private
         */
        this._componentsViews = [];
        /**
         * @type {Object.<string, module:echarts/view/Component>}
         * @private
         */
        this._componentsMap = {};
        /**
         * @type {module:echarts/ExtensionAPI}
         * @private
         */
        this._api = new ExtensionAPI(this);
        /**
         * @type {module:echarts/CoordinateSystem}
         * @private
         */
        this._coordSysMgr = new CoordinateSystemManager();
        Eventful.call(this);
        /**
         * @type {module:echarts~MessageCenter}
         * @private
         */
        this._messageCenter = new MessageCenter();
        // Init mouse events
        this._initEvents();
        // In case some people write `window.onresize = chart.resize`
        this.resize = zrUtil.bind(this.resize, this);
        // Can't dispatch action during rendering procedure
        this._pendingActions = [];
        // Sort on demand
        function prioritySortFunc(a, b) {
            return a.prio - b.prio;
        }
        timsort(visualFuncs, prioritySortFunc);
        timsort(dataProcessorFuncs, prioritySortFunc);
        zr.animation.on('frame', this._onframe, this);
    }
    var echartsProto = ECharts.prototype;
    echartsProto._onframe = function () {
        // Lazy update
        if (this[OPTION_UPDATED]) {
            this[IN_MAIN_PROCESS] = true;
            updateMethods.prepareAndUpdate.call(this);
            this[IN_MAIN_PROCESS] = false;
            this[OPTION_UPDATED] = false;
        }
    };
    /**
     * @return {HTMLDomElement}
     */
    echartsProto.getDom = function () {
        return this._dom;
    };
    /**
     * @return {module:zrender~ZRender}
     */
    echartsProto.getZr = function () {
        return this._zr;
    };
    /**
     * @param {Object} option
     * @param {boolean} notMerge
     * @param {boolean} [lazyUpdate=false] Useful when setOption frequently.
     */
    echartsProto.setOption = function (option, notMerge, lazyUpdate) {
        if (true) {
            zrUtil.assert(!this[IN_MAIN_PROCESS], '`setOption` should not be called during main process.');
        }
        this[IN_MAIN_PROCESS] = true;
        if (!this._model || notMerge) {
            var optionManager = new OptionManager(this._api);
            var theme = this._theme;
            var ecModel = this._model = new GlobalModel(null, null, theme, optionManager);
            ecModel.init(null, null, theme, optionManager);
        }
        // FIXME
        // ugly
        this.__lastOnlyGraphic = !!(option && option.graphic);
        zrUtil.each(option, function (o, mainType) {
            mainType !== 'graphic' && (this.__lastOnlyGraphic = false);
        }, this);
        this._model.setOption(option, optionPreprocessorFuncs);
        if (lazyUpdate) {
            this[OPTION_UPDATED] = true;
        } else {
            updateMethods.prepareAndUpdate.call(this);
            // Ensure zr refresh sychronously, and then pixel in canvas can be
            // fetched after `setOption`.
            this._zr.flush();
            this[OPTION_UPDATED] = false;
        }
        this[IN_MAIN_PROCESS] = false;
        flushPendingActions.call(this, false);
    };
    /**
     * @DEPRECATED
     */
    echartsProto.setTheme = function () {
        console.log('ECharts#setTheme() is DEPRECATED in ECharts 3.0');
    };
    /**
     * @return {module:echarts/model/Global}
     */
    echartsProto.getModel = function () {
        return this._model;
    };
    /**
     * @return {Object}
     */
    echartsProto.getOption = function () {
        return this._model && this._model.getOption();
    };
    /**
     * @return {number}
     */
    echartsProto.getWidth = function () {
        return this._zr.getWidth();
    };
    /**
     * @return {number}
     */
    echartsProto.getHeight = function () {
        return this._zr.getHeight();
    };
    /**
     * Get canvas which has all thing rendered
     * @param {Object} opts
     * @param {string} [opts.backgroundColor]
     */
    echartsProto.getRenderedCanvas = function (opts) {
        if (!env.canvasSupported) {
            return;
        }
        opts = opts || {};
        opts.pixelRatio = opts.pixelRatio || 1;
        opts.backgroundColor = opts.backgroundColor || this._model.get('backgroundColor');
        var zr = this._zr;
        var list = zr.storage.getDisplayList();
        // Stop animations
        zrUtil.each(list, function (el) {
            el.stopAnimation(true);
        });
        return zr.painter.getRenderedCanvas(opts);
    };
    /**
     * @return {string}
     * @param {Object} opts
     * @param {string} [opts.type='png']
     * @param {string} [opts.pixelRatio=1]
     * @param {string} [opts.backgroundColor]
     * @param {string} [opts.excludeComponents]
     */
    echartsProto.getDataURL = function (opts) {
        opts = opts || {};
        var excludeComponents = opts.excludeComponents;
        var ecModel = this._model;
        var excludesComponentViews = [];
        var self = this;
        each(excludeComponents, function (componentType) {
            ecModel.eachComponent({ mainType: componentType }, function (component) {
                var view = self._componentsMap[component.__viewId];
                if (!view.group.ignore) {
                    excludesComponentViews.push(view);
                    view.group.ignore = true;
                }
            });
        });
        var url = this.getRenderedCanvas(opts).toDataURL('image/' + (opts && opts.type || 'png'));
        each(excludesComponentViews, function (view) {
            view.group.ignore = false;
        });
        return url;
    };
    /**
     * @return {string}
     * @param {Object} opts
     * @param {string} [opts.type='png']
     * @param {string} [opts.pixelRatio=1]
     * @param {string} [opts.backgroundColor]
     */
    echartsProto.getConnectedDataURL = function (opts) {
        if (!env.canvasSupported) {
            return;
        }
        var groupId = this.group;
        var mathMin = Math.min;
        var mathMax = Math.max;
        var MAX_NUMBER = Infinity;
        if (connectedGroups[groupId]) {
            var left = MAX_NUMBER;
            var top = MAX_NUMBER;
            var right = -MAX_NUMBER;
            var bottom = -MAX_NUMBER;
            var canvasList = [];
            var dpr = opts && opts.pixelRatio || 1;
            zrUtil.each(instances, function (chart, id) {
                if (chart.group === groupId) {
                    var canvas = chart.getRenderedCanvas(zrUtil.clone(opts));
                    var boundingRect = chart.getDom().getBoundingClientRect();
                    left = mathMin(boundingRect.left, left);
                    top = mathMin(boundingRect.top, top);
                    right = mathMax(boundingRect.right, right);
                    bottom = mathMax(boundingRect.bottom, bottom);
                    canvasList.push({
                        dom: canvas,
                        left: boundingRect.left,
                        top: boundingRect.top
                    });
                }
            });
            left *= dpr;
            top *= dpr;
            right *= dpr;
            bottom *= dpr;
            var width = right - left;
            var height = bottom - top;
            var targetCanvas = zrUtil.createCanvas();
            targetCanvas.width = width;
            targetCanvas.height = height;
            var zr = zrender.init(targetCanvas);
            each(canvasList, function (item) {
                var img = new graphic.Image({
                        style: {
                            x: item.left * dpr - left,
                            y: item.top * dpr - top,
                            image: item.dom
                        }
                    });
                zr.add(img);
            });
            zr.refreshImmediately();
            return targetCanvas.toDataURL('image/' + (opts && opts.type || 'png'));
        } else {
            return this.getDataURL(opts);
        }
    };
    /**
     * Convert from logical coordinate system to pixel coordinate system.
     * See CoordinateSystem#convertToPixel.
     * @param {string|Object} finder
     *        If string, e.g., 'geo', means {geoIndex: 0}.
     *        If Object, could contain some of these properties below:
     *        {
     *            seriesIndex / seriesId / seriesName,
     *            geoIndex / geoId, geoName,
     *            bmapIndex / bmapId / bmapName,
     *            xAxisIndex / xAxisId / xAxisName,
     *            yAxisIndex / yAxisId / yAxisName,
     *            gridIndex / gridId / gridName,
     *            ... (can be extended)
     *        }
     * @param {Array|number} value
     * @return {Array|number} result
     */
    echartsProto.convertToPixel = zrUtil.curry(doConvertPixel, 'convertToPixel');
    /**
     * Convert from pixel coordinate system to logical coordinate system.
     * See CoordinateSystem#convertFromPixel.
     * @param {string|Object} finder
     *        If string, e.g., 'geo', means {geoIndex: 0}.
     *        If Object, could contain some of these properties below:
     *        {
     *            seriesIndex / seriesId / seriesName,
     *            geoIndex / geoId / geoName,
     *            bmapIndex / bmapId / bmapName,
     *            xAxisIndex / xAxisId / xAxisName,
     *            yAxisIndex / yAxisId / yAxisName
     *            gridIndex / gridId / gridName,
     *            ... (can be extended)
     *        }
     * @param {Array|number} value
     * @return {Array|number} result
     */
    echartsProto.convertFromPixel = zrUtil.curry(doConvertPixel, 'convertFromPixel');
    function doConvertPixel(methodName, finder, value) {
        var ecModel = this._model;
        var coordSysList = this._coordSysMgr.getCoordinateSystems();
        var result;
        finder = modelUtil.parseFinder(ecModel, finder);
        for (var i = 0; i < coordSysList.length; i++) {
            var coordSys = coordSysList[i];
            if (coordSys[methodName] && (result = coordSys[methodName](ecModel, finder, value)) != null) {
                return result;
            }
        }
        if (true) {
            console.warn('No coordinate system that supports ' + methodName + ' found by the given finder.');
        }
    }
    /**
     * Is the specified coordinate systems or components contain the given pixel point.
     * @param {string|Object} finder
     *        If string, e.g., 'geo', means {geoIndex: 0}.
     *        If Object, could contain some of these properties below:
     *        {
     *            seriesIndex / seriesId / seriesName,
     *            geoIndex / geoId / geoName,
     *            bmapIndex / bmapId / bmapName,
     *            xAxisIndex / xAxisId / xAxisName,
     *            yAxisIndex / yAxisId / yAxisName
     *            gridIndex / gridId / gridName,
     *            ... (can be extended)
     *        }
     * @param {Array|number} value
     * @return {boolean} result
     */
    echartsProto.containPixel = function (finder, value) {
        var ecModel = this._model;
        var result;
        finder = modelUtil.parseFinder(ecModel, finder);
        zrUtil.each(finder, function (models, key) {
            key.indexOf('Models') >= 0 && zrUtil.each(models, function (model) {
                var coordSys = model.coordinateSystem;
                if (coordSys && coordSys.containPoint) {
                    result |= !!coordSys.containPoint(value);
                } else if (key === 'seriesModels') {
                    var view = this._chartsMap[model.__viewId];
                    if (view && view.containPoint) {
                        result |= view.containPoint(value, model);
                    } else {
                        if (true) {
                            console.warn(key + ': ' + (view ? 'The found component do not support containPoint.' : 'No view mapping to the found component.'));
                        }
                    }
                } else {
                    if (true) {
                        console.warn(key + ': containPoint is not supported');
                    }
                }
            }, this);
        }, this);
        return !!result;
    };
    /**
     * Get visual from series or data.
     * @param {string|Object} finder
     *        If string, e.g., 'series', means {seriesIndex: 0}.
     *        If Object, could contain some of these properties below:
     *        {
     *            seriesIndex / seriesId / seriesName,
     *            dataIndex / dataIndexInside
     *        }
     *        If dataIndex is not specified, series visual will be fetched,
     *        but not data item visual.
     *        If all of seriesIndex, seriesId, seriesName are not specified,
     *        visual will be fetched from first series.
     * @param {string} visualType 'color', 'symbol', 'symbolSize'
     */
    echartsProto.getVisual = function (finder, visualType) {
        var ecModel = this._model;
        finder = modelUtil.parseFinder(ecModel, finder, { defaultMainType: 'series' });
        var seriesModel = finder.seriesModel;
        if (true) {
            if (!seriesModel) {
                console.warn('There is no specified seires model');
            }
        }
        var data = seriesModel.getData();
        var dataIndexInside = finder.hasOwnProperty('dataIndexInside') ? finder.dataIndexInside : finder.hasOwnProperty('dataIndex') ? data.indexOfRawIndex(finder.dataIndex) : null;
        return dataIndexInside != null ? data.getItemVisual(dataIndexInside, visualType) : data.getVisual(visualType);
    };
    var updateMethods = {
            update: function (payload) {
                // console.time && console.time('update');
                var ecModel = this._model;
                var api = this._api;
                var coordSysMgr = this._coordSysMgr;
                var zr = this._zr;
                // update before setOption
                if (!ecModel) {
                    return;
                }
                // Fixme First time update ?
                ecModel.restoreData();
                // TODO
                // Save total ecModel here for undo/redo (after restoring data and before processing data).
                // Undo (restoration of total ecModel) can be carried out in 'action' or outside API call.
                // Create new coordinate system each update
                // In LineView may save the old coordinate system and use it to get the orignal point
                coordSysMgr.create(this._model, this._api);
                processData.call(this, ecModel, api);
                stackSeriesData.call(this, ecModel);
                coordSysMgr.update(ecModel, api);
                doVisualEncoding.call(this, ecModel, payload);
                doRender.call(this, ecModel, payload);
                // Set background
                var backgroundColor = ecModel.get('backgroundColor') || 'transparent';
                var painter = zr.painter;
                // TODO all use clearColor ?
                if (painter.isSingleCanvas && painter.isSingleCanvas()) {
                    zr.configLayer(0, { clearColor: backgroundColor });
                } else {
                    // In IE8
                    if (!env.canvasSupported) {
                        var colorArr = colorTool.parse(backgroundColor);
                        backgroundColor = colorTool.stringify(colorArr, 'rgb');
                        if (colorArr[3] === 0) {
                            backgroundColor = 'transparent';
                        }
                    }
                    if (backgroundColor.colorStops || backgroundColor.image) {
                        // Gradient background
                        // FIXME Fixed layer？
                        zr.configLayer(0, { clearColor: backgroundColor });
                        this[HAS_GRADIENT_OR_PATTERN_BG] = true;
                        this._dom.style.background = 'transparent';
                    } else {
                        if (this[HAS_GRADIENT_OR_PATTERN_BG]) {
                            zr.configLayer(0, { clearColor: null });
                        }
                        this[HAS_GRADIENT_OR_PATTERN_BG] = false;
                        this._dom.style.background = backgroundColor;
                    }
                }    // console.time && console.timeEnd('update');
            },
            updateView: function (payload) {
                var ecModel = this._model;
                // update before setOption
                if (!ecModel) {
                    return;
                }
                ecModel.eachSeries(function (seriesModel) {
                    seriesModel.getData().clearAllVisual();
                });
                doVisualEncoding.call(this, ecModel, payload);
                invokeUpdateMethod.call(this, 'updateView', ecModel, payload);
            },
            updateVisual: function (payload) {
                var ecModel = this._model;
                // update before setOption
                if (!ecModel) {
                    return;
                }
                ecModel.eachSeries(function (seriesModel) {
                    seriesModel.getData().clearAllVisual();
                });
                doVisualEncoding.call(this, ecModel, payload);
                invokeUpdateMethod.call(this, 'updateVisual', ecModel, payload);
            },
            updateLayout: function (payload) {
                var ecModel = this._model;
                // update before setOption
                if (!ecModel) {
                    return;
                }
                doLayout.call(this, ecModel, payload);
                invokeUpdateMethod.call(this, 'updateLayout', ecModel, payload);
            },
            highlight: function (payload) {
                toggleHighlight.call(this, 'highlight', payload);
            },
            downplay: function (payload) {
                toggleHighlight.call(this, 'downplay', payload);
            },
            prepareAndUpdate: function (payload) {
                var ecModel = this._model;
                prepareView.call(this, 'component', ecModel);
                prepareView.call(this, 'chart', ecModel);
                // FIXME
                // ugly
                if (this.__lastOnlyGraphic) {
                    each(this._componentsViews, function (componentView) {
                        var componentModel = componentView.__model;
                        if (componentModel && componentModel.mainType === 'graphic') {
                            componentView.render(componentModel, ecModel, this._api, payload);
                            updateZ(componentModel, componentView);
                        }
                    }, this);
                    this.__lastOnlyGraphic = false;
                } else {
                    updateMethods.update.call(this, payload);
                }
            }
        };
    /**
     * @param {Object} payload
     * @private
     */
    function toggleHighlight(method, payload) {
        var ecModel = this._model;
        // dispatchAction before setOption
        if (!ecModel) {
            return;
        }
        ecModel.eachComponent({
            mainType: 'series',
            query: payload
        }, function (seriesModel, index) {
            var chartView = this._chartsMap[seriesModel.__viewId];
            if (chartView && chartView.__alive) {
                chartView[method](seriesModel, ecModel, this._api, payload);
            }
        }, this);
    }
    /**
     * Resize the chart
     * @param {Object} opts
     * @param {number} [opts.width] Can be 'auto' (the same as null/undefined)
     * @param {number} [opts.height] Can be 'auto' (the same as null/undefined)
     */
    echartsProto.resize = function (opts) {
        if (true) {
            zrUtil.assert(!this[IN_MAIN_PROCESS], '`resize` should not be called during main process.');
        }
        this[IN_MAIN_PROCESS] = true;
        this._zr.resize(opts);
        var optionChanged = this._model && this._model.resetOption('media');
        updateMethods[optionChanged ? 'prepareAndUpdate' : 'update'].call(this);
        // Resize loading effect
        this._loadingFX && this._loadingFX.resize();
        this[IN_MAIN_PROCESS] = false;
        flushPendingActions.call(this);
    };
    /**
     * Show loading effect
     * @param  {string} [name='default']
     * @param  {Object} [cfg]
     */
    echartsProto.showLoading = function (name, cfg) {
        if (zrUtil.isObject(name)) {
            cfg = name;
            name = '';
        }
        name = name || 'default';
        this.hideLoading();
        if (!loadingEffects[name]) {
            if (true) {
                console.warn('Loading effects ' + name + ' not exists.');
            }
            return;
        }
        var el = loadingEffects[name](this._api, cfg);
        var zr = this._zr;
        this._loadingFX = el;
        zr.add(el);
    };
    /**
     * Hide loading effect
     */
    echartsProto.hideLoading = function () {
        this._loadingFX && this._zr.remove(this._loadingFX);
        this._loadingFX = null;
    };
    /**
     * @param {Object} eventObj
     * @return {Object}
     */
    echartsProto.makeActionFromEvent = function (eventObj) {
        var payload = zrUtil.extend({}, eventObj);
        payload.type = eventActionMap[eventObj.type];
        return payload;
    };
    /**
     * @pubilc
     * @param {Object} payload
     * @param {string} [payload.type] Action type
     * @param {Object|boolean} [opt] If pass boolean, means opt.silent
     * @param {boolean} [opt.silent=false] Whether trigger events.
     * @param {boolean} [opt.flush=undefined]
     *                  true: Flush immediately, and then pixel in canvas can be fetched
     *                      immediately. Caution: it might affect performance.
     *                  false: Not not flush.
     *                  undefined: Auto decide whether perform flush.
     */
    echartsProto.dispatchAction = function (payload, opt) {
        if (!zrUtil.isObject(opt)) {
            opt = { silent: !!opt };
        }
        if (!actions[payload.type]) {
            return;
        }
        // if (__DEV__) {
        //     zrUtil.assert(
        //         !this[IN_MAIN_PROCESS],
        //         '`dispatchAction` should not be called during main process.'
        //         + 'unless updateMathod is "none".'
        //     );
        // }
        // May dispatchAction in rendering procedure
        if (this[IN_MAIN_PROCESS]) {
            this._pendingActions.push(payload);
            return;
        }
        doDispatchAction.call(this, payload, opt.silent);
        if (opt.flush) {
            this._zr.flush(true);
        } else if (opt.flush !== false && env.browser.weChat) {
            // In WeChat embeded browser, `requestAnimationFrame` and `setInterval`
            // hang when sliding page (on touch event), which cause that zr does not
            // refresh util user interaction finished, which is not expected.
            // But `dispatchAction` may be called too frequently when pan on touch
            // screen, which impacts performance if do not throttle them.
            this._throttledZrFlush();
        }
        flushPendingActions.call(this, opt.silent);
    };
    function doDispatchAction(payload, silent) {
        var actionWrap = actions[payload.type];
        var actionInfo = actionWrap.actionInfo;
        var updateMethod = actionInfo.update || 'update';
        this[IN_MAIN_PROCESS] = true;
        var payloads = [payload];
        var batched = false;
        // Batch action
        if (payload.batch) {
            batched = true;
            payloads = zrUtil.map(payload.batch, function (item) {
                item = zrUtil.defaults(zrUtil.extend({}, item), payload);
                item.batch = null;
                return item;
            });
        }
        var eventObjBatch = [];
        var eventObj;
        var isHighlightOrDownplay = payload.type === 'highlight' || payload.type === 'downplay';
        for (var i = 0; i < payloads.length; i++) {
            var batchItem = payloads[i];
            // Action can specify the event by return it.
            eventObj = actionWrap.action(batchItem, this._model);
            // Emit event outside
            eventObj = eventObj || zrUtil.extend({}, batchItem);
            // Convert type to eventType
            eventObj.type = actionInfo.event || eventObj.type;
            eventObjBatch.push(eventObj);
            // Highlight and downplay are special.
            isHighlightOrDownplay && updateMethods[updateMethod].call(this, batchItem);
        }
        if (updateMethod !== 'none' && !isHighlightOrDownplay) {
            // Still dirty
            if (this[OPTION_UPDATED]) {
                // FIXME Pass payload ?
                updateMethods.prepareAndUpdate.call(this, payload);
                this[OPTION_UPDATED] = false;
            } else {
                updateMethods[updateMethod].call(this, payload);
            }
        }
        // Follow the rule of action batch
        if (batched) {
            eventObj = {
                type: actionInfo.event || payload.type,
                batch: eventObjBatch
            };
        } else {
            eventObj = eventObjBatch[0];
        }
        this[IN_MAIN_PROCESS] = false;
        !silent && this._messageCenter.trigger(eventObj.type, eventObj);
    }
    function flushPendingActions(silent) {
        var pendingActions = this._pendingActions;
        while (pendingActions.length) {
            var payload = pendingActions.shift();
            doDispatchAction.call(this, payload, silent);
        }
    }
    /**
     * Register event
     * @method
     */
    echartsProto.on = createRegisterEventWithLowercaseName('on');
    echartsProto.off = createRegisterEventWithLowercaseName('off');
    echartsProto.one = createRegisterEventWithLowercaseName('one');
    /**
     * @param {string} methodName
     * @private
     */
    function invokeUpdateMethod(methodName, ecModel, payload) {
        var api = this._api;
        // Update all components
        each(this._componentsViews, function (component) {
            var componentModel = component.__model;
            component[methodName](componentModel, ecModel, api, payload);
            updateZ(componentModel, component);
        }, this);
        // Upate all charts
        ecModel.eachSeries(function (seriesModel, idx) {
            var chart = this._chartsMap[seriesModel.__viewId];
            chart[methodName](seriesModel, ecModel, api, payload);
            updateZ(seriesModel, chart);
            updateProgressiveAndBlend(seriesModel, chart);
        }, this);
        // If use hover layer
        updateHoverLayerStatus(this._zr, ecModel);
    }
    /**
     * Prepare view instances of charts and components
     * @param  {module:echarts/model/Global} ecModel
     * @private
     */
    function prepareView(type, ecModel) {
        var isComponent = type === 'component';
        var viewList = isComponent ? this._componentsViews : this._chartsViews;
        var viewMap = isComponent ? this._componentsMap : this._chartsMap;
        var zr = this._zr;
        for (var i = 0; i < viewList.length; i++) {
            viewList[i].__alive = false;
        }
        ecModel[isComponent ? 'eachComponent' : 'eachSeries'](function (componentType, model) {
            if (isComponent) {
                if (componentType === 'series') {
                    return;
                }
            } else {
                model = componentType;
            }
            // Consider: id same and type changed.
            var viewId = model.id + '_' + model.type;
            var view = viewMap[viewId];
            if (!view) {
                var classType = ComponentModel.parseClassType(model.type);
                var Clazz = isComponent ? ComponentView.getClass(classType.main, classType.sub) : ChartView.getClass(classType.sub);
                if (Clazz) {
                    view = new Clazz();
                    view.init(ecModel, this._api);
                    viewMap[viewId] = view;
                    viewList.push(view);
                    zr.add(view.group);
                } else {
                    // Error
                    return;
                }
            }
            model.__viewId = viewId;
            view.__alive = true;
            view.__id = viewId;
            view.__model = model;
        }, this);
        for (var i = 0; i < viewList.length;) {
            var view = viewList[i];
            if (!view.__alive) {
                zr.remove(view.group);
                view.dispose(ecModel, this._api);
                viewList.splice(i, 1);
                delete viewMap[view.__id];
            } else {
                i++;
            }
        }
    }
    /**
     * Processor data in each series
     *
     * @param {module:echarts/model/Global} ecModel
     * @private
     */
    function processData(ecModel, api) {
        each(dataProcessorFuncs, function (process) {
            process.func(ecModel, api);
        });
    }
    /**
     * @private
     */
    function stackSeriesData(ecModel) {
        var stackedDataMap = {};
        ecModel.eachSeries(function (series) {
            var stack = series.get('stack');
            var data = series.getData();
            if (stack && data.type === 'list') {
                var previousStack = stackedDataMap[stack];
                if (previousStack) {
                    data.stackedOn = previousStack;
                }
                stackedDataMap[stack] = data;
            }
        });
    }
    /**
     * Layout before each chart render there series, special visual encoding stage
     *
     * @param {module:echarts/model/Global} ecModel
     * @private
     */
    function doLayout(ecModel, payload) {
        var api = this._api;
        each(visualFuncs, function (visual) {
            if (visual.isLayout) {
                visual.func(ecModel, api, payload);
            }
        });
    }
    /**
     * Encode visual infomation from data after data processing
     *
     * @param {module:echarts/model/Global} ecModel
     * @private
     */
    function doVisualEncoding(ecModel, payload) {
        var api = this._api;
        ecModel.clearColorPalette();
        ecModel.eachSeries(function (seriesModel) {
            seriesModel.clearColorPalette();
        });
        each(visualFuncs, function (visual) {
            visual.func(ecModel, api, payload);
        });
    }
    /**
     * Render each chart and component
     * @private
     */
    function doRender(ecModel, payload) {
        var api = this._api;
        // Render all components
        each(this._componentsViews, function (componentView) {
            var componentModel = componentView.__model;
            componentView.render(componentModel, ecModel, api, payload);
            updateZ(componentModel, componentView);
        }, this);
        each(this._chartsViews, function (chart) {
            chart.__alive = false;
        }, this);
        // Render all charts
        ecModel.eachSeries(function (seriesModel, idx) {
            var chartView = this._chartsMap[seriesModel.__viewId];
            chartView.__alive = true;
            chartView.render(seriesModel, ecModel, api, payload);
            chartView.group.silent = !!seriesModel.get('silent');
            updateZ(seriesModel, chartView);
            updateProgressiveAndBlend(seriesModel, chartView);
        }, this);
        // If use hover layer
        updateHoverLayerStatus(this._zr, ecModel);
        // Remove groups of unrendered charts
        each(this._chartsViews, function (chart) {
            if (!chart.__alive) {
                chart.remove(ecModel, api);
            }
        }, this);
    }
    var MOUSE_EVENT_NAMES = [
            'click',
            'dblclick',
            'mouseover',
            'mouseout',
            'mousemove',
            'mousedown',
            'mouseup',
            'globalout',
            'contextmenu'
        ];
    /**
     * @private
     */
    echartsProto._initEvents = function () {
        each(MOUSE_EVENT_NAMES, function (eveName) {
            this._zr.on(eveName, function (e) {
                var ecModel = this.getModel();
                var el = e.target;
                var params;
                // no e.target when 'globalout'.
                if (eveName === 'globalout') {
                    params = {};
                } else if (el && el.dataIndex != null) {
                    var dataModel = el.dataModel || ecModel.getSeriesByIndex(el.seriesIndex);
                    params = dataModel && dataModel.getDataParams(el.dataIndex, el.dataType) || {};
                }    // If element has custom eventData of components
                else if (el && el.eventData) {
                    params = zrUtil.extend({}, el.eventData);
                }
                if (params) {
                    params.event = e;
                    params.type = eveName;
                    this.trigger(eveName, params);
                }
            }, this);
        }, this);
        each(eventActionMap, function (actionType, eventType) {
            this._messageCenter.on(eventType, function (event) {
                this.trigger(eventType, event);
            }, this);
        }, this);
    };
    /**
     * @return {boolean}
     */
    echartsProto.isDisposed = function () {
        return this._disposed;
    };
    /**
     * Clear
     */
    echartsProto.clear = function () {
        this.setOption({ series: [] }, true);
    };
    /**
     * Dispose instance
     */
    echartsProto.dispose = function () {
        if (this._disposed) {
            if (true) {
                console.warn('Instance ' + this.id + ' has been disposed');
            }
            return;
        }
        this._disposed = true;
        var api = this._api;
        var ecModel = this._model;
        each(this._componentsViews, function (component) {
            component.dispose(ecModel, api);
        });
        each(this._chartsViews, function (chart) {
            chart.dispose(ecModel, api);
        });
        // Dispose after all views disposed
        this._zr.dispose();
        delete instances[this.id];
    };
    zrUtil.mixin(ECharts, Eventful);
    function updateHoverLayerStatus(zr, ecModel) {
        var storage = zr.storage;
        var elCount = 0;
        storage.traverse(function (el) {
            if (!el.isGroup) {
                elCount++;
            }
        });
        if (elCount > ecModel.get('hoverLayerThreshold') && !env.node) {
            storage.traverse(function (el) {
                if (!el.isGroup) {
                    el.useHoverLayer = true;
                }
            });
        }
    }
    /**
     * Update chart progressive and blend.
     * @param {module:echarts/model/Series|module:echarts/model/Component} model
     * @param {module:echarts/view/Component|module:echarts/view/Chart} view
     */
    function updateProgressiveAndBlend(seriesModel, chartView) {
        // Progressive configuration
        var elCount = 0;
        chartView.group.traverse(function (el) {
            if (el.type !== 'group' && !el.ignore) {
                elCount++;
            }
        });
        var frameDrawNum = +seriesModel.get('progressive');
        var needProgressive = elCount > seriesModel.get('progressiveThreshold') && frameDrawNum && !env.node;
        if (needProgressive) {
            chartView.group.traverse(function (el) {
                // FIXME marker and other components
                if (!el.isGroup) {
                    el.progressive = needProgressive ? Math.floor(elCount++ / frameDrawNum) : -1;
                    if (needProgressive) {
                        el.stopAnimation(true);
                    }
                }
            });
        }
        // Blend configration
        var blendMode = seriesModel.get('blendMode') || null;
        if (true) {
            if (!env.canvasSupported && blendMode && blendMode !== 'source-over') {
                console.warn('Only canvas support blendMode');
            }
        }
        chartView.group.traverse(function (el) {
            // FIXME marker and other components
            if (!el.isGroup) {
                el.setStyle('blend', blendMode);
            }
        });
    }
    /**
     * @param {module:echarts/model/Series|module:echarts/model/Component} model
     * @param {module:echarts/view/Component|module:echarts/view/Chart} view
     */
    function updateZ(model, view) {
        var z = model.get('z');
        var zlevel = model.get('zlevel');
        // Set z and zlevel
        view.group.traverse(function (el) {
            if (el.type !== 'group') {
                z != null && (el.z = z);
                zlevel != null && (el.zlevel = zlevel);
            }
        });
    }
    /**
     * @type {Array.<Function>}
     * @inner
     */
    var actions = [];
    /**
     * Map eventType to actionType
     * @type {Object}
     */
    var eventActionMap = {};
    /**
     * Data processor functions of each stage
     * @type {Array.<Object.<string, Function>>}
     * @inner
     */
    var dataProcessorFuncs = [];
    /**
     * @type {Array.<Function>}
     * @inner
     */
    var optionPreprocessorFuncs = [];
    /**
     * Visual encoding functions of each stage
     * @type {Array.<Object.<string, Function>>}
     * @inner
     */
    var visualFuncs = [];
    /**
     * Theme storage
     * @type {Object.<key, Object>}
     */
    var themeStorage = {};
    /**
     * Loading effects
     */
    var loadingEffects = {};
    var instances = {};
    var connectedGroups = {};
    var idBase = new Date() - 0;
    var groupIdBase = new Date() - 0;
    var DOM_ATTRIBUTE_KEY = '_echarts_instance_';
    /**
     * @alias module:echarts
     */
    var echarts = {
            version: '3.3.2',
            dependencies: { zrender: '3.2.2' }
        };
    function enableConnect(chart) {
        var STATUS_PENDING = 0;
        var STATUS_UPDATING = 1;
        var STATUS_UPDATED = 2;
        var STATUS_KEY = '__connectUpdateStatus';
        function updateConnectedChartsStatus(charts, status) {
            for (var i = 0; i < charts.length; i++) {
                var otherChart = charts[i];
                otherChart[STATUS_KEY] = status;
            }
        }
        zrUtil.each(eventActionMap, function (actionType, eventType) {
            chart._messageCenter.on(eventType, function (event) {
                if (connectedGroups[chart.group] && chart[STATUS_KEY] !== STATUS_PENDING) {
                    var action = chart.makeActionFromEvent(event);
                    var otherCharts = [];
                    zrUtil.each(instances, function (otherChart) {
                        if (otherChart !== chart && otherChart.group === chart.group) {
                            otherCharts.push(otherChart);
                        }
                    });
                    updateConnectedChartsStatus(otherCharts, STATUS_PENDING);
                    each(otherCharts, function (otherChart) {
                        if (otherChart[STATUS_KEY] !== STATUS_UPDATING) {
                            otherChart.dispatchAction(action);
                        }
                    });
                    updateConnectedChartsStatus(otherCharts, STATUS_UPDATED);
                }
            });
        });
    }
    /**
     * @param {HTMLDomElement} dom
     * @param {Object} [theme]
     * @param {Object} opts
     * @param {number} [opts.devicePixelRatio] Use window.devicePixelRatio by default
     * @param {string} [opts.renderer] Currently only 'canvas' is supported.
     * @param {number} [opts.width] Use clientWidth of the input `dom` by default.
     *                              Can be 'auto' (the same as null/undefined)
     * @param {number} [opts.height] Use clientHeight of the input `dom` by default.
     *                               Can be 'auto' (the same as null/undefined)
     */
    echarts.init = function (dom, theme, opts) {
        if (true) {
            // Check version
            if (zrender.version.replace('.', '') - 0 < echarts.dependencies.zrender.replace('.', '') - 0) {
                throw new Error('ZRender ' + zrender.version + ' is too old for ECharts ' + echarts.version + '. Current version need ZRender ' + echarts.dependencies.zrender + '+');
            }
            if (!dom) {
                throw new Error('Initialize failed: invalid dom.');
            }
            if (zrUtil.isDom(dom) && dom.nodeName.toUpperCase() !== 'CANVAS' && (!dom.clientWidth || !dom.clientHeight)) {
                console.warn('Can\'t get dom width or height');
            }
        }
        var chart = new ECharts(dom, theme, opts);
        chart.id = 'ec_' + idBase++;
        instances[chart.id] = chart;
        dom.setAttribute && dom.setAttribute(DOM_ATTRIBUTE_KEY, chart.id);
        enableConnect(chart);
        return chart;
    };
    /**
     * @return {string|Array.<module:echarts~ECharts>} groupId
     */
    echarts.connect = function (groupId) {
        // Is array of charts
        if (zrUtil.isArray(groupId)) {
            var charts = groupId;
            groupId = null;
            // If any chart has group
            zrUtil.each(charts, function (chart) {
                if (chart.group != null) {
                    groupId = chart.group;
                }
            });
            groupId = groupId || 'g_' + groupIdBase++;
            zrUtil.each(charts, function (chart) {
                chart.group = groupId;
            });
        }
        connectedGroups[groupId] = true;
        return groupId;
    };
    /**
     * @return {string} groupId
     */
    echarts.disConnect = function (groupId) {
        connectedGroups[groupId] = false;
    };
    /**
     * Dispose a chart instance
     * @param  {module:echarts~ECharts|HTMLDomElement|string} chart
     */
    echarts.dispose = function (chart) {
        if (zrUtil.isDom(chart)) {
            chart = echarts.getInstanceByDom(chart);
        } else if (typeof chart === 'string') {
            chart = instances[chart];
        }
        if (chart instanceof ECharts && !chart.isDisposed()) {
            chart.dispose();
        }
    };
    /**
     * @param  {HTMLDomElement} dom
     * @return {echarts~ECharts}
     */
    echarts.getInstanceByDom = function (dom) {
        var key = dom.getAttribute(DOM_ATTRIBUTE_KEY);
        return instances[key];
    };
    /**
     * @param {string} key
     * @return {echarts~ECharts}
     */
    echarts.getInstanceById = function (key) {
        return instances[key];
    };
    /**
     * Register theme
     */
    echarts.registerTheme = function (name, theme) {
        themeStorage[name] = theme;
    };
    /**
     * Register option preprocessor
     * @param {Function} preprocessorFunc
     */
    echarts.registerPreprocessor = function (preprocessorFunc) {
        optionPreprocessorFuncs.push(preprocessorFunc);
    };
    /**
     * @param {number} [priority=1000]
     * @param {Function} processorFunc
     */
    echarts.registerProcessor = function (priority, processorFunc) {
        if (typeof priority === 'function') {
            processorFunc = priority;
            priority = PRIORITY_PROCESSOR_FILTER;
        }
        if (true) {
            if (isNaN(priority)) {
                throw new Error('Unkown processor priority');
            }
        }
        dataProcessorFuncs.push({
            prio: priority,
            func: processorFunc
        });
    };
    /**
     * Usage:
     * registerAction('someAction', 'someEvent', function () { ... });
     * registerAction('someAction', function () { ... });
     * registerAction(
     *     {type: 'someAction', event: 'someEvent', update: 'updateView'},
     *     function () { ... }
     * );
     *
     * @param {(string|Object)} actionInfo
     * @param {string} actionInfo.type
     * @param {string} [actionInfo.event]
     * @param {string} [actionInfo.update]
     * @param {string} [eventName]
     * @param {Function} action
     */
    echarts.registerAction = function (actionInfo, eventName, action) {
        if (typeof eventName === 'function') {
            action = eventName;
            eventName = '';
        }
        var actionType = zrUtil.isObject(actionInfo) ? actionInfo.type : [
                actionInfo,
                actionInfo = { event: eventName }
            ][0];
        // Event name is all lowercase
        actionInfo.event = (actionInfo.event || actionType).toLowerCase();
        eventName = actionInfo.event;
        if (!actions[actionType]) {
            actions[actionType] = {
                action: action,
                actionInfo: actionInfo
            };
        }
        eventActionMap[eventName] = actionType;
    };
    /**
     * @param {string} type
     * @param {*} CoordinateSystem
     */
    echarts.registerCoordinateSystem = function (type, CoordinateSystem) {
        CoordinateSystemManager.register(type, CoordinateSystem);
    };
    /**
     * Layout is a special stage of visual encoding
     * Most visual encoding like color are common for different chart
     * But each chart has it's own layout algorithm
     *
     * @param {number} [priority=1000]
     * @param {Function} layoutFunc
     */
    echarts.registerLayout = function (priority, layoutFunc) {
        if (typeof priority === 'function') {
            layoutFunc = priority;
            priority = PRIORITY_VISUAL_LAYOUT;
        }
        if (true) {
            if (isNaN(priority)) {
                throw new Error('Unkown layout priority');
            }
        }
        visualFuncs.push({
            prio: priority,
            func: layoutFunc,
            isLayout: true
        });
    };
    /**
     * @param {number} [priority=3000]
     * @param {Function} visualFunc
     */
    echarts.registerVisual = function (priority, visualFunc) {
        if (typeof priority === 'function') {
            visualFunc = priority;
            priority = PRIORITY_VISUAL_CHART;
        }
        if (true) {
            if (isNaN(priority)) {
                throw new Error('Unkown visual priority');
            }
        }
        visualFuncs.push({
            prio: priority,
            func: visualFunc
        });
    };
    /**
     * @param {string} name
     */
    echarts.registerLoading = function (name, loadingFx) {
        loadingEffects[name] = loadingFx;
    };
    var parseClassType = ComponentModel.parseClassType;
    /**
     * @param {Object} opts
     * @param {string} [superClass]
     */
    echarts.extendComponentModel = function (opts, superClass) {
        var Clazz = ComponentModel;
        if (superClass) {
            var classType = parseClassType(superClass);
            Clazz = ComponentModel.getClass(classType.main, classType.sub, true);
        }
        return Clazz.extend(opts);
    };
    /**
     * @param {Object} opts
     * @param {string} [superClass]
     */
    echarts.extendComponentView = function (opts, superClass) {
        var Clazz = ComponentView;
        if (superClass) {
            var classType = parseClassType(superClass);
            Clazz = ComponentView.getClass(classType.main, classType.sub, true);
        }
        return Clazz.extend(opts);
    };
    /**
     * @param {Object} opts
     * @param {string} [superClass]
     */
    echarts.extendSeriesModel = function (opts, superClass) {
        var Clazz = SeriesModel;
        if (superClass) {
            superClass = 'series.' + superClass.replace('series.', '');
            var classType = parseClassType(superClass);
            Clazz = ComponentModel.getClass(classType.main, classType.sub, true);
        }
        return Clazz.extend(opts);
    };
    /**
     * @param {Object} opts
     * @param {string} [superClass]
     */
    echarts.extendChartView = function (opts, superClass) {
        var Clazz = ChartView;
        if (superClass) {
            superClass.replace('series.', '');
            var classType = parseClassType(superClass);
            Clazz = ChartView.getClass(classType.main, true);
        }
        return Clazz.extend(opts);
    };
    /**
     * ZRender need a canvas context to do measureText.
     * But in node environment canvas may be created by node-canvas.
     * So we need to specify how to create a canvas instead of using document.createElement('canvas')
     *
     * Be careful of using it in the browser.
     *
     * @param {Function} creator
     * @example
     *     var Canvas = require('canvas');
     *     var echarts = require('echarts');
     *     echarts.setCanvasCreator(function () {
     *         // Small size is enough.
     *         return new Canvas(32, 32);
     *     });
     */
    echarts.setCanvasCreator = function (creator) {
        zrUtil.createCanvas = creator;
    };
    echarts.registerVisual(PRIORITY_VISUAL_GLOBAL, require('./visual/seriesColor'));
    echarts.registerPreprocessor(require('./preprocessor/backwardCompat'));
    echarts.registerLoading('default', require('./loading/default'));
    // Default action
    echarts.registerAction({
        type: 'highlight',
        event: 'highlight',
        update: 'highlight'
    }, zrUtil.noop);
    echarts.registerAction({
        type: 'downplay',
        event: 'downplay',
        update: 'downplay'
    }, zrUtil.noop);
    // --------
    // Exports
    // --------
    //
    echarts.List = require('./data/List');
    echarts.Model = require('./model/Model');
    echarts.graphic = require('./util/graphic');
    echarts.number = require('./util/number');
    echarts.format = require('./util/format');
    echarts.matrix = require('zrender/core/matrix');
    echarts.vector = require('zrender/core/vector');
    echarts.color = require('zrender/tool/color');
    echarts.util = {};
    each([
        'map',
        'each',
        'filter',
        'indexOf',
        'inherits',
        'reduce',
        'filter',
        'bind',
        'curry',
        'isArray',
        'isString',
        'isObject',
        'isFunction',
        'extend',
        'defaults',
        'clone'
    ], function (name) {
        echarts.util[name] = zrUtil[name];
    });
    // PRIORITY
    echarts.PRIORITY = {
        PROCESSOR: {
            FILTER: PRIORITY_PROCESSOR_FILTER,
            STATISTIC: PRIORITY_PROCESSOR_STATISTIC
        },
        VISUAL: {
            LAYOUT: PRIORITY_VISUAL_LAYOUT,
            GLOBAL: PRIORITY_VISUAL_GLOBAL,
            CHART: PRIORITY_VISUAL_CHART,
            COMPONENT: PRIORITY_VISUAL_COMPONENT,
            BRUSH: PRIORITY_VISUAL_BRUSH
        }
    };
    return echarts;
});
define('echarts/chart/bar', ['require', 'zrender/core/util', '../coord/cartesian/Grid', './bar/BarSeries', './bar/BarView', '../layout/barGrid', '../echarts', '../component/grid'], function (require) {
    var zrUtil = require('zrender/core/util');
    require('../coord/cartesian/Grid');
    require('./bar/BarSeries');
    require('./bar/BarView');
    var barLayoutGrid = require('../layout/barGrid');
    var echarts = require('../echarts');
    echarts.registerLayout(zrUtil.curry(barLayoutGrid, 'bar'));
    // Visual coding for legend
    echarts.registerVisual(function (ecModel) {
        ecModel.eachSeriesByType('bar', function (seriesModel) {
            var data = seriesModel.getData();
            data.setVisual('legendSymbol', 'roundRect');
        });
    });
    // In case developer forget to include grid component
    require('../component/grid');
});
define('echarts/chart/line', ['require', 'zrender/core/util', '../echarts', './line/LineSeries', './line/LineView', '../visual/symbol', '../layout/points', '../processor/dataSample', '../component/grid'], function (require) {
    var zrUtil = require('zrender/core/util');
    var echarts = require('../echarts');
    var PRIORITY = echarts.PRIORITY;
    require('./line/LineSeries');
    require('./line/LineView');
    echarts.registerVisual(zrUtil.curry(require('../visual/symbol'), 'line', 'circle', 'line'));
    echarts.registerLayout(zrUtil.curry(require('../layout/points'), 'line'));
    // Down sample after filter
    echarts.registerProcessor(PRIORITY.PROCESSOR.STATISTIC, zrUtil.curry(require('../processor/dataSample'), 'line'));
    // In case developer forget to include grid component
    require('../component/grid');
});
define('echarts/chart/pie', ['require', 'zrender/core/util', '../echarts', './pie/PieSeries', './pie/PieView', '../action/createDataSelectAction', '../visual/dataColor', './pie/pieLayout', '../processor/dataFilter'], function (require) {
    var zrUtil = require('zrender/core/util');
    var echarts = require('../echarts');
    require('./pie/PieSeries');
    require('./pie/PieView');
    require('../action/createDataSelectAction')('pie', [
        {
            type: 'pieToggleSelect',
            event: 'pieselectchanged',
            method: 'toggleSelected'
        },
        {
            type: 'pieSelect',
            event: 'pieselected',
            method: 'select'
        },
        {
            type: 'pieUnSelect',
            event: 'pieunselected',
            method: 'unSelect'
        }
    ]);
    echarts.registerVisual(zrUtil.curry(require('../visual/dataColor'), 'pie'));
    echarts.registerLayout(zrUtil.curry(require('./pie/pieLayout'), 'pie'));
    echarts.registerProcessor(zrUtil.curry(require('../processor/dataFilter'), 'pie'));
});
define('echarts/chart/scatter', ['require', 'zrender/core/util', '../echarts', './scatter/ScatterSeries', './scatter/ScatterView', '../visual/symbol', '../layout/points', '../component/grid'], function (require) {
    var zrUtil = require('zrender/core/util');
    var echarts = require('../echarts');
    require('./scatter/ScatterSeries');
    require('./scatter/ScatterView');
    echarts.registerVisual(zrUtil.curry(require('../visual/symbol'), 'scatter', 'circle', null));
    echarts.registerLayout(zrUtil.curry(require('../layout/points'), 'scatter'));
    // In case developer forget to include grid component
    require('../component/grid');
});
define('echarts/chart/effectScatter', ['require', 'zrender/core/util', '../echarts', './effectScatter/EffectScatterSeries', './effectScatter/EffectScatterView', '../visual/symbol', '../layout/points'], function (require) {
    var zrUtil = require('zrender/core/util');
    var echarts = require('../echarts');
    require('./effectScatter/EffectScatterSeries');
    require('./effectScatter/EffectScatterView');
    echarts.registerVisual(zrUtil.curry(require('../visual/symbol'), 'effectScatter', 'circle', null));
    echarts.registerLayout(zrUtil.curry(require('../layout/points'), 'effectScatter'));
});
define('echarts/component/grid', ['require', '../util/graphic', 'zrender/core/util', '../echarts', '../coord/cartesian/Grid', './axis'], function (require) {
    'use strict';
    var graphic = require('../util/graphic');
    var zrUtil = require('zrender/core/util');
    var echarts = require('../echarts');
    require('../coord/cartesian/Grid');
    require('./axis');
    // Grid view
    echarts.extendComponentView({
        type: 'grid',
        render: function (gridModel, ecModel) {
            this.group.removeAll();
            if (gridModel.get('show')) {
                this.group.add(new graphic.Rect({
                    shape: gridModel.coordinateSystem.getRect(),
                    style: zrUtil.defaults({ fill: gridModel.get('backgroundColor') }, gridModel.getItemStyle()),
                    silent: true,
                    z2: -1
                }));
            }
        }
    });
    echarts.registerPreprocessor(function (option) {
        // Only create grid when need
        if (option.xAxis && option.yAxis && !option.grid) {
            option.grid = {};
        }
    });
});
define('echarts/component/title', ['require', '../echarts', '../util/graphic', '../util/layout'], function (require) {
    'use strict';
    var echarts = require('../echarts');
    var graphic = require('../util/graphic');
    var layout = require('../util/layout');
    // Model
    echarts.extendComponentModel({
        type: 'title',
        layoutMode: {
            type: 'box',
            ignoreSize: true
        },
        defaultOption: {
            zlevel: 0,
            z: 6,
            show: true,
            text: '',
            target: 'blank',
            subtext: '',
            subtarget: 'blank',
            left: 0,
            top: 0,
            backgroundColor: 'rgba(0,0,0,0)',
            borderColor: '#ccc',
            borderWidth: 0,
            padding: 5,
            itemGap: 10,
            textStyle: {
                fontSize: 18,
                fontWeight: 'bolder',
                color: '#333'
            },
            subtextStyle: { color: '#aaa' }
        }
    });
    // View
    echarts.extendComponentView({
        type: 'title',
        render: function (titleModel, ecModel, api) {
            this.group.removeAll();
            if (!titleModel.get('show')) {
                return;
            }
            var group = this.group;
            var textStyleModel = titleModel.getModel('textStyle');
            var subtextStyleModel = titleModel.getModel('subtextStyle');
            var textAlign = titleModel.get('textAlign');
            var textBaseline = titleModel.get('textBaseline');
            var textEl = new graphic.Text({
                    style: {
                        text: titleModel.get('text'),
                        textFont: textStyleModel.getFont(),
                        fill: textStyleModel.getTextColor()
                    },
                    z2: 10
                });
            var textRect = textEl.getBoundingRect();
            var subText = titleModel.get('subtext');
            var subTextEl = new graphic.Text({
                    style: {
                        text: subText,
                        textFont: subtextStyleModel.getFont(),
                        fill: subtextStyleModel.getTextColor(),
                        y: textRect.height + titleModel.get('itemGap'),
                        textBaseline: 'top'
                    },
                    z2: 10
                });
            var link = titleModel.get('link');
            var sublink = titleModel.get('sublink');
            textEl.silent = !link;
            subTextEl.silent = !sublink;
            if (link) {
                textEl.on('click', function () {
                    window.open(link, '_' + titleModel.get('target'));
                });
            }
            if (sublink) {
                subTextEl.on('click', function () {
                    window.open(sublink, '_' + titleModel.get('subtarget'));
                });
            }
            group.add(textEl);
            subText && group.add(subTextEl);
            // If no subText, but add subTextEl, there will be an empty line.
            var groupRect = group.getBoundingRect();
            var layoutOption = titleModel.getBoxLayoutParams();
            layoutOption.width = groupRect.width;
            layoutOption.height = groupRect.height;
            var layoutRect = layout.getLayoutRect(layoutOption, {
                    width: api.getWidth(),
                    height: api.getHeight()
                }, titleModel.get('padding'));
            // Adjust text align based on position
            if (!textAlign) {
                // Align left if title is on the left. center and right is same
                textAlign = titleModel.get('left') || titleModel.get('right');
                if (textAlign === 'middle') {
                    textAlign = 'center';
                }
                // Adjust layout by text align
                if (textAlign === 'right') {
                    layoutRect.x += layoutRect.width;
                } else if (textAlign === 'center') {
                    layoutRect.x += layoutRect.width / 2;
                }
            }
            if (!textBaseline) {
                textBaseline = titleModel.get('top') || titleModel.get('bottom');
                if (textBaseline === 'center') {
                    textBaseline = 'middle';
                }
                if (textBaseline === 'bottom') {
                    layoutRect.y += layoutRect.height;
                } else if (textBaseline === 'middle') {
                    layoutRect.y += layoutRect.height / 2;
                }
                textBaseline = textBaseline || 'top';
            }
            group.attr('position', [
                layoutRect.x,
                layoutRect.y
            ]);
            var alignStyle = {
                    textAlign: textAlign,
                    textVerticalAlign: textBaseline
                };
            textEl.setStyle(alignStyle);
            subTextEl.setStyle(alignStyle);
            // Render background
            // Get groupRect again because textAlign has been changed
            groupRect = group.getBoundingRect();
            var padding = layoutRect.margin;
            var style = titleModel.getItemStyle([
                    'color',
                    'opacity'
                ]);
            style.fill = titleModel.get('backgroundColor');
            var rect = new graphic.Rect({
                    shape: {
                        x: groupRect.x - padding[3],
                        y: groupRect.y - padding[0],
                        width: groupRect.width + padding[1] + padding[3],
                        height: groupRect.height + padding[0] + padding[2]
                    },
                    style: style,
                    silent: true
                });
            graphic.subPixelOptimizeRect(rect);
            group.add(rect);
        }
    });
});
define('echarts/component/legend', ['require', './legend/LegendModel', './legend/legendAction', './legend/LegendView', '../echarts', './legend/legendFilter'], function (require) {
    require('./legend/LegendModel');
    require('./legend/legendAction');
    require('./legend/LegendView');
    var echarts = require('../echarts');
    // Series Filter
    echarts.registerProcessor(require('./legend/legendFilter'));
});
define('echarts/component/tooltip', ['require', './tooltip/TooltipModel', './tooltip/TooltipView', '../echarts'], function (require) {
    require('./tooltip/TooltipModel');
    require('./tooltip/TooltipView');
    // Show tip action
    /**
     * @action
     * @property {string} type
     * @property {number} seriesIndex
     * @property {number} dataIndex
     * @property {number} [x]
     * @property {number} [y]
     */
    require('../echarts').registerAction({
        type: 'showTip',
        event: 'showTip',
        update: 'none'
    }, function () {
    });
    // Hide tip action
    require('../echarts').registerAction({
        type: 'hideTip',
        event: 'hideTip',
        update: 'none'
    }, function () {
    });
});
define('echarts/scale/Time', ['require', 'zrender/core/util', '../util/number', '../util/format', './Interval'], function (require) {
    var zrUtil = require('zrender/core/util');
    var numberUtil = require('../util/number');
    var formatUtil = require('../util/format');
    var IntervalScale = require('./Interval');
    var intervalScaleProto = IntervalScale.prototype;
    var mathCeil = Math.ceil;
    var mathFloor = Math.floor;
    var ONE_SECOND = 1000;
    var ONE_MINUTE = ONE_SECOND * 60;
    var ONE_HOUR = ONE_MINUTE * 60;
    var ONE_DAY = ONE_HOUR * 24;
    // FIXME 公用？
    var bisect = function (a, x, lo, hi) {
        while (lo < hi) {
            var mid = lo + hi >>> 1;
            if (a[mid][2] < x) {
                lo = mid + 1;
            } else {
                hi = mid;
            }
        }
        return lo;
    };
    /**
     * @alias module:echarts/coord/scale/Time
     * @constructor
     */
    var TimeScale = IntervalScale.extend({
            type: 'time',
            getLabel: function (val) {
                var stepLvl = this._stepLvl;
                var date = new Date(val);
                return formatUtil.formatTime(stepLvl[0], date);
            },
            niceExtent: function (approxTickNum, fixMin, fixMax) {
                var extent = this._extent;
                // If extent start and end are same, expand them
                if (extent[0] === extent[1]) {
                    // Expand extent
                    extent[0] -= ONE_DAY;
                    extent[1] += ONE_DAY;
                }
                // If there are no data and extent are [Infinity, -Infinity]
                if (extent[1] === -Infinity && extent[0] === Infinity) {
                    var d = new Date();
                    extent[1] = new Date(d.getFullYear(), d.getMonth(), d.getDate());
                    extent[0] = extent[1] - ONE_DAY;
                }
                this.niceTicks(approxTickNum);
                // var extent = this._extent;
                var interval = this._interval;
                if (!fixMin) {
                    extent[0] = numberUtil.round(mathFloor(extent[0] / interval) * interval);
                }
                if (!fixMax) {
                    extent[1] = numberUtil.round(mathCeil(extent[1] / interval) * interval);
                }
            },
            niceTicks: function (approxTickNum) {
                approxTickNum = approxTickNum || 10;
                var extent = this._extent;
                var span = extent[1] - extent[0];
                var approxInterval = span / approxTickNum;
                var scaleLevelsLen = scaleLevels.length;
                var idx = bisect(scaleLevels, approxInterval, 0, scaleLevelsLen);
                var level = scaleLevels[Math.min(idx, scaleLevelsLen - 1)];
                var interval = level[2];
                // Same with interval scale if span is much larger than 1 year
                if (level[0] === 'year') {
                    var yearSpan = span / interval;
                    // From "Nice Numbers for Graph Labels" of Graphic Gems
                    // var niceYearSpan = numberUtil.nice(yearSpan, false);
                    var yearStep = numberUtil.nice(yearSpan / approxTickNum, true);
                    interval *= yearStep;
                }
                var niceExtent = [
                        mathCeil(extent[0] / interval) * interval,
                        mathFloor(extent[1] / interval) * interval
                    ];
                this._stepLvl = level;
                // Interval will be used in getTicks
                this._interval = interval;
                this._niceExtent = niceExtent;
            },
            parse: function (val) {
                // val might be float.
                return +numberUtil.parseDate(val);
            }
        });
    zrUtil.each([
        'contain',
        'normalize'
    ], function (methodName) {
        TimeScale.prototype[methodName] = function (val) {
            return intervalScaleProto[methodName].call(this, this.parse(val));
        };
    });
    // Steps from d3
    var scaleLevels = [
            [
                'hh:mm:ss',
                1,
                ONE_SECOND
            ],
            [
                'hh:mm:ss',
                5,
                ONE_SECOND * 5
            ],
            [
                'hh:mm:ss',
                10,
                ONE_SECOND * 10
            ],
            [
                'hh:mm:ss',
                15,
                ONE_SECOND * 15
            ],
            [
                'hh:mm:ss',
                30,
                ONE_SECOND * 30
            ],
            [
                'hh:mm\nMM-dd',
                1,
                ONE_MINUTE
            ],
            [
                'hh:mm\nMM-dd',
                5,
                ONE_MINUTE * 5
            ],
            [
                'hh:mm\nMM-dd',
                10,
                ONE_MINUTE * 10
            ],
            [
                'hh:mm\nMM-dd',
                15,
                ONE_MINUTE * 15
            ],
            [
                'hh:mm\nMM-dd',
                30,
                ONE_MINUTE * 30
            ],
            [
                'hh:mm\nMM-dd',
                1,
                ONE_HOUR
            ],
            [
                'hh:mm\nMM-dd',
                2,
                ONE_HOUR * 2
            ],
            [
                'hh:mm\nMM-dd',
                6,
                ONE_HOUR * 6
            ],
            [
                'hh:mm\nMM-dd',
                12,
                ONE_HOUR * 12
            ],
            [
                'MM-dd\nyyyy',
                1,
                ONE_DAY
            ],
            [
                'week',
                7,
                ONE_DAY * 7
            ],
            [
                'month',
                1,
                ONE_DAY * 31
            ],
            [
                'quarter',
                3,
                ONE_DAY * 380 / 4
            ],
            [
                'half-year',
                6,
                ONE_DAY * 380 / 2
            ],
            [
                'year',
                1,
                ONE_DAY * 380
            ]
        ];
    /**
     * @return {module:echarts/scale/Time}
     */
    TimeScale.create = function () {
        return new TimeScale();
    };
    return TimeScale;
});
define('echarts/scale/Log', ['require', 'zrender/core/util', './Scale', '../util/number', './Interval'], function (require) {
    var zrUtil = require('zrender/core/util');
    var Scale = require('./Scale');
    var numberUtil = require('../util/number');
    // Use some method of IntervalScale
    var IntervalScale = require('./Interval');
    var scaleProto = Scale.prototype;
    var intervalScaleProto = IntervalScale.prototype;
    var getPrecisionSafe = numberUtil.getPrecisionSafe;
    var roundingErrorFix = numberUtil.round;
    var mathFloor = Math.floor;
    var mathCeil = Math.ceil;
    var mathPow = Math.pow;
    var mathLog = Math.log;
    var LogScale = Scale.extend({
            type: 'log',
            base: 10,
            $constructor: function () {
                Scale.apply(this, arguments);
                this._originalScale = new IntervalScale();
            },
            getTicks: function () {
                var originalScale = this._originalScale;
                var extent = this._extent;
                var originalExtent = originalScale.getExtent();
                return zrUtil.map(intervalScaleProto.getTicks.call(this), function (val) {
                    var powVal = numberUtil.round(mathPow(this.base, val));
                    // Fix #4158
                    powVal = val === extent[0] && originalScale.__fixMin ? fixRoundingError(powVal, originalExtent[0]) : powVal;
                    powVal = val === extent[1] && originalScale.__fixMax ? fixRoundingError(powVal, originalExtent[1]) : powVal;
                    return powVal;
                }, this);
            },
            getLabel: intervalScaleProto.getLabel,
            scale: function (val) {
                val = scaleProto.scale.call(this, val);
                return mathPow(this.base, val);
            },
            setExtent: function (start, end) {
                var base = this.base;
                start = mathLog(start) / mathLog(base);
                end = mathLog(end) / mathLog(base);
                intervalScaleProto.setExtent.call(this, start, end);
            },
            getExtent: function () {
                var base = this.base;
                var extent = scaleProto.getExtent.call(this);
                extent[0] = mathPow(base, extent[0]);
                extent[1] = mathPow(base, extent[1]);
                // Fix #4158
                var originalScale = this._originalScale;
                var originalExtent = originalScale.getExtent();
                originalScale.__fixMin && (extent[0] = fixRoundingError(extent[0], originalExtent[0]));
                originalScale.__fixMax && (extent[1] = fixRoundingError(extent[1], originalExtent[1]));
                return extent;
            },
            unionExtent: function (extent) {
                this._originalScale.unionExtent(extent);
                var base = this.base;
                extent[0] = mathLog(extent[0]) / mathLog(base);
                extent[1] = mathLog(extent[1]) / mathLog(base);
                scaleProto.unionExtent.call(this, extent);
            },
            niceTicks: function (approxTickNum) {
                approxTickNum = approxTickNum || 10;
                var extent = this._extent;
                var span = extent[1] - extent[0];
                if (span === Infinity || span <= 0) {
                    return;
                }
                var interval = numberUtil.quantity(span);
                var err = approxTickNum / span * interval;
                // Filter ticks to get closer to the desired count.
                if (err <= 0.5) {
                    interval *= 10;
                }
                // Interval should be integer
                while (!isNaN(interval) && Math.abs(interval) < 1 && Math.abs(interval) > 0) {
                    interval *= 10;
                }
                var niceExtent = [
                        numberUtil.round(mathCeil(extent[0] / interval) * interval),
                        numberUtil.round(mathFloor(extent[1] / interval) * interval)
                    ];
                this._interval = interval;
                this._niceExtent = niceExtent;
            },
            niceExtent: function (splitNumber, fixMin, fixMax) {
                intervalScaleProto.niceExtent.call(this, splitNumber, fixMin, fixMax);
                var originalScale = this._originalScale;
                originalScale.__fixMin = fixMin;
                originalScale.__fixMax = fixMax;
            }
        });
    zrUtil.each([
        'contain',
        'normalize'
    ], function (methodName) {
        LogScale.prototype[methodName] = function (val) {
            val = mathLog(val) / mathLog(this.base);
            return scaleProto[methodName].call(this, val);
        };
    });
    LogScale.create = function () {
        return new LogScale();
    };
    function fixRoundingError(val, originalVal) {
        return roundingErrorFix(val, getPrecisionSafe(originalVal));
    }
    return LogScale;
});
define('zrender/core/env', [], function () {
    var env = {};
    if (typeof navigator === 'undefined') {
        // In node
        env = {
            browser: {},
            os: {},
            node: true,
            canvasSupported: true
        };
    } else {
        env = detect(navigator.userAgent);
    }
    return env;
    // Zepto.js
    // (c) 2010-2013 Thomas Fuchs
    // Zepto.js may be freely distributed under the MIT license.
    function detect(ua) {
        var os = {};
        var browser = {};
        // var webkit = ua.match(/Web[kK]it[\/]{0,1}([\d.]+)/);
        // var android = ua.match(/(Android);?[\s\/]+([\d.]+)?/);
        // var ipad = ua.match(/(iPad).*OS\s([\d_]+)/);
        // var ipod = ua.match(/(iPod)(.*OS\s([\d_]+))?/);
        // var iphone = !ipad && ua.match(/(iPhone\sOS)\s([\d_]+)/);
        // var webos = ua.match(/(webOS|hpwOS)[\s\/]([\d.]+)/);
        // var touchpad = webos && ua.match(/TouchPad/);
        // var kindle = ua.match(/Kindle\/([\d.]+)/);
        // var silk = ua.match(/Silk\/([\d._]+)/);
        // var blackberry = ua.match(/(BlackBerry).*Version\/([\d.]+)/);
        // var bb10 = ua.match(/(BB10).*Version\/([\d.]+)/);
        // var rimtabletos = ua.match(/(RIM\sTablet\sOS)\s([\d.]+)/);
        // var playbook = ua.match(/PlayBook/);
        // var chrome = ua.match(/Chrome\/([\d.]+)/) || ua.match(/CriOS\/([\d.]+)/);
        var firefox = ua.match(/Firefox\/([\d.]+)/);
        // var safari = webkit && ua.match(/Mobile\//) && !chrome;
        // var webview = ua.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/) && !chrome;
        var ie = ua.match(/MSIE\s([\d.]+)/) || ua.match(/Trident\/.+?rv:(([\d.]+))/);
        var edge = ua.match(/Edge\/([\d.]+)/);
        // IE 12 and 12+
        var weChat = /micromessenger/i.test(ua);
        // Todo: clean this up with a better OS/browser seperation:
        // - discern (more) between multiple browsers on android
        // - decide if kindle fire in silk mode is android or not
        // - Firefox on Android doesn't specify the Android version
        // - possibly devide in os, device and browser hashes
        // if (browser.webkit = !!webkit) browser.version = webkit[1];
        // if (android) os.android = true, os.version = android[2];
        // if (iphone && !ipod) os.ios = os.iphone = true, os.version = iphone[2].replace(/_/g, '.');
        // if (ipad) os.ios = os.ipad = true, os.version = ipad[2].replace(/_/g, '.');
        // if (ipod) os.ios = os.ipod = true, os.version = ipod[3] ? ipod[3].replace(/_/g, '.') : null;
        // if (webos) os.webos = true, os.version = webos[2];
        // if (touchpad) os.touchpad = true;
        // if (blackberry) os.blackberry = true, os.version = blackberry[2];
        // if (bb10) os.bb10 = true, os.version = bb10[2];
        // if (rimtabletos) os.rimtabletos = true, os.version = rimtabletos[2];
        // if (playbook) browser.playbook = true;
        // if (kindle) os.kindle = true, os.version = kindle[1];
        // if (silk) browser.silk = true, browser.version = silk[1];
        // if (!silk && os.android && ua.match(/Kindle Fire/)) browser.silk = true;
        // if (chrome) browser.chrome = true, browser.version = chrome[1];
        if (firefox) {
            browser.firefox = true;
            browser.version = firefox[1];
        }
        // if (safari && (ua.match(/Safari/) || !!os.ios)) browser.safari = true;
        // if (webview) browser.webview = true;
        if (ie) {
            browser.ie = true;
            browser.version = ie[1];
        }
        if (edge) {
            browser.edge = true;
            browser.version = edge[1];
        }
        // It is difficult to detect WeChat in Win Phone precisely, because ua can
        // not be set on win phone. So we do not consider Win Phone.
        if (weChat) {
            browser.weChat = true;
        }
        // os.tablet = !!(ipad || playbook || (android && !ua.match(/Mobile/)) ||
        //     (firefox && ua.match(/Tablet/)) || (ie && !ua.match(/Phone/) && ua.match(/Touch/)));
        // os.phone  = !!(!os.tablet && !os.ipod && (android || iphone || webos ||
        //     (chrome && ua.match(/Android/)) || (chrome && ua.match(/CriOS\/([\d.]+)/)) ||
        //     (firefox && ua.match(/Mobile/)) || (ie && ua.match(/Touch/))));
        return {
            browser: browser,
            os: os,
            node: false,
            canvasSupported: document.createElement('canvas').getContext ? true : false,
            touchEventsSupported: 'ontouchstart' in window && !browser.ie && !browser.edge,
            pointerEventsSupported: 'onpointerdown' in window && (browser.edge || browser.ie && browser.version >= 10)
        };
    }
});
define('echarts/model/Global', ['require', 'zrender/core/util', '../util/model', './Model', './Component', './globalDefault', './mixin/colorPalette'], function (require) {
    /**
     * Caution: If the mechanism should be changed some day, these cases
     * should be considered:
     *
     * (1) In `merge option` mode, if using the same option to call `setOption`
     * many times, the result should be the same (try our best to ensure that).
     * (2) In `merge option` mode, if a component has no id/name specified, it
     * will be merged by index, and the result sequence of the components is
     * consistent to the original sequence.
     * (3) `reset` feature (in toolbox). Find detailed info in comments about
     * `mergeOption` in module:echarts/model/OptionManager.
     */
    var zrUtil = require('zrender/core/util');
    var modelUtil = require('../util/model');
    var Model = require('./Model');
    var each = zrUtil.each;
    var filter = zrUtil.filter;
    var map = zrUtil.map;
    var isArray = zrUtil.isArray;
    var indexOf = zrUtil.indexOf;
    var isObject = zrUtil.isObject;
    var ComponentModel = require('./Component');
    var globalDefault = require('./globalDefault');
    var OPTION_INNER_KEY = ' _ec_inner';
    /**
     * @alias module:echarts/model/Global
     *
     * @param {Object} option
     * @param {module:echarts/model/Model} parentModel
     * @param {Object} theme
     */
    var GlobalModel = Model.extend({
            constructor: GlobalModel,
            init: function (option, parentModel, theme, optionManager) {
                theme = theme || {};
                this.option = null;
                // Mark as not initialized.
                /**
             * @type {module:echarts/model/Model}
             * @private
             */
                this._theme = new Model(theme);
                /**
             * @type {module:echarts/model/OptionManager}
             */
                this._optionManager = optionManager;
            },
            setOption: function (option, optionPreprocessorFuncs) {
                zrUtil.assert(!(OPTION_INNER_KEY in option), 'please use chart.getOption()');
                this._optionManager.setOption(option, optionPreprocessorFuncs);
                this.resetOption();
            },
            resetOption: function (type) {
                var optionChanged = false;
                var optionManager = this._optionManager;
                if (!type || type === 'recreate') {
                    var baseOption = optionManager.mountOption(type === 'recreate');
                    if (!this.option || type === 'recreate') {
                        initBase.call(this, baseOption);
                    } else {
                        this.restoreData();
                        this.mergeOption(baseOption);
                    }
                    optionChanged = true;
                }
                if (type === 'timeline' || type === 'media') {
                    this.restoreData();
                }
                if (!type || type === 'recreate' || type === 'timeline') {
                    var timelineOption = optionManager.getTimelineOption(this);
                    timelineOption && (this.mergeOption(timelineOption), optionChanged = true);
                }
                if (!type || type === 'recreate' || type === 'media') {
                    var mediaOptions = optionManager.getMediaOption(this, this._api);
                    if (mediaOptions.length) {
                        each(mediaOptions, function (mediaOption) {
                            this.mergeOption(mediaOption, optionChanged = true);
                        }, this);
                    }
                }
                return optionChanged;
            },
            mergeOption: function (newOption) {
                var option = this.option;
                var componentsMap = this._componentsMap;
                var newCptTypes = [];
                // 如果不存在对应的 component model 则直接 merge
                each(newOption, function (componentOption, mainType) {
                    if (componentOption == null) {
                        return;
                    }
                    if (!ComponentModel.hasClass(mainType)) {
                        option[mainType] = option[mainType] == null ? zrUtil.clone(componentOption) : zrUtil.merge(option[mainType], componentOption, true);
                    } else {
                        newCptTypes.push(mainType);
                    }
                });
                // FIXME OPTION 同步是否要改回原来的
                ComponentModel.topologicalTravel(newCptTypes, ComponentModel.getAllClassMainTypes(), visitComponent, this);
                this._seriesIndices = this._seriesIndices || [];
                function visitComponent(mainType, dependencies) {
                    var newCptOptionList = modelUtil.normalizeToArray(newOption[mainType]);
                    var mapResult = modelUtil.mappingToExists(componentsMap[mainType], newCptOptionList);
                    modelUtil.makeIdAndName(mapResult);
                    // Set mainType and complete subType.
                    each(mapResult, function (item, index) {
                        var opt = item.option;
                        if (isObject(opt)) {
                            item.keyInfo.mainType = mainType;
                            item.keyInfo.subType = determineSubType(mainType, opt, item.exist);
                        }
                    });
                    var dependentModels = getComponentsByTypes(componentsMap, dependencies);
                    option[mainType] = [];
                    componentsMap[mainType] = [];
                    each(mapResult, function (resultItem, index) {
                        var componentModel = resultItem.exist;
                        var newCptOption = resultItem.option;
                        zrUtil.assert(isObject(newCptOption) || componentModel, 'Empty component definition');
                        // Consider where is no new option and should be merged using {},
                        // see removeEdgeAndAdd in topologicalTravel and
                        // ComponentModel.getAllClassMainTypes.
                        if (!newCptOption) {
                            componentModel.mergeOption({}, this);
                            componentModel.optionUpdated({}, false);
                        } else {
                            var ComponentModelClass = ComponentModel.getClass(mainType, resultItem.keyInfo.subType, true);
                            if (componentModel && componentModel instanceof ComponentModelClass) {
                                componentModel.name = resultItem.keyInfo.name;
                                componentModel.mergeOption(newCptOption, this);
                                componentModel.optionUpdated(newCptOption, false);
                            } else {
                                // PENDING Global as parent ?
                                var extraOpt = zrUtil.extend({
                                        dependentModels: dependentModels,
                                        componentIndex: index
                                    }, resultItem.keyInfo);
                                componentModel = new ComponentModelClass(newCptOption, this, this, extraOpt);
                                zrUtil.extend(componentModel, extraOpt);
                                componentModel.init(newCptOption, this, this, extraOpt);
                                // Call optionUpdated after init.
                                // newCptOption has been used as componentModel.option
                                // and may be merged with theme and default, so pass null
                                // to avoid confusion.
                                componentModel.optionUpdated(null, true);
                            }
                        }
                        componentsMap[mainType][index] = componentModel;
                        option[mainType][index] = componentModel.option;
                    }, this);
                    // Backup series for filtering.
                    if (mainType === 'series') {
                        this._seriesIndices = createSeriesIndices(componentsMap.series);
                    }
                }
            },
            getOption: function () {
                var option = zrUtil.clone(this.option);
                each(option, function (opts, mainType) {
                    if (ComponentModel.hasClass(mainType)) {
                        var opts = modelUtil.normalizeToArray(opts);
                        for (var i = opts.length - 1; i >= 0; i--) {
                            // Remove options with inner id.
                            if (modelUtil.isIdInner(opts[i])) {
                                opts.splice(i, 1);
                            }
                        }
                        option[mainType] = opts;
                    }
                });
                delete option[OPTION_INNER_KEY];
                return option;
            },
            getTheme: function () {
                return this._theme;
            },
            getComponent: function (mainType, idx) {
                var list = this._componentsMap[mainType];
                if (list) {
                    return list[idx || 0];
                }
            },
            queryComponents: function (condition) {
                var mainType = condition.mainType;
                if (!mainType) {
                    return [];
                }
                var index = condition.index;
                var id = condition.id;
                var name = condition.name;
                var cpts = this._componentsMap[mainType];
                if (!cpts || !cpts.length) {
                    return [];
                }
                var result;
                if (index != null) {
                    if (!isArray(index)) {
                        index = [index];
                    }
                    result = filter(map(index, function (idx) {
                        return cpts[idx];
                    }), function (val) {
                        return !!val;
                    });
                } else if (id != null) {
                    var isIdArray = isArray(id);
                    result = filter(cpts, function (cpt) {
                        return isIdArray && indexOf(id, cpt.id) >= 0 || !isIdArray && cpt.id === id;
                    });
                } else if (name != null) {
                    var isNameArray = isArray(name);
                    result = filter(cpts, function (cpt) {
                        return isNameArray && indexOf(name, cpt.name) >= 0 || !isNameArray && cpt.name === name;
                    });
                } else {
                    // Return all components with mainType
                    result = cpts;
                }
                return filterBySubType(result, condition);
            },
            findComponents: function (condition) {
                var query = condition.query;
                var mainType = condition.mainType;
                var queryCond = getQueryCond(query);
                var result = queryCond ? this.queryComponents(queryCond) : this._componentsMap[mainType];
                return doFilter(filterBySubType(result, condition));
                function getQueryCond(q) {
                    var indexAttr = mainType + 'Index';
                    var idAttr = mainType + 'Id';
                    var nameAttr = mainType + 'Name';
                    return q && (q.hasOwnProperty(indexAttr) || q.hasOwnProperty(idAttr) || q.hasOwnProperty(nameAttr)) ? {
                        mainType: mainType,
                        index: q[indexAttr],
                        id: q[idAttr],
                        name: q[nameAttr]
                    } : null;
                }
                function doFilter(res) {
                    return condition.filter ? filter(res, condition.filter) : res;
                }
            },
            eachComponent: function (mainType, cb, context) {
                var componentsMap = this._componentsMap;
                if (typeof mainType === 'function') {
                    context = cb;
                    cb = mainType;
                    each(componentsMap, function (components, componentType) {
                        each(components, function (component, index) {
                            cb.call(context, componentType, component, index);
                        });
                    });
                } else if (zrUtil.isString(mainType)) {
                    each(componentsMap[mainType], cb, context);
                } else if (isObject(mainType)) {
                    var queryResult = this.findComponents(mainType);
                    each(queryResult, cb, context);
                }
            },
            getSeriesByName: function (name) {
                var series = this._componentsMap.series;
                return filter(series, function (oneSeries) {
                    return oneSeries.name === name;
                });
            },
            getSeriesByIndex: function (seriesIndex) {
                return this._componentsMap.series[seriesIndex];
            },
            getSeriesByType: function (subType) {
                var series = this._componentsMap.series;
                return filter(series, function (oneSeries) {
                    return oneSeries.subType === subType;
                });
            },
            getSeries: function () {
                return this._componentsMap.series.slice();
            },
            eachSeries: function (cb, context) {
                assertSeriesInitialized(this);
                each(this._seriesIndices, function (rawSeriesIndex) {
                    var series = this._componentsMap.series[rawSeriesIndex];
                    cb.call(context, series, rawSeriesIndex);
                }, this);
            },
            eachRawSeries: function (cb, context) {
                each(this._componentsMap.series, cb, context);
            },
            eachSeriesByType: function (subType, cb, context) {
                assertSeriesInitialized(this);
                each(this._seriesIndices, function (rawSeriesIndex) {
                    var series = this._componentsMap.series[rawSeriesIndex];
                    if (series.subType === subType) {
                        cb.call(context, series, rawSeriesIndex);
                    }
                }, this);
            },
            eachRawSeriesByType: function (subType, cb, context) {
                return each(this.getSeriesByType(subType), cb, context);
            },
            isSeriesFiltered: function (seriesModel) {
                assertSeriesInitialized(this);
                return zrUtil.indexOf(this._seriesIndices, seriesModel.componentIndex) < 0;
            },
            filterSeries: function (cb, context) {
                assertSeriesInitialized(this);
                var filteredSeries = filter(this._componentsMap.series, cb, context);
                this._seriesIndices = createSeriesIndices(filteredSeries);
            },
            restoreData: function () {
                var componentsMap = this._componentsMap;
                this._seriesIndices = createSeriesIndices(componentsMap.series);
                var componentTypes = [];
                each(componentsMap, function (components, componentType) {
                    componentTypes.push(componentType);
                });
                ComponentModel.topologicalTravel(componentTypes, ComponentModel.getAllClassMainTypes(), function (componentType, dependencies) {
                    each(componentsMap[componentType], function (component) {
                        component.restoreData();
                    });
                });
            }
        });
    /**
     * @inner
     */
    function mergeTheme(option, theme) {
        zrUtil.each(theme, function (themeItem, name) {
            // 如果有 component model 则把具体的 merge 逻辑交给该 model 处理
            if (!ComponentModel.hasClass(name)) {
                if (typeof themeItem === 'object') {
                    option[name] = !option[name] ? zrUtil.clone(themeItem) : zrUtil.merge(option[name], themeItem, false);
                } else {
                    if (option[name] == null) {
                        option[name] = themeItem;
                    }
                }
            }
        });
    }
    function initBase(baseOption) {
        baseOption = baseOption;
        // Using OPTION_INNER_KEY to mark that this option can not be used outside,
        // i.e. `chart.setOption(chart.getModel().option);` is forbiden.
        this.option = {};
        this.option[OPTION_INNER_KEY] = 1;
        /**
         * @type {Object.<string, Array.<module:echarts/model/Model>>}
         * @private
         */
        this._componentsMap = {};
        /**
         * Mapping between filtered series list and raw series list.
         * key: filtered series indices, value: raw series indices.
         * @type {Array.<nubmer>}
         * @private
         */
        this._seriesIndices = null;
        mergeTheme(baseOption, this._theme.option);
        // TODO Needs clone when merging to the unexisted property
        zrUtil.merge(baseOption, globalDefault, false);
        this.mergeOption(baseOption);
    }
    /**
     * @inner
     * @param {Array.<string>|string} types model types
     * @return {Object} key: {string} type, value: {Array.<Object>} models
     */
    function getComponentsByTypes(componentsMap, types) {
        if (!zrUtil.isArray(types)) {
            types = types ? [types] : [];
        }
        var ret = {};
        each(types, function (type) {
            ret[type] = (componentsMap[type] || []).slice();
        });
        return ret;
    }
    /**
     * @inner
     */
    function determineSubType(mainType, newCptOption, existComponent) {
        var subType = newCptOption.type ? newCptOption.type : existComponent ? existComponent.subType : ComponentModel.determineSubType(mainType, newCptOption);
        // tooltip, markline, markpoint may always has no subType
        return subType;
    }
    /**
     * @inner
     */
    function createSeriesIndices(seriesModels) {
        return map(seriesModels, function (series) {
            return series.componentIndex;
        }) || [];
    }
    /**
     * @inner
     */
    function filterBySubType(components, condition) {
        // Using hasOwnProperty for restrict. Consider
        // subType is undefined in user payload.
        return condition.hasOwnProperty('subType') ? filter(components, function (cpt) {
            return cpt.subType === condition.subType;
        }) : components;
    }
    /**
     * @inner
     */
    function assertSeriesInitialized(ecModel) {
        // Components that use _seriesIndices should depends on series component,
        // which make sure that their initialization is after series.
        if (true) {
            if (!ecModel._seriesIndices) {
                throw new Error('Series has not been initialized yet.');
            }
        }
    }
    zrUtil.mixin(GlobalModel, require('./mixin/colorPalette'));
    return GlobalModel;
});
define('echarts/ExtensionAPI', ['require', 'zrender/core/util'], function (require) {
    'use strict';
    var zrUtil = require('zrender/core/util');
    var echartsAPIList = [
            'getDom',
            'getZr',
            'getWidth',
            'getHeight',
            'dispatchAction',
            'isDisposed',
            'on',
            'off',
            'getDataURL',
            'getConnectedDataURL',
            'getModel',
            'getOption'
        ];
    function ExtensionAPI(chartInstance) {
        zrUtil.each(echartsAPIList, function (name) {
            this[name] = zrUtil.bind(chartInstance[name], chartInstance);
        }, this);
    }
    return ExtensionAPI;
});
define('echarts/CoordinateSystem', ['require', 'zrender/core/util'], function (require) {
    'use strict';
    var zrUtil = require('zrender/core/util');
    /**
     * Interface of Coordinate System Class
     *
     * create:
     *     @param {module:echarts/model/Global} ecModel
     *     @param {module:echarts/ExtensionAPI} api
     *     @return {Object} coordinate system instance
     *
     * update:
     *     @param {module:echarts/model/Global} ecModel
     *     @param {module:echarts/ExtensionAPI} api
     *
     * convertToPixel:
     * convertFromPixel:
     *     These two methods is also responsible for determine whether this
     *     coodinate system is applicable to the given `finder`.
     *     Each coordinate system will be tried, util one returns none
     *     null/undefined value.
     *     @param {module:echarts/model/Global} ecModel
     *     @param {Object} finder
     *     @param {Array|number} value
     *     @return {Array|number} convert result.
     *
     * containPoint:
     *     @param {Array.<number>} point In pixel coordinate system.
     *     @return {boolean}
     */
    var coordinateSystemCreators = {};
    function CoordinateSystemManager() {
        this._coordinateSystems = [];
    }
    CoordinateSystemManager.prototype = {
        constructor: CoordinateSystemManager,
        create: function (ecModel, api) {
            var coordinateSystems = [];
            zrUtil.each(coordinateSystemCreators, function (creater, type) {
                var list = creater.create(ecModel, api);
                coordinateSystems = coordinateSystems.concat(list || []);
            });
            this._coordinateSystems = coordinateSystems;
        },
        update: function (ecModel, api) {
            zrUtil.each(this._coordinateSystems, function (coordSys) {
                // FIXME MUST have
                coordSys.update && coordSys.update(ecModel, api);
            });
        },
        getCoordinateSystems: function () {
            return this._coordinateSystems.slice();
        }
    };
    CoordinateSystemManager.register = function (type, coordinateSystemCreator) {
        coordinateSystemCreators[type] = coordinateSystemCreator;
    };
    CoordinateSystemManager.get = function (type) {
        return coordinateSystemCreators[type];
    };
    return CoordinateSystemManager;
});
define('echarts/model/OptionManager', ['require', 'zrender/core/util', '../util/model', './Component'], function (require) {
    var zrUtil = require('zrender/core/util');
    var modelUtil = require('../util/model');
    var ComponentModel = require('./Component');
    var each = zrUtil.each;
    var clone = zrUtil.clone;
    var map = zrUtil.map;
    var merge = zrUtil.merge;
    var QUERY_REG = /^(min|max)?(.+)$/;
    /**
     * TERM EXPLANATIONS:
     *
     * [option]:
     *
     *     An object that contains definitions of components. For example:
     *     var option = {
     *         title: {...},
     *         legend: {...},
     *         visualMap: {...},
     *         series: [
     *             {data: [...]},
     *             {data: [...]},
     *             ...
     *         ]
     *     };
     *
     * [rawOption]:
     *
     *     An object input to echarts.setOption. 'rawOption' may be an
     *     'option', or may be an object contains multi-options. For example:
     *     var option = {
     *         baseOption: {
     *             title: {...},
     *             legend: {...},
     *             series: [
     *                 {data: [...]},
     *                 {data: [...]},
     *                 ...
     *             ]
     *         },
     *         timeline: {...},
     *         options: [
     *             {title: {...}, series: {data: [...]}},
     *             {title: {...}, series: {data: [...]}},
     *             ...
     *         ],
     *         media: [
     *             {
     *                 query: {maxWidth: 320},
     *                 option: {series: {x: 20}, visualMap: {show: false}}
     *             },
     *             {
     *                 query: {minWidth: 320, maxWidth: 720},
     *                 option: {series: {x: 500}, visualMap: {show: true}}
     *             },
     *             {
     *                 option: {series: {x: 1200}, visualMap: {show: true}}
     *             }
     *         ]
     *     };
     *
     * @alias module:echarts/model/OptionManager
     * @param {module:echarts/ExtensionAPI} api
     */
    function OptionManager(api) {
        /**
         * @private
         * @type {module:echarts/ExtensionAPI}
         */
        this._api = api;
        /**
         * @private
         * @type {Array.<number>}
         */
        this._timelineOptions = [];
        /**
         * @private
         * @type {Array.<Object>}
         */
        this._mediaList = [];
        /**
         * @private
         * @type {Object}
         */
        this._mediaDefault;
        /**
         * -1, means default.
         * empty means no media.
         * @private
         * @type {Array.<number>}
         */
        this._currentMediaIndices = [];
        /**
         * @private
         * @type {Object}
         */
        this._optionBackup;
        /**
         * @private
         * @type {Object}
         */
        this._newBaseOption;
    }
    // timeline.notMerge is not supported in ec3. Firstly there is rearly
    // case that notMerge is needed. Secondly supporting 'notMerge' requires
    // rawOption cloned and backuped when timeline changed, which does no
    // good to performance. What's more, that both timeline and setOption
    // method supply 'notMerge' brings complex and some problems.
    // Consider this case:
    // (step1) chart.setOption({timeline: {notMerge: false}, ...}, false);
    // (step2) chart.setOption({timeline: {notMerge: true}, ...}, false);
    OptionManager.prototype = {
        constructor: OptionManager,
        setOption: function (rawOption, optionPreprocessorFuncs) {
            rawOption = clone(rawOption, true);
            // FIXME
            // 如果 timeline options 或者 media 中设置了某个属性，而baseOption中没有设置，则进行警告。
            var oldOptionBackup = this._optionBackup;
            var newParsedOption = parseRawOption.call(this, rawOption, optionPreprocessorFuncs, !oldOptionBackup);
            this._newBaseOption = newParsedOption.baseOption;
            // For setOption at second time (using merge mode);
            if (oldOptionBackup) {
                // Only baseOption can be merged.
                mergeOption(oldOptionBackup.baseOption, newParsedOption.baseOption);
                // For simplicity, timeline options and media options do not support merge,
                // that is, if you `setOption` twice and both has timeline options, the latter
                // timeline opitons will not be merged to the formers, but just substitude them.
                if (newParsedOption.timelineOptions.length) {
                    oldOptionBackup.timelineOptions = newParsedOption.timelineOptions;
                }
                if (newParsedOption.mediaList.length) {
                    oldOptionBackup.mediaList = newParsedOption.mediaList;
                }
                if (newParsedOption.mediaDefault) {
                    oldOptionBackup.mediaDefault = newParsedOption.mediaDefault;
                }
            } else {
                this._optionBackup = newParsedOption;
            }
        },
        mountOption: function (isRecreate) {
            var optionBackup = this._optionBackup;
            // TODO
            // 如果没有reset功能则不clone。
            this._timelineOptions = map(optionBackup.timelineOptions, clone);
            this._mediaList = map(optionBackup.mediaList, clone);
            this._mediaDefault = clone(optionBackup.mediaDefault);
            this._currentMediaIndices = [];
            return clone(isRecreate ? optionBackup.baseOption : this._newBaseOption);
        },
        getTimelineOption: function (ecModel) {
            var option;
            var timelineOptions = this._timelineOptions;
            if (timelineOptions.length) {
                // getTimelineOption can only be called after ecModel inited,
                // so we can get currentIndex from timelineModel.
                var timelineModel = ecModel.getComponent('timeline');
                if (timelineModel) {
                    option = clone(timelineOptions[timelineModel.getCurrentIndex()], true);
                }
            }
            return option;
        },
        getMediaOption: function (ecModel) {
            var ecWidth = this._api.getWidth();
            var ecHeight = this._api.getHeight();
            var mediaList = this._mediaList;
            var mediaDefault = this._mediaDefault;
            var indices = [];
            var result = [];
            // No media defined.
            if (!mediaList.length && !mediaDefault) {
                return result;
            }
            // Multi media may be applied, the latter defined media has higher priority.
            for (var i = 0, len = mediaList.length; i < len; i++) {
                if (applyMediaQuery(mediaList[i].query, ecWidth, ecHeight)) {
                    indices.push(i);
                }
            }
            // FIXME
            // 是否mediaDefault应该强制用户设置，否则可能修改不能回归。
            if (!indices.length && mediaDefault) {
                indices = [-1];
            }
            if (indices.length && !indicesEquals(indices, this._currentMediaIndices)) {
                result = map(indices, function (index) {
                    return clone(index === -1 ? mediaDefault.option : mediaList[index].option);
                });
            }
            // Otherwise return nothing.
            this._currentMediaIndices = indices;
            return result;
        }
    };
    function parseRawOption(rawOption, optionPreprocessorFuncs, isNew) {
        var timelineOptions = [];
        var mediaList = [];
        var mediaDefault;
        var baseOption;
        // Compatible with ec2.
        var timelineOpt = rawOption.timeline;
        if (rawOption.baseOption) {
            baseOption = rawOption.baseOption;
        }
        // For timeline
        if (timelineOpt || rawOption.options) {
            baseOption = baseOption || {};
            timelineOptions = (rawOption.options || []).slice();
        }
        // For media query
        if (rawOption.media) {
            baseOption = baseOption || {};
            var media = rawOption.media;
            each(media, function (singleMedia) {
                if (singleMedia && singleMedia.option) {
                    if (singleMedia.query) {
                        mediaList.push(singleMedia);
                    } else if (!mediaDefault) {
                        // Use the first media default.
                        mediaDefault = singleMedia;
                    }
                }
            });
        }
        // For normal option
        if (!baseOption) {
            baseOption = rawOption;
        }
        // Set timelineOpt to baseOption in ec3,
        // which is convenient for merge option.
        if (!baseOption.timeline) {
            baseOption.timeline = timelineOpt;
        }
        // Preprocess.
        each([baseOption].concat(timelineOptions).concat(zrUtil.map(mediaList, function (media) {
            return media.option;
        })), function (option) {
            each(optionPreprocessorFuncs, function (preProcess) {
                preProcess(option, isNew);
            });
        });
        return {
            baseOption: baseOption,
            timelineOptions: timelineOptions,
            mediaDefault: mediaDefault,
            mediaList: mediaList
        };
    }
    /**
     * @see <http://www.w3.org/TR/css3-mediaqueries/#media1>
     * Support: width, height, aspectRatio
     * Can use max or min as prefix.
     */
    function applyMediaQuery(query, ecWidth, ecHeight) {
        var realMap = {
                width: ecWidth,
                height: ecHeight,
                aspectratio: ecWidth / ecHeight
            };
        var applicatable = true;
        zrUtil.each(query, function (value, attr) {
            var matched = attr.match(QUERY_REG);
            if (!matched || !matched[1] || !matched[2]) {
                return;
            }
            var operator = matched[1];
            var realAttr = matched[2].toLowerCase();
            if (!compare(realMap[realAttr], value, operator)) {
                applicatable = false;
            }
        });
        return applicatable;
    }
    function compare(real, expect, operator) {
        if (operator === 'min') {
            return real >= expect;
        } else if (operator === 'max') {
            return real <= expect;
        } else {
            // Equals
            return real === expect;
        }
    }
    function indicesEquals(indices1, indices2) {
        // indices is always order by asc and has only finite number.
        return indices1.join(',') === indices2.join(',');
    }
    /**
     * Consider case:
     * `chart.setOption(opt1);`
     * Then user do some interaction like dataZoom, dataView changing.
     * `chart.setOption(opt2);`
     * Then user press 'reset button' in toolbox.
     *
     * After doing that all of the interaction effects should be reset, the
     * chart should be the same as the result of invoke
     * `chart.setOption(opt1); chart.setOption(opt2);`.
     *
     * Although it is not able ensure that
     * `chart.setOption(opt1); chart.setOption(opt2);` is equivalents to
     * `chart.setOption(merge(opt1, opt2));` exactly,
     * this might be the only simple way to implement that feature.
     *
     * MEMO: We've considered some other approaches:
     * 1. Each model handle its self restoration but not uniform treatment.
     *     (Too complex in logic and error-prone)
     * 2. Use a shadow ecModel. (Performace expensive)
     */
    function mergeOption(oldOption, newOption) {
        newOption = newOption || {};
        each(newOption, function (newCptOpt, mainType) {
            if (newCptOpt == null) {
                return;
            }
            var oldCptOpt = oldOption[mainType];
            if (!ComponentModel.hasClass(mainType)) {
                oldOption[mainType] = merge(oldCptOpt, newCptOpt, true);
            } else {
                newCptOpt = modelUtil.normalizeToArray(newCptOpt);
                oldCptOpt = modelUtil.normalizeToArray(oldCptOpt);
                var mapResult = modelUtil.mappingToExists(oldCptOpt, newCptOpt);
                oldOption[mainType] = map(mapResult, function (item) {
                    return item.option && item.exist ? merge(item.exist, item.option, true) : item.exist || item.option;
                });
            }
        });
    }
    return OptionManager;
});
define('echarts/model/Component', ['require', './Model', 'zrender/core/util', '../util/component', '../util/clazz', '../util/layout', './mixin/boxLayout'], function (require) {
    var Model = require('./Model');
    var zrUtil = require('zrender/core/util');
    var arrayPush = Array.prototype.push;
    var componentUtil = require('../util/component');
    var clazzUtil = require('../util/clazz');
    var layout = require('../util/layout');
    /**
     * @alias module:echarts/model/Component
     * @constructor
     * @param {Object} option
     * @param {module:echarts/model/Model} parentModel
     * @param {module:echarts/model/Model} ecModel
     */
    var ComponentModel = Model.extend({
            type: 'component',
            id: '',
            name: '',
            mainType: '',
            subType: '',
            componentIndex: 0,
            defaultOption: null,
            ecModel: null,
            dependentModels: [],
            uid: null,
            layoutMode: null,
            $constructor: function (option, parentModel, ecModel, extraOpt) {
                Model.call(this, option, parentModel, ecModel, extraOpt);
                this.uid = componentUtil.getUID('componentModel');
            },
            init: function (option, parentModel, ecModel, extraOpt) {
                this.mergeDefaultAndTheme(option, ecModel);
            },
            mergeDefaultAndTheme: function (option, ecModel) {
                var layoutMode = this.layoutMode;
                var inputPositionParams = layoutMode ? layout.getLayoutParams(option) : {};
                var themeModel = ecModel.getTheme();
                zrUtil.merge(option, themeModel.get(this.mainType));
                zrUtil.merge(option, this.getDefaultOption());
                if (layoutMode) {
                    layout.mergeLayoutParam(option, inputPositionParams, layoutMode);
                }
            },
            mergeOption: function (option, extraOpt) {
                zrUtil.merge(this.option, option, true);
                var layoutMode = this.layoutMode;
                if (layoutMode) {
                    layout.mergeLayoutParam(this.option, option, layoutMode);
                }
            },
            optionUpdated: function (newCptOption, isInit) {
            },
            getDefaultOption: function () {
                if (!this.hasOwnProperty('__defaultOption')) {
                    var optList = [];
                    var Class = this.constructor;
                    while (Class) {
                        var opt = Class.prototype.defaultOption;
                        opt && optList.push(opt);
                        Class = Class.superClass;
                    }
                    var defaultOption = {};
                    for (var i = optList.length - 1; i >= 0; i--) {
                        defaultOption = zrUtil.merge(defaultOption, optList[i], true);
                    }
                    this.__defaultOption = defaultOption;
                }
                return this.__defaultOption;
            },
            getReferringComponents: function (mainType) {
                return this.ecModel.queryComponents({
                    mainType: mainType,
                    index: this.get(mainType + 'Index', true),
                    id: this.get(mainType + 'Id', true)
                });
            }
        });
    // Reset ComponentModel.extend, add preConstruct.
    // clazzUtil.enableClassExtend(
    //     ComponentModel,
    //     function (option, parentModel, ecModel, extraOpt) {
    //         // Set dependentModels, componentIndex, name, id, mainType, subType.
    //         zrUtil.extend(this, extraOpt);
    //         this.uid = componentUtil.getUID('componentModel');
    //         // this.setReadOnly([
    //         //     'type', 'id', 'uid', 'name', 'mainType', 'subType',
    //         //     'dependentModels', 'componentIndex'
    //         // ]);
    //     }
    // );
    // Add capability of registerClass, getClass, hasClass, registerSubTypeDefaulter and so on.
    clazzUtil.enableClassManagement(ComponentModel, { registerWhenExtend: true });
    componentUtil.enableSubTypeDefaulter(ComponentModel);
    // Add capability of ComponentModel.topologicalTravel.
    componentUtil.enableTopologicalTravel(ComponentModel, getDependencies);
    function getDependencies(componentType) {
        var deps = [];
        zrUtil.each(ComponentModel.getClassesByMainType(componentType), function (Clazz) {
            arrayPush.apply(deps, Clazz.prototype.dependencies || []);
        });
        // Ensure main type
        return zrUtil.map(deps, function (type) {
            return clazzUtil.parseClassType(type).main;
        });
    }
    zrUtil.mixin(ComponentModel, require('./mixin/boxLayout'));
    return ComponentModel;
});
define('echarts/model/Series', ['require', 'zrender/core/util', '../util/format', '../util/model', './Component', './mixin/colorPalette', 'zrender/core/env', '../util/layout'], function (require) {
    'use strict';
    var zrUtil = require('zrender/core/util');
    var formatUtil = require('../util/format');
    var modelUtil = require('../util/model');
    var ComponentModel = require('./Component');
    var colorPaletteMixin = require('./mixin/colorPalette');
    var env = require('zrender/core/env');
    var layout = require('../util/layout');
    var encodeHTML = formatUtil.encodeHTML;
    var addCommas = formatUtil.addCommas;
    var SeriesModel = ComponentModel.extend({
            type: 'series.__base__',
            seriesIndex: 0,
            coordinateSystem: null,
            defaultOption: null,
            legendDataProvider: null,
            visualColorAccessPath: 'itemStyle.normal.color',
            layoutMode: null,
            init: function (option, parentModel, ecModel, extraOpt) {
                /**
             * @type {number}
             * @readOnly
             */
                this.seriesIndex = this.componentIndex;
                this.mergeDefaultAndTheme(option, ecModel);
                /**
             * @type {module:echarts/data/List|module:echarts/data/Tree|module:echarts/data/Graph}
             * @private
             */
                this._dataBeforeProcessed = this.getInitialData(option, ecModel);
                // If we reverse the order (make this._data firstly, and then make
                // this._dataBeforeProcessed by cloneShallow), cloneShallow will
                // cause this._data.graph.data !== this._data when using
                // module:echarts/data/Graph or module:echarts/data/Tree.
                // See module:echarts/data/helper/linkList
                this._data = this._dataBeforeProcessed.cloneShallow();
            },
            mergeDefaultAndTheme: function (option, ecModel) {
                var layoutMode = this.layoutMode;
                var inputPositionParams = layoutMode ? layout.getLayoutParams(option) : {};
                zrUtil.merge(option, ecModel.getTheme().get(this.subType));
                zrUtil.merge(option, this.getDefaultOption());
                // Default label emphasis `position` and `show`
                // FIXME Set label in mergeOption
                modelUtil.defaultEmphasis(option.label, modelUtil.LABEL_OPTIONS);
                this.fillDataTextStyle(option.data);
                if (layoutMode) {
                    layout.mergeLayoutParam(option, inputPositionParams, layoutMode);
                }
            },
            mergeOption: function (newSeriesOption, ecModel) {
                newSeriesOption = zrUtil.merge(this.option, newSeriesOption, true);
                this.fillDataTextStyle(newSeriesOption.data);
                var layoutMode = this.layoutMode;
                if (layoutMode) {
                    layout.mergeLayoutParam(this.option, newSeriesOption, layoutMode);
                }
                var data = this.getInitialData(newSeriesOption, ecModel);
                // TODO Merge data?
                if (data) {
                    this._data = data;
                    this._dataBeforeProcessed = data.cloneShallow();
                }
            },
            fillDataTextStyle: function (data) {
                // Default data label emphasis `position` and `show`
                // FIXME Tree structure data ?
                // FIXME Performance ?
                if (data) {
                    for (var i = 0; i < data.length; i++) {
                        if (data[i] && data[i].label) {
                            modelUtil.defaultEmphasis(data[i].label, modelUtil.LABEL_OPTIONS);
                        }
                    }
                }
            },
            getInitialData: function () {
            },
            getData: function (dataType) {
                return dataType == null ? this._data : this._data.getLinkedData(dataType);
            },
            setData: function (data) {
                this._data = data;
            },
            getRawData: function () {
                return this._dataBeforeProcessed;
            },
            coordDimToDataDim: function (coordDim) {
                return [coordDim];
            },
            dataDimToCoordDim: function (dataDim) {
                return dataDim;
            },
            getBaseAxis: function () {
                var coordSys = this.coordinateSystem;
                return coordSys && coordSys.getBaseAxis && coordSys.getBaseAxis();
            },
            formatTooltip: function (dataIndex, multipleSeries, dataType) {
                function formatArrayValue(value) {
                    var result = [];
                    zrUtil.each(value, function (val, idx) {
                        var dimInfo = data.getDimensionInfo(idx);
                        var dimType = dimInfo && dimInfo.type;
                        var valStr;
                        if (dimType === 'ordinal') {
                            valStr = val + '';
                        } else if (dimType === 'time') {
                            valStr = multipleSeries ? '' : formatUtil.formatTime('yyyy/MM/dd hh:mm:ss', val);
                        } else {
                            valStr = addCommas(val);
                        }
                        valStr && result.push(valStr);
                    });
                    return result.join(', ');
                }
                var data = this._data;
                var value = this.getRawValue(dataIndex);
                var formattedValue = zrUtil.isArray(value) ? formatArrayValue(value) : addCommas(value);
                var name = data.getName(dataIndex);
                var color = data.getItemVisual(dataIndex, 'color');
                if (zrUtil.isObject(color) && color.colorStops) {
                    color = (color.colorStops[0] || {}).color;
                }
                color = color || 'transparent';
                var colorEl = '<span style="display:inline-block;margin-right:5px;' + 'border-radius:10px;width:9px;height:9px;background-color:' + color + '"></span>';
                var seriesName = this.name;
                // FIXME
                if (seriesName === ' -') {
                    // Not show '-'
                    seriesName = '';
                }
                return !multipleSeries ? (seriesName && encodeHTML(seriesName) + '<br />') + colorEl + (name ? encodeHTML(name) + ' : ' + formattedValue : formattedValue) : colorEl + encodeHTML(this.name) + ' : ' + formattedValue;
            },
            ifEnableAnimation: function () {
                if (env.node) {
                    return false;
                }
                var animationEnabled = this.getShallow('animation');
                if (animationEnabled) {
                    if (this.getData().count() > this.getShallow('animationThreshold')) {
                        animationEnabled = false;
                    }
                }
                return animationEnabled;
            },
            restoreData: function () {
                this._data = this._dataBeforeProcessed.cloneShallow();
            },
            getColorFromPalette: function (name, scope) {
                var ecModel = this.ecModel;
                // PENDING
                var color = colorPaletteMixin.getColorFromPalette.call(this, name, scope);
                if (!color) {
                    color = ecModel.getColorFromPalette(name, scope);
                }
                return color;
            },
            getAxisTooltipDataIndex: null,
            getTooltipPosition: null
        });
    zrUtil.mixin(SeriesModel, modelUtil.dataFormatMixin);
    zrUtil.mixin(SeriesModel, colorPaletteMixin);
    return SeriesModel;
});
define('echarts/view/Component', ['require', 'zrender/container/Group', '../util/component', '../util/clazz'], function (require) {
    var Group = require('zrender/container/Group');
    var componentUtil = require('../util/component');
    var clazzUtil = require('../util/clazz');
    var Component = function () {
        /**
         * @type {module:zrender/container/Group}
         * @readOnly
         */
        this.group = new Group();
        /**
         * @type {string}
         * @readOnly
         */
        this.uid = componentUtil.getUID('viewComponent');
    };
    Component.prototype = {
        constructor: Component,
        init: function (ecModel, api) {
        },
        render: function (componentModel, ecModel, api, payload) {
        },
        dispose: function () {
        }
    };
    var componentProto = Component.prototype;
    componentProto.updateView = componentProto.updateLayout = componentProto.updateVisual = function (seriesModel, ecModel, api, payload) {
    };
    // Enable Component.extend.
    clazzUtil.enableClassExtend(Component);
    // Enable capability of registerClass, getClass, hasClass, registerSubTypeDefaulter and so on.
    clazzUtil.enableClassManagement(Component, { registerWhenExtend: true });
    return Component;
});
define('echarts/view/Chart', ['require', 'zrender/container/Group', '../util/component', '../util/clazz', '../util/model', 'zrender/core/util'], function (require) {
    var Group = require('zrender/container/Group');
    var componentUtil = require('../util/component');
    var clazzUtil = require('../util/clazz');
    var modelUtil = require('../util/model');
    var zrUtil = require('zrender/core/util');
    function Chart() {
        /**
         * @type {module:zrender/container/Group}
         * @readOnly
         */
        this.group = new Group();
        /**
         * @type {string}
         * @readOnly
         */
        this.uid = componentUtil.getUID('viewChart');
    }
    Chart.prototype = {
        type: 'chart',
        init: function (ecModel, api) {
        },
        render: function (seriesModel, ecModel, api, payload) {
        },
        highlight: function (seriesModel, ecModel, api, payload) {
            toggleHighlight(seriesModel.getData(), payload, 'emphasis');
        },
        downplay: function (seriesModel, ecModel, api, payload) {
            toggleHighlight(seriesModel.getData(), payload, 'normal');
        },
        remove: function (ecModel, api) {
            this.group.removeAll();
        },
        dispose: function () {
        }    /**
         * The view contains the given point.
         * @interface
         * @param {Array.<number>} point
         * @return {boolean}
         */
             // containPoint: function () {}
    };
    var chartProto = Chart.prototype;
    chartProto.updateView = chartProto.updateLayout = chartProto.updateVisual = function (seriesModel, ecModel, api, payload) {
        this.render(seriesModel, ecModel, api, payload);
    };
    /**
     * Set state of single element
     * @param  {module:zrender/Element} el
     * @param  {string} state
     */
    function elSetState(el, state) {
        if (el) {
            el.trigger(state);
            if (el.type === 'group') {
                for (var i = 0; i < el.childCount(); i++) {
                    elSetState(el.childAt(i), state);
                }
            }
        }
    }
    /**
     * @param  {module:echarts/data/List} data
     * @param  {Object} payload
     * @param  {string} state 'normal'|'emphasis'
     * @inner
     */
    function toggleHighlight(data, payload, state) {
        var dataIndex = modelUtil.queryDataIndex(data, payload);
        if (dataIndex != null) {
            zrUtil.each(modelUtil.normalizeToArray(dataIndex), function (dataIdx) {
                elSetState(data.getItemGraphicEl(dataIdx), state);
            });
        } else {
            data.eachItemGraphicEl(function (el) {
                elSetState(el, state);
            });
        }
    }
    // Enable Chart.extend.
    clazzUtil.enableClassExtend(Chart, ['dispose']);
    // Add capability of registerClass, getClass, hasClass, registerSubTypeDefaulter and so on.
    clazzUtil.enableClassManagement(Chart, { registerWhenExtend: true });
    return Chart;
});
define('echarts/util/graphic', ['require', 'zrender/core/util', 'zrender/tool/path', 'zrender/graphic/Path', 'zrender/tool/color', 'zrender/core/matrix', 'zrender/core/vector', 'zrender/container/Group', 'zrender/graphic/Image', 'zrender/graphic/Text', 'zrender/graphic/shape/Circle', 'zrender/graphic/shape/Sector', 'zrender/graphic/shape/Ring', 'zrender/graphic/shape/Polygon', 'zrender/graphic/shape/Polyline', 'zrender/graphic/shape/Rect', 'zrender/graphic/shape/Line', 'zrender/graphic/shape/BezierCurve', 'zrender/graphic/shape/Arc', 'zrender/graphic/CompoundPath', 'zrender/graphic/LinearGradient', 'zrender/graphic/RadialGradient', 'zrender/core/BoundingRect'], function (require) {
    'use strict';
    var zrUtil = require('zrender/core/util');
    var pathTool = require('zrender/tool/path');
    var round = Math.round;
    var Path = require('zrender/graphic/Path');
    var colorTool = require('zrender/tool/color');
    var matrix = require('zrender/core/matrix');
    var vector = require('zrender/core/vector');
    var graphic = {};
    graphic.Group = require('zrender/container/Group');
    graphic.Image = require('zrender/graphic/Image');
    graphic.Text = require('zrender/graphic/Text');
    graphic.Circle = require('zrender/graphic/shape/Circle');
    graphic.Sector = require('zrender/graphic/shape/Sector');
    graphic.Ring = require('zrender/graphic/shape/Ring');
    graphic.Polygon = require('zrender/graphic/shape/Polygon');
    graphic.Polyline = require('zrender/graphic/shape/Polyline');
    graphic.Rect = require('zrender/graphic/shape/Rect');
    graphic.Line = require('zrender/graphic/shape/Line');
    graphic.BezierCurve = require('zrender/graphic/shape/BezierCurve');
    graphic.Arc = require('zrender/graphic/shape/Arc');
    graphic.CompoundPath = require('zrender/graphic/CompoundPath');
    graphic.LinearGradient = require('zrender/graphic/LinearGradient');
    graphic.RadialGradient = require('zrender/graphic/RadialGradient');
    graphic.BoundingRect = require('zrender/core/BoundingRect');
    /**
     * Extend shape with parameters
     */
    graphic.extendShape = function (opts) {
        return Path.extend(opts);
    };
    /**
     * Extend path
     */
    graphic.extendPath = function (pathData, opts) {
        return pathTool.extendFromString(pathData, opts);
    };
    /**
     * Create a path element from path data string
     * @param {string} pathData
     * @param {Object} opts
     * @param {module:zrender/core/BoundingRect} rect
     * @param {string} [layout=cover] 'center' or 'cover'
     */
    graphic.makePath = function (pathData, opts, rect, layout) {
        var path = pathTool.createFromString(pathData, opts);
        var boundingRect = path.getBoundingRect();
        if (rect) {
            var aspect = boundingRect.width / boundingRect.height;
            if (layout === 'center') {
                // Set rect to center, keep width / height ratio.
                var width = rect.height * aspect;
                var height;
                if (width <= rect.width) {
                    height = rect.height;
                } else {
                    width = rect.width;
                    height = width / aspect;
                }
                var cx = rect.x + rect.width / 2;
                var cy = rect.y + rect.height / 2;
                rect.x = cx - width / 2;
                rect.y = cy - height / 2;
                rect.width = width;
                rect.height = height;
            }
            this.resizePath(path, rect);
        }
        return path;
    };
    graphic.mergePath = pathTool.mergePath, graphic.resizePath = function (path, rect) {
        if (!path.applyTransform) {
            return;
        }
        var pathRect = path.getBoundingRect();
        var m = pathRect.calculateTransform(rect);
        path.applyTransform(m);
    };
    /**
     * Sub pixel optimize line for canvas
     *
     * @param {Object} param
     * @param {Object} [param.shape]
     * @param {number} [param.shape.x1]
     * @param {number} [param.shape.y1]
     * @param {number} [param.shape.x2]
     * @param {number} [param.shape.y2]
     * @param {Object} [param.style]
     * @param {number} [param.style.lineWidth]
     * @return {Object} Modified param
     */
    graphic.subPixelOptimizeLine = function (param) {
        var subPixelOptimize = graphic.subPixelOptimize;
        var shape = param.shape;
        var lineWidth = param.style.lineWidth;
        if (round(shape.x1 * 2) === round(shape.x2 * 2)) {
            shape.x1 = shape.x2 = subPixelOptimize(shape.x1, lineWidth, true);
        }
        if (round(shape.y1 * 2) === round(shape.y2 * 2)) {
            shape.y1 = shape.y2 = subPixelOptimize(shape.y1, lineWidth, true);
        }
        return param;
    };
    /**
     * Sub pixel optimize rect for canvas
     *
     * @param {Object} param
     * @param {Object} [param.shape]
     * @param {number} [param.shape.x]
     * @param {number} [param.shape.y]
     * @param {number} [param.shape.width]
     * @param {number} [param.shape.height]
     * @param {Object} [param.style]
     * @param {number} [param.style.lineWidth]
     * @return {Object} Modified param
     */
    graphic.subPixelOptimizeRect = function (param) {
        var subPixelOptimize = graphic.subPixelOptimize;
        var shape = param.shape;
        var lineWidth = param.style.lineWidth;
        var originX = shape.x;
        var originY = shape.y;
        var originWidth = shape.width;
        var originHeight = shape.height;
        shape.x = subPixelOptimize(shape.x, lineWidth, true);
        shape.y = subPixelOptimize(shape.y, lineWidth, true);
        shape.width = Math.max(subPixelOptimize(originX + originWidth, lineWidth, false) - shape.x, originWidth === 0 ? 0 : 1);
        shape.height = Math.max(subPixelOptimize(originY + originHeight, lineWidth, false) - shape.y, originHeight === 0 ? 0 : 1);
        return param;
    };
    /**
     * Sub pixel optimize for canvas
     *
     * @param {number} position Coordinate, such as x, y
     * @param {number} lineWidth Should be nonnegative integer.
     * @param {boolean=} positiveOrNegative Default false (negative).
     * @return {number} Optimized position.
     */
    graphic.subPixelOptimize = function (position, lineWidth, positiveOrNegative) {
        // Assure that (position + lineWidth / 2) is near integer edge,
        // otherwise line will be fuzzy in canvas.
        var doubledPosition = round(position * 2);
        return (doubledPosition + round(lineWidth)) % 2 === 0 ? doubledPosition / 2 : (doubledPosition + (positiveOrNegative ? 1 : -1)) / 2;
    };
    function hasFillOrStroke(fillOrStroke) {
        return fillOrStroke != null && fillOrStroke != 'none';
    }
    function liftColor(color) {
        return typeof color === 'string' ? colorTool.lift(color, -0.1) : color;
    }
    /**
     * @private
     */
    function cacheElementStl(el) {
        if (el.__hoverStlDirty) {
            var stroke = el.style.stroke;
            var fill = el.style.fill;
            // Create hoverStyle on mouseover
            var hoverStyle = el.__hoverStl;
            hoverStyle.fill = hoverStyle.fill || (hasFillOrStroke(fill) ? liftColor(fill) : null);
            hoverStyle.stroke = hoverStyle.stroke || (hasFillOrStroke(stroke) ? liftColor(stroke) : null);
            var normalStyle = {};
            for (var name in hoverStyle) {
                if (hoverStyle.hasOwnProperty(name)) {
                    normalStyle[name] = el.style[name];
                }
            }
            el.__normalStl = normalStyle;
            el.__hoverStlDirty = false;
        }
    }
    /**
     * @private
     */
    function doSingleEnterHover(el) {
        if (el.__isHover) {
            return;
        }
        cacheElementStl(el);
        if (el.useHoverLayer) {
            el.__zr && el.__zr.addHover(el, el.__hoverStl);
        } else {
            el.setStyle(el.__hoverStl);
            el.z2 += 1;
        }
        el.__isHover = true;
    }
    /**
     * @inner
     */
    function doSingleLeaveHover(el) {
        if (!el.__isHover) {
            return;
        }
        var normalStl = el.__normalStl;
        if (el.useHoverLayer) {
            el.__zr && el.__zr.removeHover(el);
        } else {
            normalStl && el.setStyle(normalStl);
            el.z2 -= 1;
        }
        el.__isHover = false;
    }
    /**
     * @inner
     */
    function doEnterHover(el) {
        el.type === 'group' ? el.traverse(function (child) {
            if (child.type !== 'group') {
                doSingleEnterHover(child);
            }
        }) : doSingleEnterHover(el);
    }
    function doLeaveHover(el) {
        el.type === 'group' ? el.traverse(function (child) {
            if (child.type !== 'group') {
                doSingleLeaveHover(child);
            }
        }) : doSingleLeaveHover(el);
    }
    /**
     * @inner
     */
    function setElementHoverStl(el, hoverStl) {
        // If element has sepcified hoverStyle, then use it instead of given hoverStyle
        // Often used when item group has a label element and it's hoverStyle is different
        el.__hoverStl = el.hoverStyle || hoverStl || {};
        el.__hoverStlDirty = true;
        if (el.__isHover) {
            cacheElementStl(el);
        }
    }
    /**
     * @inner
     */
    function onElementMouseOver(e) {
        if (this.__hoverSilentOnTouch && e.zrByTouch) {
            return;
        }
        // Only if element is not in emphasis status
        !this.__isEmphasis && doEnterHover(this);
    }
    /**
     * @inner
     */
    function onElementMouseOut(e) {
        if (this.__hoverSilentOnTouch && e.zrByTouch) {
            return;
        }
        // Only if element is not in emphasis status
        !this.__isEmphasis && doLeaveHover(this);
    }
    /**
     * @inner
     */
    function enterEmphasis() {
        this.__isEmphasis = true;
        doEnterHover(this);
    }
    /**
     * @inner
     */
    function leaveEmphasis() {
        this.__isEmphasis = false;
        doLeaveHover(this);
    }
    /**
     * Set hover style of element
     * @param {module:zrender/Element} el
     * @param {Object} [hoverStyle]
     * @param {Object} [opt]
     * @param {boolean} [opt.hoverSilentOnTouch=false]
     *        In touch device, mouseover event will be trigger on touchstart event
     *        (see module:zrender/dom/HandlerProxy). By this mechanism, we can
     *        conviniently use hoverStyle when tap on touch screen without additional
     *        code for compatibility.
     *        But if the chart/component has select feature, which usually also use
     *        hoverStyle, there might be conflict between 'select-highlight' and
     *        'hover-highlight' especially when roam is enabled (see geo for example).
     *        In this case, hoverSilentOnTouch should be used to disable hover-highlight
     *        on touch device.
     */
    graphic.setHoverStyle = function (el, hoverStyle, opt) {
        el.__hoverSilentOnTouch = opt && opt.hoverSilentOnTouch;
        el.type === 'group' ? el.traverse(function (child) {
            if (child.type !== 'group') {
                setElementHoverStl(child, hoverStyle);
            }
        }) : setElementHoverStl(el, hoverStyle);
        // Duplicated function will be auto-ignored, see Eventful.js.
        el.on('mouseover', onElementMouseOver).on('mouseout', onElementMouseOut);
        // Emphasis, normal can be triggered manually
        el.on('emphasis', enterEmphasis).on('normal', leaveEmphasis);
    };
    /**
     * Set text option in the style
     * @param {Object} textStyle
     * @param {module:echarts/model/Model} labelModel
     * @param {string} color
     */
    graphic.setText = function (textStyle, labelModel, color) {
        var labelPosition = labelModel.getShallow('position') || 'inside';
        var labelColor = labelPosition.indexOf('inside') >= 0 ? 'white' : color;
        var textStyleModel = labelModel.getModel('textStyle');
        zrUtil.extend(textStyle, {
            textDistance: labelModel.getShallow('distance') || 5,
            textFont: textStyleModel.getFont(),
            textPosition: labelPosition,
            textFill: textStyleModel.getTextColor() || labelColor
        });
    };
    function animateOrSetProps(isUpdate, el, props, animatableModel, dataIndex, cb) {
        if (typeof dataIndex === 'function') {
            cb = dataIndex;
            dataIndex = null;
        }
        var animationEnabled = animatableModel && (animatableModel.ifEnableAnimation ? animatableModel.ifEnableAnimation() : animatableModel.getShallow('animation'));
        if (animationEnabled) {
            var postfix = isUpdate ? 'Update' : '';
            var duration = animatableModel && animatableModel.getShallow('animationDuration' + postfix);
            var animationEasing = animatableModel && animatableModel.getShallow('animationEasing' + postfix);
            var animationDelay = animatableModel && animatableModel.getShallow('animationDelay' + postfix);
            if (typeof animationDelay === 'function') {
                animationDelay = animationDelay(dataIndex);
            }
            duration > 0 ? el.animateTo(props, duration, animationDelay || 0, animationEasing, cb) : (el.attr(props), cb && cb());
        } else {
            el.attr(props);
            cb && cb();
        }
    }
    /**
     * Update graphic element properties with or without animation according to the configuration in series
     * @param {module:zrender/Element} el
     * @param {Object} props
     * @param {module:echarts/model/Model} [animatableModel]
     * @param {number} [dataIndex]
     * @param {Function} [cb]
     * @example
     *     graphic.updateProps(el, {
     *         position: [100, 100]
     *     }, seriesModel, dataIndex, function () { console.log('Animation done!'); });
     *     // Or
     *     graphic.updateProps(el, {
     *         position: [100, 100]
     *     }, seriesModel, function () { console.log('Animation done!'); });
     */
    graphic.updateProps = function (el, props, animatableModel, dataIndex, cb) {
        animateOrSetProps(true, el, props, animatableModel, dataIndex, cb);
    };
    /**
     * Init graphic element properties with or without animation according to the configuration in series
     * @param {module:zrender/Element} el
     * @param {Object} props
     * @param {module:echarts/model/Model} [animatableModel]
     * @param {number} [dataIndex]
     * @param {Function} cb
     */
    graphic.initProps = function (el, props, animatableModel, dataIndex, cb) {
        animateOrSetProps(false, el, props, animatableModel, dataIndex, cb);
    };
    /**
     * Get transform matrix of target (param target),
     * in coordinate of its ancestor (param ancestor)
     *
     * @param {module:zrender/mixin/Transformable} target
     * @param {module:zrender/mixin/Transformable} [ancestor]
     */
    graphic.getTransform = function (target, ancestor) {
        var mat = matrix.identity([]);
        while (target && target !== ancestor) {
            matrix.mul(mat, target.getLocalTransform(), mat);
            target = target.parent;
        }
        return mat;
    };
    /**
     * Apply transform to an vertex.
     * @param {Array.<number>} vertex [x, y]
     * @param {Array.<number>} transform Transform matrix: like [1, 0, 0, 1, 0, 0]
     * @param {boolean=} invert Whether use invert matrix.
     * @return {Array.<number>} [x, y]
     */
    graphic.applyTransform = function (vertex, transform, invert) {
        if (invert) {
            transform = matrix.invert([], transform);
        }
        return vector.applyTransform([], vertex, transform);
    };
    /**
     * @param {string} direction 'left' 'right' 'top' 'bottom'
     * @param {Array.<number>} transform Transform matrix: like [1, 0, 0, 1, 0, 0]
     * @param {boolean=} invert Whether use invert matrix.
     * @return {string} Transformed direction. 'left' 'right' 'top' 'bottom'
     */
    graphic.transformDirection = function (direction, transform, invert) {
        // Pick a base, ensure that transform result will not be (0, 0).
        var hBase = transform[4] === 0 || transform[5] === 0 || transform[0] === 0 ? 1 : Math.abs(2 * transform[4] / transform[0]);
        var vBase = transform[4] === 0 || transform[5] === 0 || transform[2] === 0 ? 1 : Math.abs(2 * transform[4] / transform[2]);
        var vertex = [
                direction === 'left' ? -hBase : direction === 'right' ? hBase : 0,
                direction === 'top' ? -vBase : direction === 'bottom' ? vBase : 0
            ];
        vertex = graphic.applyTransform(vertex, transform, invert);
        return Math.abs(vertex[0]) > Math.abs(vertex[1]) ? vertex[0] > 0 ? 'right' : 'left' : vertex[1] > 0 ? 'bottom' : 'top';
    };
    /**
     * Apply group transition animation from g1 to g2
     */
    graphic.groupTransition = function (g1, g2, animatableModel, cb) {
        if (!g1 || !g2) {
            return;
        }
        function getElMap(g) {
            var elMap = {};
            g.traverse(function (el) {
                if (!el.isGroup && el.anid) {
                    elMap[el.anid] = el;
                }
            });
            return elMap;
        }
        function getAnimatableProps(el) {
            var obj = {
                    position: vector.clone(el.position),
                    rotation: el.rotation
                };
            if (el.shape) {
                obj.shape = zrUtil.extend({}, el.shape);
            }
            return obj;
        }
        var elMap1 = getElMap(g1);
        g2.traverse(function (el) {
            if (!el.isGroup && el.anid) {
                var oldEl = elMap1[el.anid];
                if (oldEl) {
                    var newProp = getAnimatableProps(el);
                    el.attr(getAnimatableProps(oldEl));
                    graphic.updateProps(el, newProp, animatableModel, el.dataIndex);
                }    // else {
                     //     if (el.previousProps) {
                     //         graphic.updateProps
                     //     }
                     // }
            }
        });
    };
    return graphic;
});
define('echarts/util/model', ['require', './format', './number', '../model/Model', 'zrender/core/util'], function (require) {
    var formatUtil = require('./format');
    var nubmerUtil = require('./number');
    var Model = require('../model/Model');
    var zrUtil = require('zrender/core/util');
    var each = zrUtil.each;
    var isObject = zrUtil.isObject;
    var modelUtil = {};
    /**
     * If value is not array, then translate it to array.
     * @param  {*} value
     * @return {Array} [value] or value
     */
    modelUtil.normalizeToArray = function (value) {
        return value instanceof Array ? value : value == null ? [] : [value];
    };
    /**
     * Sync default option between normal and emphasis like `position` and `show`
     * In case some one will write code like
     *     label: {
     *         normal: {
     *             show: false,
     *             position: 'outside',
     *             textStyle: {
     *                 fontSize: 18
     *             }
     *         },
     *         emphasis: {
     *             show: true
     *         }
     *     }
     * @param {Object} opt
     * @param {Array.<string>} subOpts
     */
    modelUtil.defaultEmphasis = function (opt, subOpts) {
        if (opt) {
            var emphasisOpt = opt.emphasis = opt.emphasis || {};
            var normalOpt = opt.normal = opt.normal || {};
            // Default emphasis option from normal
            each(subOpts, function (subOptName) {
                var val = zrUtil.retrieve(emphasisOpt[subOptName], normalOpt[subOptName]);
                if (val != null) {
                    emphasisOpt[subOptName] = val;
                }
            });
        }
    };
    modelUtil.LABEL_OPTIONS = [
        'position',
        'show',
        'textStyle',
        'distance',
        'formatter'
    ];
    /**
     * data could be [12, 2323, {value: 223}, [1221, 23], {value: [2, 23]}]
     * This helper method retieves value from data.
     * @param {string|number|Date|Array|Object} dataItem
     * @return {number|string|Date|Array.<number|string|Date>}
     */
    modelUtil.getDataItemValue = function (dataItem) {
        // Performance sensitive.
        return dataItem && (dataItem.value == null ? dataItem : dataItem.value);
    };
    /**
     * data could be [12, 2323, {value: 223}, [1221, 23], {value: [2, 23]}]
     * This helper method determine if dataItem has extra option besides value
     * @param {string|number|Date|Array|Object} dataItem
     */
    modelUtil.isDataItemOption = function (dataItem) {
        return isObject(dataItem) && !(dataItem instanceof Array);    // // markLine data can be array
                                                                      // && !(dataItem[0] && isObject(dataItem[0]) && !(dataItem[0] instanceof Array));
    };
    /**
     * This helper method convert value in data.
     * @param {string|number|Date} value
     * @param {Object|string} [dimInfo] If string (like 'x'), dimType defaults 'number'.
     */
    modelUtil.converDataValue = function (value, dimInfo) {
        // Performance sensitive.
        var dimType = dimInfo && dimInfo.type;
        if (dimType === 'ordinal') {
            return value;
        }
        if (dimType === 'time' && !isFinite(value) && value != null && value !== '-') {
            value = +nubmerUtil.parseDate(value);
        }
        // dimType defaults 'number'.
        // If dimType is not ordinal and value is null or undefined or NaN or '-',
        // parse to NaN.
        return value == null || value === '' ? NaN : +value;    // If string (like '-'), using '+' parse to NaN
    };
    /**
     * Create a model proxy to be used in tooltip for edge data, markLine data, markPoint data.
     * @param {module:echarts/data/List} data
     * @param {Object} opt
     * @param {string} [opt.seriesIndex]
     * @param {Object} [opt.name]
     * @param {Object} [opt.mainType]
     * @param {Object} [opt.subType]
     */
    modelUtil.createDataFormatModel = function (data, opt) {
        var model = new Model();
        zrUtil.mixin(model, modelUtil.dataFormatMixin);
        model.seriesIndex = opt.seriesIndex;
        model.name = opt.name || '';
        model.mainType = opt.mainType;
        model.subType = opt.subType;
        model.getData = function () {
            return data;
        };
        return model;
    };
    // PENDING A little ugly
    modelUtil.dataFormatMixin = {
        getDataParams: function (dataIndex, dataType) {
            var data = this.getData(dataType);
            var seriesIndex = this.seriesIndex;
            var seriesName = this.name;
            var rawValue = this.getRawValue(dataIndex, dataType);
            var rawDataIndex = data.getRawIndex(dataIndex);
            var name = data.getName(dataIndex, true);
            var itemOpt = data.getRawDataItem(dataIndex);
            return {
                componentType: this.mainType,
                componentSubType: this.subType,
                seriesType: this.mainType === 'series' ? this.subType : null,
                seriesIndex: seriesIndex,
                seriesName: seriesName,
                name: name,
                dataIndex: rawDataIndex,
                data: itemOpt,
                dataType: dataType,
                value: rawValue,
                color: data.getItemVisual(dataIndex, 'color'),
                $vars: [
                    'seriesName',
                    'name',
                    'value'
                ]
            };
        },
        getFormattedLabel: function (dataIndex, status, dataType, dimIndex) {
            status = status || 'normal';
            var data = this.getData(dataType);
            var itemModel = data.getItemModel(dataIndex);
            var params = this.getDataParams(dataIndex, dataType);
            if (dimIndex != null && params.value instanceof Array) {
                params.value = params.value[dimIndex];
            }
            var formatter = itemModel.get([
                    'label',
                    status,
                    'formatter'
                ]);
            if (typeof formatter === 'function') {
                params.status = status;
                return formatter(params);
            } else if (typeof formatter === 'string') {
                return formatUtil.formatTpl(formatter, params);
            }
        },
        getRawValue: function (idx, dataType) {
            var data = this.getData(dataType);
            var dataItem = data.getRawDataItem(idx);
            if (dataItem != null) {
                return isObject(dataItem) && !(dataItem instanceof Array) ? dataItem.value : dataItem;
            }
        },
        formatTooltip: zrUtil.noop
    };
    /**
     * Mapping to exists for merge.
     *
     * @public
     * @param {Array.<Object>|Array.<module:echarts/model/Component>} exists
     * @param {Object|Array.<Object>} newCptOptions
     * @return {Array.<Object>} Result, like [{exist: ..., option: ...}, {}],
     *                          index of which is the same as exists.
     */
    modelUtil.mappingToExists = function (exists, newCptOptions) {
        // Mapping by the order by original option (but not order of
        // new option) in merge mode. Because we should ensure
        // some specified index (like xAxisIndex) is consistent with
        // original option, which is easy to understand, espatially in
        // media query. And in most case, merge option is used to
        // update partial option but not be expected to change order.
        newCptOptions = (newCptOptions || []).slice();
        var result = zrUtil.map(exists || [], function (obj, index) {
                return { exist: obj };
            });
        // Mapping by id or name if specified.
        each(newCptOptions, function (cptOption, index) {
            if (!isObject(cptOption)) {
                return;
            }
            // id has highest priority.
            for (var i = 0; i < result.length; i++) {
                if (!result[i].option && cptOption.id != null && result[i].exist.id === cptOption.id + '') {
                    result[i].option = cptOption;
                    newCptOptions[index] = null;
                    return;
                }
            }
            for (var i = 0; i < result.length; i++) {
                var exist = result[i].exist;
                if (!result[i].option && (exist.id == null || cptOption.id == null) && cptOption.name != null && !modelUtil.isIdInner(cptOption) && !modelUtil.isIdInner(exist) && exist.name === cptOption.name + '') {
                    result[i].option = cptOption;
                    newCptOptions[index] = null;
                    return;
                }
            }
        });
        // Otherwise mapping by index.
        each(newCptOptions, function (cptOption, index) {
            if (!isObject(cptOption)) {
                return;
            }
            var i = 0;
            for (; i < result.length; i++) {
                var exist = result[i].exist;
                if (!result[i].option && !modelUtil.isIdInner(exist) && cptOption.id == null) {
                    result[i].option = cptOption;
                    break;
                }
            }
            if (i >= result.length) {
                result.push({ option: cptOption });
            }
        });
        return result;
    };
    /**
     * Make id and name for mapping result (result of mappingToExists)
     * into `keyInfo` field.
     *
     * @public
     * @param {Array.<Object>} Result, like [{exist: ..., option: ...}, {}],
     *                          which order is the same as exists.
     * @return {Array.<Object>} The input.
     */
    modelUtil.makeIdAndName = function (mapResult) {
        // We use this id to hash component models and view instances
        // in echarts. id can be specified by user, or auto generated.
        // The id generation rule ensures new view instance are able
        // to mapped to old instance when setOption are called in
        // no-merge mode. So we generate model id by name and plus
        // type in view id.
        // name can be duplicated among components, which is convenient
        // to specify multi components (like series) by one name.
        // Ensure that each id is distinct.
        var idMap = {};
        each(mapResult, function (item, index) {
            var existCpt = item.exist;
            existCpt && (idMap[existCpt.id] = item);
        });
        each(mapResult, function (item, index) {
            var opt = item.option;
            zrUtil.assert(!opt || opt.id == null || !idMap[opt.id] || idMap[opt.id] === item, 'id duplicates: ' + (opt && opt.id));
            opt && opt.id != null && (idMap[opt.id] = item);
            !item.keyInfo && (item.keyInfo = {});
        });
        // Make name and id.
        each(mapResult, function (item, index) {
            var existCpt = item.exist;
            var opt = item.option;
            var keyInfo = item.keyInfo;
            if (!isObject(opt)) {
                return;
            }
            // name can be overwitten. Consider case: axis.name = '20km'.
            // But id generated by name will not be changed, which affect
            // only in that case: setOption with 'not merge mode' and view
            // instance will be recreated, which can be accepted.
            keyInfo.name = opt.name != null ? opt.name + '' : existCpt ? existCpt.name : ' -';
            if (existCpt) {
                keyInfo.id = existCpt.id;
            } else if (opt.id != null) {
                keyInfo.id = opt.id + '';
            } else {
                // Consider this situatoin:
                //  optionA: [{name: 'a'}, {name: 'a'}, {..}]
                //  optionB [{..}, {name: 'a'}, {name: 'a'}]
                // Series with the same name between optionA and optionB
                // should be mapped.
                var idNum = 0;
                do {
                    keyInfo.id = ' ' + keyInfo.name + ' ' + idNum++;
                } while (idMap[keyInfo.id]);
            }
            idMap[keyInfo.id] = item;
        });
    };
    /**
     * @public
     * @param {Object} cptOption
     * @return {boolean}
     */
    modelUtil.isIdInner = function (cptOption) {
        return isObject(cptOption) && cptOption.id && (cptOption.id + '').indexOf(' _ec_ ') === 0;
    };
    /**
     * A helper for removing duplicate items between batchA and batchB,
     * and in themselves, and categorize by series.
     *
     * @param {Array.<Object>} batchA Like: [{seriesId: 2, dataIndex: [32, 4, 5]}, ...]
     * @param {Array.<Object>} batchB Like: [{seriesId: 2, dataIndex: [32, 4, 5]}, ...]
     * @return {Array.<Array.<Object>, Array.<Object>>} result: [resultBatchA, resultBatchB]
     */
    modelUtil.compressBatches = function (batchA, batchB) {
        var mapA = {};
        var mapB = {};
        makeMap(batchA || [], mapA);
        makeMap(batchB || [], mapB, mapA);
        return [
            mapToArray(mapA),
            mapToArray(mapB)
        ];
        function makeMap(sourceBatch, map, otherMap) {
            for (var i = 0, len = sourceBatch.length; i < len; i++) {
                var seriesId = sourceBatch[i].seriesId;
                var dataIndices = modelUtil.normalizeToArray(sourceBatch[i].dataIndex);
                var otherDataIndices = otherMap && otherMap[seriesId];
                for (var j = 0, lenj = dataIndices.length; j < lenj; j++) {
                    var dataIndex = dataIndices[j];
                    if (otherDataIndices && otherDataIndices[dataIndex]) {
                        otherDataIndices[dataIndex] = null;
                    } else {
                        (map[seriesId] || (map[seriesId] = {}))[dataIndex] = 1;
                    }
                }
            }
        }
        function mapToArray(map, isData) {
            var result = [];
            for (var i in map) {
                if (map.hasOwnProperty(i) && map[i] != null) {
                    if (isData) {
                        result.push(+i);
                    } else {
                        var dataIndices = mapToArray(map[i], true);
                        dataIndices.length && result.push({
                            seriesId: i,
                            dataIndex: dataIndices
                        });
                    }
                }
            }
            return result;
        }
    };
    /**
     * @param {module:echarts/data/List} data
     * @param {Object} payload Contains dataIndex (means rawIndex) / dataIndexInside / name
     *                         each of which can be Array or primary type.
     * @return {number|Array.<number>} dataIndex If not found, return undefined/null.
     */
    modelUtil.queryDataIndex = function (data, payload) {
        if (payload.dataIndexInside != null) {
            return payload.dataIndexInside;
        } else if (payload.dataIndex != null) {
            return zrUtil.isArray(payload.dataIndex) ? zrUtil.map(payload.dataIndex, function (value) {
                return data.indexOfRawIndex(value);
            }) : data.indexOfRawIndex(payload.dataIndex);
        } else if (payload.name != null) {
            return zrUtil.isArray(payload.name) ? zrUtil.map(payload.name, function (value) {
                return data.indexOfName(value);
            }) : data.indexOfName(payload.name);
        }
    };
    /**
     * @param {module:echarts/model/Global} ecModel
     * @param {string|Object} finder
     *        If string, e.g., 'geo', means {geoIndex: 0}.
     *        If Object, could contain some of these properties below:
     *        {
     *            seriesIndex, seriesId, seriesName,
     *            geoIndex, geoId, goeName,
     *            bmapIndex, bmapId, bmapName,
     *            xAxisIndex, xAxisId, xAxisName,
     *            yAxisIndex, yAxisId, yAxisName,
     *            gridIndex, gridId, gridName,
     *            ... (can be extended)
     *        }
     *        Each properties can be number|string|Array.<number>|Array.<string>
     *        For example, a finder could be
     *        {
     *            seriesIndex: 3,
     *            geoId: ['aa', 'cc'],
     *            gridName: ['xx', 'rr']
     *        }
     * @param {Object} [opt]
     * @param {string} [opt.defaultMainType]
     * @return {Object} result like:
     *        {
     *            seriesModels: [seriesModel1, seriesModel2],
     *            seriesModel: seriesModel1, // The first model
     *            geoModels: [geoModel1, geoModel2],
     *            geoModel: geoModel1, // The first model
     *            ...
     *        }
     */
    modelUtil.parseFinder = function (ecModel, finder, opt) {
        if (zrUtil.isString(finder)) {
            var obj = {};
            obj[finder + 'Index'] = 0;
            finder = obj;
        }
        var defaultMainType = opt && opt.defaultMainType;
        if (defaultMainType && !has(finder, defaultMainType + 'Index') && !has(finder, defaultMainType + 'Id') && !has(finder, defaultMainType + 'Name')) {
            finder[defaultMainType + 'Index'] = 0;
        }
        var result = {};
        each(finder, function (value, key) {
            var value = finder[key];
            // Exclude 'dataIndex' and other illgal keys.
            if (key === 'dataIndex' || key === 'dataIndexInside') {
                result[key] = value;
                return;
            }
            var parsedKey = key.match(/^(\w+)(Index|Id|Name)$/) || [];
            var mainType = parsedKey[1];
            var queryType = parsedKey[2];
            if (!mainType || !queryType) {
                return;
            }
            var queryParam = { mainType: mainType };
            queryParam[queryType.toLowerCase()] = value;
            var models = ecModel.queryComponents(queryParam);
            result[mainType + 'Models'] = models;
            result[mainType + 'Model'] = models[0];
        });
        return result;
    };
    function has(obj, prop) {
        return obj && obj.hasOwnProperty(prop);
    }
    return modelUtil;
});
define('echarts/util/throttle', [], function () {
    var lib = {};
    var ORIGIN_METHOD = ' __throttleOriginMethod';
    var RATE = ' __throttleRate';
    var THROTTLE_TYPE = ' __throttleType';
    /**
     * @public
     * @param {(Function)} fn
     * @param {number} [delay=0] Unit: ms.
     * @param {boolean} [debounce=false]
     *        true: If call interval less than `delay`, only the last call works.
     *        false: If call interval less than `delay, call works on fixed rate.
     * @return {(Function)} throttled fn.
     */
    lib.throttle = function (fn, delay, debounce) {
        var currCall;
        var lastCall = 0;
        var lastExec = 0;
        var timer = null;
        var diff;
        var scope;
        var args;
        delay = delay || 0;
        function exec() {
            lastExec = new Date().getTime();
            timer = null;
            fn.apply(scope, args || []);
        }
        var cb = function () {
            currCall = new Date().getTime();
            scope = this;
            args = arguments;
            diff = currCall - (debounce ? lastCall : lastExec) - delay;
            clearTimeout(timer);
            if (debounce) {
                timer = setTimeout(exec, delay);
            } else {
                if (diff >= 0) {
                    exec();
                } else {
                    timer = setTimeout(exec, -diff);
                }
            }
            lastCall = currCall;
        };
        /**
         * Clear throttle.
         * @public
         */
        cb.clear = function () {
            if (timer) {
                clearTimeout(timer);
                timer = null;
            }
        };
        return cb;
    };
    /**
     * Create throttle method or update throttle rate.
     *
     * @example
     * ComponentView.prototype.render = function () {
     *     ...
     *     throttle.createOrUpdate(
     *         this,
     *         '_dispatchAction',
     *         this.model.get('throttle'),
     *         'fixRate'
     *     );
     * };
     * ComponentView.prototype.remove = function () {
     *     throttle.clear(this, '_dispatchAction');
     * };
     * ComponentView.prototype.dispose = function () {
     *     throttle.clear(this, '_dispatchAction');
     * };
     *
     * @public
     * @param {Object} obj
     * @param {string} fnAttr
     * @param {number} [rate]
     * @param {string} [throttleType='fixRate'] 'fixRate' or 'debounce'
     * @return {Function} throttled function.
     */
    lib.createOrUpdate = function (obj, fnAttr, rate, throttleType) {
        var fn = obj[fnAttr];
        if (!fn) {
            return;
        }
        var originFn = fn[ORIGIN_METHOD] || fn;
        var lastThrottleType = fn[THROTTLE_TYPE];
        var lastRate = fn[RATE];
        if (lastRate !== rate || lastThrottleType !== throttleType) {
            if (rate == null || !throttleType) {
                return obj[fnAttr] = originFn;
            }
            fn = obj[fnAttr] = lib.throttle(originFn, rate, throttleType === 'debounce');
            fn[ORIGIN_METHOD] = originFn;
            fn[THROTTLE_TYPE] = throttleType;
            fn[RATE] = rate;
        }
        return fn;
    };
    /**
     * Clear throttle. Example see throttle.createOrUpdate.
     *
     * @public
     * @param {Object} obj
     * @param {string} fnAttr
     */
    lib.clear = function (obj, fnAttr) {
        var fn = obj[fnAttr];
        if (fn && fn[ORIGIN_METHOD]) {
            obj[fnAttr] = fn[ORIGIN_METHOD];
        }
    };
    return lib;
});
define('zrender/zrender', ['require', './core/guid', './core/env', './core/util', './Handler', './Storage', './animation/Animation', './dom/HandlerProxy', './Painter'], function (require) {
    var guid = require('./core/guid');
    var env = require('./core/env');
    var zrUtil = require('./core/util');
    var Handler = require('./Handler');
    var Storage = require('./Storage');
    var Animation = require('./animation/Animation');
    var HandlerProxy = require('./dom/HandlerProxy');
    var useVML = !env.canvasSupported;
    var painterCtors = { canvas: require('./Painter') };
    var instances = {};
    // ZRender实例map索引
    var zrender = {};
    /**
     * @type {string}
     */
    zrender.version = '3.2.2';
    /**
     * Initializing a zrender instance
     * @param {HTMLElement} dom
     * @param {Object} opts
     * @param {string} [opts.renderer='canvas'] 'canvas' or 'svg'
     * @param {number} [opts.devicePixelRatio]
     * @param {number|string} [opts.width] Can be 'auto' (the same as null/undefined)
     * @param {number|string} [opts.height] Can be 'auto' (the same as null/undefined)
     * @return {module:zrender/ZRender}
     */
    zrender.init = function (dom, opts) {
        var zr = new ZRender(guid(), dom, opts);
        instances[zr.id] = zr;
        return zr;
    };
    /**
     * Dispose zrender instance
     * @param {module:zrender/ZRender} zr
     */
    zrender.dispose = function (zr) {
        if (zr) {
            zr.dispose();
        } else {
            for (var key in instances) {
                if (instances.hasOwnProperty(key)) {
                    instances[key].dispose();
                }
            }
            instances = {};
        }
        return zrender;
    };
    /**
     * Get zrender instance by id
     * @param {string} id zrender instance id
     * @return {module:zrender/ZRender}
     */
    zrender.getInstance = function (id) {
        return instances[id];
    };
    zrender.registerPainter = function (name, Ctor) {
        painterCtors[name] = Ctor;
    };
    function delInstance(id) {
        delete instances[id];
    }
    /**
     * @module zrender/ZRender
     */
    /**
     * @constructor
     * @alias module:zrender/ZRender
     * @param {string} id
     * @param {HTMLDomElement} dom
     * @param {Object} opts
     * @param {string} [opts.renderer='canvas'] 'canvas' or 'svg'
     * @param {number} [opts.devicePixelRatio]
     * @param {number} [opts.width] Can be 'auto' (the same as null/undefined)
     * @param {number} [opts.height] Can be 'auto' (the same as null/undefined)
     */
    var ZRender = function (id, dom, opts) {
        opts = opts || {};
        /**
         * @type {HTMLDomElement}
         */
        this.dom = dom;
        /**
         * @type {string}
         */
        this.id = id;
        var self = this;
        var storage = new Storage();
        var rendererType = opts.renderer;
        if (useVML) {
            if (!painterCtors.vml) {
                throw new Error('You need to require \'zrender/vml/vml\' to support IE8');
            }
            rendererType = 'vml';
        } else if (!rendererType || !painterCtors[rendererType]) {
            rendererType = 'canvas';
        }
        var painter = new painterCtors[rendererType](dom, storage, opts);
        this.storage = storage;
        this.painter = painter;
        var handerProxy = !env.node ? new HandlerProxy(painter.getViewportRoot()) : null;
        this.handler = new Handler(storage, painter, handerProxy, painter.root);
        /**
         * @type {module:zrender/animation/Animation}
         */
        this.animation = new Animation({ stage: { update: zrUtil.bind(this.flush, this) } });
        this.animation.start();
        /**
         * @type {boolean}
         * @private
         */
        this._needsRefresh;
        // 修改 storage.delFromMap, 每次删除元素之前删除动画
        // FIXME 有点ugly
        var oldDelFromMap = storage.delFromMap;
        var oldAddToMap = storage.addToMap;
        storage.delFromMap = function (elId) {
            var el = storage.get(elId);
            oldDelFromMap.call(storage, elId);
            el && el.removeSelfFromZr(self);
        };
        storage.addToMap = function (el) {
            oldAddToMap.call(storage, el);
            el.addSelfToZr(self);
        };
    };
    ZRender.prototype = {
        constructor: ZRender,
        getId: function () {
            return this.id;
        },
        add: function (el) {
            this.storage.addRoot(el);
            this._needsRefresh = true;
        },
        remove: function (el) {
            this.storage.delRoot(el);
            this._needsRefresh = true;
        },
        configLayer: function (zLevel, config) {
            this.painter.configLayer(zLevel, config);
            this._needsRefresh = true;
        },
        refreshImmediately: function () {
            // Clear needsRefresh ahead to avoid something wrong happens in refresh
            // Or it will cause zrender refreshes again and again.
            this._needsRefresh = false;
            this.painter.refresh();
            /**
             * Avoid trigger zr.refresh in Element#beforeUpdate hook
             */
            this._needsRefresh = false;
        },
        refresh: function () {
            this._needsRefresh = true;
        },
        flush: function () {
            if (this._needsRefresh) {
                this.refreshImmediately();
            }
            if (this._needsRefreshHover) {
                this.refreshHoverImmediately();
            }
        },
        addHover: function (el, style) {
            if (this.painter.addHover) {
                this.painter.addHover(el, style);
                this.refreshHover();
            }
        },
        removeHover: function (el) {
            if (this.painter.removeHover) {
                this.painter.removeHover(el);
                this.refreshHover();
            }
        },
        clearHover: function () {
            if (this.painter.clearHover) {
                this.painter.clearHover();
                this.refreshHover();
            }
        },
        refreshHover: function () {
            this._needsRefreshHover = true;
        },
        refreshHoverImmediately: function () {
            this._needsRefreshHover = false;
            this.painter.refreshHover && this.painter.refreshHover();
        },
        resize: function (opts) {
            opts = opts || {};
            this.painter.resize(opts.width, opts.height);
            this.handler.resize();
        },
        clearAnimation: function () {
            this.animation.clear();
        },
        getWidth: function () {
            return this.painter.getWidth();
        },
        getHeight: function () {
            return this.painter.getHeight();
        },
        pathToImage: function (e, width, height) {
            var id = guid();
            return this.painter.pathToImage(id, e, width, height);
        },
        setCursorStyle: function (cursorStyle) {
            this.handler.setCursorStyle(cursorStyle);
        },
        on: function (eventName, eventHandler, context) {
            this.handler.on(eventName, eventHandler, context);
        },
        off: function (eventName, eventHandler) {
            this.handler.off(eventName, eventHandler);
        },
        trigger: function (eventName, event) {
            this.handler.trigger(eventName, event);
        },
        clear: function () {
            this.storage.delRoot();
            this.painter.clear();
        },
        dispose: function () {
            this.animation.stop();
            this.clear();
            this.storage.dispose();
            this.painter.dispose();
            this.handler.dispose();
            this.animation = this.storage = this.painter = this.handler = null;
            delInstance(this.id);
        }
    };
    return zrender;
});
define('zrender/core/util', ['require'], function (require) {
    // 用于处理merge时无法遍历Date等对象的问题
    var BUILTIN_OBJECT = {
            '[object Function]': 1,
            '[object RegExp]': 1,
            '[object Date]': 1,
            '[object Error]': 1,
            '[object CanvasGradient]': 1,
            '[object CanvasPattern]': 1,
            '[object Image]': 1,
            '[object Canvas]': 1
        };
    var TYPED_ARRAY = {
            '[object Int8Array]': 1,
            '[object Uint8Array]': 1,
            '[object Uint8ClampedArray]': 1,
            '[object Int16Array]': 1,
            '[object Uint16Array]': 1,
            '[object Int32Array]': 1,
            '[object Uint32Array]': 1,
            '[object Float32Array]': 1,
            '[object Float64Array]': 1
        };
    var objToString = Object.prototype.toString;
    var arrayProto = Array.prototype;
    var nativeForEach = arrayProto.forEach;
    var nativeFilter = arrayProto.filter;
    var nativeSlice = arrayProto.slice;
    var nativeMap = arrayProto.map;
    var nativeReduce = arrayProto.reduce;
    /**
     * Those data types can be cloned:
     *     Plain object, Array, TypedArray, number, string, null, undefined.
     * Those data types will be assgined using the orginal data:
     *     BUILTIN_OBJECT
     * Instance of user defined class will be cloned to a plain object, without
     * properties in prototype.
     * Other data types is not supported (not sure what will happen).
     *
     * Caution: do not support clone Date, for performance consideration.
     * (There might be a large number of date in `series.data`).
     * So date should not be modified in and out of echarts.
     *
     * @param {*} source
     * @return {*} new
     */
    function clone(source) {
        if (source == null || typeof source != 'object') {
            return source;
        }
        var result = source;
        var typeStr = objToString.call(source);
        if (typeStr === '[object Array]') {
            result = [];
            for (var i = 0, len = source.length; i < len; i++) {
                result[i] = clone(source[i]);
            }
        } else if (TYPED_ARRAY[typeStr]) {
            result = source.constructor.from(source);
        } else if (!BUILTIN_OBJECT[typeStr] && !isDom(source)) {
            result = {};
            for (var key in source) {
                if (source.hasOwnProperty(key)) {
                    result[key] = clone(source[key]);
                }
            }
        }
        return result;
    }
    /**
     * @memberOf module:zrender/core/util
     * @param {*} target
     * @param {*} source
     * @param {boolean} [overwrite=false]
     */
    function merge(target, source, overwrite) {
        // We should escapse that source is string
        // and enter for ... in ...
        if (!isObject(source) || !isObject(target)) {
            return overwrite ? clone(source) : target;
        }
        for (var key in source) {
            if (source.hasOwnProperty(key)) {
                var targetProp = target[key];
                var sourceProp = source[key];
                if (isObject(sourceProp) && isObject(targetProp) && !isArray(sourceProp) && !isArray(targetProp) && !isDom(sourceProp) && !isDom(targetProp) && !isBuildInObject(sourceProp) && !isBuildInObject(targetProp)) {
                    // 如果需要递归覆盖，就递归调用merge
                    merge(targetProp, sourceProp, overwrite);
                } else if (overwrite || !(key in target)) {
                    // 否则只处理overwrite为true，或者在目标对象中没有此属性的情况
                    // NOTE，在 target[key] 不存在的时候也是直接覆盖
                    target[key] = clone(source[key], true);
                }
            }
        }
        return target;
    }
    /**
     * @param {Array} targetAndSources The first item is target, and the rests are source.
     * @param {boolean} [overwrite=false]
     * @return {*} target
     */
    function mergeAll(targetAndSources, overwrite) {
        var result = targetAndSources[0];
        for (var i = 1, len = targetAndSources.length; i < len; i++) {
            result = merge(result, targetAndSources[i], overwrite);
        }
        return result;
    }
    /**
     * @param {*} target
     * @param {*} source
     * @memberOf module:zrender/core/util
     */
    function extend(target, source) {
        for (var key in source) {
            if (source.hasOwnProperty(key)) {
                target[key] = source[key];
            }
        }
        return target;
    }
    /**
     * @param {*} target
     * @param {*} source
     * @param {boolen} [overlay=false]
     * @memberOf module:zrender/core/util
     */
    function defaults(target, source, overlay) {
        for (var key in source) {
            if (source.hasOwnProperty(key) && (overlay ? source[key] != null : target[key] == null)) {
                target[key] = source[key];
            }
        }
        return target;
    }
    function createCanvas() {
        return document.createElement('canvas');
    }
    // FIXME
    var _ctx;
    function getContext() {
        if (!_ctx) {
            // Use util.createCanvas instead of createCanvas
            // because createCanvas may be overwritten in different environment
            _ctx = util.createCanvas().getContext('2d');
        }
        return _ctx;
    }
    /**
     * 查询数组中元素的index
     * @memberOf module:zrender/core/util
     */
    function indexOf(array, value) {
        if (array) {
            if (array.indexOf) {
                return array.indexOf(value);
            }
            for (var i = 0, len = array.length; i < len; i++) {
                if (array[i] === value) {
                    return i;
                }
            }
        }
        return -1;
    }
    /**
     * 构造类继承关系
     *
     * @memberOf module:zrender/core/util
     * @param {Function} clazz 源类
     * @param {Function} baseClazz 基类
     */
    function inherits(clazz, baseClazz) {
        var clazzPrototype = clazz.prototype;
        function F() {
        }
        F.prototype = baseClazz.prototype;
        clazz.prototype = new F();
        for (var prop in clazzPrototype) {
            clazz.prototype[prop] = clazzPrototype[prop];
        }
        clazz.prototype.constructor = clazz;
        clazz.superClass = baseClazz;
    }
    /**
     * @memberOf module:zrender/core/util
     * @param {Object|Function} target
     * @param {Object|Function} sorce
     * @param {boolean} overlay
     */
    function mixin(target, source, overlay) {
        target = 'prototype' in target ? target.prototype : target;
        source = 'prototype' in source ? source.prototype : source;
        defaults(target, source, overlay);
    }
    /**
     * @param {Array|TypedArray} data
     */
    function isArrayLike(data) {
        if (!data) {
            return;
        }
        if (typeof data == 'string') {
            return false;
        }
        return typeof data.length == 'number';
    }
    /**
     * 数组或对象遍历
     * @memberOf module:zrender/core/util
     * @param {Object|Array} obj
     * @param {Function} cb
     * @param {*} [context]
     */
    function each(obj, cb, context) {
        if (!(obj && cb)) {
            return;
        }
        if (obj.forEach && obj.forEach === nativeForEach) {
            obj.forEach(cb, context);
        } else if (obj.length === +obj.length) {
            for (var i = 0, len = obj.length; i < len; i++) {
                cb.call(context, obj[i], i, obj);
            }
        } else {
            for (var key in obj) {
                if (obj.hasOwnProperty(key)) {
                    cb.call(context, obj[key], key, obj);
                }
            }
        }
    }
    /**
     * 数组映射
     * @memberOf module:zrender/core/util
     * @param {Array} obj
     * @param {Function} cb
     * @param {*} [context]
     * @return {Array}
     */
    function map(obj, cb, context) {
        if (!(obj && cb)) {
            return;
        }
        if (obj.map && obj.map === nativeMap) {
            return obj.map(cb, context);
        } else {
            var result = [];
            for (var i = 0, len = obj.length; i < len; i++) {
                result.push(cb.call(context, obj[i], i, obj));
            }
            return result;
        }
    }
    /**
     * @memberOf module:zrender/core/util
     * @param {Array} obj
     * @param {Function} cb
     * @param {Object} [memo]
     * @param {*} [context]
     * @return {Array}
     */
    function reduce(obj, cb, memo, context) {
        if (!(obj && cb)) {
            return;
        }
        if (obj.reduce && obj.reduce === nativeReduce) {
            return obj.reduce(cb, memo, context);
        } else {
            for (var i = 0, len = obj.length; i < len; i++) {
                memo = cb.call(context, memo, obj[i], i, obj);
            }
            return memo;
        }
    }
    /**
     * 数组过滤
     * @memberOf module:zrender/core/util
     * @param {Array} obj
     * @param {Function} cb
     * @param {*} [context]
     * @return {Array}
     */
    function filter(obj, cb, context) {
        if (!(obj && cb)) {
            return;
        }
        if (obj.filter && obj.filter === nativeFilter) {
            return obj.filter(cb, context);
        } else {
            var result = [];
            for (var i = 0, len = obj.length; i < len; i++) {
                if (cb.call(context, obj[i], i, obj)) {
                    result.push(obj[i]);
                }
            }
            return result;
        }
    }
    /**
     * 数组项查找
     * @memberOf module:zrender/core/util
     * @param {Array} obj
     * @param {Function} cb
     * @param {*} [context]
     * @return {Array}
     */
    function find(obj, cb, context) {
        if (!(obj && cb)) {
            return;
        }
        for (var i = 0, len = obj.length; i < len; i++) {
            if (cb.call(context, obj[i], i, obj)) {
                return obj[i];
            }
        }
    }
    /**
     * @memberOf module:zrender/core/util
     * @param {Function} func
     * @param {*} context
     * @return {Function}
     */
    function bind(func, context) {
        var args = nativeSlice.call(arguments, 2);
        return function () {
            return func.apply(context, args.concat(nativeSlice.call(arguments)));
        };
    }
    /**
     * @memberOf module:zrender/core/util
     * @param {Function} func
     * @return {Function}
     */
    function curry(func) {
        var args = nativeSlice.call(arguments, 1);
        return function () {
            return func.apply(this, args.concat(nativeSlice.call(arguments)));
        };
    }
    /**
     * @memberOf module:zrender/core/util
     * @param {*} value
     * @return {boolean}
     */
    function isArray(value) {
        return objToString.call(value) === '[object Array]';
    }
    /**
     * @memberOf module:zrender/core/util
     * @param {*} value
     * @return {boolean}
     */
    function isFunction(value) {
        return typeof value === 'function';
    }
    /**
     * @memberOf module:zrender/core/util
     * @param {*} value
     * @return {boolean}
     */
    function isString(value) {
        return objToString.call(value) === '[object String]';
    }
    /**
     * @memberOf module:zrender/core/util
     * @param {*} value
     * @return {boolean}
     */
    function isObject(value) {
        // Avoid a V8 JIT bug in Chrome 19-20.
        // See https://code.google.com/p/v8/issues/detail?id=2291 for more details.
        var type = typeof value;
        return type === 'function' || !!value && type == 'object';
    }
    /**
     * @memberOf module:zrender/core/util
     * @param {*} value
     * @return {boolean}
     */
    function isBuildInObject(value) {
        return !!BUILTIN_OBJECT[objToString.call(value)];
    }
    /**
     * @memberOf module:zrender/core/util
     * @param {*} value
     * @return {boolean}
     */
    function isDom(value) {
        return typeof value === 'object' && typeof value.nodeType === 'number' && typeof value.ownerDocument === 'object';
    }
    /**
     * If value1 is not null, then return value1, otherwise judget rest of values.
     * @memberOf module:zrender/core/util
     * @return {*} Final value
     */
    function retrieve(values) {
        for (var i = 0, len = arguments.length; i < len; i++) {
            if (arguments[i] != null) {
                return arguments[i];
            }
        }
    }
    /**
     * @memberOf module:zrender/core/util
     * @param {Array} arr
     * @param {number} startIndex
     * @param {number} endIndex
     * @return {Array}
     */
    function slice() {
        return Function.call.apply(nativeSlice, arguments);
    }
    /**
     * @memberOf module:zrender/core/util
     * @param {boolean} condition
     * @param {string} message
     */
    function assert(condition, message) {
        if (!condition) {
            throw new Error(message);
        }
    }
    var util = {
            inherits: inherits,
            mixin: mixin,
            clone: clone,
            merge: merge,
            mergeAll: mergeAll,
            extend: extend,
            defaults: defaults,
            getContext: getContext,
            createCanvas: createCanvas,
            indexOf: indexOf,
            slice: slice,
            find: find,
            isArrayLike: isArrayLike,
            each: each,
            map: map,
            reduce: reduce,
            filter: filter,
            bind: bind,
            curry: curry,
            isArray: isArray,
            isString: isString,
            isObject: isObject,
            isFunction: isFunction,
            isBuildInObject: isBuildInObject,
            isDom: isDom,
            retrieve: retrieve,
            assert: assert,
            noop: function () {
            }
        };
    return util;
});
define('zrender/tool/color', ['require'], function (require) {
    var kCSSColorTable = {
            'transparent': [
                0,
                0,
                0,
                0
            ],
            'aliceblue': [
                240,
                248,
                255,
                1
            ],
            'antiquewhite': [
                250,
                235,
                215,
                1
            ],
            'aqua': [
                0,
                255,
                255,
                1
            ],
            'aquamarine': [
                127,
                255,
                212,
                1
            ],
            'azure': [
                240,
                255,
                255,
                1
            ],
            'beige': [
                245,
                245,
                220,
                1
            ],
            'bisque': [
                255,
                228,
                196,
                1
            ],
            'black': [
                0,
                0,
                0,
                1
            ],
            'blanchedalmond': [
                255,
                235,
                205,
                1
            ],
            'blue': [
                0,
                0,
                255,
                1
            ],
            'blueviolet': [
                138,
                43,
                226,
                1
            ],
            'brown': [
                165,
                42,
                42,
                1
            ],
            'burlywood': [
                222,
                184,
                135,
                1
            ],
            'cadetblue': [
                95,
                158,
                160,
                1
            ],
            'chartreuse': [
                127,
                255,
                0,
                1
            ],
            'chocolate': [
                210,
                105,
                30,
                1
            ],
            'coral': [
                255,
                127,
                80,
                1
            ],
            'cornflowerblue': [
                100,
                149,
                237,
                1
            ],
            'cornsilk': [
                255,
                248,
                220,
                1
            ],
            'crimson': [
                220,
                20,
                60,
                1
            ],
            'cyan': [
                0,
                255,
                255,
                1
            ],
            'darkblue': [
                0,
                0,
                139,
                1
            ],
            'darkcyan': [
                0,
                139,
                139,
                1
            ],
            'darkgoldenrod': [
                184,
                134,
                11,
                1
            ],
            'darkgray': [
                169,
                169,
                169,
                1
            ],
            'darkgreen': [
                0,
                100,
                0,
                1
            ],
            'darkgrey': [
                169,
                169,
                169,
                1
            ],
            'darkkhaki': [
                189,
                183,
                107,
                1
            ],
            'darkmagenta': [
                139,
                0,
                139,
                1
            ],
            'darkolivegreen': [
                85,
                107,
                47,
                1
            ],
            'darkorange': [
                255,
                140,
                0,
                1
            ],
            'darkorchid': [
                153,
                50,
                204,
                1
            ],
            'darkred': [
                139,
                0,
                0,
                1
            ],
            'darksalmon': [
                233,
                150,
                122,
                1
            ],
            'darkseagreen': [
                143,
                188,
                143,
                1
            ],
            'darkslateblue': [
                72,
                61,
                139,
                1
            ],
            'darkslategray': [
                47,
                79,
                79,
                1
            ],
            'darkslategrey': [
                47,
                79,
                79,
                1
            ],
            'darkturquoise': [
                0,
                206,
                209,
                1
            ],
            'darkviolet': [
                148,
                0,
                211,
                1
            ],
            'deeppink': [
                255,
                20,
                147,
                1
            ],
            'deepskyblue': [
                0,
                191,
                255,
                1
            ],
            'dimgray': [
                105,
                105,
                105,
                1
            ],
            'dimgrey': [
                105,
                105,
                105,
                1
            ],
            'dodgerblue': [
                30,
                144,
                255,
                1
            ],
            'firebrick': [
                178,
                34,
                34,
                1
            ],
            'floralwhite': [
                255,
                250,
                240,
                1
            ],
            'forestgreen': [
                34,
                139,
                34,
                1
            ],
            'fuchsia': [
                255,
                0,
                255,
                1
            ],
            'gainsboro': [
                220,
                220,
                220,
                1
            ],
            'ghostwhite': [
                248,
                248,
                255,
                1
            ],
            'gold': [
                255,
                215,
                0,
                1
            ],
            'goldenrod': [
                218,
                165,
                32,
                1
            ],
            'gray': [
                128,
                128,
                128,
                1
            ],
            'green': [
                0,
                128,
                0,
                1
            ],
            'greenyellow': [
                173,
                255,
                47,
                1
            ],
            'grey': [
                128,
                128,
                128,
                1
            ],
            'honeydew': [
                240,
                255,
                240,
                1
            ],
            'hotpink': [
                255,
                105,
                180,
                1
            ],
            'indianred': [
                205,
                92,
                92,
                1
            ],
            'indigo': [
                75,
                0,
                130,
                1
            ],
            'ivory': [
                255,
                255,
                240,
                1
            ],
            'khaki': [
                240,
                230,
                140,
                1
            ],
            'lavender': [
                230,
                230,
                250,
                1
            ],
            'lavenderblush': [
                255,
                240,
                245,
                1
            ],
            'lawngreen': [
                124,
                252,
                0,
                1
            ],
            'lemonchiffon': [
                255,
                250,
                205,
                1
            ],
            'lightblue': [
                173,
                216,
                230,
                1
            ],
            'lightcoral': [
                240,
                128,
                128,
                1
            ],
            'lightcyan': [
                224,
                255,
                255,
                1
            ],
            'lightgoldenrodyellow': [
                250,
                250,
                210,
                1
            ],
            'lightgray': [
                211,
                211,
                211,
                1
            ],
            'lightgreen': [
                144,
                238,
                144,
                1
            ],
            'lightgrey': [
                211,
                211,
                211,
                1
            ],
            'lightpink': [
                255,
                182,
                193,
                1
            ],
            'lightsalmon': [
                255,
                160,
                122,
                1
            ],
            'lightseagreen': [
                32,
                178,
                170,
                1
            ],
            'lightskyblue': [
                135,
                206,
                250,
                1
            ],
            'lightslategray': [
                119,
                136,
                153,
                1
            ],
            'lightslategrey': [
                119,
                136,
                153,
                1
            ],
            'lightsteelblue': [
                176,
                196,
                222,
                1
            ],
            'lightyellow': [
                255,
                255,
                224,
                1
            ],
            'lime': [
                0,
                255,
                0,
                1
            ],
            'limegreen': [
                50,
                205,
                50,
                1
            ],
            'linen': [
                250,
                240,
                230,
                1
            ],
            'magenta': [
                255,
                0,
                255,
                1
            ],
            'maroon': [
                128,
                0,
                0,
                1
            ],
            'mediumaquamarine': [
                102,
                205,
                170,
                1
            ],
            'mediumblue': [
                0,
                0,
                205,
                1
            ],
            'mediumorchid': [
                186,
                85,
                211,
                1
            ],
            'mediumpurple': [
                147,
                112,
                219,
                1
            ],
            'mediumseagreen': [
                60,
                179,
                113,
                1
            ],
            'mediumslateblue': [
                123,
                104,
                238,
                1
            ],
            'mediumspringgreen': [
                0,
                250,
                154,
                1
            ],
            'mediumturquoise': [
                72,
                209,
                204,
                1
            ],
            'mediumvioletred': [
                199,
                21,
                133,
                1
            ],
            'midnightblue': [
                25,
                25,
                112,
                1
            ],
            'mintcream': [
                245,
                255,
                250,
                1
            ],
            'mistyrose': [
                255,
                228,
                225,
                1
            ],
            'moccasin': [
                255,
                228,
                181,
                1
            ],
            'navajowhite': [
                255,
                222,
                173,
                1
            ],
            'navy': [
                0,
                0,
                128,
                1
            ],
            'oldlace': [
                253,
                245,
                230,
                1
            ],
            'olive': [
                128,
                128,
                0,
                1
            ],
            'olivedrab': [
                107,
                142,
                35,
                1
            ],
            'orange': [
                255,
                165,
                0,
                1
            ],
            'orangered': [
                255,
                69,
                0,
                1
            ],
            'orchid': [
                218,
                112,
                214,
                1
            ],
            'palegoldenrod': [
                238,
                232,
                170,
                1
            ],
            'palegreen': [
                152,
                251,
                152,
                1
            ],
            'paleturquoise': [
                175,
                238,
                238,
                1
            ],
            'palevioletred': [
                219,
                112,
                147,
                1
            ],
            'papayawhip': [
                255,
                239,
                213,
                1
            ],
            'peachpuff': [
                255,
                218,
                185,
                1
            ],
            'peru': [
                205,
                133,
                63,
                1
            ],
            'pink': [
                255,
                192,
                203,
                1
            ],
            'plum': [
                221,
                160,
                221,
                1
            ],
            'powderblue': [
                176,
                224,
                230,
                1
            ],
            'purple': [
                128,
                0,
                128,
                1
            ],
            'red': [
                255,
                0,
                0,
                1
            ],
            'rosybrown': [
                188,
                143,
                143,
                1
            ],
            'royalblue': [
                65,
                105,
                225,
                1
            ],
            'saddlebrown': [
                139,
                69,
                19,
                1
            ],
            'salmon': [
                250,
                128,
                114,
                1
            ],
            'sandybrown': [
                244,
                164,
                96,
                1
            ],
            'seagreen': [
                46,
                139,
                87,
                1
            ],
            'seashell': [
                255,
                245,
                238,
                1
            ],
            'sienna': [
                160,
                82,
                45,
                1
            ],
            'silver': [
                192,
                192,
                192,
                1
            ],
            'skyblue': [
                135,
                206,
                235,
                1
            ],
            'slateblue': [
                106,
                90,
                205,
                1
            ],
            'slategray': [
                112,
                128,
                144,
                1
            ],
            'slategrey': [
                112,
                128,
                144,
                1
            ],
            'snow': [
                255,
                250,
                250,
                1
            ],
            'springgreen': [
                0,
                255,
                127,
                1
            ],
            'steelblue': [
                70,
                130,
                180,
                1
            ],
            'tan': [
                210,
                180,
                140,
                1
            ],
            'teal': [
                0,
                128,
                128,
                1
            ],
            'thistle': [
                216,
                191,
                216,
                1
            ],
            'tomato': [
                255,
                99,
                71,
                1
            ],
            'turquoise': [
                64,
                224,
                208,
                1
            ],
            'violet': [
                238,
                130,
                238,
                1
            ],
            'wheat': [
                245,
                222,
                179,
                1
            ],
            'white': [
                255,
                255,
                255,
                1
            ],
            'whitesmoke': [
                245,
                245,
                245,
                1
            ],
            'yellow': [
                255,
                255,
                0,
                1
            ],
            'yellowgreen': [
                154,
                205,
                50,
                1
            ]
        };
    function clampCssByte(i) {
        // Clamp to integer 0 .. 255.
        i = Math.round(i);
        // Seems to be what Chrome does (vs truncation).
        return i < 0 ? 0 : i > 255 ? 255 : i;
    }
    function clampCssAngle(i) {
        // Clamp to integer 0 .. 360.
        i = Math.round(i);
        // Seems to be what Chrome does (vs truncation).
        return i < 0 ? 0 : i > 360 ? 360 : i;
    }
    function clampCssFloat(f) {
        // Clamp to float 0.0 .. 1.0.
        return f < 0 ? 0 : f > 1 ? 1 : f;
    }
    function parseCssInt(str) {
        // int or percentage.
        if (str.length && str.charAt(str.length - 1) === '%') {
            return clampCssByte(parseFloat(str) / 100 * 255);
        }
        return clampCssByte(parseInt(str, 10));
    }
    function parseCssFloat(str) {
        // float or percentage.
        if (str.length && str.charAt(str.length - 1) === '%') {
            return clampCssFloat(parseFloat(str) / 100);
        }
        return clampCssFloat(parseFloat(str));
    }
    function cssHueToRgb(m1, m2, h) {
        if (h < 0) {
            h += 1;
        } else if (h > 1) {
            h -= 1;
        }
        if (h * 6 < 1) {
            return m1 + (m2 - m1) * h * 6;
        }
        if (h * 2 < 1) {
            return m2;
        }
        if (h * 3 < 2) {
            return m1 + (m2 - m1) * (2 / 3 - h) * 6;
        }
        return m1;
    }
    function lerp(a, b, p) {
        return a + (b - a) * p;
    }
    /**
     * @param {string} colorStr
     * @return {Array.<number>}
     * @memberOf module:zrender/util/color
     */
    function parse(colorStr) {
        if (!colorStr) {
            return;
        }
        // colorStr may be not string
        colorStr = colorStr + '';
        // Remove all whitespace, not compliant, but should just be more accepting.
        var str = colorStr.replace(/ /g, '').toLowerCase();
        // Color keywords (and transparent) lookup.
        if (str in kCSSColorTable) {
            return kCSSColorTable[str].slice();    // dup.
        }
        // #abc and #abc123 syntax.
        if (str.charAt(0) === '#') {
            if (str.length === 4) {
                var iv = parseInt(str.substr(1), 16);
                // TODO(deanm): Stricter parsing.
                if (!(iv >= 0 && iv <= 4095)) {
                    return;    // Covers NaN.
                }
                return [
                    (iv & 3840) >> 4 | (iv & 3840) >> 8,
                    iv & 240 | (iv & 240) >> 4,
                    iv & 15 | (iv & 15) << 4,
                    1
                ];
            } else if (str.length === 7) {
                var iv = parseInt(str.substr(1), 16);
                // TODO(deanm): Stricter parsing.
                if (!(iv >= 0 && iv <= 16777215)) {
                    return;    // Covers NaN.
                }
                return [
                    (iv & 16711680) >> 16,
                    (iv & 65280) >> 8,
                    iv & 255,
                    1
                ];
            }
            return;
        }
        var op = str.indexOf('('), ep = str.indexOf(')');
        if (op !== -1 && ep + 1 === str.length) {
            var fname = str.substr(0, op);
            var params = str.substr(op + 1, ep - (op + 1)).split(',');
            var alpha = 1;
            // To allow case fallthrough.
            switch (fname) {
            case 'rgba':
                if (params.length !== 4) {
                    return;
                }
                alpha = parseCssFloat(params.pop());
            // jshint ignore:line
            // Fall through.
            case 'rgb':
                if (params.length !== 3) {
                    return;
                }
                return [
                    parseCssInt(params[0]),
                    parseCssInt(params[1]),
                    parseCssInt(params[2]),
                    alpha
                ];
            case 'hsla':
                if (params.length !== 4) {
                    return;
                }
                params[3] = parseCssFloat(params[3]);
                return hsla2rgba(params);
            case 'hsl':
                if (params.length !== 3) {
                    return;
                }
                return hsla2rgba(params);
            default:
                return;
            }
        }
        return;
    }
    /**
     * @param {Array.<number>} hsla
     * @return {Array.<number>} rgba
     */
    function hsla2rgba(hsla) {
        var h = (parseFloat(hsla[0]) % 360 + 360) % 360 / 360;
        // 0 .. 1
        // NOTE(deanm): According to the CSS spec s/l should only be
        // percentages, but we don't bother and let float or percentage.
        var s = parseCssFloat(hsla[1]);
        var l = parseCssFloat(hsla[2]);
        var m2 = l <= 0.5 ? l * (s + 1) : l + s - l * s;
        var m1 = l * 2 - m2;
        var rgba = [
                clampCssByte(cssHueToRgb(m1, m2, h + 1 / 3) * 255),
                clampCssByte(cssHueToRgb(m1, m2, h) * 255),
                clampCssByte(cssHueToRgb(m1, m2, h - 1 / 3) * 255)
            ];
        if (hsla.length === 4) {
            rgba[3] = hsla[3];
        }
        return rgba;
    }
    /**
     * @param {Array.<number>} rgba
     * @return {Array.<number>} hsla
     */
    function rgba2hsla(rgba) {
        if (!rgba) {
            return;
        }
        // RGB from 0 to 255
        var R = rgba[0] / 255;
        var G = rgba[1] / 255;
        var B = rgba[2] / 255;
        var vMin = Math.min(R, G, B);
        // Min. value of RGB
        var vMax = Math.max(R, G, B);
        // Max. value of RGB
        var delta = vMax - vMin;
        // Delta RGB value
        var L = (vMax + vMin) / 2;
        var H;
        var S;
        // HSL results from 0 to 1
        if (delta === 0) {
            H = 0;
            S = 0;
        } else {
            if (L < 0.5) {
                S = delta / (vMax + vMin);
            } else {
                S = delta / (2 - vMax - vMin);
            }
            var deltaR = ((vMax - R) / 6 + delta / 2) / delta;
            var deltaG = ((vMax - G) / 6 + delta / 2) / delta;
            var deltaB = ((vMax - B) / 6 + delta / 2) / delta;
            if (R === vMax) {
                H = deltaB - deltaG;
            } else if (G === vMax) {
                H = 1 / 3 + deltaR - deltaB;
            } else if (B === vMax) {
                H = 2 / 3 + deltaG - deltaR;
            }
            if (H < 0) {
                H += 1;
            }
            if (H > 1) {
                H -= 1;
            }
        }
        var hsla = [
                H * 360,
                S,
                L
            ];
        if (rgba[3] != null) {
            hsla.push(rgba[3]);
        }
        return hsla;
    }
    /**
     * @param {string} color
     * @param {number} level
     * @return {string}
     * @memberOf module:zrender/util/color
     */
    function lift(color, level) {
        var colorArr = parse(color);
        if (colorArr) {
            for (var i = 0; i < 3; i++) {
                if (level < 0) {
                    colorArr[i] = colorArr[i] * (1 - level) | 0;
                } else {
                    colorArr[i] = (255 - colorArr[i]) * level + colorArr[i] | 0;
                }
            }
            return stringify(colorArr, colorArr.length === 4 ? 'rgba' : 'rgb');
        }
    }
    /**
     * @param {string} color
     * @return {string}
     * @memberOf module:zrender/util/color
     */
    function toHex(color, level) {
        var colorArr = parse(color);
        if (colorArr) {
            return ((1 << 24) + (colorArr[0] << 16) + (colorArr[1] << 8) + +colorArr[2]).toString(16).slice(1);
        }
    }
    /**
     * Map value to color. Faster than mapToColor methods because color is represented by rgba array
     * @param {number} normalizedValue A float between 0 and 1.
     * @param {Array.<Array.<number>>} colors List of rgba color array
     * @param {Array.<number>} [out] Mapped gba color array
     * @return {Array.<number>}
     */
    function fastMapToColor(normalizedValue, colors, out) {
        if (!(colors && colors.length) || !(normalizedValue >= 0 && normalizedValue <= 1)) {
            return;
        }
        out = out || [
            0,
            0,
            0,
            0
        ];
        var value = normalizedValue * (colors.length - 1);
        var leftIndex = Math.floor(value);
        var rightIndex = Math.ceil(value);
        var leftColor = colors[leftIndex];
        var rightColor = colors[rightIndex];
        var dv = value - leftIndex;
        out[0] = clampCssByte(lerp(leftColor[0], rightColor[0], dv));
        out[1] = clampCssByte(lerp(leftColor[1], rightColor[1], dv));
        out[2] = clampCssByte(lerp(leftColor[2], rightColor[2], dv));
        out[3] = clampCssByte(lerp(leftColor[3], rightColor[3], dv));
        return out;
    }
    /**
     * @param {number} normalizedValue A float between 0 and 1.
     * @param {Array.<string>} colors Color list.
     * @param {boolean=} fullOutput Default false.
     * @return {(string|Object)} Result color. If fullOutput,
     *                           return {color: ..., leftIndex: ..., rightIndex: ..., value: ...},
     * @memberOf module:zrender/util/color
     */
    function mapToColor(normalizedValue, colors, fullOutput) {
        if (!(colors && colors.length) || !(normalizedValue >= 0 && normalizedValue <= 1)) {
            return;
        }
        var value = normalizedValue * (colors.length - 1);
        var leftIndex = Math.floor(value);
        var rightIndex = Math.ceil(value);
        var leftColor = parse(colors[leftIndex]);
        var rightColor = parse(colors[rightIndex]);
        var dv = value - leftIndex;
        var color = stringify([
                clampCssByte(lerp(leftColor[0], rightColor[0], dv)),
                clampCssByte(lerp(leftColor[1], rightColor[1], dv)),
                clampCssByte(lerp(leftColor[2], rightColor[2], dv)),
                clampCssFloat(lerp(leftColor[3], rightColor[3], dv))
            ], 'rgba');
        return fullOutput ? {
            color: color,
            leftIndex: leftIndex,
            rightIndex: rightIndex,
            value: value
        } : color;
    }
    /**
     * @param {string} color
     * @param {number=} h 0 ~ 360, ignore when null.
     * @param {number=} s 0 ~ 1, ignore when null.
     * @param {number=} l 0 ~ 1, ignore when null.
     * @return {string} Color string in rgba format.
     * @memberOf module:zrender/util/color
     */
    function modifyHSL(color, h, s, l) {
        color = parse(color);
        if (color) {
            color = rgba2hsla(color);
            h != null && (color[0] = clampCssAngle(h));
            s != null && (color[1] = parseCssFloat(s));
            l != null && (color[2] = parseCssFloat(l));
            return stringify(hsla2rgba(color), 'rgba');
        }
    }
    /**
     * @param {string} color
     * @param {number=} alpha 0 ~ 1
     * @return {string} Color string in rgba format.
     * @memberOf module:zrender/util/color
     */
    function modifyAlpha(color, alpha) {
        color = parse(color);
        if (color && alpha != null) {
            color[3] = clampCssFloat(alpha);
            return stringify(color, 'rgba');
        }
    }
    /**
     * @param {Array.<string>} colors Color list.
     * @param {string} type 'rgba', 'hsva', ...
     * @return {string} Result color.
     */
    function stringify(arrColor, type) {
        var colorStr = arrColor[0] + ',' + arrColor[1] + ',' + arrColor[2];
        if (type === 'rgba' || type === 'hsva' || type === 'hsla') {
            colorStr += ',' + arrColor[3];
        }
        return type + '(' + colorStr + ')';
    }
    return {
        parse: parse,
        lift: lift,
        toHex: toHex,
        fastMapToColor: fastMapToColor,
        mapToColor: mapToColor,
        modifyHSL: modifyHSL,
        modifyAlpha: modifyAlpha,
        stringify: stringify
    };
});
define('zrender/mixin/Eventful', ['require'], function (require) {
    var arrySlice = Array.prototype.slice;
    /**
     * 事件分发器
     * @alias module:zrender/mixin/Eventful
     * @constructor
     */
    var Eventful = function () {
        this._$handlers = {};
    };
    Eventful.prototype = {
        constructor: Eventful,
        one: function (event, handler, context) {
            var _h = this._$handlers;
            if (!handler || !event) {
                return this;
            }
            if (!_h[event]) {
                _h[event] = [];
            }
            for (var i = 0; i < _h[event].length; i++) {
                if (_h[event][i].h === handler) {
                    return this;
                }
            }
            _h[event].push({
                h: handler,
                one: true,
                ctx: context || this
            });
            return this;
        },
        on: function (event, handler, context) {
            var _h = this._$handlers;
            if (!handler || !event) {
                return this;
            }
            if (!_h[event]) {
                _h[event] = [];
            }
            for (var i = 0; i < _h[event].length; i++) {
                if (_h[event][i].h === handler) {
                    return this;
                }
            }
            _h[event].push({
                h: handler,
                one: false,
                ctx: context || this
            });
            return this;
        },
        isSilent: function (event) {
            var _h = this._$handlers;
            return _h[event] && _h[event].length;
        },
        off: function (event, handler) {
            var _h = this._$handlers;
            if (!event) {
                this._$handlers = {};
                return this;
            }
            if (handler) {
                if (_h[event]) {
                    var newList = [];
                    for (var i = 0, l = _h[event].length; i < l; i++) {
                        if (_h[event][i]['h'] != handler) {
                            newList.push(_h[event][i]);
                        }
                    }
                    _h[event] = newList;
                }
                if (_h[event] && _h[event].length === 0) {
                    delete _h[event];
                }
            } else {
                delete _h[event];
            }
            return this;
        },
        trigger: function (type) {
            if (this._$handlers[type]) {
                var args = arguments;
                var argLen = args.length;
                if (argLen > 3) {
                    args = arrySlice.call(args, 1);
                }
                var _h = this._$handlers[type];
                var len = _h.length;
                for (var i = 0; i < len;) {
                    // Optimize advise from backbone
                    switch (argLen) {
                    case 1:
                        _h[i]['h'].call(_h[i]['ctx']);
                        break;
                    case 2:
                        _h[i]['h'].call(_h[i]['ctx'], args[1]);
                        break;
                    case 3:
                        _h[i]['h'].call(_h[i]['ctx'], args[1], args[2]);
                        break;
                    default:
                        // have more than 2 given arguments
                        _h[i]['h'].apply(_h[i]['ctx'], args);
                        break;
                    }
                    if (_h[i]['one']) {
                        _h.splice(i, 1);
                        len--;
                    } else {
                        i++;
                    }
                }
            }
            return this;
        },
        triggerWithContext: function (type) {
            if (this._$handlers[type]) {
                var args = arguments;
                var argLen = args.length;
                if (argLen > 4) {
                    args = arrySlice.call(args, 1, args.length - 1);
                }
                var ctx = args[args.length - 1];
                var _h = this._$handlers[type];
                var len = _h.length;
                for (var i = 0; i < len;) {
                    // Optimize advise from backbone
                    switch (argLen) {
                    case 1:
                        _h[i]['h'].call(ctx);
                        break;
                    case 2:
                        _h[i]['h'].call(ctx, args[1]);
                        break;
                    case 3:
                        _h[i]['h'].call(ctx, args[1], args[2]);
                        break;
                    default:
                        // have more than 2 given arguments
                        _h[i]['h'].apply(ctx, args);
                        break;
                    }
                    if (_h[i]['one']) {
                        _h.splice(i, 1);
                        len--;
                    } else {
                        i++;
                    }
                }
            }
            return this;
        }
    };
    // 对象可以通过 onxxxx 绑定事件
    /**
     * @event module:zrender/mixin/Eventful#onclick
     * @type {Function}
     * @default null
     */
    /**
     * @event module:zrender/mixin/Eventful#onmouseover
     * @type {Function}
     * @default null
     */
    /**
     * @event module:zrender/mixin/Eventful#onmouseout
     * @type {Function}
     * @default null
     */
    /**
     * @event module:zrender/mixin/Eventful#onmousemove
     * @type {Function}
     * @default null
     */
    /**
     * @event module:zrender/mixin/Eventful#onmousewheel
     * @type {Function}
     * @default null
     */
    /**
     * @event module:zrender/mixin/Eventful#onmousedown
     * @type {Function}
     * @default null
     */
    /**
     * @event module:zrender/mixin/Eventful#onmouseup
     * @type {Function}
     * @default null
     */
    /**
     * @event module:zrender/mixin/Eventful#ondrag
     * @type {Function}
     * @default null
     */
    /**
     * @event module:zrender/mixin/Eventful#ondragstart
     * @type {Function}
     * @default null
     */
    /**
     * @event module:zrender/mixin/Eventful#ondragend
     * @type {Function}
     * @default null
     */
    /**
     * @event module:zrender/mixin/Eventful#ondragenter
     * @type {Function}
     * @default null
     */
    /**
     * @event module:zrender/mixin/Eventful#ondragleave
     * @type {Function}
     * @default null
     */
    /**
     * @event module:zrender/mixin/Eventful#ondragover
     * @type {Function}
     * @default null
     */
    /**
     * @event module:zrender/mixin/Eventful#ondrop
     * @type {Function}
     * @default null
     */
    return Eventful;
});
define('zrender/core/timsort', [], function () {
    var DEFAULT_MIN_MERGE = 32;
    var DEFAULT_MIN_GALLOPING = 7;
    var DEFAULT_TMP_STORAGE_LENGTH = 256;
    function minRunLength(n) {
        var r = 0;
        while (n >= DEFAULT_MIN_MERGE) {
            r |= n & 1;
            n >>= 1;
        }
        return n + r;
    }
    function makeAscendingRun(array, lo, hi, compare) {
        var runHi = lo + 1;
        if (runHi === hi) {
            return 1;
        }
        if (compare(array[runHi++], array[lo]) < 0) {
            while (runHi < hi && compare(array[runHi], array[runHi - 1]) < 0) {
                runHi++;
            }
            reverseRun(array, lo, runHi);
        } else {
            while (runHi < hi && compare(array[runHi], array[runHi - 1]) >= 0) {
                runHi++;
            }
        }
        return runHi - lo;
    }
    function reverseRun(array, lo, hi) {
        hi--;
        while (lo < hi) {
            var t = array[lo];
            array[lo++] = array[hi];
            array[hi--] = t;
        }
    }
    function binaryInsertionSort(array, lo, hi, start, compare) {
        if (start === lo) {
            start++;
        }
        for (; start < hi; start++) {
            var pivot = array[start];
            var left = lo;
            var right = start;
            var mid;
            while (left < right) {
                mid = left + right >>> 1;
                if (compare(pivot, array[mid]) < 0) {
                    right = mid;
                } else {
                    left = mid + 1;
                }
            }
            var n = start - left;
            switch (n) {
            case 3:
                array[left + 3] = array[left + 2];
            case 2:
                array[left + 2] = array[left + 1];
            case 1:
                array[left + 1] = array[left];
                break;
            default:
                while (n > 0) {
                    array[left + n] = array[left + n - 1];
                    n--;
                }
            }
            array[left] = pivot;
        }
    }
    function gallopLeft(value, array, start, length, hint, compare) {
        var lastOffset = 0;
        var maxOffset = 0;
        var offset = 1;
        if (compare(value, array[start + hint]) > 0) {
            maxOffset = length - hint;
            while (offset < maxOffset && compare(value, array[start + hint + offset]) > 0) {
                lastOffset = offset;
                offset = (offset << 1) + 1;
                if (offset <= 0) {
                    offset = maxOffset;
                }
            }
            if (offset > maxOffset) {
                offset = maxOffset;
            }
            lastOffset += hint;
            offset += hint;
        } else {
            maxOffset = hint + 1;
            while (offset < maxOffset && compare(value, array[start + hint - offset]) <= 0) {
                lastOffset = offset;
                offset = (offset << 1) + 1;
                if (offset <= 0) {
                    offset = maxOffset;
                }
            }
            if (offset > maxOffset) {
                offset = maxOffset;
            }
            var tmp = lastOffset;
            lastOffset = hint - offset;
            offset = hint - tmp;
        }
        lastOffset++;
        while (lastOffset < offset) {
            var m = lastOffset + (offset - lastOffset >>> 1);
            if (compare(value, array[start + m]) > 0) {
                lastOffset = m + 1;
            } else {
                offset = m;
            }
        }
        return offset;
    }
    function gallopRight(value, array, start, length, hint, compare) {
        var lastOffset = 0;
        var maxOffset = 0;
        var offset = 1;
        if (compare(value, array[start + hint]) < 0) {
            maxOffset = hint + 1;
            while (offset < maxOffset && compare(value, array[start + hint - offset]) < 0) {
                lastOffset = offset;
                offset = (offset << 1) + 1;
                if (offset <= 0) {
                    offset = maxOffset;
                }
            }
            if (offset > maxOffset) {
                offset = maxOffset;
            }
            var tmp = lastOffset;
            lastOffset = hint - offset;
            offset = hint - tmp;
        } else {
            maxOffset = length - hint;
            while (offset < maxOffset && compare(value, array[start + hint + offset]) >= 0) {
                lastOffset = offset;
                offset = (offset << 1) + 1;
                if (offset <= 0) {
                    offset = maxOffset;
                }
            }
            if (offset > maxOffset) {
                offset = maxOffset;
            }
            lastOffset += hint;
            offset += hint;
        }
        lastOffset++;
        while (lastOffset < offset) {
            var m = lastOffset + (offset - lastOffset >>> 1);
            if (compare(value, array[start + m]) < 0) {
                offset = m;
            } else {
                lastOffset = m + 1;
            }
        }
        return offset;
    }
    function TimSort(array, compare) {
        var minGallop = DEFAULT_MIN_GALLOPING;
        var length = 0;
        var tmpStorageLength = DEFAULT_TMP_STORAGE_LENGTH;
        var stackLength = 0;
        var runStart;
        var runLength;
        var stackSize = 0;
        length = array.length;
        if (length < 2 * DEFAULT_TMP_STORAGE_LENGTH) {
            tmpStorageLength = length >>> 1;
        }
        var tmp = [];
        stackLength = length < 120 ? 5 : length < 1542 ? 10 : length < 119151 ? 19 : 40;
        runStart = [];
        runLength = [];
        function pushRun(_runStart, _runLength) {
            runStart[stackSize] = _runStart;
            runLength[stackSize] = _runLength;
            stackSize += 1;
        }
        function mergeRuns() {
            while (stackSize > 1) {
                var n = stackSize - 2;
                if (n >= 1 && runLength[n - 1] <= runLength[n] + runLength[n + 1] || n >= 2 && runLength[n - 2] <= runLength[n] + runLength[n - 1]) {
                    if (runLength[n - 1] < runLength[n + 1]) {
                        n--;
                    }
                } else if (runLength[n] > runLength[n + 1]) {
                    break;
                }
                mergeAt(n);
            }
        }
        function forceMergeRuns() {
            while (stackSize > 1) {
                var n = stackSize - 2;
                if (n > 0 && runLength[n - 1] < runLength[n + 1]) {
                    n--;
                }
                mergeAt(n);
            }
        }
        function mergeAt(i) {
            var start1 = runStart[i];
            var length1 = runLength[i];
            var start2 = runStart[i + 1];
            var length2 = runLength[i + 1];
            runLength[i] = length1 + length2;
            if (i === stackSize - 3) {
                runStart[i + 1] = runStart[i + 2];
                runLength[i + 1] = runLength[i + 2];
            }
            stackSize--;
            var k = gallopRight(array[start2], array, start1, length1, 0, compare);
            start1 += k;
            length1 -= k;
            if (length1 === 0) {
                return;
            }
            length2 = gallopLeft(array[start1 + length1 - 1], array, start2, length2, length2 - 1, compare);
            if (length2 === 0) {
                return;
            }
            if (length1 <= length2) {
                mergeLow(start1, length1, start2, length2);
            } else {
                mergeHigh(start1, length1, start2, length2);
            }
        }
        function mergeLow(start1, length1, start2, length2) {
            var i = 0;
            for (i = 0; i < length1; i++) {
                tmp[i] = array[start1 + i];
            }
            var cursor1 = 0;
            var cursor2 = start2;
            var dest = start1;
            array[dest++] = array[cursor2++];
            if (--length2 === 0) {
                for (i = 0; i < length1; i++) {
                    array[dest + i] = tmp[cursor1 + i];
                }
                return;
            }
            if (length1 === 1) {
                for (i = 0; i < length2; i++) {
                    array[dest + i] = array[cursor2 + i];
                }
                array[dest + length2] = tmp[cursor1];
                return;
            }
            var _minGallop = minGallop;
            var count1, count2, exit;
            while (1) {
                count1 = 0;
                count2 = 0;
                exit = false;
                do {
                    if (compare(array[cursor2], tmp[cursor1]) < 0) {
                        array[dest++] = array[cursor2++];
                        count2++;
                        count1 = 0;
                        if (--length2 === 0) {
                            exit = true;
                            break;
                        }
                    } else {
                        array[dest++] = tmp[cursor1++];
                        count1++;
                        count2 = 0;
                        if (--length1 === 1) {
                            exit = true;
                            break;
                        }
                    }
                } while ((count1 | count2) < _minGallop);
                if (exit) {
                    break;
                }
                do {
                    count1 = gallopRight(array[cursor2], tmp, cursor1, length1, 0, compare);
                    if (count1 !== 0) {
                        for (i = 0; i < count1; i++) {
                            array[dest + i] = tmp[cursor1 + i];
                        }
                        dest += count1;
                        cursor1 += count1;
                        length1 -= count1;
                        if (length1 <= 1) {
                            exit = true;
                            break;
                        }
                    }
                    array[dest++] = array[cursor2++];
                    if (--length2 === 0) {
                        exit = true;
                        break;
                    }
                    count2 = gallopLeft(tmp[cursor1], array, cursor2, length2, 0, compare);
                    if (count2 !== 0) {
                        for (i = 0; i < count2; i++) {
                            array[dest + i] = array[cursor2 + i];
                        }
                        dest += count2;
                        cursor2 += count2;
                        length2 -= count2;
                        if (length2 === 0) {
                            exit = true;
                            break;
                        }
                    }
                    array[dest++] = tmp[cursor1++];
                    if (--length1 === 1) {
                        exit = true;
                        break;
                    }
                    _minGallop--;
                } while (count1 >= DEFAULT_MIN_GALLOPING || count2 >= DEFAULT_MIN_GALLOPING);
                if (exit) {
                    break;
                }
                if (_minGallop < 0) {
                    _minGallop = 0;
                }
                _minGallop += 2;
            }
            minGallop = _minGallop;
            minGallop < 1 && (minGallop = 1);
            if (length1 === 1) {
                for (i = 0; i < length2; i++) {
                    array[dest + i] = array[cursor2 + i];
                }
                array[dest + length2] = tmp[cursor1];
            } else if (length1 === 0) {
                throw new Error();    // throw new Error('mergeLow preconditions were not respected');
            } else {
                for (i = 0; i < length1; i++) {
                    array[dest + i] = tmp[cursor1 + i];
                }
            }
        }
        function mergeHigh(start1, length1, start2, length2) {
            var i = 0;
            for (i = 0; i < length2; i++) {
                tmp[i] = array[start2 + i];
            }
            var cursor1 = start1 + length1 - 1;
            var cursor2 = length2 - 1;
            var dest = start2 + length2 - 1;
            var customCursor = 0;
            var customDest = 0;
            array[dest--] = array[cursor1--];
            if (--length1 === 0) {
                customCursor = dest - (length2 - 1);
                for (i = 0; i < length2; i++) {
                    array[customCursor + i] = tmp[i];
                }
                return;
            }
            if (length2 === 1) {
                dest -= length1;
                cursor1 -= length1;
                customDest = dest + 1;
                customCursor = cursor1 + 1;
                for (i = length1 - 1; i >= 0; i--) {
                    array[customDest + i] = array[customCursor + i];
                }
                array[dest] = tmp[cursor2];
                return;
            }
            var _minGallop = minGallop;
            while (true) {
                var count1 = 0;
                var count2 = 0;
                var exit = false;
                do {
                    if (compare(tmp[cursor2], array[cursor1]) < 0) {
                        array[dest--] = array[cursor1--];
                        count1++;
                        count2 = 0;
                        if (--length1 === 0) {
                            exit = true;
                            break;
                        }
                    } else {
                        array[dest--] = tmp[cursor2--];
                        count2++;
                        count1 = 0;
                        if (--length2 === 1) {
                            exit = true;
                            break;
                        }
                    }
                } while ((count1 | count2) < _minGallop);
                if (exit) {
                    break;
                }
                do {
                    count1 = length1 - gallopRight(tmp[cursor2], array, start1, length1, length1 - 1, compare);
                    if (count1 !== 0) {
                        dest -= count1;
                        cursor1 -= count1;
                        length1 -= count1;
                        customDest = dest + 1;
                        customCursor = cursor1 + 1;
                        for (i = count1 - 1; i >= 0; i--) {
                            array[customDest + i] = array[customCursor + i];
                        }
                        if (length1 === 0) {
                            exit = true;
                            break;
                        }
                    }
                    array[dest--] = tmp[cursor2--];
                    if (--length2 === 1) {
                        exit = true;
                        break;
                    }
                    count2 = length2 - gallopLeft(array[cursor1], tmp, 0, length2, length2 - 1, compare);
                    if (count2 !== 0) {
                        dest -= count2;
                        cursor2 -= count2;
                        length2 -= count2;
                        customDest = dest + 1;
                        customCursor = cursor2 + 1;
                        for (i = 0; i < count2; i++) {
                            array[customDest + i] = tmp[customCursor + i];
                        }
                        if (length2 <= 1) {
                            exit = true;
                            break;
                        }
                    }
                    array[dest--] = array[cursor1--];
                    if (--length1 === 0) {
                        exit = true;
                        break;
                    }
                    _minGallop--;
                } while (count1 >= DEFAULT_MIN_GALLOPING || count2 >= DEFAULT_MIN_GALLOPING);
                if (exit) {
                    break;
                }
                if (_minGallop < 0) {
                    _minGallop = 0;
                }
                _minGallop += 2;
            }
            minGallop = _minGallop;
            if (minGallop < 1) {
                minGallop = 1;
            }
            if (length2 === 1) {
                dest -= length1;
                cursor1 -= length1;
                customDest = dest + 1;
                customCursor = cursor1 + 1;
                for (i = length1 - 1; i >= 0; i--) {
                    array[customDest + i] = array[customCursor + i];
                }
                array[dest] = tmp[cursor2];
            } else if (length2 === 0) {
                throw new Error();    // throw new Error('mergeHigh preconditions were not respected');
            } else {
                customCursor = dest - (length2 - 1);
                for (i = 0; i < length2; i++) {
                    array[customCursor + i] = tmp[i];
                }
            }
        }
        this.mergeRuns = mergeRuns;
        this.forceMergeRuns = forceMergeRuns;
        this.pushRun = pushRun;
    }
    function sort(array, compare, lo, hi) {
        if (!lo) {
            lo = 0;
        }
        if (!hi) {
            hi = array.length;
        }
        var remaining = hi - lo;
        if (remaining < 2) {
            return;
        }
        var runLength = 0;
        if (remaining < DEFAULT_MIN_MERGE) {
            runLength = makeAscendingRun(array, lo, hi, compare);
            binaryInsertionSort(array, lo, hi, lo + runLength, compare);
            return;
        }
        var ts = new TimSort(array, compare);
        var minRun = minRunLength(remaining);
        do {
            runLength = makeAscendingRun(array, lo, hi, compare);
            if (runLength < minRun) {
                var force = remaining;
                if (force > minRun) {
                    force = minRun;
                }
                binaryInsertionSort(array, lo, lo + force, lo + runLength, compare);
                runLength = force;
            }
            ts.pushRun(lo, runLength);
            ts.mergeRuns();
            remaining -= runLength;
            lo += runLength;
        } while (remaining !== 0);
        ts.forceMergeRuns();
    }
    return sort;
});
define('echarts/visual/seriesColor', ['require', 'zrender/graphic/Gradient'], function (require) {
    var Gradient = require('zrender/graphic/Gradient');
    return function (ecModel) {
        function encodeColor(seriesModel) {
            var colorAccessPath = (seriesModel.visualColorAccessPath || 'itemStyle.normal.color').split('.');
            var data = seriesModel.getData();
            var color = seriesModel.get(colorAccessPath) || seriesModel.getColorFromPalette(seriesModel.get('name'));
            // Default color
            // FIXME Set color function or use the platte color
            data.setVisual('color', color);
            // Only visible series has each data be visual encoded
            if (!ecModel.isSeriesFiltered(seriesModel)) {
                if (typeof color === 'function' && !(color instanceof Gradient)) {
                    data.each(function (idx) {
                        data.setItemVisual(idx, 'color', color(seriesModel.getDataParams(idx)));
                    });
                }
                // itemStyle in each data item
                data.each(function (idx) {
                    var itemModel = data.getItemModel(idx);
                    var color = itemModel.get(colorAccessPath, true);
                    if (color != null) {
                        data.setItemVisual(idx, 'color', color);
                    }
                });
            }
        }
        ecModel.eachRawSeries(encodeColor);
    };
});
define('echarts/preprocessor/backwardCompat', ['require', 'zrender/core/util', './helper/compatStyle'], function (require) {
    var zrUtil = require('zrender/core/util');
    var compatStyle = require('./helper/compatStyle');
    function get(opt, path) {
        path = path.split(',');
        var obj = opt;
        for (var i = 0; i < path.length; i++) {
            obj = obj && obj[path[i]];
            if (obj == null) {
                break;
            }
        }
        return obj;
    }
    function set(opt, path, val, overwrite) {
        path = path.split(',');
        var obj = opt;
        var key;
        for (var i = 0; i < path.length - 1; i++) {
            key = path[i];
            if (obj[key] == null) {
                obj[key] = {};
            }
            obj = obj[key];
        }
        if (overwrite || obj[path[i]] == null) {
            obj[path[i]] = val;
        }
    }
    function compatLayoutProperties(option) {
        each(LAYOUT_PROPERTIES, function (prop) {
            if (prop[0] in option && !(prop[1] in option)) {
                option[prop[1]] = option[prop[0]];
            }
        });
    }
    var LAYOUT_PROPERTIES = [
            [
                'x',
                'left'
            ],
            [
                'y',
                'top'
            ],
            [
                'x2',
                'right'
            ],
            [
                'y2',
                'bottom'
            ]
        ];
    var COMPATITABLE_COMPONENTS = [
            'grid',
            'geo',
            'parallel',
            'legend',
            'toolbox',
            'title',
            'visualMap',
            'dataZoom',
            'timeline'
        ];
    var COMPATITABLE_SERIES = [
            'bar',
            'boxplot',
            'candlestick',
            'chord',
            'effectScatter',
            'funnel',
            'gauge',
            'lines',
            'graph',
            'heatmap',
            'line',
            'map',
            'parallel',
            'pie',
            'radar',
            'sankey',
            'scatter',
            'treemap'
        ];
    var each = zrUtil.each;
    return function (option) {
        each(option.series, function (seriesOpt) {
            if (!zrUtil.isObject(seriesOpt)) {
                return;
            }
            var seriesType = seriesOpt.type;
            compatStyle(seriesOpt);
            if (seriesType === 'pie' || seriesType === 'gauge') {
                if (seriesOpt.clockWise != null) {
                    seriesOpt.clockwise = seriesOpt.clockWise;
                }
            }
            if (seriesType === 'gauge') {
                var pointerColor = get(seriesOpt, 'pointer.color');
                pointerColor != null && set(seriesOpt, 'itemStyle.normal.color', pointerColor);
            }
            for (var i = 0; i < COMPATITABLE_SERIES.length; i++) {
                if (COMPATITABLE_SERIES[i] === seriesOpt.type) {
                    compatLayoutProperties(seriesOpt);
                    break;
                }
            }
        });
        // dataRange has changed to visualMap
        if (option.dataRange) {
            option.visualMap = option.dataRange;
        }
        each(COMPATITABLE_COMPONENTS, function (componentName) {
            var options = option[componentName];
            if (options) {
                if (!zrUtil.isArray(options)) {
                    options = [options];
                }
                each(options, function (option) {
                    compatLayoutProperties(option);
                });
            }
        });
    };
});
define('echarts/loading/default', ['require', '../util/graphic', 'zrender/core/util'], function (require) {
    var graphic = require('../util/graphic');
    var zrUtil = require('zrender/core/util');
    var PI = Math.PI;
    /**
     * @param {module:echarts/ExtensionAPI} api
     * @param {Object} [opts]
     * @param {string} [opts.text]
     * @param {string} [opts.color]
     * @param {string} [opts.textColor]
     * @return {module:zrender/Element}
     */
    return function (api, opts) {
        opts = opts || {};
        zrUtil.defaults(opts, {
            text: 'loading',
            color: '#c23531',
            textColor: '#000',
            maskColor: 'rgba(255, 255, 255, 0.8)',
            zlevel: 0
        });
        var mask = new graphic.Rect({
                style: { fill: opts.maskColor },
                zlevel: opts.zlevel,
                z: 10000
            });
        var arc = new graphic.Arc({
                shape: {
                    startAngle: -PI / 2,
                    endAngle: -PI / 2 + 0.1,
                    r: 10
                },
                style: {
                    stroke: opts.color,
                    lineCap: 'round',
                    lineWidth: 5
                },
                zlevel: opts.zlevel,
                z: 10001
            });
        var labelRect = new graphic.Rect({
                style: {
                    fill: 'none',
                    text: opts.text,
                    textPosition: 'right',
                    textDistance: 10,
                    textFill: opts.textColor
                },
                zlevel: opts.zlevel,
                z: 10001
            });
        arc.animateShape(true).when(1000, { endAngle: PI * 3 / 2 }).start('circularInOut');
        arc.animateShape(true).when(1000, { startAngle: PI * 3 / 2 }).delay(300).start('circularInOut');
        var group = new graphic.Group();
        group.add(arc);
        group.add(labelRect);
        group.add(mask);
        // Inject resize
        group.resize = function () {
            var cx = api.getWidth() / 2;
            var cy = api.getHeight() / 2;
            arc.setShape({
                cx: cx,
                cy: cy
            });
            var r = arc.shape.r;
            labelRect.setShape({
                x: cx - r,
                y: cy - r,
                width: r * 2,
                height: r * 2
            });
            mask.setShape({
                x: 0,
                y: 0,
                width: api.getWidth(),
                height: api.getHeight()
            });
        };
        group.resize();
        return group;
    };
});
define('echarts/data/List', ['require', '../model/Model', './DataDiffer', 'zrender/core/util', '../util/model'], function (require) {
    var UNDEFINED = 'undefined';
    var globalObj = typeof window === 'undefined' ? global : window;
    var Float64Array = typeof globalObj.Float64Array === UNDEFINED ? Array : globalObj.Float64Array;
    var Int32Array = typeof globalObj.Int32Array === UNDEFINED ? Array : globalObj.Int32Array;
    var dataCtors = {
            'float': Float64Array,
            'int': Int32Array,
            'ordinal': Array,
            'number': Array,
            'time': Array
        };
    var Model = require('../model/Model');
    var DataDiffer = require('./DataDiffer');
    var zrUtil = require('zrender/core/util');
    var modelUtil = require('../util/model');
    var isObject = zrUtil.isObject;
    var TRANSFERABLE_PROPERTIES = [
            'stackedOn',
            'hasItemOption',
            '_nameList',
            '_idList',
            '_rawData'
        ];
    var transferProperties = function (a, b) {
        zrUtil.each(TRANSFERABLE_PROPERTIES.concat(b.__wrappedMethods || []), function (propName) {
            if (b.hasOwnProperty(propName)) {
                a[propName] = b[propName];
            }
        });
        a.__wrappedMethods = b.__wrappedMethods;
    };
    /**
     * @constructor
     * @alias module:echarts/data/List
     *
     * @param {Array.<string>} dimensions
     *        Dimensions should be concrete names like x, y, z, lng, lat, angle, radius
     * @param {module:echarts/model/Model} hostModel
     */
    var List = function (dimensions, hostModel) {
        dimensions = dimensions || [
            'x',
            'y'
        ];
        var dimensionInfos = {};
        var dimensionNames = [];
        for (var i = 0; i < dimensions.length; i++) {
            var dimensionName;
            var dimensionInfo = {};
            if (typeof dimensions[i] === 'string') {
                dimensionName = dimensions[i];
                dimensionInfo = {
                    name: dimensionName,
                    stackable: false,
                    type: 'number'
                };
            } else {
                dimensionInfo = dimensions[i];
                dimensionName = dimensionInfo.name;
                dimensionInfo.type = dimensionInfo.type || 'number';
            }
            dimensionNames.push(dimensionName);
            dimensionInfos[dimensionName] = dimensionInfo;
        }
        /**
         * @readOnly
         * @type {Array.<string>}
         */
        this.dimensions = dimensionNames;
        /**
         * Infomation of each data dimension, like data type.
         * @type {Object}
         */
        this._dimensionInfos = dimensionInfos;
        /**
         * @type {module:echarts/model/Model}
         */
        this.hostModel = hostModel;
        /**
         * @type {module:echarts/model/Model}
         */
        this.dataType;
        /**
         * Indices stores the indices of data subset after filtered.
         * This data subset will be used in chart.
         * @type {Array.<number>}
         * @readOnly
         */
        this.indices = [];
        /**
         * Data storage
         * @type {Object.<key, TypedArray|Array>}
         * @private
         */
        this._storage = {};
        /**
         * @type {Array.<string>}
         */
        this._nameList = [];
        /**
         * @type {Array.<string>}
         */
        this._idList = [];
        /**
         * Models of data option is stored sparse for optimizing memory cost
         * @type {Array.<module:echarts/model/Model>}
         * @private
         */
        this._optionModels = [];
        /**
         * @param {module:echarts/data/List}
         */
        this.stackedOn = null;
        /**
         * Global visual properties after visual coding
         * @type {Object}
         * @private
         */
        this._visual = {};
        /**
         * Globel layout properties.
         * @type {Object}
         * @private
         */
        this._layout = {};
        /**
         * Item visual properties after visual coding
         * @type {Array.<Object>}
         * @private
         */
        this._itemVisuals = [];
        /**
         * Item layout properties after layout
         * @type {Array.<Object>}
         * @private
         */
        this._itemLayouts = [];
        /**
         * Graphic elemnents
         * @type {Array.<module:zrender/Element>}
         * @private
         */
        this._graphicEls = [];
        /**
         * @type {Array.<Array|Object>}
         * @private
         */
        this._rawData;
        /**
         * @type {Object}
         * @private
         */
        this._extent;
    };
    var listProto = List.prototype;
    listProto.type = 'list';
    /**
     * If each data item has it's own option
     * @type {boolean}
     */
    listProto.hasItemOption = true;
    /**
     * Get dimension name
     * @param {string|number} dim
     *        Dimension can be concrete names like x, y, z, lng, lat, angle, radius
     *        Or a ordinal number. For example getDimensionInfo(0) will return 'x' or 'lng' or 'radius'
     * @return {string} Concrete dim name.
     */
    listProto.getDimension = function (dim) {
        if (!isNaN(dim)) {
            dim = this.dimensions[dim] || dim;
        }
        return dim;
    };
    /**
     * Get type and stackable info of particular dimension
     * @param {string|number} dim
     *        Dimension can be concrete names like x, y, z, lng, lat, angle, radius
     *        Or a ordinal number. For example getDimensionInfo(0) will return 'x' or 'lng' or 'radius'
     */
    listProto.getDimensionInfo = function (dim) {
        return zrUtil.clone(this._dimensionInfos[this.getDimension(dim)]);
    };
    /**
     * Initialize from data
     * @param {Array.<Object|number|Array>} data
     * @param {Array.<string>} [nameList]
     * @param {Function} [dimValueGetter] (dataItem, dimName, dataIndex, dimIndex) => number
     */
    listProto.initData = function (data, nameList, dimValueGetter) {
        data = data || [];
        if (true) {
            if (!zrUtil.isArray(data)) {
                throw new Error('Invalid data.');
            }
        }
        this._rawData = data;
        // Clear
        var storage = this._storage = {};
        var indices = this.indices = [];
        var dimensions = this.dimensions;
        var size = data.length;
        var dimensionInfoMap = this._dimensionInfos;
        var idList = [];
        var nameRepeatCount = {};
        nameList = nameList || [];
        // Init storage
        for (var i = 0; i < dimensions.length; i++) {
            var dimInfo = dimensionInfoMap[dimensions[i]];
            var DataCtor = dataCtors[dimInfo.type];
            storage[dimensions[i]] = new DataCtor(size);
        }
        var self = this;
        if (!dimValueGetter) {
            self.hasItemOption = false;
        }
        // Default dim value getter
        dimValueGetter = dimValueGetter || function (dataItem, dimName, dataIndex, dimIndex) {
            var value = modelUtil.getDataItemValue(dataItem);
            // If any dataItem is like { value: 10 }
            if (modelUtil.isDataItemOption(dataItem)) {
                self.hasItemOption = true;
            }
            return modelUtil.converDataValue(value instanceof Array ? value[dimIndex] : value, dimensionInfoMap[dimName]);
        };
        for (var idx = 0; idx < data.length; idx++) {
            var dataItem = data[idx];
            // Each data item is value
            // [1, 2]
            // 2
            // Bar chart, line chart which uses category axis
            // only gives the 'y' value. 'x' value is the indices of cateogry
            // Use a tempValue to normalize the value to be a (x, y) value
            // Store the data by dimensions
            for (var k = 0; k < dimensions.length; k++) {
                var dim = dimensions[k];
                var dimStorage = storage[dim];
                // PENDING NULL is empty or zero
                dimStorage[idx] = dimValueGetter(dataItem, dim, idx, k);
            }
            indices.push(idx);
        }
        // Use the name in option and create id
        for (var i = 0; i < data.length; i++) {
            if (!nameList[i]) {
                if (data[i] && data[i].name != null) {
                    nameList[i] = data[i].name;
                }
            }
            var name = nameList[i] || '';
            // Try using the id in option
            var id = data[i] && data[i].id;
            if (!id && name) {
                // Use name as id and add counter to avoid same name
                nameRepeatCount[name] = nameRepeatCount[name] || 0;
                id = name;
                if (nameRepeatCount[name] > 0) {
                    id += '__ec__' + nameRepeatCount[name];
                }
                nameRepeatCount[name]++;
            }
            id && (idList[i] = id);
        }
        this._nameList = nameList;
        this._idList = idList;
    };
    /**
     * @return {number}
     */
    listProto.count = function () {
        return this.indices.length;
    };
    /**
     * Get value. Return NaN if idx is out of range.
     * @param {string} dim Dim must be concrete name.
     * @param {number} idx
     * @param {boolean} stack
     * @return {number}
     */
    listProto.get = function (dim, idx, stack) {
        var storage = this._storage;
        var dataIndex = this.indices[idx];
        // If value not exists
        if (dataIndex == null) {
            return NaN;
        }
        var value = storage[dim] && storage[dim][dataIndex];
        // FIXME ordinal data type is not stackable
        if (stack) {
            var dimensionInfo = this._dimensionInfos[dim];
            if (dimensionInfo && dimensionInfo.stackable) {
                var stackedOn = this.stackedOn;
                while (stackedOn) {
                    // Get no stacked data of stacked on
                    var stackedValue = stackedOn.get(dim, idx);
                    // Considering positive stack, negative stack and empty data
                    if (value >= 0 && stackedValue > 0 || value <= 0 && stackedValue < 0) {
                        value += stackedValue;
                    }
                    stackedOn = stackedOn.stackedOn;
                }
            }
        }
        return value;
    };
    /**
     * Get value for multi dimensions.
     * @param {Array.<string>} [dimensions] If ignored, using all dimensions.
     * @param {number} idx
     * @param {boolean} stack
     * @return {number}
     */
    listProto.getValues = function (dimensions, idx, stack) {
        var values = [];
        if (!zrUtil.isArray(dimensions)) {
            stack = idx;
            idx = dimensions;
            dimensions = this.dimensions;
        }
        for (var i = 0, len = dimensions.length; i < len; i++) {
            values.push(this.get(dimensions[i], idx, stack));
        }
        return values;
    };
    /**
     * If value is NaN. Inlcuding '-'
     * @param {string} dim
     * @param {number} idx
     * @return {number}
     */
    listProto.hasValue = function (idx) {
        var dimensions = this.dimensions;
        var dimensionInfos = this._dimensionInfos;
        for (var i = 0, len = dimensions.length; i < len; i++) {
            if (dimensionInfos[dimensions[i]].type !== 'ordinal' && isNaN(this.get(dimensions[i], idx))) {
                return false;
            }
        }
        return true;
    };
    /**
     * Get extent of data in one dimension
     * @param {string} dim
     * @param {boolean} stack
     */
    listProto.getDataExtent = function (dim, stack) {
        dim = this.getDimension(dim);
        var dimData = this._storage[dim];
        var dimInfo = this.getDimensionInfo(dim);
        stack = dimInfo && dimInfo.stackable && stack;
        var dimExtent = (this._extent || (this._extent = {}))[dim + !!stack];
        var value;
        if (dimExtent) {
            return dimExtent;
        }
        // var dimInfo = this._dimensionInfos[dim];
        if (dimData) {
            var min = Infinity;
            var max = -Infinity;
            // var isOrdinal = dimInfo.type === 'ordinal';
            for (var i = 0, len = this.count(); i < len; i++) {
                value = this.get(dim, i, stack);
                // FIXME
                // if (isOrdinal && typeof value === 'string') {
                //     value = zrUtil.indexOf(dimData, value);
                // }
                value < min && (min = value);
                value > max && (max = value);
            }
            return this._extent[dim + !!stack] = [
                min,
                max
            ];
        } else {
            return [
                Infinity,
                -Infinity
            ];
        }
    };
    /**
     * Get sum of data in one dimension
     * @param {string} dim
     * @param {boolean} stack
     */
    listProto.getSum = function (dim, stack) {
        var dimData = this._storage[dim];
        var sum = 0;
        if (dimData) {
            for (var i = 0, len = this.count(); i < len; i++) {
                var value = this.get(dim, i, stack);
                if (!isNaN(value)) {
                    sum += value;
                }
            }
        }
        return sum;
    };
    /**
     * Retreive the index with given value
     * @param {number} idx
     * @param {number} value
     * @return {number}
     */
    // FIXME Precision of float value
    listProto.indexOf = function (dim, value) {
        var storage = this._storage;
        var dimData = storage[dim];
        var indices = this.indices;
        if (dimData) {
            for (var i = 0, len = indices.length; i < len; i++) {
                var rawIndex = indices[i];
                if (dimData[rawIndex] === value) {
                    return i;
                }
            }
        }
        return -1;
    };
    /**
     * Retreive the index with given name
     * @param {number} idx
     * @param {number} name
     * @return {number}
     */
    listProto.indexOfName = function (name) {
        var indices = this.indices;
        var nameList = this._nameList;
        for (var i = 0, len = indices.length; i < len; i++) {
            var rawIndex = indices[i];
            if (nameList[rawIndex] === name) {
                return i;
            }
        }
        return -1;
    };
    /**
     * Retreive the index with given raw data index
     * @param {number} idx
     * @param {number} name
     * @return {number}
     */
    listProto.indexOfRawIndex = function (rawIndex) {
        // Indices are ascending
        var indices = this.indices;
        // If rawIndex === dataIndex
        var rawDataIndex = indices[rawIndex];
        if (rawDataIndex != null && rawDataIndex === rawIndex) {
            return rawIndex;
        }
        var left = 0;
        var right = indices.length - 1;
        while (left <= right) {
            var mid = (left + right) / 2 | 0;
            if (indices[mid] < rawIndex) {
                left = mid + 1;
            } else if (indices[mid] > rawIndex) {
                right = mid - 1;
            } else {
                return mid;
            }
        }
        return -1;
    };
    /**
     * Retreive the index of nearest value
     * @param {string} dim
     * @param {number} value
     * @param {boolean} stack If given value is after stacked
     * @param {number} [maxDistance=Infinity]
     * @return {number}
     */
    listProto.indexOfNearest = function (dim, value, stack, maxDistance) {
        var storage = this._storage;
        var dimData = storage[dim];
        if (maxDistance == null) {
            maxDistance = Infinity;
        }
        var nearestIdx = -1;
        if (dimData) {
            var minDist = Number.MAX_VALUE;
            for (var i = 0, len = this.count(); i < len; i++) {
                var diff = value - this.get(dim, i, stack);
                var dist = Math.abs(diff);
                if (diff <= maxDistance && (dist < minDist || dist === minDist && diff > 0)) {
                    minDist = dist;
                    nearestIdx = i;
                }
            }
        }
        return nearestIdx;
    };
    /**
     * Get raw data index
     * @param {number} idx
     * @return {number}
     */
    listProto.getRawIndex = function (idx) {
        var rawIdx = this.indices[idx];
        return rawIdx == null ? -1 : rawIdx;
    };
    /**
     * Get raw data item
     * @param {number} idx
     * @return {number}
     */
    listProto.getRawDataItem = function (idx) {
        return this._rawData[this.getRawIndex(idx)];
    };
    /**
     * @param {number} idx
     * @param {boolean} [notDefaultIdx=false]
     * @return {string}
     */
    listProto.getName = function (idx) {
        return this._nameList[this.indices[idx]] || '';
    };
    /**
     * @param {number} idx
     * @param {boolean} [notDefaultIdx=false]
     * @return {string}
     */
    listProto.getId = function (idx) {
        return this._idList[this.indices[idx]] || this.getRawIndex(idx) + '';
    };
    function normalizeDimensions(dimensions) {
        if (!zrUtil.isArray(dimensions)) {
            dimensions = [dimensions];
        }
        return dimensions;
    }
    /**
     * Data iteration
     * @param {string|Array.<string>}
     * @param {Function} cb
     * @param {boolean} [stack=false]
     * @param {*} [context=this]
     *
     * @example
     *  list.each('x', function (x, idx) {});
     *  list.each(['x', 'y'], function (x, y, idx) {});
     *  list.each(function (idx) {})
     */
    listProto.each = function (dims, cb, stack, context) {
        if (typeof dims === 'function') {
            context = stack;
            stack = cb;
            cb = dims;
            dims = [];
        }
        dims = zrUtil.map(normalizeDimensions(dims), this.getDimension, this);
        var value = [];
        var dimSize = dims.length;
        var indices = this.indices;
        context = context || this;
        for (var i = 0; i < indices.length; i++) {
            // Simple optimization
            switch (dimSize) {
            case 0:
                cb.call(context, i);
                break;
            case 1:
                cb.call(context, this.get(dims[0], i, stack), i);
                break;
            case 2:
                cb.call(context, this.get(dims[0], i, stack), this.get(dims[1], i, stack), i);
                break;
            default:
                for (var k = 0; k < dimSize; k++) {
                    value[k] = this.get(dims[k], i, stack);
                }
                // Index
                value[k] = i;
                cb.apply(context, value);
            }
        }
    };
    /**
     * Data filter
     * @param {string|Array.<string>}
     * @param {Function} cb
     * @param {boolean} [stack=false]
     * @param {*} [context=this]
     */
    listProto.filterSelf = function (dimensions, cb, stack, context) {
        if (typeof dimensions === 'function') {
            context = stack;
            stack = cb;
            cb = dimensions;
            dimensions = [];
        }
        dimensions = zrUtil.map(normalizeDimensions(dimensions), this.getDimension, this);
        var newIndices = [];
        var value = [];
        var dimSize = dimensions.length;
        var indices = this.indices;
        context = context || this;
        for (var i = 0; i < indices.length; i++) {
            var keep;
            // Simple optimization
            if (dimSize === 1) {
                keep = cb.call(context, this.get(dimensions[0], i, stack), i);
            } else {
                for (var k = 0; k < dimSize; k++) {
                    value[k] = this.get(dimensions[k], i, stack);
                }
                value[k] = i;
                keep = cb.apply(context, value);
            }
            if (keep) {
                newIndices.push(indices[i]);
            }
        }
        this.indices = newIndices;
        // Reset data extent
        this._extent = {};
        return this;
    };
    /**
     * Data mapping to a plain array
     * @param {string|Array.<string>} [dimensions]
     * @param {Function} cb
     * @param {boolean} [stack=false]
     * @param {*} [context=this]
     * @return {Array}
     */
    listProto.mapArray = function (dimensions, cb, stack, context) {
        if (typeof dimensions === 'function') {
            context = stack;
            stack = cb;
            cb = dimensions;
            dimensions = [];
        }
        var result = [];
        this.each(dimensions, function () {
            result.push(cb && cb.apply(this, arguments));
        }, stack, context);
        return result;
    };
    function cloneListForMapAndSample(original, excludeDimensions) {
        var allDimensions = original.dimensions;
        var list = new List(zrUtil.map(allDimensions, original.getDimensionInfo, original), original.hostModel);
        // FIXME If needs stackedOn, value may already been stacked
        transferProperties(list, original);
        var storage = list._storage = {};
        var originalStorage = original._storage;
        // Init storage
        for (var i = 0; i < allDimensions.length; i++) {
            var dim = allDimensions[i];
            var dimStore = originalStorage[dim];
            if (zrUtil.indexOf(excludeDimensions, dim) >= 0) {
                storage[dim] = new dimStore.constructor(originalStorage[dim].length);
            } else {
                // Direct reference for other dimensions
                storage[dim] = originalStorage[dim];
            }
        }
        return list;
    }
    /**
     * Data mapping to a new List with given dimensions
     * @param {string|Array.<string>} dimensions
     * @param {Function} cb
     * @param {boolean} [stack=false]
     * @param {*} [context=this]
     * @return {Array}
     */
    listProto.map = function (dimensions, cb, stack, context) {
        dimensions = zrUtil.map(normalizeDimensions(dimensions), this.getDimension, this);
        var list = cloneListForMapAndSample(this, dimensions);
        // Following properties are all immutable.
        // So we can reference to the same value
        var indices = list.indices = this.indices;
        var storage = list._storage;
        var tmpRetValue = [];
        this.each(dimensions, function () {
            var idx = arguments[arguments.length - 1];
            var retValue = cb && cb.apply(this, arguments);
            if (retValue != null) {
                // a number
                if (typeof retValue === 'number') {
                    tmpRetValue[0] = retValue;
                    retValue = tmpRetValue;
                }
                for (var i = 0; i < retValue.length; i++) {
                    var dim = dimensions[i];
                    var dimStore = storage[dim];
                    var rawIdx = indices[idx];
                    if (dimStore) {
                        dimStore[rawIdx] = retValue[i];
                    }
                }
            }
        }, stack, context);
        return list;
    };
    /**
     * Large data down sampling on given dimension
     * @param {string} dimension
     * @param {number} rate
     * @param {Function} sampleValue
     * @param {Function} sampleIndex Sample index for name and id
     */
    listProto.downSample = function (dimension, rate, sampleValue, sampleIndex) {
        var list = cloneListForMapAndSample(this, [dimension]);
        var storage = this._storage;
        var targetStorage = list._storage;
        var originalIndices = this.indices;
        var indices = list.indices = [];
        var frameValues = [];
        var frameIndices = [];
        var frameSize = Math.floor(1 / rate);
        var dimStore = targetStorage[dimension];
        var len = this.count();
        // Copy data from original data
        for (var i = 0; i < storage[dimension].length; i++) {
            targetStorage[dimension][i] = storage[dimension][i];
        }
        for (var i = 0; i < len; i += frameSize) {
            // Last frame
            if (frameSize > len - i) {
                frameSize = len - i;
                frameValues.length = frameSize;
            }
            for (var k = 0; k < frameSize; k++) {
                var idx = originalIndices[i + k];
                frameValues[k] = dimStore[idx];
                frameIndices[k] = idx;
            }
            var value = sampleValue(frameValues);
            var idx = frameIndices[sampleIndex(frameValues, value) || 0];
            // Only write value on the filtered data
            dimStore[idx] = value;
            indices.push(idx);
        }
        return list;
    };
    /**
     * Get model of one data item.
     *
     * @param {number} idx
     */
    // FIXME Model proxy ?
    listProto.getItemModel = function (idx) {
        var hostModel = this.hostModel;
        idx = this.indices[idx];
        return new Model(this._rawData[idx], hostModel, hostModel && hostModel.ecModel);
    };
    /**
     * Create a data differ
     * @param {module:echarts/data/List} otherList
     * @return {module:echarts/data/DataDiffer}
     */
    listProto.diff = function (otherList) {
        var idList = this._idList;
        var otherIdList = otherList && otherList._idList;
        var val;
        // Use prefix to avoid index to be the same as otherIdList[idx],
        // which will cause weird udpate animation.
        var prefix = 'e  ';
        return new DataDiffer(otherList ? otherList.indices : [], this.indices, function (idx) {
            return (val = otherIdList[idx]) != null ? val : prefix + idx;
        }, function (idx) {
            return (val = idList[idx]) != null ? val : prefix + idx;
        });
    };
    /**
     * Get visual property.
     * @param {string} key
     */
    listProto.getVisual = function (key) {
        var visual = this._visual;
        return visual && visual[key];
    };
    /**
     * Set visual property
     * @param {string|Object} key
     * @param {*} [value]
     *
     * @example
     *  setVisual('color', color);
     *  setVisual({
     *      'color': color
     *  });
     */
    listProto.setVisual = function (key, val) {
        if (isObject(key)) {
            for (var name in key) {
                if (key.hasOwnProperty(name)) {
                    this.setVisual(name, key[name]);
                }
            }
            return;
        }
        this._visual = this._visual || {};
        this._visual[key] = val;
    };
    /**
     * Set layout property.
     * @param {string} key
     * @param {*} [val]
     */
    listProto.setLayout = function (key, val) {
        if (isObject(key)) {
            for (var name in key) {
                if (key.hasOwnProperty(name)) {
                    this.setLayout(name, key[name]);
                }
            }
            return;
        }
        this._layout[key] = val;
    };
    /**
     * Get layout property.
     * @param  {string} key.
     * @return {*}
     */
    listProto.getLayout = function (key) {
        return this._layout[key];
    };
    /**
     * Get layout of single data item
     * @param {number} idx
     */
    listProto.getItemLayout = function (idx) {
        return this._itemLayouts[idx];
    };
    /**
     * Set layout of single data item
     * @param {number} idx
     * @param {Object} layout
     * @param {boolean=} [merge=false]
     */
    listProto.setItemLayout = function (idx, layout, merge) {
        this._itemLayouts[idx] = merge ? zrUtil.extend(this._itemLayouts[idx] || {}, layout) : layout;
    };
    /**
     * Clear all layout of single data item
     */
    listProto.clearItemLayouts = function () {
        this._itemLayouts.length = 0;
    };
    /**
     * Get visual property of single data item
     * @param {number} idx
     * @param {string} key
     * @param {boolean} ignoreParent
     */
    listProto.getItemVisual = function (idx, key, ignoreParent) {
        var itemVisual = this._itemVisuals[idx];
        var val = itemVisual && itemVisual[key];
        if (val == null && !ignoreParent) {
            // Use global visual property
            return this.getVisual(key);
        }
        return val;
    };
    /**
     * Set visual property of single data item
     *
     * @param {number} idx
     * @param {string|Object} key
     * @param {*} [value]
     *
     * @example
     *  setItemVisual(0, 'color', color);
     *  setItemVisual(0, {
     *      'color': color
     *  });
     */
    listProto.setItemVisual = function (idx, key, value) {
        var itemVisual = this._itemVisuals[idx] || {};
        this._itemVisuals[idx] = itemVisual;
        if (isObject(key)) {
            for (var name in key) {
                if (key.hasOwnProperty(name)) {
                    itemVisual[name] = key[name];
                }
            }
            return;
        }
        itemVisual[key] = value;
    };
    /**
     * Clear itemVisuals and list visual.
     */
    listProto.clearAllVisual = function () {
        this._visual = {};
        this._itemVisuals = [];
    };
    var setItemDataAndSeriesIndex = function (child) {
        child.seriesIndex = this.seriesIndex;
        child.dataIndex = this.dataIndex;
        child.dataType = this.dataType;
    };
    /**
     * Set graphic element relative to data. It can be set as null
     * @param {number} idx
     * @param {module:zrender/Element} [el]
     */
    listProto.setItemGraphicEl = function (idx, el) {
        var hostModel = this.hostModel;
        if (el) {
            // Add data index and series index for indexing the data by element
            // Useful in tooltip
            el.dataIndex = idx;
            el.dataType = this.dataType;
            el.seriesIndex = hostModel && hostModel.seriesIndex;
            if (el.type === 'group') {
                el.traverse(setItemDataAndSeriesIndex, el);
            }
        }
        this._graphicEls[idx] = el;
    };
    /**
     * @param {number} idx
     * @return {module:zrender/Element}
     */
    listProto.getItemGraphicEl = function (idx) {
        return this._graphicEls[idx];
    };
    /**
     * @param {Function} cb
     * @param {*} context
     */
    listProto.eachItemGraphicEl = function (cb, context) {
        zrUtil.each(this._graphicEls, function (el, idx) {
            if (el) {
                cb && cb.call(context, el, idx);
            }
        });
    };
    /**
     * Shallow clone a new list except visual and layout properties, and graph elements.
     * New list only change the indices.
     */
    listProto.cloneShallow = function () {
        var dimensionInfoList = zrUtil.map(this.dimensions, this.getDimensionInfo, this);
        var list = new List(dimensionInfoList, this.hostModel);
        // FIXME
        list._storage = this._storage;
        transferProperties(list, this);
        // Clone will not change the data extent and indices
        list.indices = this.indices.slice();
        if (this._extent) {
            list._extent = zrUtil.extend({}, this._extent);
        }
        return list;
    };
    /**
     * Wrap some method to add more feature
     * @param {string} methodName
     * @param {Function} injectFunction
     */
    listProto.wrapMethod = function (methodName, injectFunction) {
        var originalMethod = this[methodName];
        if (typeof originalMethod !== 'function') {
            return;
        }
        this.__wrappedMethods = this.__wrappedMethods || [];
        this.__wrappedMethods.push(methodName);
        this[methodName] = function () {
            var res = originalMethod.apply(this, arguments);
            return injectFunction.apply(this, [res].concat(zrUtil.slice(arguments)));
        };
    };
    // Methods that create a new list based on this list should be listed here.
    // Notice that those method should `RETURN` the new list.
    listProto.TRANSFERABLE_METHODS = [
        'cloneShallow',
        'downSample',
        'map'
    ];
    // Methods that change indices of this list should be listed here.
    listProto.CHANGABLE_METHODS = ['filterSelf'];
    return List;
});
define('echarts/model/Model', ['require', 'zrender/core/util', '../util/clazz', './mixin/lineStyle', './mixin/areaStyle', './mixin/textStyle', './mixin/itemStyle'], function (require) {
    var zrUtil = require('zrender/core/util');
    var clazzUtil = require('../util/clazz');
    /**
     * @alias module:echarts/model/Model
     * @constructor
     * @param {Object} option
     * @param {module:echarts/model/Model} [parentModel]
     * @param {module:echarts/model/Global} [ecModel]
     */
    function Model(option, parentModel, ecModel) {
        /**
         * @type {module:echarts/model/Model}
         * @readOnly
         */
        this.parentModel = parentModel;
        /**
         * @type {module:echarts/model/Global}
         * @readOnly
         */
        this.ecModel = ecModel;
        /**
         * @type {Object}
         * @protected
         */
        this.option = option;    // Simple optimization
                                 // if (this.init) {
                                 //     if (arguments.length <= 4) {
                                 //         this.init(option, parentModel, ecModel, extraOpt);
                                 //     }
                                 //     else {
                                 //         this.init.apply(this, arguments);
                                 //     }
                                 // }
    }
    Model.prototype = {
        constructor: Model,
        init: null,
        mergeOption: function (option) {
            zrUtil.merge(this.option, option, true);
        },
        get: function (path, ignoreParent) {
            if (!path) {
                return this.option;
            }
            if (typeof path === 'string') {
                path = path.split('.');
            }
            var obj = this.option;
            var parentModel = this.parentModel;
            for (var i = 0; i < path.length; i++) {
                // Ignore empty
                if (!path[i]) {
                    continue;
                }
                // obj could be number/string/... (like 0)
                obj = obj && typeof obj === 'object' ? obj[path[i]] : null;
                if (obj == null) {
                    break;
                }
            }
            if (obj == null && parentModel && !ignoreParent) {
                obj = parentModel.get(path);
            }
            return obj;
        },
        getShallow: function (key, ignoreParent) {
            var option = this.option;
            var val = option == null ? option : option[key];
            var parentModel = this.parentModel;
            if (val == null && parentModel && !ignoreParent) {
                val = parentModel.getShallow(key);
            }
            return val;
        },
        getModel: function (path, parentModel) {
            var obj = this.get(path, true);
            var thisParentModel = this.parentModel;
            var model = new Model(obj, parentModel || thisParentModel && thisParentModel.getModel(path), this.ecModel);
            return model;
        },
        isEmpty: function () {
            return this.option == null;
        },
        restoreData: function () {
        },
        clone: function () {
            var Ctor = this.constructor;
            return new Ctor(zrUtil.clone(this.option));
        },
        setReadOnly: function (properties) {
            clazzUtil.setReadOnly(this, properties);
        }
    };
    // Enable Model.extend.
    clazzUtil.enableClassExtend(Model);
    var mixin = zrUtil.mixin;
    mixin(Model, require('./mixin/lineStyle'));
    mixin(Model, require('./mixin/areaStyle'));
    mixin(Model, require('./mixin/textStyle'));
    mixin(Model, require('./mixin/itemStyle'));
    return Model;
});
define('echarts/util/number', ['require'], function (require) {
    var number = {};
    var RADIAN_EPSILON = 0.0001;
    function _trim(str) {
        return str.replace(/^\s+/, '').replace(/\s+$/, '');
    }
    /**
     * Linear mapping a value from domain to range
     * @memberOf module:echarts/util/number
     * @param  {(number|Array.<number>)} val
     * @param  {Array.<number>} domain Domain extent domain[0] can be bigger than domain[1]
     * @param  {Array.<number>} range  Range extent range[0] can be bigger than range[1]
     * @param  {boolean} clamp
     * @return {(number|Array.<number>}
     */
    number.linearMap = function (val, domain, range, clamp) {
        var subDomain = domain[1] - domain[0];
        var subRange = range[1] - range[0];
        if (subDomain === 0) {
            return subRange === 0 ? range[0] : (range[0] + range[1]) / 2;
        }
        // Avoid accuracy problem in edge, such as
        // 146.39 - 62.83 === 83.55999999999999.
        // See echarts/test/ut/spec/util/number.js#linearMap#accuracyError
        // It is a little verbose for efficiency considering this method
        // is a hotspot.
        if (clamp) {
            if (subDomain > 0) {
                if (val <= domain[0]) {
                    return range[0];
                } else if (val >= domain[1]) {
                    return range[1];
                }
            } else {
                if (val >= domain[0]) {
                    return range[0];
                } else if (val <= domain[1]) {
                    return range[1];
                }
            }
        } else {
            if (val === domain[0]) {
                return range[0];
            }
            if (val === domain[1]) {
                return range[1];
            }
        }
        return (val - domain[0]) / subDomain * subRange + range[0];
    };
    /**
     * Convert a percent string to absolute number.
     * Returns NaN if percent is not a valid string or number
     * @memberOf module:echarts/util/number
     * @param {string|number} percent
     * @param {number} all
     * @return {number}
     */
    number.parsePercent = function (percent, all) {
        switch (percent) {
        case 'center':
        case 'middle':
            percent = '50%';
            break;
        case 'left':
        case 'top':
            percent = '0%';
            break;
        case 'right':
        case 'bottom':
            percent = '100%';
            break;
        }
        if (typeof percent === 'string') {
            if (_trim(percent).match(/%$/)) {
                return parseFloat(percent) / 100 * all;
            }
            return parseFloat(percent);
        }
        return percent == null ? NaN : +percent;
    };
    /**
     * Fix rounding error of float numbers
     * @param {number} x
     * @return {number}
     */
    number.round = function (x, precision) {
        if (precision == null) {
            precision = 10;
        }
        // Avoid range error
        precision = Math.min(Math.max(0, precision), 20);
        return +(+x).toFixed(precision);
    };
    number.asc = function (arr) {
        arr.sort(function (a, b) {
            return a - b;
        });
        return arr;
    };
    /**
     * Get precision
     * @param {number} val
     */
    number.getPrecision = function (val) {
        val = +val;
        if (isNaN(val)) {
            return 0;
        }
        // It is much faster than methods converting number to string as follows
        //      var tmp = val.toString();
        //      return tmp.length - 1 - tmp.indexOf('.');
        // especially when precision is low
        var e = 1;
        var count = 0;
        while (Math.round(val * e) / e !== val) {
            e *= 10;
            count++;
        }
        return count;
    };
    number.getPrecisionSafe = function (val) {
        var str = val.toString();
        var dotIndex = str.indexOf('.');
        if (dotIndex < 0) {
            return 0;
        }
        return str.length - 1 - dotIndex;
    };
    /**
     * @param {Array.<number>} dataExtent
     * @param {Array.<number>} pixelExtent
     * @return {number}  precision
     */
    number.getPixelPrecision = function (dataExtent, pixelExtent) {
        var log = Math.log;
        var LN10 = Math.LN10;
        var dataQuantity = Math.floor(log(dataExtent[1] - dataExtent[0]) / LN10);
        var sizeQuantity = Math.round(log(Math.abs(pixelExtent[1] - pixelExtent[0])) / LN10);
        return Math.max(-dataQuantity + sizeQuantity, 0);
    };
    // Number.MAX_SAFE_INTEGER, ie do not support.
    number.MAX_SAFE_INTEGER = 9007199254740991;
    /**
     * To 0 - 2 * PI, considering negative radian.
     * @param {number} radian
     * @return {number}
     */
    number.remRadian = function (radian) {
        var pi2 = Math.PI * 2;
        return (radian % pi2 + pi2) % pi2;
    };
    /**
     * @param {type} radian
     * @return {boolean}
     */
    number.isRadianAroundZero = function (val) {
        return val > -RADIAN_EPSILON && val < RADIAN_EPSILON;
    };
    /**
     * @param {string|Date|number} value
     * @return {Date} date
     */
    number.parseDate = function (value) {
        if (value instanceof Date) {
            return value;
        } else if (typeof value === 'string') {
            // Treat as ISO format. See issue #3623
            var ret = new Date(value);
            if (isNaN(+ret)) {
                // FIXME new Date('1970-01-01') is UTC, new Date('1970/01/01') is local
                ret = new Date(new Date(value.replace(/-/g, '/')) - new Date('1970/01/01'));
            }
            return ret;
        }
        return new Date(Math.round(value));
    };
    /**
     * Quantity of a number. e.g. 0.1, 1, 10, 100
     * @param  {number} val
     * @return {number}
     */
    number.quantity = function (val) {
        return Math.pow(10, Math.floor(Math.log(val) / Math.LN10));
    };
    // "Nice Numbers for Graph Labels" of Graphic Gems
    /**
     * find a “nice” number approximately equal to x. Round the number if round = true, take ceiling if round = false
     * The primary observation is that the “nicest” numbers in decimal are 1, 2, and 5, and all power-of-ten multiples of these numbers.
     * @param  {number} val
     * @param  {boolean} round
     * @return {number}
     */
    number.nice = function (val, round) {
        var exp10 = number.quantity(val);
        var f = val / exp10;
        // between 1 and 10
        var nf;
        if (round) {
            if (f < 1.5) {
                nf = 1;
            } else if (f < 2.5) {
                nf = 2;
            } else if (f < 4) {
                nf = 3;
            } else if (f < 7) {
                nf = 5;
            } else {
                nf = 10;
            }
        } else {
            if (f < 1) {
                nf = 1;
            } else if (f < 2) {
                nf = 2;
            } else if (f < 3) {
                nf = 3;
            } else if (f < 5) {
                nf = 5;
            } else {
                nf = 10;
            }
        }
        return nf * exp10;
    };
    /**
     * Order intervals asc, and split them when overlap.
     * expect(numberUtil.reformIntervals([
     *     {interval: [18, 62], close: [1, 1]},
     *     {interval: [-Infinity, -70], close: [0, 0]},
     *     {interval: [-70, -26], close: [1, 1]},
     *     {interval: [-26, 18], close: [1, 1]},
     *     {interval: [62, 150], close: [1, 1]},
     *     {interval: [106, 150], close: [1, 1]},
     *     {interval: [150, Infinity], close: [0, 0]}
     * ])).toEqual([
     *     {interval: [-Infinity, -70], close: [0, 0]},
     *     {interval: [-70, -26], close: [1, 1]},
     *     {interval: [-26, 18], close: [0, 1]},
     *     {interval: [18, 62], close: [0, 1]},
     *     {interval: [62, 150], close: [0, 1]},
     *     {interval: [150, Infinity], close: [0, 0]}
     * ]);
     * @param {Array.<Object>} list, where `close` mean open or close
     *        of the interval, and Infinity can be used.
     * @return {Array.<Object>} The origin list, which has been reformed.
     */
    number.reformIntervals = function (list) {
        list.sort(function (a, b) {
            return littleThan(a, b, 0) ? -1 : 1;
        });
        var curr = -Infinity;
        var currClose = 1;
        for (var i = 0; i < list.length;) {
            var interval = list[i].interval;
            var close = list[i].close;
            for (var lg = 0; lg < 2; lg++) {
                if (interval[lg] <= curr) {
                    interval[lg] = curr;
                    close[lg] = !lg ? 1 - currClose : 1;
                }
                curr = interval[lg];
                currClose = close[lg];
            }
            if (interval[0] === interval[1] && close[0] * close[1] !== 1) {
                list.splice(i, 1);
            } else {
                i++;
            }
        }
        return list;
        function littleThan(a, b, lg) {
            return a.interval[lg] < b.interval[lg] || a.interval[lg] === b.interval[lg] && (a.close[lg] - b.close[lg] === (!lg ? 1 : -1) || !lg && littleThan(a, b, 1));
        }
    };
    return number;
});
define('echarts/util/format', ['require', 'zrender/core/util', './number', 'zrender/contain/text'], function (require) {
    var zrUtil = require('zrender/core/util');
    var numberUtil = require('./number');
    var textContain = require('zrender/contain/text');
    var formatUtil = {};
    /**
     * 每三位默认加,格式化
     * @type {string|number} x
     */
    formatUtil.addCommas = function (x) {
        if (isNaN(x)) {
            return '-';
        }
        x = (x + '').split('.');
        return x[0].replace(/(\d{1,3})(?=(?:\d{3})+(?!\d))/g, '$1,') + (x.length > 1 ? '.' + x[1] : '');
    };
    /**
     * @param {string} str
     * @param {boolean} [upperCaseFirst=false]
     * @return {string} str
     */
    formatUtil.toCamelCase = function (str, upperCaseFirst) {
        str = (str || '').toLowerCase().replace(/-(.)/g, function (match, group1) {
            return group1.toUpperCase();
        });
        if (upperCaseFirst && str) {
            str = str.charAt(0).toUpperCase() + str.slice(1);
        }
        return str;
    };
    /**
     * Normalize css liked array configuration
     * e.g.
     *  3 => [3, 3, 3, 3]
     *  [4, 2] => [4, 2, 4, 2]
     *  [4, 3, 2] => [4, 3, 2, 3]
     * @param {number|Array.<number>} val
     */
    formatUtil.normalizeCssArray = function (val) {
        var len = val.length;
        if (typeof val === 'number') {
            return [
                val,
                val,
                val,
                val
            ];
        } else if (len === 2) {
            // vertical | horizontal
            return [
                val[0],
                val[1],
                val[0],
                val[1]
            ];
        } else if (len === 3) {
            // top | horizontal | bottom
            return [
                val[0],
                val[1],
                val[2],
                val[1]
            ];
        }
        return val;
    };
    formatUtil.encodeHTML = function (source) {
        return String(source).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#39;');
    };
    var TPL_VAR_ALIAS = [
            'a',
            'b',
            'c',
            'd',
            'e',
            'f',
            'g'
        ];
    var wrapVar = function (varName, seriesIdx) {
        return '{' + varName + (seriesIdx == null ? '' : seriesIdx) + '}';
    };
    /**
     * Template formatter
     * @param  {string} tpl
     * @param  {Array.<Object>|Object} paramsList
     * @return {string}
     */
    formatUtil.formatTpl = function (tpl, paramsList) {
        if (!zrUtil.isArray(paramsList)) {
            paramsList = [paramsList];
        }
        var seriesLen = paramsList.length;
        if (!seriesLen) {
            return '';
        }
        var $vars = paramsList[0].$vars || [];
        for (var i = 0; i < $vars.length; i++) {
            var alias = TPL_VAR_ALIAS[i];
            tpl = tpl.replace(wrapVar(alias), wrapVar(alias, 0));
        }
        for (var seriesIdx = 0; seriesIdx < seriesLen; seriesIdx++) {
            for (var k = 0; k < $vars.length; k++) {
                tpl = tpl.replace(wrapVar(TPL_VAR_ALIAS[k], seriesIdx), paramsList[seriesIdx][$vars[k]]);
            }
        }
        return tpl;
    };
    /**
     * @param {string} str
     * @return {string}
     * @inner
     */
    var s2d = function (str) {
        return str < 10 ? '0' + str : str;
    };
    /**
     * ISO Date format
     * @param {string} tpl
     * @param {number} value
     * @inner
     */
    formatUtil.formatTime = function (tpl, value) {
        if (tpl === 'week' || tpl === 'month' || tpl === 'quarter' || tpl === 'half-year' || tpl === 'year') {
            tpl = 'MM-dd\nyyyy';
        }
        var date = numberUtil.parseDate(value);
        var y = date.getFullYear();
        var M = date.getMonth() + 1;
        var d = date.getDate();
        var h = date.getHours();
        var m = date.getMinutes();
        var s = date.getSeconds();
        tpl = tpl.replace('MM', s2d(M)).toLowerCase().replace('yyyy', y).replace('yy', y % 100).replace('dd', s2d(d)).replace('d', d).replace('hh', s2d(h)).replace('h', h).replace('mm', s2d(m)).replace('m', m).replace('ss', s2d(s)).replace('s', s);
        return tpl;
    };
    /**
     * Capital first
     * @param {string} str
     * @return {string}
     */
    formatUtil.capitalFirst = function (str) {
        return str ? str.charAt(0).toUpperCase() + str.substr(1) : str;
    };
    formatUtil.truncateText = textContain.truncateText;
    return formatUtil;
});
define('zrender/core/matrix', [], function () {
    var ArrayCtor = typeof Float32Array === 'undefined' ? Array : Float32Array;
    /**
     * 3x2矩阵操作类
     * @exports zrender/tool/matrix
     */
    var matrix = {
            create: function () {
                var out = new ArrayCtor(6);
                matrix.identity(out);
                return out;
            },
            identity: function (out) {
                out[0] = 1;
                out[1] = 0;
                out[2] = 0;
                out[3] = 1;
                out[4] = 0;
                out[5] = 0;
                return out;
            },
            copy: function (out, m) {
                out[0] = m[0];
                out[1] = m[1];
                out[2] = m[2];
                out[3] = m[3];
                out[4] = m[4];
                out[5] = m[5];
                return out;
            },
            mul: function (out, m1, m2) {
                // Consider matrix.mul(m, m2, m);
                // where out is the same as m2.
                // So use temp variable to escape error.
                var out0 = m1[0] * m2[0] + m1[2] * m2[1];
                var out1 = m1[1] * m2[0] + m1[3] * m2[1];
                var out2 = m1[0] * m2[2] + m1[2] * m2[3];
                var out3 = m1[1] * m2[2] + m1[3] * m2[3];
                var out4 = m1[0] * m2[4] + m1[2] * m2[5] + m1[4];
                var out5 = m1[1] * m2[4] + m1[3] * m2[5] + m1[5];
                out[0] = out0;
                out[1] = out1;
                out[2] = out2;
                out[3] = out3;
                out[4] = out4;
                out[5] = out5;
                return out;
            },
            translate: function (out, a, v) {
                out[0] = a[0];
                out[1] = a[1];
                out[2] = a[2];
                out[3] = a[3];
                out[4] = a[4] + v[0];
                out[5] = a[5] + v[1];
                return out;
            },
            rotate: function (out, a, rad) {
                var aa = a[0];
                var ac = a[2];
                var atx = a[4];
                var ab = a[1];
                var ad = a[3];
                var aty = a[5];
                var st = Math.sin(rad);
                var ct = Math.cos(rad);
                out[0] = aa * ct + ab * st;
                out[1] = -aa * st + ab * ct;
                out[2] = ac * ct + ad * st;
                out[3] = -ac * st + ct * ad;
                out[4] = ct * atx + st * aty;
                out[5] = ct * aty - st * atx;
                return out;
            },
            scale: function (out, a, v) {
                var vx = v[0];
                var vy = v[1];
                out[0] = a[0] * vx;
                out[1] = a[1] * vy;
                out[2] = a[2] * vx;
                out[3] = a[3] * vy;
                out[4] = a[4] * vx;
                out[5] = a[5] * vy;
                return out;
            },
            invert: function (out, a) {
                var aa = a[0];
                var ac = a[2];
                var atx = a[4];
                var ab = a[1];
                var ad = a[3];
                var aty = a[5];
                var det = aa * ad - ab * ac;
                if (!det) {
                    return null;
                }
                det = 1 / det;
                out[0] = ad * det;
                out[1] = -ab * det;
                out[2] = -ac * det;
                out[3] = aa * det;
                out[4] = (ac * aty - ad * atx) * det;
                out[5] = (ab * atx - aa * aty) * det;
                return out;
            }
        };
    return matrix;
});
define('zrender/core/vector', [], function () {
    var ArrayCtor = typeof Float32Array === 'undefined' ? Array : Float32Array;
    /**
     * @typedef {Float32Array|Array.<number>} Vector2
     */
    /**
     * 二维向量类
     * @exports zrender/tool/vector
     */
    var vector = {
            create: function (x, y) {
                var out = new ArrayCtor(2);
                if (x == null) {
                    x = 0;
                }
                if (y == null) {
                    y = 0;
                }
                out[0] = x;
                out[1] = y;
                return out;
            },
            copy: function (out, v) {
                out[0] = v[0];
                out[1] = v[1];
                return out;
            },
            clone: function (v) {
                var out = new ArrayCtor(2);
                out[0] = v[0];
                out[1] = v[1];
                return out;
            },
            set: function (out, a, b) {
                out[0] = a;
                out[1] = b;
                return out;
            },
            add: function (out, v1, v2) {
                out[0] = v1[0] + v2[0];
                out[1] = v1[1] + v2[1];
                return out;
            },
            scaleAndAdd: function (out, v1, v2, a) {
                out[0] = v1[0] + v2[0] * a;
                out[1] = v1[1] + v2[1] * a;
                return out;
            },
            sub: function (out, v1, v2) {
                out[0] = v1[0] - v2[0];
                out[1] = v1[1] - v2[1];
                return out;
            },
            len: function (v) {
                return Math.sqrt(this.lenSquare(v));
            },
            lenSquare: function (v) {
                return v[0] * v[0] + v[1] * v[1];
            },
            mul: function (out, v1, v2) {
                out[0] = v1[0] * v2[0];
                out[1] = v1[1] * v2[1];
                return out;
            },
            div: function (out, v1, v2) {
                out[0] = v1[0] / v2[0];
                out[1] = v1[1] / v2[1];
                return out;
            },
            dot: function (v1, v2) {
                return v1[0] * v2[0] + v1[1] * v2[1];
            },
            scale: function (out, v, s) {
                out[0] = v[0] * s;
                out[1] = v[1] * s;
                return out;
            },
            normalize: function (out, v) {
                var d = vector.len(v);
                if (d === 0) {
                    out[0] = 0;
                    out[1] = 0;
                } else {
                    out[0] = v[0] / d;
                    out[1] = v[1] / d;
                }
                return out;
            },
            distance: function (v1, v2) {
                return Math.sqrt((v1[0] - v2[0]) * (v1[0] - v2[0]) + (v1[1] - v2[1]) * (v1[1] - v2[1]));
            },
            distanceSquare: function (v1, v2) {
                return (v1[0] - v2[0]) * (v1[0] - v2[0]) + (v1[1] - v2[1]) * (v1[1] - v2[1]);
            },
            negate: function (out, v) {
                out[0] = -v[0];
                out[1] = -v[1];
                return out;
            },
            lerp: function (out, v1, v2, t) {
                out[0] = v1[0] + t * (v2[0] - v1[0]);
                out[1] = v1[1] + t * (v2[1] - v1[1]);
                return out;
            },
            applyTransform: function (out, v, m) {
                var x = v[0];
                var y = v[1];
                out[0] = m[0] * x + m[2] * y + m[4];
                out[1] = m[1] * x + m[3] * y + m[5];
                return out;
            },
            min: function (out, v1, v2) {
                out[0] = Math.min(v1[0], v2[0]);
                out[1] = Math.min(v1[1], v2[1]);
                return out;
            },
            max: function (out, v1, v2) {
                out[0] = Math.max(v1[0], v2[0]);
                out[1] = Math.max(v1[1], v2[1]);
                return out;
            }
        };
    vector.length = vector.len;
    vector.lengthSquare = vector.lenSquare;
    vector.dist = vector.distance;
    vector.distSquare = vector.distanceSquare;
    return vector;
});
define('echarts/coord/cartesian/Grid', ['require', 'exports', '../../util/layout', '../../coord/axisHelper', 'zrender/core/util', './Cartesian2D', './Axis2D', './GridModel', '../../CoordinateSystem'], function (require, factory) {
    var layout = require('../../util/layout');
    var axisHelper = require('../../coord/axisHelper');
    var zrUtil = require('zrender/core/util');
    var Cartesian2D = require('./Cartesian2D');
    var Axis2D = require('./Axis2D');
    var each = zrUtil.each;
    var ifAxisCrossZero = axisHelper.ifAxisCrossZero;
    var niceScaleExtent = axisHelper.niceScaleExtent;
    // 依赖 GridModel, AxisModel 做预处理
    require('./GridModel');
    /**
     * Check if the axis is used in the specified grid
     * @inner
     */
    function isAxisUsedInTheGrid(axisModel, gridModel, ecModel) {
        return axisModel.findGridModel() === gridModel;
    }
    function getLabelUnionRect(axis) {
        var axisModel = axis.model;
        var labels = axisModel.getFormattedLabels();
        var textStyleModel = axisModel.getModel('axisLabel.textStyle');
        var rect;
        var step = 1;
        var labelCount = labels.length;
        if (labelCount > 40) {
            // Simple optimization for large amount of labels
            step = Math.ceil(labelCount / 40);
        }
        for (var i = 0; i < labelCount; i += step) {
            if (!axis.isLabelIgnored(i)) {
                var singleRect = textStyleModel.getTextRect(labels[i]);
                // FIXME consider label rotate
                rect ? rect.union(singleRect) : rect = singleRect;
            }
        }
        return rect;
    }
    function Grid(gridModel, ecModel, api) {
        /**
         * @type {Object.<string, module:echarts/coord/cartesian/Cartesian2D>}
         * @private
         */
        this._coordsMap = {};
        /**
         * @type {Array.<module:echarts/coord/cartesian/Cartesian>}
         * @private
         */
        this._coordsList = [];
        /**
         * @type {Object.<string, module:echarts/coord/cartesian/Axis2D>}
         * @private
         */
        this._axesMap = {};
        /**
         * @type {Array.<module:echarts/coord/cartesian/Axis2D>}
         * @private
         */
        this._axesList = [];
        this._initCartesian(gridModel, ecModel, api);
        this._model = gridModel;
    }
    var gridProto = Grid.prototype;
    gridProto.type = 'grid';
    gridProto.getRect = function () {
        return this._rect;
    };
    gridProto.update = function (ecModel, api) {
        var axesMap = this._axesMap;
        this._updateScale(ecModel, this._model);
        function ifAxisCanNotOnZero(otherAxisDim) {
            var axes = axesMap[otherAxisDim];
            for (var idx in axes) {
                if (axes.hasOwnProperty(idx)) {
                    var axis = axes[idx];
                    if (axis && (axis.type === 'category' || !ifAxisCrossZero(axis))) {
                        return true;
                    }
                }
            }
            return false;
        }
        each(axesMap.x, function (xAxis) {
            niceScaleExtent(xAxis, xAxis.model);
        });
        each(axesMap.y, function (yAxis) {
            niceScaleExtent(yAxis, yAxis.model);
        });
        // Fix configuration
        each(axesMap.x, function (xAxis) {
            // onZero can not be enabled in these two situations
            // 1. When any other axis is a category axis
            // 2. When any other axis not across 0 point
            if (ifAxisCanNotOnZero('y')) {
                xAxis.onZero = false;
            }
        });
        each(axesMap.y, function (yAxis) {
            if (ifAxisCanNotOnZero('x')) {
                yAxis.onZero = false;
            }
        });
        // Resize again if containLabel is enabled
        // FIXME It may cause getting wrong grid size in data processing stage
        this.resize(this._model, api);
    };
    /**
     * Resize the grid
     * @param {module:echarts/coord/cartesian/GridModel} gridModel
     * @param {module:echarts/ExtensionAPI} api
     */
    gridProto.resize = function (gridModel, api) {
        var gridRect = layout.getLayoutRect(gridModel.getBoxLayoutParams(), {
                width: api.getWidth(),
                height: api.getHeight()
            });
        this._rect = gridRect;
        var axesList = this._axesList;
        adjustAxes();
        // Minus label size
        if (gridModel.get('containLabel')) {
            each(axesList, function (axis) {
                if (!axis.model.get('axisLabel.inside')) {
                    var labelUnionRect = getLabelUnionRect(axis);
                    if (labelUnionRect) {
                        var dim = axis.isHorizontal() ? 'height' : 'width';
                        var margin = axis.model.get('axisLabel.margin');
                        gridRect[dim] -= labelUnionRect[dim] + margin;
                        if (axis.position === 'top') {
                            gridRect.y += labelUnionRect.height + margin;
                        } else if (axis.position === 'left') {
                            gridRect.x += labelUnionRect.width + margin;
                        }
                    }
                }
            });
            adjustAxes();
        }
        function adjustAxes() {
            each(axesList, function (axis) {
                var isHorizontal = axis.isHorizontal();
                var extent = isHorizontal ? [
                        0,
                        gridRect.width
                    ] : [
                        0,
                        gridRect.height
                    ];
                var idx = axis.inverse ? 1 : 0;
                axis.setExtent(extent[idx], extent[1 - idx]);
                updateAxisTransfrom(axis, isHorizontal ? gridRect.x : gridRect.y);
            });
        }
    };
    /**
     * @param {string} axisType
     * @param {ndumber} [axisIndex]
     */
    gridProto.getAxis = function (axisType, axisIndex) {
        var axesMapOnDim = this._axesMap[axisType];
        if (axesMapOnDim != null) {
            if (axisIndex == null) {
                // Find first axis
                for (var name in axesMapOnDim) {
                    if (axesMapOnDim.hasOwnProperty(name)) {
                        return axesMapOnDim[name];
                    }
                }
            }
            return axesMapOnDim[axisIndex];
        }
    };
    gridProto.getCartesian = function (xAxisIndex, yAxisIndex) {
        if (xAxisIndex != null && yAxisIndex != null) {
            var key = 'x' + xAxisIndex + 'y' + yAxisIndex;
            return this._coordsMap[key];
        } else {
            // When only xAxisIndex or yAxisIndex given, find its first cartesian.
            for (var i = 0, coordList = this._coordsList; i < coordList.length; i++) {
                if (coordList[i].getAxis('x').index === xAxisIndex || coordList[i].getAxis('y').index === yAxisIndex) {
                    return coordList[i];
                }
            }
        }
    };
    /**
     * @implements
     * see {module:echarts/CoodinateSystem}
     */
    gridProto.convertToPixel = function (ecModel, finder, value) {
        var target = this._findConvertTarget(ecModel, finder);
        return target.cartesian ? target.cartesian.dataToPoint(value) : target.axis ? target.axis.toGlobalCoord(target.axis.dataToCoord(value)) : null;
    };
    /**
     * @implements
     * see {module:echarts/CoodinateSystem}
     */
    gridProto.convertFromPixel = function (ecModel, finder, value) {
        var target = this._findConvertTarget(ecModel, finder);
        return target.cartesian ? target.cartesian.pointToData(value) : target.axis ? target.axis.coordToData(target.axis.toLocalCoord(value)) : null;
    };
    /**
     * @inner
     */
    gridProto._findConvertTarget = function (ecModel, finder) {
        var seriesModel = finder.seriesModel;
        var xAxisModel = finder.xAxisModel || seriesModel && seriesModel.getReferringComponents('xAxis')[0];
        var yAxisModel = finder.yAxisModel || seriesModel && seriesModel.getReferringComponents('yAxis')[0];
        var gridModel = finder.gridModel;
        var coordsList = this._coordsList;
        var cartesian;
        var axis;
        if (seriesModel) {
            cartesian = seriesModel.coordinateSystem;
            zrUtil.indexOf(coordsList, cartesian) < 0 && (cartesian = null);
        } else if (xAxisModel && yAxisModel) {
            cartesian = this.getCartesian(xAxisModel.componentIndex, yAxisModel.componentIndex);
        } else if (xAxisModel) {
            axis = this.getAxis('x', xAxisModel.componentIndex);
        } else if (yAxisModel) {
            axis = this.getAxis('y', yAxisModel.componentIndex);
        }    // Lowest priority.
        else if (gridModel) {
            var grid = gridModel.coordinateSystem;
            if (grid === this) {
                cartesian = this._coordsList[0];
            }
        }
        return {
            cartesian: cartesian,
            axis: axis
        };
    };
    /**
     * @implements
     * see {module:echarts/CoodinateSystem}
     */
    gridProto.containPoint = function (point) {
        var coord = this._coordsList[0];
        if (coord) {
            return coord.containPoint(point);
        }
    };
    /**
     * Initialize cartesian coordinate systems
     * @private
     */
    gridProto._initCartesian = function (gridModel, ecModel, api) {
        var axisPositionUsed = {
                left: false,
                right: false,
                top: false,
                bottom: false
            };
        var axesMap = {
                x: {},
                y: {}
            };
        var axesCount = {
                x: 0,
                y: 0
            };
        /// Create axis
        ecModel.eachComponent('xAxis', createAxisCreator('x'), this);
        ecModel.eachComponent('yAxis', createAxisCreator('y'), this);
        if (!axesCount.x || !axesCount.y) {
            // Roll back when there no either x or y axis
            this._axesMap = {};
            this._axesList = [];
            return;
        }
        this._axesMap = axesMap;
        /// Create cartesian2d
        each(axesMap.x, function (xAxis, xAxisIndex) {
            each(axesMap.y, function (yAxis, yAxisIndex) {
                var key = 'x' + xAxisIndex + 'y' + yAxisIndex;
                var cartesian = new Cartesian2D(key);
                cartesian.grid = this;
                this._coordsMap[key] = cartesian;
                this._coordsList.push(cartesian);
                cartesian.addAxis(xAxis);
                cartesian.addAxis(yAxis);
            }, this);
        }, this);
        function createAxisCreator(axisType) {
            return function (axisModel, idx) {
                if (!isAxisUsedInTheGrid(axisModel, gridModel, ecModel)) {
                    return;
                }
                var axisPosition = axisModel.get('position');
                if (axisType === 'x') {
                    // Fix position
                    if (axisPosition !== 'top' && axisPosition !== 'bottom') {
                        // Default bottom of X
                        axisPosition = 'bottom';
                        if (axisPositionUsed[axisPosition]) {
                            axisPosition = axisPosition === 'top' ? 'bottom' : 'top';
                        }
                    }
                } else {
                    // Fix position
                    if (axisPosition !== 'left' && axisPosition !== 'right') {
                        // Default left of Y
                        axisPosition = 'left';
                        if (axisPositionUsed[axisPosition]) {
                            axisPosition = axisPosition === 'left' ? 'right' : 'left';
                        }
                    }
                }
                axisPositionUsed[axisPosition] = true;
                var axis = new Axis2D(axisType, axisHelper.createScaleByModel(axisModel), [
                        0,
                        0
                    ], axisModel.get('type'), axisPosition);
                var isCategory = axis.type === 'category';
                axis.onBand = isCategory && axisModel.get('boundaryGap');
                axis.inverse = axisModel.get('inverse');
                axis.onZero = axisModel.get('axisLine.onZero');
                // Inject axis into axisModel
                axisModel.axis = axis;
                // Inject axisModel into axis
                axis.model = axisModel;
                // Inject grid info axis
                axis.grid = this;
                // Index of axis, can be used as key
                axis.index = idx;
                this._axesList.push(axis);
                axesMap[axisType][idx] = axis;
                axesCount[axisType]++;
            };
        }
    };
    /**
     * Update cartesian properties from series
     * @param  {module:echarts/model/Option} option
     * @private
     */
    gridProto._updateScale = function (ecModel, gridModel) {
        // Reset scale
        zrUtil.each(this._axesList, function (axis) {
            axis.scale.setExtent(Infinity, -Infinity);
        });
        ecModel.eachSeries(function (seriesModel) {
            if (isCartesian2D(seriesModel)) {
                var axesModels = findAxesModels(seriesModel, ecModel);
                var xAxisModel = axesModels[0];
                var yAxisModel = axesModels[1];
                if (!isAxisUsedInTheGrid(xAxisModel, gridModel, ecModel) || !isAxisUsedInTheGrid(yAxisModel, gridModel, ecModel)) {
                    return;
                }
                var cartesian = this.getCartesian(xAxisModel.componentIndex, yAxisModel.componentIndex);
                var data = seriesModel.getData();
                var xAxis = cartesian.getAxis('x');
                var yAxis = cartesian.getAxis('y');
                if (data.type === 'list') {
                    unionExtent(data, xAxis, seriesModel);
                    unionExtent(data, yAxis, seriesModel);
                }
            }
        }, this);
        function unionExtent(data, axis, seriesModel) {
            each(seriesModel.coordDimToDataDim(axis.dim), function (dim) {
                axis.scale.unionExtent(data.getDataExtent(dim, axis.scale.type !== 'ordinal'));
            });
        }
    };
    /**
     * @inner
     */
    function updateAxisTransfrom(axis, coordBase) {
        var axisExtent = axis.getExtent();
        var axisExtentSum = axisExtent[0] + axisExtent[1];
        // Fast transform
        axis.toGlobalCoord = axis.dim === 'x' ? function (coord) {
            return coord + coordBase;
        } : function (coord) {
            return axisExtentSum - coord + coordBase;
        };
        axis.toLocalCoord = axis.dim === 'x' ? function (coord) {
            return coord - coordBase;
        } : function (coord) {
            return axisExtentSum - coord + coordBase;
        };
    }
    var axesTypes = [
            'xAxis',
            'yAxis'
        ];
    /**
     * @inner
     */
    function findAxesModels(seriesModel, ecModel) {
        return zrUtil.map(axesTypes, function (axisType) {
            var axisModel = seriesModel.getReferringComponents(axisType)[0];
            if (true) {
                if (!axisModel) {
                    throw new Error(axisType + ' "' + zrUtil.retrieve(seriesModel.get(axisType + 'Index'), seriesModel.get(axisType + 'Id'), 0) + '" not found');
                }
            }
            return axisModel;
        });
    }
    /**
     * @inner
     */
    function isCartesian2D(seriesModel) {
        return seriesModel.get('coordinateSystem') === 'cartesian2d';
    }
    Grid.create = function (ecModel, api) {
        var grids = [];
        ecModel.eachComponent('grid', function (gridModel, idx) {
            var grid = new Grid(gridModel, ecModel, api);
            grid.name = 'grid_' + idx;
            grid.resize(gridModel, api);
            gridModel.coordinateSystem = grid;
            grids.push(grid);
        });
        // Inject the coordinateSystems into seriesModel
        ecModel.eachSeries(function (seriesModel) {
            if (!isCartesian2D(seriesModel)) {
                return;
            }
            var axesModels = findAxesModels(seriesModel, ecModel);
            var xAxisModel = axesModels[0];
            var yAxisModel = axesModels[1];
            var gridModel = xAxisModel.findGridModel();
            if (true) {
                if (!gridModel) {
                    throw new Error('Grid "' + zrUtil.retrieve(xAxisModel.get('gridIndex'), xAxisModel.get('gridId'), 0) + '" not found');
                }
                if (xAxisModel.findGridModel() !== yAxisModel.findGridModel()) {
                    throw new Error('xAxis and yAxis must use the same grid');
                }
            }
            var grid = gridModel.coordinateSystem;
            seriesModel.coordinateSystem = grid.getCartesian(xAxisModel.componentIndex, yAxisModel.componentIndex);
        });
        return grids;
    };
    // For deciding which dimensions to use when creating list data
    Grid.dimensions = Cartesian2D.prototype.dimensions;
    require('../../CoordinateSystem').register('cartesian2d', Grid);
    return Grid;
});
define('echarts/chart/bar/BarSeries', ['require', '../../model/Series', '../helper/createListFromArray'], function (require) {
    'use strict';
    var SeriesModel = require('../../model/Series');
    var createListFromArray = require('../helper/createListFromArray');
    return SeriesModel.extend({
        type: 'series.bar',
        dependencies: [
            'grid',
            'polar'
        ],
        getInitialData: function (option, ecModel) {
            if (true) {
                var coordSys = option.coordinateSystem;
                if (coordSys !== 'cartesian2d') {
                    throw new Error('Bar only support cartesian2d coordinateSystem');
                }
            }
            return createListFromArray(option.data, this, ecModel);
        },
        getMarkerPosition: function (value) {
            var coordSys = this.coordinateSystem;
            if (coordSys) {
                // PENDING if clamp ?
                var pt = coordSys.dataToPoint(value, true);
                var data = this.getData();
                var offset = data.getLayout('offset');
                var size = data.getLayout('size');
                var offsetIndex = coordSys.getBaseAxis().isHorizontal() ? 0 : 1;
                pt[offsetIndex] += offset + size / 2;
                return pt;
            }
            return [
                NaN,
                NaN
            ];
        },
        brushSelector: 'rect',
        defaultOption: {
            zlevel: 0,
            z: 2,
            coordinateSystem: 'cartesian2d',
            legendHoverLink: true,
            barMinHeight: 0,
            itemStyle: {
                normal: {},
                emphasis: {}
            }
        }
    });
});
define('echarts/chart/bar/BarView', ['require', 'zrender/core/util', '../../util/graphic', '../../model/Model', './barItemStyle', '../../echarts'], function (require) {
    'use strict';
    var zrUtil = require('zrender/core/util');
    var graphic = require('../../util/graphic');
    zrUtil.extend(require('../../model/Model').prototype, require('./barItemStyle'));
    function fixLayoutWithLineWidth(layout, lineWidth) {
        var signX = layout.width > 0 ? 1 : -1;
        var signY = layout.height > 0 ? 1 : -1;
        // In case width or height are too small.
        lineWidth = Math.min(lineWidth, Math.abs(layout.width), Math.abs(layout.height));
        layout.x += signX * lineWidth / 2;
        layout.y += signY * lineWidth / 2;
        layout.width -= signX * lineWidth;
        layout.height -= signY * lineWidth;
    }
    return require('../../echarts').extendChartView({
        type: 'bar',
        render: function (seriesModel, ecModel, api) {
            var coordinateSystemType = seriesModel.get('coordinateSystem');
            if (coordinateSystemType === 'cartesian2d') {
                this._renderOnCartesian(seriesModel, ecModel, api);
            }
            return this.group;
        },
        dispose: zrUtil.noop,
        _renderOnCartesian: function (seriesModel, ecModel, api) {
            var group = this.group;
            var data = seriesModel.getData();
            var oldData = this._data;
            var cartesian = seriesModel.coordinateSystem;
            var baseAxis = cartesian.getBaseAxis();
            var isHorizontal = baseAxis.isHorizontal();
            var enableAnimation = seriesModel.get('animation');
            var barBorderWidthQuery = [
                    'itemStyle',
                    'normal',
                    'barBorderWidth'
                ];
            function createRect(dataIndex, isUpdate) {
                var layout = data.getItemLayout(dataIndex);
                var lineWidth = data.getItemModel(dataIndex).get(barBorderWidthQuery) || 0;
                fixLayoutWithLineWidth(layout, lineWidth);
                var rect = new graphic.Rect({ shape: zrUtil.extend({}, layout) });
                // Animation
                if (enableAnimation) {
                    var rectShape = rect.shape;
                    var animateProperty = isHorizontal ? 'height' : 'width';
                    var animateTarget = {};
                    rectShape[animateProperty] = 0;
                    animateTarget[animateProperty] = layout[animateProperty];
                    graphic[isUpdate ? 'updateProps' : 'initProps'](rect, { shape: animateTarget }, seriesModel, dataIndex);
                }
                return rect;
            }
            data.diff(oldData).add(function (dataIndex) {
                // 空数据
                if (!data.hasValue(dataIndex)) {
                    return;
                }
                var rect = createRect(dataIndex);
                data.setItemGraphicEl(dataIndex, rect);
                group.add(rect);
            }).update(function (newIndex, oldIndex) {
                var rect = oldData.getItemGraphicEl(oldIndex);
                // 空数据
                if (!data.hasValue(newIndex)) {
                    group.remove(rect);
                    return;
                }
                if (!rect) {
                    rect = createRect(newIndex, true);
                }
                var layout = data.getItemLayout(newIndex);
                var lineWidth = data.getItemModel(newIndex).get(barBorderWidthQuery) || 0;
                fixLayoutWithLineWidth(layout, lineWidth);
                graphic.updateProps(rect, { shape: layout }, seriesModel, newIndex);
                data.setItemGraphicEl(newIndex, rect);
                // Add back
                group.add(rect);
            }).remove(function (idx) {
                var rect = oldData.getItemGraphicEl(idx);
                if (rect) {
                    // Not show text when animating
                    rect.style.text = '';
                    graphic.updateProps(rect, { shape: { width: 0 } }, seriesModel, idx, function () {
                        group.remove(rect);
                    });
                }
            }).execute();
            this._updateStyle(seriesModel, data, isHorizontal);
            this._data = data;
        },
        _updateStyle: function (seriesModel, data, isHorizontal) {
            function setLabel(style, model, color, labelText, labelPositionOutside) {
                graphic.setText(style, model, color);
                style.text = labelText;
                if (style.textPosition === 'outside') {
                    style.textPosition = labelPositionOutside;
                }
            }
            data.eachItemGraphicEl(function (rect, idx) {
                var itemModel = data.getItemModel(idx);
                var color = data.getItemVisual(idx, 'color');
                var opacity = data.getItemVisual(idx, 'opacity');
                var layout = data.getItemLayout(idx);
                var itemStyleModel = itemModel.getModel('itemStyle.normal');
                var hoverStyle = itemModel.getModel('itemStyle.emphasis').getBarItemStyle();
                rect.setShape('r', itemStyleModel.get('barBorderRadius') || 0);
                rect.useStyle(zrUtil.defaults({
                    fill: color,
                    opacity: opacity
                }, itemStyleModel.getBarItemStyle()));
                var labelPositionOutside = isHorizontal ? layout.height > 0 ? 'bottom' : 'top' : layout.width > 0 ? 'left' : 'right';
                var labelModel = itemModel.getModel('label.normal');
                var hoverLabelModel = itemModel.getModel('label.emphasis');
                var rectStyle = rect.style;
                if (labelModel.get('show')) {
                    setLabel(rectStyle, labelModel, color, zrUtil.retrieve(seriesModel.getFormattedLabel(idx, 'normal'), seriesModel.getRawValue(idx)), labelPositionOutside);
                } else {
                    rectStyle.text = '';
                }
                if (hoverLabelModel.get('show')) {
                    setLabel(hoverStyle, hoverLabelModel, color, zrUtil.retrieve(seriesModel.getFormattedLabel(idx, 'emphasis'), seriesModel.getRawValue(idx)), labelPositionOutside);
                } else {
                    hoverStyle.text = '';
                }
                graphic.setHoverStyle(rect, hoverStyle);
            });
        },
        remove: function (ecModel, api) {
            var group = this.group;
            if (ecModel.get('animation')) {
                if (this._data) {
                    this._data.eachItemGraphicEl(function (el) {
                        // Not show text when animating
                        el.style.text = '';
                        graphic.updateProps(el, { shape: { width: 0 } }, ecModel, el.dataIndex, function () {
                            group.remove(el);
                        });
                    });
                }
            } else {
                group.removeAll();
            }
        }
    });
});
define('echarts/layout/barGrid', ['require', 'zrender/core/util', '../util/number'], function (require) {
    'use strict';
    var zrUtil = require('zrender/core/util');
    var numberUtil = require('../util/number');
    var parsePercent = numberUtil.parsePercent;
    function getSeriesStackId(seriesModel) {
        return seriesModel.get('stack') || '__ec_stack_' + seriesModel.seriesIndex;
    }
    function getAxisKey(axis) {
        return axis.dim + axis.index;
    }
    function calBarWidthAndOffset(barSeries, api) {
        // Columns info on each category axis. Key is cartesian name
        var columnsMap = {};
        zrUtil.each(barSeries, function (seriesModel, idx) {
            var data = seriesModel.getData();
            var cartesian = seriesModel.coordinateSystem;
            var baseAxis = cartesian.getBaseAxis();
            var axisExtent = baseAxis.getExtent();
            var bandWidth = baseAxis.type === 'category' ? baseAxis.getBandWidth() : Math.abs(axisExtent[1] - axisExtent[0]) / data.count();
            var columnsOnAxis = columnsMap[getAxisKey(baseAxis)] || {
                    bandWidth: bandWidth,
                    remainedWidth: bandWidth,
                    autoWidthCount: 0,
                    categoryGap: '20%',
                    gap: '30%',
                    stacks: {}
                };
            var stacks = columnsOnAxis.stacks;
            columnsMap[getAxisKey(baseAxis)] = columnsOnAxis;
            var stackId = getSeriesStackId(seriesModel);
            if (!stacks[stackId]) {
                columnsOnAxis.autoWidthCount++;
            }
            stacks[stackId] = stacks[stackId] || {
                width: 0,
                maxWidth: 0
            };
            var barWidth = parsePercent(seriesModel.get('barWidth'), bandWidth);
            var barMaxWidth = parsePercent(seriesModel.get('barMaxWidth'), bandWidth);
            var barGap = seriesModel.get('barGap');
            var barCategoryGap = seriesModel.get('barCategoryGap');
            // TODO
            if (barWidth && !stacks[stackId].width) {
                barWidth = Math.min(columnsOnAxis.remainedWidth, barWidth);
                stacks[stackId].width = barWidth;
                columnsOnAxis.remainedWidth -= barWidth;
            }
            barMaxWidth && (stacks[stackId].maxWidth = barMaxWidth);
            barGap != null && (columnsOnAxis.gap = barGap);
            barCategoryGap != null && (columnsOnAxis.categoryGap = barCategoryGap);
        });
        var result = {};
        zrUtil.each(columnsMap, function (columnsOnAxis, coordSysName) {
            result[coordSysName] = {};
            var stacks = columnsOnAxis.stacks;
            var bandWidth = columnsOnAxis.bandWidth;
            var categoryGap = parsePercent(columnsOnAxis.categoryGap, bandWidth);
            var barGapPercent = parsePercent(columnsOnAxis.gap, 1);
            var remainedWidth = columnsOnAxis.remainedWidth;
            var autoWidthCount = columnsOnAxis.autoWidthCount;
            var autoWidth = (remainedWidth - categoryGap) / (autoWidthCount + (autoWidthCount - 1) * barGapPercent);
            autoWidth = Math.max(autoWidth, 0);
            // Find if any auto calculated bar exceeded maxBarWidth
            zrUtil.each(stacks, function (column, stack) {
                var maxWidth = column.maxWidth;
                if (!column.width && maxWidth && maxWidth < autoWidth) {
                    maxWidth = Math.min(maxWidth, remainedWidth);
                    remainedWidth -= maxWidth;
                    column.width = maxWidth;
                    autoWidthCount--;
                }
            });
            // Recalculate width again
            autoWidth = (remainedWidth - categoryGap) / (autoWidthCount + (autoWidthCount - 1) * barGapPercent);
            autoWidth = Math.max(autoWidth, 0);
            var widthSum = 0;
            var lastColumn;
            zrUtil.each(stacks, function (column, idx) {
                if (!column.width) {
                    column.width = autoWidth;
                }
                lastColumn = column;
                widthSum += column.width * (1 + barGapPercent);
            });
            if (lastColumn) {
                widthSum -= lastColumn.width * barGapPercent;
            }
            var offset = -widthSum / 2;
            zrUtil.each(stacks, function (column, stackId) {
                result[coordSysName][stackId] = result[coordSysName][stackId] || {
                    offset: offset,
                    width: column.width
                };
                offset += column.width * (1 + barGapPercent);
            });
        });
        return result;
    }
    /**
     * @param {string} seriesType
     * @param {module:echarts/model/Global} ecModel
     * @param {module:echarts/ExtensionAPI} api
     */
    function barLayoutGrid(seriesType, ecModel, api) {
        var barWidthAndOffset = calBarWidthAndOffset(zrUtil.filter(ecModel.getSeriesByType(seriesType), function (seriesModel) {
                return !ecModel.isSeriesFiltered(seriesModel) && seriesModel.coordinateSystem && seriesModel.coordinateSystem.type === 'cartesian2d';
            }));
        var lastStackCoords = {};
        var lastStackCoordsOrigin = {};
        ecModel.eachSeriesByType(seriesType, function (seriesModel) {
            var data = seriesModel.getData();
            var cartesian = seriesModel.coordinateSystem;
            var baseAxis = cartesian.getBaseAxis();
            var stackId = getSeriesStackId(seriesModel);
            var columnLayoutInfo = barWidthAndOffset[getAxisKey(baseAxis)][stackId];
            var columnOffset = columnLayoutInfo.offset;
            var columnWidth = columnLayoutInfo.width;
            var valueAxis = cartesian.getOtherAxis(baseAxis);
            var barMinHeight = seriesModel.get('barMinHeight') || 0;
            var valueAxisStart = baseAxis.onZero ? valueAxis.toGlobalCoord(valueAxis.dataToCoord(0)) : valueAxis.getGlobalExtent()[0];
            var coords = cartesian.dataToPoints(data, true);
            lastStackCoords[stackId] = lastStackCoords[stackId] || [];
            lastStackCoordsOrigin[stackId] = lastStackCoordsOrigin[stackId] || [];
            // Fix #4243
            data.setLayout({
                offset: columnOffset,
                size: columnWidth
            });
            data.each(valueAxis.dim, function (value, idx) {
                // 空数据
                if (isNaN(value)) {
                    return;
                }
                if (!lastStackCoords[stackId][idx]) {
                    lastStackCoords[stackId][idx] = {
                        p: valueAxisStart,
                        n: valueAxisStart
                    };
                    lastStackCoordsOrigin[stackId][idx] = {
                        p: valueAxisStart,
                        n: valueAxisStart
                    };
                }
                var sign = value >= 0 ? 'p' : 'n';
                var coord = coords[idx];
                var lastCoord = lastStackCoords[stackId][idx][sign];
                var lastCoordOrigin = lastStackCoordsOrigin[stackId][idx][sign];
                var x;
                var y;
                var width;
                var height;
                if (valueAxis.isHorizontal()) {
                    x = lastCoord;
                    y = coord[1] + columnOffset;
                    width = coord[0] - lastCoordOrigin;
                    height = columnWidth;
                    lastStackCoordsOrigin[stackId][idx][sign] += width;
                    if (Math.abs(width) < barMinHeight) {
                        width = (width < 0 ? -1 : 1) * barMinHeight;
                    }
                    lastStackCoords[stackId][idx][sign] += width;
                } else {
                    x = coord[0] + columnOffset;
                    y = lastCoord;
                    width = columnWidth;
                    height = coord[1] - lastCoordOrigin;
                    lastStackCoordsOrigin[stackId][idx][sign] += height;
                    if (Math.abs(height) < barMinHeight) {
                        // Include zero to has a positive bar
                        height = (height <= 0 ? -1 : 1) * barMinHeight;
                    }
                    lastStackCoords[stackId][idx][sign] += height;
                }
                data.setItemLayout(idx, {
                    x: x,
                    y: y,
                    width: width,
                    height: height
                });
            }, true);
        }, this);
    }
    return barLayoutGrid;
});
define('echarts/chart/line/LineSeries', ['require', '../helper/createListFromArray', '../../model/Series'], function (require) {
    'use strict';
    var createListFromArray = require('../helper/createListFromArray');
    var SeriesModel = require('../../model/Series');
    return SeriesModel.extend({
        type: 'series.line',
        dependencies: [
            'grid',
            'polar'
        ],
        getInitialData: function (option, ecModel) {
            if (true) {
                var coordSys = option.coordinateSystem;
                if (coordSys !== 'polar' && coordSys !== 'cartesian2d') {
                    throw new Error('Line not support coordinateSystem besides cartesian and polar');
                }
            }
            return createListFromArray(option.data, this, ecModel);
        },
        defaultOption: {
            zlevel: 0,
            z: 2,
            coordinateSystem: 'cartesian2d',
            legendHoverLink: true,
            hoverAnimation: true,
            clipOverflow: true,
            label: { normal: { position: 'top' } },
            lineStyle: {
                normal: {
                    width: 2,
                    type: 'solid'
                }
            },
            step: false,
            smooth: false,
            smoothMonotone: null,
            symbol: 'emptyCircle',
            symbolSize: 4,
            symbolRotate: null,
            showSymbol: true,
            showAllSymbol: false,
            connectNulls: false,
            sampling: 'none',
            animationEasing: 'linear',
            progressive: 0,
            hoverLayerThreshold: Infinity
        }
    });
});
define('echarts/chart/line/LineView', ['require', 'zrender/core/util', '../helper/SymbolDraw', '../helper/Symbol', './lineAnimationDiff', '../../util/graphic', '../../util/model', './poly', '../../view/Chart'], function (require) {
    'use strict';
    var zrUtil = require('zrender/core/util');
    var SymbolDraw = require('../helper/SymbolDraw');
    var Symbol = require('../helper/Symbol');
    var lineAnimationDiff = require('./lineAnimationDiff');
    var graphic = require('../../util/graphic');
    var modelUtil = require('../../util/model');
    var polyHelper = require('./poly');
    var ChartView = require('../../view/Chart');
    function isPointsSame(points1, points2) {
        if (points1.length !== points2.length) {
            return;
        }
        for (var i = 0; i < points1.length; i++) {
            var p1 = points1[i];
            var p2 = points2[i];
            if (p1[0] !== p2[0] || p1[1] !== p2[1]) {
                return;
            }
        }
        return true;
    }
    function getSmooth(smooth) {
        return typeof smooth === 'number' ? smooth : smooth ? 0.3 : 0;
    }
    function getAxisExtentWithGap(axis) {
        var extent = axis.getGlobalExtent();
        if (axis.onBand) {
            // Remove extra 1px to avoid line miter in clipped edge
            var halfBandWidth = axis.getBandWidth() / 2 - 1;
            var dir = extent[1] > extent[0] ? 1 : -1;
            extent[0] += dir * halfBandWidth;
            extent[1] -= dir * halfBandWidth;
        }
        return extent;
    }
    function sign(val) {
        return val >= 0 ? 1 : -1;
    }
    /**
     * @param {module:echarts/coord/cartesian/Cartesian2D|module:echarts/coord/polar/Polar} coordSys
     * @param {module:echarts/data/List} data
     * @param {Array.<Array.<number>>} points
     * @private
     */
    function getStackedOnPoints(coordSys, data) {
        var baseAxis = coordSys.getBaseAxis();
        var valueAxis = coordSys.getOtherAxis(baseAxis);
        var valueStart = baseAxis.onZero ? 0 : valueAxis.scale.getExtent()[0];
        var valueDim = valueAxis.dim;
        var baseDataOffset = valueDim === 'x' || valueDim === 'radius' ? 1 : 0;
        return data.mapArray([valueDim], function (val, idx) {
            var stackedOnSameSign;
            var stackedOn = data.stackedOn;
            // Find first stacked value with same sign
            while (stackedOn && sign(stackedOn.get(valueDim, idx)) === sign(val)) {
                stackedOnSameSign = stackedOn;
                break;
            }
            var stackedData = [];
            stackedData[baseDataOffset] = data.get(baseAxis.dim, idx);
            stackedData[1 - baseDataOffset] = stackedOnSameSign ? stackedOnSameSign.get(valueDim, idx, true) : valueStart;
            return coordSys.dataToPoint(stackedData);
        }, true);
    }
    function createGridClipShape(cartesian, hasAnimation, seriesModel) {
        var xExtent = getAxisExtentWithGap(cartesian.getAxis('x'));
        var yExtent = getAxisExtentWithGap(cartesian.getAxis('y'));
        var isHorizontal = cartesian.getBaseAxis().isHorizontal();
        var x = Math.min(xExtent[0], xExtent[1]);
        var y = Math.min(yExtent[0], yExtent[1]);
        var width = Math.max(xExtent[0], xExtent[1]) - x;
        var height = Math.max(yExtent[0], yExtent[1]) - y;
        var lineWidth = seriesModel.get('lineStyle.normal.width') || 2;
        // Expand clip shape to avoid clipping when line value exceeds axis
        var expandSize = seriesModel.get('clipOverflow') ? lineWidth / 2 : Math.max(width, height);
        if (isHorizontal) {
            y -= expandSize;
            height += expandSize * 2;
        } else {
            x -= expandSize;
            width += expandSize * 2;
        }
        var clipPath = new graphic.Rect({
                shape: {
                    x: x,
                    y: y,
                    width: width,
                    height: height
                }
            });
        if (hasAnimation) {
            clipPath.shape[isHorizontal ? 'width' : 'height'] = 0;
            graphic.initProps(clipPath, {
                shape: {
                    width: width,
                    height: height
                }
            }, seriesModel);
        }
        return clipPath;
    }
    function createPolarClipShape(polar, hasAnimation, seriesModel) {
        var angleAxis = polar.getAngleAxis();
        var radiusAxis = polar.getRadiusAxis();
        var radiusExtent = radiusAxis.getExtent();
        var angleExtent = angleAxis.getExtent();
        var RADIAN = Math.PI / 180;
        var clipPath = new graphic.Sector({
                shape: {
                    cx: polar.cx,
                    cy: polar.cy,
                    r0: radiusExtent[0],
                    r: radiusExtent[1],
                    startAngle: -angleExtent[0] * RADIAN,
                    endAngle: -angleExtent[1] * RADIAN,
                    clockwise: angleAxis.inverse
                }
            });
        if (hasAnimation) {
            clipPath.shape.endAngle = -angleExtent[0] * RADIAN;
            graphic.initProps(clipPath, { shape: { endAngle: -angleExtent[1] * RADIAN } }, seriesModel);
        }
        return clipPath;
    }
    function createClipShape(coordSys, hasAnimation, seriesModel) {
        return coordSys.type === 'polar' ? createPolarClipShape(coordSys, hasAnimation, seriesModel) : createGridClipShape(coordSys, hasAnimation, seriesModel);
    }
    function turnPointsIntoStep(points, coordSys, stepTurnAt) {
        var baseAxis = coordSys.getBaseAxis();
        var baseIndex = baseAxis.dim === 'x' || baseAxis.dim === 'radius' ? 0 : 1;
        var stepPoints = [];
        for (var i = 0; i < points.length - 1; i++) {
            var nextPt = points[i + 1];
            var pt = points[i];
            stepPoints.push(pt);
            var stepPt = [];
            switch (stepTurnAt) {
            case 'end':
                stepPt[baseIndex] = nextPt[baseIndex];
                stepPt[1 - baseIndex] = pt[1 - baseIndex];
                // default is start
                stepPoints.push(stepPt);
                break;
            case 'middle':
                // default is start
                var middle = (pt[baseIndex] + nextPt[baseIndex]) / 2;
                var stepPt2 = [];
                stepPt[baseIndex] = stepPt2[baseIndex] = middle;
                stepPt[1 - baseIndex] = pt[1 - baseIndex];
                stepPt2[1 - baseIndex] = nextPt[1 - baseIndex];
                stepPoints.push(stepPt);
                stepPoints.push(stepPt2);
                break;
            default:
                stepPt[baseIndex] = pt[baseIndex];
                stepPt[1 - baseIndex] = nextPt[1 - baseIndex];
                // default is start
                stepPoints.push(stepPt);
            }
        }
        // Last points
        points[i] && stepPoints.push(points[i]);
        return stepPoints;
    }
    function getVisualGradient(data, coordSys) {
        var visualMetaList = data.getVisual('visualMeta');
        if (!visualMetaList || !visualMetaList.length || !data.count()) {
            // When data.count() is 0, gradient range can not be calculated.
            return;
        }
        var visualMeta;
        for (var i = visualMetaList.length - 1; i >= 0; i--) {
            // Can only be x or y
            if (visualMetaList[i].dimension < 2) {
                visualMeta = visualMetaList[i];
                break;
            }
        }
        if (!visualMeta || coordSys.type !== 'cartesian2d') {
            if (true) {
                console.warn('Visual map on line style only support x or y dimension.');
            }
            return;
        }
        // If the area to be rendered is bigger than area defined by LinearGradient,
        // the canvas spec prescribes that the color of the first stop and the last
        // stop should be used. But if two stops are added at offset 0, in effect
        // browsers use the color of the second stop to render area outside
        // LinearGradient. So we can only infinitesimally extend area defined in
        // LinearGradient to render `outerColors`.
        var dimension = visualMeta.dimension;
        var dimName = data.dimensions[dimension];
        var axis = coordSys.getAxis(dimName);
        // dataToCoor mapping may not be linear, but must be monotonic.
        var colorStops = zrUtil.map(visualMeta.stops, function (stop) {
                return {
                    coord: axis.toGlobalCoord(axis.dataToCoord(stop.value)),
                    color: stop.color
                };
            });
        var stopLen = colorStops.length;
        var outerColors = visualMeta.outerColors.slice();
        if (stopLen && colorStops[0].coord > colorStops[stopLen - 1].coord) {
            colorStops.reverse();
            outerColors.reverse();
        }
        var tinyExtent = 10;
        // Arbitrary value: 10px
        var minCoord = colorStops[0].coord - tinyExtent;
        var maxCoord = colorStops[stopLen - 1].coord + tinyExtent;
        var coordSpan = maxCoord - minCoord;
        if (coordSpan < 0.001) {
            return 'transparent';
        }
        zrUtil.each(colorStops, function (stop) {
            stop.offset = (stop.coord - minCoord) / coordSpan;
        });
        colorStops.push({
            offset: stopLen ? colorStops[stopLen - 1].offset : 0.5,
            color: outerColors[1] || 'transparent'
        });
        colorStops.unshift({
            offset: stopLen ? colorStops[0].offset : 0.5,
            color: outerColors[0] || 'transparent'
        });
        // zrUtil.each(colorStops, function (colorStop) {
        //     // Make sure each offset has rounded px to avoid not sharp edge
        //     colorStop.offset = (Math.round(colorStop.offset * (end - start) + start) - start) / (end - start);
        // });
        var gradient = new graphic.LinearGradient(0, 0, 0, 0, colorStops, true);
        gradient[dimName] = minCoord;
        gradient[dimName + '2'] = maxCoord;
        return gradient;
    }
    return ChartView.extend({
        type: 'line',
        init: function () {
            var lineGroup = new graphic.Group();
            var symbolDraw = new SymbolDraw();
            this.group.add(symbolDraw.group);
            this._symbolDraw = symbolDraw;
            this._lineGroup = lineGroup;
        },
        render: function (seriesModel, ecModel, api) {
            var coordSys = seriesModel.coordinateSystem;
            var group = this.group;
            var data = seriesModel.getData();
            var lineStyleModel = seriesModel.getModel('lineStyle.normal');
            var areaStyleModel = seriesModel.getModel('areaStyle.normal');
            var points = data.mapArray(data.getItemLayout, true);
            var isCoordSysPolar = coordSys.type === 'polar';
            var prevCoordSys = this._coordSys;
            var symbolDraw = this._symbolDraw;
            var polyline = this._polyline;
            var polygon = this._polygon;
            var lineGroup = this._lineGroup;
            var hasAnimation = seriesModel.get('animation');
            var isAreaChart = !areaStyleModel.isEmpty();
            var stackedOnPoints = getStackedOnPoints(coordSys, data);
            var showSymbol = seriesModel.get('showSymbol');
            var isSymbolIgnore = showSymbol && !isCoordSysPolar && !seriesModel.get('showAllSymbol') && this._getSymbolIgnoreFunc(data, coordSys);
            // Remove temporary symbols
            var oldData = this._data;
            oldData && oldData.eachItemGraphicEl(function (el, idx) {
                if (el.__temp) {
                    group.remove(el);
                    oldData.setItemGraphicEl(idx, null);
                }
            });
            // Remove previous created symbols if showSymbol changed to false
            if (!showSymbol) {
                symbolDraw.remove();
            }
            group.add(lineGroup);
            // FIXME step not support polar
            var step = !isCoordSysPolar && seriesModel.get('step');
            // Initialization animation or coordinate system changed
            if (!(polyline && prevCoordSys.type === coordSys.type && step === this._step)) {
                showSymbol && symbolDraw.updateData(data, isSymbolIgnore);
                if (step) {
                    // TODO If stacked series is not step
                    points = turnPointsIntoStep(points, coordSys, step);
                    stackedOnPoints = turnPointsIntoStep(stackedOnPoints, coordSys, step);
                }
                polyline = this._newPolyline(points, coordSys, hasAnimation);
                if (isAreaChart) {
                    polygon = this._newPolygon(points, stackedOnPoints, coordSys, hasAnimation);
                }
                lineGroup.setClipPath(createClipShape(coordSys, true, seriesModel));
            } else {
                if (isAreaChart && !polygon) {
                    // If areaStyle is added
                    polygon = this._newPolygon(points, stackedOnPoints, coordSys, hasAnimation);
                } else if (polygon && !isAreaChart) {
                    // If areaStyle is removed
                    lineGroup.remove(polygon);
                    polygon = this._polygon = null;
                }
                // Update clipPath
                lineGroup.setClipPath(createClipShape(coordSys, false, seriesModel));
                // Always update, or it is wrong in the case turning on legend
                // because points are not changed
                showSymbol && symbolDraw.updateData(data, isSymbolIgnore);
                // Stop symbol animation and sync with line points
                // FIXME performance?
                data.eachItemGraphicEl(function (el) {
                    el.stopAnimation(true);
                });
                // In the case data zoom triggerred refreshing frequently
                // Data may not change if line has a category axis. So it should animate nothing
                if (!isPointsSame(this._stackedOnPoints, stackedOnPoints) || !isPointsSame(this._points, points)) {
                    if (hasAnimation) {
                        this._updateAnimation(data, stackedOnPoints, coordSys, api, step);
                    } else {
                        // Not do it in update with animation
                        if (step) {
                            // TODO If stacked series is not step
                            points = turnPointsIntoStep(points, coordSys, step);
                            stackedOnPoints = turnPointsIntoStep(stackedOnPoints, coordSys, step);
                        }
                        polyline.setShape({ points: points });
                        polygon && polygon.setShape({
                            points: points,
                            stackedOnPoints: stackedOnPoints
                        });
                    }
                }
            }
            var visualColor = getVisualGradient(data, coordSys) || data.getVisual('color');
            polyline.useStyle(zrUtil.defaults(lineStyleModel.getLineStyle(), {
                fill: 'none',
                stroke: visualColor,
                lineJoin: 'bevel'
            }));
            var smooth = seriesModel.get('smooth');
            smooth = getSmooth(seriesModel.get('smooth'));
            polyline.setShape({
                smooth: smooth,
                smoothMonotone: seriesModel.get('smoothMonotone'),
                connectNulls: seriesModel.get('connectNulls')
            });
            if (polygon) {
                var stackedOn = data.stackedOn;
                var stackedOnSmooth = 0;
                polygon.useStyle(zrUtil.defaults(areaStyleModel.getAreaStyle(), {
                    fill: visualColor,
                    opacity: 0.7,
                    lineJoin: 'bevel'
                }));
                if (stackedOn) {
                    var stackedOnSeries = stackedOn.hostModel;
                    stackedOnSmooth = getSmooth(stackedOnSeries.get('smooth'));
                }
                polygon.setShape({
                    smooth: smooth,
                    stackedOnSmooth: stackedOnSmooth,
                    smoothMonotone: seriesModel.get('smoothMonotone'),
                    connectNulls: seriesModel.get('connectNulls')
                });
            }
            this._data = data;
            // Save the coordinate system for transition animation when data changed
            this._coordSys = coordSys;
            this._stackedOnPoints = stackedOnPoints;
            this._points = points;
            this._step = step;
        },
        dispose: function () {
        },
        highlight: function (seriesModel, ecModel, api, payload) {
            var data = seriesModel.getData();
            var dataIndex = modelUtil.queryDataIndex(data, payload);
            if (!(dataIndex instanceof Array) && dataIndex != null && dataIndex >= 0) {
                var symbol = data.getItemGraphicEl(dataIndex);
                if (!symbol) {
                    // Create a temporary symbol if it is not exists
                    var pt = data.getItemLayout(dataIndex);
                    if (!pt) {
                        // Null data
                        return;
                    }
                    symbol = new Symbol(data, dataIndex);
                    symbol.position = pt;
                    symbol.setZ(seriesModel.get('zlevel'), seriesModel.get('z'));
                    symbol.ignore = isNaN(pt[0]) || isNaN(pt[1]);
                    symbol.__temp = true;
                    data.setItemGraphicEl(dataIndex, symbol);
                    // Stop scale animation
                    symbol.stopSymbolAnimation(true);
                    this.group.add(symbol);
                }
                symbol.highlight();
            } else {
                // Highlight whole series
                ChartView.prototype.highlight.call(this, seriesModel, ecModel, api, payload);
            }
        },
        downplay: function (seriesModel, ecModel, api, payload) {
            var data = seriesModel.getData();
            var dataIndex = modelUtil.queryDataIndex(data, payload);
            if (dataIndex != null && dataIndex >= 0) {
                var symbol = data.getItemGraphicEl(dataIndex);
                if (symbol) {
                    if (symbol.__temp) {
                        data.setItemGraphicEl(dataIndex, null);
                        this.group.remove(symbol);
                    } else {
                        symbol.downplay();
                    }
                }
            } else {
                // Downplay whole series
                ChartView.prototype.downplay.call(this, seriesModel, ecModel, api, payload);
            }
        },
        _newPolyline: function (points) {
            var polyline = this._polyline;
            // Remove previous created polyline
            if (polyline) {
                this._lineGroup.remove(polyline);
            }
            polyline = new polyHelper.Polyline({
                shape: { points: points },
                silent: true,
                z2: 10
            });
            this._lineGroup.add(polyline);
            this._polyline = polyline;
            return polyline;
        },
        _newPolygon: function (points, stackedOnPoints) {
            var polygon = this._polygon;
            // Remove previous created polygon
            if (polygon) {
                this._lineGroup.remove(polygon);
            }
            polygon = new polyHelper.Polygon({
                shape: {
                    points: points,
                    stackedOnPoints: stackedOnPoints
                },
                silent: true
            });
            this._lineGroup.add(polygon);
            this._polygon = polygon;
            return polygon;
        },
        _getSymbolIgnoreFunc: function (data, coordSys) {
            var categoryAxis = coordSys.getAxesByScale('ordinal')[0];
            // `getLabelInterval` is provided by echarts/component/axis
            if (categoryAxis && categoryAxis.isLabelIgnored) {
                return zrUtil.bind(categoryAxis.isLabelIgnored, categoryAxis);
            }
        },
        _updateAnimation: function (data, stackedOnPoints, coordSys, api, step) {
            var polyline = this._polyline;
            var polygon = this._polygon;
            var seriesModel = data.hostModel;
            var diff = lineAnimationDiff(this._data, data, this._stackedOnPoints, stackedOnPoints, this._coordSys, coordSys);
            var current = diff.current;
            var stackedOnCurrent = diff.stackedOnCurrent;
            var next = diff.next;
            var stackedOnNext = diff.stackedOnNext;
            if (step) {
                // TODO If stacked series is not step
                current = turnPointsIntoStep(diff.current, coordSys, step);
                stackedOnCurrent = turnPointsIntoStep(diff.stackedOnCurrent, coordSys, step);
                next = turnPointsIntoStep(diff.next, coordSys, step);
                stackedOnNext = turnPointsIntoStep(diff.stackedOnNext, coordSys, step);
            }
            // `diff.current` is subset of `current` (which should be ensured by
            // turnPointsIntoStep), so points in `__points` can be updated when
            // points in `current` are update during animation.
            polyline.shape.__points = diff.current;
            polyline.shape.points = current;
            graphic.updateProps(polyline, { shape: { points: next } }, seriesModel);
            if (polygon) {
                polygon.setShape({
                    points: current,
                    stackedOnPoints: stackedOnCurrent
                });
                graphic.updateProps(polygon, {
                    shape: {
                        points: next,
                        stackedOnPoints: stackedOnNext
                    }
                }, seriesModel);
            }
            var updatedDataInfo = [];
            var diffStatus = diff.status;
            for (var i = 0; i < diffStatus.length; i++) {
                var cmd = diffStatus[i].cmd;
                if (cmd === '=') {
                    var el = data.getItemGraphicEl(diffStatus[i].idx1);
                    if (el) {
                        updatedDataInfo.push({
                            el: el,
                            ptIdx: i
                        });
                    }
                }
            }
            if (polyline.animators && polyline.animators.length) {
                polyline.animators[0].during(function () {
                    for (var i = 0; i < updatedDataInfo.length; i++) {
                        var el = updatedDataInfo[i].el;
                        el.attr('position', polyline.shape.__points[updatedDataInfo[i].ptIdx]);
                    }
                });
            }
        },
        remove: function (ecModel) {
            var group = this.group;
            var oldData = this._data;
            this._lineGroup.removeAll();
            this._symbolDraw.remove(true);
            // Remove temporary created elements when highlighting
            oldData && oldData.eachItemGraphicEl(function (el, idx) {
                if (el.__temp) {
                    group.remove(el);
                    oldData.setItemGraphicEl(idx, null);
                }
            });
            this._polyline = this._polygon = this._coordSys = this._points = this._stackedOnPoints = this._data = null;
        }
    });
});
define('echarts/visual/symbol', ['require'], function (require) {
    return function (seriesType, defaultSymbolType, legendSymbol, ecModel, api) {
        // Encoding visual for all series include which is filtered for legend drawing
        ecModel.eachRawSeriesByType(seriesType, function (seriesModel) {
            var data = seriesModel.getData();
            var symbolType = seriesModel.get('symbol') || defaultSymbolType;
            var symbolSize = seriesModel.get('symbolSize');
            data.setVisual({
                legendSymbol: legendSymbol || symbolType,
                symbol: symbolType,
                symbolSize: symbolSize
            });
            // Only visible series has each data be visual encoded
            if (!ecModel.isSeriesFiltered(seriesModel)) {
                if (typeof symbolSize === 'function') {
                    data.each(function (idx) {
                        var rawValue = seriesModel.getRawValue(idx);
                        // FIXME
                        var params = seriesModel.getDataParams(idx);
                        data.setItemVisual(idx, 'symbolSize', symbolSize(rawValue, params));
                    });
                }
                data.each(function (idx) {
                    var itemModel = data.getItemModel(idx);
                    var itemSymbolType = itemModel.getShallow('symbol', true);
                    var itemSymbolSize = itemModel.getShallow('symbolSize', true);
                    // If has item symbol
                    if (itemSymbolType != null) {
                        data.setItemVisual(idx, 'symbol', itemSymbolType);
                    }
                    if (itemSymbolSize != null) {
                        // PENDING Transform symbolSize ?
                        data.setItemVisual(idx, 'symbolSize', itemSymbolSize);
                    }
                });
            }
        });
    };
});
define('echarts/layout/points', ['require'], function (require) {
    return function (seriesType, ecModel) {
        ecModel.eachSeriesByType(seriesType, function (seriesModel) {
            var data = seriesModel.getData();
            var coordSys = seriesModel.coordinateSystem;
            if (coordSys) {
                var dims = coordSys.dimensions;
                if (coordSys.type === 'singleAxis') {
                    data.each(dims[0], function (x, idx) {
                        // Also {Array.<number>}, not undefined to avoid if...else... statement
                        data.setItemLayout(idx, isNaN(x) ? [
                            NaN,
                            NaN
                        ] : coordSys.dataToPoint(x));
                    });
                } else {
                    data.each(dims, function (x, y, idx) {
                        // Also {Array.<number>}, not undefined to avoid if...else... statement
                        data.setItemLayout(idx, isNaN(x) || isNaN(y) ? [
                            NaN,
                            NaN
                        ] : coordSys.dataToPoint([
                            x,
                            y
                        ]));
                    }, true);
                }
            }
        });
    };
});
define('echarts/processor/dataSample', [], function () {
    var samplers = {
            average: function (frame) {
                var sum = 0;
                var count = 0;
                for (var i = 0; i < frame.length; i++) {
                    if (!isNaN(frame[i])) {
                        sum += frame[i];
                        count++;
                    }
                }
                // Return NaN if count is 0
                return count === 0 ? NaN : sum / count;
            },
            sum: function (frame) {
                var sum = 0;
                for (var i = 0; i < frame.length; i++) {
                    // Ignore NaN
                    sum += frame[i] || 0;
                }
                return sum;
            },
            max: function (frame) {
                var max = -Infinity;
                for (var i = 0; i < frame.length; i++) {
                    frame[i] > max && (max = frame[i]);
                }
                return max;
            },
            min: function (frame) {
                var min = Infinity;
                for (var i = 0; i < frame.length; i++) {
                    frame[i] < min && (min = frame[i]);
                }
                return min;
            },
            nearest: function (frame) {
                return frame[0];
            }
        };
    var indexSampler = function (frame, value) {
        return Math.round(frame.length / 2);
    };
    return function (seriesType, ecModel, api) {
        ecModel.eachSeriesByType(seriesType, function (seriesModel) {
            var data = seriesModel.getData();
            var sampling = seriesModel.get('sampling');
            var coordSys = seriesModel.coordinateSystem;
            // Only cartesian2d support down sampling
            if (coordSys.type === 'cartesian2d' && sampling) {
                var baseAxis = coordSys.getBaseAxis();
                var valueAxis = coordSys.getOtherAxis(baseAxis);
                var extent = baseAxis.getExtent();
                // Coordinste system has been resized
                var size = extent[1] - extent[0];
                var rate = Math.round(data.count() / size);
                if (rate > 1) {
                    var sampler;
                    if (typeof sampling === 'string') {
                        sampler = samplers[sampling];
                    } else if (typeof sampling === 'function') {
                        sampler = sampling;
                    }
                    if (sampler) {
                        data = data.downSample(valueAxis.dim, 1 / rate, sampler, indexSampler);
                        seriesModel.setData(data);
                    }
                }
            }
        }, this);
    };
});
define('echarts/chart/pie/PieSeries', ['require', '../../data/List', 'zrender/core/util', '../../util/model', '../../data/helper/completeDimensions', '../../component/helper/selectableMixin', '../../echarts'], function (require) {
    'use strict';
    var List = require('../../data/List');
    var zrUtil = require('zrender/core/util');
    var modelUtil = require('../../util/model');
    var completeDimensions = require('../../data/helper/completeDimensions');
    var dataSelectableMixin = require('../../component/helper/selectableMixin');
    var PieSeries = require('../../echarts').extendSeriesModel({
            type: 'series.pie',
            init: function (option) {
                PieSeries.superApply(this, 'init', arguments);
                // Enable legend selection for each data item
                // Use a function instead of direct access because data reference may changed
                this.legendDataProvider = function () {
                    return this._dataBeforeProcessed;
                };
                this.updateSelectedMap(option.data);
                this._defaultLabelLine(option);
            },
            mergeOption: function (newOption) {
                PieSeries.superCall(this, 'mergeOption', newOption);
                this.updateSelectedMap(this.option.data);
            },
            getInitialData: function (option, ecModel) {
                var dimensions = completeDimensions(['value'], option.data);
                var list = new List(dimensions, this);
                list.initData(option.data);
                return list;
            },
            getDataParams: function (dataIndex) {
                var data = this._data;
                var params = PieSeries.superCall(this, 'getDataParams', dataIndex);
                var sum = data.getSum('value');
                // FIXME toFixed?
                //
                // Percent is 0 if sum is 0
                params.percent = !sum ? 0 : +(data.get('value', dataIndex) / sum * 100).toFixed(2);
                params.$vars.push('percent');
                return params;
            },
            _defaultLabelLine: function (option) {
                // Extend labelLine emphasis
                modelUtil.defaultEmphasis(option.labelLine, ['show']);
                var labelLineNormalOpt = option.labelLine.normal;
                var labelLineEmphasisOpt = option.labelLine.emphasis;
                // Not show label line if `label.normal.show = false`
                labelLineNormalOpt.show = labelLineNormalOpt.show && option.label.normal.show;
                labelLineEmphasisOpt.show = labelLineEmphasisOpt.show && option.label.emphasis.show;
            },
            defaultOption: {
                zlevel: 0,
                z: 2,
                legendHoverLink: true,
                hoverAnimation: true,
                center: [
                    '50%',
                    '50%'
                ],
                radius: [
                    0,
                    '75%'
                ],
                clockwise: true,
                startAngle: 90,
                minAngle: 0,
                selectedOffset: 10,
                avoidLabelOverlap: true,
                label: {
                    normal: {
                        rotate: false,
                        show: true,
                        position: 'outer'
                    },
                    emphasis: {}
                },
                labelLine: {
                    normal: {
                        show: true,
                        length: 15,
                        length2: 15,
                        smooth: false,
                        lineStyle: {
                            width: 1,
                            type: 'solid'
                        }
                    }
                },
                itemStyle: {
                    normal: { borderWidth: 1 },
                    emphasis: {}
                },
                animationEasing: 'cubicOut',
                data: []
            }
        });
    zrUtil.mixin(PieSeries, dataSelectableMixin);
    return PieSeries;
});
define('echarts/chart/pie/PieView', ['require', '../../util/graphic', 'zrender/core/util', '../../view/Chart'], function (require) {
    var graphic = require('../../util/graphic');
    var zrUtil = require('zrender/core/util');
    /**
     * @param {module:echarts/model/Series} seriesModel
     * @param {boolean} hasAnimation
     * @inner
     */
    function updateDataSelected(uid, seriesModel, hasAnimation, api) {
        var data = seriesModel.getData();
        var dataIndex = this.dataIndex;
        var name = data.getName(dataIndex);
        var selectedOffset = seriesModel.get('selectedOffset');
        api.dispatchAction({
            type: 'pieToggleSelect',
            from: uid,
            name: name,
            seriesId: seriesModel.id
        });
        data.each(function (idx) {
            toggleItemSelected(data.getItemGraphicEl(idx), data.getItemLayout(idx), seriesModel.isSelected(data.getName(idx)), selectedOffset, hasAnimation);
        });
    }
    /**
     * @param {module:zrender/graphic/Sector} el
     * @param {Object} layout
     * @param {boolean} isSelected
     * @param {number} selectedOffset
     * @param {boolean} hasAnimation
     * @inner
     */
    function toggleItemSelected(el, layout, isSelected, selectedOffset, hasAnimation) {
        var midAngle = (layout.startAngle + layout.endAngle) / 2;
        var dx = Math.cos(midAngle);
        var dy = Math.sin(midAngle);
        var offset = isSelected ? selectedOffset : 0;
        var position = [
                dx * offset,
                dy * offset
            ];
        hasAnimation ? el.animate().when(200, { position: position }).start('bounceOut') : el.attr('position', position);
    }
    /**
     * Piece of pie including Sector, Label, LabelLine
     * @constructor
     * @extends {module:zrender/graphic/Group}
     */
    function PiePiece(data, idx) {
        graphic.Group.call(this);
        var sector = new graphic.Sector({ z2: 2 });
        var polyline = new graphic.Polyline();
        var text = new graphic.Text();
        this.add(sector);
        this.add(polyline);
        this.add(text);
        this.updateData(data, idx, true);
        // Hover to change label and labelLine
        function onEmphasis() {
            polyline.ignore = polyline.hoverIgnore;
            text.ignore = text.hoverIgnore;
        }
        function onNormal() {
            polyline.ignore = polyline.normalIgnore;
            text.ignore = text.normalIgnore;
        }
        this.on('emphasis', onEmphasis).on('normal', onNormal).on('mouseover', onEmphasis).on('mouseout', onNormal);
    }
    var piePieceProto = PiePiece.prototype;
    function getLabelStyle(data, idx, state, labelModel, labelPosition) {
        var textStyleModel = labelModel.getModel('textStyle');
        var isLabelInside = labelPosition === 'inside' || labelPosition === 'inner';
        return {
            fill: textStyleModel.getTextColor() || (isLabelInside ? '#fff' : data.getItemVisual(idx, 'color')),
            opacity: data.getItemVisual(idx, 'opacity'),
            textFont: textStyleModel.getFont(),
            text: zrUtil.retrieve(data.hostModel.getFormattedLabel(idx, state), data.getName(idx))
        };
    }
    piePieceProto.updateData = function (data, idx, firstCreate) {
        var sector = this.childAt(0);
        var seriesModel = data.hostModel;
        var itemModel = data.getItemModel(idx);
        var layout = data.getItemLayout(idx);
        var sectorShape = zrUtil.extend({}, layout);
        sectorShape.label = null;
        if (firstCreate) {
            sector.setShape(sectorShape);
            sector.shape.endAngle = layout.startAngle;
            graphic.updateProps(sector, { shape: { endAngle: layout.endAngle } }, seriesModel, idx);
        } else {
            graphic.updateProps(sector, { shape: sectorShape }, seriesModel, idx);
        }
        // Update common style
        var itemStyleModel = itemModel.getModel('itemStyle');
        var visualColor = data.getItemVisual(idx, 'color');
        sector.useStyle(zrUtil.defaults({
            lineJoin: 'bevel',
            fill: visualColor
        }, itemStyleModel.getModel('normal').getItemStyle()));
        sector.hoverStyle = itemStyleModel.getModel('emphasis').getItemStyle();
        // Toggle selected
        toggleItemSelected(this, data.getItemLayout(idx), itemModel.get('selected'), seriesModel.get('selectedOffset'), seriesModel.get('animation'));
        function onEmphasis() {
            // Sector may has animation of updating data. Force to move to the last frame
            // Or it may stopped on the wrong shape
            sector.stopAnimation(true);
            sector.animateTo({ shape: { r: layout.r + 10 } }, 300, 'elasticOut');
        }
        function onNormal() {
            sector.stopAnimation(true);
            sector.animateTo({ shape: { r: layout.r } }, 300, 'elasticOut');
        }
        sector.off('mouseover').off('mouseout').off('emphasis').off('normal');
        if (itemModel.get('hoverAnimation') && seriesModel.ifEnableAnimation()) {
            sector.on('mouseover', onEmphasis).on('mouseout', onNormal).on('emphasis', onEmphasis).on('normal', onNormal);
        }
        this._updateLabel(data, idx);
        graphic.setHoverStyle(this);
    };
    piePieceProto._updateLabel = function (data, idx) {
        var labelLine = this.childAt(1);
        var labelText = this.childAt(2);
        var seriesModel = data.hostModel;
        var itemModel = data.getItemModel(idx);
        var layout = data.getItemLayout(idx);
        var labelLayout = layout.label;
        var visualColor = data.getItemVisual(idx, 'color');
        graphic.updateProps(labelLine, {
            shape: {
                points: labelLayout.linePoints || [
                    [
                        labelLayout.x,
                        labelLayout.y
                    ],
                    [
                        labelLayout.x,
                        labelLayout.y
                    ],
                    [
                        labelLayout.x,
                        labelLayout.y
                    ]
                ]
            }
        }, seriesModel, idx);
        graphic.updateProps(labelText, {
            style: {
                x: labelLayout.x,
                y: labelLayout.y
            }
        }, seriesModel, idx);
        labelText.attr({
            style: {
                textVerticalAlign: labelLayout.verticalAlign,
                textAlign: labelLayout.textAlign,
                textFont: labelLayout.font
            },
            rotation: labelLayout.rotation,
            origin: [
                labelLayout.x,
                labelLayout.y
            ],
            z2: 10
        });
        var labelModel = itemModel.getModel('label.normal');
        var labelHoverModel = itemModel.getModel('label.emphasis');
        var labelLineModel = itemModel.getModel('labelLine.normal');
        var labelLineHoverModel = itemModel.getModel('labelLine.emphasis');
        var labelPosition = labelModel.get('position') || labelHoverModel.get('position');
        labelText.setStyle(getLabelStyle(data, idx, 'normal', labelModel, labelPosition));
        labelText.ignore = labelText.normalIgnore = !labelModel.get('show');
        labelText.hoverIgnore = !labelHoverModel.get('show');
        labelLine.ignore = labelLine.normalIgnore = !labelLineModel.get('show');
        labelLine.hoverIgnore = !labelLineHoverModel.get('show');
        // Default use item visual color
        labelLine.setStyle({
            stroke: visualColor,
            opacity: data.getItemVisual(idx, 'opacity')
        });
        labelLine.setStyle(labelLineModel.getModel('lineStyle').getLineStyle());
        labelText.hoverStyle = getLabelStyle(data, idx, 'emphasis', labelHoverModel, labelPosition);
        labelLine.hoverStyle = labelLineHoverModel.getModel('lineStyle').getLineStyle();
        var smooth = labelLineModel.get('smooth');
        if (smooth && smooth === true) {
            smooth = 0.4;
        }
        labelLine.setShape({ smooth: smooth });
    };
    zrUtil.inherits(PiePiece, graphic.Group);
    // Pie view
    var Pie = require('../../view/Chart').extend({
            type: 'pie',
            init: function () {
                var sectorGroup = new graphic.Group();
                this._sectorGroup = sectorGroup;
            },
            render: function (seriesModel, ecModel, api, payload) {
                if (payload && payload.from === this.uid) {
                    return;
                }
                var data = seriesModel.getData();
                var oldData = this._data;
                var group = this.group;
                var hasAnimation = ecModel.get('animation');
                var isFirstRender = !oldData;
                var onSectorClick = zrUtil.curry(updateDataSelected, this.uid, seriesModel, hasAnimation, api);
                var selectedMode = seriesModel.get('selectedMode');
                data.diff(oldData).add(function (idx) {
                    var piePiece = new PiePiece(data, idx);
                    if (isFirstRender) {
                        piePiece.eachChild(function (child) {
                            child.stopAnimation(true);
                        });
                    }
                    selectedMode && piePiece.on('click', onSectorClick);
                    data.setItemGraphicEl(idx, piePiece);
                    group.add(piePiece);
                }).update(function (newIdx, oldIdx) {
                    var piePiece = oldData.getItemGraphicEl(oldIdx);
                    piePiece.updateData(data, newIdx);
                    piePiece.off('click');
                    selectedMode && piePiece.on('click', onSectorClick);
                    group.add(piePiece);
                    data.setItemGraphicEl(newIdx, piePiece);
                }).remove(function (idx) {
                    var piePiece = oldData.getItemGraphicEl(idx);
                    group.remove(piePiece);
                }).execute();
                if (hasAnimation && isFirstRender && data.count() > 0) {
                    var shape = data.getItemLayout(0);
                    var r = Math.max(api.getWidth(), api.getHeight()) / 2;
                    var removeClipPath = zrUtil.bind(group.removeClipPath, group);
                    group.setClipPath(this._createClipPath(shape.cx, shape.cy, r, shape.startAngle, shape.clockwise, removeClipPath, seriesModel));
                }
                this._data = data;
            },
            dispose: function () {
            },
            _createClipPath: function (cx, cy, r, startAngle, clockwise, cb, seriesModel) {
                var clipPath = new graphic.Sector({
                        shape: {
                            cx: cx,
                            cy: cy,
                            r0: 0,
                            r: r,
                            startAngle: startAngle,
                            endAngle: startAngle,
                            clockwise: clockwise
                        }
                    });
                graphic.initProps(clipPath, { shape: { endAngle: startAngle + (clockwise ? 1 : -1) * Math.PI * 2 } }, seriesModel, cb);
                return clipPath;
            },
            containPoint: function (point, seriesModel) {
                var data = seriesModel.getData();
                var itemLayout = data.getItemLayout(0);
                if (itemLayout) {
                    var dx = point[0] - itemLayout.cx;
                    var dy = point[1] - itemLayout.cy;
                    var radius = Math.sqrt(dx * dx + dy * dy);
                    return radius <= itemLayout.r && radius >= itemLayout.r0;
                }
            }
        });
    return Pie;
});
define('echarts/action/createDataSelectAction', ['require', '../echarts', 'zrender/core/util'], function (require) {
    var echarts = require('../echarts');
    var zrUtil = require('zrender/core/util');
    return function (seriesType, actionInfos) {
        zrUtil.each(actionInfos, function (actionInfo) {
            actionInfo.update = 'updateView';
            /**
             * @payload
             * @property {string} seriesName
             * @property {string} name
             */
            echarts.registerAction(actionInfo, function (payload, ecModel) {
                var selected = {};
                ecModel.eachComponent({
                    mainType: 'series',
                    subType: seriesType,
                    query: payload
                }, function (seriesModel) {
                    if (seriesModel[actionInfo.method]) {
                        seriesModel[actionInfo.method](payload.name);
                    }
                    var data = seriesModel.getData();
                    // Create selected map
                    data.each(function (idx) {
                        var name = data.getName(idx);
                        selected[name] = seriesModel.isSelected(name) || false;
                    });
                });
                return {
                    name: payload.name,
                    selected: selected
                };
            });
        });
    };
});
define('echarts/visual/dataColor', ['require'], function (require) {
    return function (seriesType, ecModel) {
        // Pie and funnel may use diferrent scope
        var paletteScope = {};
        ecModel.eachRawSeriesByType(seriesType, function (seriesModel) {
            var dataAll = seriesModel.getRawData();
            var idxMap = {};
            if (!ecModel.isSeriesFiltered(seriesModel)) {
                var data = seriesModel.getData();
                data.each(function (idx) {
                    var rawIdx = data.getRawIndex(idx);
                    idxMap[rawIdx] = idx;
                });
                dataAll.each(function (rawIdx) {
                    // FIXME Performance
                    var itemModel = dataAll.getItemModel(rawIdx);
                    var filteredIdx = idxMap[rawIdx];
                    // If series.itemStyle.normal.color is a function. itemVisual may be encoded
                    var singleDataColor = filteredIdx != null && data.getItemVisual(filteredIdx, 'color', true);
                    if (!singleDataColor) {
                        var color = itemModel.get('itemStyle.normal.color') || seriesModel.getColorFromPalette(dataAll.getName(rawIdx), paletteScope);
                        // Legend may use the visual info in data before processed
                        dataAll.setItemVisual(rawIdx, 'color', color);
                        // Data is not filtered
                        if (filteredIdx != null) {
                            data.setItemVisual(filteredIdx, 'color', color);
                        }
                    } else {
                        // Set data all color for legend
                        dataAll.setItemVisual(rawIdx, 'color', singleDataColor);
                    }
                });
            }
        });
    };
});
define('echarts/chart/pie/pieLayout', ['require', '../../util/number', './labelLayout', 'zrender/core/util'], function (require) {
    var numberUtil = require('../../util/number');
    var parsePercent = numberUtil.parsePercent;
    var labelLayout = require('./labelLayout');
    var zrUtil = require('zrender/core/util');
    var PI2 = Math.PI * 2;
    var RADIAN = Math.PI / 180;
    return function (seriesType, ecModel, api, payload) {
        ecModel.eachSeriesByType(seriesType, function (seriesModel) {
            var center = seriesModel.get('center');
            var radius = seriesModel.get('radius');
            if (!zrUtil.isArray(radius)) {
                radius = [
                    0,
                    radius
                ];
            }
            if (!zrUtil.isArray(center)) {
                center = [
                    center,
                    center
                ];
            }
            var width = api.getWidth();
            var height = api.getHeight();
            var size = Math.min(width, height);
            var cx = parsePercent(center[0], width);
            var cy = parsePercent(center[1], height);
            var r0 = parsePercent(radius[0], size / 2);
            var r = parsePercent(radius[1], size / 2);
            var data = seriesModel.getData();
            var startAngle = -seriesModel.get('startAngle') * RADIAN;
            var minAngle = seriesModel.get('minAngle') * RADIAN;
            var sum = data.getSum('value');
            // Sum may be 0
            var unitRadian = Math.PI / (sum || data.count()) * 2;
            var clockwise = seriesModel.get('clockwise');
            var roseType = seriesModel.get('roseType');
            // [0...max]
            var extent = data.getDataExtent('value');
            extent[0] = 0;
            // In the case some sector angle is smaller than minAngle
            var restAngle = PI2;
            var valueSumLargerThanMinAngle = 0;
            var currentAngle = startAngle;
            var dir = clockwise ? 1 : -1;
            data.each('value', function (value, idx) {
                var angle;
                // FIXME 兼容 2.0 但是 roseType 是 area 的时候才是这样？
                if (roseType !== 'area') {
                    angle = sum === 0 ? unitRadian : value * unitRadian;
                } else {
                    angle = PI2 / (data.count() || 1);
                }
                if (angle < minAngle) {
                    angle = minAngle;
                    restAngle -= minAngle;
                } else {
                    valueSumLargerThanMinAngle += value;
                }
                var endAngle = currentAngle + dir * angle;
                data.setItemLayout(idx, {
                    angle: angle,
                    startAngle: currentAngle,
                    endAngle: endAngle,
                    clockwise: clockwise,
                    cx: cx,
                    cy: cy,
                    r0: r0,
                    r: roseType ? numberUtil.linearMap(value, extent, [
                        r0,
                        r
                    ]) : r
                });
                currentAngle = endAngle;
            }, true);
            // Some sector is constrained by minAngle
            // Rest sectors needs recalculate angle
            if (restAngle < PI2) {
                // Average the angle if rest angle is not enough after all angles is
                // Constrained by minAngle
                if (restAngle <= 0.001) {
                    var angle = PI2 / data.count();
                    data.each(function (idx) {
                        var layout = data.getItemLayout(idx);
                        layout.startAngle = startAngle + dir * idx * angle;
                        layout.endAngle = startAngle + dir * (idx + 1) * angle;
                    });
                } else {
                    unitRadian = restAngle / valueSumLargerThanMinAngle;
                    currentAngle = startAngle;
                    data.each('value', function (value, idx) {
                        var layout = data.getItemLayout(idx);
                        var angle = layout.angle === minAngle ? minAngle : value * unitRadian;
                        layout.startAngle = currentAngle;
                        layout.endAngle = currentAngle + dir * angle;
                        currentAngle += dir * angle;
                    });
                }
            }
            labelLayout(seriesModel, r, width, height);
        });
    };
});
define('echarts/processor/dataFilter', [], function () {
    return function (seriesType, ecModel) {
        var legendModels = ecModel.findComponents({ mainType: 'legend' });
        if (!legendModels || !legendModels.length) {
            return;
        }
        ecModel.eachSeriesByType(seriesType, function (series) {
            var data = series.getData();
            data.filterSelf(function (idx) {
                var name = data.getName(idx);
                // If in any legend component the status is not selected.
                for (var i = 0; i < legendModels.length; i++) {
                    if (!legendModels[i].isSelected(name)) {
                        return false;
                    }
                }
                return true;
            }, this);
        }, this);
    };
});
define('echarts/chart/scatter/ScatterSeries', ['require', '../helper/createListFromArray', '../../model/Series'], function (require) {
    'use strict';
    var createListFromArray = require('../helper/createListFromArray');
    var SeriesModel = require('../../model/Series');
    return SeriesModel.extend({
        type: 'series.scatter',
        dependencies: [
            'grid',
            'polar'
        ],
        getInitialData: function (option, ecModel) {
            var list = createListFromArray(option.data, this, ecModel);
            return list;
        },
        brushSelector: 'point',
        defaultOption: {
            coordinateSystem: 'cartesian2d',
            zlevel: 0,
            z: 2,
            legendHoverLink: true,
            hoverAnimation: true,
            symbolSize: 10,
            large: false,
            largeThreshold: 2000,
            itemStyle: { normal: { opacity: 0.8 } }
        }
    });
});
define('echarts/chart/scatter/ScatterView', ['require', '../helper/SymbolDraw', '../helper/LargeSymbolDraw', '../../echarts'], function (require) {
    var SymbolDraw = require('../helper/SymbolDraw');
    var LargeSymbolDraw = require('../helper/LargeSymbolDraw');
    require('../../echarts').extendChartView({
        type: 'scatter',
        init: function () {
            this._normalSymbolDraw = new SymbolDraw();
            this._largeSymbolDraw = new LargeSymbolDraw();
        },
        render: function (seriesModel, ecModel, api) {
            var data = seriesModel.getData();
            var largeSymbolDraw = this._largeSymbolDraw;
            var normalSymbolDraw = this._normalSymbolDraw;
            var group = this.group;
            var symbolDraw = seriesModel.get('large') && data.count() > seriesModel.get('largeThreshold') ? largeSymbolDraw : normalSymbolDraw;
            this._symbolDraw = symbolDraw;
            symbolDraw.updateData(data);
            group.add(symbolDraw.group);
            group.remove(symbolDraw === largeSymbolDraw ? normalSymbolDraw.group : largeSymbolDraw.group);
        },
        updateLayout: function (seriesModel) {
            this._symbolDraw.updateLayout(seriesModel);
        },
        remove: function (ecModel, api) {
            this._symbolDraw && this._symbolDraw.remove(api, true);
        },
        dispose: function () {
        }
    });
});
define('echarts/chart/effectScatter/EffectScatterSeries', ['require', '../helper/createListFromArray', '../../model/Series'], function (require) {
    'use strict';
    var createListFromArray = require('../helper/createListFromArray');
    var SeriesModel = require('../../model/Series');
    return SeriesModel.extend({
        type: 'series.effectScatter',
        dependencies: [
            'grid',
            'polar'
        ],
        getInitialData: function (option, ecModel) {
            var list = createListFromArray(option.data, this, ecModel);
            return list;
        },
        brushSelector: 'point',
        defaultOption: {
            coordinateSystem: 'cartesian2d',
            zlevel: 0,
            z: 2,
            legendHoverLink: true,
            effectType: 'ripple',
            progressive: 0,
            showEffectOn: 'render',
            rippleEffect: {
                period: 4,
                scale: 2.5,
                brushType: 'fill'
            },
            symbolSize: 10
        }
    });
});
define('echarts/chart/effectScatter/EffectScatterView', ['require', '../helper/SymbolDraw', '../helper/EffectSymbol', '../../echarts'], function (require) {
    var SymbolDraw = require('../helper/SymbolDraw');
    var EffectSymbol = require('../helper/EffectSymbol');
    require('../../echarts').extendChartView({
        type: 'effectScatter',
        init: function () {
            this._symbolDraw = new SymbolDraw(EffectSymbol);
        },
        render: function (seriesModel, ecModel, api) {
            var data = seriesModel.getData();
            var effectSymbolDraw = this._symbolDraw;
            effectSymbolDraw.updateData(data);
            this.group.add(effectSymbolDraw.group);
        },
        updateLayout: function () {
            this._symbolDraw.updateLayout();
        },
        remove: function (ecModel, api) {
            this._symbolDraw && this._symbolDraw.remove(api);
        },
        dispose: function () {
        }
    });
});
define('echarts/component/axis', ['require', '../coord/cartesian/AxisModel', './axis/AxisView'], function (require) {
    'use strict';
    require('../coord/cartesian/AxisModel');
    require('./axis/AxisView');
});
define('echarts/util/layout', ['require', 'zrender/core/util', 'zrender/core/BoundingRect', './number', './format'], function (require) {
    'use strict';
    var zrUtil = require('zrender/core/util');
    var BoundingRect = require('zrender/core/BoundingRect');
    var numberUtil = require('./number');
    var formatUtil = require('./format');
    var parsePercent = numberUtil.parsePercent;
    var each = zrUtil.each;
    var layout = {};
    var LOCATION_PARAMS = layout.LOCATION_PARAMS = [
            'left',
            'right',
            'top',
            'bottom',
            'width',
            'height'
        ];
    function boxLayout(orient, group, gap, maxWidth, maxHeight) {
        var x = 0;
        var y = 0;
        if (maxWidth == null) {
            maxWidth = Infinity;
        }
        if (maxHeight == null) {
            maxHeight = Infinity;
        }
        var currentLineMaxSize = 0;
        group.eachChild(function (child, idx) {
            var position = child.position;
            var rect = child.getBoundingRect();
            var nextChild = group.childAt(idx + 1);
            var nextChildRect = nextChild && nextChild.getBoundingRect();
            var nextX;
            var nextY;
            if (orient === 'horizontal') {
                var moveX = rect.width + (nextChildRect ? -nextChildRect.x + rect.x : 0);
                nextX = x + moveX;
                // Wrap when width exceeds maxWidth or meet a `newline` group
                if (nextX > maxWidth || child.newline) {
                    x = 0;
                    nextX = moveX;
                    y += currentLineMaxSize + gap;
                    currentLineMaxSize = rect.height;
                } else {
                    currentLineMaxSize = Math.max(currentLineMaxSize, rect.height);
                }
            } else {
                var moveY = rect.height + (nextChildRect ? -nextChildRect.y + rect.y : 0);
                nextY = y + moveY;
                // Wrap when width exceeds maxHeight or meet a `newline` group
                if (nextY > maxHeight || child.newline) {
                    x += currentLineMaxSize + gap;
                    y = 0;
                    nextY = moveY;
                    currentLineMaxSize = rect.width;
                } else {
                    currentLineMaxSize = Math.max(currentLineMaxSize, rect.width);
                }
            }
            if (child.newline) {
                return;
            }
            position[0] = x;
            position[1] = y;
            orient === 'horizontal' ? x = nextX + gap : y = nextY + gap;
        });
    }
    /**
     * VBox or HBox layouting
     * @param {string} orient
     * @param {module:zrender/container/Group} group
     * @param {number} gap
     * @param {number} [width=Infinity]
     * @param {number} [height=Infinity]
     */
    layout.box = boxLayout;
    /**
     * VBox layouting
     * @param {module:zrender/container/Group} group
     * @param {number} gap
     * @param {number} [width=Infinity]
     * @param {number} [height=Infinity]
     */
    layout.vbox = zrUtil.curry(boxLayout, 'vertical');
    /**
     * HBox layouting
     * @param {module:zrender/container/Group} group
     * @param {number} gap
     * @param {number} [width=Infinity]
     * @param {number} [height=Infinity]
     */
    layout.hbox = zrUtil.curry(boxLayout, 'horizontal');
    /**
     * If x or x2 is not specified or 'center' 'left' 'right',
     * the width would be as long as possible.
     * If y or y2 is not specified or 'middle' 'top' 'bottom',
     * the height would be as long as possible.
     *
     * @param {Object} positionInfo
     * @param {number|string} [positionInfo.x]
     * @param {number|string} [positionInfo.y]
     * @param {number|string} [positionInfo.x2]
     * @param {number|string} [positionInfo.y2]
     * @param {Object} containerRect
     * @param {string|number} margin
     * @return {Object} {width, height}
     */
    layout.getAvailableSize = function (positionInfo, containerRect, margin) {
        var containerWidth = containerRect.width;
        var containerHeight = containerRect.height;
        var x = parsePercent(positionInfo.x, containerWidth);
        var y = parsePercent(positionInfo.y, containerHeight);
        var x2 = parsePercent(positionInfo.x2, containerWidth);
        var y2 = parsePercent(positionInfo.y2, containerHeight);
        (isNaN(x) || isNaN(parseFloat(positionInfo.x))) && (x = 0);
        (isNaN(x2) || isNaN(parseFloat(positionInfo.x2))) && (x2 = containerWidth);
        (isNaN(y) || isNaN(parseFloat(positionInfo.y))) && (y = 0);
        (isNaN(y2) || isNaN(parseFloat(positionInfo.y2))) && (y2 = containerHeight);
        margin = formatUtil.normalizeCssArray(margin || 0);
        return {
            width: Math.max(x2 - x - margin[1] - margin[3], 0),
            height: Math.max(y2 - y - margin[0] - margin[2], 0)
        };
    };
    /**
     * Parse position info.
     *
     * @param {Object} positionInfo
     * @param {number|string} [positionInfo.left]
     * @param {number|string} [positionInfo.top]
     * @param {number|string} [positionInfo.right]
     * @param {number|string} [positionInfo.bottom]
     * @param {number|string} [positionInfo.width]
     * @param {number|string} [positionInfo.height]
     * @param {number|string} [positionInfo.aspect] Aspect is width / height
     * @param {Object} containerRect
     * @param {string|number} [margin]
     *
     * @return {module:zrender/core/BoundingRect}
     */
    layout.getLayoutRect = function (positionInfo, containerRect, margin) {
        margin = formatUtil.normalizeCssArray(margin || 0);
        var containerWidth = containerRect.width;
        var containerHeight = containerRect.height;
        var left = parsePercent(positionInfo.left, containerWidth);
        var top = parsePercent(positionInfo.top, containerHeight);
        var right = parsePercent(positionInfo.right, containerWidth);
        var bottom = parsePercent(positionInfo.bottom, containerHeight);
        var width = parsePercent(positionInfo.width, containerWidth);
        var height = parsePercent(positionInfo.height, containerHeight);
        var verticalMargin = margin[2] + margin[0];
        var horizontalMargin = margin[1] + margin[3];
        var aspect = positionInfo.aspect;
        // If width is not specified, calculate width from left and right
        if (isNaN(width)) {
            width = containerWidth - right - horizontalMargin - left;
        }
        if (isNaN(height)) {
            height = containerHeight - bottom - verticalMargin - top;
        }
        // If width and height are not given
        // 1. Graph should not exceeds the container
        // 2. Aspect must be keeped
        // 3. Graph should take the space as more as possible
        if (isNaN(width) && isNaN(height)) {
            if (aspect > containerWidth / containerHeight) {
                width = containerWidth * 0.8;
            } else {
                height = containerHeight * 0.8;
            }
        }
        if (aspect != null) {
            // Calculate width or height with given aspect
            if (isNaN(width)) {
                width = aspect * height;
            }
            if (isNaN(height)) {
                height = width / aspect;
            }
        }
        // If left is not specified, calculate left from right and width
        if (isNaN(left)) {
            left = containerWidth - right - width - horizontalMargin;
        }
        if (isNaN(top)) {
            top = containerHeight - bottom - height - verticalMargin;
        }
        // Align left and top
        switch (positionInfo.left || positionInfo.right) {
        case 'center':
            left = containerWidth / 2 - width / 2 - margin[3];
            break;
        case 'right':
            left = containerWidth - width - horizontalMargin;
            break;
        }
        switch (positionInfo.top || positionInfo.bottom) {
        case 'middle':
        case 'center':
            top = containerHeight / 2 - height / 2 - margin[0];
            break;
        case 'bottom':
            top = containerHeight - height - verticalMargin;
            break;
        }
        // If something is wrong and left, top, width, height are calculated as NaN
        left = left || 0;
        top = top || 0;
        if (isNaN(width)) {
            // Width may be NaN if only one value is given except width
            width = containerWidth - left - (right || 0);
        }
        if (isNaN(height)) {
            // Height may be NaN if only one value is given except height
            height = containerHeight - top - (bottom || 0);
        }
        var rect = new BoundingRect(left + margin[3], top + margin[0], width, height);
        rect.margin = margin;
        return rect;
    };
    /**
     * Position a zr element in viewport
     *  Group position is specified by either
     *  {left, top}, {right, bottom}
     *  If all properties exists, right and bottom will be igonred.
     *
     * Logic:
     *     1. Scale (against origin point in parent coord)
     *     2. Rotate (against origin point in parent coord)
     *     3. Traslate (with el.position by this method)
     * So this method only fixes the last step 'Traslate', which does not affect
     * scaling and rotating.
     *
     * If be called repeatly with the same input el, the same result will be gotten.
     *
     * @param {module:zrender/Element} el Should have `getBoundingRect` method.
     * @param {Object} positionInfo
     * @param {number|string} [positionInfo.left]
     * @param {number|string} [positionInfo.top]
     * @param {number|string} [positionInfo.right]
     * @param {number|string} [positionInfo.bottom]
     * @param {Object} containerRect
     * @param {string|number} margin
     * @param {Object} [opt]
     * @param {Array.<number>} [opt.hv=[1,1]] Only horizontal or only vertical.
     * @param {Array.<number>} [opt.boundingMode='all']
     *        Specify how to calculate boundingRect when locating.
     *        'all': Position the boundingRect that is transformed and uioned
     *               both itself and its descendants.
     *               This mode simplies confine the elements in the bounding
     *               of their container (e.g., using 'right: 0').
     *        'raw': Position the boundingRect that is not transformed and only itself.
     *               This mode is useful when you want a element can overflow its
     *               container. (Consider a rotated circle needs to be located in a corner.)
     *               In this mode positionInfo.width/height can only be number.
     */
    layout.positionElement = function (el, positionInfo, containerRect, margin, opt) {
        var h = !opt || !opt.hv || opt.hv[0];
        var v = !opt || !opt.hv || opt.hv[1];
        var boundingMode = opt && opt.boundingMode || 'all';
        if (!h && !v) {
            return;
        }
        var rect;
        if (boundingMode === 'raw') {
            rect = el.type === 'group' ? new BoundingRect(0, 0, +positionInfo.width || 0, +positionInfo.height || 0) : el.getBoundingRect();
        } else {
            rect = el.getBoundingRect();
            if (el.needLocalTransform()) {
                var transform = el.getLocalTransform();
                // Notice: raw rect may be inner object of el,
                // which should not be modified.
                rect = rect.clone();
                rect.applyTransform(transform);
            }
        }
        positionInfo = layout.getLayoutRect(zrUtil.defaults({
            width: rect.width,
            height: rect.height
        }, positionInfo), containerRect, margin);
        // Because 'tranlate' is the last step in transform
        // (see zrender/core/Transformable#getLocalTransfrom),
        // we can just only modify el.position to get final result.
        var elPos = el.position;
        var dx = h ? positionInfo.x - rect.x : 0;
        var dy = v ? positionInfo.y - rect.y : 0;
        el.attr('position', boundingMode === 'raw' ? [
            dx,
            dy
        ] : [
            elPos[0] + dx,
            elPos[1] + dy
        ]);
    };
    /**
     * Consider Case:
     * When defulat option has {left: 0, width: 100}, and we set {right: 0}
     * through setOption or media query, using normal zrUtil.merge will cause
     * {right: 0} does not take effect.
     *
     * @example
     * ComponentModel.extend({
     *     init: function () {
     *         ...
     *         var inputPositionParams = layout.getLayoutParams(option);
     *         this.mergeOption(inputPositionParams);
     *     },
     *     mergeOption: function (newOption) {
     *         newOption && zrUtil.merge(thisOption, newOption, true);
     *         layout.mergeLayoutParam(thisOption, newOption);
     *     }
     * });
     *
     * @param {Object} targetOption
     * @param {Object} newOption
     * @param {Object|string} [opt]
     * @param {boolean} [opt.ignoreSize=false] Some component must has width and height.
     */
    layout.mergeLayoutParam = function (targetOption, newOption, opt) {
        !zrUtil.isObject(opt) && (opt = {});
        var hNames = [
                'width',
                'left',
                'right'
            ];
        // Order by priority.
        var vNames = [
                'height',
                'top',
                'bottom'
            ];
        // Order by priority.
        var hResult = merge(hNames);
        var vResult = merge(vNames);
        copy(hNames, targetOption, hResult);
        copy(vNames, targetOption, vResult);
        function merge(names) {
            var newParams = {};
            var newValueCount = 0;
            var merged = {};
            var mergedValueCount = 0;
            var enoughParamNumber = opt.ignoreSize ? 1 : 2;
            each(names, function (name) {
                merged[name] = targetOption[name];
            });
            each(names, function (name) {
                // Consider case: newOption.width is null, which is
                // set by user for removing width setting.
                hasProp(newOption, name) && (newParams[name] = merged[name] = newOption[name]);
                hasValue(newParams, name) && newValueCount++;
                hasValue(merged, name) && mergedValueCount++;
            });
            // Case: newOption: {width: ..., right: ...},
            // or targetOption: {right: ...} and newOption: {width: ...},
            // There is no conflict when merged only has params count
            // little than enoughParamNumber.
            if (mergedValueCount === enoughParamNumber || !newValueCount) {
                return merged;
            }    // Case: newOption: {width: ..., right: ...},
                 // Than we can make sure user only want those two, and ignore
                 // all origin params in targetOption.
            else if (newValueCount >= enoughParamNumber) {
                return newParams;
            } else {
                // Chose another param from targetOption by priority.
                // When 'ignoreSize', enoughParamNumber is 1 and those will not happen.
                for (var i = 0; i < names.length; i++) {
                    var name = names[i];
                    if (!hasProp(newParams, name) && hasProp(targetOption, name)) {
                        newParams[name] = targetOption[name];
                        break;
                    }
                }
                return newParams;
            }
        }
        function hasProp(obj, name) {
            return obj.hasOwnProperty(name);
        }
        function hasValue(obj, name) {
            return obj[name] != null && obj[name] !== 'auto';
        }
        function copy(names, target, source) {
            each(names, function (name) {
                target[name] = source[name];
            });
        }
    };
    /**
     * Retrieve 'left', 'right', 'top', 'bottom', 'width', 'height' from object.
     * @param {Object} source
     * @return {Object} Result contains those props.
     */
    layout.getLayoutParams = function (source) {
        return layout.copyLayoutParams({}, source);
    };
    /**
     * Retrieve 'left', 'right', 'top', 'bottom', 'width', 'height' from object.
     * @param {Object} source
     * @return {Object} Result contains those props.
     */
    layout.copyLayoutParams = function (target, source) {
        source && target && each(LOCATION_PARAMS, function (name) {
            source.hasOwnProperty(name) && (target[name] = source[name]);
        });
        return target;
    };
    return layout;
});
define('echarts/component/legend/LegendModel', ['require', 'zrender/core/util', '../../model/Model', '../../echarts'], function (require) {
    'use strict';
    var zrUtil = require('zrender/core/util');
    var Model = require('../../model/Model');
    var LegendModel = require('../../echarts').extendComponentModel({
            type: 'legend',
            dependencies: ['series'],
            layoutMode: {
                type: 'box',
                ignoreSize: true
            },
            init: function (option, parentModel, ecModel) {
                this.mergeDefaultAndTheme(option, ecModel);
                option.selected = option.selected || {};
            },
            mergeOption: function (option) {
                LegendModel.superCall(this, 'mergeOption', option);
            },
            optionUpdated: function () {
                this._updateData(this.ecModel);
                var legendData = this._data;
                // If selectedMode is single, try to select one
                if (legendData[0] && this.get('selectedMode') === 'single') {
                    var hasSelected = false;
                    // If has any selected in option.selected
                    for (var i = 0; i < legendData.length; i++) {
                        var name = legendData[i].get('name');
                        if (this.isSelected(name)) {
                            // Force to unselect others
                            this.select(name);
                            hasSelected = true;
                            break;
                        }
                    }
                    // Try select the first if selectedMode is single
                    !hasSelected && this.select(legendData[0].get('name'));
                }
            },
            _updateData: function (ecModel) {
                var legendData = zrUtil.map(this.get('data') || [], function (dataItem) {
                        // Can be string or number
                        if (typeof dataItem === 'string' || typeof dataItem === 'number') {
                            dataItem = { name: dataItem };
                        }
                        return new Model(dataItem, this, this.ecModel);
                    }, this);
                this._data = legendData;
                var availableNames = zrUtil.map(ecModel.getSeries(), function (series) {
                        return series.name;
                    });
                ecModel.eachSeries(function (seriesModel) {
                    if (seriesModel.legendDataProvider) {
                        var data = seriesModel.legendDataProvider();
                        availableNames = availableNames.concat(data.mapArray(data.getName));
                    }
                });
                /**
             * @type {Array.<string>}
             * @private
             */
                this._availableNames = availableNames;
            },
            getData: function () {
                return this._data;
            },
            select: function (name) {
                var selected = this.option.selected;
                var selectedMode = this.get('selectedMode');
                if (selectedMode === 'single') {
                    var data = this._data;
                    zrUtil.each(data, function (dataItem) {
                        selected[dataItem.get('name')] = false;
                    });
                }
                selected[name] = true;
            },
            unSelect: function (name) {
                if (this.get('selectedMode') !== 'single') {
                    this.option.selected[name] = false;
                }
            },
            toggleSelected: function (name) {
                var selected = this.option.selected;
                // Default is true
                if (!selected.hasOwnProperty(name)) {
                    selected[name] = true;
                }
                this[selected[name] ? 'unSelect' : 'select'](name);
            },
            isSelected: function (name) {
                var selected = this.option.selected;
                return !(selected.hasOwnProperty(name) && !selected[name]) && zrUtil.indexOf(this._availableNames, name) >= 0;
            },
            defaultOption: {
                zlevel: 0,
                z: 4,
                show: true,
                orient: 'horizontal',
                left: 'center',
                top: 'top',
                align: 'auto',
                backgroundColor: 'rgba(0,0,0,0)',
                borderColor: '#ccc',
                borderWidth: 0,
                padding: 5,
                itemGap: 10,
                itemWidth: 25,
                itemHeight: 14,
                inactiveColor: '#ccc',
                textStyle: { color: '#333' },
                selectedMode: true,
                tooltip: { show: false }
            }
        });
    return LegendModel;
});
define('echarts/component/legend/legendAction', ['require', '../../echarts', 'zrender/core/util'], function (require) {
    var echarts = require('../../echarts');
    var zrUtil = require('zrender/core/util');
    function legendSelectActionHandler(methodName, payload, ecModel) {
        var selectedMap = {};
        var isToggleSelect = methodName === 'toggleSelected';
        var isSelected;
        // Update all legend components
        ecModel.eachComponent('legend', function (legendModel) {
            if (isToggleSelect && isSelected != null) {
                // Force other legend has same selected status
                // Or the first is toggled to true and other are toggled to false
                // In the case one legend has some item unSelected in option. And if other legend
                // doesn't has the item, they will assume it is selected.
                legendModel[isSelected ? 'select' : 'unSelect'](payload.name);
            } else {
                legendModel[methodName](payload.name);
                isSelected = legendModel.isSelected(payload.name);
            }
            var legendData = legendModel.getData();
            zrUtil.each(legendData, function (model) {
                var name = model.get('name');
                // Wrap element
                if (name === '\n' || name === '') {
                    return;
                }
                var isItemSelected = legendModel.isSelected(name);
                if (name in selectedMap) {
                    // Unselected if any legend is unselected
                    selectedMap[name] = selectedMap[name] && isItemSelected;
                } else {
                    selectedMap[name] = isItemSelected;
                }
            });
        });
        // Return the event explicitly
        return {
            name: payload.name,
            selected: selectedMap
        };
    }
    /**
     * @event legendToggleSelect
     * @type {Object}
     * @property {string} type 'legendToggleSelect'
     * @property {string} [from]
     * @property {string} name Series name or data item name
     */
    echarts.registerAction('legendToggleSelect', 'legendselectchanged', zrUtil.curry(legendSelectActionHandler, 'toggleSelected'));
    /**
     * @event legendSelect
     * @type {Object}
     * @property {string} type 'legendSelect'
     * @property {string} name Series name or data item name
     */
    echarts.registerAction('legendSelect', 'legendselected', zrUtil.curry(legendSelectActionHandler, 'select'));
    /**
     * @event legendUnSelect
     * @type {Object}
     * @property {string} type 'legendUnSelect'
     * @property {string} name Series name or data item name
     */
    echarts.registerAction('legendUnSelect', 'legendunselected', zrUtil.curry(legendSelectActionHandler, 'unSelect'));
});
define('echarts/component/legend/LegendView', ['require', 'zrender/core/util', '../../util/symbol', '../../util/graphic', '../helper/listComponent', '../../echarts'], function (require) {
    var zrUtil = require('zrender/core/util');
    var symbolCreator = require('../../util/symbol');
    var graphic = require('../../util/graphic');
    var listComponentHelper = require('../helper/listComponent');
    var curry = zrUtil.curry;
    function dispatchSelectAction(name, api) {
        api.dispatchAction({
            type: 'legendToggleSelect',
            name: name
        });
    }
    function dispatchHighlightAction(seriesModel, dataName, api) {
        // If element hover will move to a hoverLayer.
        var el = api.getZr().storage.getDisplayList()[0];
        if (!(el && el.useHoverLayer)) {
            seriesModel.get('legendHoverLink') && api.dispatchAction({
                type: 'highlight',
                seriesName: seriesModel.name,
                name: dataName
            });
        }
    }
    function dispatchDownplayAction(seriesModel, dataName, api) {
        // If element hover will move to a hoverLayer.
        var el = api.getZr().storage.getDisplayList()[0];
        if (!(el && el.useHoverLayer)) {
            seriesModel.get('legendHoverLink') && api.dispatchAction({
                type: 'downplay',
                seriesName: seriesModel.name,
                name: dataName
            });
        }
    }
    return require('../../echarts').extendComponentView({
        type: 'legend',
        init: function () {
            this._symbolTypeStore = {};
        },
        render: function (legendModel, ecModel, api) {
            var group = this.group;
            group.removeAll();
            if (!legendModel.get('show')) {
                return;
            }
            var selectMode = legendModel.get('selectedMode');
            var itemAlign = legendModel.get('align');
            if (itemAlign === 'auto') {
                itemAlign = legendModel.get('left') === 'right' && legendModel.get('orient') === 'vertical' ? 'right' : 'left';
            }
            var legendDrawedMap = {};
            zrUtil.each(legendModel.getData(), function (itemModel) {
                var name = itemModel.get('name');
                // Use empty string or \n as a newline string
                if (name === '' || name === '\n') {
                    group.add(new graphic.Group({ newline: true }));
                    return;
                }
                var seriesModel = ecModel.getSeriesByName(name)[0];
                if (legendDrawedMap[name]) {
                    // Have been drawed
                    return;
                }
                // Series legend
                if (seriesModel) {
                    var data = seriesModel.getData();
                    var color = data.getVisual('color');
                    // If color is a callback function
                    if (typeof color === 'function') {
                        // Use the first data
                        color = color(seriesModel.getDataParams(0));
                    }
                    // Using rect symbol defaultly
                    var legendSymbolType = data.getVisual('legendSymbol') || 'roundRect';
                    var symbolType = data.getVisual('symbol');
                    var itemGroup = this._createItem(name, itemModel, legendModel, legendSymbolType, symbolType, itemAlign, color, selectMode);
                    itemGroup.on('click', curry(dispatchSelectAction, name, api)).on('mouseover', curry(dispatchHighlightAction, seriesModel, null, api)).on('mouseout', curry(dispatchDownplayAction, seriesModel, null, api));
                    legendDrawedMap[name] = true;
                } else {
                    // Data legend of pie, funnel
                    ecModel.eachRawSeries(function (seriesModel) {
                        // In case multiple series has same data name
                        if (legendDrawedMap[name]) {
                            return;
                        }
                        if (seriesModel.legendDataProvider) {
                            var data = seriesModel.legendDataProvider();
                            var idx = data.indexOfName(name);
                            if (idx < 0) {
                                return;
                            }
                            var color = data.getItemVisual(idx, 'color');
                            var legendSymbolType = 'roundRect';
                            var itemGroup = this._createItem(name, itemModel, legendModel, legendSymbolType, null, itemAlign, color, selectMode);
                            itemGroup.on('click', curry(dispatchSelectAction, name, api)).on('mouseover', curry(dispatchHighlightAction, seriesModel, name, api)).on('mouseout', curry(dispatchDownplayAction, seriesModel, name, api));
                            legendDrawedMap[name] = true;
                        }
                    }, this);
                }
                if (true) {
                    if (!legendDrawedMap[name]) {
                        console.warn(name + ' series not exists. Legend data should be same with series name or data name.');
                    }
                }
            }, this);
            listComponentHelper.layout(group, legendModel, api);
            // Render background after group is layout
            // FIXME
            listComponentHelper.addBackground(group, legendModel);
        },
        _createItem: function (name, itemModel, legendModel, legendSymbolType, symbolType, itemAlign, color, selectMode) {
            var itemWidth = legendModel.get('itemWidth');
            var itemHeight = legendModel.get('itemHeight');
            var inactiveColor = legendModel.get('inactiveColor');
            var isSelected = legendModel.isSelected(name);
            var itemGroup = new graphic.Group();
            var textStyleModel = itemModel.getModel('textStyle');
            var itemIcon = itemModel.get('icon');
            var tooltipModel = itemModel.getModel('tooltip');
            var legendGlobalTooltipModel = tooltipModel.parentModel;
            // Use user given icon first
            legendSymbolType = itemIcon || legendSymbolType;
            itemGroup.add(symbolCreator.createSymbol(legendSymbolType, 0, 0, itemWidth, itemHeight, isSelected ? color : inactiveColor));
            // Compose symbols
            // PENDING
            if (!itemIcon && symbolType && (symbolType !== legendSymbolType || symbolType == 'none')) {
                var size = itemHeight * 0.8;
                if (symbolType === 'none') {
                    symbolType = 'circle';
                }
                // Put symbol in the center
                itemGroup.add(symbolCreator.createSymbol(symbolType, (itemWidth - size) / 2, (itemHeight - size) / 2, size, size, isSelected ? color : inactiveColor));
            }
            // Text
            var textX = itemAlign === 'left' ? itemWidth + 5 : -5;
            var textAlign = itemAlign;
            var formatter = legendModel.get('formatter');
            var content = name;
            if (typeof formatter === 'string' && formatter) {
                content = formatter.replace('{name}', name != null ? name : '');
            } else if (typeof formatter === 'function') {
                content = formatter(name);
            }
            var text = new graphic.Text({
                    style: {
                        text: content,
                        x: textX,
                        y: itemHeight / 2,
                        fill: isSelected ? textStyleModel.getTextColor() : inactiveColor,
                        textFont: textStyleModel.getFont(),
                        textAlign: textAlign,
                        textVerticalAlign: 'middle'
                    }
                });
            itemGroup.add(text);
            // Add a invisible rect to increase the area of mouse hover
            var hitRect = new graphic.Rect({
                    shape: itemGroup.getBoundingRect(),
                    invisible: true,
                    tooltip: tooltipModel.get('show') ? zrUtil.extend({
                        content: name,
                        formatter: legendGlobalTooltipModel.get('formatter', true) || function () {
                            return name;
                        },
                        formatterParams: {
                            componentType: 'legend',
                            legendIndex: legendModel.componentIndex,
                            name: name,
                            $vars: ['name']
                        }
                    }, tooltipModel.option) : null
                });
            itemGroup.add(hitRect);
            itemGroup.eachChild(function (child) {
                child.silent = true;
            });
            hitRect.silent = !selectMode;
            this.group.add(itemGroup);
            graphic.setHoverStyle(itemGroup);
            return itemGroup;
        }
    });
});
define('echarts/component/legend/legendFilter', [], function () {
    return function (ecModel) {
        var legendModels = ecModel.findComponents({ mainType: 'legend' });
        if (legendModels && legendModels.length) {
            ecModel.filterSeries(function (series) {
                // If in any legend component the status is not selected.
                // Because in legend series is assumed selected when it is not in the legend data.
                for (var i = 0; i < legendModels.length; i++) {
                    if (!legendModels[i].isSelected(series.name)) {
                        return false;
                    }
                }
                return true;
            });
        }
    };
});
define('echarts/component/tooltip/TooltipModel', ['require', '../../echarts'], function (require) {
    require('../../echarts').extendComponentModel({
        type: 'tooltip',
        defaultOption: {
            zlevel: 0,
            z: 8,
            show: true,
            showContent: true,
            trigger: 'item',
            triggerOn: 'mousemove',
            alwaysShowContent: false,
            confine: false,
            showDelay: 0,
            hideDelay: 100,
            transitionDuration: 0.4,
            enterable: false,
            backgroundColor: 'rgba(50,50,50,0.7)',
            borderColor: '#333',
            borderRadius: 4,
            borderWidth: 0,
            padding: 5,
            extraCssText: '',
            axisPointer: {
                type: 'line',
                axis: 'auto',
                animation: true,
                animationDurationUpdate: 200,
                animationEasingUpdate: 'exponentialOut',
                lineStyle: {
                    color: '#555',
                    width: 1,
                    type: 'solid'
                },
                crossStyle: {
                    color: '#555',
                    width: 1,
                    type: 'dashed',
                    textStyle: {}
                },
                shadowStyle: { color: 'rgba(150,150,150,0.3)' }
            },
            textStyle: {
                color: '#fff',
                fontSize: 14
            }
        }
    });
});
define('echarts/component/tooltip/TooltipView', ['require', './TooltipContent', '../../util/graphic', 'zrender/core/util', '../../util/format', '../../util/number', '../../util/model', 'zrender/core/env', '../../model/Model', '../../echarts'], function (require) {
    var TooltipContent = require('./TooltipContent');
    var graphic = require('../../util/graphic');
    var zrUtil = require('zrender/core/util');
    var formatUtil = require('../../util/format');
    var numberUtil = require('../../util/number');
    var modelUtil = require('../../util/model');
    var parsePercent = numberUtil.parsePercent;
    var env = require('zrender/core/env');
    var Model = require('../../model/Model');
    function dataEqual(a, b) {
        if (!a || !b) {
            return false;
        }
        var round = numberUtil.round;
        return round(a[0]) === round(b[0]) && round(a[1]) === round(b[1]);
    }
    /**
     * @inner
     */
    function makeLineShape(x1, y1, x2, y2) {
        return {
            x1: x1,
            y1: y1,
            x2: x2,
            y2: y2
        };
    }
    /**
     * @inner
     */
    function makeRectShape(x, y, width, height) {
        return {
            x: x,
            y: y,
            width: width,
            height: height
        };
    }
    /**
     * @inner
     */
    function makeSectorShape(cx, cy, r0, r, startAngle, endAngle) {
        return {
            cx: cx,
            cy: cy,
            r0: r0,
            r: r,
            startAngle: startAngle,
            endAngle: endAngle,
            clockwise: true
        };
    }
    function refixTooltipPosition(x, y, el, viewWidth, viewHeight) {
        var width = el.clientWidth;
        var height = el.clientHeight;
        var gap = 20;
        if (x + width + gap > viewWidth) {
            x -= width + gap;
        } else {
            x += gap;
        }
        if (y + height + gap > viewHeight) {
            y -= height + gap;
        } else {
            y += gap;
        }
        return [
            x,
            y
        ];
    }
    function confineTooltipPosition(x, y, el, viewWidth, viewHeight) {
        var width = el.clientWidth;
        var height = el.clientHeight;
        x = Math.min(x + width, viewWidth) - width;
        y = Math.min(y + height, viewHeight) - height;
        x = Math.max(x, 0);
        y = Math.max(y, 0);
        return [
            x,
            y
        ];
    }
    function calcTooltipPosition(position, rect, dom) {
        var domWidth = dom.clientWidth;
        var domHeight = dom.clientHeight;
        var gap = 5;
        var x = 0;
        var y = 0;
        var rectWidth = rect.width;
        var rectHeight = rect.height;
        switch (position) {
        case 'inside':
            x = rect.x + rectWidth / 2 - domWidth / 2;
            y = rect.y + rectHeight / 2 - domHeight / 2;
            break;
        case 'top':
            x = rect.x + rectWidth / 2 - domWidth / 2;
            y = rect.y - domHeight - gap;
            break;
        case 'bottom':
            x = rect.x + rectWidth / 2 - domWidth / 2;
            y = rect.y + rectHeight + gap;
            break;
        case 'left':
            x = rect.x - domWidth - gap;
            y = rect.y + rectHeight / 2 - domHeight / 2;
            break;
        case 'right':
            x = rect.x + rectWidth + gap;
            y = rect.y + rectHeight / 2 - domHeight / 2;
        }
        return [
            x,
            y
        ];
    }
    /**
     * @param  {string|Function|Array.<number>} positionExpr
     * @param  {number} x Mouse x
     * @param  {number} y Mouse y
     * @param  {boolean} confine Whether confine tooltip content in view rect.
     * @param  {module:echarts/component/tooltip/TooltipContent} content
     * @param  {Object|<Array.<Object>} params
     * @param  {module:zrender/Element} el target element
     * @param  {module:echarts/ExtensionAPI} api
     * @return {Array.<number>}
     */
    function updatePosition(positionExpr, x, y, confine, content, params, el, api) {
        var viewWidth = api.getWidth();
        var viewHeight = api.getHeight();
        var rect = el && el.getBoundingRect().clone();
        el && rect.applyTransform(el.transform);
        if (typeof positionExpr === 'function') {
            // Callback of position can be an array or a string specify the position
            positionExpr = positionExpr([
                x,
                y
            ], params, content.el, rect);
        }
        if (zrUtil.isArray(positionExpr)) {
            x = parsePercent(positionExpr[0], viewWidth);
            y = parsePercent(positionExpr[1], viewHeight);
        }    // Specify tooltip position by string 'top' 'bottom' 'left' 'right' around graphic element
        else if (typeof positionExpr === 'string' && el) {
            var pos = calcTooltipPosition(positionExpr, rect, content.el);
            x = pos[0];
            y = pos[1];
        } else {
            var pos = refixTooltipPosition(x, y, content.el, viewWidth, viewHeight);
            x = pos[0];
            y = pos[1];
        }
        if (confine) {
            var pos = confineTooltipPosition(x, y, content.el, viewWidth, viewHeight);
            x = pos[0];
            y = pos[1];
        }
        content.moveTo(x, y);
    }
    function ifSeriesSupportAxisTrigger(seriesModel) {
        var coordSys = seriesModel.coordinateSystem;
        var trigger = seriesModel.get('tooltip.trigger', true);
        // Ignore series use item tooltip trigger and series coordinate system is not cartesian or
        return !(!coordSys || coordSys.type !== 'cartesian2d' && coordSys.type !== 'polar' && coordSys.type !== 'singleAxis' || trigger === 'item');
    }
    require('../../echarts').extendComponentView({
        type: 'tooltip',
        _axisPointers: {},
        init: function (ecModel, api) {
            if (env.node) {
                return;
            }
            var tooltipContent = new TooltipContent(api.getDom(), api);
            this._tooltipContent = tooltipContent;
            api.on('showTip', this._manuallyShowTip, this);
            api.on('hideTip', this._manuallyHideTip, this);
        },
        render: function (tooltipModel, ecModel, api) {
            if (env.node) {
                return;
            }
            // Reset
            this.group.removeAll();
            /**
             * @type {Object}
             * @private
             */
            this._axisPointers = {};
            /**
             * @private
             * @type {module:echarts/component/tooltip/TooltipModel}
             */
            this._tooltipModel = tooltipModel;
            /**
             * @private
             * @type {module:echarts/model/Global}
             */
            this._ecModel = ecModel;
            /**
             * @private
             * @type {module:echarts/ExtensionAPI}
             */
            this._api = api;
            /**
             * @type {Object}
             * @private
             */
            this._lastHover = {};
            var tooltipContent = this._tooltipContent;
            tooltipContent.update();
            tooltipContent.enterable = tooltipModel.get('enterable');
            this._alwaysShowContent = tooltipModel.get('alwaysShowContent');
            /**
             * @type {Object.<string, Array>}
             */
            this._seriesGroupByAxis = this._prepareAxisTriggerData(tooltipModel, ecModel);
            var crossText = this._crossText;
            if (crossText) {
                this.group.add(crossText);
            }
            var triggerOn = tooltipModel.get('triggerOn');
            // Try to keep the tooltip show when refreshing
            if (this._lastX != null && this._lastY != null && triggerOn !== 'none') {
                var self = this;
                clearTimeout(this._refreshUpdateTimeout);
                this._refreshUpdateTimeout = setTimeout(function () {
                    // Show tip next tick after other charts are rendered
                    // In case highlight action has wrong result
                    // FIXME
                    self._manuallyShowTip({
                        x: self._lastX,
                        y: self._lastY
                    });
                });
            }
            var zr = this._api.getZr();
            zr.off('click', this._tryShow);
            zr.off('mousemove', this._mousemove);
            zr.off('mouseout', this._hide);
            zr.off('globalout', this._hide);
            if (triggerOn === 'click') {
                zr.on('click', this._tryShow, this);
            } else if (triggerOn === 'mousemove') {
                zr.on('mousemove', this._mousemove, this);
                zr.on('mouseout', this._hide, this);
                zr.on('globalout', this._hide, this);
            }    // else triggerOn is 'none', which enable user
                 // to control tooltip totally using API.
        },
        _mousemove: function (e) {
            var showDelay = this._tooltipModel.get('showDelay');
            var self = this;
            clearTimeout(this._showTimeout);
            if (showDelay > 0) {
                this._showTimeout = setTimeout(function () {
                    self._tryShow(e);
                }, showDelay);
            } else {
                this._tryShow(e);
            }
        },
        _manuallyShowTip: function (event) {
            // From self
            if (event.from === this.uid) {
                return;
            }
            var ecModel = this._ecModel;
            var seriesIndex = event.seriesIndex;
            var seriesModel = ecModel.getSeriesByIndex(seriesIndex);
            var api = this._api;
            var isTriggerAxis = this._tooltipModel.get('trigger') === 'axis';
            function seriesHaveDataOnIndex(_series) {
                var data = _series.getData();
                var dataIndex = modelUtil.queryDataIndex(data, event);
                // Have single dataIndex
                if (dataIndex != null && !zrUtil.isArray(dataIndex) && data.hasValue(dataIndex)) {
                    return true;
                }
            }
            if (event.x == null || event.y == null) {
                if (isTriggerAxis) {
                    // Find another series.
                    if (seriesModel && !seriesHaveDataOnIndex(seriesModel)) {
                        seriesModel = null;
                    }
                    if (!seriesModel) {
                        // Find the first series can use axis trigger And data is not null
                        ecModel.eachSeries(function (_series) {
                            if (ifSeriesSupportAxisTrigger(_series) && !seriesModel) {
                                if (seriesHaveDataOnIndex(_series)) {
                                    seriesModel = _series;
                                }
                            }
                        });
                    }
                } else {
                    // Use the first series by default.
                    seriesModel = seriesModel || ecModel.getSeriesByIndex(0);
                }
                if (seriesModel) {
                    var data = seriesModel.getData();
                    var dataIndex = modelUtil.queryDataIndex(data, event);
                    if (dataIndex == null || zrUtil.isArray(dataIndex)) {
                        return;
                    }
                    var el = data.getItemGraphicEl(dataIndex);
                    var cx;
                    var cy;
                    // Try to get the point in coordinate system
                    var coordSys = seriesModel.coordinateSystem;
                    if (seriesModel.getTooltipPosition) {
                        var point = seriesModel.getTooltipPosition(dataIndex) || [];
                        cx = point[0];
                        cy = point[1];
                    } else if (coordSys && coordSys.dataToPoint) {
                        var point = coordSys.dataToPoint(data.getValues(zrUtil.map(coordSys.dimensions, function (dim) {
                                return seriesModel.coordDimToDataDim(dim)[0];
                            }), dataIndex, true));
                        cx = point && point[0];
                        cy = point && point[1];
                    } else if (el) {
                        // Use graphic bounding rect
                        var rect = el.getBoundingRect().clone();
                        rect.applyTransform(el.transform);
                        cx = rect.x + rect.width / 2;
                        cy = rect.y + rect.height / 2;
                    }
                    if (cx != null && cy != null) {
                        this._tryShow({
                            offsetX: cx,
                            offsetY: cy,
                            position: event.position,
                            target: el,
                            event: {}
                        });
                    }
                }
            } else {
                var el = api.getZr().handler.findHover(event.x, event.y);
                this._tryShow({
                    offsetX: event.x,
                    offsetY: event.y,
                    position: event.position,
                    target: el,
                    event: {}
                });
            }
        },
        _manuallyHideTip: function (e) {
            if (e.from === this.uid) {
                return;
            }
            this._hide();
        },
        _prepareAxisTriggerData: function (tooltipModel, ecModel) {
            // Prepare data for axis trigger
            var seriesGroupByAxis = {};
            ecModel.eachSeries(function (seriesModel) {
                if (ifSeriesSupportAxisTrigger(seriesModel)) {
                    var coordSys = seriesModel.coordinateSystem;
                    var baseAxis;
                    var key;
                    // Only cartesian2d, polar and single support axis trigger
                    if (coordSys.type === 'cartesian2d') {
                        // FIXME `axisPointer.axis` is not baseAxis
                        baseAxis = coordSys.getBaseAxis();
                        key = baseAxis.dim + baseAxis.index;
                    } else if (coordSys.type === 'singleAxis') {
                        baseAxis = coordSys.getAxis();
                        key = baseAxis.dim + baseAxis.type;
                    } else {
                        baseAxis = coordSys.getBaseAxis();
                        key = baseAxis.dim + coordSys.name;
                    }
                    seriesGroupByAxis[key] = seriesGroupByAxis[key] || {
                        coordSys: [],
                        series: []
                    };
                    seriesGroupByAxis[key].coordSys.push(coordSys);
                    seriesGroupByAxis[key].series.push(seriesModel);
                }
            }, this);
            return seriesGroupByAxis;
        },
        _tryShow: function (e) {
            var el = e.target;
            var tooltipModel = this._tooltipModel;
            var globalTrigger = tooltipModel.get('trigger');
            var ecModel = this._ecModel;
            var api = this._api;
            if (!tooltipModel) {
                return;
            }
            // Save mouse x, mouse y. So we can try to keep showing the tip if chart is refreshed
            this._lastX = e.offsetX;
            this._lastY = e.offsetY;
            // Always show item tooltip if mouse is on the element with dataIndex
            if (el && el.dataIndex != null) {
                // Use dataModel in element if possible
                // Used when mouseover on a element like markPoint or edge
                // In which case, the data is not main data in series.
                var dataModel = el.dataModel || ecModel.getSeriesByIndex(el.seriesIndex);
                var dataIndex = el.dataIndex;
                var itemModel = dataModel.getData().getItemModel(dataIndex);
                // Series or single data may use item trigger when global is axis trigger
                if ((itemModel.get('tooltip.trigger') || globalTrigger) === 'axis') {
                    this._showAxisTooltip(tooltipModel, ecModel, e);
                } else {
                    // Reset ticket
                    this._ticket = '';
                    // If either single data or series use item trigger
                    this._hideAxisPointer();
                    // Reset last hover and dispatch downplay action
                    this._resetLastHover();
                    this._showItemTooltipContent(dataModel, dataIndex, el.dataType, e);
                }
                api.dispatchAction({
                    type: 'showTip',
                    from: this.uid,
                    dataIndexInside: el.dataIndex,
                    seriesIndex: el.seriesIndex
                });
            }    // Tooltip provided directly. Like legend
            else if (el && el.tooltip) {
                var tooltipOpt = el.tooltip;
                if (typeof tooltipOpt === 'string') {
                    var content = tooltipOpt;
                    tooltipOpt = {
                        content: content,
                        formatter: content
                    };
                }
                var subTooltipModel = new Model(tooltipOpt, tooltipModel);
                var defaultHtml = subTooltipModel.get('content');
                var asyncTicket = Math.random();
                this._showTooltipContent(subTooltipModel, defaultHtml, subTooltipModel.get('formatterParams') || {}, asyncTicket, e.offsetX, e.offsetY, e.position, el, api);
            } else {
                if (globalTrigger === 'item') {
                    this._hide();
                } else {
                    // Try show axis tooltip
                    this._showAxisTooltip(tooltipModel, ecModel, e);
                }
                // Action of cross pointer
                // other pointer types will trigger action in _dispatchAndShowSeriesTooltipContent method
                if (tooltipModel.get('axisPointer.type') === 'cross') {
                    api.dispatchAction({
                        type: 'showTip',
                        from: this.uid,
                        x: e.offsetX,
                        y: e.offsetY
                    });
                }
            }
        },
        _showAxisTooltip: function (tooltipModel, ecModel, e) {
            var axisPointerModel = tooltipModel.getModel('axisPointer');
            var axisPointerType = axisPointerModel.get('type');
            if (axisPointerType === 'cross') {
                var el = e.target;
                if (el && el.dataIndex != null) {
                    var seriesModel = ecModel.getSeriesByIndex(el.seriesIndex);
                    var dataIndex = el.dataIndex;
                    this._showItemTooltipContent(seriesModel, dataIndex, el.dataType, e);
                }
            }
            this._showAxisPointer();
            var allNotShow = true;
            zrUtil.each(this._seriesGroupByAxis, function (seriesCoordSysSameAxis) {
                // Try show the axis pointer
                var allCoordSys = seriesCoordSysSameAxis.coordSys;
                var coordSys = allCoordSys[0];
                // If mouse position is not in the grid or polar
                var point = [
                        e.offsetX,
                        e.offsetY
                    ];
                if (!coordSys.containPoint(point)) {
                    // Hide axis pointer
                    this._hideAxisPointer(coordSys.name);
                    return;
                }
                allNotShow = false;
                // Make sure point is discrete on cateogry axis
                var dimensions = coordSys.dimensions;
                var value = coordSys.pointToData(point, true);
                point = coordSys.dataToPoint(value);
                var baseAxis = coordSys.getBaseAxis();
                var axisType = axisPointerModel.get('axis');
                if (axisType === 'auto') {
                    axisType = baseAxis.dim;
                }
                var contentNotChange = false;
                var lastHover = this._lastHover;
                if (axisPointerType === 'cross') {
                    // If hover data not changed
                    // Possible when two axes are all category
                    if (dataEqual(lastHover.data, value)) {
                        contentNotChange = true;
                    }
                    lastHover.data = value;
                } else {
                    var valIndex = zrUtil.indexOf(dimensions, axisType);
                    // If hover data not changed on the axis dimension
                    if (lastHover.data === value[valIndex]) {
                        contentNotChange = true;
                    }
                    lastHover.data = value[valIndex];
                }
                var enableAnimation = tooltipModel.get('animation');
                if (coordSys.type === 'cartesian2d' && !contentNotChange) {
                    this._showCartesianPointer(axisPointerModel, coordSys, axisType, point, enableAnimation);
                } else if (coordSys.type === 'polar' && !contentNotChange) {
                    this._showPolarPointer(axisPointerModel, coordSys, axisType, point, enableAnimation);
                } else if (coordSys.type === 'singleAxis' && !contentNotChange) {
                    this._showSinglePointer(axisPointerModel, coordSys, axisType, point, enableAnimation);
                }
                if (axisPointerType !== 'cross') {
                    this._dispatchAndShowSeriesTooltipContent(coordSys, seriesCoordSysSameAxis.series, point, value, contentNotChange, e.position);
                }
            }, this);
            if (!this._tooltipModel.get('show')) {
                this._hideAxisPointer();
            }
            if (allNotShow) {
                this._hide();
            }
        },
        _showCartesianPointer: function (axisPointerModel, cartesian, axisType, point, enableAnimation) {
            var self = this;
            var axisPointerType = axisPointerModel.get('type');
            var baseAxis = cartesian.getBaseAxis();
            var moveAnimation = enableAnimation && axisPointerType !== 'cross' && baseAxis.type === 'category' && baseAxis.getBandWidth() > 20;
            if (axisPointerType === 'cross') {
                moveGridLine('x', point, cartesian.getAxis('y').getGlobalExtent());
                moveGridLine('y', point, cartesian.getAxis('x').getGlobalExtent());
                this._updateCrossText(cartesian, point, axisPointerModel);
            } else {
                var otherAxis = cartesian.getAxis(axisType === 'x' ? 'y' : 'x');
                var otherExtent = otherAxis.getGlobalExtent();
                if (cartesian.type === 'cartesian2d') {
                    (axisPointerType === 'line' ? moveGridLine : moveGridShadow)(axisType, point, otherExtent);
                }
            }
            /**
             * @inner
             */
            function moveGridLine(axisType, point, otherExtent) {
                var targetShape = axisType === 'x' ? makeLineShape(point[0], otherExtent[0], point[0], otherExtent[1]) : makeLineShape(otherExtent[0], point[1], otherExtent[1], point[1]);
                var pointerEl = self._getPointerElement(cartesian, axisPointerModel, axisType, targetShape);
                graphic.subPixelOptimizeLine({
                    shape: targetShape,
                    style: pointerEl.style
                });
                moveAnimation ? graphic.updateProps(pointerEl, { shape: targetShape }, axisPointerModel) : pointerEl.attr({ shape: targetShape });
            }
            /**
             * @inner
             */
            function moveGridShadow(axisType, point, otherExtent) {
                var axis = cartesian.getAxis(axisType);
                var bandWidth = axis.getBandWidth();
                var span = otherExtent[1] - otherExtent[0];
                var targetShape = axisType === 'x' ? makeRectShape(point[0] - bandWidth / 2, otherExtent[0], bandWidth, span) : makeRectShape(otherExtent[0], point[1] - bandWidth / 2, span, bandWidth);
                var pointerEl = self._getPointerElement(cartesian, axisPointerModel, axisType, targetShape);
                moveAnimation ? graphic.updateProps(pointerEl, { shape: targetShape }, axisPointerModel) : pointerEl.attr({ shape: targetShape });
            }
        },
        _showSinglePointer: function (axisPointerModel, single, axisType, point, enableAnimation) {
            var self = this;
            var axisPointerType = axisPointerModel.get('type');
            var moveAnimation = enableAnimation && axisPointerType !== 'cross' && single.getBaseAxis().type === 'category';
            var rect = single.getRect();
            var otherExtent = [
                    rect.y,
                    rect.y + rect.height
                ];
            moveSingleLine(axisType, point, otherExtent);
            /**
             * @inner
             */
            function moveSingleLine(axisType, point, otherExtent) {
                var axis = single.getAxis();
                var orient = axis.orient;
                var targetShape = orient === 'horizontal' ? makeLineShape(point[0], otherExtent[0], point[0], otherExtent[1]) : makeLineShape(otherExtent[0], point[1], otherExtent[1], point[1]);
                var pointerEl = self._getPointerElement(single, axisPointerModel, axisType, targetShape);
                moveAnimation ? graphic.updateProps(pointerEl, { shape: targetShape }, axisPointerModel) : pointerEl.attr({ shape: targetShape });
            }
        },
        _showPolarPointer: function (axisPointerModel, polar, axisType, point, enableAnimation) {
            var self = this;
            var axisPointerType = axisPointerModel.get('type');
            var angleAxis = polar.getAngleAxis();
            var radiusAxis = polar.getRadiusAxis();
            var moveAnimation = enableAnimation && axisPointerType !== 'cross' && polar.getBaseAxis().type === 'category';
            if (axisPointerType === 'cross') {
                movePolarLine('angle', point, radiusAxis.getExtent());
                movePolarLine('radius', point, angleAxis.getExtent());
                this._updateCrossText(polar, point, axisPointerModel);
            } else {
                var otherAxis = polar.getAxis(axisType === 'radius' ? 'angle' : 'radius');
                var otherExtent = otherAxis.getExtent();
                (axisPointerType === 'line' ? movePolarLine : movePolarShadow)(axisType, point, otherExtent);
            }
            /**
             * @inner
             */
            function movePolarLine(axisType, point, otherExtent) {
                var mouseCoord = polar.pointToCoord(point);
                var targetShape;
                if (axisType === 'angle') {
                    var p1 = polar.coordToPoint([
                            otherExtent[0],
                            mouseCoord[1]
                        ]);
                    var p2 = polar.coordToPoint([
                            otherExtent[1],
                            mouseCoord[1]
                        ]);
                    targetShape = makeLineShape(p1[0], p1[1], p2[0], p2[1]);
                } else {
                    targetShape = {
                        cx: polar.cx,
                        cy: polar.cy,
                        r: mouseCoord[0]
                    };
                }
                var pointerEl = self._getPointerElement(polar, axisPointerModel, axisType, targetShape);
                moveAnimation ? graphic.updateProps(pointerEl, { shape: targetShape }, axisPointerModel) : pointerEl.attr({ shape: targetShape });
            }
            /**
             * @inner
             */
            function movePolarShadow(axisType, point, otherExtent) {
                var axis = polar.getAxis(axisType);
                var bandWidth = axis.getBandWidth();
                var mouseCoord = polar.pointToCoord(point);
                var targetShape;
                var radian = Math.PI / 180;
                if (axisType === 'angle') {
                    targetShape = makeSectorShape(polar.cx, polar.cy, otherExtent[0], otherExtent[1], (-mouseCoord[1] - bandWidth / 2) * radian, (-mouseCoord[1] + bandWidth / 2) * radian);
                } else {
                    targetShape = makeSectorShape(polar.cx, polar.cy, mouseCoord[0] - bandWidth / 2, mouseCoord[0] + bandWidth / 2, 0, Math.PI * 2);
                }
                var pointerEl = self._getPointerElement(polar, axisPointerModel, axisType, targetShape);
                moveAnimation ? graphic.updateProps(pointerEl, { shape: targetShape }, axisPointerModel) : pointerEl.attr({ shape: targetShape });
            }
        },
        _updateCrossText: function (coordSys, point, axisPointerModel) {
            var crossStyleModel = axisPointerModel.getModel('crossStyle');
            var textStyleModel = crossStyleModel.getModel('textStyle');
            var tooltipModel = this._tooltipModel;
            var text = this._crossText;
            if (!text) {
                text = this._crossText = new graphic.Text({
                    style: {
                        textAlign: 'left',
                        textVerticalAlign: 'bottom'
                    }
                });
                this.group.add(text);
            }
            var value = coordSys.pointToData(point);
            var dims = coordSys.dimensions;
            value = zrUtil.map(value, function (val, idx) {
                var axis = coordSys.getAxis(dims[idx]);
                if (axis.type === 'category' || axis.type === 'time') {
                    val = axis.scale.getLabel(val);
                } else {
                    val = formatUtil.addCommas(val.toFixed(axis.getPixelPrecision()));
                }
                return val;
            });
            text.setStyle({
                fill: textStyleModel.getTextColor() || crossStyleModel.get('color'),
                textFont: textStyleModel.getFont(),
                text: value.join(', '),
                x: point[0] + 5,
                y: point[1] - 5
            });
            text.z = tooltipModel.get('z');
            text.zlevel = tooltipModel.get('zlevel');
        },
        _getPointerElement: function (coordSys, pointerModel, axisType, initShape) {
            var tooltipModel = this._tooltipModel;
            var z = tooltipModel.get('z');
            var zlevel = tooltipModel.get('zlevel');
            var axisPointers = this._axisPointers;
            var coordSysName = coordSys.name;
            axisPointers[coordSysName] = axisPointers[coordSysName] || {};
            if (axisPointers[coordSysName][axisType]) {
                return axisPointers[coordSysName][axisType];
            }
            // Create if not exists
            var pointerType = pointerModel.get('type');
            var styleModel = pointerModel.getModel(pointerType + 'Style');
            var isShadow = pointerType === 'shadow';
            var style = styleModel[isShadow ? 'getAreaStyle' : 'getLineStyle']();
            var elementType = coordSys.type === 'polar' ? isShadow ? 'Sector' : axisType === 'radius' ? 'Circle' : 'Line' : isShadow ? 'Rect' : 'Line';
            isShadow ? style.stroke = null : style.fill = null;
            var el = axisPointers[coordSysName][axisType] = new graphic[elementType]({
                    style: style,
                    z: z,
                    zlevel: zlevel,
                    silent: true,
                    shape: initShape
                });
            this.group.add(el);
            return el;
        },
        _dispatchAndShowSeriesTooltipContent: function (coordSys, seriesList, point, value, contentNotChange, positionExpr) {
            var rootTooltipModel = this._tooltipModel;
            var baseAxis = coordSys.getBaseAxis();
            var baseDimIndex = baseAxis.dim === 'x' || baseAxis.dim === 'radius' ? 0 : 1;
            var payloadBatch = zrUtil.map(seriesList, function (series) {
                    return {
                        seriesIndex: series.seriesIndex,
                        dataIndexInside: series.getAxisTooltipDataIndex ? series.getAxisTooltipDataIndex(series.coordDimToDataDim(baseAxis.dim), value, baseAxis) : series.getData().indexOfNearest(series.coordDimToDataDim(baseAxis.dim)[0], value[baseDimIndex], false, baseAxis.type === 'category' ? 0.5 : null)
                    };
                });
            var sampleSeriesIndex;
            zrUtil.each(payloadBatch, function (payload, idx) {
                if (seriesList[idx].getData().hasValue(payload.dataIndexInside)) {
                    sampleSeriesIndex = idx;
                }
            });
            // Fallback to 0.
            sampleSeriesIndex = sampleSeriesIndex || 0;
            var lastHover = this._lastHover;
            var api = this._api;
            // Dispatch downplay action
            if (lastHover.payloadBatch && !contentNotChange) {
                api.dispatchAction({
                    type: 'downplay',
                    batch: lastHover.payloadBatch
                });
            }
            // Dispatch highlight action
            if (!contentNotChange) {
                api.dispatchAction({
                    type: 'highlight',
                    batch: payloadBatch
                });
                lastHover.payloadBatch = payloadBatch;
            }
            // Dispatch showTip action
            api.dispatchAction({
                type: 'showTip',
                dataIndexInside: payloadBatch[sampleSeriesIndex].dataIndexInside,
                seriesIndex: payloadBatch[sampleSeriesIndex].seriesIndex,
                from: this.uid
            });
            if (baseAxis && rootTooltipModel.get('showContent') && rootTooltipModel.get('show')) {
                var paramsList = zrUtil.map(seriesList, function (series, index) {
                        return series.getDataParams(payloadBatch[index].dataIndexInside);
                    });
                if (!contentNotChange) {
                    // Update html content
                    var firstDataIndex = payloadBatch[sampleSeriesIndex].dataIndexInside;
                    // Default tooltip content
                    // FIXME
                    // (1) shold be the first data which has name?
                    // (2) themeRiver, firstDataIndex is array, and first line is unnecessary.
                    var firstLine = baseAxis.type === 'time' ? baseAxis.scale.getLabel(value[baseDimIndex]) : seriesList[sampleSeriesIndex].getData().getName(firstDataIndex);
                    var defaultHtml = (firstLine ? firstLine + '<br />' : '') + zrUtil.map(seriesList, function (series, index) {
                            return series.formatTooltip(payloadBatch[index].dataIndexInside, true);
                        }).join('<br />');
                    var asyncTicket = 'axis_' + coordSys.name + '_' + firstDataIndex;
                    this._showTooltipContent(rootTooltipModel, defaultHtml, paramsList, asyncTicket, point[0], point[1], positionExpr, null, api);
                } else {
                    updatePosition(positionExpr || rootTooltipModel.get('position'), point[0], point[1], rootTooltipModel.get('confine'), this._tooltipContent, paramsList, null, api);
                }
            }
        },
        _showItemTooltipContent: function (seriesModel, dataIndex, dataType, e) {
            // FIXME Graph data
            var api = this._api;
            var data = seriesModel.getData(dataType);
            var itemModel = data.getItemModel(dataIndex);
            var tooltipOpt = itemModel.get('tooltip', true);
            if (typeof tooltipOpt === 'string') {
                // In each data item tooltip can be simply write:
                // {
                //  value: 10,
                //  tooltip: 'Something you need to know'
                // }
                var tooltipContent = tooltipOpt;
                tooltipOpt = { formatter: tooltipContent };
            }
            var rootTooltipModel = this._tooltipModel;
            var seriesTooltipModel = seriesModel.getModel('tooltip', rootTooltipModel);
            var tooltipModel = new Model(tooltipOpt, seriesTooltipModel, seriesTooltipModel.ecModel);
            var params = seriesModel.getDataParams(dataIndex, dataType);
            var defaultHtml = seriesModel.formatTooltip(dataIndex, false, dataType);
            var asyncTicket = 'item_' + seriesModel.name + '_' + dataIndex;
            this._showTooltipContent(tooltipModel, defaultHtml, params, asyncTicket, e.offsetX, e.offsetY, e.position, e.target, api);
        },
        _showTooltipContent: function (tooltipModel, defaultHtml, params, asyncTicket, x, y, positionExpr, target, api) {
            // Reset ticket
            this._ticket = '';
            if (tooltipModel.get('showContent') && tooltipModel.get('show')) {
                var tooltipContent = this._tooltipContent;
                var confine = tooltipModel.get('confine');
                var formatter = tooltipModel.get('formatter');
                positionExpr = positionExpr || tooltipModel.get('position');
                var html = defaultHtml;
                if (formatter) {
                    if (typeof formatter === 'string') {
                        html = formatUtil.formatTpl(formatter, params);
                    } else if (typeof formatter === 'function') {
                        var self = this;
                        var ticket = asyncTicket;
                        var callback = function (cbTicket, html) {
                            if (cbTicket === self._ticket) {
                                tooltipContent.setContent(html);
                                updatePosition(positionExpr, x, y, confine, tooltipContent, params, target, api);
                            }
                        };
                        self._ticket = ticket;
                        html = formatter(params, ticket, callback);
                    }
                }
                tooltipContent.show(tooltipModel);
                tooltipContent.setContent(html);
                updatePosition(positionExpr, x, y, confine, tooltipContent, params, target, api);
            }
        },
        _showAxisPointer: function (coordSysName) {
            if (coordSysName) {
                var axisPointers = this._axisPointers[coordSysName];
                axisPointers && zrUtil.each(axisPointers, function (el) {
                    el.show();
                });
            } else {
                this.group.eachChild(function (child) {
                    child.show();
                });
                this.group.show();
            }
        },
        _resetLastHover: function () {
            var lastHover = this._lastHover;
            if (lastHover.payloadBatch) {
                this._api.dispatchAction({
                    type: 'downplay',
                    batch: lastHover.payloadBatch
                });
            }
            // Reset lastHover
            this._lastHover = {};
        },
        _hideAxisPointer: function (coordSysName) {
            if (coordSysName) {
                var axisPointers = this._axisPointers[coordSysName];
                axisPointers && zrUtil.each(axisPointers, function (el) {
                    el.hide();
                });
            } else {
                if (this.group.children().length) {
                    this.group.hide();
                }
            }
        },
        _hide: function () {
            clearTimeout(this._showTimeout);
            this._hideAxisPointer();
            this._resetLastHover();
            if (!this._alwaysShowContent) {
                this._tooltipContent.hideLater(this._tooltipModel.get('hideDelay'));
            }
            this._api.dispatchAction({
                type: 'hideTip',
                from: this.uid
            });
            this._lastX = this._lastY = null;
        },
        dispose: function (ecModel, api) {
            if (env.node) {
                return;
            }
            var zr = api.getZr();
            this._tooltipContent.hide();
            zr.off('click', this._tryShow);
            zr.off('mousemove', this._mousemove);
            zr.off('mouseout', this._hide);
            zr.off('globalout', this._hide);
            api.off('showTip', this._manuallyShowTip);
            api.off('hideTip', this._manuallyHideTip);
        }
    });
});
define('echarts/scale/Interval', ['require', '../util/number', '../util/format', './Scale'], function (require) {
    var numberUtil = require('../util/number');
    var formatUtil = require('../util/format');
    var Scale = require('./Scale');
    var mathFloor = Math.floor;
    var mathCeil = Math.ceil;
    var getPrecisionSafe = numberUtil.getPrecisionSafe;
    var roundingErrorFix = numberUtil.round;
    /**
     * @alias module:echarts/coord/scale/Interval
     * @constructor
     */
    var IntervalScale = Scale.extend({
            type: 'interval',
            _interval: 0,
            setExtent: function (start, end) {
                var thisExtent = this._extent;
                //start,end may be a Number like '25',so...
                if (!isNaN(start)) {
                    thisExtent[0] = parseFloat(start);
                }
                if (!isNaN(end)) {
                    thisExtent[1] = parseFloat(end);
                }
            },
            unionExtent: function (other) {
                var extent = this._extent;
                other[0] < extent[0] && (extent[0] = other[0]);
                other[1] > extent[1] && (extent[1] = other[1]);
                // unionExtent may called by it's sub classes
                IntervalScale.prototype.setExtent.call(this, extent[0], extent[1]);
            },
            getInterval: function () {
                if (!this._interval) {
                    this.niceTicks();
                }
                return this._interval;
            },
            setInterval: function (interval) {
                this._interval = interval;
                // Dropped auto calculated niceExtent and use user setted extent
                // We assume user wan't to set both interval, min, max to get a better result
                this._niceExtent = this._extent.slice();
            },
            getTicks: function () {
                if (!this._interval) {
                    this.niceTicks();
                }
                var interval = this._interval;
                var extent = this._extent;
                var ticks = [];
                // Consider this case: using dataZoom toolbox, zoom and zoom.
                var safeLimit = 10000;
                if (interval) {
                    var niceExtent = this._niceExtent;
                    var precision = getPrecisionSafe(interval) + 2;
                    if (extent[0] < niceExtent[0]) {
                        ticks.push(extent[0]);
                    }
                    var tick = niceExtent[0];
                    while (tick <= niceExtent[1]) {
                        ticks.push(tick);
                        // Avoid rounding error
                        tick = roundingErrorFix(tick + interval, precision);
                        if (ticks.length > safeLimit) {
                            return [];
                        }
                    }
                    // Consider this case: the last item of ticks is smaller
                    // than niceExtent[1] and niceExtent[1] === extent[1].
                    if (extent[1] > (ticks.length ? ticks[ticks.length - 1] : niceExtent[1])) {
                        ticks.push(extent[1]);
                    }
                }
                return ticks;
            },
            getTicksLabels: function () {
                var labels = [];
                var ticks = this.getTicks();
                for (var i = 0; i < ticks.length; i++) {
                    labels.push(this.getLabel(ticks[i]));
                }
                return labels;
            },
            getLabel: function (data) {
                return formatUtil.addCommas(data);
            },
            niceTicks: function (splitNumber) {
                splitNumber = splitNumber || 5;
                var extent = this._extent;
                var span = extent[1] - extent[0];
                if (!isFinite(span)) {
                    return;
                }
                // User may set axis min 0 and data are all negative
                // FIXME If it needs to reverse ?
                if (span < 0) {
                    span = -span;
                    extent.reverse();
                }
                // From "Nice Numbers for Graph Labels" of Graphic Gems
                // var niceSpan = numberUtil.nice(span, false);
                var step = roundingErrorFix(numberUtil.nice(span / splitNumber, true), Math.max(getPrecisionSafe(extent[0]), getPrecisionSafe(extent[1])) + 2);
                var precision = getPrecisionSafe(step) + 2;
                // Niced extent inside original extent
                var niceExtent = [
                        roundingErrorFix(mathCeil(extent[0] / step) * step, precision),
                        roundingErrorFix(mathFloor(extent[1] / step) * step, precision)
                    ];
                this._interval = step;
                this._niceExtent = niceExtent;
            },
            niceExtent: function (splitNumber, fixMin, fixMax) {
                var extent = this._extent;
                // If extent start and end are same, expand them
                if (extent[0] === extent[1]) {
                    if (extent[0] !== 0) {
                        // Expand extent
                        var expandSize = extent[0];
                        // In the fowllowing case
                        //      Axis has been fixed max 100
                        //      Plus data are all 100 and axis extent are [100, 100].
                        // Extend to the both side will cause expanded max is larger than fixed max.
                        // So only expand to the smaller side.
                        if (!fixMax) {
                            extent[1] += expandSize / 2;
                            extent[0] -= expandSize / 2;
                        } else {
                            extent[0] -= expandSize / 2;
                        }
                    } else {
                        extent[1] = 1;
                    }
                }
                var span = extent[1] - extent[0];
                // If there are no data and extent are [Infinity, -Infinity]
                if (!isFinite(span)) {
                    extent[0] = 0;
                    extent[1] = 1;
                }
                this.niceTicks(splitNumber);
                // var extent = this._extent;
                var interval = this._interval;
                if (!fixMin) {
                    extent[0] = roundingErrorFix(mathFloor(extent[0] / interval) * interval);
                }
                if (!fixMax) {
                    extent[1] = roundingErrorFix(mathCeil(extent[1] / interval) * interval);
                }
            }
        });
    /**
     * @return {module:echarts/scale/Time}
     */
    IntervalScale.create = function () {
        return new IntervalScale();
    };
    return IntervalScale;
});
define('echarts/scale/Scale', ['require', '../util/clazz'], function (require) {
    var clazzUtil = require('../util/clazz');
    function Scale() {
        /**
         * Extent
         * @type {Array.<number>}
         * @protected
         */
        this._extent = [
            Infinity,
            -Infinity
        ];
        /**
         * Step is calculated in adjustExtent
         * @type {Array.<number>}
         * @protected
         */
        this._interval = 0;
        this.init && this.init.apply(this, arguments);
    }
    var scaleProto = Scale.prototype;
    /**
     * Parse input val to valid inner number.
     * @param {*} val
     * @return {number}
     */
    scaleProto.parse = function (val) {
        // Notice: This would be a trap here, If the implementation
        // of this method depends on extent, and this method is used
        // before extent set (like in dataZoom), it would be wrong.
        // Nevertheless, parse does not depend on extent generally.
        return val;
    };
    scaleProto.contain = function (val) {
        var extent = this._extent;
        return val >= extent[0] && val <= extent[1];
    };
    /**
     * Normalize value to linear [0, 1], return 0.5 if extent span is 0
     * @param {number} val
     * @return {number}
     */
    scaleProto.normalize = function (val) {
        var extent = this._extent;
        if (extent[1] === extent[0]) {
            return 0.5;
        }
        return (val - extent[0]) / (extent[1] - extent[0]);
    };
    /**
     * Scale normalized value
     * @param {number} val
     * @return {number}
     */
    scaleProto.scale = function (val) {
        var extent = this._extent;
        return val * (extent[1] - extent[0]) + extent[0];
    };
    /**
     * Set extent from data
     * @param {Array.<number>} other
     */
    scaleProto.unionExtent = function (other) {
        var extent = this._extent;
        other[0] < extent[0] && (extent[0] = other[0]);
        other[1] > extent[1] && (extent[1] = other[1]);    // not setExtent because in log axis it may transformed to power
                                                           // this.setExtent(extent[0], extent[1]);
    };
    /**
     * Get extent
     * @return {Array.<number>}
     */
    scaleProto.getExtent = function () {
        return this._extent.slice();
    };
    /**
     * Set extent
     * @param {number} start
     * @param {number} end
     */
    scaleProto.setExtent = function (start, end) {
        var thisExtent = this._extent;
        if (!isNaN(start)) {
            thisExtent[0] = start;
        }
        if (!isNaN(end)) {
            thisExtent[1] = end;
        }
    };
    /**
     * @return {Array.<string>}
     */
    scaleProto.getTicksLabels = function () {
        var labels = [];
        var ticks = this.getTicks();
        for (var i = 0; i < ticks.length; i++) {
            labels.push(this.getLabel(ticks[i]));
        }
        return labels;
    };
    clazzUtil.enableClassExtend(Scale);
    clazzUtil.enableClassManagement(Scale, { registerWhenExtend: true });
    return Scale;
});
define('echarts/model/globalDefault', [], function () {
    var platform = '';
    // Navigator not exists in node
    if (typeof navigator !== 'undefined') {
        platform = navigator.platform || '';
    }
    return {
        color: [
            '#c23531',
            '#2f4554',
            '#61a0a8',
            '#d48265',
            '#91c7ae',
            '#749f83',
            '#ca8622',
            '#bda29a',
            '#6e7074',
            '#546570',
            '#c4ccd3'
        ],
        textStyle: {
            fontFamily: platform.match(/^Win/) ? 'Microsoft YaHei' : 'sans-serif',
            fontSize: 12,
            fontStyle: 'normal',
            fontWeight: 'normal'
        },
        blendMode: null,
        animation: true,
        animationDuration: 1000,
        animationDurationUpdate: 300,
        animationEasing: 'exponentialOut',
        animationEasingUpdate: 'cubicOut',
        animationThreshold: 2000,
        progressiveThreshold: 3000,
        progressive: 400,
        hoverLayerThreshold: 3000
    };
});
define('echarts/model/mixin/colorPalette', [], function () {
    return {
        clearColorPalette: function () {
            this._colorIdx = 0;
            this._colorNameMap = {};
        },
        getColorFromPalette: function (name, scope) {
            scope = scope || this;
            var colorIdx = scope._colorIdx || 0;
            var colorNameMap = scope._colorNameMap || (scope._colorNameMap = {});
            if (colorNameMap[name]) {
                return colorNameMap[name];
            }
            var colorPalette = this.get('color', true) || [];
            if (!colorPalette.length) {
                return;
            }
            var color = colorPalette[colorIdx];
            if (name) {
                colorNameMap[name] = color;
            }
            scope._colorIdx = (colorIdx + 1) % colorPalette.length;
            return color;
        }
    };
});
define('zrender/tool/path', ['require', '../graphic/Path', '../core/PathProxy', './transformPath', '../core/matrix'], function (require) {
    var Path = require('../graphic/Path');
    var PathProxy = require('../core/PathProxy');
    var transformPath = require('./transformPath');
    var matrix = require('../core/matrix');
    // command chars
    var cc = [
            'm',
            'M',
            'l',
            'L',
            'v',
            'V',
            'h',
            'H',
            'z',
            'Z',
            'c',
            'C',
            'q',
            'Q',
            't',
            'T',
            's',
            'S',
            'a',
            'A'
        ];
    var mathSqrt = Math.sqrt;
    var mathSin = Math.sin;
    var mathCos = Math.cos;
    var PI = Math.PI;
    var vMag = function (v) {
        return Math.sqrt(v[0] * v[0] + v[1] * v[1]);
    };
    var vRatio = function (u, v) {
        return (u[0] * v[0] + u[1] * v[1]) / (vMag(u) * vMag(v));
    };
    var vAngle = function (u, v) {
        return (u[0] * v[1] < u[1] * v[0] ? -1 : 1) * Math.acos(vRatio(u, v));
    };
    function processArc(x1, y1, x2, y2, fa, fs, rx, ry, psiDeg, cmd, path) {
        var psi = psiDeg * (PI / 180);
        var xp = mathCos(psi) * (x1 - x2) / 2 + mathSin(psi) * (y1 - y2) / 2;
        var yp = -1 * mathSin(psi) * (x1 - x2) / 2 + mathCos(psi) * (y1 - y2) / 2;
        var lambda = xp * xp / (rx * rx) + yp * yp / (ry * ry);
        if (lambda > 1) {
            rx *= mathSqrt(lambda);
            ry *= mathSqrt(lambda);
        }
        var f = (fa === fs ? -1 : 1) * mathSqrt((rx * rx * (ry * ry) - rx * rx * (yp * yp) - ry * ry * (xp * xp)) / (rx * rx * (yp * yp) + ry * ry * (xp * xp))) || 0;
        var cxp = f * rx * yp / ry;
        var cyp = f * -ry * xp / rx;
        var cx = (x1 + x2) / 2 + mathCos(psi) * cxp - mathSin(psi) * cyp;
        var cy = (y1 + y2) / 2 + mathSin(psi) * cxp + mathCos(psi) * cyp;
        var theta = vAngle([
                1,
                0
            ], [
                (xp - cxp) / rx,
                (yp - cyp) / ry
            ]);
        var u = [
                (xp - cxp) / rx,
                (yp - cyp) / ry
            ];
        var v = [
                (-1 * xp - cxp) / rx,
                (-1 * yp - cyp) / ry
            ];
        var dTheta = vAngle(u, v);
        if (vRatio(u, v) <= -1) {
            dTheta = PI;
        }
        if (vRatio(u, v) >= 1) {
            dTheta = 0;
        }
        if (fs === 0 && dTheta > 0) {
            dTheta = dTheta - 2 * PI;
        }
        if (fs === 1 && dTheta < 0) {
            dTheta = dTheta + 2 * PI;
        }
        path.addData(cmd, cx, cy, rx, ry, theta, dTheta, psi, fs);
    }
    function createPathProxyFromString(data) {
        if (!data) {
            return [];
        }
        // command string
        var cs = data.replace(/-/g, ' -').replace(/  /g, ' ').replace(/ /g, ',').replace(/,,/g, ',');
        var n;
        // create pipes so that we can split the data
        for (n = 0; n < cc.length; n++) {
            cs = cs.replace(new RegExp(cc[n], 'g'), '|' + cc[n]);
        }
        // create array
        var arr = cs.split('|');
        // init context point
        var cpx = 0;
        var cpy = 0;
        var path = new PathProxy();
        var CMD = PathProxy.CMD;
        var prevCmd;
        for (n = 1; n < arr.length; n++) {
            var str = arr[n];
            var c = str.charAt(0);
            var off = 0;
            var p = str.slice(1).replace(/e,-/g, 'e-').split(',');
            var cmd;
            if (p.length > 0 && p[0] === '') {
                p.shift();
            }
            for (var i = 0; i < p.length; i++) {
                p[i] = parseFloat(p[i]);
            }
            while (off < p.length && !isNaN(p[off])) {
                if (isNaN(p[0])) {
                    break;
                }
                var ctlPtx;
                var ctlPty;
                var rx;
                var ry;
                var psi;
                var fa;
                var fs;
                var x1 = cpx;
                var y1 = cpy;
                // convert l, H, h, V, and v to L
                switch (c) {
                case 'l':
                    cpx += p[off++];
                    cpy += p[off++];
                    cmd = CMD.L;
                    path.addData(cmd, cpx, cpy);
                    break;
                case 'L':
                    cpx = p[off++];
                    cpy = p[off++];
                    cmd = CMD.L;
                    path.addData(cmd, cpx, cpy);
                    break;
                case 'm':
                    cpx += p[off++];
                    cpy += p[off++];
                    cmd = CMD.M;
                    path.addData(cmd, cpx, cpy);
                    c = 'l';
                    break;
                case 'M':
                    cpx = p[off++];
                    cpy = p[off++];
                    cmd = CMD.M;
                    path.addData(cmd, cpx, cpy);
                    c = 'L';
                    break;
                case 'h':
                    cpx += p[off++];
                    cmd = CMD.L;
                    path.addData(cmd, cpx, cpy);
                    break;
                case 'H':
                    cpx = p[off++];
                    cmd = CMD.L;
                    path.addData(cmd, cpx, cpy);
                    break;
                case 'v':
                    cpy += p[off++];
                    cmd = CMD.L;
                    path.addData(cmd, cpx, cpy);
                    break;
                case 'V':
                    cpy = p[off++];
                    cmd = CMD.L;
                    path.addData(cmd, cpx, cpy);
                    break;
                case 'C':
                    cmd = CMD.C;
                    path.addData(cmd, p[off++], p[off++], p[off++], p[off++], p[off++], p[off++]);
                    cpx = p[off - 2];
                    cpy = p[off - 1];
                    break;
                case 'c':
                    cmd = CMD.C;
                    path.addData(cmd, p[off++] + cpx, p[off++] + cpy, p[off++] + cpx, p[off++] + cpy, p[off++] + cpx, p[off++] + cpy);
                    cpx += p[off - 2];
                    cpy += p[off - 1];
                    break;
                case 'S':
                    ctlPtx = cpx;
                    ctlPty = cpy;
                    var len = path.len();
                    var pathData = path.data;
                    if (prevCmd === CMD.C) {
                        ctlPtx += cpx - pathData[len - 4];
                        ctlPty += cpy - pathData[len - 3];
                    }
                    cmd = CMD.C;
                    x1 = p[off++];
                    y1 = p[off++];
                    cpx = p[off++];
                    cpy = p[off++];
                    path.addData(cmd, ctlPtx, ctlPty, x1, y1, cpx, cpy);
                    break;
                case 's':
                    ctlPtx = cpx;
                    ctlPty = cpy;
                    var len = path.len();
                    var pathData = path.data;
                    if (prevCmd === CMD.C) {
                        ctlPtx += cpx - pathData[len - 4];
                        ctlPty += cpy - pathData[len - 3];
                    }
                    cmd = CMD.C;
                    x1 = cpx + p[off++];
                    y1 = cpy + p[off++];
                    cpx += p[off++];
                    cpy += p[off++];
                    path.addData(cmd, ctlPtx, ctlPty, x1, y1, cpx, cpy);
                    break;
                case 'Q':
                    x1 = p[off++];
                    y1 = p[off++];
                    cpx = p[off++];
                    cpy = p[off++];
                    cmd = CMD.Q;
                    path.addData(cmd, x1, y1, cpx, cpy);
                    break;
                case 'q':
                    x1 = p[off++] + cpx;
                    y1 = p[off++] + cpy;
                    cpx += p[off++];
                    cpy += p[off++];
                    cmd = CMD.Q;
                    path.addData(cmd, x1, y1, cpx, cpy);
                    break;
                case 'T':
                    ctlPtx = cpx;
                    ctlPty = cpy;
                    var len = path.len();
                    var pathData = path.data;
                    if (prevCmd === CMD.Q) {
                        ctlPtx += cpx - pathData[len - 4];
                        ctlPty += cpy - pathData[len - 3];
                    }
                    cpx = p[off++];
                    cpy = p[off++];
                    cmd = CMD.Q;
                    path.addData(cmd, ctlPtx, ctlPty, cpx, cpy);
                    break;
                case 't':
                    ctlPtx = cpx;
                    ctlPty = cpy;
                    var len = path.len();
                    var pathData = path.data;
                    if (prevCmd === CMD.Q) {
                        ctlPtx += cpx - pathData[len - 4];
                        ctlPty += cpy - pathData[len - 3];
                    }
                    cpx += p[off++];
                    cpy += p[off++];
                    cmd = CMD.Q;
                    path.addData(cmd, ctlPtx, ctlPty, cpx, cpy);
                    break;
                case 'A':
                    rx = p[off++];
                    ry = p[off++];
                    psi = p[off++];
                    fa = p[off++];
                    fs = p[off++];
                    x1 = cpx, y1 = cpy;
                    cpx = p[off++];
                    cpy = p[off++];
                    cmd = CMD.A;
                    processArc(x1, y1, cpx, cpy, fa, fs, rx, ry, psi, cmd, path);
                    break;
                case 'a':
                    rx = p[off++];
                    ry = p[off++];
                    psi = p[off++];
                    fa = p[off++];
                    fs = p[off++];
                    x1 = cpx, y1 = cpy;
                    cpx += p[off++];
                    cpy += p[off++];
                    cmd = CMD.A;
                    processArc(x1, y1, cpx, cpy, fa, fs, rx, ry, psi, cmd, path);
                    break;
                }
            }
            if (c === 'z' || c === 'Z') {
                cmd = CMD.Z;
                path.addData(cmd);
            }
            prevCmd = cmd;
        }
        path.toStatic();
        return path;
    }
    // TODO Optimize double memory cost problem
    function createPathOptions(str, opts) {
        var pathProxy = createPathProxyFromString(str);
        var transform;
        opts = opts || {};
        opts.buildPath = function (path) {
            path.setData(pathProxy.data);
            transform && transformPath(path, transform);
            // Svg and vml renderer don't have context
            var ctx = path.getContext();
            if (ctx) {
                path.rebuildPath(ctx);
            }
        };
        opts.applyTransform = function (m) {
            if (!transform) {
                transform = matrix.create();
            }
            matrix.mul(transform, m, transform);
            this.dirty(true);
        };
        return opts;
    }
    return {
        createFromString: function (str, opts) {
            return new Path(createPathOptions(str, opts));
        },
        extendFromString: function (str, opts) {
            return Path.extend(createPathOptions(str, opts));
        },
        mergePath: function (pathEls, opts) {
            var pathList = [];
            var len = pathEls.length;
            for (var i = 0; i < len; i++) {
                var pathEl = pathEls[i];
                if (pathEl.__dirty) {
                    pathEl.buildPath(pathEl.path, pathEl.shape, true);
                }
                pathList.push(pathEl.path);
            }
            var pathBundle = new Path(opts);
            pathBundle.buildPath = function (path) {
                path.appendPath(pathList);
                // Svg and vml renderer don't have context
                var ctx = path.getContext();
                if (ctx) {
                    path.rebuildPath(ctx);
                }
            };
            return pathBundle;
        }
    };
});
define('zrender/graphic/Path', ['require', './Displayable', '../core/util', '../core/PathProxy', '../contain/path', './Pattern'], function (require) {
    var Displayable = require('./Displayable');
    var zrUtil = require('../core/util');
    var PathProxy = require('../core/PathProxy');
    var pathContain = require('../contain/path');
    var Pattern = require('./Pattern');
    var getCanvasPattern = Pattern.prototype.getCanvasPattern;
    var abs = Math.abs;
    /**
     * @alias module:zrender/graphic/Path
     * @extends module:zrender/graphic/Displayable
     * @constructor
     * @param {Object} opts
     */
    function Path(opts) {
        Displayable.call(this, opts);
        /**
         * @type {module:zrender/core/PathProxy}
         * @readOnly
         */
        this.path = new PathProxy();
    }
    Path.prototype = {
        constructor: Path,
        type: 'path',
        __dirtyPath: true,
        strokeContainThreshold: 5,
        brush: function (ctx, prevEl) {
            var style = this.style;
            var path = this.path;
            var hasStroke = style.hasStroke();
            var hasFill = style.hasFill();
            var fill = style.fill;
            var stroke = style.stroke;
            var hasFillGradient = hasFill && !!fill.colorStops;
            var hasStrokeGradient = hasStroke && !!stroke.colorStops;
            var hasFillPattern = hasFill && !!fill.image;
            var hasStrokePattern = hasStroke && !!stroke.image;
            style.bind(ctx, this, prevEl);
            this.setTransform(ctx);
            if (this.__dirty) {
                var rect = this.getBoundingRect();
                // Update gradient because bounding rect may changed
                if (hasFillGradient) {
                    this._fillGradient = style.getGradient(ctx, fill, rect);
                }
                if (hasStrokeGradient) {
                    this._strokeGradient = style.getGradient(ctx, stroke, rect);
                }
            }
            // Use the gradient or pattern
            if (hasFillGradient) {
                // PENDING If may have affect the state
                ctx.fillStyle = this._fillGradient;
            } else if (hasFillPattern) {
                ctx.fillStyle = getCanvasPattern.call(fill, ctx);
            }
            if (hasStrokeGradient) {
                ctx.strokeStyle = this._strokeGradient;
            } else if (hasStrokePattern) {
                ctx.strokeStyle = getCanvasPattern.call(stroke, ctx);
            }
            var lineDash = style.lineDash;
            var lineDashOffset = style.lineDashOffset;
            var ctxLineDash = !!ctx.setLineDash;
            // Update path sx, sy
            var scale = this.getGlobalScale();
            path.setScale(scale[0], scale[1]);
            // Proxy context
            // Rebuild path in following 2 cases
            // 1. Path is dirty
            // 2. Path needs javascript implemented lineDash stroking.
            //    In this case, lineDash information will not be saved in PathProxy
            if (this.__dirtyPath || lineDash && !ctxLineDash && hasStroke) {
                path = this.path.beginPath(ctx);
                // Setting line dash before build path
                if (lineDash && !ctxLineDash) {
                    path.setLineDash(lineDash);
                    path.setLineDashOffset(lineDashOffset);
                }
                this.buildPath(path, this.shape, false);
                // Clear path dirty flag
                this.__dirtyPath = false;
            } else {
                // Replay path building
                ctx.beginPath();
                this.path.rebuildPath(ctx);
            }
            hasFill && path.fill(ctx);
            if (lineDash && ctxLineDash) {
                ctx.setLineDash(lineDash);
                ctx.lineDashOffset = lineDashOffset;
            }
            hasStroke && path.stroke(ctx);
            if (lineDash && ctxLineDash) {
                // PENDING
                // Remove lineDash
                ctx.setLineDash([]);
            }
            this.restoreTransform(ctx);
            // Draw rect text
            if (style.text != null) {
                // var rect = this.getBoundingRect();
                this.drawRectText(ctx, this.getBoundingRect());
            }
        },
        buildPath: function (ctx, shapeCfg, inBundle) {
        },
        getBoundingRect: function () {
            var rect = this._rect;
            var style = this.style;
            var needsUpdateRect = !rect;
            if (needsUpdateRect) {
                var path = this.path;
                if (this.__dirtyPath) {
                    path.beginPath();
                    this.buildPath(path, this.shape, false);
                }
                rect = path.getBoundingRect();
            }
            this._rect = rect;
            if (style.hasStroke()) {
                // Needs update rect with stroke lineWidth when
                // 1. Element changes scale or lineWidth
                // 2. Shape is changed
                var rectWithStroke = this._rectWithStroke || (this._rectWithStroke = rect.clone());
                if (this.__dirty || needsUpdateRect) {
                    rectWithStroke.copy(rect);
                    // FIXME Must after updateTransform
                    var w = style.lineWidth;
                    // PENDING, Min line width is needed when line is horizontal or vertical
                    var lineScale = style.strokeNoScale ? this.getLineScale() : 1;
                    // Only add extra hover lineWidth when there are no fill
                    if (!style.hasFill()) {
                        w = Math.max(w, this.strokeContainThreshold || 4);
                    }
                    // Consider line width
                    // Line scale can't be 0;
                    if (lineScale > 1e-10) {
                        rectWithStroke.width += w / lineScale;
                        rectWithStroke.height += w / lineScale;
                        rectWithStroke.x -= w / lineScale / 2;
                        rectWithStroke.y -= w / lineScale / 2;
                    }
                }
                // Return rect with stroke
                return rectWithStroke;
            }
            return rect;
        },
        contain: function (x, y) {
            var localPos = this.transformCoordToLocal(x, y);
            var rect = this.getBoundingRect();
            var style = this.style;
            x = localPos[0];
            y = localPos[1];
            if (rect.contain(x, y)) {
                var pathData = this.path.data;
                if (style.hasStroke()) {
                    var lineWidth = style.lineWidth;
                    var lineScale = style.strokeNoScale ? this.getLineScale() : 1;
                    // Line scale can't be 0;
                    if (lineScale > 1e-10) {
                        // Only add extra hover lineWidth when there are no fill
                        if (!style.hasFill()) {
                            lineWidth = Math.max(lineWidth, this.strokeContainThreshold);
                        }
                        if (pathContain.containStroke(pathData, lineWidth / lineScale, x, y)) {
                            return true;
                        }
                    }
                }
                if (style.hasFill()) {
                    return pathContain.contain(pathData, x, y);
                }
            }
            return false;
        },
        dirty: function (dirtyPath) {
            if (dirtyPath == null) {
                dirtyPath = true;
            }
            // Only mark dirty, not mark clean
            if (dirtyPath) {
                this.__dirtyPath = dirtyPath;
                this._rect = null;
            }
            this.__dirty = true;
            this.__zr && this.__zr.refresh();
            // Used as a clipping path
            if (this.__clipTarget) {
                this.__clipTarget.dirty();
            }
        },
        animateShape: function (loop) {
            return this.animate('shape', loop);
        },
        attrKV: function (key, value) {
            // FIXME
            if (key === 'shape') {
                this.setShape(value);
                this.__dirtyPath = true;
                this._rect = null;
            } else {
                Displayable.prototype.attrKV.call(this, key, value);
            }
        },
        setShape: function (key, value) {
            var shape = this.shape;
            // Path from string may not have shape
            if (shape) {
                if (zrUtil.isObject(key)) {
                    for (var name in key) {
                        if (key.hasOwnProperty(name)) {
                            shape[name] = key[name];
                        }
                    }
                } else {
                    shape[key] = value;
                }
                this.dirty(true);
            }
            return this;
        },
        getLineScale: function () {
            var m = this.transform;
            // Get the line scale.
            // Determinant of `m` means how much the area is enlarged by the
            // transformation. So its square root can be used as a scale factor
            // for width.
            return m && abs(m[0] - 1) > 1e-10 && abs(m[3] - 1) > 1e-10 ? Math.sqrt(abs(m[0] * m[3] - m[2] * m[1])) : 1;
        }
    };
    /**
     * 扩展一个 Path element, 比如星形，圆等。
     * Extend a path element
     * @param {Object} props
     * @param {string} props.type Path type
     * @param {Function} props.init Initialize
     * @param {Function} props.buildPath Overwrite buildPath method
     * @param {Object} [props.style] Extended default style config
     * @param {Object} [props.shape] Extended default shape config
     */
    Path.extend = function (defaults) {
        var Sub = function (opts) {
            Path.call(this, opts);
            if (defaults.style) {
                // Extend default style
                this.style.extendFrom(defaults.style, false);
            }
            // Extend default shape
            var defaultShape = defaults.shape;
            if (defaultShape) {
                this.shape = this.shape || {};
                var thisShape = this.shape;
                for (var name in defaultShape) {
                    if (!thisShape.hasOwnProperty(name) && defaultShape.hasOwnProperty(name)) {
                        thisShape[name] = defaultShape[name];
                    }
                }
            }
            defaults.init && defaults.init.call(this, opts);
        };
        zrUtil.inherits(Sub, Path);
        // FIXME 不能 extend position, rotation 等引用对象
        for (var name in defaults) {
            // Extending prototype values and methods
            if (name !== 'style' && name !== 'shape') {
                Sub.prototype[name] = defaults[name];
            }
        }
        return Sub;
    };
    zrUtil.inherits(Path, Displayable);
    return Path;
});
define('zrender/container/Group', ['require', '../core/util', '../Element', '../core/BoundingRect'], function (require) {
    var zrUtil = require('../core/util');
    var Element = require('../Element');
    var BoundingRect = require('../core/BoundingRect');
    /**
     * @alias module:zrender/graphic/Group
     * @constructor
     * @extends module:zrender/mixin/Transformable
     * @extends module:zrender/mixin/Eventful
     */
    var Group = function (opts) {
        opts = opts || {};
        Element.call(this, opts);
        for (var key in opts) {
            if (opts.hasOwnProperty(key)) {
                this[key] = opts[key];
            }
        }
        this._children = [];
        this.__storage = null;
        this.__dirty = true;
    };
    Group.prototype = {
        constructor: Group,
        isGroup: true,
        type: 'group',
        silent: false,
        children: function () {
            return this._children.slice();
        },
        childAt: function (idx) {
            return this._children[idx];
        },
        childOfName: function (name) {
            var children = this._children;
            for (var i = 0; i < children.length; i++) {
                if (children[i].name === name) {
                    return children[i];
                }
            }
        },
        childCount: function () {
            return this._children.length;
        },
        add: function (child) {
            if (child && child !== this && child.parent !== this) {
                this._children.push(child);
                this._doAdd(child);
            }
            return this;
        },
        addBefore: function (child, nextSibling) {
            if (child && child !== this && child.parent !== this && nextSibling && nextSibling.parent === this) {
                var children = this._children;
                var idx = children.indexOf(nextSibling);
                if (idx >= 0) {
                    children.splice(idx, 0, child);
                    this._doAdd(child);
                }
            }
            return this;
        },
        _doAdd: function (child) {
            if (child.parent) {
                child.parent.remove(child);
            }
            child.parent = this;
            var storage = this.__storage;
            var zr = this.__zr;
            if (storage && storage !== child.__storage) {
                storage.addToMap(child);
                if (child instanceof Group) {
                    child.addChildrenToStorage(storage);
                }
            }
            zr && zr.refresh();
        },
        remove: function (child) {
            var zr = this.__zr;
            var storage = this.__storage;
            var children = this._children;
            var idx = zrUtil.indexOf(children, child);
            if (idx < 0) {
                return this;
            }
            children.splice(idx, 1);
            child.parent = null;
            if (storage) {
                storage.delFromMap(child.id);
                if (child instanceof Group) {
                    child.delChildrenFromStorage(storage);
                }
            }
            zr && zr.refresh();
            return this;
        },
        removeAll: function () {
            var children = this._children;
            var storage = this.__storage;
            var child;
            var i;
            for (i = 0; i < children.length; i++) {
                child = children[i];
                if (storage) {
                    storage.delFromMap(child.id);
                    if (child instanceof Group) {
                        child.delChildrenFromStorage(storage);
                    }
                }
                child.parent = null;
            }
            children.length = 0;
            return this;
        },
        eachChild: function (cb, context) {
            var children = this._children;
            for (var i = 0; i < children.length; i++) {
                var child = children[i];
                cb.call(context, child, i);
            }
            return this;
        },
        traverse: function (cb, context) {
            for (var i = 0; i < this._children.length; i++) {
                var child = this._children[i];
                cb.call(context, child);
                if (child.type === 'group') {
                    child.traverse(cb, context);
                }
            }
            return this;
        },
        addChildrenToStorage: function (storage) {
            for (var i = 0; i < this._children.length; i++) {
                var child = this._children[i];
                storage.addToMap(child);
                if (child instanceof Group) {
                    child.addChildrenToStorage(storage);
                }
            }
        },
        delChildrenFromStorage: function (storage) {
            for (var i = 0; i < this._children.length; i++) {
                var child = this._children[i];
                storage.delFromMap(child.id);
                if (child instanceof Group) {
                    child.delChildrenFromStorage(storage);
                }
            }
        },
        dirty: function () {
            this.__dirty = true;
            this.__zr && this.__zr.refresh();
            return this;
        },
        getBoundingRect: function (includeChildren) {
            // TODO Caching
            var rect = null;
            var tmpRect = new BoundingRect(0, 0, 0, 0);
            var children = includeChildren || this._children;
            var tmpMat = [];
            for (var i = 0; i < children.length; i++) {
                var child = children[i];
                if (child.ignore || child.invisible) {
                    continue;
                }
                var childRect = child.getBoundingRect();
                var transform = child.getLocalTransform(tmpMat);
                // TODO
                // The boundingRect cacluated by transforming original
                // rect may be bigger than the actual bundingRect when rotation
                // is used. (Consider a circle rotated aginst its center, where
                // the actual boundingRect should be the same as that not be
                // rotated.) But we can not find better approach to calculate
                // actual boundingRect yet, considering performance.
                if (transform) {
                    tmpRect.copy(childRect);
                    tmpRect.applyTransform(transform);
                    rect = rect || tmpRect.clone();
                    rect.union(tmpRect);
                } else {
                    rect = rect || childRect.clone();
                    rect.union(childRect);
                }
            }
            return rect || tmpRect;
        }
    };
    zrUtil.inherits(Group, Element);
    return Group;
});
define('zrender/graphic/Image', ['require', './Displayable', '../core/BoundingRect', '../core/util', '../core/LRU'], function (require) {
    var Displayable = require('./Displayable');
    var BoundingRect = require('../core/BoundingRect');
    var zrUtil = require('../core/util');
    var LRU = require('../core/LRU');
    var globalImageCache = new LRU(50);
    /**
     * @alias zrender/graphic/Image
     * @extends module:zrender/graphic/Displayable
     * @constructor
     * @param {Object} opts
     */
    function ZImage(opts) {
        Displayable.call(this, opts);
    }
    ZImage.prototype = {
        constructor: ZImage,
        type: 'image',
        brush: function (ctx, prevEl) {
            var style = this.style;
            var src = style.image;
            var image;
            // Must bind each time
            style.bind(ctx, this, prevEl);
            // style.image is a url string
            if (typeof src === 'string') {
                image = this._image;
            }    // style.image is an HTMLImageElement or HTMLCanvasElement or Canvas
            else {
                image = src;
            }
            // FIXME Case create many images with src
            if (!image && src) {
                // Try get from global image cache
                var cachedImgObj = globalImageCache.get(src);
                if (!cachedImgObj) {
                    // Create a new image
                    image = new Image();
                    image.onload = function () {
                        image.onload = null;
                        for (var i = 0; i < cachedImgObj.pending.length; i++) {
                            cachedImgObj.pending[i].dirty();
                        }
                    };
                    cachedImgObj = {
                        image: image,
                        pending: [this]
                    };
                    image.src = src;
                    globalImageCache.put(src, cachedImgObj);
                    this._image = image;
                    return;
                } else {
                    image = cachedImgObj.image;
                    this._image = image;
                    // Image is not complete finish, add to pending list
                    if (!image.width || !image.height) {
                        cachedImgObj.pending.push(this);
                        return;
                    }
                }
            }
            if (image) {
                // 图片已经加载完成
                // if (image.nodeName.toUpperCase() == 'IMG') {
                //     if (!image.complete) {
                //         return;
                //     }
                // }
                // Else is canvas
                var width = style.width || image.width;
                var height = style.height || image.height;
                var x = style.x || 0;
                var y = style.y || 0;
                // 图片加载失败
                if (!image.width || !image.height) {
                    return;
                }
                // 设置transform
                this.setTransform(ctx);
                if (style.sWidth && style.sHeight) {
                    var sx = style.sx || 0;
                    var sy = style.sy || 0;
                    ctx.drawImage(image, sx, sy, style.sWidth, style.sHeight, x, y, width, height);
                } else if (style.sx && style.sy) {
                    var sx = style.sx;
                    var sy = style.sy;
                    var sWidth = width - sx;
                    var sHeight = height - sy;
                    ctx.drawImage(image, sx, sy, sWidth, sHeight, x, y, width, height);
                } else {
                    ctx.drawImage(image, x, y, width, height);
                }
                // 如果没设置宽和高的话自动根据图片宽高设置
                if (style.width == null) {
                    style.width = width;
                }
                if (style.height == null) {
                    style.height = height;
                }
                this.restoreTransform(ctx);
                // Draw rect text
                if (style.text != null) {
                    this.drawRectText(ctx, this.getBoundingRect());
                }
            }
        },
        getBoundingRect: function () {
            var style = this.style;
            if (!this._rect) {
                this._rect = new BoundingRect(style.x || 0, style.y || 0, style.width || 0, style.height || 0);
            }
            return this._rect;
        }
    };
    zrUtil.inherits(ZImage, Displayable);
    return ZImage;
});
define('zrender/graphic/Text', ['require', './Displayable', '../core/util', '../contain/text'], function (require) {
    var Displayable = require('./Displayable');
    var zrUtil = require('../core/util');
    var textContain = require('../contain/text');
    /**
     * @alias zrender/graphic/Text
     * @extends module:zrender/graphic/Displayable
     * @constructor
     * @param {Object} opts
     */
    var Text = function (opts) {
        Displayable.call(this, opts);
    };
    Text.prototype = {
        constructor: Text,
        type: 'text',
        brush: function (ctx, prevEl) {
            var style = this.style;
            var x = style.x || 0;
            var y = style.y || 0;
            // Convert to string
            var text = style.text;
            // Convert to string
            text != null && (text += '');
            // Always bind style
            style.bind(ctx, this, prevEl);
            if (text) {
                this.setTransform(ctx);
                var textBaseline;
                var textAlign = style.textAlign;
                var font = style.textFont || style.font;
                if (style.textVerticalAlign) {
                    var rect = textContain.getBoundingRect(text, font, style.textAlign, 'top');
                    // Ignore textBaseline
                    textBaseline = 'middle';
                    switch (style.textVerticalAlign) {
                    case 'middle':
                        y -= rect.height / 2 - rect.lineHeight / 2;
                        break;
                    case 'bottom':
                        y -= rect.height - rect.lineHeight / 2;
                        break;
                    default:
                        y += rect.lineHeight / 2;
                    }
                } else {
                    textBaseline = style.textBaseline;
                }
                // TODO Invalid font
                ctx.font = font || '12px sans-serif';
                ctx.textAlign = textAlign || 'left';
                // Use canvas default left textAlign. Giving invalid value will cause state not change
                if (ctx.textAlign !== textAlign) {
                    ctx.textAlign = 'left';
                }
                ctx.textBaseline = textBaseline || 'alphabetic';
                // Use canvas default alphabetic baseline
                if (ctx.textBaseline !== textBaseline) {
                    ctx.textBaseline = 'alphabetic';
                }
                var lineHeight = textContain.measureText('国', ctx.font).width;
                var textLines = text.split('\n');
                for (var i = 0; i < textLines.length; i++) {
                    style.hasFill() && ctx.fillText(textLines[i], x, y);
                    style.hasStroke() && ctx.strokeText(textLines[i], x, y);
                    y += lineHeight;
                }
                this.restoreTransform(ctx);
            }
        },
        getBoundingRect: function () {
            if (!this._rect) {
                var style = this.style;
                var textVerticalAlign = style.textVerticalAlign;
                var rect = textContain.getBoundingRect(style.text + '', style.textFont || style.font, style.textAlign, textVerticalAlign ? 'top' : style.textBaseline);
                switch (textVerticalAlign) {
                case 'middle':
                    rect.y -= rect.height / 2;
                    break;
                case 'bottom':
                    rect.y -= rect.height;
                    break;
                }
                rect.x += style.x || 0;
                rect.y += style.y || 0;
                this._rect = rect;
            }
            return this._rect;
        }
    };
    zrUtil.inherits(Text, Displayable);
    return Text;
});
define('zrender/graphic/shape/Circle', ['require', '../Path'], function (require) {
    'use strict';
    return require('../Path').extend({
        type: 'circle',
        shape: {
            cx: 0,
            cy: 0,
            r: 0
        },
        buildPath: function (ctx, shape, inBundle) {
            // Better stroking in ShapeBundle
            // Always do it may have performence issue ( fill may be 2x more cost)
            if (inBundle) {
                ctx.moveTo(shape.cx + shape.r, shape.cy);
            }
            // Better stroking in ShapeBundle
            // ctx.moveTo(shape.cx + shape.r, shape.cy);
            ctx.arc(shape.cx, shape.cy, shape.r, 0, Math.PI * 2, true);
        }
    });
});
define('zrender/graphic/shape/Sector', ['require', '../Path'], function (require) {
    return require('../Path').extend({
        type: 'sector',
        shape: {
            cx: 0,
            cy: 0,
            r0: 0,
            r: 0,
            startAngle: 0,
            endAngle: Math.PI * 2,
            clockwise: true
        },
        buildPath: function (ctx, shape) {
            var x = shape.cx;
            var y = shape.cy;
            var r0 = Math.max(shape.r0 || 0, 0);
            var r = Math.max(shape.r, 0);
            var startAngle = shape.startAngle;
            var endAngle = shape.endAngle;
            var clockwise = shape.clockwise;
            var unitX = Math.cos(startAngle);
            var unitY = Math.sin(startAngle);
            ctx.moveTo(unitX * r0 + x, unitY * r0 + y);
            ctx.lineTo(unitX * r + x, unitY * r + y);
            ctx.arc(x, y, r, startAngle, endAngle, !clockwise);
            ctx.lineTo(Math.cos(endAngle) * r0 + x, Math.sin(endAngle) * r0 + y);
            if (r0 !== 0) {
                ctx.arc(x, y, r0, endAngle, startAngle, clockwise);
            }
            ctx.closePath();
        }
    });
});
define('zrender/graphic/shape/Ring', ['require', '../Path'], function (require) {
    return require('../Path').extend({
        type: 'ring',
        shape: {
            cx: 0,
            cy: 0,
            r: 0,
            r0: 0
        },
        buildPath: function (ctx, shape) {
            var x = shape.cx;
            var y = shape.cy;
            var PI2 = Math.PI * 2;
            ctx.moveTo(x + shape.r, y);
            ctx.arc(x, y, shape.r, 0, PI2, false);
            ctx.moveTo(x + shape.r0, y);
            ctx.arc(x, y, shape.r0, 0, PI2, true);
        }
    });
});
define('zrender/graphic/shape/Polygon', ['require', '../helper/poly', '../Path'], function (require) {
    var polyHelper = require('../helper/poly');
    return require('../Path').extend({
        type: 'polygon',
        shape: {
            points: null,
            smooth: false,
            smoothConstraint: null
        },
        buildPath: function (ctx, shape) {
            polyHelper.buildPath(ctx, shape, true);
        }
    });
});
define('zrender/graphic/shape/Polyline', ['require', '../helper/poly', '../Path'], function (require) {
    var polyHelper = require('../helper/poly');
    return require('../Path').extend({
        type: 'polyline',
        shape: {
            points: null,
            smooth: false,
            smoothConstraint: null
        },
        style: {
            stroke: '#000',
            fill: null
        },
        buildPath: function (ctx, shape) {
            polyHelper.buildPath(ctx, shape, false);
        }
    });
});
define('zrender/graphic/shape/Rect', ['require', '../helper/roundRect', '../Path'], function (require) {
    var roundRectHelper = require('../helper/roundRect');
    return require('../Path').extend({
        type: 'rect',
        shape: {
            r: 0,
            x: 0,
            y: 0,
            width: 0,
            height: 0
        },
        buildPath: function (ctx, shape) {
            var x = shape.x;
            var y = shape.y;
            var width = shape.width;
            var height = shape.height;
            if (!shape.r) {
                ctx.rect(x, y, width, height);
            } else {
                roundRectHelper.buildPath(ctx, shape);
            }
            ctx.closePath();
            return;
        }
    });
});
define('zrender/graphic/shape/Line', ['require', '../Path'], function (require) {
    return require('../Path').extend({
        type: 'line',
        shape: {
            x1: 0,
            y1: 0,
            x2: 0,
            y2: 0,
            percent: 1
        },
        style: {
            stroke: '#000',
            fill: null
        },
        buildPath: function (ctx, shape) {
            var x1 = shape.x1;
            var y1 = shape.y1;
            var x2 = shape.x2;
            var y2 = shape.y2;
            var percent = shape.percent;
            if (percent === 0) {
                return;
            }
            ctx.moveTo(x1, y1);
            if (percent < 1) {
                x2 = x1 * (1 - percent) + x2 * percent;
                y2 = y1 * (1 - percent) + y2 * percent;
            }
            ctx.lineTo(x2, y2);
        },
        pointAt: function (p) {
            var shape = this.shape;
            return [
                shape.x1 * (1 - p) + shape.x2 * p,
                shape.y1 * (1 - p) + shape.y2 * p
            ];
        }
    });
});
define('zrender/graphic/shape/BezierCurve', ['require', '../../core/curve', '../../core/vector', '../Path'], function (require) {
    'use strict';
    var curveTool = require('../../core/curve');
    var vec2 = require('../../core/vector');
    var quadraticSubdivide = curveTool.quadraticSubdivide;
    var cubicSubdivide = curveTool.cubicSubdivide;
    var quadraticAt = curveTool.quadraticAt;
    var cubicAt = curveTool.cubicAt;
    var quadraticDerivativeAt = curveTool.quadraticDerivativeAt;
    var cubicDerivativeAt = curveTool.cubicDerivativeAt;
    var out = [];
    function someVectorAt(shape, t, isTangent) {
        var cpx2 = shape.cpx2;
        var cpy2 = shape.cpy2;
        if (cpx2 === null || cpy2 === null) {
            return [
                (isTangent ? cubicDerivativeAt : cubicAt)(shape.x1, shape.cpx1, shape.cpx2, shape.x2, t),
                (isTangent ? cubicDerivativeAt : cubicAt)(shape.y1, shape.cpy1, shape.cpy2, shape.y2, t)
            ];
        } else {
            return [
                (isTangent ? quadraticDerivativeAt : quadraticAt)(shape.x1, shape.cpx1, shape.x2, t),
                (isTangent ? quadraticDerivativeAt : quadraticAt)(shape.y1, shape.cpy1, shape.y2, t)
            ];
        }
    }
    return require('../Path').extend({
        type: 'bezier-curve',
        shape: {
            x1: 0,
            y1: 0,
            x2: 0,
            y2: 0,
            cpx1: 0,
            cpy1: 0,
            percent: 1
        },
        style: {
            stroke: '#000',
            fill: null
        },
        buildPath: function (ctx, shape) {
            var x1 = shape.x1;
            var y1 = shape.y1;
            var x2 = shape.x2;
            var y2 = shape.y2;
            var cpx1 = shape.cpx1;
            var cpy1 = shape.cpy1;
            var cpx2 = shape.cpx2;
            var cpy2 = shape.cpy2;
            var percent = shape.percent;
            if (percent === 0) {
                return;
            }
            ctx.moveTo(x1, y1);
            if (cpx2 == null || cpy2 == null) {
                if (percent < 1) {
                    quadraticSubdivide(x1, cpx1, x2, percent, out);
                    cpx1 = out[1];
                    x2 = out[2];
                    quadraticSubdivide(y1, cpy1, y2, percent, out);
                    cpy1 = out[1];
                    y2 = out[2];
                }
                ctx.quadraticCurveTo(cpx1, cpy1, x2, y2);
            } else {
                if (percent < 1) {
                    cubicSubdivide(x1, cpx1, cpx2, x2, percent, out);
                    cpx1 = out[1];
                    cpx2 = out[2];
                    x2 = out[3];
                    cubicSubdivide(y1, cpy1, cpy2, y2, percent, out);
                    cpy1 = out[1];
                    cpy2 = out[2];
                    y2 = out[3];
                }
                ctx.bezierCurveTo(cpx1, cpy1, cpx2, cpy2, x2, y2);
            }
        },
        pointAt: function (t) {
            return someVectorAt(this.shape, t, false);
        },
        tangentAt: function (t) {
            var p = someVectorAt(this.shape, t, true);
            return vec2.normalize(p, p);
        }
    });
});
define('zrender/graphic/shape/Arc', ['require', '../Path'], function (require) {
    return require('../Path').extend({
        type: 'arc',
        shape: {
            cx: 0,
            cy: 0,
            r: 0,
            startAngle: 0,
            endAngle: Math.PI * 2,
            clockwise: true
        },
        style: {
            stroke: '#000',
            fill: null
        },
        buildPath: function (ctx, shape) {
            var x = shape.cx;
            var y = shape.cy;
            var r = Math.max(shape.r, 0);
            var startAngle = shape.startAngle;
            var endAngle = shape.endAngle;
            var clockwise = shape.clockwise;
            var unitX = Math.cos(startAngle);
            var unitY = Math.sin(startAngle);
            ctx.moveTo(unitX * r + x, unitY * r + y);
            ctx.arc(x, y, r, startAngle, endAngle, !clockwise);
        }
    });
});
define('zrender/graphic/CompoundPath', ['require', './Path'], function (require) {
    var Path = require('./Path');
    return Path.extend({
        type: 'compound',
        shape: { paths: null },
        _updatePathDirty: function () {
            var dirtyPath = this.__dirtyPath;
            var paths = this.shape.paths;
            for (var i = 0; i < paths.length; i++) {
                // Mark as dirty if any subpath is dirty
                dirtyPath = dirtyPath || paths[i].__dirtyPath;
            }
            this.__dirtyPath = dirtyPath;
            this.__dirty = this.__dirty || dirtyPath;
        },
        beforeBrush: function () {
            this._updatePathDirty();
            var paths = this.shape.paths || [];
            var scale = this.getGlobalScale();
            // Update path scale
            for (var i = 0; i < paths.length; i++) {
                paths[i].path.setScale(scale[0], scale[1]);
            }
        },
        buildPath: function (ctx, shape) {
            var paths = shape.paths || [];
            for (var i = 0; i < paths.length; i++) {
                paths[i].buildPath(ctx, paths[i].shape, true);
            }
        },
        afterBrush: function () {
            var paths = this.shape.paths;
            for (var i = 0; i < paths.length; i++) {
                paths[i].__dirtyPath = false;
            }
        },
        getBoundingRect: function () {
            this._updatePathDirty();
            return Path.prototype.getBoundingRect.call(this);
        }
    });
});
define('zrender/graphic/LinearGradient', ['require', '../core/util', './Gradient'], function (require) {
    'use strict';
    var zrUtil = require('../core/util');
    var Gradient = require('./Gradient');
    /**
     * x, y, x2, y2 are all percent from 0 to 1
     * @param {number} [x=0]
     * @param {number} [y=0]
     * @param {number} [x2=1]
     * @param {number} [y2=0]
     * @param {Array.<Object>} colorStops
     * @param {boolean} [globalCoord=false]
     */
    var LinearGradient = function (x, y, x2, y2, colorStops, globalCoord) {
        this.x = x == null ? 0 : x;
        this.y = y == null ? 0 : y;
        this.x2 = x2 == null ? 1 : x2;
        this.y2 = y2 == null ? 0 : y2;
        // Can be cloned
        this.type = 'linear';
        // If use global coord
        this.global = globalCoord || false;
        Gradient.call(this, colorStops);
    };
    LinearGradient.prototype = { constructor: LinearGradient };
    zrUtil.inherits(LinearGradient, Gradient);
    return LinearGradient;
});
define('zrender/graphic/RadialGradient', ['require', '../core/util', './Gradient'], function (require) {
    'use strict';
    var zrUtil = require('../core/util');
    var Gradient = require('./Gradient');
    /**
     * x, y, r are all percent from 0 to 1
     * @param {number} [x=0.5]
     * @param {number} [y=0.5]
     * @param {number} [r=0.5]
     * @param {Array.<Object>} [colorStops]
     * @param {boolean} [globalCoord=false]
     */
    var RadialGradient = function (x, y, r, colorStops, globalCoord) {
        this.x = x == null ? 0.5 : x;
        this.y = y == null ? 0.5 : y;
        this.r = r == null ? 0.5 : r;
        // Can be cloned
        this.type = 'radial';
        // If use global coord
        this.global = globalCoord || false;
        Gradient.call(this, colorStops);
    };
    RadialGradient.prototype = { constructor: RadialGradient };
    zrUtil.inherits(RadialGradient, Gradient);
    return RadialGradient;
});
define('zrender/core/BoundingRect', ['require', './vector', './matrix'], function (require) {
    'use strict';
    var vec2 = require('./vector');
    var matrix = require('./matrix');
    var v2ApplyTransform = vec2.applyTransform;
    var mathMin = Math.min;
    var mathMax = Math.max;
    /**
     * @alias module:echarts/core/BoundingRect
     */
    function BoundingRect(x, y, width, height) {
        if (width < 0) {
            x = x + width;
            width = -width;
        }
        if (height < 0) {
            y = y + height;
            height = -height;
        }
        /**
         * @type {number}
         */
        this.x = x;
        /**
         * @type {number}
         */
        this.y = y;
        /**
         * @type {number}
         */
        this.width = width;
        /**
         * @type {number}
         */
        this.height = height;
    }
    BoundingRect.prototype = {
        constructor: BoundingRect,
        union: function (other) {
            var x = mathMin(other.x, this.x);
            var y = mathMin(other.y, this.y);
            this.width = mathMax(other.x + other.width, this.x + this.width) - x;
            this.height = mathMax(other.y + other.height, this.y + this.height) - y;
            this.x = x;
            this.y = y;
        },
        applyTransform: function () {
            var lt = [];
            var rb = [];
            var lb = [];
            var rt = [];
            return function (m) {
                // In case usage like this
                // el.getBoundingRect().applyTransform(el.transform)
                // And element has no transform
                if (!m) {
                    return;
                }
                lt[0] = lb[0] = this.x;
                lt[1] = rt[1] = this.y;
                rb[0] = rt[0] = this.x + this.width;
                rb[1] = lb[1] = this.y + this.height;
                v2ApplyTransform(lt, lt, m);
                v2ApplyTransform(rb, rb, m);
                v2ApplyTransform(lb, lb, m);
                v2ApplyTransform(rt, rt, m);
                this.x = mathMin(lt[0], rb[0], lb[0], rt[0]);
                this.y = mathMin(lt[1], rb[1], lb[1], rt[1]);
                var maxX = mathMax(lt[0], rb[0], lb[0], rt[0]);
                var maxY = mathMax(lt[1], rb[1], lb[1], rt[1]);
                this.width = maxX - this.x;
                this.height = maxY - this.y;
            };
        }(),
        calculateTransform: function (b) {
            var a = this;
            var sx = b.width / a.width;
            var sy = b.height / a.height;
            var m = matrix.create();
            // 矩阵右乘
            matrix.translate(m, m, [
                -a.x,
                -a.y
            ]);
            matrix.scale(m, m, [
                sx,
                sy
            ]);
            matrix.translate(m, m, [
                b.x,
                b.y
            ]);
            return m;
        },
        intersect: function (b) {
            if (!b) {
                return false;
            }
            if (!(b instanceof BoundingRect)) {
                // Normalize negative width/height.
                b = BoundingRect.create(b);
            }
            var a = this;
            var ax0 = a.x;
            var ax1 = a.x + a.width;
            var ay0 = a.y;
            var ay1 = a.y + a.height;
            var bx0 = b.x;
            var bx1 = b.x + b.width;
            var by0 = b.y;
            var by1 = b.y + b.height;
            return !(ax1 < bx0 || bx1 < ax0 || ay1 < by0 || by1 < ay0);
        },
        contain: function (x, y) {
            var rect = this;
            return x >= rect.x && x <= rect.x + rect.width && y >= rect.y && y <= rect.y + rect.height;
        },
        clone: function () {
            return new BoundingRect(this.x, this.y, this.width, this.height);
        },
        copy: function (other) {
            this.x = other.x;
            this.y = other.y;
            this.width = other.width;
            this.height = other.height;
        },
        plain: function () {
            return {
                x: this.x,
                y: this.y,
                width: this.width,
                height: this.height
            };
        }
    };
    /**
     * @param {Object|module:zrender/core/BoundingRect} rect
     * @param {number} rect.x
     * @param {number} rect.y
     * @param {number} rect.width
     * @param {number} rect.height
     * @return {module:zrender/core/BoundingRect}
     */
    BoundingRect.create = function (rect) {
        return new BoundingRect(rect.x, rect.y, rect.width, rect.height);
    };
    return BoundingRect;
});
define('zrender/contain/text', ['require', '../core/util', '../core/BoundingRect'], function (require) {
    var textWidthCache = {};
    var textWidthCacheCounter = 0;
    var TEXT_CACHE_MAX = 5000;
    var util = require('../core/util');
    var BoundingRect = require('../core/BoundingRect');
    var retrieve = util.retrieve;
    function getTextWidth(text, textFont) {
        var key = text + ':' + textFont;
        if (textWidthCache[key]) {
            return textWidthCache[key];
        }
        var textLines = (text + '').split('\n');
        var width = 0;
        for (var i = 0, l = textLines.length; i < l; i++) {
            // measureText 可以被覆盖以兼容不支持 Canvas 的环境
            width = Math.max(textContain.measureText(textLines[i], textFont).width, width);
        }
        if (textWidthCacheCounter > TEXT_CACHE_MAX) {
            textWidthCacheCounter = 0;
            textWidthCache = {};
        }
        textWidthCacheCounter++;
        textWidthCache[key] = width;
        return width;
    }
    function getTextRect(text, textFont, textAlign, textBaseline) {
        var textLineLen = ((text || '') + '').split('\n').length;
        var width = getTextWidth(text, textFont);
        // FIXME 高度计算比较粗暴
        var lineHeight = getTextWidth('国', textFont);
        var height = textLineLen * lineHeight;
        var rect = new BoundingRect(0, 0, width, height);
        // Text has a special line height property
        rect.lineHeight = lineHeight;
        switch (textBaseline) {
        case 'bottom':
        case 'alphabetic':
            rect.y -= lineHeight;
            break;
        case 'middle':
            rect.y -= lineHeight / 2;
            break;    // case 'hanging':
                      // case 'top':
        }
        // FIXME Right to left language
        switch (textAlign) {
        case 'end':
        case 'right':
            rect.x -= rect.width;
            break;
        case 'center':
            rect.x -= rect.width / 2;
            break;    // case 'start':
                      // case 'left':
        }
        return rect;
    }
    function adjustTextPositionOnRect(textPosition, rect, textRect, distance) {
        var x = rect.x;
        var y = rect.y;
        var height = rect.height;
        var width = rect.width;
        var textHeight = textRect.height;
        var halfHeight = height / 2 - textHeight / 2;
        var textAlign = 'left';
        switch (textPosition) {
        case 'left':
            x -= distance;
            y += halfHeight;
            textAlign = 'right';
            break;
        case 'right':
            x += distance + width;
            y += halfHeight;
            textAlign = 'left';
            break;
        case 'top':
            x += width / 2;
            y -= distance + textHeight;
            textAlign = 'center';
            break;
        case 'bottom':
            x += width / 2;
            y += height + distance;
            textAlign = 'center';
            break;
        case 'inside':
            x += width / 2;
            y += halfHeight;
            textAlign = 'center';
            break;
        case 'insideLeft':
            x += distance;
            y += halfHeight;
            textAlign = 'left';
            break;
        case 'insideRight':
            x += width - distance;
            y += halfHeight;
            textAlign = 'right';
            break;
        case 'insideTop':
            x += width / 2;
            y += distance;
            textAlign = 'center';
            break;
        case 'insideBottom':
            x += width / 2;
            y += height - textHeight - distance;
            textAlign = 'center';
            break;
        case 'insideTopLeft':
            x += distance;
            y += distance;
            textAlign = 'left';
            break;
        case 'insideTopRight':
            x += width - distance;
            y += distance;
            textAlign = 'right';
            break;
        case 'insideBottomLeft':
            x += distance;
            y += height - textHeight - distance;
            break;
        case 'insideBottomRight':
            x += width - distance;
            y += height - textHeight - distance;
            textAlign = 'right';
            break;
        }
        return {
            x: x,
            y: y,
            textAlign: textAlign,
            textBaseline: 'top'
        };
    }
    /**
     * Show ellipsis if overflow.
     *
     * @param  {string} text
     * @param  {string} containerWidth
     * @param  {string} textFont
     * @param  {number} [ellipsis='...']
     * @param  {Object} [options]
     * @param  {number} [options.maxIterations=3]
     * @param  {number} [options.minChar=0] If truncate result are less
     *                  then minChar, ellipsis will not show, which is
     *                  better for user hint in some cases.
     * @param  {number} [options.placeholder=''] When all truncated, use the placeholder.
     * @return {string}
     */
    function truncateText(text, containerWidth, textFont, ellipsis, options) {
        if (!containerWidth) {
            return '';
        }
        options = options || {};
        ellipsis = retrieve(ellipsis, '...');
        var maxIterations = retrieve(options.maxIterations, 2);
        var minChar = retrieve(options.minChar, 0);
        // FIXME
        // Other languages?
        var cnCharWidth = getTextWidth('国', textFont);
        // FIXME
        // Consider proportional font?
        var ascCharWidth = getTextWidth('a', textFont);
        var placeholder = retrieve(options.placeholder, '');
        // Example 1: minChar: 3, text: 'asdfzxcv', truncate result: 'asdf', but not: 'a...'.
        // Example 2: minChar: 3, text: '维度', truncate result: '维', but not: '...'.
        var contentWidth = containerWidth = Math.max(0, containerWidth - 1);
        // Reserve some gap.
        for (var i = 0; i < minChar && contentWidth >= ascCharWidth; i++) {
            contentWidth -= ascCharWidth;
        }
        var ellipsisWidth = getTextWidth(ellipsis);
        if (ellipsisWidth > contentWidth) {
            ellipsis = '';
            ellipsisWidth = 0;
        }
        contentWidth = containerWidth - ellipsisWidth;
        var textLines = (text + '').split('\n');
        for (var i = 0, len = textLines.length; i < len; i++) {
            var textLine = textLines[i];
            var lineWidth = getTextWidth(textLine, textFont);
            if (lineWidth <= containerWidth) {
                continue;
            }
            for (var j = 0;; j++) {
                if (lineWidth <= contentWidth || j >= maxIterations) {
                    textLine += ellipsis;
                    break;
                }
                var subLength = j === 0 ? estimateLength(textLine, contentWidth, ascCharWidth, cnCharWidth) : lineWidth > 0 ? Math.floor(textLine.length * contentWidth / lineWidth) : 0;
                textLine = textLine.substr(0, subLength);
                lineWidth = getTextWidth(textLine, textFont);
            }
            if (textLine === '') {
                textLine = placeholder;
            }
            textLines[i] = textLine;
        }
        return textLines.join('\n');
    }
    function estimateLength(text, contentWidth, ascCharWidth, cnCharWidth) {
        var width = 0;
        var i = 0;
        for (var len = text.length; i < len && width < contentWidth; i++) {
            var charCode = text.charCodeAt(i);
            width += 0 <= charCode && charCode <= 127 ? ascCharWidth : cnCharWidth;
        }
        return i;
    }
    var textContain = {
            getWidth: getTextWidth,
            getBoundingRect: getTextRect,
            adjustTextPositionOnRect: adjustTextPositionOnRect,
            truncateText: truncateText,
            measureText: function (text, textFont) {
                var ctx = util.getContext();
                ctx.font = textFont || '12px sans-serif';
                return ctx.measureText(text);
            }
        };
    return textContain;
});
define('echarts/coord/axisHelper', ['require', '../scale/Ordinal', '../scale/Interval', '../scale/Time', '../scale/Log', '../scale/Scale', '../util/number', 'zrender/core/util', 'zrender/contain/text'], function (require) {
    var OrdinalScale = require('../scale/Ordinal');
    var IntervalScale = require('../scale/Interval');
    require('../scale/Time');
    require('../scale/Log');
    var Scale = require('../scale/Scale');
    var numberUtil = require('../util/number');
    var zrUtil = require('zrender/core/util');
    var textContain = require('zrender/contain/text');
    var axisHelper = {};
    /**
     * Get axis scale extent before niced.
     */
    axisHelper.getScaleExtent = function (axis, model) {
        var scale = axis.scale;
        var originalExtent = scale.getExtent();
        var span = originalExtent[1] - originalExtent[0];
        if (scale.type === 'ordinal') {
            // If series has no data, scale extent may be wrong
            if (!isFinite(span)) {
                return [
                    0,
                    0
                ];
            } else {
                return originalExtent;
            }
        }
        var min = model.getMin ? model.getMin() : model.get('min');
        var max = model.getMax ? model.getMax() : model.get('max');
        var crossZero = model.getNeedCrossZero ? model.getNeedCrossZero() : !model.get('scale');
        var boundaryGap = model.get('boundaryGap');
        if (!zrUtil.isArray(boundaryGap)) {
            boundaryGap = [
                boundaryGap || 0,
                boundaryGap || 0
            ];
        }
        boundaryGap[0] = numberUtil.parsePercent(boundaryGap[0], 1);
        boundaryGap[1] = numberUtil.parsePercent(boundaryGap[1], 1);
        var fixMin = true;
        var fixMax = true;
        // Add boundary gap
        if (min == null) {
            min = originalExtent[0] - boundaryGap[0] * span;
            fixMin = false;
        }
        if (max == null) {
            max = originalExtent[1] + boundaryGap[1] * span;
            fixMax = false;
        }
        if (min === 'dataMin') {
            min = originalExtent[0];
        }
        if (max === 'dataMax') {
            max = originalExtent[1];
        }
        // Evaluate if axis needs cross zero
        if (crossZero) {
            // Axis is over zero and min is not set
            if (min > 0 && max > 0 && !fixMin) {
                min = 0;
            }
            // Axis is under zero and max is not set
            if (min < 0 && max < 0 && !fixMax) {
                max = 0;
            }
        }
        return [
            min,
            max
        ];
    };
    axisHelper.niceScaleExtent = function (axis, model) {
        var scale = axis.scale;
        var extent = axisHelper.getScaleExtent(axis, model);
        var fixMin = (model.getMin ? model.getMin() : model.get('min')) != null;
        var fixMax = (model.getMax ? model.getMax() : model.get('max')) != null;
        var splitNumber = model.get('splitNumber');
        if (scale.type === 'log') {
            scale.base = model.get('logBase');
        }
        scale.setExtent(extent[0], extent[1]);
        scale.niceExtent(splitNumber, fixMin, fixMax);
        // Use minInterval to constraint the calculated interval.
        // If calculated interval is less than minInterval. increase the interval quantity until
        // it is larger than minInterval.
        // For example:
        //  minInterval is 1, calculated interval is 0.2, so increase it to be 1. In this way we can get
        //  an integer axis.
        var minInterval = model.get('minInterval');
        if (isFinite(minInterval) && !fixMin && !fixMax && scale.type === 'interval') {
            var interval = scale.getInterval();
            var intervalScale = Math.max(Math.abs(interval), minInterval) / interval;
            // while (interval < minInterval) {
            //     var quantity = numberUtil.quantity(interval);
            //     interval = quantity * 10;
            //     scaleQuantity *= 10;
            // }
            extent = scale.getExtent();
            var origin = (extent[1] + extent[0]) / 2;
            scale.setExtent(intervalScale * (extent[0] - origin) + origin, intervalScale * (extent[1] - origin) + origin);
            scale.niceExtent(splitNumber);
        }
        // If some one specified the min, max. And the default calculated interval
        // is not good enough. He can specify the interval. It is often appeared
        // in angle axis with angle 0 - 360. Interval calculated in interval scale is hard
        // to be 60.
        // FIXME
        var interval = model.get('interval');
        if (interval != null) {
            scale.setInterval && scale.setInterval(interval);
        }
    };
    /**
     * @param {module:echarts/model/Model} model
     * @param {string} [axisType] Default retrieve from model.type
     * @return {module:echarts/scale/*}
     */
    axisHelper.createScaleByModel = function (model, axisType) {
        axisType = axisType || model.get('type');
        if (axisType) {
            switch (axisType) {
            // Buildin scale
            case 'category':
                return new OrdinalScale(model.getCategories(), [
                    Infinity,
                    -Infinity
                ]);
            case 'value':
                return new IntervalScale();
            // Extended scale, like time and log
            default:
                return (Scale.getClass(axisType) || IntervalScale).create(model);
            }
        }
    };
    /**
     * Check if the axis corss 0
     */
    axisHelper.ifAxisCrossZero = function (axis) {
        var dataExtent = axis.scale.getExtent();
        var min = dataExtent[0];
        var max = dataExtent[1];
        return !(min > 0 && max > 0 || min < 0 && max < 0);
    };
    /**
     * @param {Array.<number>} tickCoords In axis self coordinate.
     * @param {Array.<string>} labels
     * @param {string} font
     * @param {boolean} isAxisHorizontal
     * @return {number}
     */
    axisHelper.getAxisLabelInterval = function (tickCoords, labels, font, isAxisHorizontal) {
        // FIXME
        // 不同角的axis和label，不只是horizontal和vertical.
        var textSpaceTakenRect;
        var autoLabelInterval = 0;
        var accumulatedLabelInterval = 0;
        var step = 1;
        if (labels.length > 40) {
            // Simple optimization for large amount of labels
            step = Math.floor(labels.length / 40);
        }
        for (var i = 0; i < tickCoords.length; i += step) {
            var tickCoord = tickCoords[i];
            var rect = textContain.getBoundingRect(labels[i], font, 'center', 'top');
            rect[isAxisHorizontal ? 'x' : 'y'] += tickCoord;
            // FIXME Magic number 1.5
            rect[isAxisHorizontal ? 'width' : 'height'] *= 1.3;
            if (!textSpaceTakenRect) {
                textSpaceTakenRect = rect.clone();
            }    // There is no space for current label;
            else if (textSpaceTakenRect.intersect(rect)) {
                accumulatedLabelInterval++;
                autoLabelInterval = Math.max(autoLabelInterval, accumulatedLabelInterval);
            } else {
                textSpaceTakenRect.union(rect);
                // Reset
                accumulatedLabelInterval = 0;
            }
        }
        if (autoLabelInterval === 0 && step > 1) {
            return step;
        }
        return (autoLabelInterval + 1) * step - 1;
    };
    /**
     * @param {Object} axis
     * @param {Function} labelFormatter
     * @return {Array.<string>}
     */
    axisHelper.getFormattedLabels = function (axis, labelFormatter) {
        var scale = axis.scale;
        var labels = scale.getTicksLabels();
        var ticks = scale.getTicks();
        if (typeof labelFormatter === 'string') {
            labelFormatter = function (tpl) {
                return function (val) {
                    return tpl.replace('{value}', val != null ? val : '');
                };
            }(labelFormatter);
            // Consider empty array
            return zrUtil.map(labels, labelFormatter);
        } else if (typeof labelFormatter === 'function') {
            return zrUtil.map(ticks, function (tick, idx) {
                return labelFormatter(axis.type === 'category' ? scale.getLabel(tick) : tick, idx);
            }, this);
        } else {
            return labels;
        }
    };
    return axisHelper;
});
define('echarts/coord/cartesian/Cartesian2D', ['require', 'zrender/core/util', './Cartesian'], function (require) {
    'use strict';
    var zrUtil = require('zrender/core/util');
    var Cartesian = require('./Cartesian');
    function Cartesian2D(name) {
        Cartesian.call(this, name);
    }
    Cartesian2D.prototype = {
        constructor: Cartesian2D,
        type: 'cartesian2d',
        dimensions: [
            'x',
            'y'
        ],
        getBaseAxis: function () {
            return this.getAxesByScale('ordinal')[0] || this.getAxesByScale('time')[0] || this.getAxis('x');
        },
        containPoint: function (point) {
            var axisX = this.getAxis('x');
            var axisY = this.getAxis('y');
            return axisX.contain(axisX.toLocalCoord(point[0])) && axisY.contain(axisY.toLocalCoord(point[1]));
        },
        containData: function (data) {
            return this.getAxis('x').containData(data[0]) && this.getAxis('y').containData(data[1]);
        },
        dataToPoints: function (data, stack) {
            return data.mapArray([
                'x',
                'y'
            ], function (x, y) {
                return this.dataToPoint([
                    x,
                    y
                ]);
            }, stack, this);
        },
        dataToPoint: function (data, clamp) {
            var xAxis = this.getAxis('x');
            var yAxis = this.getAxis('y');
            return [
                xAxis.toGlobalCoord(xAxis.dataToCoord(data[0], clamp)),
                yAxis.toGlobalCoord(yAxis.dataToCoord(data[1], clamp))
            ];
        },
        pointToData: function (point, clamp) {
            var xAxis = this.getAxis('x');
            var yAxis = this.getAxis('y');
            return [
                xAxis.coordToData(xAxis.toLocalCoord(point[0]), clamp),
                yAxis.coordToData(yAxis.toLocalCoord(point[1]), clamp)
            ];
        },
        getOtherAxis: function (axis) {
            return this.getAxis(axis.dim === 'x' ? 'y' : 'x');
        }
    };
    zrUtil.inherits(Cartesian2D, Cartesian);
    return Cartesian2D;
});
define('echarts/coord/cartesian/Axis2D', ['require', 'zrender/core/util', '../Axis', './axisLabelInterval'], function (require) {
    var zrUtil = require('zrender/core/util');
    var Axis = require('../Axis');
    var axisLabelInterval = require('./axisLabelInterval');
    /**
     * Extend axis 2d
     * @constructor module:echarts/coord/cartesian/Axis2D
     * @extends {module:echarts/coord/cartesian/Axis}
     * @param {string} dim
     * @param {*} scale
     * @param {Array.<number>} coordExtent
     * @param {string} axisType
     * @param {string} position
     */
    var Axis2D = function (dim, scale, coordExtent, axisType, position) {
        Axis.call(this, dim, scale, coordExtent);
        /**
         * Axis type
         *  - 'category'
         *  - 'value'
         *  - 'time'
         *  - 'log'
         * @type {string}
         */
        this.type = axisType || 'value';
        /**
         * Axis position
         *  - 'top'
         *  - 'bottom'
         *  - 'left'
         *  - 'right'
         */
        this.position = position || 'bottom';
    };
    Axis2D.prototype = {
        constructor: Axis2D,
        index: 0,
        onZero: false,
        model: null,
        isHorizontal: function () {
            var position = this.position;
            return position === 'top' || position === 'bottom';
        },
        getGlobalExtent: function () {
            var ret = this.getExtent();
            ret[0] = this.toGlobalCoord(ret[0]);
            ret[1] = this.toGlobalCoord(ret[1]);
            return ret;
        },
        getLabelInterval: function () {
            var labelInterval = this._labelInterval;
            if (!labelInterval) {
                labelInterval = this._labelInterval = axisLabelInterval(this);
            }
            return labelInterval;
        },
        isLabelIgnored: function (idx) {
            if (this.type === 'category') {
                var labelInterval = this.getLabelInterval();
                return typeof labelInterval === 'function' && !labelInterval(idx, this.scale.getLabel(idx)) || idx % (labelInterval + 1);
            }
        },
        toLocalCoord: null,
        toGlobalCoord: null
    };
    zrUtil.inherits(Axis2D, Axis);
    return Axis2D;
});
define('echarts/coord/cartesian/GridModel', ['require', './AxisModel', '../../model/Component'], function (require) {
    'use strict';
    require('./AxisModel');
    var ComponentModel = require('../../model/Component');
    return ComponentModel.extend({
        type: 'grid',
        dependencies: [
            'xAxis',
            'yAxis'
        ],
        layoutMode: 'box',
        coordinateSystem: null,
        defaultOption: {
            show: false,
            zlevel: 0,
            z: 0,
            left: '10%',
            top: 60,
            right: '10%',
            bottom: 60,
            containLabel: false,
            backgroundColor: 'rgba(0,0,0,0)',
            borderWidth: 1,
            borderColor: '#ccc'
        }
    });
});
define('echarts/util/clazz', ['require', 'zrender/core/util'], function (require) {
    var zrUtil = require('zrender/core/util');
    var clazz = {};
    var TYPE_DELIMITER = '.';
    var IS_CONTAINER = '___EC__COMPONENT__CONTAINER___';
    /**
     * @public
     */
    var parseClassType = clazz.parseClassType = function (componentType) {
            var ret = {
                    main: '',
                    sub: ''
                };
            if (componentType) {
                componentType = componentType.split(TYPE_DELIMITER);
                ret.main = componentType[0] || '';
                ret.sub = componentType[1] || '';
            }
            return ret;
        };
    /**
     * @public
     */
    clazz.enableClassExtend = function (RootClass, mandatoryMethods) {
        RootClass.$constructor = RootClass;
        RootClass.extend = function (proto) {
            if (true) {
                zrUtil.each(mandatoryMethods, function (method) {
                    if (!proto[method]) {
                        console.warn('Method `' + method + '` should be implemented' + (proto.type ? ' in ' + proto.type : '') + '.');
                    }
                });
            }
            var superClass = this;
            var ExtendedClass = function () {
                if (!proto.$constructor) {
                    superClass.apply(this, arguments);
                } else {
                    proto.$constructor.apply(this, arguments);
                }
            };
            zrUtil.extend(ExtendedClass.prototype, proto);
            ExtendedClass.extend = this.extend;
            ExtendedClass.superCall = superCall;
            ExtendedClass.superApply = superApply;
            zrUtil.inherits(ExtendedClass, this);
            ExtendedClass.superClass = superClass;
            return ExtendedClass;
        };
    };
    // superCall should have class info, which can not be fetch from 'this'.
    // Consider this case:
    // class A has method f,
    // class B inherits class A, overrides method f, f call superApply('f'),
    // class C inherits class B, do not overrides method f,
    // then when method of class C is called, dead loop occured.
    function superCall(context, methodName) {
        var args = zrUtil.slice(arguments, 2);
        return this.superClass.prototype[methodName].apply(context, args);
    }
    function superApply(context, methodName, args) {
        return this.superClass.prototype[methodName].apply(context, args);
    }
    /**
     * @param {Object} entity
     * @param {Object} options
     * @param {boolean} [options.registerWhenExtend]
     * @public
     */
    clazz.enableClassManagement = function (entity, options) {
        options = options || {};
        /**
         * Component model classes
         * key: componentType,
         * value:
         *     componentClass, when componentType is 'xxx'
         *     or Object.<subKey, componentClass>, when componentType is 'xxx.yy'
         * @type {Object}
         */
        var storage = {};
        entity.registerClass = function (Clazz, componentType) {
            if (componentType) {
                componentType = parseClassType(componentType);
                if (!componentType.sub) {
                    if (true) {
                        if (storage[componentType.main]) {
                            console.warn(componentType.main + ' exists.');
                        }
                    }
                    storage[componentType.main] = Clazz;
                } else if (componentType.sub !== IS_CONTAINER) {
                    var container = makeContainer(componentType);
                    container[componentType.sub] = Clazz;
                }
            }
            return Clazz;
        };
        entity.getClass = function (componentTypeMain, subType, throwWhenNotFound) {
            var Clazz = storage[componentTypeMain];
            if (Clazz && Clazz[IS_CONTAINER]) {
                Clazz = subType ? Clazz[subType] : null;
            }
            if (throwWhenNotFound && !Clazz) {
                throw new Error('Component ' + componentTypeMain + '.' + (subType || '') + ' not exists. Load it first.');
            }
            return Clazz;
        };
        entity.getClassesByMainType = function (componentType) {
            componentType = parseClassType(componentType);
            var result = [];
            var obj = storage[componentType.main];
            if (obj && obj[IS_CONTAINER]) {
                zrUtil.each(obj, function (o, type) {
                    type !== IS_CONTAINER && result.push(o);
                });
            } else {
                result.push(obj);
            }
            return result;
        };
        entity.hasClass = function (componentType) {
            // Just consider componentType.main.
            componentType = parseClassType(componentType);
            return !!storage[componentType.main];
        };
        /**
         * @return {Array.<string>} Like ['aa', 'bb'], but can not be ['aa.xx']
         */
        entity.getAllClassMainTypes = function () {
            var types = [];
            zrUtil.each(storage, function (obj, type) {
                types.push(type);
            });
            return types;
        };
        /**
         * If a main type is container and has sub types
         * @param  {string}  mainType
         * @return {boolean}
         */
        entity.hasSubTypes = function (componentType) {
            componentType = parseClassType(componentType);
            var obj = storage[componentType.main];
            return obj && obj[IS_CONTAINER];
        };
        entity.parseClassType = parseClassType;
        function makeContainer(componentType) {
            var container = storage[componentType.main];
            if (!container || !container[IS_CONTAINER]) {
                container = storage[componentType.main] = {};
                container[IS_CONTAINER] = true;
            }
            return container;
        }
        if (options.registerWhenExtend) {
            var originalExtend = entity.extend;
            if (originalExtend) {
                entity.extend = function (proto) {
                    var ExtendedClass = originalExtend.call(this, proto);
                    return entity.registerClass(ExtendedClass, proto.type);
                };
            }
        }
        return entity;
    };
    /**
     * @param {string|Array.<string>} properties
     */
    clazz.setReadOnly = function (obj, properties) {
    };
    return clazz;
});
define('echarts/model/mixin/lineStyle', ['require', './makeStyleMapper'], function (require) {
    var getLineStyle = require('./makeStyleMapper')([
            [
                'lineWidth',
                'width'
            ],
            [
                'stroke',
                'color'
            ],
            ['opacity'],
            ['shadowBlur'],
            ['shadowOffsetX'],
            ['shadowOffsetY'],
            ['shadowColor']
        ]);
    return {
        getLineStyle: function (excludes) {
            var style = getLineStyle.call(this, excludes);
            var lineDash = this.getLineDash(style.lineWidth);
            lineDash && (style.lineDash = lineDash);
            return style;
        },
        getLineDash: function (lineWidth) {
            if (lineWidth == null) {
                lineWidth = 1;
            }
            var lineType = this.get('type');
            var dotSize = Math.max(lineWidth, 2);
            var dashSize = lineWidth * 4;
            return lineType === 'solid' || lineType == null ? null : lineType === 'dashed' ? [
                dashSize,
                dashSize
            ] : [
                dotSize,
                dotSize
            ];
        }
    };
});
define('echarts/model/mixin/areaStyle', ['require', './makeStyleMapper'], function (require) {
    return {
        getAreaStyle: require('./makeStyleMapper')([
            [
                'fill',
                'color'
            ],
            ['shadowBlur'],
            ['shadowOffsetX'],
            ['shadowOffsetY'],
            ['opacity'],
            ['shadowColor']
        ])
    };
});
define('echarts/model/mixin/textStyle', ['require', 'zrender/contain/text'], function (require) {
    var textContain = require('zrender/contain/text');
    function getShallow(model, path) {
        return model && model.getShallow(path);
    }
    return {
        getTextColor: function () {
            var ecModel = this.ecModel;
            return this.getShallow('color') || ecModel && ecModel.get('textStyle.color');
        },
        getFont: function () {
            var ecModel = this.ecModel;
            var gTextStyleModel = ecModel && ecModel.getModel('textStyle');
            return [
                this.getShallow('fontStyle') || getShallow(gTextStyleModel, 'fontStyle'),
                this.getShallow('fontWeight') || getShallow(gTextStyleModel, 'fontWeight'),
                (this.getShallow('fontSize') || getShallow(gTextStyleModel, 'fontSize') || 12) + 'px',
                this.getShallow('fontFamily') || getShallow(gTextStyleModel, 'fontFamily') || 'sans-serif'
            ].join(' ');
        },
        getTextRect: function (text) {
            return textContain.getBoundingRect(text, this.getFont(), this.getShallow('align'), this.getShallow('baseline'));
        },
        truncateText: function (text, containerWidth, ellipsis, options) {
            return textContain.truncateText(text, containerWidth, this.getFont(), ellipsis, options);
        }
    };
});
define('echarts/model/mixin/itemStyle', ['require', './makeStyleMapper'], function (require) {
    var getItemStyle = require('./makeStyleMapper')([
            [
                'fill',
                'color'
            ],
            [
                'stroke',
                'borderColor'
            ],
            [
                'lineWidth',
                'borderWidth'
            ],
            ['opacity'],
            ['shadowBlur'],
            ['shadowOffsetX'],
            ['shadowOffsetY'],
            ['shadowColor'],
            ['textPosition'],
            ['textAlign']
        ]);
    return {
        getItemStyle: function (excludes) {
            var style = getItemStyle.call(this, excludes);
            var lineDash = this.getBorderLineDash();
            lineDash && (style.lineDash = lineDash);
            return style;
        },
        getBorderLineDash: function () {
            var lineType = this.get('borderType');
            return lineType === 'solid' || lineType == null ? null : lineType === 'dashed' ? [
                5,
                5
            ] : [
                1,
                1
            ];
        }
    };
});
define('zrender/core/PathProxy', ['require', './curve', './vector', './bbox', './BoundingRect', '../config'], function (require) {
    'use strict';
    var curve = require('./curve');
    var vec2 = require('./vector');
    var bbox = require('./bbox');
    var BoundingRect = require('./BoundingRect');
    var dpr = require('../config').devicePixelRatio;
    var CMD = {
            M: 1,
            L: 2,
            C: 3,
            Q: 4,
            A: 5,
            Z: 6,
            R: 7
        };
    var min = [];
    var max = [];
    var min2 = [];
    var max2 = [];
    var mathMin = Math.min;
    var mathMax = Math.max;
    var mathCos = Math.cos;
    var mathSin = Math.sin;
    var mathSqrt = Math.sqrt;
    var mathAbs = Math.abs;
    var hasTypedArray = typeof Float32Array != 'undefined';
    /**
     * @alias module:zrender/core/PathProxy
     * @constructor
     */
    var PathProxy = function () {
        /**
         * Path data. Stored as flat array
         * @type {Array.<Object>}
         */
        this.data = [];
        this._len = 0;
        this._ctx = null;
        this._xi = 0;
        this._yi = 0;
        this._x0 = 0;
        this._y0 = 0;
        // Unit x, Unit y. Provide for avoiding drawing that too short line segment
        this._ux = 0;
        this._uy = 0;
    };
    /**
     * 快速计算Path包围盒（并不是最小包围盒）
     * @return {Object}
     */
    PathProxy.prototype = {
        constructor: PathProxy,
        _lineDash: null,
        _dashOffset: 0,
        _dashIdx: 0,
        _dashSum: 0,
        setScale: function (sx, sy) {
            this._ux = mathAbs(1 / dpr / sx) || 0;
            this._uy = mathAbs(1 / dpr / sy) || 0;
        },
        getContext: function () {
            return this._ctx;
        },
        beginPath: function (ctx) {
            this._ctx = ctx;
            ctx && ctx.beginPath();
            ctx && (this.dpr = ctx.dpr);
            // Reset
            this._len = 0;
            if (this._lineDash) {
                this._lineDash = null;
                this._dashOffset = 0;
            }
            return this;
        },
        moveTo: function (x, y) {
            this.addData(CMD.M, x, y);
            this._ctx && this._ctx.moveTo(x, y);
            // x0, y0, xi, yi 是记录在 _dashedXXXXTo 方法中使用
            // xi, yi 记录当前点, x0, y0 在 closePath 的时候回到起始点。
            // 有可能在 beginPath 之后直接调用 lineTo，这时候 x0, y0 需要
            // 在 lineTo 方法中记录，这里先不考虑这种情况，dashed line 也只在 IE10- 中不支持
            this._x0 = x;
            this._y0 = y;
            this._xi = x;
            this._yi = y;
            return this;
        },
        lineTo: function (x, y) {
            var exceedUnit = mathAbs(x - this._xi) > this._ux || mathAbs(y - this._yi) > this._uy || this._len < 5;
            this.addData(CMD.L, x, y);
            if (this._ctx && exceedUnit) {
                this._needsDash() ? this._dashedLineTo(x, y) : this._ctx.lineTo(x, y);
            }
            if (exceedUnit) {
                this._xi = x;
                this._yi = y;
            }
            return this;
        },
        bezierCurveTo: function (x1, y1, x2, y2, x3, y3) {
            this.addData(CMD.C, x1, y1, x2, y2, x3, y3);
            if (this._ctx) {
                this._needsDash() ? this._dashedBezierTo(x1, y1, x2, y2, x3, y3) : this._ctx.bezierCurveTo(x1, y1, x2, y2, x3, y3);
            }
            this._xi = x3;
            this._yi = y3;
            return this;
        },
        quadraticCurveTo: function (x1, y1, x2, y2) {
            this.addData(CMD.Q, x1, y1, x2, y2);
            if (this._ctx) {
                this._needsDash() ? this._dashedQuadraticTo(x1, y1, x2, y2) : this._ctx.quadraticCurveTo(x1, y1, x2, y2);
            }
            this._xi = x2;
            this._yi = y2;
            return this;
        },
        arc: function (cx, cy, r, startAngle, endAngle, anticlockwise) {
            this.addData(CMD.A, cx, cy, r, r, startAngle, endAngle - startAngle, 0, anticlockwise ? 0 : 1);
            this._ctx && this._ctx.arc(cx, cy, r, startAngle, endAngle, anticlockwise);
            this._xi = mathCos(endAngle) * r + cx;
            this._xi = mathSin(endAngle) * r + cx;
            return this;
        },
        arcTo: function (x1, y1, x2, y2, radius) {
            if (this._ctx) {
                this._ctx.arcTo(x1, y1, x2, y2, radius);
            }
            return this;
        },
        rect: function (x, y, w, h) {
            this._ctx && this._ctx.rect(x, y, w, h);
            this.addData(CMD.R, x, y, w, h);
            return this;
        },
        closePath: function () {
            this.addData(CMD.Z);
            var ctx = this._ctx;
            var x0 = this._x0;
            var y0 = this._y0;
            if (ctx) {
                this._needsDash() && this._dashedLineTo(x0, y0);
                ctx.closePath();
            }
            this._xi = x0;
            this._yi = y0;
            return this;
        },
        fill: function (ctx) {
            ctx && ctx.fill();
            this.toStatic();
        },
        stroke: function (ctx) {
            ctx && ctx.stroke();
            this.toStatic();
        },
        setLineDash: function (lineDash) {
            if (lineDash instanceof Array) {
                this._lineDash = lineDash;
                this._dashIdx = 0;
                var lineDashSum = 0;
                for (var i = 0; i < lineDash.length; i++) {
                    lineDashSum += lineDash[i];
                }
                this._dashSum = lineDashSum;
            }
            return this;
        },
        setLineDashOffset: function (offset) {
            this._dashOffset = offset;
            return this;
        },
        len: function () {
            return this._len;
        },
        setData: function (data) {
            var len = data.length;
            if (!(this.data && this.data.length == len) && hasTypedArray) {
                this.data = new Float32Array(len);
            }
            for (var i = 0; i < len; i++) {
                this.data[i] = data[i];
            }
            this._len = len;
        },
        appendPath: function (path) {
            if (!(path instanceof Array)) {
                path = [path];
            }
            var len = path.length;
            var appendSize = 0;
            var offset = this._len;
            for (var i = 0; i < len; i++) {
                appendSize += path[i].len();
            }
            if (hasTypedArray && this.data instanceof Float32Array) {
                this.data = new Float32Array(offset + appendSize);
            }
            for (var i = 0; i < len; i++) {
                var appendPathData = path[i].data;
                for (var k = 0; k < appendPathData.length; k++) {
                    this.data[offset++] = appendPathData[k];
                }
            }
            this._len = offset;
        },
        addData: function (cmd) {
            var data = this.data;
            if (this._len + arguments.length > data.length) {
                // 因为之前的数组已经转换成静态的 Float32Array
                // 所以不够用时需要扩展一个新的动态数组
                this._expandData();
                data = this.data;
            }
            for (var i = 0; i < arguments.length; i++) {
                data[this._len++] = arguments[i];
            }
            this._prevCmd = cmd;
        },
        _expandData: function () {
            // Only if data is Float32Array
            if (!(this.data instanceof Array)) {
                var newData = [];
                for (var i = 0; i < this._len; i++) {
                    newData[i] = this.data[i];
                }
                this.data = newData;
            }
        },
        _needsDash: function () {
            return this._lineDash;
        },
        _dashedLineTo: function (x1, y1) {
            var dashSum = this._dashSum;
            var offset = this._dashOffset;
            var lineDash = this._lineDash;
            var ctx = this._ctx;
            var x0 = this._xi;
            var y0 = this._yi;
            var dx = x1 - x0;
            var dy = y1 - y0;
            var dist = mathSqrt(dx * dx + dy * dy);
            var x = x0;
            var y = y0;
            var dash;
            var nDash = lineDash.length;
            var idx;
            dx /= dist;
            dy /= dist;
            if (offset < 0) {
                // Convert to positive offset
                offset = dashSum + offset;
            }
            offset %= dashSum;
            x -= offset * dx;
            y -= offset * dy;
            while (dx > 0 && x <= x1 || dx < 0 && x >= x1 || dx == 0 && (dy > 0 && y <= y1 || dy < 0 && y >= y1)) {
                idx = this._dashIdx;
                dash = lineDash[idx];
                x += dx * dash;
                y += dy * dash;
                this._dashIdx = (idx + 1) % nDash;
                // Skip positive offset
                if (dx > 0 && x < x0 || dx < 0 && x > x0 || dy > 0 && y < y0 || dy < 0 && y > y0) {
                    continue;
                }
                ctx[idx % 2 ? 'moveTo' : 'lineTo'](dx >= 0 ? mathMin(x, x1) : mathMax(x, x1), dy >= 0 ? mathMin(y, y1) : mathMax(y, y1));
            }
            // Offset for next lineTo
            dx = x - x1;
            dy = y - y1;
            this._dashOffset = -mathSqrt(dx * dx + dy * dy);
        },
        _dashedBezierTo: function (x1, y1, x2, y2, x3, y3) {
            var dashSum = this._dashSum;
            var offset = this._dashOffset;
            var lineDash = this._lineDash;
            var ctx = this._ctx;
            var x0 = this._xi;
            var y0 = this._yi;
            var t;
            var dx;
            var dy;
            var cubicAt = curve.cubicAt;
            var bezierLen = 0;
            var idx = this._dashIdx;
            var nDash = lineDash.length;
            var x;
            var y;
            var tmpLen = 0;
            if (offset < 0) {
                // Convert to positive offset
                offset = dashSum + offset;
            }
            offset %= dashSum;
            // Bezier approx length
            for (t = 0; t < 1; t += 0.1) {
                dx = cubicAt(x0, x1, x2, x3, t + 0.1) - cubicAt(x0, x1, x2, x3, t);
                dy = cubicAt(y0, y1, y2, y3, t + 0.1) - cubicAt(y0, y1, y2, y3, t);
                bezierLen += mathSqrt(dx * dx + dy * dy);
            }
            // Find idx after add offset
            for (; idx < nDash; idx++) {
                tmpLen += lineDash[idx];
                if (tmpLen > offset) {
                    break;
                }
            }
            t = (tmpLen - offset) / bezierLen;
            while (t <= 1) {
                x = cubicAt(x0, x1, x2, x3, t);
                y = cubicAt(y0, y1, y2, y3, t);
                // Use line to approximate dashed bezier
                // Bad result if dash is long
                idx % 2 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
                t += lineDash[idx] / bezierLen;
                idx = (idx + 1) % nDash;
            }
            // Finish the last segment and calculate the new offset
            idx % 2 !== 0 && ctx.lineTo(x3, y3);
            dx = x3 - x;
            dy = y3 - y;
            this._dashOffset = -mathSqrt(dx * dx + dy * dy);
        },
        _dashedQuadraticTo: function (x1, y1, x2, y2) {
            // Convert quadratic to cubic using degree elevation
            var x3 = x2;
            var y3 = y2;
            x2 = (x2 + 2 * x1) / 3;
            y2 = (y2 + 2 * y1) / 3;
            x1 = (this._xi + 2 * x1) / 3;
            y1 = (this._yi + 2 * y1) / 3;
            this._dashedBezierTo(x1, y1, x2, y2, x3, y3);
        },
        toStatic: function () {
            var data = this.data;
            if (data instanceof Array) {
                data.length = this._len;
                if (hasTypedArray) {
                    this.data = new Float32Array(data);
                }
            }
        },
        getBoundingRect: function () {
            min[0] = min[1] = min2[0] = min2[1] = Number.MAX_VALUE;
            max[0] = max[1] = max2[0] = max2[1] = -Number.MAX_VALUE;
            var data = this.data;
            var xi = 0;
            var yi = 0;
            var x0 = 0;
            var y0 = 0;
            for (var i = 0; i < data.length;) {
                var cmd = data[i++];
                if (i == 1) {
                    // 如果第一个命令是 L, C, Q
                    // 则 previous point 同绘制命令的第一个 point
                    //
                    // 第一个命令为 Arc 的情况下会在后面特殊处理
                    xi = data[i];
                    yi = data[i + 1];
                    x0 = xi;
                    y0 = yi;
                }
                switch (cmd) {
                case CMD.M:
                    // moveTo 命令重新创建一个新的 subpath, 并且更新新的起点
                    // 在 closePath 的时候使用
                    x0 = data[i++];
                    y0 = data[i++];
                    xi = x0;
                    yi = y0;
                    min2[0] = x0;
                    min2[1] = y0;
                    max2[0] = x0;
                    max2[1] = y0;
                    break;
                case CMD.L:
                    bbox.fromLine(xi, yi, data[i], data[i + 1], min2, max2);
                    xi = data[i++];
                    yi = data[i++];
                    break;
                case CMD.C:
                    bbox.fromCubic(xi, yi, data[i++], data[i++], data[i++], data[i++], data[i], data[i + 1], min2, max2);
                    xi = data[i++];
                    yi = data[i++];
                    break;
                case CMD.Q:
                    bbox.fromQuadratic(xi, yi, data[i++], data[i++], data[i], data[i + 1], min2, max2);
                    xi = data[i++];
                    yi = data[i++];
                    break;
                case CMD.A:
                    // TODO Arc 判断的开销比较大
                    var cx = data[i++];
                    var cy = data[i++];
                    var rx = data[i++];
                    var ry = data[i++];
                    var startAngle = data[i++];
                    var endAngle = data[i++] + startAngle;
                    // TODO Arc 旋转
                    var psi = data[i++];
                    var anticlockwise = 1 - data[i++];
                    if (i == 1) {
                        // 直接使用 arc 命令
                        // 第一个命令起点还未定义
                        x0 = mathCos(startAngle) * rx + cx;
                        y0 = mathSin(startAngle) * ry + cy;
                    }
                    bbox.fromArc(cx, cy, rx, ry, startAngle, endAngle, anticlockwise, min2, max2);
                    xi = mathCos(endAngle) * rx + cx;
                    yi = mathSin(endAngle) * ry + cy;
                    break;
                case CMD.R:
                    x0 = xi = data[i++];
                    y0 = yi = data[i++];
                    var width = data[i++];
                    var height = data[i++];
                    // Use fromLine
                    bbox.fromLine(x0, y0, x0 + width, y0 + height, min2, max2);
                    break;
                case CMD.Z:
                    xi = x0;
                    yi = y0;
                    break;
                }
                // Union
                vec2.min(min, min, min2);
                vec2.max(max, max, max2);
            }
            // No data
            if (i === 0) {
                min[0] = min[1] = max[0] = max[1] = 0;
            }
            return new BoundingRect(min[0], min[1], max[0] - min[0], max[1] - min[1]);
        },
        rebuildPath: function (ctx) {
            var d = this.data;
            var x0, y0;
            var xi, yi;
            var x, y;
            var ux = this._ux;
            var uy = this._uy;
            var len = this._len;
            for (var i = 0; i < len;) {
                var cmd = d[i++];
                if (i == 1) {
                    // 如果第一个命令是 L, C, Q
                    // 则 previous point 同绘制命令的第一个 point
                    //
                    // 第一个命令为 Arc 的情况下会在后面特殊处理
                    xi = d[i];
                    yi = d[i + 1];
                    x0 = xi;
                    y0 = yi;
                }
                switch (cmd) {
                case CMD.M:
                    x0 = xi = d[i++];
                    y0 = yi = d[i++];
                    ctx.moveTo(xi, yi);
                    break;
                case CMD.L:
                    x = d[i++];
                    y = d[i++];
                    // Not draw too small seg between
                    if (mathAbs(x - xi) > ux || mathAbs(y - yi) > uy || i === len - 1) {
                        ctx.lineTo(x, y);
                        xi = x;
                        yi = y;
                    }
                    break;
                case CMD.C:
                    ctx.bezierCurveTo(d[i++], d[i++], d[i++], d[i++], d[i++], d[i++]);
                    xi = d[i - 2];
                    yi = d[i - 1];
                    break;
                case CMD.Q:
                    ctx.quadraticCurveTo(d[i++], d[i++], d[i++], d[i++]);
                    xi = d[i - 2];
                    yi = d[i - 1];
                    break;
                case CMD.A:
                    var cx = d[i++];
                    var cy = d[i++];
                    var rx = d[i++];
                    var ry = d[i++];
                    var theta = d[i++];
                    var dTheta = d[i++];
                    var psi = d[i++];
                    var fs = d[i++];
                    var r = rx > ry ? rx : ry;
                    var scaleX = rx > ry ? 1 : rx / ry;
                    var scaleY = rx > ry ? ry / rx : 1;
                    var isEllipse = Math.abs(rx - ry) > 0.001;
                    var endAngle = theta + dTheta;
                    if (isEllipse) {
                        ctx.translate(cx, cy);
                        ctx.rotate(psi);
                        ctx.scale(scaleX, scaleY);
                        ctx.arc(0, 0, r, theta, endAngle, 1 - fs);
                        ctx.scale(1 / scaleX, 1 / scaleY);
                        ctx.rotate(-psi);
                        ctx.translate(-cx, -cy);
                    } else {
                        ctx.arc(cx, cy, r, theta, endAngle, 1 - fs);
                    }
                    if (i == 1) {
                        // 直接使用 arc 命令
                        // 第一个命令起点还未定义
                        x0 = mathCos(theta) * rx + cx;
                        y0 = mathSin(theta) * ry + cy;
                    }
                    xi = mathCos(endAngle) * rx + cx;
                    yi = mathSin(endAngle) * ry + cy;
                    break;
                case CMD.R:
                    x0 = xi = d[i];
                    y0 = yi = d[i + 1];
                    ctx.rect(d[i++], d[i++], d[i++], d[i++]);
                    break;
                case CMD.Z:
                    ctx.closePath();
                    xi = x0;
                    yi = y0;
                }
            }
        }
    };
    PathProxy.CMD = CMD;
    return PathProxy;
});
define('zrender/tool/transformPath', ['require', '../core/PathProxy', '../core/vector'], function (require) {
    var CMD = require('../core/PathProxy').CMD;
    var vec2 = require('../core/vector');
    var v2ApplyTransform = vec2.applyTransform;
    var points = [
            [],
            [],
            []
        ];
    var mathSqrt = Math.sqrt;
    var mathAtan2 = Math.atan2;
    function transformPath(path, m) {
        var data = path.data;
        var cmd;
        var nPoint;
        var i;
        var j;
        var k;
        var p;
        var M = CMD.M;
        var C = CMD.C;
        var L = CMD.L;
        var R = CMD.R;
        var A = CMD.A;
        var Q = CMD.Q;
        for (i = 0, j = 0; i < data.length;) {
            cmd = data[i++];
            j = i;
            nPoint = 0;
            switch (cmd) {
            case M:
                nPoint = 1;
                break;
            case L:
                nPoint = 1;
                break;
            case C:
                nPoint = 3;
                break;
            case Q:
                nPoint = 2;
                break;
            case A:
                var x = m[4];
                var y = m[5];
                var sx = mathSqrt(m[0] * m[0] + m[1] * m[1]);
                var sy = mathSqrt(m[2] * m[2] + m[3] * m[3]);
                var angle = mathAtan2(-m[1] / sy, m[0] / sx);
                // cx
                data[i++] += x;
                // cy
                data[i++] += y;
                // Scale rx and ry
                // FIXME Assume psi is 0 here
                data[i++] *= sx;
                data[i++] *= sy;
                // Start angle
                data[i++] += angle;
                // end angle
                data[i++] += angle;
                // FIXME psi
                i += 2;
                j = i;
                break;
            case R:
                // x0, y0
                p[0] = data[i++];
                p[1] = data[i++];
                v2ApplyTransform(p, p, m);
                data[j++] = p[0];
                data[j++] = p[1];
                // x1, y1
                p[0] += data[i++];
                p[1] += data[i++];
                v2ApplyTransform(p, p, m);
                data[j++] = p[0];
                data[j++] = p[1];
            }
            for (k = 0; k < nPoint; k++) {
                var p = points[k];
                p[0] = data[i++];
                p[1] = data[i++];
                v2ApplyTransform(p, p, m);
                // Write back
                data[j++] = p[0];
                data[j++] = p[1];
            }
        }
    }
    return transformPath;
});
define('zrender/graphic/Displayable', ['require', '../core/util', './Style', '../Element', './mixin/RectText'], function (require) {
    var zrUtil = require('../core/util');
    var Style = require('./Style');
    var Element = require('../Element');
    var RectText = require('./mixin/RectText');
    // var Stateful = require('./mixin/Stateful');
    /**
     * @alias module:zrender/graphic/Displayable
     * @extends module:zrender/Element
     * @extends module:zrender/graphic/mixin/RectText
     */
    function Displayable(opts) {
        opts = opts || {};
        Element.call(this, opts);
        // Extend properties
        for (var name in opts) {
            if (opts.hasOwnProperty(name) && name !== 'style') {
                this[name] = opts[name];
            }
        }
        /**
         * @type {module:zrender/graphic/Style}
         */
        this.style = new Style(opts.style);
        this._rect = null;
        // Shapes for cascade clipping.
        this.__clipPaths = [];    // FIXME Stateful must be mixined after style is setted
                                  // Stateful.call(this, opts);
    }
    Displayable.prototype = {
        constructor: Displayable,
        type: 'displayable',
        __dirty: true,
        invisible: false,
        z: 0,
        z2: 0,
        zlevel: 0,
        draggable: false,
        dragging: false,
        silent: false,
        culling: false,
        cursor: 'pointer',
        rectHover: false,
        progressive: -1,
        beforeBrush: function (ctx) {
        },
        afterBrush: function (ctx) {
        },
        brush: function (ctx, prevEl) {
        },
        getBoundingRect: function () {
        },
        contain: function (x, y) {
            return this.rectContain(x, y);
        },
        traverse: function (cb, context) {
            cb.call(context, this);
        },
        rectContain: function (x, y) {
            var coord = this.transformCoordToLocal(x, y);
            var rect = this.getBoundingRect();
            return rect.contain(coord[0], coord[1]);
        },
        dirty: function () {
            this.__dirty = true;
            this._rect = null;
            this.__zr && this.__zr.refresh();
        },
        animateStyle: function (loop) {
            return this.animate('style', loop);
        },
        attrKV: function (key, value) {
            if (key !== 'style') {
                Element.prototype.attrKV.call(this, key, value);
            } else {
                this.style.set(value);
            }
        },
        setStyle: function (key, value) {
            this.style.set(key, value);
            this.dirty(false);
            return this;
        },
        useStyle: function (obj) {
            this.style = new Style(obj);
            this.dirty(false);
            return this;
        }
    };
    zrUtil.inherits(Displayable, Element);
    zrUtil.mixin(Displayable, RectText);
    // zrUtil.mixin(Displayable, Stateful);
    return Displayable;
});
define('zrender/contain/path', ['require', '../core/PathProxy', './line', './cubic', './quadratic', './arc', './util', '../core/curve', './windingLine'], function (require) {
    'use strict';
    var CMD = require('../core/PathProxy').CMD;
    var line = require('./line');
    var cubic = require('./cubic');
    var quadratic = require('./quadratic');
    var arc = require('./arc');
    var normalizeRadian = require('./util').normalizeRadian;
    var curve = require('../core/curve');
    var windingLine = require('./windingLine');
    var containStroke = line.containStroke;
    var PI2 = Math.PI * 2;
    var EPSILON = 0.0001;
    function isAroundEqual(a, b) {
        return Math.abs(a - b) < EPSILON;
    }
    // 临时数组
    var roots = [
            -1,
            -1,
            -1
        ];
    var extrema = [
            -1,
            -1
        ];
    function swapExtrema() {
        var tmp = extrema[0];
        extrema[0] = extrema[1];
        extrema[1] = tmp;
    }
    function windingCubic(x0, y0, x1, y1, x2, y2, x3, y3, x, y) {
        // Quick reject
        if (y > y0 && y > y1 && y > y2 && y > y3 || y < y0 && y < y1 && y < y2 && y < y3) {
            return 0;
        }
        var nRoots = curve.cubicRootAt(y0, y1, y2, y3, y, roots);
        if (nRoots === 0) {
            return 0;
        } else {
            var w = 0;
            var nExtrema = -1;
            var y0_, y1_;
            for (var i = 0; i < nRoots; i++) {
                var t = roots[i];
                // Avoid winding error when intersection point is the connect point of two line of polygon
                var unit = t === 0 || t === 1 ? 0.5 : 1;
                var x_ = curve.cubicAt(x0, x1, x2, x3, t);
                if (x_ < x) {
                    // Quick reject
                    continue;
                }
                if (nExtrema < 0) {
                    nExtrema = curve.cubicExtrema(y0, y1, y2, y3, extrema);
                    if (extrema[1] < extrema[0] && nExtrema > 1) {
                        swapExtrema();
                    }
                    y0_ = curve.cubicAt(y0, y1, y2, y3, extrema[0]);
                    if (nExtrema > 1) {
                        y1_ = curve.cubicAt(y0, y1, y2, y3, extrema[1]);
                    }
                }
                if (nExtrema == 2) {
                    // 分成三段单调函数
                    if (t < extrema[0]) {
                        w += y0_ < y0 ? unit : -unit;
                    } else if (t < extrema[1]) {
                        w += y1_ < y0_ ? unit : -unit;
                    } else {
                        w += y3 < y1_ ? unit : -unit;
                    }
                } else {
                    // 分成两段单调函数
                    if (t < extrema[0]) {
                        w += y0_ < y0 ? unit : -unit;
                    } else {
                        w += y3 < y0_ ? unit : -unit;
                    }
                }
            }
            return w;
        }
    }
    function windingQuadratic(x0, y0, x1, y1, x2, y2, x, y) {
        // Quick reject
        if (y > y0 && y > y1 && y > y2 || y < y0 && y < y1 && y < y2) {
            return 0;
        }
        var nRoots = curve.quadraticRootAt(y0, y1, y2, y, roots);
        if (nRoots === 0) {
            return 0;
        } else {
            var t = curve.quadraticExtremum(y0, y1, y2);
            if (t >= 0 && t <= 1) {
                var w = 0;
                var y_ = curve.quadraticAt(y0, y1, y2, t);
                for (var i = 0; i < nRoots; i++) {
                    // Remove one endpoint.
                    var unit = roots[i] === 0 || roots[i] === 1 ? 0.5 : 1;
                    var x_ = curve.quadraticAt(x0, x1, x2, roots[i]);
                    if (x_ < x) {
                        // Quick reject
                        continue;
                    }
                    if (roots[i] < t) {
                        w += y_ < y0 ? unit : -unit;
                    } else {
                        w += y2 < y_ ? unit : -unit;
                    }
                }
                return w;
            } else {
                // Remove one endpoint.
                var unit = roots[0] === 0 || roots[0] === 1 ? 0.5 : 1;
                var x_ = curve.quadraticAt(x0, x1, x2, roots[0]);
                if (x_ < x) {
                    // Quick reject
                    return 0;
                }
                return y2 < y0 ? unit : -unit;
            }
        }
    }
    // TODO
    // Arc 旋转
    function windingArc(cx, cy, r, startAngle, endAngle, anticlockwise, x, y) {
        y -= cy;
        if (y > r || y < -r) {
            return 0;
        }
        var tmp = Math.sqrt(r * r - y * y);
        roots[0] = -tmp;
        roots[1] = tmp;
        var diff = Math.abs(startAngle - endAngle);
        if (diff < 0.0001) {
            return 0;
        }
        if (diff % PI2 < 0.0001) {
            // Is a circle
            startAngle = 0;
            endAngle = PI2;
            var dir = anticlockwise ? 1 : -1;
            if (x >= roots[0] + cx && x <= roots[1] + cx) {
                return dir;
            } else {
                return 0;
            }
        }
        if (anticlockwise) {
            var tmp = startAngle;
            startAngle = normalizeRadian(endAngle);
            endAngle = normalizeRadian(tmp);
        } else {
            startAngle = normalizeRadian(startAngle);
            endAngle = normalizeRadian(endAngle);
        }
        if (startAngle > endAngle) {
            endAngle += PI2;
        }
        var w = 0;
        for (var i = 0; i < 2; i++) {
            var x_ = roots[i];
            if (x_ + cx > x) {
                var angle = Math.atan2(y, x_);
                var dir = anticlockwise ? 1 : -1;
                if (angle < 0) {
                    angle = PI2 + angle;
                }
                if (angle >= startAngle && angle <= endAngle || angle + PI2 >= startAngle && angle + PI2 <= endAngle) {
                    if (angle > Math.PI / 2 && angle < Math.PI * 1.5) {
                        dir = -dir;
                    }
                    w += dir;
                }
            }
        }
        return w;
    }
    function containPath(data, lineWidth, isStroke, x, y) {
        var w = 0;
        var xi = 0;
        var yi = 0;
        var x0 = 0;
        var y0 = 0;
        for (var i = 0; i < data.length;) {
            var cmd = data[i++];
            // Begin a new subpath
            if (cmd === CMD.M && i > 1) {
                // Close previous subpath
                if (!isStroke) {
                    w += windingLine(xi, yi, x0, y0, x, y);
                }    // 如果被任何一个 subpath 包含
                     // if (w !== 0) {
                     //     return true;
                     // }
            }
            if (i == 1) {
                // 如果第一个命令是 L, C, Q
                // 则 previous point 同绘制命令的第一个 point
                //
                // 第一个命令为 Arc 的情况下会在后面特殊处理
                xi = data[i];
                yi = data[i + 1];
                x0 = xi;
                y0 = yi;
            }
            switch (cmd) {
            case CMD.M:
                // moveTo 命令重新创建一个新的 subpath, 并且更新新的起点
                // 在 closePath 的时候使用
                x0 = data[i++];
                y0 = data[i++];
                xi = x0;
                yi = y0;
                break;
            case CMD.L:
                if (isStroke) {
                    if (containStroke(xi, yi, data[i], data[i + 1], lineWidth, x, y)) {
                        return true;
                    }
                } else {
                    // NOTE 在第一个命令为 L, C, Q 的时候会计算出 NaN
                    w += windingLine(xi, yi, data[i], data[i + 1], x, y) || 0;
                }
                xi = data[i++];
                yi = data[i++];
                break;
            case CMD.C:
                if (isStroke) {
                    if (cubic.containStroke(xi, yi, data[i++], data[i++], data[i++], data[i++], data[i], data[i + 1], lineWidth, x, y)) {
                        return true;
                    }
                } else {
                    w += windingCubic(xi, yi, data[i++], data[i++], data[i++], data[i++], data[i], data[i + 1], x, y) || 0;
                }
                xi = data[i++];
                yi = data[i++];
                break;
            case CMD.Q:
                if (isStroke) {
                    if (quadratic.containStroke(xi, yi, data[i++], data[i++], data[i], data[i + 1], lineWidth, x, y)) {
                        return true;
                    }
                } else {
                    w += windingQuadratic(xi, yi, data[i++], data[i++], data[i], data[i + 1], x, y) || 0;
                }
                xi = data[i++];
                yi = data[i++];
                break;
            case CMD.A:
                // TODO Arc 判断的开销比较大
                var cx = data[i++];
                var cy = data[i++];
                var rx = data[i++];
                var ry = data[i++];
                var theta = data[i++];
                var dTheta = data[i++];
                // TODO Arc 旋转
                var psi = data[i++];
                var anticlockwise = 1 - data[i++];
                var x1 = Math.cos(theta) * rx + cx;
                var y1 = Math.sin(theta) * ry + cy;
                // 不是直接使用 arc 命令
                if (i > 1) {
                    w += windingLine(xi, yi, x1, y1, x, y);
                } else {
                    // 第一个命令起点还未定义
                    x0 = x1;
                    y0 = y1;
                }
                // zr 使用scale来模拟椭圆, 这里也对x做一定的缩放
                var _x = (x - cx) * ry / rx + cx;
                if (isStroke) {
                    if (arc.containStroke(cx, cy, ry, theta, theta + dTheta, anticlockwise, lineWidth, _x, y)) {
                        return true;
                    }
                } else {
                    w += windingArc(cx, cy, ry, theta, theta + dTheta, anticlockwise, _x, y);
                }
                xi = Math.cos(theta + dTheta) * rx + cx;
                yi = Math.sin(theta + dTheta) * ry + cy;
                break;
            case CMD.R:
                x0 = xi = data[i++];
                y0 = yi = data[i++];
                var width = data[i++];
                var height = data[i++];
                var x1 = x0 + width;
                var y1 = y0 + height;
                if (isStroke) {
                    if (containStroke(x0, y0, x1, y0, lineWidth, x, y) || containStroke(x1, y0, x1, y1, lineWidth, x, y) || containStroke(x1, y1, x0, y1, lineWidth, x, y) || containStroke(x0, y1, x0, y0, lineWidth, x, y)) {
                        return true;
                    }
                } else {
                    // FIXME Clockwise ?
                    w += windingLine(x1, y0, x1, y1, x, y);
                    w += windingLine(x0, y1, x0, y0, x, y);
                }
                break;
            case CMD.Z:
                if (isStroke) {
                    if (containStroke(xi, yi, x0, y0, lineWidth, x, y)) {
                        return true;
                    }
                } else {
                    // Close a subpath
                    w += windingLine(xi, yi, x0, y0, x, y);    // 如果被任何一个 subpath 包含
                                                               // FIXME subpaths may overlap
                                                               // if (w !== 0) {
                                                               //     return true;
                                                               // }
                }
                xi = x0;
                yi = y0;
                break;
            }
        }
        if (!isStroke && !isAroundEqual(yi, y0)) {
            w += windingLine(xi, yi, x0, y0, x, y) || 0;
        }
        return w !== 0;
    }
    return {
        contain: function (pathData, x, y) {
            return containPath(pathData, 0, false, x, y);
        },
        containStroke: function (pathData, lineWidth, x, y) {
            return containPath(pathData, lineWidth, true, x, y);
        }
    };
});
define('zrender/graphic/Pattern', ['require'], function (require) {
    var Pattern = function (image, repeat) {
        this.image = image;
        this.repeat = repeat;
        // Can be cloned
        this.type = 'pattern';
    };
    Pattern.prototype.getCanvasPattern = function (ctx) {
        return this._canvasPattern || (this._canvasPattern = ctx.createPattern(this.image, this.repeat));
    };
    return Pattern;
});
define('echarts/scale/Ordinal', ['require', 'zrender/core/util', './Scale'], function (require) {
    var zrUtil = require('zrender/core/util');
    var Scale = require('./Scale');
    var scaleProto = Scale.prototype;
    var OrdinalScale = Scale.extend({
            type: 'ordinal',
            init: function (data, extent) {
                this._data = data;
                this._extent = extent || [
                    0,
                    data.length - 1
                ];
            },
            parse: function (val) {
                return typeof val === 'string' ? zrUtil.indexOf(this._data, val) : Math.round(val);
            },
            contain: function (rank) {
                rank = this.parse(rank);
                return scaleProto.contain.call(this, rank) && this._data[rank] != null;
            },
            normalize: function (val) {
                return scaleProto.normalize.call(this, this.parse(val));
            },
            scale: function (val) {
                return Math.round(scaleProto.scale.call(this, val));
            },
            getTicks: function () {
                var ticks = [];
                var extent = this._extent;
                var rank = extent[0];
                while (rank <= extent[1]) {
                    ticks.push(rank);
                    rank++;
                }
                return ticks;
            },
            getLabel: function (n) {
                return this._data[n];
            },
            count: function () {
                return this._extent[1] - this._extent[0] + 1;
            },
            niceTicks: zrUtil.noop,
            niceExtent: zrUtil.noop
        });
    /**
     * @return {module:echarts/scale/Time}
     */
    OrdinalScale.create = function () {
        return new OrdinalScale();
    };
    return OrdinalScale;
});
define('echarts/model/mixin/makeStyleMapper', ['require', 'zrender/core/util'], function (require) {
    var zrUtil = require('zrender/core/util');
    return function (properties) {
        // Normalize
        for (var i = 0; i < properties.length; i++) {
            if (!properties[i][1]) {
                properties[i][1] = properties[i][0];
            }
        }
        return function (excludes) {
            var style = {};
            for (var i = 0; i < properties.length; i++) {
                var propName = properties[i][1];
                if (excludes && zrUtil.indexOf(excludes, propName) >= 0) {
                    continue;
                }
                var val = this.getShallow(propName);
                if (val != null) {
                    style[properties[i][0]] = val;
                }
            }
            return style;
        };
    };
});
define('zrender/graphic/Style', ['require'], function (require) {
    var STYLE_COMMON_PROPS = [
            [
                'shadowBlur',
                0
            ],
            [
                'shadowOffsetX',
                0
            ],
            [
                'shadowOffsetY',
                0
            ],
            [
                'shadowColor',
                '#000'
            ],
            [
                'lineCap',
                'butt'
            ],
            [
                'lineJoin',
                'miter'
            ],
            [
                'miterLimit',
                10
            ]
        ];
    // var SHADOW_PROPS = STYLE_COMMON_PROPS.slice(0, 4);
    // var LINE_PROPS = STYLE_COMMON_PROPS.slice(4);
    var Style = function (opts) {
        this.extendFrom(opts);
    };
    function createLinearGradient(ctx, obj, rect) {
        // var size =
        var x = obj.x;
        var x2 = obj.x2;
        var y = obj.y;
        var y2 = obj.y2;
        if (!obj.global) {
            x = x * rect.width + rect.x;
            x2 = x2 * rect.width + rect.x;
            y = y * rect.height + rect.y;
            y2 = y2 * rect.height + rect.y;
        }
        var canvasGradient = ctx.createLinearGradient(x, y, x2, y2);
        return canvasGradient;
    }
    function createRadialGradient(ctx, obj, rect) {
        var width = rect.width;
        var height = rect.height;
        var min = Math.min(width, height);
        var x = obj.x;
        var y = obj.y;
        var r = obj.r;
        if (!obj.global) {
            x = x * width + rect.x;
            y = y * height + rect.y;
            r = r * min;
        }
        var canvasGradient = ctx.createRadialGradient(x, y, 0, x, y, r);
        return canvasGradient;
    }
    Style.prototype = {
        constructor: Style,
        fill: '#000000',
        stroke: null,
        opacity: 1,
        lineDash: null,
        lineDashOffset: 0,
        shadowBlur: 0,
        shadowOffsetX: 0,
        shadowOffsetY: 0,
        lineWidth: 1,
        strokeNoScale: false,
        text: null,
        textFill: '#000',
        textStroke: null,
        textPosition: 'inside',
        textBaseline: null,
        textAlign: null,
        textVerticalAlign: null,
        textDistance: 5,
        textShadowBlur: 0,
        textShadowOffsetX: 0,
        textShadowOffsetY: 0,
        textTransform: false,
        textRotation: 0,
        blend: null,
        bind: function (ctx, el, prevEl) {
            var style = this;
            var prevStyle = prevEl && prevEl.style;
            var firstDraw = !prevStyle;
            for (var i = 0; i < STYLE_COMMON_PROPS.length; i++) {
                var prop = STYLE_COMMON_PROPS[i];
                var styleName = prop[0];
                if (firstDraw || style[styleName] !== prevStyle[styleName]) {
                    // FIXME Invalid property value will cause style leak from previous element.
                    ctx[styleName] = style[styleName] || prop[1];
                }
            }
            if (firstDraw || style.fill !== prevStyle.fill) {
                ctx.fillStyle = style.fill;
            }
            if (firstDraw || style.stroke !== prevStyle.stroke) {
                ctx.strokeStyle = style.stroke;
            }
            if (firstDraw || style.opacity !== prevStyle.opacity) {
                ctx.globalAlpha = style.opacity == null ? 1 : style.opacity;
            }
            if (firstDraw || style.blend !== prevStyle.blend) {
                ctx.globalCompositeOperation = style.blend || 'source-over';
            }
            if (this.hasStroke()) {
                var lineWidth = style.lineWidth;
                ctx.lineWidth = lineWidth / (this.strokeNoScale && el && el.getLineScale ? el.getLineScale() : 1);
            }
        },
        hasFill: function () {
            var fill = this.fill;
            return fill != null && fill !== 'none';
        },
        hasStroke: function () {
            var stroke = this.stroke;
            return stroke != null && stroke !== 'none' && this.lineWidth > 0;
        },
        extendFrom: function (otherStyle, overwrite) {
            if (otherStyle) {
                var target = this;
                for (var name in otherStyle) {
                    if (otherStyle.hasOwnProperty(name) && (overwrite || !target.hasOwnProperty(name))) {
                        target[name] = otherStyle[name];
                    }
                }
            }
        },
        set: function (obj, value) {
            if (typeof obj === 'string') {
                this[obj] = value;
            } else {
                this.extendFrom(obj, true);
            }
        },
        clone: function () {
            var newStyle = new this.constructor();
            newStyle.extendFrom(this, true);
            return newStyle;
        },
        getGradient: function (ctx, obj, rect) {
            var method = obj.type === 'radial' ? createRadialGradient : createLinearGradient;
            var canvasGradient = method(ctx, obj, rect);
            var colorStops = obj.colorStops;
            for (var i = 0; i < colorStops.length; i++) {
                canvasGradient.addColorStop(colorStops[i].offset, colorStops[i].color);
            }
            return canvasGradient;
        }
    };
    var styleProto = Style.prototype;
    for (var i = 0; i < STYLE_COMMON_PROPS.length; i++) {
        var prop = STYLE_COMMON_PROPS[i];
        if (!(prop[0] in styleProto)) {
            styleProto[prop[0]] = prop[1];
        }
    }
    // Provide for others
    Style.getGradient = styleProto.getGradient;
    return Style;
});
define('zrender/Element', ['require', './core/guid', './mixin/Eventful', './mixin/Transformable', './mixin/Animatable', './core/util'], function (require) {
    'use strict';
    var guid = require('./core/guid');
    var Eventful = require('./mixin/Eventful');
    var Transformable = require('./mixin/Transformable');
    var Animatable = require('./mixin/Animatable');
    var zrUtil = require('./core/util');
    /**
     * @alias module:zrender/Element
     * @constructor
     * @extends {module:zrender/mixin/Animatable}
     * @extends {module:zrender/mixin/Transformable}
     * @extends {module:zrender/mixin/Eventful}
     */
    var Element = function (opts) {
        Transformable.call(this, opts);
        Eventful.call(this, opts);
        Animatable.call(this, opts);
        /**
         * 画布元素ID
         * @type {string}
         */
        this.id = opts.id || guid();
    };
    Element.prototype = {
        type: 'element',
        name: '',
        __zr: null,
        ignore: false,
        clipPath: null,
        drift: function (dx, dy) {
            switch (this.draggable) {
            case 'horizontal':
                dy = 0;
                break;
            case 'vertical':
                dx = 0;
                break;
            }
            var m = this.transform;
            if (!m) {
                m = this.transform = [
                    1,
                    0,
                    0,
                    1,
                    0,
                    0
                ];
            }
            m[4] += dx;
            m[5] += dy;
            this.decomposeTransform();
            this.dirty(false);
        },
        beforeUpdate: function () {
        },
        afterUpdate: function () {
        },
        update: function () {
            this.updateTransform();
        },
        traverse: function (cb, context) {
        },
        attrKV: function (key, value) {
            if (key === 'position' || key === 'scale' || key === 'origin') {
                // Copy the array
                if (value) {
                    var target = this[key];
                    if (!target) {
                        target = this[key] = [];
                    }
                    target[0] = value[0];
                    target[1] = value[1];
                }
            } else {
                this[key] = value;
            }
        },
        hide: function () {
            this.ignore = true;
            this.__zr && this.__zr.refresh();
        },
        show: function () {
            this.ignore = false;
            this.__zr && this.__zr.refresh();
        },
        attr: function (key, value) {
            if (typeof key === 'string') {
                this.attrKV(key, value);
            } else if (zrUtil.isObject(key)) {
                for (var name in key) {
                    if (key.hasOwnProperty(name)) {
                        this.attrKV(name, key[name]);
                    }
                }
            }
            this.dirty(false);
            return this;
        },
        setClipPath: function (clipPath) {
            var zr = this.__zr;
            if (zr) {
                clipPath.addSelfToZr(zr);
            }
            // Remove previous clip path
            if (this.clipPath && this.clipPath !== clipPath) {
                this.removeClipPath();
            }
            this.clipPath = clipPath;
            clipPath.__zr = zr;
            clipPath.__clipTarget = this;
            this.dirty(false);
        },
        removeClipPath: function () {
            var clipPath = this.clipPath;
            if (clipPath) {
                if (clipPath.__zr) {
                    clipPath.removeSelfFromZr(clipPath.__zr);
                }
                clipPath.__zr = null;
                clipPath.__clipTarget = null;
                this.clipPath = null;
                this.dirty(false);
            }
        },
        addSelfToZr: function (zr) {
            this.__zr = zr;
            // 添加动画
            var animators = this.animators;
            if (animators) {
                for (var i = 0; i < animators.length; i++) {
                    zr.animation.addAnimator(animators[i]);
                }
            }
            if (this.clipPath) {
                this.clipPath.addSelfToZr(zr);
            }
        },
        removeSelfFromZr: function (zr) {
            this.__zr = null;
            // 移除动画
            var animators = this.animators;
            if (animators) {
                for (var i = 0; i < animators.length; i++) {
                    zr.animation.removeAnimator(animators[i]);
                }
            }
            if (this.clipPath) {
                this.clipPath.removeSelfFromZr(zr);
            }
        }
    };
    zrUtil.mixin(Element, Animatable);
    zrUtil.mixin(Element, Transformable);
    zrUtil.mixin(Element, Eventful);
    return Element;
});
define('zrender/graphic/mixin/RectText', ['require', '../../contain/text', '../../core/BoundingRect'], function (require) {
    var textContain = require('../../contain/text');
    var BoundingRect = require('../../core/BoundingRect');
    var tmpRect = new BoundingRect();
    var RectText = function () {
    };
    function parsePercent(value, maxValue) {
        if (typeof value === 'string') {
            if (value.lastIndexOf('%') >= 0) {
                return parseFloat(value) / 100 * maxValue;
            }
            return parseFloat(value);
        }
        return value;
    }
    RectText.prototype = {
        constructor: RectText,
        drawRectText: function (ctx, rect, textRect) {
            var style = this.style;
            var text = style.text;
            // Convert to string
            text != null && (text += '');
            if (!text) {
                return;
            }
            // FIXME
            ctx.save();
            var x;
            var y;
            var textPosition = style.textPosition;
            var distance = style.textDistance;
            var align = style.textAlign;
            var font = style.textFont || style.font;
            var baseline = style.textBaseline;
            var verticalAlign = style.textVerticalAlign;
            textRect = textRect || textContain.getBoundingRect(text, font, align, baseline);
            // Transform rect to view space
            var transform = this.transform;
            if (!style.textTransform) {
                if (transform) {
                    tmpRect.copy(rect);
                    tmpRect.applyTransform(transform);
                    rect = tmpRect;
                }
            } else {
                this.setTransform(ctx);
            }
            // Text position represented by coord
            if (textPosition instanceof Array) {
                // Percent
                x = rect.x + parsePercent(textPosition[0], rect.width);
                y = rect.y + parsePercent(textPosition[1], rect.height);
                align = align || 'left';
                baseline = baseline || 'top';
                if (verticalAlign) {
                    switch (verticalAlign) {
                    case 'middle':
                        y -= textRect.height / 2 - textRect.lineHeight / 2;
                        break;
                    case 'bottom':
                        y -= textRect.height - textRect.lineHeight / 2;
                        break;
                    default:
                        y += textRect.lineHeight / 2;
                    }
                    // Force bseline to be middle
                    baseline = 'middle';
                }
            } else {
                var res = textContain.adjustTextPositionOnRect(textPosition, rect, textRect, distance);
                x = res.x;
                y = res.y;
                // Default align and baseline when has textPosition
                align = align || res.textAlign;
                baseline = baseline || res.textBaseline;
            }
            // Use canvas default left textAlign. Giving invalid value will cause state not change
            ctx.textAlign = align || 'left';
            // Use canvas default alphabetic baseline
            ctx.textBaseline = baseline || 'alphabetic';
            var textFill = style.textFill;
            var textStroke = style.textStroke;
            textFill && (ctx.fillStyle = textFill);
            textStroke && (ctx.strokeStyle = textStroke);
            // TODO Invalid font
            ctx.font = font || '12px sans-serif';
            // Text shadow
            // Always set shadowBlur and shadowOffset to avoid leak from displayable
            ctx.shadowBlur = style.textShadowBlur;
            ctx.shadowColor = style.textShadowColor || 'transparent';
            ctx.shadowOffsetX = style.textShadowOffsetX;
            ctx.shadowOffsetY = style.textShadowOffsetY;
            var textLines = text.split('\n');
            if (style.textRotation) {
                transform && ctx.translate(transform[4], transform[5]);
                ctx.rotate(style.textRotation);
                transform && ctx.translate(-transform[4], -transform[5]);
            }
            for (var i = 0; i < textLines.length; i++) {
                textFill && ctx.fillText(textLines[i], x, y);
                textStroke && ctx.strokeText(textLines[i], x, y);
                y += textRect.lineHeight;
            }
            ctx.restore();
        }
    };
    return RectText;
});
define('echarts/coord/cartesian/Cartesian', ['require', 'zrender/core/util'], function (require) {
    'use strict';
    var zrUtil = require('zrender/core/util');
    function dimAxisMapper(dim) {
        return this._axes[dim];
    }
    /**
     * @alias module:echarts/coord/Cartesian
     * @constructor
     */
    var Cartesian = function (name) {
        this._axes = {};
        this._dimList = [];
        /**
         * @type {string}
         */
        this.name = name || '';
    };
    Cartesian.prototype = {
        constructor: Cartesian,
        type: 'cartesian',
        getAxis: function (dim) {
            return this._axes[dim];
        },
        getAxes: function () {
            return zrUtil.map(this._dimList, dimAxisMapper, this);
        },
        getAxesByScale: function (scaleType) {
            scaleType = scaleType.toLowerCase();
            return zrUtil.filter(this.getAxes(), function (axis) {
                return axis.scale.type === scaleType;
            });
        },
        addAxis: function (axis) {
            var dim = axis.dim;
            this._axes[dim] = axis;
            this._dimList.push(dim);
        },
        dataToCoord: function (val) {
            return this._dataCoordConvert(val, 'dataToCoord');
        },
        coordToData: function (val) {
            return this._dataCoordConvert(val, 'coordToData');
        },
        _dataCoordConvert: function (input, method) {
            var dimList = this._dimList;
            var output = input instanceof Array ? [] : {};
            for (var i = 0; i < dimList.length; i++) {
                var dim = dimList[i];
                var axis = this._axes[dim];
                output[dim] = axis[method](input[dim]);
            }
            return output;
        }
    };
    return Cartesian;
});
define('echarts/util/component', ['require', 'zrender/core/util', './clazz'], function (require) {
    var zrUtil = require('zrender/core/util');
    var clazz = require('./clazz');
    var parseClassType = clazz.parseClassType;
    var base = 0;
    var componentUtil = {};
    var DELIMITER = '_';
    /**
     * @public
     * @param {string} type
     * @return {string}
     */
    componentUtil.getUID = function (type) {
        // Considering the case of crossing js context,
        // use Math.random to make id as unique as possible.
        return [
            type || '',
            base++,
            Math.random()
        ].join(DELIMITER);
    };
    /**
     * @inner
     */
    componentUtil.enableSubTypeDefaulter = function (entity) {
        var subTypeDefaulters = {};
        entity.registerSubTypeDefaulter = function (componentType, defaulter) {
            componentType = parseClassType(componentType);
            subTypeDefaulters[componentType.main] = defaulter;
        };
        entity.determineSubType = function (componentType, option) {
            var type = option.type;
            if (!type) {
                var componentTypeMain = parseClassType(componentType).main;
                if (entity.hasSubTypes(componentType) && subTypeDefaulters[componentTypeMain]) {
                    type = subTypeDefaulters[componentTypeMain](option);
                }
            }
            return type;
        };
        return entity;
    };
    /**
     * Topological travel on Activity Network (Activity On Vertices).
     * Dependencies is defined in Model.prototype.dependencies, like ['xAxis', 'yAxis'].
     *
     * If 'xAxis' or 'yAxis' is absent in componentTypeList, just ignore it in topology.
     *
     * If there is circle dependencey, Error will be thrown.
     *
     */
    componentUtil.enableTopologicalTravel = function (entity, dependencyGetter) {
        /**
         * @public
         * @param {Array.<string>} targetNameList Target Component type list.
         *                                           Can be ['aa', 'bb', 'aa.xx']
         * @param {Array.<string>} fullNameList By which we can build dependency graph.
         * @param {Function} callback Params: componentType, dependencies.
         * @param {Object} context Scope of callback.
         */
        entity.topologicalTravel = function (targetNameList, fullNameList, callback, context) {
            if (!targetNameList.length) {
                return;
            }
            var result = makeDepndencyGraph(fullNameList);
            var graph = result.graph;
            var stack = result.noEntryList;
            var targetNameSet = {};
            zrUtil.each(targetNameList, function (name) {
                targetNameSet[name] = true;
            });
            while (stack.length) {
                var currComponentType = stack.pop();
                var currVertex = graph[currComponentType];
                var isInTargetNameSet = !!targetNameSet[currComponentType];
                if (isInTargetNameSet) {
                    callback.call(context, currComponentType, currVertex.originalDeps.slice());
                    delete targetNameSet[currComponentType];
                }
                zrUtil.each(currVertex.successor, isInTargetNameSet ? removeEdgeAndAdd : removeEdge);
            }
            zrUtil.each(targetNameSet, function () {
                throw new Error('Circle dependency may exists');
            });
            function removeEdge(succComponentType) {
                graph[succComponentType].entryCount--;
                if (graph[succComponentType].entryCount === 0) {
                    stack.push(succComponentType);
                }
            }
            // Consider this case: legend depends on series, and we call
            // chart.setOption({series: [...]}), where only series is in option.
            // If we do not have 'removeEdgeAndAdd', legendModel.mergeOption will
            // not be called, but only sereis.mergeOption is called. Thus legend
            // have no chance to update its local record about series (like which
            // name of series is available in legend).
            function removeEdgeAndAdd(succComponentType) {
                targetNameSet[succComponentType] = true;
                removeEdge(succComponentType);
            }
        };
        /**
         * DepndencyGraph: {Object}
         * key: conponentType,
         * value: {
         *     successor: [conponentTypes...],
         *     originalDeps: [conponentTypes...],
         *     entryCount: {number}
         * }
         */
        function makeDepndencyGraph(fullNameList) {
            var graph = {};
            var noEntryList = [];
            zrUtil.each(fullNameList, function (name) {
                var thisItem = createDependencyGraphItem(graph, name);
                var originalDeps = thisItem.originalDeps = dependencyGetter(name);
                var availableDeps = getAvailableDependencies(originalDeps, fullNameList);
                thisItem.entryCount = availableDeps.length;
                if (thisItem.entryCount === 0) {
                    noEntryList.push(name);
                }
                zrUtil.each(availableDeps, function (dependentName) {
                    if (zrUtil.indexOf(thisItem.predecessor, dependentName) < 0) {
                        thisItem.predecessor.push(dependentName);
                    }
                    var thatItem = createDependencyGraphItem(graph, dependentName);
                    if (zrUtil.indexOf(thatItem.successor, dependentName) < 0) {
                        thatItem.successor.push(name);
                    }
                });
            });
            return {
                graph: graph,
                noEntryList: noEntryList
            };
        }
        function createDependencyGraphItem(graph, name) {
            if (!graph[name]) {
                graph[name] = {
                    predecessor: [],
                    successor: []
                };
            }
            return graph[name];
        }
        function getAvailableDependencies(originalDeps, fullNameList) {
            var availableDeps = [];
            zrUtil.each(originalDeps, function (dep) {
                zrUtil.indexOf(fullNameList, dep) >= 0 && availableDeps.push(dep);
            });
            return availableDeps;
        }
    };
    return componentUtil;
});
define('echarts/model/mixin/boxLayout', ['require'], function (require) {
    return {
        getBoxLayoutParams: function () {
            return {
                left: this.get('left'),
                top: this.get('top'),
                right: this.get('right'),
                bottom: this.get('bottom'),
                width: this.get('width'),
                height: this.get('height')
            };
        }
    };
});
define('zrender/core/guid', [], function () {
    var idStart = 2311;
    return function () {
        return idStart++;
    };
});
define('zrender/mixin/Transformable', ['require', '../core/matrix', '../core/vector'], function (require) {
    'use strict';
    var matrix = require('../core/matrix');
    var vector = require('../core/vector');
    var mIdentity = matrix.identity;
    var EPSILON = 0.00005;
    function isNotAroundZero(val) {
        return val > EPSILON || val < -EPSILON;
    }
    /**
     * @alias module:zrender/mixin/Transformable
     * @constructor
     */
    var Transformable = function (opts) {
        opts = opts || {};
        // If there are no given position, rotation, scale
        if (!opts.position) {
            /**
             * 平移
             * @type {Array.<number>}
             * @default [0, 0]
             */
            this.position = [
                0,
                0
            ];
        }
        if (opts.rotation == null) {
            /**
             * 旋转
             * @type {Array.<number>}
             * @default 0
             */
            this.rotation = 0;
        }
        if (!opts.scale) {
            /**
             * 缩放
             * @type {Array.<number>}
             * @default [1, 1]
             */
            this.scale = [
                1,
                1
            ];
        }
        /**
         * 旋转和缩放的原点
         * @type {Array.<number>}
         * @default null
         */
        this.origin = this.origin || null;
    };
    var transformableProto = Transformable.prototype;
    transformableProto.transform = null;
    /**
     * 判断是否需要有坐标变换
     * 如果有坐标变换, 则从position, rotation, scale以及父节点的transform计算出自身的transform矩阵
     */
    transformableProto.needLocalTransform = function () {
        return isNotAroundZero(this.rotation) || isNotAroundZero(this.position[0]) || isNotAroundZero(this.position[1]) || isNotAroundZero(this.scale[0] - 1) || isNotAroundZero(this.scale[1] - 1);
    };
    transformableProto.updateTransform = function () {
        var parent = this.parent;
        var parentHasTransform = parent && parent.transform;
        var needLocalTransform = this.needLocalTransform();
        var m = this.transform;
        if (!(needLocalTransform || parentHasTransform)) {
            m && mIdentity(m);
            return;
        }
        m = m || matrix.create();
        if (needLocalTransform) {
            this.getLocalTransform(m);
        } else {
            mIdentity(m);
        }
        // 应用父节点变换
        if (parentHasTransform) {
            if (needLocalTransform) {
                matrix.mul(m, parent.transform, m);
            } else {
                matrix.copy(m, parent.transform);
            }
        }
        // 保存这个变换矩阵
        this.transform = m;
        this.invTransform = this.invTransform || matrix.create();
        matrix.invert(this.invTransform, m);
    };
    transformableProto.getLocalTransform = function (m) {
        m = m || [];
        mIdentity(m);
        var origin = this.origin;
        var scale = this.scale;
        var rotation = this.rotation;
        var position = this.position;
        if (origin) {
            // Translate to origin
            m[4] -= origin[0];
            m[5] -= origin[1];
        }
        matrix.scale(m, m, scale);
        if (rotation) {
            matrix.rotate(m, m, rotation);
        }
        if (origin) {
            // Translate back from origin
            m[4] += origin[0];
            m[5] += origin[1];
        }
        m[4] += position[0];
        m[5] += position[1];
        return m;
    };
    /**
     * 将自己的transform应用到context上
     * @param {Context2D} ctx
     */
    transformableProto.setTransform = function (ctx) {
        var m = this.transform;
        var dpr = ctx.dpr || 1;
        if (m) {
            ctx.setTransform(dpr * m[0], dpr * m[1], dpr * m[2], dpr * m[3], dpr * m[4], dpr * m[5]);
        } else {
            ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        }
    };
    transformableProto.restoreTransform = function (ctx) {
        var m = this.transform;
        var dpr = ctx.dpr || 1;
        ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    };
    var tmpTransform = [];
    /**
     * 分解`transform`矩阵到`position`, `rotation`, `scale`
     */
    transformableProto.decomposeTransform = function () {
        if (!this.transform) {
            return;
        }
        var parent = this.parent;
        var m = this.transform;
        if (parent && parent.transform) {
            // Get local transform and decompose them to position, scale, rotation
            matrix.mul(tmpTransform, parent.invTransform, m);
            m = tmpTransform;
        }
        var sx = m[0] * m[0] + m[1] * m[1];
        var sy = m[2] * m[2] + m[3] * m[3];
        var position = this.position;
        var scale = this.scale;
        if (isNotAroundZero(sx - 1)) {
            sx = Math.sqrt(sx);
        }
        if (isNotAroundZero(sy - 1)) {
            sy = Math.sqrt(sy);
        }
        if (m[0] < 0) {
            sx = -sx;
        }
        if (m[3] < 0) {
            sy = -sy;
        }
        position[0] = m[4];
        position[1] = m[5];
        scale[0] = sx;
        scale[1] = sy;
        this.rotation = Math.atan2(-m[1] / sy, m[0] / sx);
    };
    /**
     * Get global scale
     * @return {Array.<number>}
     */
    transformableProto.getGlobalScale = function () {
        var m = this.transform;
        if (!m) {
            return [
                1,
                1
            ];
        }
        var sx = Math.sqrt(m[0] * m[0] + m[1] * m[1]);
        var sy = Math.sqrt(m[2] * m[2] + m[3] * m[3]);
        if (m[0] < 0) {
            sx = -sx;
        }
        if (m[3] < 0) {
            sy = -sy;
        }
        return [
            sx,
            sy
        ];
    };
    /**
     * 变换坐标位置到 shape 的局部坐标空间
     * @method
     * @param {number} x
     * @param {number} y
     * @return {Array.<number>}
     */
    transformableProto.transformCoordToLocal = function (x, y) {
        var v2 = [
                x,
                y
            ];
        var invTransform = this.invTransform;
        if (invTransform) {
            vector.applyTransform(v2, v2, invTransform);
        }
        return v2;
    };
    /**
     * 变换局部坐标位置到全局坐标空间
     * @method
     * @param {number} x
     * @param {number} y
     * @return {Array.<number>}
     */
    transformableProto.transformCoordToGlobal = function (x, y) {
        var v2 = [
                x,
                y
            ];
        var transform = this.transform;
        if (transform) {
            vector.applyTransform(v2, v2, transform);
        }
        return v2;
    };
    return Transformable;
});
define('zrender/mixin/Animatable', ['require', '../animation/Animator', '../core/util', '../core/log'], function (require) {
    'use strict';
    var Animator = require('../animation/Animator');
    var util = require('../core/util');
    var isString = util.isString;
    var isFunction = util.isFunction;
    var isObject = util.isObject;
    var log = require('../core/log');
    /**
     * @alias modue:zrender/mixin/Animatable
     * @constructor
     */
    var Animatable = function () {
        /**
         * @type {Array.<module:zrender/animation/Animator>}
         * @readOnly
         */
        this.animators = [];
    };
    Animatable.prototype = {
        constructor: Animatable,
        animate: function (path, loop) {
            var target;
            var animatingShape = false;
            var el = this;
            var zr = this.__zr;
            if (path) {
                var pathSplitted = path.split('.');
                var prop = el;
                // If animating shape
                animatingShape = pathSplitted[0] === 'shape';
                for (var i = 0, l = pathSplitted.length; i < l; i++) {
                    if (!prop) {
                        continue;
                    }
                    prop = prop[pathSplitted[i]];
                }
                if (prop) {
                    target = prop;
                }
            } else {
                target = el;
            }
            if (!target) {
                log('Property "' + path + '" is not existed in element ' + el.id);
                return;
            }
            var animators = el.animators;
            var animator = new Animator(target, loop);
            animator.during(function (target) {
                el.dirty(animatingShape);
            }).done(function () {
                // FIXME Animator will not be removed if use `Animator#stop` to stop animation
                animators.splice(util.indexOf(animators, animator), 1);
            });
            animators.push(animator);
            // If animate after added to the zrender
            if (zr) {
                zr.animation.addAnimator(animator);
            }
            return animator;
        },
        stopAnimation: function (forwardToLast) {
            var animators = this.animators;
            var len = animators.length;
            for (var i = 0; i < len; i++) {
                animators[i].stop(forwardToLast);
            }
            animators.length = 0;
            return this;
        },
        animateTo: function (target, time, delay, easing, callback) {
            // animateTo(target, time, easing, callback);
            if (isString(delay)) {
                callback = easing;
                easing = delay;
                delay = 0;
            }    // animateTo(target, time, delay, callback);
            else if (isFunction(easing)) {
                callback = easing;
                easing = 'linear';
                delay = 0;
            }    // animateTo(target, time, callback);
            else if (isFunction(delay)) {
                callback = delay;
                delay = 0;
            }    // animateTo(target, callback)
            else if (isFunction(time)) {
                callback = time;
                time = 500;
            }    // animateTo(target)
            else if (!time) {
                time = 500;
            }
            // Stop all previous animations
            this.stopAnimation();
            this._animateToShallow('', this, target, time, delay, easing, callback);
            // Animators may be removed immediately after start
            // if there is nothing to animate
            var animators = this.animators.slice();
            var count = animators.length;
            function done() {
                count--;
                if (!count) {
                    callback && callback();
                }
            }
            // No animators. This should be checked before animators[i].start(),
            // because 'done' may be executed immediately if no need to animate.
            if (!count) {
                callback && callback();
            }
            // Start after all animators created
            // Incase any animator is done immediately when all animation properties are not changed
            for (var i = 0; i < animators.length; i++) {
                animators[i].done(done).start(easing);
            }
        },
        _animateToShallow: function (path, source, target, time, delay) {
            var objShallow = {};
            var propertyCount = 0;
            for (var name in target) {
                if (!target.hasOwnProperty(name)) {
                    continue;
                }
                if (source[name] != null) {
                    if (isObject(target[name]) && !util.isArrayLike(target[name])) {
                        this._animateToShallow(path ? path + '.' + name : name, source[name], target[name], time, delay);
                    } else {
                        objShallow[name] = target[name];
                        propertyCount++;
                    }
                } else if (target[name] != null) {
                    // Attr directly if not has property
                    // FIXME, if some property not needed for element ?
                    if (!path) {
                        this.attr(name, target[name]);
                    } else {
                        // Shape or style
                        var props = {};
                        props[path] = {};
                        props[path][name] = target[name];
                        this.attr(props);
                    }
                }
            }
            if (propertyCount > 0) {
                this.animate(path, false).when(time == null ? 500 : time, objShallow).delay(delay || 0);
            }
            return this;
        }
    };
    return Animatable;
});
define('echarts/coord/Axis', ['require', '../util/number', 'zrender/core/util'], function (require) {
    var numberUtil = require('../util/number');
    var linearMap = numberUtil.linearMap;
    var zrUtil = require('zrender/core/util');
    function fixExtentWithBands(extent, nTick) {
        var size = extent[1] - extent[0];
        var len = nTick;
        var margin = size / len / 2;
        extent[0] += margin;
        extent[1] -= margin;
    }
    var normalizedExtent = [
            0,
            1
        ];
    /**
     * @name module:echarts/coord/CartesianAxis
     * @constructor
     */
    var Axis = function (dim, scale, extent) {
        /**
         * Axis dimension. Such as 'x', 'y', 'z', 'angle', 'radius'
         * @type {string}
         */
        this.dim = dim;
        /**
         * Axis scale
         * @type {module:echarts/coord/scale/*}
         */
        this.scale = scale;
        /**
         * @type {Array.<number>}
         * @private
         */
        this._extent = extent || [
            0,
            0
        ];
        /**
         * @type {boolean}
         */
        this.inverse = false;
        /**
         * Usually true when axis has a ordinal scale
         * @type {boolean}
         */
        this.onBand = false;
    };
    Axis.prototype = {
        constructor: Axis,
        contain: function (coord) {
            var extent = this._extent;
            var min = Math.min(extent[0], extent[1]);
            var max = Math.max(extent[0], extent[1]);
            return coord >= min && coord <= max;
        },
        containData: function (data) {
            return this.contain(this.dataToCoord(data));
        },
        getExtent: function () {
            var ret = this._extent.slice();
            return ret;
        },
        getPixelPrecision: function (dataExtent) {
            return numberUtil.getPixelPrecision(dataExtent || this.scale.getExtent(), this._extent);
        },
        setExtent: function (start, end) {
            var extent = this._extent;
            extent[0] = start;
            extent[1] = end;
        },
        dataToCoord: function (data, clamp) {
            var extent = this._extent;
            var scale = this.scale;
            data = scale.normalize(data);
            if (this.onBand && scale.type === 'ordinal') {
                extent = extent.slice();
                fixExtentWithBands(extent, scale.count());
            }
            return linearMap(data, normalizedExtent, extent, clamp);
        },
        coordToData: function (coord, clamp) {
            var extent = this._extent;
            var scale = this.scale;
            if (this.onBand && scale.type === 'ordinal') {
                extent = extent.slice();
                fixExtentWithBands(extent, scale.count());
            }
            var t = linearMap(coord, extent, normalizedExtent, clamp);
            return this.scale.scale(t);
        },
        getTicksCoords: function (alignWithLabel) {
            if (this.onBand && !alignWithLabel) {
                var bands = this.getBands();
                var coords = [];
                for (var i = 0; i < bands.length; i++) {
                    coords.push(bands[i][0]);
                }
                if (bands[i - 1]) {
                    coords.push(bands[i - 1][1]);
                }
                return coords;
            } else {
                return zrUtil.map(this.scale.getTicks(), this.dataToCoord, this);
            }
        },
        getLabelsCoords: function () {
            return zrUtil.map(this.scale.getTicks(), this.dataToCoord, this);
        },
        getBands: function () {
            var extent = this.getExtent();
            var bands = [];
            var len = this.scale.count();
            var start = extent[0];
            var end = extent[1];
            var span = end - start;
            for (var i = 0; i < len; i++) {
                bands.push([
                    span * i / len + start,
                    span * (i + 1) / len + start
                ]);
            }
            return bands;
        },
        getBandWidth: function () {
            var axisExtent = this._extent;
            var dataExtent = this.scale.getExtent();
            var len = dataExtent[1] - dataExtent[0] + (this.onBand ? 1 : 0);
            // Fix #2728, avoid NaN when only one data.
            len === 0 && (len = 1);
            var size = Math.abs(axisExtent[1] - axisExtent[0]);
            return Math.abs(size) / len;
        }
    };
    return Axis;
});
define('echarts/coord/cartesian/axisLabelInterval', ['require', 'zrender/core/util', '../axisHelper'], function (require) {
    'use strict';
    var zrUtil = require('zrender/core/util');
    var axisHelper = require('../axisHelper');
    return function (axis) {
        var axisModel = axis.model;
        var labelModel = axisModel.getModel('axisLabel');
        var labelInterval = labelModel.get('interval');
        if (!(axis.type === 'category' && labelInterval === 'auto')) {
            return labelInterval === 'auto' ? 0 : labelInterval;
        }
        return axisHelper.getAxisLabelInterval(zrUtil.map(axis.scale.getTicks(), axis.dataToCoord, axis), axisModel.getFormattedLabels(), labelModel.getModel('textStyle').getFont(), axis.isHorizontal());
    };
});
define('zrender/animation/Animator', ['require', './Clip', '../tool/color', '../core/util'], function (require) {
    var Clip = require('./Clip');
    var color = require('../tool/color');
    var util = require('../core/util');
    var isArrayLike = util.isArrayLike;
    var arraySlice = Array.prototype.slice;
    function defaultGetter(target, key) {
        return target[key];
    }
    function defaultSetter(target, key, value) {
        target[key] = value;
    }
    /**
     * @param  {number} p0
     * @param  {number} p1
     * @param  {number} percent
     * @return {number}
     */
    function interpolateNumber(p0, p1, percent) {
        return (p1 - p0) * percent + p0;
    }
    /**
     * @param  {string} p0
     * @param  {string} p1
     * @param  {number} percent
     * @return {string}
     */
    function interpolateString(p0, p1, percent) {
        return percent > 0.5 ? p1 : p0;
    }
    /**
     * @param  {Array} p0
     * @param  {Array} p1
     * @param  {number} percent
     * @param  {Array} out
     * @param  {number} arrDim
     */
    function interpolateArray(p0, p1, percent, out, arrDim) {
        var len = p0.length;
        if (arrDim == 1) {
            for (var i = 0; i < len; i++) {
                out[i] = interpolateNumber(p0[i], p1[i], percent);
            }
        } else {
            var len2 = p0[0].length;
            for (var i = 0; i < len; i++) {
                for (var j = 0; j < len2; j++) {
                    out[i][j] = interpolateNumber(p0[i][j], p1[i][j], percent);
                }
            }
        }
    }
    // arr0 is source array, arr1 is target array.
    // Do some preprocess to avoid error happened when interpolating from arr0 to arr1
    function fillArr(arr0, arr1, arrDim) {
        var arr0Len = arr0.length;
        var arr1Len = arr1.length;
        if (arr0Len !== arr1Len) {
            // FIXME Not work for TypedArray
            var isPreviousLarger = arr0Len > arr1Len;
            if (isPreviousLarger) {
                // Cut the previous
                arr0.length = arr1Len;
            } else {
                // Fill the previous
                for (var i = arr0Len; i < arr1Len; i++) {
                    arr0.push(arrDim === 1 ? arr1[i] : arraySlice.call(arr1[i]));
                }
            }
        }
        // Handling NaN value
        var len2 = arr0[0] && arr0[0].length;
        for (var i = 0; i < arr0.length; i++) {
            if (arrDim === 1) {
                if (isNaN(arr0[i])) {
                    arr0[i] = arr1[i];
                }
            } else {
                for (var j = 0; j < len2; j++) {
                    if (isNaN(arr0[i][j])) {
                        arr0[i][j] = arr1[i][j];
                    }
                }
            }
        }
    }
    /**
     * @param  {Array} arr0
     * @param  {Array} arr1
     * @param  {number} arrDim
     * @return {boolean}
     */
    function isArraySame(arr0, arr1, arrDim) {
        if (arr0 === arr1) {
            return true;
        }
        var len = arr0.length;
        if (len !== arr1.length) {
            return false;
        }
        if (arrDim === 1) {
            for (var i = 0; i < len; i++) {
                if (arr0[i] !== arr1[i]) {
                    return false;
                }
            }
        } else {
            var len2 = arr0[0].length;
            for (var i = 0; i < len; i++) {
                for (var j = 0; j < len2; j++) {
                    if (arr0[i][j] !== arr1[i][j]) {
                        return false;
                    }
                }
            }
        }
        return true;
    }
    /**
     * Catmull Rom interpolate array
     * @param  {Array} p0
     * @param  {Array} p1
     * @param  {Array} p2
     * @param  {Array} p3
     * @param  {number} t
     * @param  {number} t2
     * @param  {number} t3
     * @param  {Array} out
     * @param  {number} arrDim
     */
    function catmullRomInterpolateArray(p0, p1, p2, p3, t, t2, t3, out, arrDim) {
        var len = p0.length;
        if (arrDim == 1) {
            for (var i = 0; i < len; i++) {
                out[i] = catmullRomInterpolate(p0[i], p1[i], p2[i], p3[i], t, t2, t3);
            }
        } else {
            var len2 = p0[0].length;
            for (var i = 0; i < len; i++) {
                for (var j = 0; j < len2; j++) {
                    out[i][j] = catmullRomInterpolate(p0[i][j], p1[i][j], p2[i][j], p3[i][j], t, t2, t3);
                }
            }
        }
    }
    /**
     * Catmull Rom interpolate number
     * @param  {number} p0
     * @param  {number} p1
     * @param  {number} p2
     * @param  {number} p3
     * @param  {number} t
     * @param  {number} t2
     * @param  {number} t3
     * @return {number}
     */
    function catmullRomInterpolate(p0, p1, p2, p3, t, t2, t3) {
        var v0 = (p2 - p0) * 0.5;
        var v1 = (p3 - p1) * 0.5;
        return (2 * (p1 - p2) + v0 + v1) * t3 + (-3 * (p1 - p2) - 2 * v0 - v1) * t2 + v0 * t + p1;
    }
    function cloneValue(value) {
        if (isArrayLike(value)) {
            var len = value.length;
            if (isArrayLike(value[0])) {
                var ret = [];
                for (var i = 0; i < len; i++) {
                    ret.push(arraySlice.call(value[i]));
                }
                return ret;
            }
            return arraySlice.call(value);
        }
        return value;
    }
    function rgba2String(rgba) {
        rgba[0] = Math.floor(rgba[0]);
        rgba[1] = Math.floor(rgba[1]);
        rgba[2] = Math.floor(rgba[2]);
        return 'rgba(' + rgba.join(',') + ')';
    }
    function createTrackClip(animator, easing, oneTrackDone, keyframes, propName) {
        var getter = animator._getter;
        var setter = animator._setter;
        var useSpline = easing === 'spline';
        var trackLen = keyframes.length;
        if (!trackLen) {
            return;
        }
        // Guess data type
        var firstVal = keyframes[0].value;
        var isValueArray = isArrayLike(firstVal);
        var isValueColor = false;
        var isValueString = false;
        // For vertices morphing
        var arrDim = isValueArray && isArrayLike(firstVal[0]) ? 2 : 1;
        var trackMaxTime;
        // Sort keyframe as ascending
        keyframes.sort(function (a, b) {
            return a.time - b.time;
        });
        trackMaxTime = keyframes[trackLen - 1].time;
        // Percents of each keyframe
        var kfPercents = [];
        // Value of each keyframe
        var kfValues = [];
        var prevValue = keyframes[0].value;
        var isAllValueEqual = true;
        for (var i = 0; i < trackLen; i++) {
            kfPercents.push(keyframes[i].time / trackMaxTime);
            // Assume value is a color when it is a string
            var value = keyframes[i].value;
            // Check if value is equal, deep check if value is array
            if (!(isValueArray && isArraySame(value, prevValue, arrDim) || !isValueArray && value === prevValue)) {
                isAllValueEqual = false;
            }
            prevValue = value;
            // Try converting a string to a color array
            if (typeof value == 'string') {
                var colorArray = color.parse(value);
                if (colorArray) {
                    value = colorArray;
                    isValueColor = true;
                } else {
                    isValueString = true;
                }
            }
            kfValues.push(value);
        }
        if (isAllValueEqual) {
            return;
        }
        var lastValue = kfValues[trackLen - 1];
        // Polyfill array and NaN value
        for (var i = 0; i < trackLen - 1; i++) {
            if (isValueArray) {
                fillArr(kfValues[i], lastValue, arrDim);
            } else {
                if (isNaN(kfValues[i]) && !isNaN(lastValue) && !isValueString && !isValueColor) {
                    kfValues[i] = lastValue;
                }
            }
        }
        isValueArray && fillArr(getter(animator._target, propName), lastValue, arrDim);
        // Cache the key of last frame to speed up when
        // animation playback is sequency
        var lastFrame = 0;
        var lastFramePercent = 0;
        var start;
        var w;
        var p0;
        var p1;
        var p2;
        var p3;
        if (isValueColor) {
            var rgba = [
                    0,
                    0,
                    0,
                    0
                ];
        }
        var onframe = function (target, percent) {
            // Find the range keyframes
            // kf1-----kf2---------current--------kf3
            // find kf2 and kf3 and do interpolation
            var frame;
            // In the easing function like elasticOut, percent may less than 0
            if (percent < 0) {
                frame = 0;
            } else if (percent < lastFramePercent) {
                // Start from next key
                // PENDING start from lastFrame ?
                start = Math.min(lastFrame + 1, trackLen - 1);
                for (frame = start; frame >= 0; frame--) {
                    if (kfPercents[frame] <= percent) {
                        break;
                    }
                }
                // PENDING really need to do this ?
                frame = Math.min(frame, trackLen - 2);
            } else {
                for (frame = lastFrame; frame < trackLen; frame++) {
                    if (kfPercents[frame] > percent) {
                        break;
                    }
                }
                frame = Math.min(frame - 1, trackLen - 2);
            }
            lastFrame = frame;
            lastFramePercent = percent;
            var range = kfPercents[frame + 1] - kfPercents[frame];
            if (range === 0) {
                return;
            } else {
                w = (percent - kfPercents[frame]) / range;
            }
            if (useSpline) {
                p1 = kfValues[frame];
                p0 = kfValues[frame === 0 ? frame : frame - 1];
                p2 = kfValues[frame > trackLen - 2 ? trackLen - 1 : frame + 1];
                p3 = kfValues[frame > trackLen - 3 ? trackLen - 1 : frame + 2];
                if (isValueArray) {
                    catmullRomInterpolateArray(p0, p1, p2, p3, w, w * w, w * w * w, getter(target, propName), arrDim);
                } else {
                    var value;
                    if (isValueColor) {
                        value = catmullRomInterpolateArray(p0, p1, p2, p3, w, w * w, w * w * w, rgba, 1);
                        value = rgba2String(rgba);
                    } else if (isValueString) {
                        // String is step(0.5)
                        return interpolateString(p1, p2, w);
                    } else {
                        value = catmullRomInterpolate(p0, p1, p2, p3, w, w * w, w * w * w);
                    }
                    setter(target, propName, value);
                }
            } else {
                if (isValueArray) {
                    interpolateArray(kfValues[frame], kfValues[frame + 1], w, getter(target, propName), arrDim);
                } else {
                    var value;
                    if (isValueColor) {
                        interpolateArray(kfValues[frame], kfValues[frame + 1], w, rgba, 1);
                        value = rgba2String(rgba);
                    } else if (isValueString) {
                        // String is step(0.5)
                        return interpolateString(kfValues[frame], kfValues[frame + 1], w);
                    } else {
                        value = interpolateNumber(kfValues[frame], kfValues[frame + 1], w);
                    }
                    setter(target, propName, value);
                }
            }
        };
        var clip = new Clip({
                target: animator._target,
                life: trackMaxTime,
                loop: animator._loop,
                delay: animator._delay,
                onframe: onframe,
                ondestroy: oneTrackDone
            });
        if (easing && easing !== 'spline') {
            clip.easing = easing;
        }
        return clip;
    }
    /**
     * @alias module:zrender/animation/Animator
     * @constructor
     * @param {Object} target
     * @param {boolean} loop
     * @param {Function} getter
     * @param {Function} setter
     */
    var Animator = function (target, loop, getter, setter) {
        this._tracks = {};
        this._target = target;
        this._loop = loop || false;
        this._getter = getter || defaultGetter;
        this._setter = setter || defaultSetter;
        this._clipCount = 0;
        this._delay = 0;
        this._doneList = [];
        this._onframeList = [];
        this._clipList = [];
    };
    Animator.prototype = {
        when: function (time, props) {
            var tracks = this._tracks;
            for (var propName in props) {
                if (!props.hasOwnProperty(propName)) {
                    continue;
                }
                if (!tracks[propName]) {
                    tracks[propName] = [];
                    // Invalid value
                    var value = this._getter(this._target, propName);
                    if (value == null) {
                        // zrLog('Invalid property ' + propName);
                        continue;
                    }
                    // If time is 0
                    //  Then props is given initialize value
                    // Else
                    //  Initialize value from current prop value
                    if (time !== 0) {
                        tracks[propName].push({
                            time: 0,
                            value: cloneValue(value)
                        });
                    }
                }
                tracks[propName].push({
                    time: time,
                    value: props[propName]
                });
            }
            return this;
        },
        during: function (callback) {
            this._onframeList.push(callback);
            return this;
        },
        _doneCallback: function () {
            // Clear all tracks
            this._tracks = {};
            // Clear all clips
            this._clipList.length = 0;
            var doneList = this._doneList;
            var len = doneList.length;
            for (var i = 0; i < len; i++) {
                doneList[i].call(this);
            }
        },
        start: function (easing) {
            var self = this;
            var clipCount = 0;
            var oneTrackDone = function () {
                clipCount--;
                if (!clipCount) {
                    self._doneCallback();
                }
            };
            var lastClip;
            for (var propName in this._tracks) {
                if (!this._tracks.hasOwnProperty(propName)) {
                    continue;
                }
                var clip = createTrackClip(this, easing, oneTrackDone, this._tracks[propName], propName);
                if (clip) {
                    this._clipList.push(clip);
                    clipCount++;
                    // If start after added to animation
                    if (this.animation) {
                        this.animation.addClip(clip);
                    }
                    lastClip = clip;
                }
            }
            // Add during callback on the last clip
            if (lastClip) {
                var oldOnFrame = lastClip.onframe;
                lastClip.onframe = function (target, percent) {
                    oldOnFrame(target, percent);
                    for (var i = 0; i < self._onframeList.length; i++) {
                        self._onframeList[i](target, percent);
                    }
                };
            }
            if (!clipCount) {
                this._doneCallback();
            }
            return this;
        },
        stop: function (forwardToLast) {
            var clipList = this._clipList;
            var animation = this.animation;
            for (var i = 0; i < clipList.length; i++) {
                var clip = clipList[i];
                if (forwardToLast) {
                    // Move to last frame before stop
                    clip.onframe(this._target, 1);
                }
                animation && animation.removeClip(clip);
            }
            clipList.length = 0;
        },
        delay: function (time) {
            this._delay = time;
            return this;
        },
        done: function (cb) {
            if (cb) {
                this._doneList.push(cb);
            }
            return this;
        },
        getClips: function () {
            return this._clipList;
        }
    };
    return Animator;
});
define('zrender/core/log', ['require', '../config'], function (require) {
    var config = require('../config');
    /**
         * @exports zrender/tool/log
         * @author Kener (@Kener-林峰, kener.linfeng@gmail.com)
         */
    return function () {
        if (config.debugMode === 0) {
            return;
        } else if (config.debugMode == 1) {
            for (var k in arguments) {
                throw new Error(arguments[k]);
            }
        } else if (config.debugMode > 1) {
            for (var k in arguments) {
                console.log(arguments[k]);
            }
        }
    };    /* for debug
        return function(mes) {
            document.getElementById('wrong-message').innerHTML =
                mes + ' ' + (new Date() - 0)
                + '<br/>'
                + document.getElementById('wrong-message').innerHTML;
        };
        */
});
define('echarts/coord/cartesian/AxisModel', ['require', '../../model/Component', 'zrender/core/util', '../axisModelCreator', '../axisModelCommonMixin', '../axisModelZoomMixin'], function (require) {
    'use strict';
    var ComponentModel = require('../../model/Component');
    var zrUtil = require('zrender/core/util');
    var axisModelCreator = require('../axisModelCreator');
    var AxisModel = ComponentModel.extend({
            type: 'cartesian2dAxis',
            axis: null,
            init: function () {
                AxisModel.superApply(this, 'init', arguments);
                this.resetRange();
            },
            mergeOption: function () {
                AxisModel.superApply(this, 'mergeOption', arguments);
                this.resetRange();
            },
            restoreData: function () {
                AxisModel.superApply(this, 'restoreData', arguments);
                this.resetRange();
            },
            findGridModel: function () {
                return this.ecModel.queryComponents({
                    mainType: 'grid',
                    index: this.get('gridIndex'),
                    id: this.get('gridId')
                })[0];
            }
        });
    function getAxisType(axisDim, option) {
        // Default axis with data is category axis
        return option.type || (option.data ? 'category' : 'value');
    }
    zrUtil.merge(AxisModel.prototype, require('../axisModelCommonMixin'));
    zrUtil.merge(AxisModel.prototype, require('../axisModelZoomMixin'));
    var extraOption = { offset: 0 };
    axisModelCreator('x', AxisModel, getAxisType, extraOption);
    axisModelCreator('y', AxisModel, getAxisType, extraOption);
    return AxisModel;
});
define('zrender/animation/Clip', ['require', './easing'], function (require) {
    var easingFuncs = require('./easing');
    function Clip(options) {
        this._target = options.target;
        // 生命周期
        this._life = options.life || 1000;
        // 延时
        this._delay = options.delay || 0;
        // 开始时间
        // this._startTime = new Date().getTime() + this._delay;// 单位毫秒
        this._initialized = false;
        // 是否循环
        this.loop = options.loop == null ? false : options.loop;
        this.gap = options.gap || 0;
        this.easing = options.easing || 'Linear';
        this.onframe = options.onframe;
        this.ondestroy = options.ondestroy;
        this.onrestart = options.onrestart;
    }
    Clip.prototype = {
        constructor: Clip,
        step: function (globalTime) {
            // Set startTime on first step, or _startTime may has milleseconds different between clips
            // PENDING
            if (!this._initialized) {
                this._startTime = globalTime + this._delay;
                this._initialized = true;
            }
            var percent = (globalTime - this._startTime) / this._life;
            // 还没开始
            if (percent < 0) {
                return;
            }
            percent = Math.min(percent, 1);
            var easing = this.easing;
            var easingFunc = typeof easing == 'string' ? easingFuncs[easing] : easing;
            var schedule = typeof easingFunc === 'function' ? easingFunc(percent) : percent;
            this.fire('frame', schedule);
            // 结束
            if (percent == 1) {
                if (this.loop) {
                    this.restart(globalTime);
                    // 重新开始周期
                    // 抛出而不是直接调用事件直到 stage.update 后再统一调用这些事件
                    return 'restart';
                }
                // 动画完成将这个控制器标识为待删除
                // 在Animation.update中进行批量删除
                this._needsRemove = true;
                return 'destroy';
            }
            return null;
        },
        restart: function (globalTime) {
            var remainder = (globalTime - this._startTime) % this._life;
            this._startTime = globalTime - remainder + this.gap;
            this._needsRemove = false;
        },
        fire: function (eventType, arg) {
            eventType = 'on' + eventType;
            if (this[eventType]) {
                this[eventType](this._target, arg);
            }
        }
    };
    return Clip;
});
define('echarts/coord/axisModelCreator', ['require', './axisDefault', 'zrender/core/util', '../model/Component', '../util/layout'], function (require) {
    var axisDefault = require('./axisDefault');
    var zrUtil = require('zrender/core/util');
    var ComponentModel = require('../model/Component');
    var layout = require('../util/layout');
    // FIXME axisType is fixed ?
    var AXIS_TYPES = [
            'value',
            'category',
            'time',
            'log'
        ];
    /**
     * Generate sub axis model class
     * @param {string} axisName 'x' 'y' 'radius' 'angle' 'parallel'
     * @param {module:echarts/model/Component} BaseAxisModelClass
     * @param {Function} axisTypeDefaulter
     * @param {Object} [extraDefaultOption]
     */
    return function (axisName, BaseAxisModelClass, axisTypeDefaulter, extraDefaultOption) {
        zrUtil.each(AXIS_TYPES, function (axisType) {
            BaseAxisModelClass.extend({
                type: axisName + 'Axis.' + axisType,
                mergeDefaultAndTheme: function (option, ecModel) {
                    var layoutMode = this.layoutMode;
                    var inputPositionParams = layoutMode ? layout.getLayoutParams(option) : {};
                    var themeModel = ecModel.getTheme();
                    zrUtil.merge(option, themeModel.get(axisType + 'Axis'));
                    zrUtil.merge(option, this.getDefaultOption());
                    option.type = axisTypeDefaulter(axisName, option);
                    if (layoutMode) {
                        layout.mergeLayoutParam(option, inputPositionParams, layoutMode);
                    }
                },
                defaultOption: zrUtil.mergeAll([
                    {},
                    axisDefault[axisType + 'Axis'],
                    extraDefaultOption
                ], true)
            });
        });
        ComponentModel.registerSubTypeDefaulter(axisName + 'Axis', zrUtil.curry(axisTypeDefaulter, axisName));
    };
});
define('echarts/coord/axisModelCommonMixin', ['require', 'zrender/core/util', './axisHelper'], function (require) {
    var zrUtil = require('zrender/core/util');
    var axisHelper = require('./axisHelper');
    function getName(obj) {
        if (zrUtil.isObject(obj) && obj.value != null) {
            return obj.value;
        } else {
            return obj;
        }
    }
    /**
     * Get categories
     */
    function getCategories() {
        return this.get('type') === 'category' && zrUtil.map(this.get('data'), getName);
    }
    /**
     * Format labels
     * @return {Array.<string>}
     */
    function getFormattedLabels() {
        return axisHelper.getFormattedLabels(this.axis, this.get('axisLabel.formatter'));
    }
    return {
        getFormattedLabels: getFormattedLabels,
        getCategories: getCategories
    };
});
define('echarts/coord/axisModelZoomMixin', ['require'], function (require) {
    return {
        getMin: function () {
            var option = this.option;
            var min = option.rangeStart != null ? option.rangeStart : option.min;
            // In case of axis.type === 'time', Date should be converted to timestamp.
            // In other cases, min/max should be a number or null/undefined or 'dataMin/Max'.
            if (min instanceof Date) {
                min = +min;
            }
            return min;
        },
        getMax: function () {
            var option = this.option;
            var max = option.rangeEnd != null ? option.rangeEnd : option.max;
            // In case of axis.type === 'time', Date should be converted to timestamp.
            // In other cases, min/max should be a number or null/undefined or 'dataMin/Max'.
            if (max instanceof Date) {
                max = +max;
            }
            return max;
        },
        getNeedCrossZero: function () {
            var option = this.option;
            return option.rangeStart != null || option.rangeEnd != null ? false : !option.scale;
        },
        setRange: function (rangeStart, rangeEnd) {
            this.option.rangeStart = rangeStart;
            this.option.rangeEnd = rangeEnd;
        },
        resetRange: function () {
            // rangeStart and rangeEnd is readonly.
            this.option.rangeStart = this.option.rangeEnd = null;
        }
    };
});
define('zrender/animation/easing', [], function () {
    var easing = {
            linear: function (k) {
                return k;
            },
            quadraticIn: function (k) {
                return k * k;
            },
            quadraticOut: function (k) {
                return k * (2 - k);
            },
            quadraticInOut: function (k) {
                if ((k *= 2) < 1) {
                    return 0.5 * k * k;
                }
                return -0.5 * (--k * (k - 2) - 1);
            },
            cubicIn: function (k) {
                return k * k * k;
            },
            cubicOut: function (k) {
                return --k * k * k + 1;
            },
            cubicInOut: function (k) {
                if ((k *= 2) < 1) {
                    return 0.5 * k * k * k;
                }
                return 0.5 * ((k -= 2) * k * k + 2);
            },
            quarticIn: function (k) {
                return k * k * k * k;
            },
            quarticOut: function (k) {
                return 1 - --k * k * k * k;
            },
            quarticInOut: function (k) {
                if ((k *= 2) < 1) {
                    return 0.5 * k * k * k * k;
                }
                return -0.5 * ((k -= 2) * k * k * k - 2);
            },
            quinticIn: function (k) {
                return k * k * k * k * k;
            },
            quinticOut: function (k) {
                return --k * k * k * k * k + 1;
            },
            quinticInOut: function (k) {
                if ((k *= 2) < 1) {
                    return 0.5 * k * k * k * k * k;
                }
                return 0.5 * ((k -= 2) * k * k * k * k + 2);
            },
            sinusoidalIn: function (k) {
                return 1 - Math.cos(k * Math.PI / 2);
            },
            sinusoidalOut: function (k) {
                return Math.sin(k * Math.PI / 2);
            },
            sinusoidalInOut: function (k) {
                return 0.5 * (1 - Math.cos(Math.PI * k));
            },
            exponentialIn: function (k) {
                return k === 0 ? 0 : Math.pow(1024, k - 1);
            },
            exponentialOut: function (k) {
                return k === 1 ? 1 : 1 - Math.pow(2, -10 * k);
            },
            exponentialInOut: function (k) {
                if (k === 0) {
                    return 0;
                }
                if (k === 1) {
                    return 1;
                }
                if ((k *= 2) < 1) {
                    return 0.5 * Math.pow(1024, k - 1);
                }
                return 0.5 * (-Math.pow(2, -10 * (k - 1)) + 2);
            },
            circularIn: function (k) {
                return 1 - Math.sqrt(1 - k * k);
            },
            circularOut: function (k) {
                return Math.sqrt(1 - --k * k);
            },
            circularInOut: function (k) {
                if ((k *= 2) < 1) {
                    return -0.5 * (Math.sqrt(1 - k * k) - 1);
                }
                return 0.5 * (Math.sqrt(1 - (k -= 2) * k) + 1);
            },
            elasticIn: function (k) {
                var s;
                var a = 0.1;
                var p = 0.4;
                if (k === 0) {
                    return 0;
                }
                if (k === 1) {
                    return 1;
                }
                if (!a || a < 1) {
                    a = 1;
                    s = p / 4;
                } else {
                    s = p * Math.asin(1 / a) / (2 * Math.PI);
                }
                return -(a * Math.pow(2, 10 * (k -= 1)) * Math.sin((k - s) * (2 * Math.PI) / p));
            },
            elasticOut: function (k) {
                var s;
                var a = 0.1;
                var p = 0.4;
                if (k === 0) {
                    return 0;
                }
                if (k === 1) {
                    return 1;
                }
                if (!a || a < 1) {
                    a = 1;
                    s = p / 4;
                } else {
                    s = p * Math.asin(1 / a) / (2 * Math.PI);
                }
                return a * Math.pow(2, -10 * k) * Math.sin((k - s) * (2 * Math.PI) / p) + 1;
            },
            elasticInOut: function (k) {
                var s;
                var a = 0.1;
                var p = 0.4;
                if (k === 0) {
                    return 0;
                }
                if (k === 1) {
                    return 1;
                }
                if (!a || a < 1) {
                    a = 1;
                    s = p / 4;
                } else {
                    s = p * Math.asin(1 / a) / (2 * Math.PI);
                }
                if ((k *= 2) < 1) {
                    return -0.5 * (a * Math.pow(2, 10 * (k -= 1)) * Math.sin((k - s) * (2 * Math.PI) / p));
                }
                return a * Math.pow(2, -10 * (k -= 1)) * Math.sin((k - s) * (2 * Math.PI) / p) * 0.5 + 1;
            },
            backIn: function (k) {
                var s = 1.70158;
                return k * k * ((s + 1) * k - s);
            },
            backOut: function (k) {
                var s = 1.70158;
                return --k * k * ((s + 1) * k + s) + 1;
            },
            backInOut: function (k) {
                var s = 1.70158 * 1.525;
                if ((k *= 2) < 1) {
                    return 0.5 * (k * k * ((s + 1) * k - s));
                }
                return 0.5 * ((k -= 2) * k * ((s + 1) * k + s) + 2);
            },
            bounceIn: function (k) {
                return 1 - easing.bounceOut(1 - k);
            },
            bounceOut: function (k) {
                if (k < 1 / 2.75) {
                    return 7.5625 * k * k;
                } else if (k < 2 / 2.75) {
                    return 7.5625 * (k -= 1.5 / 2.75) * k + 0.75;
                } else if (k < 2.5 / 2.75) {
                    return 7.5625 * (k -= 2.25 / 2.75) * k + 0.9375;
                } else {
                    return 7.5625 * (k -= 2.625 / 2.75) * k + 0.984375;
                }
            },
            bounceInOut: function (k) {
                if (k < 0.5) {
                    return easing.bounceIn(k * 2) * 0.5;
                }
                return easing.bounceOut(k * 2 - 1) * 0.5 + 0.5;
            }
        };
    return easing;
});
define('echarts/coord/axisDefault', ['require', 'zrender/core/util'], function (require) {
    var zrUtil = require('zrender/core/util');
    var defaultOption = {
            show: true,
            zlevel: 0,
            z: 0,
            inverse: false,
            name: '',
            nameLocation: 'end',
            nameRotate: null,
            nameTruncate: {
                maxWidth: null,
                ellipsis: '...',
                placeholder: '.'
            },
            nameTextStyle: {},
            nameGap: 15,
            silent: false,
            triggerEvent: false,
            tooltip: { show: false },
            axisLine: {
                show: true,
                onZero: true,
                lineStyle: {
                    color: '#333',
                    width: 1,
                    type: 'solid'
                }
            },
            axisTick: {
                show: true,
                inside: false,
                length: 5,
                lineStyle: { width: 1 }
            },
            axisLabel: {
                show: true,
                inside: false,
                rotate: 0,
                margin: 8,
                textStyle: { fontSize: 12 }
            },
            splitLine: {
                show: true,
                lineStyle: {
                    color: ['#ccc'],
                    width: 1,
                    type: 'solid'
                }
            },
            splitArea: {
                show: false,
                areaStyle: {
                    color: [
                        'rgba(250,250,250,0.3)',
                        'rgba(200,200,200,0.3)'
                    ]
                }
            }
        };
    var categoryAxis = zrUtil.merge({
            boundaryGap: true,
            splitLine: { show: false },
            axisTick: {
                alignWithLabel: false,
                interval: 'auto'
            },
            axisLabel: { interval: 'auto' }
        }, defaultOption);
    var valueAxis = zrUtil.merge({
            boundaryGap: [
                0,
                0
            ],
            splitNumber: 5
        }, defaultOption);
    // FIXME
    var timeAxis = zrUtil.defaults({
            scale: true,
            min: 'dataMin',
            max: 'dataMax'
        }, valueAxis);
    var logAxis = zrUtil.defaults({ logBase: 10 }, valueAxis);
    logAxis.scale = true;
    return {
        categoryAxis: categoryAxis,
        valueAxis: valueAxis,
        timeAxis: timeAxis,
        logAxis: logAxis
    };
});
define('zrender/config', [], function () {
    var dpr = 1;
    // If in browser environment
    if (typeof window !== 'undefined') {
        dpr = Math.max(window.devicePixelRatio || 1, 1);
    }
    /**
     * config默认配置项
     * @exports zrender/config
     * @author Kener (@Kener-林峰, kener.linfeng@gmail.com)
     */
    var config = {
            debugMode: 0,
            devicePixelRatio: dpr
        };
    return config;
});
define('echarts/chart/helper/createListFromArray', ['require', '../../data/List', '../../data/helper/completeDimensions', 'zrender/core/util', '../../util/model', '../../CoordinateSystem'], function (require) {
    'use strict';
    var List = require('../../data/List');
    var completeDimensions = require('../../data/helper/completeDimensions');
    var zrUtil = require('zrender/core/util');
    var modelUtil = require('../../util/model');
    var CoordinateSystem = require('../../CoordinateSystem');
    var getDataItemValue = modelUtil.getDataItemValue;
    var converDataValue = modelUtil.converDataValue;
    function firstDataNotNull(data) {
        var i = 0;
        while (i < data.length && data[i] == null) {
            i++;
        }
        return data[i];
    }
    function ifNeedCompleteOrdinalData(data) {
        var sampleItem = firstDataNotNull(data);
        return sampleItem != null && !zrUtil.isArray(getDataItemValue(sampleItem));
    }
    /**
     * Helper function to create a list from option data
     */
    function createListFromArray(data, seriesModel, ecModel) {
        // If data is undefined
        data = data || [];
        if (true) {
            if (!zrUtil.isArray(data)) {
                throw new Error('Invalid data.');
            }
        }
        var coordSysName = seriesModel.get('coordinateSystem');
        var creator = creators[coordSysName];
        var registeredCoordSys = CoordinateSystem.get(coordSysName);
        // FIXME
        var axesInfo = creator && creator(data, seriesModel, ecModel);
        var dimensions = axesInfo && axesInfo.dimensions;
        if (!dimensions) {
            // Get dimensions from registered coordinate system
            dimensions = registeredCoordSys && registeredCoordSys.dimensions || [
                'x',
                'y'
            ];
            dimensions = completeDimensions(dimensions, data, dimensions.concat(['value']));
        }
        var categoryIndex = axesInfo ? axesInfo.categoryIndex : -1;
        var list = new List(dimensions, seriesModel);
        var nameList = createNameList(axesInfo, data);
        var categories = {};
        var dimValueGetter = categoryIndex >= 0 && ifNeedCompleteOrdinalData(data) ? function (itemOpt, dimName, dataIndex, dimIndex) {
                // If any dataItem is like { value: 10 }
                if (modelUtil.isDataItemOption(itemOpt)) {
                    list.hasItemOption = true;
                }
                // Use dataIndex as ordinal value in categoryAxis
                return dimIndex === categoryIndex ? dataIndex : converDataValue(getDataItemValue(itemOpt), dimensions[dimIndex]);
            } : function (itemOpt, dimName, dataIndex, dimIndex) {
                var value = getDataItemValue(itemOpt);
                var val = converDataValue(value && value[dimIndex], dimensions[dimIndex]);
                // If any dataItem is like { value: 10 }
                if (modelUtil.isDataItemOption(itemOpt)) {
                    list.hasItemOption = true;
                }
                var categoryAxesModels = axesInfo && axesInfo.categoryAxesModels;
                if (categoryAxesModels && categoryAxesModels[dimName]) {
                    // If given value is a category string
                    if (typeof val === 'string') {
                        // Lazy get categories
                        categories[dimName] = categories[dimName] || categoryAxesModels[dimName].getCategories();
                        val = zrUtil.indexOf(categories[dimName], val);
                        if (val < 0 && !isNaN(val)) {
                            // In case some one write '1', '2' istead of 1, 2
                            val = +val;
                        }
                    }
                }
                return val;
            };
        list.hasItemOption = false;
        list.initData(data, nameList, dimValueGetter);
        return list;
    }
    function isStackable(axisType) {
        return axisType !== 'category' && axisType !== 'time';
    }
    function getDimTypeByAxis(axisType) {
        return axisType === 'category' ? 'ordinal' : axisType === 'time' ? 'time' : 'float';
    }
    /**
     * Creaters for each coord system.
     */
    var creators = {
            cartesian2d: function (data, seriesModel, ecModel) {
                var axesModels = zrUtil.map([
                        'xAxis',
                        'yAxis'
                    ], function (name) {
                        return ecModel.queryComponents({
                            mainType: name,
                            index: seriesModel.get(name + 'Index'),
                            id: seriesModel.get(name + 'Id')
                        })[0];
                    });
                var xAxisModel = axesModels[0];
                var yAxisModel = axesModels[1];
                if (true) {
                    if (!xAxisModel) {
                        throw new Error('xAxis "' + zrUtil.retrieve(seriesModel.get('xAxisIndex'), seriesModel.get('xAxisId'), 0) + '" not found');
                    }
                    if (!yAxisModel) {
                        throw new Error('yAxis "' + zrUtil.retrieve(seriesModel.get('xAxisIndex'), seriesModel.get('yAxisId'), 0) + '" not found');
                    }
                }
                var xAxisType = xAxisModel.get('type');
                var yAxisType = yAxisModel.get('type');
                var dimensions = [
                        {
                            name: 'x',
                            type: getDimTypeByAxis(xAxisType),
                            stackable: isStackable(xAxisType)
                        },
                        {
                            name: 'y',
                            type: getDimTypeByAxis(yAxisType),
                            stackable: isStackable(yAxisType)
                        }
                    ];
                var isXAxisCateogry = xAxisType === 'category';
                var isYAxisCategory = yAxisType === 'category';
                completeDimensions(dimensions, data, [
                    'x',
                    'y',
                    'z'
                ]);
                var categoryAxesModels = {};
                if (isXAxisCateogry) {
                    categoryAxesModels.x = xAxisModel;
                }
                if (isYAxisCategory) {
                    categoryAxesModels.y = yAxisModel;
                }
                return {
                    dimensions: dimensions,
                    categoryIndex: isXAxisCateogry ? 0 : isYAxisCategory ? 1 : -1,
                    categoryAxesModels: categoryAxesModels
                };
            },
            polar: function (data, seriesModel, ecModel) {
                var polarModel = ecModel.queryComponents({
                        mainType: 'polar',
                        index: seriesModel.get('polarIndex'),
                        id: seriesModel.get('polarId')
                    })[0];
                var angleAxisModel = polarModel.findAxisModel('angleAxis');
                var radiusAxisModel = polarModel.findAxisModel('radiusAxis');
                if (true) {
                    if (!angleAxisModel) {
                        throw new Error('angleAxis option not found');
                    }
                    if (!radiusAxisModel) {
                        throw new Error('radiusAxis option not found');
                    }
                }
                var radiusAxisType = radiusAxisModel.get('type');
                var angleAxisType = angleAxisModel.get('type');
                var dimensions = [
                        {
                            name: 'radius',
                            type: getDimTypeByAxis(radiusAxisType),
                            stackable: isStackable(radiusAxisType)
                        },
                        {
                            name: 'angle',
                            type: getDimTypeByAxis(angleAxisType),
                            stackable: isStackable(angleAxisType)
                        }
                    ];
                var isAngleAxisCateogry = angleAxisType === 'category';
                var isRadiusAxisCateogry = radiusAxisType === 'category';
                completeDimensions(dimensions, data, [
                    'radius',
                    'angle',
                    'value'
                ]);
                var categoryAxesModels = {};
                if (isRadiusAxisCateogry) {
                    categoryAxesModels.radius = radiusAxisModel;
                }
                if (isAngleAxisCateogry) {
                    categoryAxesModels.angle = angleAxisModel;
                }
                return {
                    dimensions: dimensions,
                    categoryIndex: isAngleAxisCateogry ? 1 : isRadiusAxisCateogry ? 0 : -1,
                    categoryAxesModels: categoryAxesModels
                };
            },
            geo: function (data, seriesModel, ecModel) {
                // TODO Region
                // 多个散点图系列在同一个地区的时候
                return {
                    dimensions: completeDimensions([
                        { name: 'lng' },
                        { name: 'lat' }
                    ], data, [
                        'lng',
                        'lat',
                        'value'
                    ])
                };
            }
        };
    function createNameList(result, data) {
        var nameList = [];
        var categoryDim = result && result.dimensions[result.categoryIndex];
        var categoryAxisModel;
        if (categoryDim) {
            categoryAxisModel = result.categoryAxesModels[categoryDim.name];
        }
        if (categoryAxisModel) {
            // FIXME Two category axis
            var categories = categoryAxisModel.getCategories();
            if (categories) {
                var dataLen = data.length;
                // Ordered data is given explicitly like
                // [[3, 0.2], [1, 0.3], [2, 0.15]]
                // or given scatter data,
                // pick the category
                if (zrUtil.isArray(data[0]) && data[0].length > 1) {
                    nameList = [];
                    for (var i = 0; i < dataLen; i++) {
                        nameList[i] = categories[data[i][result.categoryIndex || 0]];
                    }
                } else {
                    nameList = categories.slice(0);
                }
            }
        }
        return nameList;
    }
    return createListFromArray;
});
define('zrender/core/curve', ['require', './vector'], function (require) {
    'use strict';
    var vec2 = require('./vector');
    var v2Create = vec2.create;
    var v2DistSquare = vec2.distSquare;
    var mathPow = Math.pow;
    var mathSqrt = Math.sqrt;
    var EPSILON = 1e-8;
    var EPSILON_NUMERIC = 0.0001;
    var THREE_SQRT = mathSqrt(3);
    var ONE_THIRD = 1 / 3;
    // 临时变量
    var _v0 = v2Create();
    var _v1 = v2Create();
    var _v2 = v2Create();
    // var _v3 = vec2.create();
    function isAroundZero(val) {
        return val > -EPSILON && val < EPSILON;
    }
    function isNotAroundZero(val) {
        return val > EPSILON || val < -EPSILON;
    }
    /**
     * 计算三次贝塞尔值
     * @memberOf module:zrender/core/curve
     * @param  {number} p0
     * @param  {number} p1
     * @param  {number} p2
     * @param  {number} p3
     * @param  {number} t
     * @return {number}
     */
    function cubicAt(p0, p1, p2, p3, t) {
        var onet = 1 - t;
        return onet * onet * (onet * p0 + 3 * t * p1) + t * t * (t * p3 + 3 * onet * p2);
    }
    /**
     * 计算三次贝塞尔导数值
     * @memberOf module:zrender/core/curve
     * @param  {number} p0
     * @param  {number} p1
     * @param  {number} p2
     * @param  {number} p3
     * @param  {number} t
     * @return {number}
     */
    function cubicDerivativeAt(p0, p1, p2, p3, t) {
        var onet = 1 - t;
        return 3 * (((p1 - p0) * onet + 2 * (p2 - p1) * t) * onet + (p3 - p2) * t * t);
    }
    /**
     * 计算三次贝塞尔方程根，使用盛金公式
     * @memberOf module:zrender/core/curve
     * @param  {number} p0
     * @param  {number} p1
     * @param  {number} p2
     * @param  {number} p3
     * @param  {number} val
     * @param  {Array.<number>} roots
     * @return {number} 有效根数目
     */
    function cubicRootAt(p0, p1, p2, p3, val, roots) {
        // Evaluate roots of cubic functions
        var a = p3 + 3 * (p1 - p2) - p0;
        var b = 3 * (p2 - p1 * 2 + p0);
        var c = 3 * (p1 - p0);
        var d = p0 - val;
        var A = b * b - 3 * a * c;
        var B = b * c - 9 * a * d;
        var C = c * c - 3 * b * d;
        var n = 0;
        if (isAroundZero(A) && isAroundZero(B)) {
            if (isAroundZero(b)) {
                roots[0] = 0;
            } else {
                var t1 = -c / b;
                //t1, t2, t3, b is not zero
                if (t1 >= 0 && t1 <= 1) {
                    roots[n++] = t1;
                }
            }
        } else {
            var disc = B * B - 4 * A * C;
            if (isAroundZero(disc)) {
                var K = B / A;
                var t1 = -b / a + K;
                // t1, a is not zero
                var t2 = -K / 2;
                // t2, t3
                if (t1 >= 0 && t1 <= 1) {
                    roots[n++] = t1;
                }
                if (t2 >= 0 && t2 <= 1) {
                    roots[n++] = t2;
                }
            } else if (disc > 0) {
                var discSqrt = mathSqrt(disc);
                var Y1 = A * b + 1.5 * a * (-B + discSqrt);
                var Y2 = A * b + 1.5 * a * (-B - discSqrt);
                if (Y1 < 0) {
                    Y1 = -mathPow(-Y1, ONE_THIRD);
                } else {
                    Y1 = mathPow(Y1, ONE_THIRD);
                }
                if (Y2 < 0) {
                    Y2 = -mathPow(-Y2, ONE_THIRD);
                } else {
                    Y2 = mathPow(Y2, ONE_THIRD);
                }
                var t1 = (-b - (Y1 + Y2)) / (3 * a);
                if (t1 >= 0 && t1 <= 1) {
                    roots[n++] = t1;
                }
            } else {
                var T = (2 * A * b - 3 * a * B) / (2 * mathSqrt(A * A * A));
                var theta = Math.acos(T) / 3;
                var ASqrt = mathSqrt(A);
                var tmp = Math.cos(theta);
                var t1 = (-b - 2 * ASqrt * tmp) / (3 * a);
                var t2 = (-b + ASqrt * (tmp + THREE_SQRT * Math.sin(theta))) / (3 * a);
                var t3 = (-b + ASqrt * (tmp - THREE_SQRT * Math.sin(theta))) / (3 * a);
                if (t1 >= 0 && t1 <= 1) {
                    roots[n++] = t1;
                }
                if (t2 >= 0 && t2 <= 1) {
                    roots[n++] = t2;
                }
                if (t3 >= 0 && t3 <= 1) {
                    roots[n++] = t3;
                }
            }
        }
        return n;
    }
    /**
     * 计算三次贝塞尔方程极限值的位置
     * @memberOf module:zrender/core/curve
     * @param  {number} p0
     * @param  {number} p1
     * @param  {number} p2
     * @param  {number} p3
     * @param  {Array.<number>} extrema
     * @return {number} 有效数目
     */
    function cubicExtrema(p0, p1, p2, p3, extrema) {
        var b = 6 * p2 - 12 * p1 + 6 * p0;
        var a = 9 * p1 + 3 * p3 - 3 * p0 - 9 * p2;
        var c = 3 * p1 - 3 * p0;
        var n = 0;
        if (isAroundZero(a)) {
            if (isNotAroundZero(b)) {
                var t1 = -c / b;
                if (t1 >= 0 && t1 <= 1) {
                    extrema[n++] = t1;
                }
            }
        } else {
            var disc = b * b - 4 * a * c;
            if (isAroundZero(disc)) {
                extrema[0] = -b / (2 * a);
            } else if (disc > 0) {
                var discSqrt = mathSqrt(disc);
                var t1 = (-b + discSqrt) / (2 * a);
                var t2 = (-b - discSqrt) / (2 * a);
                if (t1 >= 0 && t1 <= 1) {
                    extrema[n++] = t1;
                }
                if (t2 >= 0 && t2 <= 1) {
                    extrema[n++] = t2;
                }
            }
        }
        return n;
    }
    /**
     * 细分三次贝塞尔曲线
     * @memberOf module:zrender/core/curve
     * @param  {number} p0
     * @param  {number} p1
     * @param  {number} p2
     * @param  {number} p3
     * @param  {number} t
     * @param  {Array.<number>} out
     */
    function cubicSubdivide(p0, p1, p2, p3, t, out) {
        var p01 = (p1 - p0) * t + p0;
        var p12 = (p2 - p1) * t + p1;
        var p23 = (p3 - p2) * t + p2;
        var p012 = (p12 - p01) * t + p01;
        var p123 = (p23 - p12) * t + p12;
        var p0123 = (p123 - p012) * t + p012;
        // Seg0
        out[0] = p0;
        out[1] = p01;
        out[2] = p012;
        out[3] = p0123;
        // Seg1
        out[4] = p0123;
        out[5] = p123;
        out[6] = p23;
        out[7] = p3;
    }
    /**
     * 投射点到三次贝塞尔曲线上，返回投射距离。
     * 投射点有可能会有一个或者多个，这里只返回其中距离最短的一个。
     * @param {number} x0
     * @param {number} y0
     * @param {number} x1
     * @param {number} y1
     * @param {number} x2
     * @param {number} y2
     * @param {number} x3
     * @param {number} y3
     * @param {number} x
     * @param {number} y
     * @param {Array.<number>} [out] 投射点
     * @return {number}
     */
    function cubicProjectPoint(x0, y0, x1, y1, x2, y2, x3, y3, x, y, out) {
        // http://pomax.github.io/bezierinfo/#projections
        var t;
        var interval = 0.005;
        var d = Infinity;
        var prev;
        var next;
        var d1;
        var d2;
        _v0[0] = x;
        _v0[1] = y;
        // 先粗略估计一下可能的最小距离的 t 值
        // PENDING
        for (var _t = 0; _t < 1; _t += 0.05) {
            _v1[0] = cubicAt(x0, x1, x2, x3, _t);
            _v1[1] = cubicAt(y0, y1, y2, y3, _t);
            d1 = v2DistSquare(_v0, _v1);
            if (d1 < d) {
                t = _t;
                d = d1;
            }
        }
        d = Infinity;
        // At most 32 iteration
        for (var i = 0; i < 32; i++) {
            if (interval < EPSILON_NUMERIC) {
                break;
            }
            prev = t - interval;
            next = t + interval;
            // t - interval
            _v1[0] = cubicAt(x0, x1, x2, x3, prev);
            _v1[1] = cubicAt(y0, y1, y2, y3, prev);
            d1 = v2DistSquare(_v1, _v0);
            if (prev >= 0 && d1 < d) {
                t = prev;
                d = d1;
            } else {
                // t + interval
                _v2[0] = cubicAt(x0, x1, x2, x3, next);
                _v2[1] = cubicAt(y0, y1, y2, y3, next);
                d2 = v2DistSquare(_v2, _v0);
                if (next <= 1 && d2 < d) {
                    t = next;
                    d = d2;
                } else {
                    interval *= 0.5;
                }
            }
        }
        // t
        if (out) {
            out[0] = cubicAt(x0, x1, x2, x3, t);
            out[1] = cubicAt(y0, y1, y2, y3, t);
        }
        // console.log(interval, i);
        return mathSqrt(d);
    }
    /**
     * 计算二次方贝塞尔值
     * @param  {number} p0
     * @param  {number} p1
     * @param  {number} p2
     * @param  {number} t
     * @return {number}
     */
    function quadraticAt(p0, p1, p2, t) {
        var onet = 1 - t;
        return onet * (onet * p0 + 2 * t * p1) + t * t * p2;
    }
    /**
     * 计算二次方贝塞尔导数值
     * @param  {number} p0
     * @param  {number} p1
     * @param  {number} p2
     * @param  {number} t
     * @return {number}
     */
    function quadraticDerivativeAt(p0, p1, p2, t) {
        return 2 * ((1 - t) * (p1 - p0) + t * (p2 - p1));
    }
    /**
     * 计算二次方贝塞尔方程根
     * @param  {number} p0
     * @param  {number} p1
     * @param  {number} p2
     * @param  {number} t
     * @param  {Array.<number>} roots
     * @return {number} 有效根数目
     */
    function quadraticRootAt(p0, p1, p2, val, roots) {
        var a = p0 - 2 * p1 + p2;
        var b = 2 * (p1 - p0);
        var c = p0 - val;
        var n = 0;
        if (isAroundZero(a)) {
            if (isNotAroundZero(b)) {
                var t1 = -c / b;
                if (t1 >= 0 && t1 <= 1) {
                    roots[n++] = t1;
                }
            }
        } else {
            var disc = b * b - 4 * a * c;
            if (isAroundZero(disc)) {
                var t1 = -b / (2 * a);
                if (t1 >= 0 && t1 <= 1) {
                    roots[n++] = t1;
                }
            } else if (disc > 0) {
                var discSqrt = mathSqrt(disc);
                var t1 = (-b + discSqrt) / (2 * a);
                var t2 = (-b - discSqrt) / (2 * a);
                if (t1 >= 0 && t1 <= 1) {
                    roots[n++] = t1;
                }
                if (t2 >= 0 && t2 <= 1) {
                    roots[n++] = t2;
                }
            }
        }
        return n;
    }
    /**
     * 计算二次贝塞尔方程极限值
     * @memberOf module:zrender/core/curve
     * @param  {number} p0
     * @param  {number} p1
     * @param  {number} p2
     * @return {number}
     */
    function quadraticExtremum(p0, p1, p2) {
        var divider = p0 + p2 - 2 * p1;
        if (divider === 0) {
            // p1 is center of p0 and p2
            return 0.5;
        } else {
            return (p0 - p1) / divider;
        }
    }
    /**
     * 细分二次贝塞尔曲线
     * @memberOf module:zrender/core/curve
     * @param  {number} p0
     * @param  {number} p1
     * @param  {number} p2
     * @param  {number} t
     * @param  {Array.<number>} out
     */
    function quadraticSubdivide(p0, p1, p2, t, out) {
        var p01 = (p1 - p0) * t + p0;
        var p12 = (p2 - p1) * t + p1;
        var p012 = (p12 - p01) * t + p01;
        // Seg0
        out[0] = p0;
        out[1] = p01;
        out[2] = p012;
        // Seg1
        out[3] = p012;
        out[4] = p12;
        out[5] = p2;
    }
    /**
     * 投射点到二次贝塞尔曲线上，返回投射距离。
     * 投射点有可能会有一个或者多个，这里只返回其中距离最短的一个。
     * @param {number} x0
     * @param {number} y0
     * @param {number} x1
     * @param {number} y1
     * @param {number} x2
     * @param {number} y2
     * @param {number} x
     * @param {number} y
     * @param {Array.<number>} out 投射点
     * @return {number}
     */
    function quadraticProjectPoint(x0, y0, x1, y1, x2, y2, x, y, out) {
        // http://pomax.github.io/bezierinfo/#projections
        var t;
        var interval = 0.005;
        var d = Infinity;
        _v0[0] = x;
        _v0[1] = y;
        // 先粗略估计一下可能的最小距离的 t 值
        // PENDING
        for (var _t = 0; _t < 1; _t += 0.05) {
            _v1[0] = quadraticAt(x0, x1, x2, _t);
            _v1[1] = quadraticAt(y0, y1, y2, _t);
            var d1 = v2DistSquare(_v0, _v1);
            if (d1 < d) {
                t = _t;
                d = d1;
            }
        }
        d = Infinity;
        // At most 32 iteration
        for (var i = 0; i < 32; i++) {
            if (interval < EPSILON_NUMERIC) {
                break;
            }
            var prev = t - interval;
            var next = t + interval;
            // t - interval
            _v1[0] = quadraticAt(x0, x1, x2, prev);
            _v1[1] = quadraticAt(y0, y1, y2, prev);
            var d1 = v2DistSquare(_v1, _v0);
            if (prev >= 0 && d1 < d) {
                t = prev;
                d = d1;
            } else {
                // t + interval
                _v2[0] = quadraticAt(x0, x1, x2, next);
                _v2[1] = quadraticAt(y0, y1, y2, next);
                var d2 = v2DistSquare(_v2, _v0);
                if (next <= 1 && d2 < d) {
                    t = next;
                    d = d2;
                } else {
                    interval *= 0.5;
                }
            }
        }
        // t
        if (out) {
            out[0] = quadraticAt(x0, x1, x2, t);
            out[1] = quadraticAt(y0, y1, y2, t);
        }
        // console.log(interval, i);
        return mathSqrt(d);
    }
    return {
        cubicAt: cubicAt,
        cubicDerivativeAt: cubicDerivativeAt,
        cubicRootAt: cubicRootAt,
        cubicExtrema: cubicExtrema,
        cubicSubdivide: cubicSubdivide,
        cubicProjectPoint: cubicProjectPoint,
        quadraticAt: quadraticAt,
        quadraticDerivativeAt: quadraticDerivativeAt,
        quadraticRootAt: quadraticRootAt,
        quadraticExtremum: quadraticExtremum,
        quadraticSubdivide: quadraticSubdivide,
        quadraticProjectPoint: quadraticProjectPoint
    };
});
define('zrender/core/bbox', ['require', './vector', './curve'], function (require) {
    var vec2 = require('./vector');
    var curve = require('./curve');
    var bbox = {};
    var mathMin = Math.min;
    var mathMax = Math.max;
    var mathSin = Math.sin;
    var mathCos = Math.cos;
    var start = vec2.create();
    var end = vec2.create();
    var extremity = vec2.create();
    var PI2 = Math.PI * 2;
    /**
     * 从顶点数组中计算出最小包围盒，写入`min`和`max`中
     * @module zrender/core/bbox
     * @param {Array<Object>} points 顶点数组
     * @param {number} min
     * @param {number} max
     */
    bbox.fromPoints = function (points, min, max) {
        if (points.length === 0) {
            return;
        }
        var p = points[0];
        var left = p[0];
        var right = p[0];
        var top = p[1];
        var bottom = p[1];
        var i;
        for (i = 1; i < points.length; i++) {
            p = points[i];
            left = mathMin(left, p[0]);
            right = mathMax(right, p[0]);
            top = mathMin(top, p[1]);
            bottom = mathMax(bottom, p[1]);
        }
        min[0] = left;
        min[1] = top;
        max[0] = right;
        max[1] = bottom;
    };
    /**
     * @memberOf module:zrender/core/bbox
     * @param {number} x0
     * @param {number} y0
     * @param {number} x1
     * @param {number} y1
     * @param {Array.<number>} min
     * @param {Array.<number>} max
     */
    bbox.fromLine = function (x0, y0, x1, y1, min, max) {
        min[0] = mathMin(x0, x1);
        min[1] = mathMin(y0, y1);
        max[0] = mathMax(x0, x1);
        max[1] = mathMax(y0, y1);
    };
    var xDim = [];
    var yDim = [];
    /**
     * 从三阶贝塞尔曲线(p0, p1, p2, p3)中计算出最小包围盒，写入`min`和`max`中
     * @memberOf module:zrender/core/bbox
     * @param {number} x0
     * @param {number} y0
     * @param {number} x1
     * @param {number} y1
     * @param {number} x2
     * @param {number} y2
     * @param {number} x3
     * @param {number} y3
     * @param {Array.<number>} min
     * @param {Array.<number>} max
     */
    bbox.fromCubic = function (x0, y0, x1, y1, x2, y2, x3, y3, min, max) {
        var cubicExtrema = curve.cubicExtrema;
        var cubicAt = curve.cubicAt;
        var i;
        var n = cubicExtrema(x0, x1, x2, x3, xDim);
        min[0] = Infinity;
        min[1] = Infinity;
        max[0] = -Infinity;
        max[1] = -Infinity;
        for (i = 0; i < n; i++) {
            var x = cubicAt(x0, x1, x2, x3, xDim[i]);
            min[0] = mathMin(x, min[0]);
            max[0] = mathMax(x, max[0]);
        }
        n = cubicExtrema(y0, y1, y2, y3, yDim);
        for (i = 0; i < n; i++) {
            var y = cubicAt(y0, y1, y2, y3, yDim[i]);
            min[1] = mathMin(y, min[1]);
            max[1] = mathMax(y, max[1]);
        }
        min[0] = mathMin(x0, min[0]);
        max[0] = mathMax(x0, max[0]);
        min[0] = mathMin(x3, min[0]);
        max[0] = mathMax(x3, max[0]);
        min[1] = mathMin(y0, min[1]);
        max[1] = mathMax(y0, max[1]);
        min[1] = mathMin(y3, min[1]);
        max[1] = mathMax(y3, max[1]);
    };
    /**
     * 从二阶贝塞尔曲线(p0, p1, p2)中计算出最小包围盒，写入`min`和`max`中
     * @memberOf module:zrender/core/bbox
     * @param {number} x0
     * @param {number} y0
     * @param {number} x1
     * @param {number} y1
     * @param {number} x2
     * @param {number} y2
     * @param {Array.<number>} min
     * @param {Array.<number>} max
     */
    bbox.fromQuadratic = function (x0, y0, x1, y1, x2, y2, min, max) {
        var quadraticExtremum = curve.quadraticExtremum;
        var quadraticAt = curve.quadraticAt;
        // Find extremities, where derivative in x dim or y dim is zero
        var tx = mathMax(mathMin(quadraticExtremum(x0, x1, x2), 1), 0);
        var ty = mathMax(mathMin(quadraticExtremum(y0, y1, y2), 1), 0);
        var x = quadraticAt(x0, x1, x2, tx);
        var y = quadraticAt(y0, y1, y2, ty);
        min[0] = mathMin(x0, x2, x);
        min[1] = mathMin(y0, y2, y);
        max[0] = mathMax(x0, x2, x);
        max[1] = mathMax(y0, y2, y);
    };
    /**
     * 从圆弧中计算出最小包围盒，写入`min`和`max`中
     * @method
     * @memberOf module:zrender/core/bbox
     * @param {number} x
     * @param {number} y
     * @param {number} rx
     * @param {number} ry
     * @param {number} startAngle
     * @param {number} endAngle
     * @param {number} anticlockwise
     * @param {Array.<number>} min
     * @param {Array.<number>} max
     */
    bbox.fromArc = function (x, y, rx, ry, startAngle, endAngle, anticlockwise, min, max) {
        var vec2Min = vec2.min;
        var vec2Max = vec2.max;
        var diff = Math.abs(startAngle - endAngle);
        if (diff % PI2 < 0.0001 && diff > 0.0001) {
            // Is a circle
            min[0] = x - rx;
            min[1] = y - ry;
            max[0] = x + rx;
            max[1] = y + ry;
            return;
        }
        start[0] = mathCos(startAngle) * rx + x;
        start[1] = mathSin(startAngle) * ry + y;
        end[0] = mathCos(endAngle) * rx + x;
        end[1] = mathSin(endAngle) * ry + y;
        vec2Min(min, start, end);
        vec2Max(max, start, end);
        // Thresh to [0, Math.PI * 2]
        startAngle = startAngle % PI2;
        if (startAngle < 0) {
            startAngle = startAngle + PI2;
        }
        endAngle = endAngle % PI2;
        if (endAngle < 0) {
            endAngle = endAngle + PI2;
        }
        if (startAngle > endAngle && !anticlockwise) {
            endAngle += PI2;
        } else if (startAngle < endAngle && anticlockwise) {
            startAngle += PI2;
        }
        if (anticlockwise) {
            var tmp = endAngle;
            endAngle = startAngle;
            startAngle = tmp;
        }
        // var number = 0;
        // var step = (anticlockwise ? -Math.PI : Math.PI) / 2;
        for (var angle = 0; angle < endAngle; angle += Math.PI / 2) {
            if (angle > startAngle) {
                extremity[0] = mathCos(angle) * rx + x;
                extremity[1] = mathSin(angle) * ry + y;
                vec2Min(min, extremity, min);
                vec2Max(max, extremity, max);
            }
        }
    };
    return bbox;
});
define('echarts/data/helper/completeDimensions', ['require', 'zrender/core/util'], function (require) {
    var zrUtil = require('zrender/core/util');
    /**
     * Complete the dimensions array guessed from the data structure.
     * @param  {Array.<string>} dimensions      Necessary dimensions, like ['x', 'y']
     * @param  {Array} data                     Data list. [[1, 2, 3], [2, 3, 4]]
     * @param  {Array.<string>} defaultNames    Default names to fill not necessary dimensions, like ['value']
     * @param  {string} extraPrefix             Prefix of name when filling the left dimensions.
     * @return {Array.<string>}
     */
    function completeDimensions(dimensions, data, defaultNames, extraPrefix) {
        if (!data) {
            return dimensions;
        }
        var value0 = retrieveValue(data[0]);
        var dimSize = zrUtil.isArray(value0) && value0.length || 1;
        defaultNames = defaultNames || [];
        extraPrefix = extraPrefix || 'extra';
        for (var i = 0; i < dimSize; i++) {
            if (!dimensions[i]) {
                var name = defaultNames[i] || extraPrefix + (i - defaultNames.length);
                dimensions[i] = guessOrdinal(data, i) ? {
                    type: 'ordinal',
                    name: name
                } : name;
            }
        }
        return dimensions;
    }
    // The rule should not be complex, otherwise user might not
    // be able to known where the data is wrong.
    var guessOrdinal = completeDimensions.guessOrdinal = function (data, dimIndex) {
            for (var i = 0, len = data.length; i < len; i++) {
                var value = retrieveValue(data[i]);
                if (!zrUtil.isArray(value)) {
                    return false;
                }
                var value = value[dimIndex];
                if (value != null && isFinite(value)) {
                    return false;
                } else if (zrUtil.isString(value) && value !== '-') {
                    return true;
                }
            }
            return false;
        };
    function retrieveValue(o) {
        return zrUtil.isArray(o) ? o : zrUtil.isObject(o) ? o.value : o;
    }
    return completeDimensions;
});
define('echarts/data/DataDiffer', ['require'], function (require) {
    'use strict';
    function defaultKeyGetter(item) {
        return item;
    }
    function DataDiffer(oldArr, newArr, oldKeyGetter, newKeyGetter) {
        this._old = oldArr;
        this._new = newArr;
        this._oldKeyGetter = oldKeyGetter || defaultKeyGetter;
        this._newKeyGetter = newKeyGetter || defaultKeyGetter;
    }
    DataDiffer.prototype = {
        constructor: DataDiffer,
        add: function (func) {
            this._add = func;
            return this;
        },
        update: function (func) {
            this._update = func;
            return this;
        },
        remove: function (func) {
            this._remove = func;
            return this;
        },
        execute: function () {
            var oldArr = this._old;
            var newArr = this._new;
            var oldKeyGetter = this._oldKeyGetter;
            var newKeyGetter = this._newKeyGetter;
            var oldDataIndexMap = {};
            var newDataIndexMap = {};
            var oldDataKeyArr = [];
            var newDataKeyArr = [];
            var i;
            initIndexMap(oldArr, oldDataIndexMap, oldDataKeyArr, oldKeyGetter);
            initIndexMap(newArr, newDataIndexMap, newDataKeyArr, newKeyGetter);
            // Travel by inverted order to make sure order consistency
            // when duplicate keys exists (consider newDataIndex.pop() below).
            // For performance consideration, these code below do not look neat.
            for (i = 0; i < oldArr.length; i++) {
                var key = oldDataKeyArr[i];
                var idx = newDataIndexMap[key];
                // idx can never be empty array here. see 'set null' logic below.
                if (idx != null) {
                    // Consider there is duplicate key (for example, use dataItem.name as key).
                    // We should make sure every item in newArr and oldArr can be visited.
                    var len = idx.length;
                    if (len) {
                        len === 1 && (newDataIndexMap[key] = null);
                        idx = idx.unshift();
                    } else {
                        newDataIndexMap[key] = null;
                    }
                    this._update && this._update(idx, i);
                } else {
                    this._remove && this._remove(i);
                }
            }
            for (var i = 0; i < newDataKeyArr.length; i++) {
                var key = newDataKeyArr[i];
                if (newDataIndexMap.hasOwnProperty(key)) {
                    var idx = newDataIndexMap[key];
                    if (idx == null) {
                        continue;
                    }
                    // idx can never be empty array here. see 'set null' logic above.
                    if (!idx.length) {
                        this._add && this._add(idx);
                    } else {
                        for (var j = 0, len = idx.length; j < len; j++) {
                            this._add && this._add(idx[j]);
                        }
                    }
                }
            }
        }
    };
    function initIndexMap(arr, map, keyArr, keyGetter) {
        for (var i = 0; i < arr.length; i++) {
            var key = keyGetter(arr[i], i);
            var existence = map[key];
            if (existence == null) {
                keyArr.push(key);
                map[key] = i;
            } else {
                if (!existence.length) {
                    map[key] = existence = [existence];
                }
                existence.push(i);
            }
        }
    }
    return DataDiffer;
});
define('zrender/contain/line', [], function () {
    return {
        containStroke: function (x0, y0, x1, y1, lineWidth, x, y) {
            if (lineWidth === 0) {
                return false;
            }
            var _l = lineWidth;
            var _a = 0;
            var _b = x0;
            // Quick reject
            if (y > y0 + _l && y > y1 + _l || y < y0 - _l && y < y1 - _l || x > x0 + _l && x > x1 + _l || x < x0 - _l && x < x1 - _l) {
                return false;
            }
            if (x0 !== x1) {
                _a = (y0 - y1) / (x0 - x1);
                _b = (x0 * y1 - x1 * y0) / (x0 - x1);
            } else {
                return Math.abs(x - x0) <= _l / 2;
            }
            var tmp = _a * x - y + _b;
            var _s = tmp * tmp / (_a * _a + 1);
            return _s <= _l / 2 * _l / 2;
        }
    };
});
define('zrender/contain/cubic', ['require', '../core/curve'], function (require) {
    var curve = require('../core/curve');
    return {
        containStroke: function (x0, y0, x1, y1, x2, y2, x3, y3, lineWidth, x, y) {
            if (lineWidth === 0) {
                return false;
            }
            var _l = lineWidth;
            // Quick reject
            if (y > y0 + _l && y > y1 + _l && y > y2 + _l && y > y3 + _l || y < y0 - _l && y < y1 - _l && y < y2 - _l && y < y3 - _l || x > x0 + _l && x > x1 + _l && x > x2 + _l && x > x3 + _l || x < x0 - _l && x < x1 - _l && x < x2 - _l && x < x3 - _l) {
                return false;
            }
            var d = curve.cubicProjectPoint(x0, y0, x1, y1, x2, y2, x3, y3, x, y, null);
            return d <= _l / 2;
        }
    };
});
define('zrender/contain/quadratic', ['require', '../core/curve'], function (require) {
    var curve = require('../core/curve');
    return {
        containStroke: function (x0, y0, x1, y1, x2, y2, lineWidth, x, y) {
            if (lineWidth === 0) {
                return false;
            }
            var _l = lineWidth;
            // Quick reject
            if (y > y0 + _l && y > y1 + _l && y > y2 + _l || y < y0 - _l && y < y1 - _l && y < y2 - _l || x > x0 + _l && x > x1 + _l && x > x2 + _l || x < x0 - _l && x < x1 - _l && x < x2 - _l) {
                return false;
            }
            var d = curve.quadraticProjectPoint(x0, y0, x1, y1, x2, y2, x, y, null);
            return d <= _l / 2;
        }
    };
});
define('zrender/contain/arc', ['require', './util'], function (require) {
    var normalizeRadian = require('./util').normalizeRadian;
    var PI2 = Math.PI * 2;
    return {
        containStroke: function (cx, cy, r, startAngle, endAngle, anticlockwise, lineWidth, x, y) {
            if (lineWidth === 0) {
                return false;
            }
            var _l = lineWidth;
            x -= cx;
            y -= cy;
            var d = Math.sqrt(x * x + y * y);
            if (d - _l > r || d + _l < r) {
                return false;
            }
            if (Math.abs(startAngle - endAngle) % PI2 < 0.0001) {
                // Is a circle
                return true;
            }
            if (anticlockwise) {
                var tmp = startAngle;
                startAngle = normalizeRadian(endAngle);
                endAngle = normalizeRadian(tmp);
            } else {
                startAngle = normalizeRadian(startAngle);
                endAngle = normalizeRadian(endAngle);
            }
            if (startAngle > endAngle) {
                endAngle += PI2;
            }
            var angle = Math.atan2(y, x);
            if (angle < 0) {
                angle += PI2;
            }
            return angle >= startAngle && angle <= endAngle || angle + PI2 >= startAngle && angle + PI2 <= endAngle;
        }
    };
});
define('zrender/contain/util', ['require'], function (require) {
    var PI2 = Math.PI * 2;
    return {
        normalizeRadian: function (angle) {
            angle %= PI2;
            if (angle < 0) {
                angle += PI2;
            }
            return angle;
        }
    };
});
define('zrender/contain/windingLine', [], function () {
    return function windingLine(x0, y0, x1, y1, x, y) {
        if (y > y0 && y > y1 || y < y0 && y < y1) {
            return 0;
        }
        // Ignore horizontal line
        if (y1 === y0) {
            return 0;
        }
        var dir = y1 < y0 ? 1 : -1;
        var t = (y - y0) / (y1 - y0);
        // Avoid winding error when intersection point is the connect point of two line of polygon
        if (t === 1 || t === 0) {
            dir = y1 < y0 ? 0.5 : -0.5;
        }
        var x_ = t * (x1 - x0) + x0;
        return x_ > x ? dir : 0;
    };
});
define('echarts/chart/bar/barItemStyle', ['require', '../../model/mixin/makeStyleMapper'], function (require) {
    var getBarItemStyle = require('../../model/mixin/makeStyleMapper')([
            [
                'fill',
                'color'
            ],
            [
                'stroke',
                'borderColor'
            ],
            [
                'lineWidth',
                'borderWidth'
            ],
            [
                'stroke',
                'barBorderColor'
            ],
            [
                'lineWidth',
                'barBorderWidth'
            ],
            ['opacity'],
            ['shadowBlur'],
            ['shadowOffsetX'],
            ['shadowOffsetY'],
            ['shadowColor']
        ]);
    return {
        getBarItemStyle: function (excludes) {
            var style = getBarItemStyle.call(this, excludes);
            if (this.getBorderLineDash) {
                var lineDash = this.getBorderLineDash();
                lineDash && (style.lineDash = lineDash);
            }
            return style;
        }
    };
});
define('zrender/core/LRU', ['require'], function (require) {
    /**
     * Simple double linked list. Compared with array, it has O(1) remove operation.
     * @constructor
     */
    var LinkedList = function () {
        /**
         * @type {module:zrender/core/LRU~Entry}
         */
        this.head = null;
        /**
         * @type {module:zrender/core/LRU~Entry}
         */
        this.tail = null;
        this._len = 0;
    };
    var linkedListProto = LinkedList.prototype;
    /**
     * Insert a new value at the tail
     * @param  {} val
     * @return {module:zrender/core/LRU~Entry}
     */
    linkedListProto.insert = function (val) {
        var entry = new Entry(val);
        this.insertEntry(entry);
        return entry;
    };
    /**
     * Insert an entry at the tail
     * @param  {module:zrender/core/LRU~Entry} entry
     */
    linkedListProto.insertEntry = function (entry) {
        if (!this.head) {
            this.head = this.tail = entry;
        } else {
            this.tail.next = entry;
            entry.prev = this.tail;
            this.tail = entry;
        }
        this._len++;
    };
    /**
     * Remove entry.
     * @param  {module:zrender/core/LRU~Entry} entry
     */
    linkedListProto.remove = function (entry) {
        var prev = entry.prev;
        var next = entry.next;
        if (prev) {
            prev.next = next;
        } else {
            // Is head
            this.head = next;
        }
        if (next) {
            next.prev = prev;
        } else {
            // Is tail
            this.tail = prev;
        }
        entry.next = entry.prev = null;
        this._len--;
    };
    /**
     * @return {number}
     */
    linkedListProto.len = function () {
        return this._len;
    };
    /**
     * @constructor
     * @param {} val
     */
    var Entry = function (val) {
        /**
         * @type {}
         */
        this.value = val;
        /**
         * @type {module:zrender/core/LRU~Entry}
         */
        this.next;
        /**
         * @type {module:zrender/core/LRU~Entry}
         */
        this.prev;
    };
    /**
     * LRU Cache
     * @constructor
     * @alias module:zrender/core/LRU
     */
    var LRU = function (maxSize) {
        this._list = new LinkedList();
        this._map = {};
        this._maxSize = maxSize || 10;
    };
    var LRUProto = LRU.prototype;
    /**
     * @param  {string} key
     * @param  {} value
     */
    LRUProto.put = function (key, value) {
        var list = this._list;
        var map = this._map;
        if (map[key] == null) {
            var len = list.len();
            if (len >= this._maxSize && len > 0) {
                // Remove the least recently used
                var leastUsedEntry = list.head;
                list.remove(leastUsedEntry);
                delete map[leastUsedEntry.key];
            }
            var entry = list.insert(value);
            entry.key = key;
            map[key] = entry;
        }
    };
    /**
     * @param  {string} key
     * @return {}
     */
    LRUProto.get = function (key) {
        var entry = this._map[key];
        var list = this._list;
        if (entry != null) {
            // Put the latest used entry in the tail
            if (entry !== list.tail) {
                list.remove(entry);
                list.insertEntry(entry);
            }
            return entry.value;
        }
    };
    /**
     * Clear the cache
     */
    LRUProto.clear = function () {
        this._list.clear();
        this._map = {};
    };
    return LRU;
});
define('zrender/graphic/helper/poly', ['require', './smoothSpline', './smoothBezier'], function (require) {
    var smoothSpline = require('./smoothSpline');
    var smoothBezier = require('./smoothBezier');
    return {
        buildPath: function (ctx, shape, closePath) {
            var points = shape.points;
            var smooth = shape.smooth;
            if (points && points.length >= 2) {
                if (smooth && smooth !== 'spline') {
                    var controlPoints = smoothBezier(points, smooth, closePath, shape.smoothConstraint);
                    ctx.moveTo(points[0][0], points[0][1]);
                    var len = points.length;
                    for (var i = 0; i < (closePath ? len : len - 1); i++) {
                        var cp1 = controlPoints[i * 2];
                        var cp2 = controlPoints[i * 2 + 1];
                        var p = points[(i + 1) % len];
                        ctx.bezierCurveTo(cp1[0], cp1[1], cp2[0], cp2[1], p[0], p[1]);
                    }
                } else {
                    if (smooth === 'spline') {
                        points = smoothSpline(points, closePath);
                    }
                    ctx.moveTo(points[0][0], points[0][1]);
                    for (var i = 1, l = points.length; i < l; i++) {
                        ctx.lineTo(points[i][0], points[i][1]);
                    }
                }
                closePath && ctx.closePath();
            }
        }
    };
});
define('zrender/graphic/helper/smoothSpline', ['require', '../../core/vector'], function (require) {
    var vec2 = require('../../core/vector');
    /**
     * @inner
     */
    function interpolate(p0, p1, p2, p3, t, t2, t3) {
        var v0 = (p2 - p0) * 0.5;
        var v1 = (p3 - p1) * 0.5;
        return (2 * (p1 - p2) + v0 + v1) * t3 + (-3 * (p1 - p2) - 2 * v0 - v1) * t2 + v0 * t + p1;
    }
    /**
     * @alias module:zrender/shape/util/smoothSpline
     * @param {Array} points 线段顶点数组
     * @param {boolean} isLoop
     * @return {Array}
     */
    return function (points, isLoop) {
        var len = points.length;
        var ret = [];
        var distance = 0;
        for (var i = 1; i < len; i++) {
            distance += vec2.distance(points[i - 1], points[i]);
        }
        var segs = distance / 2;
        segs = segs < len ? len : segs;
        for (var i = 0; i < segs; i++) {
            var pos = i / (segs - 1) * (isLoop ? len : len - 1);
            var idx = Math.floor(pos);
            var w = pos - idx;
            var p0;
            var p1 = points[idx % len];
            var p2;
            var p3;
            if (!isLoop) {
                p0 = points[idx === 0 ? idx : idx - 1];
                p2 = points[idx > len - 2 ? len - 1 : idx + 1];
                p3 = points[idx > len - 3 ? len - 1 : idx + 2];
            } else {
                p0 = points[(idx - 1 + len) % len];
                p2 = points[(idx + 1) % len];
                p3 = points[(idx + 2) % len];
            }
            var w2 = w * w;
            var w3 = w * w2;
            ret.push([
                interpolate(p0[0], p1[0], p2[0], p3[0], w, w2, w3),
                interpolate(p0[1], p1[1], p2[1], p3[1], w, w2, w3)
            ]);
        }
        return ret;
    };
});
define('zrender/graphic/helper/smoothBezier', ['require', '../../core/vector'], function (require) {
    var vec2 = require('../../core/vector');
    var v2Min = vec2.min;
    var v2Max = vec2.max;
    var v2Scale = vec2.scale;
    var v2Distance = vec2.distance;
    var v2Add = vec2.add;
    /**
     * 贝塞尔平滑曲线
     * @alias module:zrender/shape/util/smoothBezier
     * @param {Array} points 线段顶点数组
     * @param {number} smooth 平滑等级, 0-1
     * @param {boolean} isLoop
     * @param {Array} constraint 将计算出来的控制点约束在一个包围盒内
     *                           比如 [[0, 0], [100, 100]], 这个包围盒会与
     *                           整个折线的包围盒做一个并集用来约束控制点。
     * @param {Array} 计算出来的控制点数组
     */
    return function (points, smooth, isLoop, constraint) {
        var cps = [];
        var v = [];
        var v1 = [];
        var v2 = [];
        var prevPoint;
        var nextPoint;
        var min, max;
        if (constraint) {
            min = [
                Infinity,
                Infinity
            ];
            max = [
                -Infinity,
                -Infinity
            ];
            for (var i = 0, len = points.length; i < len; i++) {
                v2Min(min, min, points[i]);
                v2Max(max, max, points[i]);
            }
            // 与指定的包围盒做并集
            v2Min(min, min, constraint[0]);
            v2Max(max, max, constraint[1]);
        }
        for (var i = 0, len = points.length; i < len; i++) {
            var point = points[i];
            if (isLoop) {
                prevPoint = points[i ? i - 1 : len - 1];
                nextPoint = points[(i + 1) % len];
            } else {
                if (i === 0 || i === len - 1) {
                    cps.push(vec2.clone(points[i]));
                    continue;
                } else {
                    prevPoint = points[i - 1];
                    nextPoint = points[i + 1];
                }
            }
            vec2.sub(v, nextPoint, prevPoint);
            // use degree to scale the handle length
            v2Scale(v, v, smooth);
            var d0 = v2Distance(point, prevPoint);
            var d1 = v2Distance(point, nextPoint);
            var sum = d0 + d1;
            if (sum !== 0) {
                d0 /= sum;
                d1 /= sum;
            }
            v2Scale(v1, v, -d0);
            v2Scale(v2, v, d1);
            var cp0 = v2Add([], point, v1);
            var cp1 = v2Add([], point, v2);
            if (constraint) {
                v2Max(cp0, cp0, min);
                v2Min(cp0, cp0, max);
                v2Max(cp1, cp1, min);
                v2Min(cp1, cp1, max);
            }
            cps.push(cp0);
            cps.push(cp1);
        }
        if (isLoop) {
            cps.push(cps.shift());
        }
        return cps;
    };
});
define('zrender/graphic/helper/roundRect', ['require'], function (require) {
    return {
        buildPath: function (ctx, shape) {
            var x = shape.x;
            var y = shape.y;
            var width = shape.width;
            var height = shape.height;
            var r = shape.r;
            var r1;
            var r2;
            var r3;
            var r4;
            // Convert width and height to positive for better borderRadius
            if (width < 0) {
                x = x + width;
                width = -width;
            }
            if (height < 0) {
                y = y + height;
                height = -height;
            }
            if (typeof r === 'number') {
                r1 = r2 = r3 = r4 = r;
            } else if (r instanceof Array) {
                if (r.length === 1) {
                    r1 = r2 = r3 = r4 = r[0];
                } else if (r.length === 2) {
                    r1 = r3 = r[0];
                    r2 = r4 = r[1];
                } else if (r.length === 3) {
                    r1 = r[0];
                    r2 = r4 = r[1];
                    r3 = r[2];
                } else {
                    r1 = r[0];
                    r2 = r[1];
                    r3 = r[2];
                    r4 = r[3];
                }
            } else {
                r1 = r2 = r3 = r4 = 0;
            }
            var total;
            if (r1 + r2 > width) {
                total = r1 + r2;
                r1 *= width / total;
                r2 *= width / total;
            }
            if (r3 + r4 > width) {
                total = r3 + r4;
                r3 *= width / total;
                r4 *= width / total;
            }
            if (r2 + r3 > height) {
                total = r2 + r3;
                r2 *= height / total;
                r3 *= height / total;
            }
            if (r1 + r4 > height) {
                total = r1 + r4;
                r1 *= height / total;
                r4 *= height / total;
            }
            ctx.moveTo(x + r1, y);
            ctx.lineTo(x + width - r2, y);
            r2 !== 0 && ctx.quadraticCurveTo(x + width, y, x + width, y + r2);
            ctx.lineTo(x + width, y + height - r3);
            r3 !== 0 && ctx.quadraticCurveTo(x + width, y + height, x + width - r3, y + height);
            ctx.lineTo(x + r4, y + height);
            r4 !== 0 && ctx.quadraticCurveTo(x, y + height, x, y + height - r4);
            ctx.lineTo(x, y + r1);
            r1 !== 0 && ctx.quadraticCurveTo(x, y, x + r1, y);
        }
    };
});
define('zrender/graphic/Gradient', ['require'], function (require) {
    /**
     * @param {Array.<Object>} colorStops
     */
    var Gradient = function (colorStops) {
        this.colorStops = colorStops || [];
    };
    Gradient.prototype = {
        constructor: Gradient,
        addColorStop: function (offset, color) {
            this.colorStops.push({
                offset: offset,
                color: color
            });
        }
    };
    return Gradient;
});
define('zrender/Handler', ['require', './core/util', './mixin/Draggable', './mixin/Eventful'], function (require) {
    'use strict';
    var util = require('./core/util');
    var Draggable = require('./mixin/Draggable');
    var Eventful = require('./mixin/Eventful');
    function makeEventPacket(eveType, target, event) {
        return {
            type: eveType,
            event: event,
            target: target,
            cancelBubble: false,
            offsetX: event.zrX,
            offsetY: event.zrY,
            gestureEvent: event.gestureEvent,
            pinchX: event.pinchX,
            pinchY: event.pinchY,
            pinchScale: event.pinchScale,
            wheelDelta: event.zrDelta,
            zrByTouch: event.zrByTouch
        };
    }
    function EmptyProxy() {
    }
    EmptyProxy.prototype.dispose = function () {
    };
    var handlerNames = [
            'click',
            'dblclick',
            'mousewheel',
            'mouseout',
            'mouseup',
            'mousedown',
            'mousemove',
            'contextmenu'
        ];
    /**
     * @alias module:zrender/Handler
     * @constructor
     * @extends module:zrender/mixin/Eventful
     * @param {module:zrender/Storage} storage Storage instance.
     * @param {module:zrender/Painter} painter Painter instance.
     * @param {module:zrender/dom/HandlerProxy} proxy HandlerProxy instance.
     * @param {HTMLElement} painterRoot painter.root (not painter.getViewportRoot()).
     */
    var Handler = function (storage, painter, proxy, painterRoot) {
        Eventful.call(this);
        this.storage = storage;
        this.painter = painter;
        this.painterRoot = painterRoot;
        proxy = proxy || new EmptyProxy();
        /**
         * Proxy of event. can be Dom, WebGLSurface, etc.
         */
        this.proxy = proxy;
        // Attach handler
        proxy.handler = this;
        /**
         * @private
         * @type {boolean}
         */
        this._hovered;
        /**
         * @private
         * @type {Date}
         */
        this._lastTouchMoment;
        /**
         * @private
         * @type {number}
         */
        this._lastX;
        /**
         * @private
         * @type {number}
         */
        this._lastY;
        Draggable.call(this);
        util.each(handlerNames, function (name) {
            proxy.on && proxy.on(name, this[name], this);
        }, this);
    };
    Handler.prototype = {
        constructor: Handler,
        mousemove: function (event) {
            var x = event.zrX;
            var y = event.zrY;
            var hovered = this.findHover(x, y, null);
            var lastHovered = this._hovered;
            var proxy = this.proxy;
            this._hovered = hovered;
            proxy.setCursor && proxy.setCursor(hovered ? hovered.cursor : 'default');
            // Mouse out on previous hovered element
            if (lastHovered && hovered !== lastHovered && lastHovered.__zr) {
                this.dispatchToElement(lastHovered, 'mouseout', event);
            }
            // Mouse moving on one element
            this.dispatchToElement(hovered, 'mousemove', event);
            // Mouse over on a new element
            if (hovered && hovered !== lastHovered) {
                this.dispatchToElement(hovered, 'mouseover', event);
            }
        },
        mouseout: function (event) {
            this.dispatchToElement(this._hovered, 'mouseout', event);
            // There might be some doms created by upper layer application
            // at the same level of painter.getViewportRoot() (e.g., tooltip
            // dom created by echarts), where 'globalout' event should not
            // be triggered when mouse enters these doms. (But 'mouseout'
            // should be triggered at the original hovered element as usual).
            var element = event.toElement || event.relatedTarget;
            var innerDom;
            do {
                element = element && element.parentNode;
            } while (element && element.nodeType != 9 && !(innerDom = element === this.painterRoot));
            !innerDom && this.trigger('globalout', { event: event });
        },
        resize: function (event) {
            this._hovered = null;
        },
        dispatch: function (eventName, eventArgs) {
            var handler = this[eventName];
            handler && handler.call(this, eventArgs);
        },
        dispose: function () {
            this.proxy.dispose();
            this.storage = this.proxy = this.painter = null;
        },
        setCursorStyle: function (cursorStyle) {
            var proxy = this.proxy;
            proxy.setCursor && proxy.setCursor(cursorStyle);
        },
        dispatchToElement: function (targetEl, eventName, event) {
            var eventHandler = 'on' + eventName;
            var eventPacket = makeEventPacket(eventName, targetEl, event);
            var el = targetEl;
            while (el) {
                el[eventHandler] && (eventPacket.cancelBubble = el[eventHandler].call(el, eventPacket));
                el.trigger(eventName, eventPacket);
                el = el.parent;
                if (eventPacket.cancelBubble) {
                    break;
                }
            }
            if (!eventPacket.cancelBubble) {
                // 冒泡到顶级 zrender 对象
                this.trigger(eventName, eventPacket);
                // 分发事件到用户自定义层
                // 用户有可能在全局 click 事件中 dispose，所以需要判断下 painter 是否存在
                this.painter && this.painter.eachOtherLayer(function (layer) {
                    if (typeof layer[eventHandler] == 'function') {
                        layer[eventHandler].call(layer, eventPacket);
                    }
                    if (layer.trigger) {
                        layer.trigger(eventName, eventPacket);
                    }
                });
            }
        },
        findHover: function (x, y, exclude) {
            var list = this.storage.getDisplayList();
            for (var i = list.length - 1; i >= 0; i--) {
                if (!list[i].silent && list[i] !== exclude && !list[i].ignore && isHover(list[i], x, y)) {
                    return list[i];
                }
            }
        }
    };
    // Common handlers
    util.each([
        'click',
        'mousedown',
        'mouseup',
        'mousewheel',
        'dblclick',
        'contextmenu'
    ], function (name) {
        Handler.prototype[name] = function (event) {
            // Find hover again to avoid click event is dispatched manually. Or click is triggered without mouseover
            var hovered = this.findHover(event.zrX, event.zrY, null);
            if (name === 'mousedown') {
                this._downel = hovered;
                // In case click triggered before mouseup
                this._upel = hovered;
            } else if (name === 'mosueup') {
                this._upel = hovered;
            } else if (name === 'click') {
                if (this._downel !== this._upel) {
                    return;
                }
            }
            this.dispatchToElement(hovered, name, event);
        };
    });
    function isHover(displayable, x, y) {
        if (displayable[displayable.rectHover ? 'rectContain' : 'contain'](x, y)) {
            var el = displayable;
            while (el) {
                // If ancestor is silent or clipped by ancestor
                if (el.silent || el.clipPath && !el.clipPath.contain(x, y)) {
                    return false;
                }
                el = el.parent;
            }
            return true;
        }
        return false;
    }
    util.mixin(Handler, Eventful);
    util.mixin(Handler, Draggable);
    return Handler;
});
define('zrender/Storage', ['require', './core/util', './core/env', './container/Group', './core/timsort'], function (require) {
    'use strict';
    var util = require('./core/util');
    var env = require('./core/env');
    var Group = require('./container/Group');
    // Use timsort because in most case elements are partially sorted
    // https://jsfiddle.net/pissang/jr4x7mdm/8/
    var timsort = require('./core/timsort');
    function shapeCompareFunc(a, b) {
        if (a.zlevel === b.zlevel) {
            if (a.z === b.z) {
                // if (a.z2 === b.z2) {
                //     // FIXME Slow has renderidx compare
                //     // http://stackoverflow.com/questions/20883421/sorting-in-javascript-should-every-compare-function-have-a-return-0-statement
                //     // https://github.com/v8/v8/blob/47cce544a31ed5577ffe2963f67acb4144ee0232/src/js/array.js#L1012
                //     return a.__renderidx - b.__renderidx;
                // }
                return a.z2 - b.z2;
            }
            return a.z - b.z;
        }
        return a.zlevel - b.zlevel;
    }
    /**
     * 内容仓库 (M)
     * @alias module:zrender/Storage
     * @constructor
     */
    var Storage = function () {
        // 所有常规形状，id索引的map
        this._elements = {};
        this._roots = [];
        this._displayList = [];
        this._displayListLen = 0;
    };
    Storage.prototype = {
        constructor: Storage,
        traverse: function (cb, context) {
            for (var i = 0; i < this._roots.length; i++) {
                this._roots[i].traverse(cb, context);
            }
        },
        getDisplayList: function (update, includeIgnore) {
            includeIgnore = includeIgnore || false;
            if (update) {
                this.updateDisplayList(includeIgnore);
            }
            return this._displayList;
        },
        updateDisplayList: function (includeIgnore) {
            this._displayListLen = 0;
            var roots = this._roots;
            var displayList = this._displayList;
            for (var i = 0, len = roots.length; i < len; i++) {
                this._updateAndAddDisplayable(roots[i], null, includeIgnore);
            }
            displayList.length = this._displayListLen;
            // for (var i = 0, len = displayList.length; i < len; i++) {
            //     displayList[i].__renderidx = i;
            // }
            // displayList.sort(shapeCompareFunc);
            env.canvasSupported && timsort(displayList, shapeCompareFunc);
        },
        _updateAndAddDisplayable: function (el, clipPaths, includeIgnore) {
            if (el.ignore && !includeIgnore) {
                return;
            }
            el.beforeUpdate();
            if (el.__dirty) {
                el.update();
            }
            el.afterUpdate();
            var clipPath = el.clipPath;
            if (clipPath) {
                // clipPath 的变换是基于 group 的变换
                clipPath.parent = el;
                clipPath.updateTransform();
                // FIXME 效率影响
                if (clipPaths) {
                    clipPaths = clipPaths.slice();
                    clipPaths.push(clipPath);
                } else {
                    clipPaths = [clipPath];
                }
            }
            if (el.isGroup) {
                var children = el._children;
                for (var i = 0; i < children.length; i++) {
                    var child = children[i];
                    // Force to mark as dirty if group is dirty
                    // FIXME __dirtyPath ?
                    if (el.__dirty) {
                        child.__dirty = true;
                    }
                    this._updateAndAddDisplayable(child, clipPaths, includeIgnore);
                }
                // Mark group clean here
                el.__dirty = false;
            } else {
                el.__clipPaths = clipPaths;
                this._displayList[this._displayListLen++] = el;
            }
        },
        addRoot: function (el) {
            // Element has been added
            if (this._elements[el.id]) {
                return;
            }
            if (el instanceof Group) {
                el.addChildrenToStorage(this);
            }
            this.addToMap(el);
            this._roots.push(el);
        },
        delRoot: function (elId) {
            if (elId == null) {
                // 不指定elId清空
                for (var i = 0; i < this._roots.length; i++) {
                    var root = this._roots[i];
                    if (root instanceof Group) {
                        root.delChildrenFromStorage(this);
                    }
                }
                this._elements = {};
                this._roots = [];
                this._displayList = [];
                this._displayListLen = 0;
                return;
            }
            if (elId instanceof Array) {
                for (var i = 0, l = elId.length; i < l; i++) {
                    this.delRoot(elId[i]);
                }
                return;
            }
            var el;
            if (typeof elId == 'string') {
                el = this._elements[elId];
            } else {
                el = elId;
            }
            var idx = util.indexOf(this._roots, el);
            if (idx >= 0) {
                this.delFromMap(el.id);
                this._roots.splice(idx, 1);
                if (el instanceof Group) {
                    el.delChildrenFromStorage(this);
                }
            }
        },
        addToMap: function (el) {
            if (el instanceof Group) {
                el.__storage = this;
            }
            el.dirty(false);
            this._elements[el.id] = el;
            return this;
        },
        get: function (elId) {
            return this._elements[elId];
        },
        delFromMap: function (elId) {
            var elements = this._elements;
            var el = elements[elId];
            if (el) {
                delete elements[elId];
                if (el instanceof Group) {
                    el.__storage = null;
                }
            }
            return this;
        },
        dispose: function () {
            this._elements = this._renderList = this._roots = null;
        },
        displayableSortFunc: shapeCompareFunc
    };
    return Storage;
});
define('zrender/animation/Animation', ['require', '../core/util', '../core/event', './requestAnimationFrame', './Animator'], function (require) {
    'use strict';
    var util = require('../core/util');
    var Dispatcher = require('../core/event').Dispatcher;
    var requestAnimationFrame = require('./requestAnimationFrame');
    var Animator = require('./Animator');
    /**
     * @typedef {Object} IZRenderStage
     * @property {Function} update
     */
    /**
     * @alias module:zrender/animation/Animation
     * @constructor
     * @param {Object} [options]
     * @param {Function} [options.onframe]
     * @param {IZRenderStage} [options.stage]
     * @example
     *     var animation = new Animation();
     *     var obj = {
     *         x: 100,
     *         y: 100
     *     };
     *     animation.animate(node.position)
     *         .when(1000, {
     *             x: 500,
     *             y: 500
     *         })
     *         .when(2000, {
     *             x: 100,
     *             y: 100
     *         })
     *         .start('spline');
     */
    var Animation = function (options) {
        options = options || {};
        this.stage = options.stage || {};
        this.onframe = options.onframe || function () {
        };
        // private properties
        this._clips = [];
        this._running = false;
        this._time;
        this._pausedTime;
        this._pauseStart;
        this._paused = false;
        Dispatcher.call(this);
    };
    Animation.prototype = {
        constructor: Animation,
        addClip: function (clip) {
            this._clips.push(clip);
        },
        addAnimator: function (animator) {
            animator.animation = this;
            var clips = animator.getClips();
            for (var i = 0; i < clips.length; i++) {
                this.addClip(clips[i]);
            }
        },
        removeClip: function (clip) {
            var idx = util.indexOf(this._clips, clip);
            if (idx >= 0) {
                this._clips.splice(idx, 1);
            }
        },
        removeAnimator: function (animator) {
            var clips = animator.getClips();
            for (var i = 0; i < clips.length; i++) {
                this.removeClip(clips[i]);
            }
            animator.animation = null;
        },
        _update: function () {
            var time = new Date().getTime() - this._pausedTime;
            var delta = time - this._time;
            var clips = this._clips;
            var len = clips.length;
            var deferredEvents = [];
            var deferredClips = [];
            for (var i = 0; i < len; i++) {
                var clip = clips[i];
                var e = clip.step(time);
                // Throw out the events need to be called after
                // stage.update, like destroy
                if (e) {
                    deferredEvents.push(e);
                    deferredClips.push(clip);
                }
            }
            // Remove the finished clip
            for (var i = 0; i < len;) {
                if (clips[i]._needsRemove) {
                    clips[i] = clips[len - 1];
                    clips.pop();
                    len--;
                } else {
                    i++;
                }
            }
            len = deferredEvents.length;
            for (var i = 0; i < len; i++) {
                deferredClips[i].fire(deferredEvents[i]);
            }
            this._time = time;
            this.onframe(delta);
            this.trigger('frame', delta);
            if (this.stage.update) {
                this.stage.update();
            }
        },
        _startLoop: function () {
            var self = this;
            this._running = true;
            function step() {
                if (self._running) {
                    requestAnimationFrame(step);
                    !self._paused && self._update();
                }
            }
            requestAnimationFrame(step);
        },
        start: function () {
            this._time = new Date().getTime();
            this._pausedTime = 0;
            this._startLoop();
        },
        stop: function () {
            this._running = false;
        },
        pause: function () {
            if (!this._paused) {
                this._pauseStart = new Date().getTime();
                this._paused = true;
            }
        },
        resume: function () {
            if (this._paused) {
                this._pausedTime += new Date().getTime() - this._pauseStart;
                this._paused = false;
            }
        },
        clear: function () {
            this._clips = [];
        },
        animate: function (target, options) {
            options = options || {};
            var animator = new Animator(target, options.loop, options.getter, options.setter);
            return animator;
        }
    };
    util.mixin(Animation, Dispatcher);
    return Animation;
});
define('zrender/dom/HandlerProxy', ['require', '../core/event', '../core/util', '../mixin/Eventful', '../core/env', '../core/GestureMgr'], function (require) {
    var eventTool = require('../core/event');
    var zrUtil = require('../core/util');
    var Eventful = require('../mixin/Eventful');
    var env = require('../core/env');
    var GestureMgr = require('../core/GestureMgr');
    var addEventListener = eventTool.addEventListener;
    var removeEventListener = eventTool.removeEventListener;
    var normalizeEvent = eventTool.normalizeEvent;
    var TOUCH_CLICK_DELAY = 300;
    var mouseHandlerNames = [
            'click',
            'dblclick',
            'mousewheel',
            'mouseout',
            'mouseup',
            'mousedown',
            'mousemove',
            'contextmenu'
        ];
    var touchHandlerNames = [
            'touchstart',
            'touchend',
            'touchmove'
        ];
    function eventNameFix(name) {
        return name === 'mousewheel' && env.browser.firefox ? 'DOMMouseScroll' : name;
    }
    function processGesture(proxy, event, stage) {
        var gestureMgr = proxy._gestureMgr;
        stage === 'start' && gestureMgr.clear();
        var gestureInfo = gestureMgr.recognize(event, proxy.handler.findHover(event.zrX, event.zrY, null), proxy.dom);
        stage === 'end' && gestureMgr.clear();
        if (gestureInfo) {
            // eventTool.stop(event);
            var type = gestureInfo.type;
            event.gestureEvent = type;
            proxy.handler.dispatchToElement(gestureInfo.target, type, gestureInfo.event);
        }
    }
    /**
     * Prevent mouse event from being dispatched after Touch Events action
     * @see <https://github.com/deltakosh/handjs/blob/master/src/hand.base.js>
     * 1. Mobile browsers dispatch mouse events 300ms after touchend.
     * 2. Chrome for Android dispatch mousedown for long-touch about 650ms
     * Result: Blocking Mouse Events for 700ms.
     */
    function setTouchTimer(instance) {
        instance._touching = true;
        clearTimeout(instance._touchTimer);
        instance._touchTimer = setTimeout(function () {
            instance._touching = false;
        }, 700);
    }
    function useTouchEvent() {
        return env.touchEventsSupported;
    }
    var domHandlers = {
            mousemove: function (event) {
                event = normalizeEvent(this.dom, event);
                this.trigger('mousemove', event);
            },
            mouseout: function (event) {
                event = normalizeEvent(this.dom, event);
                var element = event.toElement || event.relatedTarget;
                if (element != this.dom) {
                    while (element && element.nodeType != 9) {
                        // 忽略包含在root中的dom引起的mouseOut
                        if (element === this.dom) {
                            return;
                        }
                        element = element.parentNode;
                    }
                }
                this.trigger('mouseout', event);
            },
            touchstart: function (event) {
                // Default mouse behaviour should not be disabled here.
                // For example, page may needs to be slided.
                event = normalizeEvent(this.dom, event);
                // Mark touch, which is useful in distinguish touch and
                // mouse event in upper applicatoin.
                event.zrByTouch = true;
                this._lastTouchMoment = new Date();
                processGesture(this, event, 'start');
                // In touch device, trigger `mousemove`(`mouseover`) should
                // be triggered.
                domHandlers.mousemove.call(this, event);
                domHandlers.mousedown.call(this, event);
                setTouchTimer(this);
            },
            touchmove: function (event) {
                event = normalizeEvent(this.dom, event);
                // Mark touch, which is useful in distinguish touch and
                // mouse event in upper applicatoin.
                event.zrByTouch = true;
                processGesture(this, event, 'change');
                // Mouse move should always be triggered no matter whether
                // there is gestrue event, because mouse move and pinch may
                // be used at the same time.
                domHandlers.mousemove.call(this, event);
                setTouchTimer(this);
            },
            touchend: function (event) {
                event = normalizeEvent(this.dom, event);
                // Mark touch, which is useful in distinguish touch and
                // mouse event in upper applicatoin.
                event.zrByTouch = true;
                processGesture(this, event, 'end');
                domHandlers.mouseup.call(this, event);
                // Do not trigger `mouseout` here, in spite of `mousemove`(`mouseover`) is
                // triggered in `touchstart`. This seems to be illogical, but by this mechanism,
                // we can conveniently implement "hover style" in both PC and touch device just
                // by listening to `mouseover` to add "hover style" and listening to `mouseout`
                // to remove "hover style" on an element, without any additional code for
                // compatibility. (`mouseout` will not be triggered in `touchend`, so "hover
                // style" will remain for user view)
                // click event should always be triggered no matter whether
                // there is gestrue event. System click can not be prevented.
                if (+new Date() - this._lastTouchMoment < TOUCH_CLICK_DELAY) {
                    domHandlers.click.call(this, event);
                }
                setTouchTimer(this);
            }
        };
    // Common handlers
    zrUtil.each([
        'click',
        'mousedown',
        'mouseup',
        'mousewheel',
        'dblclick',
        'contextmenu'
    ], function (name) {
        domHandlers[name] = function (event) {
            event = normalizeEvent(this.dom, event);
            this.trigger(name, event);
        };
    });
    /**
     * 为控制类实例初始化dom 事件处理函数
     *
     * @inner
     * @param {module:zrender/Handler} instance 控制类实例
     */
    function initDomHandler(instance) {
        for (var i = 0; i < touchHandlerNames.length; i++) {
            var name = touchHandlerNames[i];
            instance._handlers[name] = zrUtil.bind(domHandlers[name], instance);
        }
        for (var i = 0; i < mouseHandlerNames.length; i++) {
            var name = mouseHandlerNames[i];
            instance._handlers[name] = makeMouseHandler(domHandlers[name], instance);
        }
        function makeMouseHandler(fn, instance) {
            return function () {
                if (instance._touching) {
                    return;
                }
                return fn.apply(instance, arguments);
            };
        }
    }
    function HandlerDomProxy(dom) {
        Eventful.call(this);
        this.dom = dom;
        /**
         * @private
         * @type {boolean}
         */
        this._touching = false;
        /**
         * @private
         * @type {number}
         */
        this._touchTimer;
        /**
         * @private
         * @type {module:zrender/core/GestureMgr}
         */
        this._gestureMgr = new GestureMgr();
        this._handlers = {};
        initDomHandler(this);
        if (useTouchEvent()) {
            mountHandlers(touchHandlerNames, this);    // Handler of 'mouseout' event is needed in touch mode, which will be mounted below.
                                                       // addEventListener(root, 'mouseout', this._mouseoutHandler);
        }
        // Considering some devices that both enable touch and mouse event (like MS Surface
        // and lenovo X240, @see #2350), we make mouse event be always listened, otherwise
        // mouse event can not be handle in those devices.
        mountHandlers(mouseHandlerNames, this);
        function mountHandlers(handlerNames, instance) {
            zrUtil.each(handlerNames, function (name) {
                addEventListener(dom, eventNameFix(name), instance._handlers[name]);
            }, instance);
        }
    }
    var handlerDomProxyProto = HandlerDomProxy.prototype;
    handlerDomProxyProto.dispose = function () {
        var handlerNames = mouseHandlerNames.concat(touchHandlerNames);
        for (var i = 0; i < handlerNames.length; i++) {
            var name = handlerNames[i];
            removeEventListener(this.dom, eventNameFix(name), this._handlers[name]);
        }
    };
    handlerDomProxyProto.setCursor = function (cursorStyle) {
        this.dom.style.cursor = cursorStyle || 'default';
    };
    zrUtil.mixin(HandlerDomProxy, Eventful);
    return HandlerDomProxy;
});
define('zrender/Painter', ['require', './config', './core/util', './core/log', './core/BoundingRect', './core/timsort', './Layer', './animation/requestAnimationFrame', './graphic/Image'], function (require) {
    'use strict';
    var config = require('./config');
    var util = require('./core/util');
    var log = require('./core/log');
    var BoundingRect = require('./core/BoundingRect');
    var timsort = require('./core/timsort');
    var Layer = require('./Layer');
    var requestAnimationFrame = require('./animation/requestAnimationFrame');
    // PENDIGN
    // Layer exceeds MAX_PROGRESSIVE_LAYER_NUMBER may have some problem when flush directly second time.
    //
    // Maximum progressive layer. When exceeding this number. All elements will be drawed in the last layer.
    var MAX_PROGRESSIVE_LAYER_NUMBER = 5;
    function parseInt10(val) {
        return parseInt(val, 10);
    }
    function isLayerValid(layer) {
        if (!layer) {
            return false;
        }
        if (layer.isBuildin) {
            return true;
        }
        if (typeof layer.resize !== 'function' || typeof layer.refresh !== 'function') {
            return false;
        }
        return true;
    }
    function preProcessLayer(layer) {
        layer.__unusedCount++;
    }
    function postProcessLayer(layer) {
        if (layer.__unusedCount == 1) {
            layer.clear();
        }
    }
    var tmpRect = new BoundingRect(0, 0, 0, 0);
    var viewRect = new BoundingRect(0, 0, 0, 0);
    function isDisplayableCulled(el, width, height) {
        tmpRect.copy(el.getBoundingRect());
        if (el.transform) {
            tmpRect.applyTransform(el.transform);
        }
        viewRect.width = width;
        viewRect.height = height;
        return !tmpRect.intersect(viewRect);
    }
    function isClipPathChanged(clipPaths, prevClipPaths) {
        if (clipPaths == prevClipPaths) {
            // Can both be null or undefined
            return false;
        }
        if (!clipPaths || !prevClipPaths || clipPaths.length !== prevClipPaths.length) {
            return true;
        }
        for (var i = 0; i < clipPaths.length; i++) {
            if (clipPaths[i] !== prevClipPaths[i]) {
                return true;
            }
        }
    }
    function doClip(clipPaths, ctx) {
        for (var i = 0; i < clipPaths.length; i++) {
            var clipPath = clipPaths[i];
            var path = clipPath.path;
            clipPath.setTransform(ctx);
            path.beginPath(ctx);
            clipPath.buildPath(path, clipPath.shape);
            ctx.clip();
            // Transform back
            clipPath.restoreTransform(ctx);
        }
    }
    function createRoot(width, height) {
        var domRoot = document.createElement('div');
        // domRoot.onselectstart = returnFalse; // 避免页面选中的尴尬
        domRoot.style.cssText = [
            'position:relative',
            'overflow:hidden',
            'width:' + width + 'px',
            'height:' + height + 'px',
            'padding:0',
            'margin:0',
            'border-width:0'
        ].join(';') + ';';
        return domRoot;
    }
    /**
     * @alias module:zrender/Painter
     * @constructor
     * @param {HTMLElement} root 绘图容器
     * @param {module:zrender/Storage} storage
     * @param {Ojbect} opts
     */
    var Painter = function (root, storage, opts) {
        // In node environment using node-canvas
        var singleCanvas = !root.nodeName || root.nodeName.toUpperCase() === 'CANVAS';
        this._opts = opts = util.extend({}, opts || {});
        /**
         * @type {number}
         */
        this.dpr = opts.devicePixelRatio || config.devicePixelRatio;
        /**
         * @type {boolean}
         * @private
         */
        this._singleCanvas = singleCanvas;
        /**
         * 绘图容器
         * @type {HTMLElement}
         */
        this.root = root;
        var rootStyle = root.style;
        if (rootStyle) {
            rootStyle['-webkit-tap-highlight-color'] = 'transparent';
            rootStyle['-webkit-user-select'] = rootStyle['user-select'] = rootStyle['-webkit-touch-callout'] = 'none';
            root.innerHTML = '';
        }
        /**
         * @type {module:zrender/Storage}
         */
        this.storage = storage;
        /**
         * @type {Array.<number>}
         * @private
         */
        var zlevelList = this._zlevelList = [];
        /**
         * @type {Object.<string, module:zrender/Layer>}
         * @private
         */
        var layers = this._layers = {};
        /**
         * @type {Object.<string, Object>}
         * @type {private}
         */
        this._layerConfig = {};
        if (!singleCanvas) {
            this._width = this._getSize(0);
            this._height = this._getSize(1);
            var domRoot = this._domRoot = createRoot(this._width, this._height);
            root.appendChild(domRoot);
        } else {
            // Use canvas width and height directly
            var width = root.width;
            var height = root.height;
            this._width = width;
            this._height = height;
            // Create layer if only one given canvas
            // Device pixel ratio is fixed to 1 because given canvas has its specified width and height
            var mainLayer = new Layer(root, this, 1);
            mainLayer.initContext();
            // FIXME Use canvas width and height
            // mainLayer.resize(width, height);
            layers[0] = mainLayer;
            zlevelList.push(0);
        }
        this.pathToImage = this._createPathToImage();
        // Layers for progressive rendering
        this._progressiveLayers = [];
        /**
         * @type {module:zrender/Layer}
         * @private
         */
        this._hoverlayer;
        this._hoverElements = [];
    };
    Painter.prototype = {
        constructor: Painter,
        isSingleCanvas: function () {
            return this._singleCanvas;
        },
        getViewportRoot: function () {
            return this._singleCanvas ? this._layers[0].dom : this._domRoot;
        },
        refresh: function (paintAll) {
            var list = this.storage.getDisplayList(true);
            var zlevelList = this._zlevelList;
            this._paintList(list, paintAll);
            // Paint custum layers
            for (var i = 0; i < zlevelList.length; i++) {
                var z = zlevelList[i];
                var layer = this._layers[z];
                if (!layer.isBuildin && layer.refresh) {
                    layer.refresh();
                }
            }
            this.refreshHover();
            if (this._progressiveLayers.length) {
                this._startProgessive();
            }
            return this;
        },
        addHover: function (el, hoverStyle) {
            if (el.__hoverMir) {
                return;
            }
            var elMirror = new el.constructor({
                    style: el.style,
                    shape: el.shape
                });
            elMirror.__from = el;
            el.__hoverMir = elMirror;
            elMirror.setStyle(hoverStyle);
            this._hoverElements.push(elMirror);
        },
        removeHover: function (el) {
            var elMirror = el.__hoverMir;
            var hoverElements = this._hoverElements;
            var idx = util.indexOf(hoverElements, elMirror);
            if (idx >= 0) {
                hoverElements.splice(idx, 1);
            }
            el.__hoverMir = null;
        },
        clearHover: function (el) {
            var hoverElements = this._hoverElements;
            for (var i = 0; i < hoverElements.length; i++) {
                var from = hoverElements[i].__from;
                if (from) {
                    from.__hoverMir = null;
                }
            }
            hoverElements.length = 0;
        },
        refreshHover: function () {
            var hoverElements = this._hoverElements;
            var len = hoverElements.length;
            var hoverLayer = this._hoverlayer;
            hoverLayer && hoverLayer.clear();
            if (!len) {
                return;
            }
            timsort(hoverElements, this.storage.displayableSortFunc);
            // Use a extream large zlevel
            // FIXME?
            if (!hoverLayer) {
                hoverLayer = this._hoverlayer = this.getLayer(100000);
            }
            var scope = {};
            hoverLayer.ctx.save();
            for (var i = 0; i < len;) {
                var el = hoverElements[i];
                var originalEl = el.__from;
                // Original el is removed
                // PENDING
                if (!(originalEl && originalEl.__zr)) {
                    hoverElements.splice(i, 1);
                    originalEl.__hoverMir = null;
                    len--;
                    continue;
                }
                i++;
                // Use transform
                // FIXME style and shape ?
                if (!originalEl.invisible) {
                    el.transform = originalEl.transform;
                    el.invTransform = originalEl.invTransform;
                    el.__clipPaths = originalEl.__clipPaths;
                    // el.
                    this._doPaintEl(el, hoverLayer, true, scope);
                }
            }
            hoverLayer.ctx.restore();
        },
        _startProgessive: function () {
            var self = this;
            if (!self._furtherProgressive) {
                return;
            }
            // Use a token to stop progress steps triggered by
            // previous zr.refresh calling.
            var token = self._progressiveToken = +new Date();
            self._progress++;
            requestAnimationFrame(step);
            function step() {
                // In case refreshed or disposed
                if (token === self._progressiveToken && self.storage) {
                    self._doPaintList(self.storage.getDisplayList());
                    if (self._furtherProgressive) {
                        self._progress++;
                        requestAnimationFrame(step);
                    } else {
                        self._progressiveToken = -1;
                    }
                }
            }
        },
        _clearProgressive: function () {
            this._progressiveToken = -1;
            this._progress = 0;
            util.each(this._progressiveLayers, function (layer) {
                layer.__dirty && layer.clear();
            });
        },
        _paintList: function (list, paintAll) {
            if (paintAll == null) {
                paintAll = false;
            }
            this._updateLayerStatus(list);
            this._clearProgressive();
            this.eachBuildinLayer(preProcessLayer);
            this._doPaintList(list, paintAll);
            this.eachBuildinLayer(postProcessLayer);
        },
        _doPaintList: function (list, paintAll) {
            var currentLayer;
            var currentZLevel;
            var ctx;
            // var invTransform = [];
            var scope;
            var progressiveLayerIdx = 0;
            var currentProgressiveLayer;
            var width = this._width;
            var height = this._height;
            var layerProgress;
            var frame = this._progress;
            function flushProgressiveLayer(layer) {
                var dpr = ctx.dpr || 1;
                ctx.save();
                ctx.globalAlpha = 1;
                ctx.shadowBlur = 0;
                // Avoid layer don't clear in next progressive frame
                currentLayer.__dirty = true;
                ctx.setTransform(1, 0, 0, 1, 0, 0);
                ctx.drawImage(layer.dom, 0, 0, width * dpr, height * dpr);
                ctx.restore();
            }
            for (var i = 0, l = list.length; i < l; i++) {
                var el = list[i];
                var elZLevel = this._singleCanvas ? 0 : el.zlevel;
                var elFrame = el.__frame;
                // Flush at current context
                // PENDING
                if (elFrame < 0 && currentProgressiveLayer) {
                    flushProgressiveLayer(currentProgressiveLayer);
                    currentProgressiveLayer = null;
                }
                // Change draw layer
                if (currentZLevel !== elZLevel) {
                    if (ctx) {
                        ctx.restore();
                    }
                    // Reset scope
                    scope = {};
                    // Only 0 zlevel if only has one canvas
                    currentZLevel = elZLevel;
                    currentLayer = this.getLayer(currentZLevel);
                    if (!currentLayer.isBuildin) {
                        log('ZLevel ' + currentZLevel + ' has been used by unkown layer ' + currentLayer.id);
                    }
                    ctx = currentLayer.ctx;
                    ctx.save();
                    // Reset the count
                    currentLayer.__unusedCount = 0;
                    if (currentLayer.__dirty || paintAll) {
                        currentLayer.clear();
                    }
                }
                if (!(currentLayer.__dirty || paintAll)) {
                    continue;
                }
                if (elFrame >= 0) {
                    // Progressive layer changed
                    if (!currentProgressiveLayer) {
                        currentProgressiveLayer = this._progressiveLayers[Math.min(progressiveLayerIdx++, MAX_PROGRESSIVE_LAYER_NUMBER - 1)];
                        currentProgressiveLayer.ctx.save();
                        currentProgressiveLayer.renderScope = {};
                        if (currentProgressiveLayer && currentProgressiveLayer.__progress > currentProgressiveLayer.__maxProgress) {
                            // flushProgressiveLayer(currentProgressiveLayer);
                            // Quick jump all progressive elements
                            // All progressive element are not dirty, jump over and flush directly
                            i = currentProgressiveLayer.__nextIdxNotProg - 1;
                            // currentProgressiveLayer = null;
                            continue;
                        }
                        layerProgress = currentProgressiveLayer.__progress;
                        if (!currentProgressiveLayer.__dirty) {
                            // Keep rendering
                            frame = layerProgress;
                        }
                        currentProgressiveLayer.__progress = frame + 1;
                    }
                    if (elFrame === frame) {
                        this._doPaintEl(el, currentProgressiveLayer, true, currentProgressiveLayer.renderScope);
                    }
                } else {
                    this._doPaintEl(el, currentLayer, paintAll, scope);
                }
                el.__dirty = false;
            }
            if (currentProgressiveLayer) {
                flushProgressiveLayer(currentProgressiveLayer);
            }
            // Restore the lastLayer ctx
            ctx && ctx.restore();
            // If still has clipping state
            // if (scope.prevElClipPaths) {
            //     ctx.restore();
            // }
            this._furtherProgressive = false;
            util.each(this._progressiveLayers, function (layer) {
                if (layer.__maxProgress >= layer.__progress) {
                    this._furtherProgressive = true;
                }
            }, this);
        },
        _doPaintEl: function (el, currentLayer, forcePaint, scope) {
            var ctx = currentLayer.ctx;
            var m = el.transform;
            if ((currentLayer.__dirty || forcePaint) && !el.invisible && el.style.opacity !== 0 && !(m && !m[0] && !m[3]) && !(el.culling && isDisplayableCulled(el, this._width, this._height))) {
                var clipPaths = el.__clipPaths;
                // Optimize when clipping on group with several elements
                if (scope.prevClipLayer !== currentLayer || isClipPathChanged(clipPaths, scope.prevElClipPaths)) {
                    // If has previous clipping state, restore from it
                    if (scope.prevElClipPaths) {
                        scope.prevClipLayer.ctx.restore();
                        scope.prevClipLayer = scope.prevElClipPaths = null;
                        // Reset prevEl since context has been restored
                        scope.prevEl = null;
                    }
                    // New clipping state
                    if (clipPaths) {
                        ctx.save();
                        doClip(clipPaths, ctx);
                        scope.prevClipLayer = currentLayer;
                        scope.prevElClipPaths = clipPaths;
                    }
                }
                el.beforeBrush && el.beforeBrush(ctx);
                el.brush(ctx, scope.prevEl || null);
                scope.prevEl = el;
                el.afterBrush && el.afterBrush(ctx);
            }
        },
        getLayer: function (zlevel) {
            if (this._singleCanvas) {
                return this._layers[0];
            }
            var layer = this._layers[zlevel];
            if (!layer) {
                // Create a new layer
                layer = new Layer('zr_' + zlevel, this, this.dpr);
                layer.isBuildin = true;
                if (this._layerConfig[zlevel]) {
                    util.merge(layer, this._layerConfig[zlevel], true);
                }
                this.insertLayer(zlevel, layer);
                // Context is created after dom inserted to document
                // Or excanvas will get 0px clientWidth and clientHeight
                layer.initContext();
            }
            return layer;
        },
        insertLayer: function (zlevel, layer) {
            var layersMap = this._layers;
            var zlevelList = this._zlevelList;
            var len = zlevelList.length;
            var prevLayer = null;
            var i = -1;
            var domRoot = this._domRoot;
            if (layersMap[zlevel]) {
                log('ZLevel ' + zlevel + ' has been used already');
                return;
            }
            // Check if is a valid layer
            if (!isLayerValid(layer)) {
                log('Layer of zlevel ' + zlevel + ' is not valid');
                return;
            }
            if (len > 0 && zlevel > zlevelList[0]) {
                for (i = 0; i < len - 1; i++) {
                    if (zlevelList[i] < zlevel && zlevelList[i + 1] > zlevel) {
                        break;
                    }
                }
                prevLayer = layersMap[zlevelList[i]];
            }
            zlevelList.splice(i + 1, 0, zlevel);
            if (prevLayer) {
                var prevDom = prevLayer.dom;
                if (prevDom.nextSibling) {
                    domRoot.insertBefore(layer.dom, prevDom.nextSibling);
                } else {
                    domRoot.appendChild(layer.dom);
                }
            } else {
                if (domRoot.firstChild) {
                    domRoot.insertBefore(layer.dom, domRoot.firstChild);
                } else {
                    domRoot.appendChild(layer.dom);
                }
            }
            layersMap[zlevel] = layer;
        },
        eachLayer: function (cb, context) {
            var zlevelList = this._zlevelList;
            var z;
            var i;
            for (i = 0; i < zlevelList.length; i++) {
                z = zlevelList[i];
                cb.call(context, this._layers[z], z);
            }
        },
        eachBuildinLayer: function (cb, context) {
            var zlevelList = this._zlevelList;
            var layer;
            var z;
            var i;
            for (i = 0; i < zlevelList.length; i++) {
                z = zlevelList[i];
                layer = this._layers[z];
                if (layer.isBuildin) {
                    cb.call(context, layer, z);
                }
            }
        },
        eachOtherLayer: function (cb, context) {
            var zlevelList = this._zlevelList;
            var layer;
            var z;
            var i;
            for (i = 0; i < zlevelList.length; i++) {
                z = zlevelList[i];
                layer = this._layers[z];
                if (!layer.isBuildin) {
                    cb.call(context, layer, z);
                }
            }
        },
        getLayers: function () {
            return this._layers;
        },
        _updateLayerStatus: function (list) {
            var layers = this._layers;
            var progressiveLayers = this._progressiveLayers;
            var elCountsLastFrame = {};
            var progressiveElCountsLastFrame = {};
            this.eachBuildinLayer(function (layer, z) {
                elCountsLastFrame[z] = layer.elCount;
                layer.elCount = 0;
                layer.__dirty = false;
            });
            util.each(progressiveLayers, function (layer, idx) {
                progressiveElCountsLastFrame[idx] = layer.elCount;
                layer.elCount = 0;
                layer.__dirty = false;
            });
            var progressiveLayerCount = 0;
            var currentProgressiveLayer;
            var lastProgressiveKey;
            var frameCount = 0;
            for (var i = 0, l = list.length; i < l; i++) {
                var el = list[i];
                var zlevel = this._singleCanvas ? 0 : el.zlevel;
                var layer = layers[zlevel];
                var elProgress = el.progressive;
                if (layer) {
                    layer.elCount++;
                    layer.__dirty = layer.__dirty || el.__dirty;
                }
                /////// Update progressive
                if (elProgress >= 0) {
                    // Fix wrong progressive sequence problem.
                    if (lastProgressiveKey !== elProgress) {
                        lastProgressiveKey = elProgress;
                        frameCount++;
                    }
                    var elFrame = el.__frame = frameCount - 1;
                    if (!currentProgressiveLayer) {
                        var idx = Math.min(progressiveLayerCount, MAX_PROGRESSIVE_LAYER_NUMBER - 1);
                        currentProgressiveLayer = progressiveLayers[idx];
                        if (!currentProgressiveLayer) {
                            currentProgressiveLayer = progressiveLayers[idx] = new Layer('progressive', this, this.dpr);
                            currentProgressiveLayer.initContext();
                        }
                        currentProgressiveLayer.__maxProgress = 0;
                    }
                    currentProgressiveLayer.__dirty = currentProgressiveLayer.__dirty || el.__dirty;
                    currentProgressiveLayer.elCount++;
                    currentProgressiveLayer.__maxProgress = Math.max(currentProgressiveLayer.__maxProgress, elFrame);
                    if (currentProgressiveLayer.__maxProgress >= currentProgressiveLayer.__progress) {
                        // Should keep rendering this  layer because progressive rendering is not finished yet
                        layer.__dirty = true;
                    }
                } else {
                    el.__frame = -1;
                    if (currentProgressiveLayer) {
                        currentProgressiveLayer.__nextIdxNotProg = i;
                        progressiveLayerCount++;
                        currentProgressiveLayer = null;
                    }
                }
            }
            if (currentProgressiveLayer) {
                progressiveLayerCount++;
                currentProgressiveLayer.__nextIdxNotProg = i;
            }
            // 层中的元素数量有发生变化
            this.eachBuildinLayer(function (layer, z) {
                if (elCountsLastFrame[z] !== layer.elCount) {
                    layer.__dirty = true;
                }
            });
            progressiveLayers.length = Math.min(progressiveLayerCount, MAX_PROGRESSIVE_LAYER_NUMBER);
            util.each(progressiveLayers, function (layer, idx) {
                if (progressiveElCountsLastFrame[idx] !== layer.elCount) {
                    el.__dirty = true;
                }
                if (layer.__dirty) {
                    layer.__progress = 0;
                }
            });
        },
        clear: function () {
            this.eachBuildinLayer(this._clearLayer);
            return this;
        },
        _clearLayer: function (layer) {
            layer.clear();
        },
        configLayer: function (zlevel, config) {
            if (config) {
                var layerConfig = this._layerConfig;
                if (!layerConfig[zlevel]) {
                    layerConfig[zlevel] = config;
                } else {
                    util.merge(layerConfig[zlevel], config, true);
                }
                var layer = this._layers[zlevel];
                if (layer) {
                    util.merge(layer, layerConfig[zlevel], true);
                }
            }
        },
        delLayer: function (zlevel) {
            var layers = this._layers;
            var zlevelList = this._zlevelList;
            var layer = layers[zlevel];
            if (!layer) {
                return;
            }
            layer.dom.parentNode.removeChild(layer.dom);
            delete layers[zlevel];
            zlevelList.splice(util.indexOf(zlevelList, zlevel), 1);
        },
        resize: function (width, height) {
            var domRoot = this._domRoot;
            // FIXME Why ?
            domRoot.style.display = 'none';
            // Save input w/h
            var opts = this._opts;
            width != null && (opts.width = width);
            height != null && (opts.height = height);
            width = this._getSize(0);
            height = this._getSize(1);
            domRoot.style.display = '';
            // 优化没有实际改变的resize
            if (this._width != width || height != this._height) {
                domRoot.style.width = width + 'px';
                domRoot.style.height = height + 'px';
                for (var id in this._layers) {
                    if (this._layers.hasOwnProperty(id)) {
                        this._layers[id].resize(width, height);
                    }
                }
                util.each(this._progressiveLayers, function (layer) {
                    layer.resize(width, height);
                });
                this.refresh(true);
            }
            this._width = width;
            this._height = height;
            return this;
        },
        clearLayer: function (zlevel) {
            var layer = this._layers[zlevel];
            if (layer) {
                layer.clear();
            }
        },
        dispose: function () {
            this.root.innerHTML = '';
            this.root = this.storage = this._domRoot = this._layers = null;
        },
        getRenderedCanvas: function (opts) {
            opts = opts || {};
            if (this._singleCanvas) {
                return this._layers[0].dom;
            }
            var imageLayer = new Layer('image', this, opts.pixelRatio || this.dpr);
            imageLayer.initContext();
            imageLayer.clearColor = opts.backgroundColor;
            imageLayer.clear();
            var displayList = this.storage.getDisplayList(true);
            var scope = {};
            for (var i = 0; i < displayList.length; i++) {
                var el = displayList[i];
                this._doPaintEl(el, imageLayer, true, scope);
            }
            return imageLayer.dom;
        },
        getWidth: function () {
            return this._width;
        },
        getHeight: function () {
            return this._height;
        },
        _getSize: function (whIdx) {
            var opts = this._opts;
            var wh = [
                    'width',
                    'height'
                ][whIdx];
            var cwh = [
                    'clientWidth',
                    'clientHeight'
                ][whIdx];
            var plt = [
                    'paddingLeft',
                    'paddingTop'
                ][whIdx];
            var prb = [
                    'paddingRight',
                    'paddingBottom'
                ][whIdx];
            if (opts[wh] != null && opts[wh] !== 'auto') {
                return parseFloat(opts[wh]);
            }
            var root = this.root;
            var stl = document.defaultView.getComputedStyle(root);
            return (root[cwh] || parseInt10(stl[wh]) || parseInt10(root.style[wh])) - (parseInt10(stl[plt]) || 0) - (parseInt10(stl[prb]) || 0) | 0;
        },
        _pathToImage: function (id, path, width, height, dpr) {
            var canvas = document.createElement('canvas');
            var ctx = canvas.getContext('2d');
            canvas.width = width * dpr;
            canvas.height = height * dpr;
            ctx.clearRect(0, 0, width * dpr, height * dpr);
            var pathTransform = {
                    position: path.position,
                    rotation: path.rotation,
                    scale: path.scale
                };
            path.position = [
                0,
                0,
                0
            ];
            path.rotation = 0;
            path.scale = [
                1,
                1
            ];
            if (path) {
                path.brush(ctx);
            }
            var ImageShape = require('./graphic/Image');
            var imgShape = new ImageShape({
                    id: id,
                    style: {
                        x: 0,
                        y: 0,
                        image: canvas
                    }
                });
            if (pathTransform.position != null) {
                imgShape.position = path.position = pathTransform.position;
            }
            if (pathTransform.rotation != null) {
                imgShape.rotation = path.rotation = pathTransform.rotation;
            }
            if (pathTransform.scale != null) {
                imgShape.scale = path.scale = pathTransform.scale;
            }
            return imgShape;
        },
        _createPathToImage: function () {
            var me = this;
            return function (id, e, width, height) {
                return me._pathToImage(id, e, width, height, me.dpr);
            };
        }
    };
    return Painter;
});
define('zrender/mixin/Draggable', ['require'], function (require) {
    function Draggable() {
        this.on('mousedown', this._dragStart, this);
        this.on('mousemove', this._drag, this);
        this.on('mouseup', this._dragEnd, this);
        this.on('globalout', this._dragEnd, this);    // this._dropTarget = null;
                                                      // this._draggingTarget = null;
                                                      // this._x = 0;
                                                      // this._y = 0;
    }
    Draggable.prototype = {
        constructor: Draggable,
        _dragStart: function (e) {
            var draggingTarget = e.target;
            if (draggingTarget && draggingTarget.draggable) {
                this._draggingTarget = draggingTarget;
                draggingTarget.dragging = true;
                this._x = e.offsetX;
                this._y = e.offsetY;
                this.dispatchToElement(draggingTarget, 'dragstart', e.event);
            }
        },
        _drag: function (e) {
            var draggingTarget = this._draggingTarget;
            if (draggingTarget) {
                var x = e.offsetX;
                var y = e.offsetY;
                var dx = x - this._x;
                var dy = y - this._y;
                this._x = x;
                this._y = y;
                draggingTarget.drift(dx, dy, e);
                this.dispatchToElement(draggingTarget, 'drag', e.event);
                var dropTarget = this.findHover(x, y, draggingTarget);
                var lastDropTarget = this._dropTarget;
                this._dropTarget = dropTarget;
                if (draggingTarget !== dropTarget) {
                    if (lastDropTarget && dropTarget !== lastDropTarget) {
                        this.dispatchToElement(lastDropTarget, 'dragleave', e.event);
                    }
                    if (dropTarget && dropTarget !== lastDropTarget) {
                        this.dispatchToElement(dropTarget, 'dragenter', e.event);
                    }
                }
            }
        },
        _dragEnd: function (e) {
            var draggingTarget = this._draggingTarget;
            if (draggingTarget) {
                draggingTarget.dragging = false;
            }
            this.dispatchToElement(draggingTarget, 'dragend', e.event);
            if (this._dropTarget) {
                this.dispatchToElement(this._dropTarget, 'drop', e.event);
            }
            this._draggingTarget = null;
            this._dropTarget = null;
        }
    };
    return Draggable;
});
define('zrender/core/event', ['require', '../mixin/Eventful', './env'], function (require) {
    'use strict';
    var Eventful = require('../mixin/Eventful');
    var env = require('./env');
    var isDomLevel2 = typeof window !== 'undefined' && !!window.addEventListener;
    function getBoundingClientRect(el) {
        // BlackBerry 5, iOS 3 (original iPhone) don't have getBoundingRect
        return el.getBoundingClientRect ? el.getBoundingClientRect() : {
            left: 0,
            top: 0
        };
    }
    // `calculate` is optional, default false
    function clientToLocal(el, e, out, calculate) {
        out = out || {};
        // According to the W3C Working Draft, offsetX and offsetY should be relative
        // to the padding edge of the target element. The only browser using this convention
        // is IE. Webkit uses the border edge, Opera uses the content edge, and FireFox does
        // not support the properties.
        // (see http://www.jacklmoore.com/notes/mouse-position/)
        // In zr painter.dom, padding edge equals to border edge.
        // FIXME
        // When mousemove event triggered on ec tooltip, target is not zr painter.dom, and
        // offsetX/Y is relative to e.target, where the calculation of zrX/Y via offsetX/Y
        // is too complex. So css-transfrom dont support in this case temporarily.
        if (calculate || !env.canvasSupported) {
            defaultGetZrXY(el, e, out);
        }    // Caution: In FireFox, layerX/layerY Mouse position relative to the closest positioned
             // ancestor element, so we should make sure el is positioned (e.g., not position:static).
             // BTW1, Webkit don't return the same results as FF in non-simple cases (like add
             // zoom-factor, overflow / opacity layers, transforms ...)
             // BTW2, (ev.offsetY || ev.pageY - $(ev.target).offset().top) is not correct in preserve-3d.
             // <https://bugs.jquery.com/ticket/8523#comment:14>
             // BTW3, In ff, offsetX/offsetY is always 0.
        else if (env.browser.firefox && e.layerX != null && e.layerX !== e.offsetX) {
            out.zrX = e.layerX;
            out.zrY = e.layerY;
        }    // For IE6+, chrome, safari, opera. (When will ff support offsetX?)
        else if (e.offsetX != null) {
            out.zrX = e.offsetX;
            out.zrY = e.offsetY;
        }    // For some other device, e.g., IOS safari.
        else {
            defaultGetZrXY(el, e, out);
        }
        return out;
    }
    function defaultGetZrXY(el, e, out) {
        // This well-known method below does not support css transform.
        var box = getBoundingClientRect(el);
        out.zrX = e.clientX - box.left;
        out.zrY = e.clientY - box.top;
    }
    /**
     * 如果存在第三方嵌入的一些dom触发的事件，或touch事件，需要转换一下事件坐标.
     * `calculate` is optional, default false.
     */
    function normalizeEvent(el, e, calculate) {
        e = e || window.event;
        if (e.zrX != null) {
            return e;
        }
        var eventType = e.type;
        var isTouch = eventType && eventType.indexOf('touch') >= 0;
        if (!isTouch) {
            clientToLocal(el, e, e, calculate);
            e.zrDelta = e.wheelDelta ? e.wheelDelta / 120 : -(e.detail || 0) / 3;
        } else {
            var touch = eventType != 'touchend' ? e.targetTouches[0] : e.changedTouches[0];
            touch && clientToLocal(el, touch, e, calculate);
        }
        return e;
    }
    function addEventListener(el, name, handler) {
        if (isDomLevel2) {
            el.addEventListener(name, handler);
        } else {
            el.attachEvent('on' + name, handler);
        }
    }
    function removeEventListener(el, name, handler) {
        if (isDomLevel2) {
            el.removeEventListener(name, handler);
        } else {
            el.detachEvent('on' + name, handler);
        }
    }
    /**
     * 停止冒泡和阻止默认行为
     * @memberOf module:zrender/core/event
     * @method
     * @param {Event} e : event对象
     */
    var stop = isDomLevel2 ? function (e) {
            e.preventDefault();
            e.stopPropagation();
            e.cancelBubble = true;
        } : function (e) {
            e.returnValue = false;
            e.cancelBubble = true;
        };
    return {
        clientToLocal: clientToLocal,
        normalizeEvent: normalizeEvent,
        addEventListener: addEventListener,
        removeEventListener: removeEventListener,
        stop: stop,
        Dispatcher: Eventful
    };
});
define('zrender/animation/requestAnimationFrame', ['require'], function (require) {
    return typeof window !== 'undefined' && (window.requestAnimationFrame || window.msRequestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame) || function (func) {
        setTimeout(func, 16);
    };
});
define('zrender/core/GestureMgr', ['require', './event'], function (require) {
    'use strict';
    var eventUtil = require('./event');
    var GestureMgr = function () {
        /**
         * @private
         * @type {Array.<Object>}
         */
        this._track = [];
    };
    GestureMgr.prototype = {
        constructor: GestureMgr,
        recognize: function (event, target, root) {
            this._doTrack(event, target, root);
            return this._recognize(event);
        },
        clear: function () {
            this._track.length = 0;
            return this;
        },
        _doTrack: function (event, target, root) {
            var touches = event.touches;
            if (!touches) {
                return;
            }
            var trackItem = {
                    points: [],
                    touches: [],
                    target: target,
                    event: event
                };
            for (var i = 0, len = touches.length; i < len; i++) {
                var touch = touches[i];
                var pos = eventUtil.clientToLocal(root, touch, {});
                trackItem.points.push([
                    pos.zrX,
                    pos.zrY
                ]);
                trackItem.touches.push(touch);
            }
            this._track.push(trackItem);
        },
        _recognize: function (event) {
            for (var eventName in recognizers) {
                if (recognizers.hasOwnProperty(eventName)) {
                    var gestureInfo = recognizers[eventName](this._track, event);
                    if (gestureInfo) {
                        return gestureInfo;
                    }
                }
            }
        }
    };
    function dist(pointPair) {
        var dx = pointPair[1][0] - pointPair[0][0];
        var dy = pointPair[1][1] - pointPair[0][1];
        return Math.sqrt(dx * dx + dy * dy);
    }
    function center(pointPair) {
        return [
            (pointPair[0][0] + pointPair[1][0]) / 2,
            (pointPair[0][1] + pointPair[1][1]) / 2
        ];
    }
    var recognizers = {
            pinch: function (track, event) {
                var trackLen = track.length;
                if (!trackLen) {
                    return;
                }
                var pinchEnd = (track[trackLen - 1] || {}).points;
                var pinchPre = (track[trackLen - 2] || {}).points || pinchEnd;
                if (pinchPre && pinchPre.length > 1 && pinchEnd && pinchEnd.length > 1) {
                    var pinchScale = dist(pinchEnd) / dist(pinchPre);
                    !isFinite(pinchScale) && (pinchScale = 1);
                    event.pinchScale = pinchScale;
                    var pinchCenter = center(pinchEnd);
                    event.pinchX = pinchCenter[0];
                    event.pinchY = pinchCenter[1];
                    return {
                        type: 'pinch',
                        target: track[0].target,
                        event: event
                    };
                }
            }    // Only pinch currently.
        };
    return GestureMgr;
});
define('zrender/Layer', ['require', './core/util', './config', './graphic/Style', './graphic/Pattern'], function (require) {
    var util = require('./core/util');
    var config = require('./config');
    var Style = require('./graphic/Style');
    var Pattern = require('./graphic/Pattern');
    function returnFalse() {
        return false;
    }
    /**
     * 创建dom
     *
     * @inner
     * @param {string} id dom id 待用
     * @param {string} type dom type，such as canvas, div etc.
     * @param {Painter} painter painter instance
     * @param {number} number
     */
    function createDom(id, type, painter, dpr) {
        var newDom = document.createElement(type);
        var width = painter.getWidth();
        var height = painter.getHeight();
        var newDomStyle = newDom.style;
        // 没append呢，请原谅我这样写，清晰~
        newDomStyle.position = 'absolute';
        newDomStyle.left = 0;
        newDomStyle.top = 0;
        newDomStyle.width = width + 'px';
        newDomStyle.height = height + 'px';
        newDom.width = width * dpr;
        newDom.height = height * dpr;
        // id不作为索引用，避免可能造成的重名，定义为私有属性
        newDom.setAttribute('data-zr-dom-id', id);
        return newDom;
    }
    /**
     * @alias module:zrender/Layer
     * @constructor
     * @extends module:zrender/mixin/Transformable
     * @param {string} id
     * @param {module:zrender/Painter} painter
     * @param {number} [dpr]
     */
    var Layer = function (id, painter, dpr) {
        var dom;
        dpr = dpr || config.devicePixelRatio;
        if (typeof id === 'string') {
            dom = createDom(id, 'canvas', painter, dpr);
        }    // Not using isDom because in node it will return false
        else if (util.isObject(id)) {
            dom = id;
            id = dom.id;
        }
        this.id = id;
        this.dom = dom;
        var domStyle = dom.style;
        if (domStyle) {
            // Not in node
            dom.onselectstart = returnFalse;
            // 避免页面选中的尴尬
            domStyle['-webkit-user-select'] = 'none';
            domStyle['user-select'] = 'none';
            domStyle['-webkit-touch-callout'] = 'none';
            domStyle['-webkit-tap-highlight-color'] = 'rgba(0,0,0,0)';
            domStyle['padding'] = 0;
            domStyle['margin'] = 0;
            domStyle['border-width'] = 0;
        }
        this.domBack = null;
        this.ctxBack = null;
        this.painter = painter;
        this.config = null;
        // Configs
        /**
         * 每次清空画布的颜色
         * @type {string}
         * @default 0
         */
        this.clearColor = 0;
        /**
         * 是否开启动态模糊
         * @type {boolean}
         * @default false
         */
        this.motionBlur = false;
        /**
         * 在开启动态模糊的时候使用，与上一帧混合的alpha值，值越大尾迹越明显
         * @type {number}
         * @default 0.7
         */
        this.lastFrameAlpha = 0.7;
        /**
         * Layer dpr
         * @type {number}
         */
        this.dpr = dpr;
    };
    Layer.prototype = {
        constructor: Layer,
        elCount: 0,
        __dirty: true,
        initContext: function () {
            this.ctx = this.dom.getContext('2d');
            this.ctx.dpr = this.dpr;
        },
        createBackBuffer: function () {
            var dpr = this.dpr;
            this.domBack = createDom('back-' + this.id, 'canvas', this.painter, dpr);
            this.ctxBack = this.domBack.getContext('2d');
            if (dpr != 1) {
                this.ctxBack.scale(dpr, dpr);
            }
        },
        resize: function (width, height) {
            var dpr = this.dpr;
            var dom = this.dom;
            var domStyle = dom.style;
            var domBack = this.domBack;
            domStyle.width = width + 'px';
            domStyle.height = height + 'px';
            dom.width = width * dpr;
            dom.height = height * dpr;
            if (domBack) {
                domBack.width = width * dpr;
                domBack.height = height * dpr;
                if (dpr != 1) {
                    this.ctxBack.scale(dpr, dpr);
                }
            }
        },
        clear: function (clearAll) {
            var dom = this.dom;
            var ctx = this.ctx;
            var width = dom.width;
            var height = dom.height;
            var clearColor = this.clearColor;
            var haveMotionBLur = this.motionBlur && !clearAll;
            var lastFrameAlpha = this.lastFrameAlpha;
            var dpr = this.dpr;
            if (haveMotionBLur) {
                if (!this.domBack) {
                    this.createBackBuffer();
                }
                this.ctxBack.globalCompositeOperation = 'copy';
                this.ctxBack.drawImage(dom, 0, 0, width / dpr, height / dpr);
            }
            ctx.clearRect(0, 0, width, height);
            if (clearColor) {
                var clearColorGradientOrPattern;
                // Gradient
                if (clearColor.colorStops) {
                    // Cache canvas gradient
                    clearColorGradientOrPattern = clearColor.__canvasGradient || Style.getGradient(ctx, clearColor, {
                        x: 0,
                        y: 0,
                        width: width,
                        height: height
                    });
                    clearColor.__canvasGradient = clearColorGradientOrPattern;
                }    // Pattern
                else if (clearColor.image) {
                    clearColorGradientOrPattern = Pattern.prototype.getCanvasPattern.call(clearColor, ctx);
                }
                ctx.save();
                ctx.fillStyle = clearColorGradientOrPattern || clearColor;
                ctx.fillRect(0, 0, width, height);
                ctx.restore();
            }
            if (haveMotionBLur) {
                var domBack = this.domBack;
                ctx.save();
                ctx.globalAlpha = lastFrameAlpha;
                ctx.drawImage(domBack, 0, 0, width, height);
                ctx.restore();
            }
        }
    };
    return Layer;
});
define('echarts/preprocessor/helper/compatStyle', ['require', 'zrender/core/util'], function (require) {
    var zrUtil = require('zrender/core/util');
    var POSSIBLE_STYLES = [
            'areaStyle',
            'lineStyle',
            'nodeStyle',
            'linkStyle',
            'chordStyle',
            'label',
            'labelLine'
        ];
    function compatItemStyle(opt) {
        var itemStyleOpt = opt && opt.itemStyle;
        if (itemStyleOpt) {
            zrUtil.each(POSSIBLE_STYLES, function (styleName) {
                var normalItemStyleOpt = itemStyleOpt.normal;
                var emphasisItemStyleOpt = itemStyleOpt.emphasis;
                if (normalItemStyleOpt && normalItemStyleOpt[styleName]) {
                    opt[styleName] = opt[styleName] || {};
                    if (!opt[styleName].normal) {
                        opt[styleName].normal = normalItemStyleOpt[styleName];
                    } else {
                        zrUtil.merge(opt[styleName].normal, normalItemStyleOpt[styleName]);
                    }
                    normalItemStyleOpt[styleName] = null;
                }
                if (emphasisItemStyleOpt && emphasisItemStyleOpt[styleName]) {
                    opt[styleName] = opt[styleName] || {};
                    if (!opt[styleName].emphasis) {
                        opt[styleName].emphasis = emphasisItemStyleOpt[styleName];
                    } else {
                        zrUtil.merge(opt[styleName].emphasis, emphasisItemStyleOpt[styleName]);
                    }
                    emphasisItemStyleOpt[styleName] = null;
                }
            });
        }
    }
    return function (seriesOpt) {
        if (!seriesOpt) {
            return;
        }
        compatItemStyle(seriesOpt);
        compatItemStyle(seriesOpt.markPoint);
        compatItemStyle(seriesOpt.markLine);
        var data = seriesOpt.data;
        if (data) {
            for (var i = 0; i < data.length; i++) {
                compatItemStyle(data[i]);
            }
            // mark point data
            var markPoint = seriesOpt.markPoint;
            if (markPoint && markPoint.data) {
                var mpData = markPoint.data;
                for (var i = 0; i < mpData.length; i++) {
                    compatItemStyle(mpData[i]);
                }
            }
            // mark line data
            var markLine = seriesOpt.markLine;
            if (markLine && markLine.data) {
                var mlData = markLine.data;
                for (var i = 0; i < mlData.length; i++) {
                    if (zrUtil.isArray(mlData[i])) {
                        compatItemStyle(mlData[i][0]);
                        compatItemStyle(mlData[i][1]);
                    } else {
                        compatItemStyle(mlData[i]);
                    }
                }
            }
        }
    };
});
define('echarts/component/axis/AxisView', ['require', 'zrender/core/util', '../../util/graphic', './AxisBuilder', '../../echarts'], function (require) {
    var zrUtil = require('zrender/core/util');
    var graphic = require('../../util/graphic');
    var AxisBuilder = require('./AxisBuilder');
    var ifIgnoreOnTick = AxisBuilder.ifIgnoreOnTick;
    var getInterval = AxisBuilder.getInterval;
    var axisBuilderAttrs = [
            'axisLine',
            'axisLabel',
            'axisTick',
            'axisName'
        ];
    var selfBuilderAttrs = [
            'splitArea',
            'splitLine'
        ];
    // function getAlignWithLabel(model, axisModel) {
    //     var alignWithLabel = model.get('alignWithLabel');
    //     if (alignWithLabel === 'auto') {
    //         alignWithLabel = axisModel.get('axisTick.alignWithLabel');
    //     }
    //     return alignWithLabel;
    // }
    var AxisView = require('../../echarts').extendComponentView({
            type: 'axis',
            render: function (axisModel, ecModel) {
                this.group.removeAll();
                var oldAxisGroup = this._axisGroup;
                this._axisGroup = new graphic.Group();
                this.group.add(this._axisGroup);
                if (!axisModel.get('show')) {
                    return;
                }
                var gridModel = axisModel.findGridModel();
                var layout = layoutAxis(gridModel, axisModel);
                var axisBuilder = new AxisBuilder(axisModel, layout);
                zrUtil.each(axisBuilderAttrs, axisBuilder.add, axisBuilder);
                this._axisGroup.add(axisBuilder.getGroup());
                zrUtil.each(selfBuilderAttrs, function (name) {
                    if (axisModel.get(name + '.show')) {
                        this['_' + name](axisModel, gridModel, layout.labelInterval);
                    }
                }, this);
                graphic.groupTransition(oldAxisGroup, this._axisGroup, axisModel);
            },
            _splitLine: function (axisModel, gridModel, labelInterval) {
                var axis = axisModel.axis;
                var splitLineModel = axisModel.getModel('splitLine');
                var lineStyleModel = splitLineModel.getModel('lineStyle');
                var lineColors = lineStyleModel.get('color');
                var lineInterval = getInterval(splitLineModel, labelInterval);
                lineColors = zrUtil.isArray(lineColors) ? lineColors : [lineColors];
                var gridRect = gridModel.coordinateSystem.getRect();
                var isHorizontal = axis.isHorizontal();
                var lineCount = 0;
                var ticksCoords = axis.getTicksCoords();
                var ticks = axis.scale.getTicks();
                var p1 = [];
                var p2 = [];
                // Simple optimization
                // Batching the lines if color are the same
                var lineStyle = lineStyleModel.getLineStyle();
                for (var i = 0; i < ticksCoords.length; i++) {
                    if (ifIgnoreOnTick(axis, i, lineInterval)) {
                        continue;
                    }
                    var tickCoord = axis.toGlobalCoord(ticksCoords[i]);
                    if (isHorizontal) {
                        p1[0] = tickCoord;
                        p1[1] = gridRect.y;
                        p2[0] = tickCoord;
                        p2[1] = gridRect.y + gridRect.height;
                    } else {
                        p1[0] = gridRect.x;
                        p1[1] = tickCoord;
                        p2[0] = gridRect.x + gridRect.width;
                        p2[1] = tickCoord;
                    }
                    var colorIndex = lineCount++ % lineColors.length;
                    this._axisGroup.add(new graphic.Line(graphic.subPixelOptimizeLine({
                        anid: 'line_' + ticks[i],
                        shape: {
                            x1: p1[0],
                            y1: p1[1],
                            x2: p2[0],
                            y2: p2[1]
                        },
                        style: zrUtil.defaults({ stroke: lineColors[colorIndex] }, lineStyle),
                        silent: true
                    })));
                }
            },
            _splitArea: function (axisModel, gridModel, labelInterval) {
                var axis = axisModel.axis;
                var splitAreaModel = axisModel.getModel('splitArea');
                var areaStyleModel = splitAreaModel.getModel('areaStyle');
                var areaColors = areaStyleModel.get('color');
                var gridRect = gridModel.coordinateSystem.getRect();
                var ticksCoords = axis.getTicksCoords();
                var ticks = axis.scale.getTicks();
                var prevX = axis.toGlobalCoord(ticksCoords[0]);
                var prevY = axis.toGlobalCoord(ticksCoords[0]);
                var count = 0;
                var areaInterval = getInterval(splitAreaModel, labelInterval);
                var areaStyle = areaStyleModel.getAreaStyle();
                areaColors = zrUtil.isArray(areaColors) ? areaColors : [areaColors];
                for (var i = 1; i < ticksCoords.length; i++) {
                    if (ifIgnoreOnTick(axis, i, areaInterval)) {
                        continue;
                    }
                    var tickCoord = axis.toGlobalCoord(ticksCoords[i]);
                    var x;
                    var y;
                    var width;
                    var height;
                    if (axis.isHorizontal()) {
                        x = prevX;
                        y = gridRect.y;
                        width = tickCoord - x;
                        height = gridRect.height;
                    } else {
                        x = gridRect.x;
                        y = prevY;
                        width = gridRect.width;
                        height = tickCoord - y;
                    }
                    var colorIndex = count++ % areaColors.length;
                    this._axisGroup.add(new graphic.Rect({
                        anid: 'area_' + ticks[i],
                        shape: {
                            x: x,
                            y: y,
                            width: width,
                            height: height
                        },
                        style: zrUtil.defaults({ fill: areaColors[colorIndex] }, areaStyle),
                        silent: true
                    }));
                    prevX = x + width;
                    prevY = y + height;
                }
            }
        });
    AxisView.extend({ type: 'xAxis' });
    AxisView.extend({ type: 'yAxis' });
    /**
     * @inner
     */
    function layoutAxis(gridModel, axisModel) {
        var grid = gridModel.coordinateSystem;
        var axis = axisModel.axis;
        var layout = {};
        var rawAxisPosition = axis.position;
        var axisPosition = axis.onZero ? 'onZero' : rawAxisPosition;
        var axisDim = axis.dim;
        // [left, right, top, bottom]
        var rect = grid.getRect();
        var rectBound = [
                rect.x,
                rect.x + rect.width,
                rect.y,
                rect.y + rect.height
            ];
        var axisOffset = axisModel.get('offset') || 0;
        var posMap = {
                x: {
                    top: rectBound[2] - axisOffset,
                    bottom: rectBound[3] + axisOffset
                },
                y: {
                    left: rectBound[0] - axisOffset,
                    right: rectBound[1] + axisOffset
                }
            };
        posMap.x.onZero = Math.max(Math.min(getZero('y'), posMap.x.bottom), posMap.x.top);
        posMap.y.onZero = Math.max(Math.min(getZero('x'), posMap.y.right), posMap.y.left);
        function getZero(dim, val) {
            var theAxis = grid.getAxis(dim);
            return theAxis.toGlobalCoord(theAxis.dataToCoord(0));
        }
        // Axis position
        layout.position = [
            axisDim === 'y' ? posMap.y[axisPosition] : rectBound[0],
            axisDim === 'x' ? posMap.x[axisPosition] : rectBound[3]
        ];
        // Axis rotation
        layout.rotation = Math.PI / 2 * (axisDim === 'x' ? 0 : 1);
        // Tick and label direction, x y is axisDim
        var dirMap = {
                top: -1,
                bottom: 1,
                left: -1,
                right: 1
            };
        layout.labelDirection = layout.tickDirection = layout.nameDirection = dirMap[rawAxisPosition];
        if (axis.onZero) {
            layout.labelOffset = posMap[axisDim][rawAxisPosition] - posMap[axisDim].onZero;
        }
        if (axisModel.getModel('axisTick').get('inside')) {
            layout.tickDirection = -layout.tickDirection;
        }
        if (axisModel.getModel('axisLabel').get('inside')) {
            layout.labelDirection = -layout.labelDirection;
        }
        // Special label rotation
        var labelRotation = axisModel.getModel('axisLabel').get('rotate');
        layout.labelRotation = axisPosition === 'top' ? -labelRotation : labelRotation;
        // label interval when auto mode.
        layout.labelInterval = axis.getLabelInterval();
        // Over splitLine and splitArea
        layout.z2 = 1;
        return layout;
    }
});
define('echarts/chart/helper/SymbolDraw', ['require', '../../util/graphic', './Symbol'], function (require) {
    var graphic = require('../../util/graphic');
    var Symbol = require('./Symbol');
    /**
     * @constructor
     * @alias module:echarts/chart/helper/SymbolDraw
     * @param {module:zrender/graphic/Group} [symbolCtor]
     */
    function SymbolDraw(symbolCtor) {
        this.group = new graphic.Group();
        this._symbolCtor = symbolCtor || Symbol;
    }
    var symbolDrawProto = SymbolDraw.prototype;
    function symbolNeedsDraw(data, idx, isIgnore) {
        var point = data.getItemLayout(idx);
        // Is an object
        // if (point && point.hasOwnProperty('point')) {
        //     point = point.point;
        // }
        return point && !isNaN(point[0]) && !isNaN(point[1]) && !(isIgnore && isIgnore(idx)) && data.getItemVisual(idx, 'symbol') !== 'none';
    }
    /**
     * Update symbols draw by new data
     * @param {module:echarts/data/List} data
     * @param {Array.<boolean>} [isIgnore]
     */
    symbolDrawProto.updateData = function (data, isIgnore) {
        var group = this.group;
        var seriesModel = data.hostModel;
        var oldData = this._data;
        var SymbolCtor = this._symbolCtor;
        var seriesScope = {
                itemStyle: seriesModel.getModel('itemStyle.normal').getItemStyle(['color']),
                hoverItemStyle: seriesModel.getModel('itemStyle.emphasis').getItemStyle(),
                symbolRotate: seriesModel.get('symbolRotate'),
                symbolOffset: seriesModel.get('symbolOffset'),
                hoverAnimation: seriesModel.get('hoverAnimation'),
                labelModel: seriesModel.getModel('label.normal'),
                hoverLabelModel: seriesModel.getModel('label.emphasis')
            };
        data.diff(oldData).add(function (newIdx) {
            var point = data.getItemLayout(newIdx);
            if (symbolNeedsDraw(data, newIdx, isIgnore)) {
                var symbolEl = new SymbolCtor(data, newIdx, seriesScope);
                symbolEl.attr('position', point);
                data.setItemGraphicEl(newIdx, symbolEl);
                group.add(symbolEl);
            }
        }).update(function (newIdx, oldIdx) {
            var symbolEl = oldData.getItemGraphicEl(oldIdx);
            var point = data.getItemLayout(newIdx);
            if (!symbolNeedsDraw(data, newIdx, isIgnore)) {
                group.remove(symbolEl);
                return;
            }
            if (!symbolEl) {
                symbolEl = new SymbolCtor(data, newIdx);
                symbolEl.attr('position', point);
            } else {
                symbolEl.updateData(data, newIdx, seriesScope);
                graphic.updateProps(symbolEl, { position: point }, seriesModel);
            }
            // Add back
            group.add(symbolEl);
            data.setItemGraphicEl(newIdx, symbolEl);
        }).remove(function (oldIdx) {
            var el = oldData.getItemGraphicEl(oldIdx);
            el && el.fadeOut(function () {
                group.remove(el);
            });
        }).execute();
        this._data = data;
    };
    symbolDrawProto.updateLayout = function () {
        var data = this._data;
        if (data) {
            // Not use animation
            data.eachItemGraphicEl(function (el, idx) {
                var point = data.getItemLayout(idx);
                el.attr('position', point);
            });
        }
    };
    symbolDrawProto.remove = function (enableAnimation) {
        var group = this.group;
        var data = this._data;
        if (data) {
            if (enableAnimation) {
                data.eachItemGraphicEl(function (el) {
                    el.fadeOut(function () {
                        group.remove(el);
                    });
                });
            } else {
                group.removeAll();
            }
        }
    };
    return SymbolDraw;
});
define('echarts/chart/helper/Symbol', ['require', 'zrender/core/util', '../../util/symbol', '../../util/graphic', '../../util/number'], function (require) {
    var zrUtil = require('zrender/core/util');
    var symbolUtil = require('../../util/symbol');
    var graphic = require('../../util/graphic');
    var numberUtil = require('../../util/number');
    function normalizeSymbolSize(symbolSize) {
        symbolSize = symbolSize instanceof Array ? symbolSize.slice() : [
            +symbolSize,
            +symbolSize
        ];
        symbolSize[0] /= 2;
        symbolSize[1] /= 2;
        return symbolSize;
    }
    /**
     * @constructor
     * @alias {module:echarts/chart/helper/Symbol}
     * @param {module:echarts/data/List} data
     * @param {number} idx
     * @extends {module:zrender/graphic/Group}
     */
    function Symbol(data, idx, seriesScope) {
        graphic.Group.call(this);
        this.updateData(data, idx, seriesScope);
    }
    var symbolProto = Symbol.prototype;
    function driftSymbol(dx, dy) {
        this.parent.drift(dx, dy);
    }
    symbolProto._createSymbol = function (symbolType, data, idx) {
        // Remove paths created before
        this.removeAll();
        var seriesModel = data.hostModel;
        var color = data.getItemVisual(idx, 'color');
        // var symbolPath = symbolUtil.createSymbol(
        //     symbolType, -0.5, -0.5, 1, 1, color
        // );
        // If width/height are set too small (e.g., set to 1) on ios10
        // and macOS Sierra, a circle stroke become a rect, no matter what
        // the scale is set. So we set width/height as 2. See #4150.
        var symbolPath = symbolUtil.createSymbol(symbolType, -1, -1, 2, 2, color);
        symbolPath.attr({
            z2: 100,
            culling: true,
            scale: [
                0,
                0
            ]
        });
        // Rewrite drift method
        symbolPath.drift = driftSymbol;
        var size = normalizeSymbolSize(data.getItemVisual(idx, 'symbolSize'));
        graphic.initProps(symbolPath, { scale: size }, seriesModel, idx);
        this._symbolType = symbolType;
        this.add(symbolPath);
    };
    /**
     * Stop animation
     * @param {boolean} toLastFrame
     */
    symbolProto.stopSymbolAnimation = function (toLastFrame) {
        this.childAt(0).stopAnimation(toLastFrame);
    };
    /**
     * Get symbol path element
     */
    symbolProto.getSymbolPath = function () {
        return this.childAt(0);
    };
    /**
     * Get scale(aka, current symbol size).
     * Including the change caused by animation
     */
    symbolProto.getScale = function () {
        return this.childAt(0).scale;
    };
    /**
     * Highlight symbol
     */
    symbolProto.highlight = function () {
        this.childAt(0).trigger('emphasis');
    };
    /**
     * Downplay symbol
     */
    symbolProto.downplay = function () {
        this.childAt(0).trigger('normal');
    };
    /**
     * @param {number} zlevel
     * @param {number} z
     */
    symbolProto.setZ = function (zlevel, z) {
        var symbolPath = this.childAt(0);
        symbolPath.zlevel = zlevel;
        symbolPath.z = z;
    };
    symbolProto.setDraggable = function (draggable) {
        var symbolPath = this.childAt(0);
        symbolPath.draggable = draggable;
        symbolPath.cursor = draggable ? 'move' : 'pointer';
    };
    /**
     * Update symbol properties
     * @param  {module:echarts/data/List} data
     * @param  {number} idx
     */
    symbolProto.updateData = function (data, idx, seriesScope) {
        this.silent = false;
        var symbolType = data.getItemVisual(idx, 'symbol') || 'circle';
        var seriesModel = data.hostModel;
        var symbolSize = normalizeSymbolSize(data.getItemVisual(idx, 'symbolSize'));
        if (symbolType !== this._symbolType) {
            this._createSymbol(symbolType, data, idx);
        } else {
            var symbolPath = this.childAt(0);
            graphic.updateProps(symbolPath, { scale: symbolSize }, seriesModel, idx);
        }
        this._updateCommon(data, idx, symbolSize, seriesScope);
        this._seriesModel = seriesModel;
    };
    // Update common properties
    var normalStyleAccessPath = [
            'itemStyle',
            'normal'
        ];
    var emphasisStyleAccessPath = [
            'itemStyle',
            'emphasis'
        ];
    var normalLabelAccessPath = [
            'label',
            'normal'
        ];
    var emphasisLabelAccessPath = [
            'label',
            'emphasis'
        ];
    symbolProto._updateCommon = function (data, idx, symbolSize, seriesScope) {
        var symbolPath = this.childAt(0);
        var seriesModel = data.hostModel;
        var color = data.getItemVisual(idx, 'color');
        // Reset style
        if (symbolPath.type !== 'image') {
            symbolPath.useStyle({ strokeNoScale: true });
        }
        seriesScope = seriesScope || null;
        var itemStyle = seriesScope && seriesScope.itemStyle;
        var hoverItemStyle = seriesScope && seriesScope.hoverItemStyle;
        var symbolRotate = seriesScope && seriesScope.symbolRotate;
        var symbolOffset = seriesScope && seriesScope.symbolOffset;
        var labelModel = seriesScope && seriesScope.labelModel;
        var hoverLabelModel = seriesScope && seriesScope.hoverLabelModel;
        var hoverAnimation = seriesScope && seriesScope.hoverAnimation;
        if (!seriesScope || data.hasItemOption) {
            var itemModel = data.getItemModel(idx);
            // Color must be excluded.
            // Because symbol provide setColor individually to set fill and stroke
            itemStyle = itemModel.getModel(normalStyleAccessPath).getItemStyle(['color']);
            hoverItemStyle = itemModel.getModel(emphasisStyleAccessPath).getItemStyle();
            symbolRotate = itemModel.getShallow('symbolRotate');
            symbolOffset = itemModel.getShallow('symbolOffset');
            labelModel = itemModel.getModel(normalLabelAccessPath);
            hoverLabelModel = itemModel.getModel(emphasisLabelAccessPath);
            hoverAnimation = itemModel.getShallow('hoverAnimation');
        } else {
            hoverItemStyle = zrUtil.extend({}, hoverItemStyle);
        }
        var elStyle = symbolPath.style;
        symbolPath.attr('rotation', (symbolRotate || 0) * Math.PI / 180 || 0);
        if (symbolOffset) {
            symbolPath.attr('position', [
                numberUtil.parsePercent(symbolOffset[0], symbolSize[0]),
                numberUtil.parsePercent(symbolOffset[1], symbolSize[1])
            ]);
        }
        // PENDING setColor before setStyle!!!
        symbolPath.setColor(color);
        symbolPath.setStyle(itemStyle);
        var opacity = data.getItemVisual(idx, 'opacity');
        if (opacity != null) {
            elStyle.opacity = opacity;
        }
        // Get last value dim
        var dimensions = data.dimensions.slice();
        var valueDim;
        var dataType;
        while (dimensions.length && (valueDim = dimensions.pop(), dataType = data.getDimensionInfo(valueDim).type, dataType === 'ordinal' || dataType === 'time')) {
        }
        // jshint ignore:line
        if (valueDim != null && labelModel.getShallow('show')) {
            graphic.setText(elStyle, labelModel, color);
            elStyle.text = zrUtil.retrieve(seriesModel.getFormattedLabel(idx, 'normal'), data.get(valueDim, idx));
        } else {
            elStyle.text = '';
        }
        if (valueDim != null && hoverLabelModel.getShallow('show')) {
            graphic.setText(hoverItemStyle, hoverLabelModel, color);
            hoverItemStyle.text = zrUtil.retrieve(seriesModel.getFormattedLabel(idx, 'emphasis'), data.get(valueDim, idx));
        } else {
            hoverItemStyle.text = '';
        }
        var size = normalizeSymbolSize(data.getItemVisual(idx, 'symbolSize'));
        symbolPath.off('mouseover').off('mouseout').off('emphasis').off('normal');
        symbolPath.hoverStyle = hoverItemStyle;
        graphic.setHoverStyle(symbolPath);
        if (hoverAnimation && seriesModel.ifEnableAnimation()) {
            var onEmphasis = function () {
                var ratio = size[1] / size[0];
                this.animateTo({
                    scale: [
                        Math.max(size[0] * 1.1, size[0] + 3),
                        Math.max(size[1] * 1.1, size[1] + 3 * ratio)
                    ]
                }, 400, 'elasticOut');
            };
            var onNormal = function () {
                this.animateTo({ scale: size }, 400, 'elasticOut');
            };
            symbolPath.on('mouseover', onEmphasis).on('mouseout', onNormal).on('emphasis', onEmphasis).on('normal', onNormal);
        }
    };
    symbolProto.fadeOut = function (cb) {
        var symbolPath = this.childAt(0);
        // Avoid mistaken hover when fading out
        this.silent = true;
        // Not show text when animating
        symbolPath.style.text = '';
        graphic.updateProps(symbolPath, {
            scale: [
                0,
                0
            ]
        }, this._seriesModel, this.dataIndex, cb);
    };
    zrUtil.inherits(Symbol, graphic.Group);
    return Symbol;
});
define('echarts/chart/line/lineAnimationDiff', ['require'], function (require) {
    // var arrayDiff = require('zrender/core/arrayDiff');
    // 'zrender/core/arrayDiff' has been used before, but it did
    // not do well in performance when roam with fixed dataZoom window.
    function sign(val) {
        return val >= 0 ? 1 : -1;
    }
    function getStackedOnPoint(coordSys, data, idx) {
        var baseAxis = coordSys.getBaseAxis();
        var valueAxis = coordSys.getOtherAxis(baseAxis);
        var valueStart = baseAxis.onZero ? 0 : valueAxis.scale.getExtent()[0];
        var valueDim = valueAxis.dim;
        var baseDataOffset = valueDim === 'x' || valueDim === 'radius' ? 1 : 0;
        var stackedOnSameSign;
        var stackedOn = data.stackedOn;
        var val = data.get(valueDim, idx);
        // Find first stacked value with same sign
        while (stackedOn && sign(stackedOn.get(valueDim, idx)) === sign(val)) {
            stackedOnSameSign = stackedOn;
            break;
        }
        var stackedData = [];
        stackedData[baseDataOffset] = data.get(baseAxis.dim, idx);
        stackedData[1 - baseDataOffset] = stackedOnSameSign ? stackedOnSameSign.get(valueDim, idx, true) : valueStart;
        return coordSys.dataToPoint(stackedData);
    }
    // function convertToIntId(newIdList, oldIdList) {
    //     // Generate int id instead of string id.
    //     // Compare string maybe slow in score function of arrDiff
    //     // Assume id in idList are all unique
    //     var idIndicesMap = {};
    //     var idx = 0;
    //     for (var i = 0; i < newIdList.length; i++) {
    //         idIndicesMap[newIdList[i]] = idx;
    //         newIdList[i] = idx++;
    //     }
    //     for (var i = 0; i < oldIdList.length; i++) {
    //         var oldId = oldIdList[i];
    //         // Same with newIdList
    //         if (idIndicesMap[oldId]) {
    //             oldIdList[i] = idIndicesMap[oldId];
    //         }
    //         else {
    //             oldIdList[i] = idx++;
    //         }
    //     }
    // }
    function diffData(oldData, newData) {
        var diffResult = [];
        newData.diff(oldData).add(function (idx) {
            diffResult.push({
                cmd: '+',
                idx: idx
            });
        }).update(function (newIdx, oldIdx) {
            diffResult.push({
                cmd: '=',
                idx: oldIdx,
                idx1: newIdx
            });
        }).remove(function (idx) {
            diffResult.push({
                cmd: '-',
                idx: idx
            });
        }).execute();
        return diffResult;
    }
    return function (oldData, newData, oldStackedOnPoints, newStackedOnPoints, oldCoordSys, newCoordSys) {
        var diff = diffData(oldData, newData);
        // var newIdList = newData.mapArray(newData.getId);
        // var oldIdList = oldData.mapArray(oldData.getId);
        // convertToIntId(newIdList, oldIdList);
        // // FIXME One data ?
        // diff = arrayDiff(oldIdList, newIdList);
        var currPoints = [];
        var nextPoints = [];
        // Points for stacking base line
        var currStackedPoints = [];
        var nextStackedPoints = [];
        var status = [];
        var sortedIndices = [];
        var rawIndices = [];
        var dims = newCoordSys.dimensions;
        for (var i = 0; i < diff.length; i++) {
            var diffItem = diff[i];
            var pointAdded = true;
            // FIXME, animation is not so perfect when dataZoom window moves fast
            // Which is in case remvoing or add more than one data in the tail or head
            switch (diffItem.cmd) {
            case '=':
                var currentPt = oldData.getItemLayout(diffItem.idx);
                var nextPt = newData.getItemLayout(diffItem.idx1);
                // If previous data is NaN, use next point directly
                if (isNaN(currentPt[0]) || isNaN(currentPt[1])) {
                    currentPt = nextPt.slice();
                }
                currPoints.push(currentPt);
                nextPoints.push(nextPt);
                currStackedPoints.push(oldStackedOnPoints[diffItem.idx]);
                nextStackedPoints.push(newStackedOnPoints[diffItem.idx1]);
                rawIndices.push(newData.getRawIndex(diffItem.idx1));
                break;
            case '+':
                var idx = diffItem.idx;
                currPoints.push(oldCoordSys.dataToPoint([
                    newData.get(dims[0], idx, true),
                    newData.get(dims[1], idx, true)
                ]));
                nextPoints.push(newData.getItemLayout(idx).slice());
                currStackedPoints.push(getStackedOnPoint(oldCoordSys, newData, idx));
                nextStackedPoints.push(newStackedOnPoints[idx]);
                rawIndices.push(newData.getRawIndex(idx));
                break;
            case '-':
                var idx = diffItem.idx;
                var rawIndex = oldData.getRawIndex(idx);
                // Data is replaced. In the case of dynamic data queue
                // FIXME FIXME FIXME
                if (rawIndex !== idx) {
                    currPoints.push(oldData.getItemLayout(idx));
                    nextPoints.push(newCoordSys.dataToPoint([
                        oldData.get(dims[0], idx, true),
                        oldData.get(dims[1], idx, true)
                    ]));
                    currStackedPoints.push(oldStackedOnPoints[idx]);
                    nextStackedPoints.push(getStackedOnPoint(newCoordSys, oldData, idx));
                    rawIndices.push(rawIndex);
                } else {
                    pointAdded = false;
                }
            }
            // Original indices
            if (pointAdded) {
                status.push(diffItem);
                sortedIndices.push(sortedIndices.length);
            }
        }
        // Diff result may be crossed if all items are changed
        // Sort by data index
        sortedIndices.sort(function (a, b) {
            return rawIndices[a] - rawIndices[b];
        });
        var sortedCurrPoints = [];
        var sortedNextPoints = [];
        var sortedCurrStackedPoints = [];
        var sortedNextStackedPoints = [];
        var sortedStatus = [];
        for (var i = 0; i < sortedIndices.length; i++) {
            var idx = sortedIndices[i];
            sortedCurrPoints[i] = currPoints[idx];
            sortedNextPoints[i] = nextPoints[idx];
            sortedCurrStackedPoints[i] = currStackedPoints[idx];
            sortedNextStackedPoints[i] = nextStackedPoints[idx];
            sortedStatus[i] = status[idx];
        }
        return {
            current: sortedCurrPoints,
            next: sortedNextPoints,
            stackedOnCurrent: sortedCurrStackedPoints,
            stackedOnNext: sortedNextStackedPoints,
            status: sortedStatus
        };
    };
});
define('echarts/chart/line/poly', ['require', 'zrender/graphic/Path', 'zrender/core/vector'], function (require) {
    var Path = require('zrender/graphic/Path');
    var vec2 = require('zrender/core/vector');
    var vec2Min = vec2.min;
    var vec2Max = vec2.max;
    var scaleAndAdd = vec2.scaleAndAdd;
    var v2Copy = vec2.copy;
    // Temporary variable
    var v = [];
    var cp0 = [];
    var cp1 = [];
    function isPointNull(p) {
        return isNaN(p[0]) || isNaN(p[1]);
    }
    function drawSegment(ctx, points, start, segLen, allLen, dir, smoothMin, smoothMax, smooth, smoothMonotone, connectNulls) {
        var prevIdx = 0;
        var idx = start;
        for (var k = 0; k < segLen; k++) {
            var p = points[idx];
            if (idx >= allLen || idx < 0) {
                break;
            }
            if (isPointNull(p)) {
                if (connectNulls) {
                    idx += dir;
                    continue;
                }
                break;
            }
            if (idx === start) {
                ctx[dir > 0 ? 'moveTo' : 'lineTo'](p[0], p[1]);
                v2Copy(cp0, p);
            } else {
                if (smooth > 0) {
                    var nextIdx = idx + dir;
                    var nextP = points[nextIdx];
                    if (connectNulls) {
                        // Find next point not null
                        while (nextP && isPointNull(points[nextIdx])) {
                            nextIdx += dir;
                            nextP = points[nextIdx];
                        }
                    }
                    var ratioNextSeg = 0.5;
                    var prevP = points[prevIdx];
                    var nextP = points[nextIdx];
                    // Last point
                    if (!nextP || isPointNull(nextP)) {
                        v2Copy(cp1, p);
                    } else {
                        // If next data is null in not connect case
                        if (isPointNull(nextP) && !connectNulls) {
                            nextP = p;
                        }
                        vec2.sub(v, nextP, prevP);
                        var lenPrevSeg;
                        var lenNextSeg;
                        if (smoothMonotone === 'x' || smoothMonotone === 'y') {
                            var dim = smoothMonotone === 'x' ? 0 : 1;
                            lenPrevSeg = Math.abs(p[dim] - prevP[dim]);
                            lenNextSeg = Math.abs(p[dim] - nextP[dim]);
                        } else {
                            lenPrevSeg = vec2.dist(p, prevP);
                            lenNextSeg = vec2.dist(p, nextP);
                        }
                        // Use ratio of seg length
                        ratioNextSeg = lenNextSeg / (lenNextSeg + lenPrevSeg);
                        scaleAndAdd(cp1, p, v, -smooth * (1 - ratioNextSeg));
                    }
                    // Smooth constraint
                    vec2Min(cp0, cp0, smoothMax);
                    vec2Max(cp0, cp0, smoothMin);
                    vec2Min(cp1, cp1, smoothMax);
                    vec2Max(cp1, cp1, smoothMin);
                    ctx.bezierCurveTo(cp0[0], cp0[1], cp1[0], cp1[1], p[0], p[1]);
                    // cp0 of next segment
                    scaleAndAdd(cp0, p, v, smooth * ratioNextSeg);
                } else {
                    ctx.lineTo(p[0], p[1]);
                }
            }
            prevIdx = idx;
            idx += dir;
        }
        return k;
    }
    function getBoundingBox(points, smoothConstraint) {
        var ptMin = [
                Infinity,
                Infinity
            ];
        var ptMax = [
                -Infinity,
                -Infinity
            ];
        if (smoothConstraint) {
            for (var i = 0; i < points.length; i++) {
                var pt = points[i];
                if (pt[0] < ptMin[0]) {
                    ptMin[0] = pt[0];
                }
                if (pt[1] < ptMin[1]) {
                    ptMin[1] = pt[1];
                }
                if (pt[0] > ptMax[0]) {
                    ptMax[0] = pt[0];
                }
                if (pt[1] > ptMax[1]) {
                    ptMax[1] = pt[1];
                }
            }
        }
        return {
            min: smoothConstraint ? ptMin : ptMax,
            max: smoothConstraint ? ptMax : ptMin
        };
    }
    return {
        Polyline: Path.extend({
            type: 'ec-polyline',
            shape: {
                points: [],
                smooth: 0,
                smoothConstraint: true,
                smoothMonotone: null,
                connectNulls: false
            },
            style: {
                fill: null,
                stroke: '#000'
            },
            buildPath: function (ctx, shape) {
                var points = shape.points;
                var i = 0;
                var len = points.length;
                var result = getBoundingBox(points, shape.smoothConstraint);
                if (shape.connectNulls) {
                    // Must remove first and last null values avoid draw error in polygon
                    for (; len > 0; len--) {
                        if (!isPointNull(points[len - 1])) {
                            break;
                        }
                    }
                    for (; i < len; i++) {
                        if (!isPointNull(points[i])) {
                            break;
                        }
                    }
                }
                while (i < len) {
                    i += drawSegment(ctx, points, i, len, len, 1, result.min, result.max, shape.smooth, shape.smoothMonotone, shape.connectNulls) + 1;
                }
            }
        }),
        Polygon: Path.extend({
            type: 'ec-polygon',
            shape: {
                points: [],
                stackedOnPoints: [],
                smooth: 0,
                stackedOnSmooth: 0,
                smoothConstraint: true,
                smoothMonotone: null,
                connectNulls: false
            },
            buildPath: function (ctx, shape) {
                var points = shape.points;
                var stackedOnPoints = shape.stackedOnPoints;
                var i = 0;
                var len = points.length;
                var smoothMonotone = shape.smoothMonotone;
                var bbox = getBoundingBox(points, shape.smoothConstraint);
                var stackedOnBBox = getBoundingBox(stackedOnPoints, shape.smoothConstraint);
                if (shape.connectNulls) {
                    // Must remove first and last null values avoid draw error in polygon
                    for (; len > 0; len--) {
                        if (!isPointNull(points[len - 1])) {
                            break;
                        }
                    }
                    for (; i < len; i++) {
                        if (!isPointNull(points[i])) {
                            break;
                        }
                    }
                }
                while (i < len) {
                    var k = drawSegment(ctx, points, i, len, len, 1, bbox.min, bbox.max, shape.smooth, smoothMonotone, shape.connectNulls);
                    drawSegment(ctx, stackedOnPoints, i + k - 1, k, len, -1, stackedOnBBox.min, stackedOnBBox.max, shape.stackedOnSmooth, smoothMonotone, shape.connectNulls);
                    i += k + 1;
                    ctx.closePath();
                }
            }
        })
    };
});
define('echarts/component/helper/selectableMixin', ['require', 'zrender/core/util'], function (require) {
    var zrUtil = require('zrender/core/util');
    return {
        updateSelectedMap: function (targetList) {
            this._selectTargetMap = zrUtil.reduce(targetList || [], function (targetMap, target) {
                targetMap[target.name] = target;
                return targetMap;
            }, {});
        },
        select: function (name) {
            var targetMap = this._selectTargetMap;
            var target = targetMap[name];
            var selectedMode = this.get('selectedMode');
            if (selectedMode === 'single') {
                zrUtil.each(targetMap, function (target) {
                    target.selected = false;
                });
            }
            target && (target.selected = true);
        },
        unSelect: function (name) {
            var target = this._selectTargetMap[name];
            // var selectedMode = this.get('selectedMode');
            // selectedMode !== 'single' && target && (target.selected = false);
            target && (target.selected = false);
        },
        toggleSelected: function (name) {
            var target = this._selectTargetMap[name];
            if (target != null) {
                this[target.selected ? 'unSelect' : 'select'](name);
                return target.selected;
            }
        },
        isSelected: function (name) {
            var target = this._selectTargetMap[name];
            return target && target.selected;
        }
    };
});
define('echarts/chart/helper/LargeSymbolDraw', ['require', '../../util/graphic', '../../util/symbol'], function (require) {
    var graphic = require('../../util/graphic');
    var symbolUtil = require('../../util/symbol');
    var LargeSymbolPath = graphic.extendShape({
            shape: {
                points: null,
                sizes: null
            },
            symbolProxy: null,
            buildPath: function (path, shape) {
                var points = shape.points;
                var sizes = shape.sizes;
                var symbolProxy = this.symbolProxy;
                var symbolProxyShape = symbolProxy.shape;
                for (var i = 0; i < points.length; i++) {
                    var pt = points[i];
                    var size = sizes[i];
                    if (size[0] < 4) {
                        // Optimize for small symbol
                        path.rect(pt[0] - size[0] / 2, pt[1] - size[1] / 2, size[0], size[1]);
                    } else {
                        symbolProxyShape.x = pt[0] - size[0] / 2;
                        symbolProxyShape.y = pt[1] - size[1] / 2;
                        symbolProxyShape.width = size[0];
                        symbolProxyShape.height = size[1];
                        symbolProxy.buildPath(path, symbolProxyShape, true);
                    }
                }
            },
            findDataIndex: function (x, y) {
                var shape = this.shape;
                var points = shape.points;
                var sizes = shape.sizes;
                // Not consider transform
                // Treat each element as a rect
                // top down traverse
                for (var i = points.length - 1; i >= 0; i--) {
                    var pt = points[i];
                    var size = sizes[i];
                    var x0 = pt[0] - size[0] / 2;
                    var y0 = pt[1] - size[1] / 2;
                    if (x >= x0 && y >= y0 && x <= x0 + size[0] && y <= y0 + size[1]) {
                        // i is dataIndex
                        return i;
                    }
                }
                return -1;
            }
        });
    function LargeSymbolDraw() {
        this.group = new graphic.Group();
        this._symbolEl = new LargeSymbolPath({});
    }
    var largeSymbolProto = LargeSymbolDraw.prototype;
    /**
     * Update symbols draw by new data
     * @param {module:echarts/data/List} data
     */
    largeSymbolProto.updateData = function (data) {
        this.group.removeAll();
        var symbolEl = this._symbolEl;
        var seriesModel = data.hostModel;
        symbolEl.setShape({
            points: data.mapArray(data.getItemLayout),
            sizes: data.mapArray(function (idx) {
                var size = data.getItemVisual(idx, 'symbolSize');
                if (!(size instanceof Array)) {
                    size = [
                        size,
                        size
                    ];
                }
                return size;
            })
        });
        // Create symbolProxy to build path for each data
        symbolEl.symbolProxy = symbolUtil.createSymbol(data.getVisual('symbol'), 0, 0, 0, 0);
        // Use symbolProxy setColor method
        symbolEl.setColor = symbolEl.symbolProxy.setColor;
        symbolEl.useStyle(seriesModel.getModel('itemStyle.normal').getItemStyle(['color']));
        var visualColor = data.getVisual('color');
        if (visualColor) {
            symbolEl.setColor(visualColor);
        }
        // Enable tooltip
        // PENDING May have performance issue when path is extremely large
        symbolEl.seriesIndex = seriesModel.seriesIndex;
        symbolEl.on('mousemove', function (e) {
            symbolEl.dataIndex = null;
            var dataIndex = symbolEl.findDataIndex(e.offsetX, e.offsetY);
            if (dataIndex > 0) {
                // Provide dataIndex for tooltip
                symbolEl.dataIndex = dataIndex;
            }
        });
        // Add back
        this.group.add(symbolEl);
    };
    largeSymbolProto.updateLayout = function (seriesModel) {
        var data = seriesModel.getData();
        this._symbolEl.setShape({ points: data.mapArray(data.getItemLayout) });
    };
    largeSymbolProto.remove = function () {
        this.group.removeAll();
    };
    return LargeSymbolDraw;
});
define('echarts/chart/helper/EffectSymbol', ['require', 'zrender/core/util', '../../util/symbol', '../../util/graphic', '../../util/number', './Symbol'], function (require) {
    var zrUtil = require('zrender/core/util');
    var symbolUtil = require('../../util/symbol');
    var graphic = require('../../util/graphic');
    var numberUtil = require('../../util/number');
    var Symbol = require('./Symbol');
    var Group = graphic.Group;
    var EFFECT_RIPPLE_NUMBER = 3;
    function normalizeSymbolSize(symbolSize) {
        if (!zrUtil.isArray(symbolSize)) {
            symbolSize = [
                +symbolSize,
                +symbolSize
            ];
        }
        return symbolSize;
    }
    function updateRipplePath(rippleGroup, effectCfg) {
        rippleGroup.eachChild(function (ripplePath) {
            ripplePath.attr({
                z: effectCfg.z,
                zlevel: effectCfg.zlevel,
                style: {
                    stroke: effectCfg.brushType === 'stroke' ? effectCfg.color : null,
                    fill: effectCfg.brushType === 'fill' ? effectCfg.color : null
                }
            });
        });
    }
    /**
     * @constructor
     * @param {module:echarts/data/List} data
     * @param {number} idx
     * @extends {module:zrender/graphic/Group}
     */
    function EffectSymbol(data, idx) {
        Group.call(this);
        var symbol = new Symbol(data, idx);
        var rippleGroup = new Group();
        this.add(symbol);
        this.add(rippleGroup);
        rippleGroup.beforeUpdate = function () {
            this.attr(symbol.getScale());
        };
        this.updateData(data, idx);
    }
    var effectSymbolProto = EffectSymbol.prototype;
    effectSymbolProto.stopEffectAnimation = function () {
        this.childAt(1).removeAll();
    };
    effectSymbolProto.startEffectAnimation = function (effectCfg) {
        var symbolType = effectCfg.symbolType;
        var color = effectCfg.color;
        var rippleGroup = this.childAt(1);
        for (var i = 0; i < EFFECT_RIPPLE_NUMBER; i++) {
            // var ripplePath = symbolUtil.createSymbol(
            //     symbolType, -0.5, -0.5, 1, 1, color
            // );
            // If width/height are set too small (e.g., set to 1) on ios10
            // and macOS Sierra, a circle stroke become a rect, no matter what
            // the scale is set. So we set width/height as 2. See #4136.
            var ripplePath = symbolUtil.createSymbol(symbolType, -1, -1, 2, 2, color);
            ripplePath.attr({
                style: { strokeNoScale: true },
                z2: 99,
                silent: true,
                scale: [
                    0.5,
                    0.5
                ]
            });
            var delay = -i / EFFECT_RIPPLE_NUMBER * effectCfg.period + effectCfg.effectOffset;
            // TODO Configurable effectCfg.period
            ripplePath.animate('', true).when(effectCfg.period, {
                scale: [
                    effectCfg.rippleScale / 2,
                    effectCfg.rippleScale / 2
                ]
            }).delay(delay).start();
            ripplePath.animateStyle(true).when(effectCfg.period, { opacity: 0 }).delay(delay).start();
            rippleGroup.add(ripplePath);
        }
        updateRipplePath(rippleGroup, effectCfg);
    };
    /**
     * Update effect symbol
     */
    effectSymbolProto.updateEffectAnimation = function (effectCfg) {
        var oldEffectCfg = this._effectCfg;
        var rippleGroup = this.childAt(1);
        // Must reinitialize effect if following configuration changed
        var DIFFICULT_PROPS = [
                'symbolType',
                'period',
                'rippleScale'
            ];
        for (var i = 0; i < DIFFICULT_PROPS; i++) {
            var propName = DIFFICULT_PROPS[i];
            if (oldEffectCfg[propName] !== effectCfg[propName]) {
                this.stopEffectAnimation();
                this.startEffectAnimation(effectCfg);
                return;
            }
        }
        updateRipplePath(rippleGroup, effectCfg);
    };
    /**
     * Highlight symbol
     */
    effectSymbolProto.highlight = function () {
        this.trigger('emphasis');
    };
    /**
     * Downplay symbol
     */
    effectSymbolProto.downplay = function () {
        this.trigger('normal');
    };
    /**
     * Update symbol properties
     * @param  {module:echarts/data/List} data
     * @param  {number} idx
     */
    effectSymbolProto.updateData = function (data, idx) {
        var seriesModel = data.hostModel;
        this.childAt(0).updateData(data, idx);
        var rippleGroup = this.childAt(1);
        var itemModel = data.getItemModel(idx);
        var symbolType = data.getItemVisual(idx, 'symbol');
        var symbolSize = normalizeSymbolSize(data.getItemVisual(idx, 'symbolSize'));
        var color = data.getItemVisual(idx, 'color');
        rippleGroup.attr('scale', symbolSize);
        rippleGroup.traverse(function (ripplePath) {
            ripplePath.attr({ fill: color });
        });
        var symbolOffset = itemModel.getShallow('symbolOffset');
        if (symbolOffset) {
            var pos = rippleGroup.position;
            pos[0] = numberUtil.parsePercent(symbolOffset[0], symbolSize[0]);
            pos[1] = numberUtil.parsePercent(symbolOffset[1], symbolSize[1]);
        }
        rippleGroup.rotation = (itemModel.getShallow('symbolRotate') || 0) * Math.PI / 180 || 0;
        var effectCfg = {};
        effectCfg.showEffectOn = seriesModel.get('showEffectOn');
        effectCfg.rippleScale = itemModel.get('rippleEffect.scale');
        effectCfg.brushType = itemModel.get('rippleEffect.brushType');
        effectCfg.period = itemModel.get('rippleEffect.period') * 1000;
        effectCfg.effectOffset = idx / data.count();
        effectCfg.z = itemModel.getShallow('z') || 0;
        effectCfg.zlevel = itemModel.getShallow('zlevel') || 0;
        effectCfg.symbolType = symbolType;
        effectCfg.color = color;
        this.off('mouseover').off('mouseout').off('emphasis').off('normal');
        if (effectCfg.showEffectOn === 'render') {
            this._effectCfg ? this.updateEffectAnimation(effectCfg) : this.startEffectAnimation(effectCfg);
            this._effectCfg = effectCfg;
        } else {
            // Not keep old effect config
            this._effectCfg = null;
            this.stopEffectAnimation();
            var symbol = this.childAt(0);
            var onEmphasis = function () {
                symbol.trigger('emphasis');
                if (effectCfg.showEffectOn !== 'render') {
                    this.startEffectAnimation(effectCfg);
                }
            };
            var onNormal = function () {
                symbol.trigger('normal');
                if (effectCfg.showEffectOn !== 'render') {
                    this.stopEffectAnimation();
                }
            };
            this.on('mouseover', onEmphasis, this).on('mouseout', onNormal, this).on('emphasis', onEmphasis, this).on('normal', onNormal, this);
        }
        this._effectCfg = effectCfg;
    };
    effectSymbolProto.fadeOut = function (cb) {
        this.off('mouseover').off('mouseout').off('emphasis').off('normal');
        cb && cb();
    };
    zrUtil.inherits(EffectSymbol, Group);
    return EffectSymbol;
});
define('echarts/util/symbol', ['require', './graphic', 'zrender/core/BoundingRect'], function (require) {
    'use strict';
    var graphic = require('./graphic');
    var BoundingRect = require('zrender/core/BoundingRect');
    /**
     * Triangle shape
     * @inner
     */
    var Triangle = graphic.extendShape({
            type: 'triangle',
            shape: {
                cx: 0,
                cy: 0,
                width: 0,
                height: 0
            },
            buildPath: function (path, shape) {
                var cx = shape.cx;
                var cy = shape.cy;
                var width = shape.width / 2;
                var height = shape.height / 2;
                path.moveTo(cx, cy - height);
                path.lineTo(cx + width, cy + height);
                path.lineTo(cx - width, cy + height);
                path.closePath();
            }
        });
    /**
     * Diamond shape
     * @inner
     */
    var Diamond = graphic.extendShape({
            type: 'diamond',
            shape: {
                cx: 0,
                cy: 0,
                width: 0,
                height: 0
            },
            buildPath: function (path, shape) {
                var cx = shape.cx;
                var cy = shape.cy;
                var width = shape.width / 2;
                var height = shape.height / 2;
                path.moveTo(cx, cy - height);
                path.lineTo(cx + width, cy);
                path.lineTo(cx, cy + height);
                path.lineTo(cx - width, cy);
                path.closePath();
            }
        });
    /**
     * Pin shape
     * @inner
     */
    var Pin = graphic.extendShape({
            type: 'pin',
            shape: {
                x: 0,
                y: 0,
                width: 0,
                height: 0
            },
            buildPath: function (path, shape) {
                var x = shape.x;
                var y = shape.y;
                var w = shape.width / 5 * 3;
                // Height must be larger than width
                var h = Math.max(w, shape.height);
                var r = w / 2;
                // Dist on y with tangent point and circle center
                var dy = r * r / (h - r);
                var cy = y - h + r + dy;
                var angle = Math.asin(dy / r);
                // Dist on x with tangent point and circle center
                var dx = Math.cos(angle) * r;
                var tanX = Math.sin(angle);
                var tanY = Math.cos(angle);
                path.arc(x, cy, r, Math.PI - angle, Math.PI * 2 + angle);
                var cpLen = r * 0.6;
                var cpLen2 = r * 0.7;
                path.bezierCurveTo(x + dx - tanX * cpLen, cy + dy + tanY * cpLen, x, y - cpLen2, x, y);
                path.bezierCurveTo(x, y - cpLen2, x - dx + tanX * cpLen, cy + dy + tanY * cpLen, x - dx, cy + dy);
                path.closePath();
            }
        });
    /**
     * Arrow shape
     * @inner
     */
    var Arrow = graphic.extendShape({
            type: 'arrow',
            shape: {
                x: 0,
                y: 0,
                width: 0,
                height: 0
            },
            buildPath: function (ctx, shape) {
                var height = shape.height;
                var width = shape.width;
                var x = shape.x;
                var y = shape.y;
                var dx = width / 3 * 2;
                ctx.moveTo(x, y);
                ctx.lineTo(x + dx, y + height);
                ctx.lineTo(x, y + height / 4 * 3);
                ctx.lineTo(x - dx, y + height);
                ctx.lineTo(x, y);
                ctx.closePath();
            }
        });
    /**
     * Map of path contructors
     * @type {Object.<string, module:zrender/graphic/Path>}
     */
    var symbolCtors = {
            line: graphic.Line,
            rect: graphic.Rect,
            roundRect: graphic.Rect,
            square: graphic.Rect,
            circle: graphic.Circle,
            diamond: Diamond,
            pin: Pin,
            arrow: Arrow,
            triangle: Triangle
        };
    var symbolShapeMakers = {
            line: function (x, y, w, h, shape) {
                // FIXME
                shape.x1 = x;
                shape.y1 = y + h / 2;
                shape.x2 = x + w;
                shape.y2 = y + h / 2;
            },
            rect: function (x, y, w, h, shape) {
                shape.x = x;
                shape.y = y;
                shape.width = w;
                shape.height = h;
            },
            roundRect: function (x, y, w, h, shape) {
                shape.x = x;
                shape.y = y;
                shape.width = w;
                shape.height = h;
                shape.r = Math.min(w, h) / 4;
            },
            square: function (x, y, w, h, shape) {
                var size = Math.min(w, h);
                shape.x = x;
                shape.y = y;
                shape.width = size;
                shape.height = size;
            },
            circle: function (x, y, w, h, shape) {
                // Put circle in the center of square
                shape.cx = x + w / 2;
                shape.cy = y + h / 2;
                shape.r = Math.min(w, h) / 2;
            },
            diamond: function (x, y, w, h, shape) {
                shape.cx = x + w / 2;
                shape.cy = y + h / 2;
                shape.width = w;
                shape.height = h;
            },
            pin: function (x, y, w, h, shape) {
                shape.x = x + w / 2;
                shape.y = y + h / 2;
                shape.width = w;
                shape.height = h;
            },
            arrow: function (x, y, w, h, shape) {
                shape.x = x + w / 2;
                shape.y = y + h / 2;
                shape.width = w;
                shape.height = h;
            },
            triangle: function (x, y, w, h, shape) {
                shape.cx = x + w / 2;
                shape.cy = y + h / 2;
                shape.width = w;
                shape.height = h;
            }
        };
    var symbolBuildProxies = {};
    for (var name in symbolCtors) {
        if (symbolCtors.hasOwnProperty(name)) {
            symbolBuildProxies[name] = new symbolCtors[name]();
        }
    }
    var Symbol = graphic.extendShape({
            type: 'symbol',
            shape: {
                symbolType: '',
                x: 0,
                y: 0,
                width: 0,
                height: 0
            },
            beforeBrush: function () {
                var style = this.style;
                var shape = this.shape;
                // FIXME
                if (shape.symbolType === 'pin' && style.textPosition === 'inside') {
                    style.textPosition = [
                        '50%',
                        '40%'
                    ];
                    style.textAlign = 'center';
                    style.textVerticalAlign = 'middle';
                }
            },
            buildPath: function (ctx, shape, inBundle) {
                var symbolType = shape.symbolType;
                var proxySymbol = symbolBuildProxies[symbolType];
                if (shape.symbolType !== 'none') {
                    if (!proxySymbol) {
                        // Default rect
                        symbolType = 'rect';
                        proxySymbol = symbolBuildProxies[symbolType];
                    }
                    symbolShapeMakers[symbolType](shape.x, shape.y, shape.width, shape.height, proxySymbol.shape);
                    proxySymbol.buildPath(ctx, proxySymbol.shape, inBundle);
                }
            }
        });
    // Provide setColor helper method to avoid determine if set the fill or stroke outside
    var symbolPathSetColor = function (color) {
        if (this.type !== 'image') {
            var symbolStyle = this.style;
            var symbolShape = this.shape;
            if (symbolShape && symbolShape.symbolType === 'line') {
                symbolStyle.stroke = color;
            } else if (this.__isEmptyBrush) {
                symbolStyle.stroke = color;
                symbolStyle.fill = '#fff';
            } else {
                // FIXME 判断图形默认是填充还是描边，使用 onlyStroke ?
                symbolStyle.fill && (symbolStyle.fill = color);
                symbolStyle.stroke && (symbolStyle.stroke = color);
            }
            this.dirty(false);
        }
    };
    var symbolUtil = {
            createSymbol: function (symbolType, x, y, w, h, color) {
                var isEmpty = symbolType.indexOf('empty') === 0;
                if (isEmpty) {
                    symbolType = symbolType.substr(5, 1).toLowerCase() + symbolType.substr(6);
                }
                var symbolPath;
                if (symbolType.indexOf('image://') === 0) {
                    symbolPath = new graphic.Image({
                        style: {
                            image: symbolType.slice(8),
                            x: x,
                            y: y,
                            width: w,
                            height: h
                        }
                    });
                } else if (symbolType.indexOf('path://') === 0) {
                    symbolPath = graphic.makePath(symbolType.slice(7), {}, new BoundingRect(x, y, w, h));
                } else {
                    symbolPath = new Symbol({
                        shape: {
                            symbolType: symbolType,
                            x: x,
                            y: y,
                            width: w,
                            height: h
                        }
                    });
                }
                symbolPath.__isEmptyBrush = isEmpty;
                symbolPath.setColor = symbolPathSetColor;
                symbolPath.setColor(color);
                return symbolPath;
            }
        };
    return symbolUtil;
});
define('echarts/component/helper/listComponent', ['require', '../../util/layout', '../../util/format', '../../util/graphic'], function (require) {
    // List layout
    var layout = require('../../util/layout');
    var formatUtil = require('../../util/format');
    var graphic = require('../../util/graphic');
    function positionGroup(group, model, api) {
        layout.positionElement(group, model.getBoxLayoutParams(), {
            width: api.getWidth(),
            height: api.getHeight()
        }, model.get('padding'));
    }
    return {
        layout: function (group, componentModel, api) {
            var rect = layout.getLayoutRect(componentModel.getBoxLayoutParams(), {
                    width: api.getWidth(),
                    height: api.getHeight()
                }, componentModel.get('padding'));
            layout.box(componentModel.get('orient'), group, componentModel.get('itemGap'), rect.width, rect.height);
            positionGroup(group, componentModel, api);
        },
        addBackground: function (group, componentModel) {
            var padding = formatUtil.normalizeCssArray(componentModel.get('padding'));
            var boundingRect = group.getBoundingRect();
            var style = componentModel.getItemStyle([
                    'color',
                    'opacity'
                ]);
            style.fill = componentModel.get('backgroundColor');
            var rect = new graphic.Rect({
                    shape: {
                        x: boundingRect.x - padding[3],
                        y: boundingRect.y - padding[0],
                        width: boundingRect.width + padding[1] + padding[3],
                        height: boundingRect.height + padding[0] + padding[2]
                    },
                    style: style,
                    silent: true,
                    z2: -1
                });
            graphic.subPixelOptimizeRect(rect);
            group.add(rect);
        }
    };
});
define('echarts/component/tooltip/TooltipContent', ['require', 'zrender/core/util', 'zrender/tool/color', 'zrender/core/event', '../../util/format', 'zrender/core/env'], function (require) {
    var zrUtil = require('zrender/core/util');
    var zrColor = require('zrender/tool/color');
    var eventUtil = require('zrender/core/event');
    var formatUtil = require('../../util/format');
    var each = zrUtil.each;
    var toCamelCase = formatUtil.toCamelCase;
    var env = require('zrender/core/env');
    var vendors = [
            '',
            '-webkit-',
            '-moz-',
            '-o-'
        ];
    var gCssText = 'position:absolute;display:block;border-style:solid;white-space:nowrap;z-index:9999999;';
    /**
     * @param {number} duration
     * @return {string}
     * @inner
     */
    function assembleTransition(duration) {
        var transitionCurve = 'cubic-bezier(0.23, 1, 0.32, 1)';
        var transitionText = 'left ' + duration + 's ' + transitionCurve + ',' + 'top ' + duration + 's ' + transitionCurve;
        return zrUtil.map(vendors, function (vendorPrefix) {
            return vendorPrefix + 'transition:' + transitionText;
        }).join(';');
    }
    /**
     * @param {Object} textStyle
     * @return {string}
     * @inner
     */
    function assembleFont(textStyleModel) {
        var cssText = [];
        var fontSize = textStyleModel.get('fontSize');
        var color = textStyleModel.getTextColor();
        color && cssText.push('color:' + color);
        cssText.push('font:' + textStyleModel.getFont());
        fontSize && cssText.push('line-height:' + Math.round(fontSize * 3 / 2) + 'px');
        each([
            'decoration',
            'align'
        ], function (name) {
            var val = textStyleModel.get(name);
            val && cssText.push('text-' + name + ':' + val);
        });
        return cssText.join(';');
    }
    /**
     * @param {Object} tooltipModel
     * @return {string}
     * @inner
     */
    function assembleCssText(tooltipModel) {
        tooltipModel = tooltipModel;
        var cssText = [];
        var transitionDuration = tooltipModel.get('transitionDuration');
        var backgroundColor = tooltipModel.get('backgroundColor');
        var textStyleModel = tooltipModel.getModel('textStyle');
        var padding = tooltipModel.get('padding');
        // Animation transition
        transitionDuration && cssText.push(assembleTransition(transitionDuration));
        if (backgroundColor) {
            if (env.canvasSupported) {
                cssText.push('background-Color:' + backgroundColor);
            } else {
                // for ie
                cssText.push('background-Color:#' + zrColor.toHex(backgroundColor));
                cssText.push('filter:alpha(opacity=70)');
            }
        }
        // Border style
        each([
            'width',
            'color',
            'radius'
        ], function (name) {
            var borderName = 'border-' + name;
            var camelCase = toCamelCase(borderName);
            var val = tooltipModel.get(camelCase);
            val != null && cssText.push(borderName + ':' + val + (name === 'color' ? '' : 'px'));
        });
        // Text style
        cssText.push(assembleFont(textStyleModel));
        // Padding
        if (padding != null) {
            cssText.push('padding:' + formatUtil.normalizeCssArray(padding).join('px ') + 'px');
        }
        return cssText.join(';') + ';';
    }
    /**
     * @alias module:echarts/component/tooltip/TooltipContent
     * @constructor
     */
    function TooltipContent(container, api) {
        var el = document.createElement('div');
        var zr = api.getZr();
        this.el = el;
        this._x = api.getWidth() / 2;
        this._y = api.getHeight() / 2;
        container.appendChild(el);
        this._container = container;
        this._show = false;
        /**
         * @private
         */
        this._hideTimeout;
        var self = this;
        el.onmouseenter = function () {
            // clear the timeout in hideLater and keep showing tooltip
            if (self.enterable) {
                clearTimeout(self._hideTimeout);
                self._show = true;
            }
            self._inContent = true;
        };
        el.onmousemove = function (e) {
            e = e || window.event;
            if (!self.enterable) {
                // Try trigger zrender event to avoid mouse
                // in and out shape too frequently
                var handler = zr.handler;
                eventUtil.normalizeEvent(container, e, true);
                handler.dispatch('mousemove', e);
            }
        };
        el.onmouseleave = function () {
            if (self.enterable) {
                if (self._show) {
                    self.hideLater(self._hideDelay);
                }
            }
            self._inContent = false;
        };
    }
    TooltipContent.prototype = {
        constructor: TooltipContent,
        enterable: true,
        update: function () {
            var container = this._container;
            var stl = container.currentStyle || document.defaultView.getComputedStyle(container);
            var domStyle = container.style;
            if (domStyle.position !== 'absolute' && stl.position !== 'absolute') {
                domStyle.position = 'relative';
            }    // Hide the tooltip
                 // PENDING
                 // this.hide();
        },
        show: function (tooltipModel) {
            clearTimeout(this._hideTimeout);
            var el = this.el;
            el.style.cssText = gCssText + assembleCssText(tooltipModel) + ';left:' + this._x + 'px;top:' + this._y + 'px;' + (tooltipModel.get('extraCssText') || '');
            el.style.display = el.innerHTML ? 'block' : 'none';
            this._show = true;
        },
        setContent: function (content) {
            var el = this.el;
            el.innerHTML = content;
            el.style.display = content ? 'block' : 'none';
        },
        moveTo: function (x, y) {
            var style = this.el.style;
            style.left = x + 'px';
            style.top = y + 'px';
            this._x = x;
            this._y = y;
        },
        hide: function () {
            this.el.style.display = 'none';
            this._show = false;
        },
        hideLater: function (time) {
            if (this._show && !(this._inContent && this.enterable)) {
                if (time) {
                    this._hideDelay = time;
                    // Set show false to avoid invoke hideLater mutiple times
                    this._show = false;
                    this._hideTimeout = setTimeout(zrUtil.bind(this.hide, this), time);
                } else {
                    this.hide();
                }
            }
        },
        isShow: function () {
            return this._show;
        }
    };
    return TooltipContent;
});
define('echarts/component/axis/AxisBuilder', ['require', 'zrender/core/util', '../../util/format', '../../util/graphic', '../../model/Model', '../../util/number', 'zrender/core/vector'], function (require) {
    var zrUtil = require('zrender/core/util');
    var formatUtil = require('../../util/format');
    var graphic = require('../../util/graphic');
    var Model = require('../../model/Model');
    var numberUtil = require('../../util/number');
    var remRadian = numberUtil.remRadian;
    var isRadianAroundZero = numberUtil.isRadianAroundZero;
    var vec2 = require('zrender/core/vector');
    var v2ApplyTransform = vec2.applyTransform;
    var retrieve = zrUtil.retrieve;
    var PI = Math.PI;
    function makeAxisEventDataBase(axisModel) {
        var eventData = { componentType: axisModel.mainType };
        eventData[axisModel.mainType + 'Index'] = axisModel.componentIndex;
        return eventData;
    }
    /**
     * A final axis is translated and rotated from a "standard axis".
     * So opt.position and opt.rotation is required.
     *
     * A standard axis is and axis from [0, 0] to [0, axisExtent[1]],
     * for example: (0, 0) ------------> (0, 50)
     *
     * nameDirection or tickDirection or labelDirection is 1 means tick
     * or label is below the standard axis, whereas is -1 means above
     * the standard axis. labelOffset means offset between label and axis,
     * which is useful when 'onZero', where axisLabel is in the grid and
     * label in outside grid.
     *
     * Tips: like always,
     * positive rotation represents anticlockwise, and negative rotation
     * represents clockwise.
     * The direction of position coordinate is the same as the direction
     * of screen coordinate.
     *
     * Do not need to consider axis 'inverse', which is auto processed by
     * axis extent.
     *
     * @param {module:zrender/container/Group} group
     * @param {Object} axisModel
     * @param {Object} opt Standard axis parameters.
     * @param {Array.<number>} opt.position [x, y]
     * @param {number} opt.rotation by radian
     * @param {number} [opt.nameDirection=1] 1 or -1 Used when nameLocation is 'middle'.
     * @param {number} [opt.tickDirection=1] 1 or -1
     * @param {number} [opt.labelDirection=1] 1 or -1
     * @param {number} [opt.labelOffset=0] Usefull when onZero.
     * @param {string} [opt.axisLabelShow] default get from axisModel.
     * @param {string} [opt.axisName] default get from axisModel.
     * @param {number} [opt.axisNameAvailableWidth]
     * @param {number} [opt.labelRotation] by degree, default get from axisModel.
     * @param {number} [opt.labelInterval] Default label interval when label
     *                                     interval from model is null or 'auto'.
     * @param {number} [opt.strokeContainThreshold] Default label interval when label
     */
    var AxisBuilder = function (axisModel, opt) {
        /**
         * @readOnly
         */
        this.opt = opt;
        /**
         * @readOnly
         */
        this.axisModel = axisModel;
        // Default value
        zrUtil.defaults(opt, {
            labelOffset: 0,
            nameDirection: 1,
            tickDirection: 1,
            labelDirection: 1,
            silent: true
        });
        /**
         * @readOnly
         */
        this.group = new graphic.Group();
        // FIXME Not use a seperate text group?
        var dumbGroup = new graphic.Group({
                position: opt.position.slice(),
                rotation: opt.rotation
            });
        // this.group.add(dumbGroup);
        // this._dumbGroup = dumbGroup;
        dumbGroup.updateTransform();
        this._transform = dumbGroup.transform;
        this._dumbGroup = dumbGroup;
    };
    AxisBuilder.prototype = {
        constructor: AxisBuilder,
        hasBuilder: function (name) {
            return !!builders[name];
        },
        add: function (name) {
            builders[name].call(this);
        },
        getGroup: function () {
            return this.group;
        }
    };
    var builders = {
            axisLine: function () {
                var opt = this.opt;
                var axisModel = this.axisModel;
                if (!axisModel.get('axisLine.show')) {
                    return;
                }
                var extent = this.axisModel.axis.getExtent();
                var matrix = this._transform;
                var pt1 = [
                        extent[0],
                        0
                    ];
                var pt2 = [
                        extent[1],
                        0
                    ];
                if (matrix) {
                    v2ApplyTransform(pt1, pt1, matrix);
                    v2ApplyTransform(pt2, pt2, matrix);
                }
                this.group.add(new graphic.Line(graphic.subPixelOptimizeLine({
                    anid: 'line',
                    shape: {
                        x1: pt1[0],
                        y1: pt1[1],
                        x2: pt2[0],
                        y2: pt2[1]
                    },
                    style: zrUtil.extend({ lineCap: 'round' }, axisModel.getModel('axisLine.lineStyle').getLineStyle()),
                    strokeContainThreshold: opt.strokeContainThreshold || 5,
                    silent: true,
                    z2: 1
                })));
            },
            axisTick: function () {
                var axisModel = this.axisModel;
                if (!axisModel.get('axisTick.show')) {
                    return;
                }
                var axis = axisModel.axis;
                var tickModel = axisModel.getModel('axisTick');
                var opt = this.opt;
                var lineStyleModel = tickModel.getModel('lineStyle');
                var tickLen = tickModel.get('length');
                var tickInterval = getInterval(tickModel, opt.labelInterval);
                var ticksCoords = axis.getTicksCoords(tickModel.get('alignWithLabel'));
                var ticks = axis.scale.getTicks();
                var pt1 = [];
                var pt2 = [];
                var matrix = this._transform;
                for (var i = 0; i < ticksCoords.length; i++) {
                    // Only ordinal scale support tick interval
                    if (ifIgnoreOnTick(axis, i, tickInterval)) {
                        continue;
                    }
                    var tickCoord = ticksCoords[i];
                    pt1[0] = tickCoord;
                    pt1[1] = 0;
                    pt2[0] = tickCoord;
                    pt2[1] = opt.tickDirection * tickLen;
                    if (matrix) {
                        v2ApplyTransform(pt1, pt1, matrix);
                        v2ApplyTransform(pt2, pt2, matrix);
                    }
                    // Tick line, Not use group transform to have better line draw
                    this.group.add(new graphic.Line(graphic.subPixelOptimizeLine({
                        anid: 'tick_' + ticks[i],
                        shape: {
                            x1: pt1[0],
                            y1: pt1[1],
                            x2: pt2[0],
                            y2: pt2[1]
                        },
                        style: zrUtil.defaults(lineStyleModel.getLineStyle(), { stroke: axisModel.get('axisLine.lineStyle.color') }),
                        z2: 2,
                        silent: true
                    })));
                }
            },
            axisLabel: function () {
                var opt = this.opt;
                var axisModel = this.axisModel;
                var show = retrieve(opt.axisLabelShow, axisModel.get('axisLabel.show'));
                if (!show) {
                    return;
                }
                var axis = axisModel.axis;
                var labelModel = axisModel.getModel('axisLabel');
                var textStyleModel = labelModel.getModel('textStyle');
                var labelMargin = labelModel.get('margin');
                var ticks = axis.scale.getTicks();
                var labels = axisModel.getFormattedLabels();
                // Special label rotate.
                var labelRotation = retrieve(opt.labelRotation, labelModel.get('rotate')) || 0;
                // To radian.
                labelRotation = labelRotation * PI / 180;
                var labelLayout = innerTextLayout(opt, labelRotation, opt.labelDirection);
                var categoryData = axisModel.get('data');
                var textEls = [];
                var silent = isSilent(axisModel);
                var triggerEvent = axisModel.get('triggerEvent');
                zrUtil.each(ticks, function (tickVal, index) {
                    if (ifIgnoreOnTick(axis, index, opt.labelInterval)) {
                        return;
                    }
                    var itemTextStyleModel = textStyleModel;
                    if (categoryData && categoryData[tickVal] && categoryData[tickVal].textStyle) {
                        itemTextStyleModel = new Model(categoryData[tickVal].textStyle, textStyleModel, axisModel.ecModel);
                    }
                    var textColor = itemTextStyleModel.getTextColor() || axisModel.get('axisLine.lineStyle.color');
                    var tickCoord = axis.dataToCoord(tickVal);
                    var pos = [
                            tickCoord,
                            opt.labelOffset + opt.labelDirection * labelMargin
                        ];
                    var labelBeforeFormat = axis.scale.getLabel(tickVal);
                    var textEl = new graphic.Text({
                            anid: 'label_' + tickVal,
                            style: {
                                text: labels[index],
                                textAlign: itemTextStyleModel.get('align', true) || labelLayout.textAlign,
                                textVerticalAlign: itemTextStyleModel.get('baseline', true) || labelLayout.verticalAlign,
                                textFont: itemTextStyleModel.getFont(),
                                fill: typeof textColor === 'function' ? textColor(labelBeforeFormat) : textColor
                            },
                            position: pos,
                            rotation: labelLayout.rotation,
                            silent: silent,
                            z2: 10
                        });
                    // Pack data for mouse event
                    if (triggerEvent) {
                        textEl.eventData = makeAxisEventDataBase(axisModel);
                        textEl.eventData.targetType = 'axisLabel';
                        textEl.eventData.value = labelBeforeFormat;
                    }
                    // FIXME
                    this._dumbGroup.add(textEl);
                    textEl.updateTransform();
                    textEls.push(textEl);
                    this.group.add(textEl);
                    textEl.decomposeTransform();
                }, this);
                function isTwoLabelOverlapped(current, next) {
                    var firstRect = current && current.getBoundingRect().clone();
                    var nextRect = next && next.getBoundingRect().clone();
                    if (firstRect && nextRect) {
                        firstRect.applyTransform(current.getLocalTransform());
                        nextRect.applyTransform(next.getLocalTransform());
                        return firstRect.intersect(nextRect);
                    }
                }
                if (axis.type !== 'category') {
                    // If min or max are user set, we need to check
                    // If the tick on min(max) are overlap on their neighbour tick
                    // If they are overlapped, we need to hide the min(max) tick label
                    if (axisModel.getMin ? axisModel.getMin() : axisModel.get('min')) {
                        var firstLabel = textEls[0];
                        var nextLabel = textEls[1];
                        if (isTwoLabelOverlapped(firstLabel, nextLabel)) {
                            firstLabel.ignore = true;
                        }
                    }
                    if (axisModel.getMax ? axisModel.getMax() : axisModel.get('max')) {
                        var lastLabel = textEls[textEls.length - 1];
                        var prevLabel = textEls[textEls.length - 2];
                        if (isTwoLabelOverlapped(prevLabel, lastLabel)) {
                            lastLabel.ignore = true;
                        }
                    }
                }
            },
            axisName: function () {
                var opt = this.opt;
                var axisModel = this.axisModel;
                var name = retrieve(opt.axisName, axisModel.get('name'));
                if (!name) {
                    return;
                }
                var nameLocation = axisModel.get('nameLocation');
                var nameDirection = opt.nameDirection;
                var textStyleModel = axisModel.getModel('nameTextStyle');
                var gap = axisModel.get('nameGap') || 0;
                var extent = this.axisModel.axis.getExtent();
                var gapSignal = extent[0] > extent[1] ? -1 : 1;
                var pos = [
                        nameLocation === 'start' ? extent[0] - gapSignal * gap : nameLocation === 'end' ? extent[1] + gapSignal * gap : (extent[0] + extent[1]) / 2,
                        nameLocation === 'middle' ? opt.labelOffset + nameDirection * gap : 0
                    ];
                var labelLayout;
                var nameRotation = axisModel.get('nameRotate');
                if (nameRotation != null) {
                    nameRotation = nameRotation * PI / 180;    // To radian.
                }
                var axisNameAvailableWidth;
                if (nameLocation === 'middle') {
                    labelLayout = innerTextLayout(opt, nameRotation != null ? nameRotation : opt.rotation, nameDirection);
                } else {
                    labelLayout = endTextLayout(opt, nameLocation, nameRotation || 0, extent);
                    axisNameAvailableWidth = opt.axisNameAvailableWidth;
                    if (axisNameAvailableWidth != null) {
                        axisNameAvailableWidth = Math.abs(axisNameAvailableWidth / Math.sin(labelLayout.rotation));
                        !isFinite(axisNameAvailableWidth) && (axisNameAvailableWidth = null);
                    }
                }
                var textFont = textStyleModel.getFont();
                var truncateOpt = axisModel.get('nameTruncate', true) || {};
                var ellipsis = truncateOpt.ellipsis;
                var maxWidth = retrieve(truncateOpt.maxWidth, axisNameAvailableWidth);
                var truncatedText = ellipsis != null && maxWidth != null ? formatUtil.truncateText(name, maxWidth, textFont, ellipsis, {
                        minChar: 2,
                        placeholder: truncateOpt.placeholder
                    }) : name;
                var tooltipOpt = axisModel.get('tooltip', true);
                var mainType = axisModel.mainType;
                var formatterParams = {
                        componentType: mainType,
                        name: name,
                        $vars: ['name']
                    };
                formatterParams[mainType + 'Index'] = axisModel.componentIndex;
                var textEl = new graphic.Text({
                        anid: 'name',
                        __fullText: name,
                        __truncatedText: truncatedText,
                        style: {
                            text: truncatedText,
                            textFont: textFont,
                            fill: textStyleModel.getTextColor() || axisModel.get('axisLine.lineStyle.color'),
                            textAlign: labelLayout.textAlign,
                            textVerticalAlign: labelLayout.verticalAlign
                        },
                        position: pos,
                        rotation: labelLayout.rotation,
                        silent: isSilent(axisModel),
                        z2: 1,
                        tooltip: tooltipOpt && tooltipOpt.show ? zrUtil.extend({
                            content: name,
                            formatter: function () {
                                return name;
                            },
                            formatterParams: formatterParams
                        }, tooltipOpt) : null
                    });
                if (axisModel.get('triggerEvent')) {
                    textEl.eventData = makeAxisEventDataBase(axisModel);
                    textEl.eventData.targetType = 'axisName';
                    textEl.eventData.name = name;
                }
                // FIXME
                this._dumbGroup.add(textEl);
                textEl.updateTransform();
                this.group.add(textEl);
                textEl.decomposeTransform();
            }
        };
    /**
     * @inner
     */
    function innerTextLayout(opt, textRotation, direction) {
        var rotationDiff = remRadian(textRotation - opt.rotation);
        var textAlign;
        var verticalAlign;
        if (isRadianAroundZero(rotationDiff)) {
            // Label is parallel with axis line.
            verticalAlign = direction > 0 ? 'top' : 'bottom';
            textAlign = 'center';
        } else if (isRadianAroundZero(rotationDiff - PI)) {
            // Label is inverse parallel with axis line.
            verticalAlign = direction > 0 ? 'bottom' : 'top';
            textAlign = 'center';
        } else {
            verticalAlign = 'middle';
            if (rotationDiff > 0 && rotationDiff < PI) {
                textAlign = direction > 0 ? 'right' : 'left';
            } else {
                textAlign = direction > 0 ? 'left' : 'right';
            }
        }
        return {
            rotation: rotationDiff,
            textAlign: textAlign,
            verticalAlign: verticalAlign
        };
    }
    /**
     * @inner
     */
    function endTextLayout(opt, textPosition, textRotate, extent) {
        var rotationDiff = remRadian(textRotate - opt.rotation);
        var textAlign;
        var verticalAlign;
        var inverse = extent[0] > extent[1];
        var onLeft = textPosition === 'start' && !inverse || textPosition !== 'start' && inverse;
        if (isRadianAroundZero(rotationDiff - PI / 2)) {
            verticalAlign = onLeft ? 'bottom' : 'top';
            textAlign = 'center';
        } else if (isRadianAroundZero(rotationDiff - PI * 1.5)) {
            verticalAlign = onLeft ? 'top' : 'bottom';
            textAlign = 'center';
        } else {
            verticalAlign = 'middle';
            if (rotationDiff < PI * 1.5 && rotationDiff > PI / 2) {
                textAlign = onLeft ? 'left' : 'right';
            } else {
                textAlign = onLeft ? 'right' : 'left';
            }
        }
        return {
            rotation: rotationDiff,
            textAlign: textAlign,
            verticalAlign: verticalAlign
        };
    }
    /**
     * @inner
     */
    function isSilent(axisModel) {
        var tooltipOpt = axisModel.get('tooltip');
        return axisModel.get('silent') || !(axisModel.get('triggerEvent') || tooltipOpt && tooltipOpt.show);
    }
    /**
     * @static
     */
    var ifIgnoreOnTick = AxisBuilder.ifIgnoreOnTick = function (axis, i, interval) {
            var rawTick;
            var scale = axis.scale;
            return scale.type === 'ordinal' && (typeof interval === 'function' ? (rawTick = scale.getTicks()[i], !interval(rawTick, scale.getLabel(rawTick))) : i % (interval + 1));
        };
    /**
     * @static
     */
    var getInterval = AxisBuilder.getInterval = function (model, labelInterval) {
            var interval = model.get('interval');
            if (interval == null || interval == 'auto') {
                interval = labelInterval;
            }
            return interval;
        };
    return AxisBuilder;
});
define('echarts/chart/pie/labelLayout', ['require', 'zrender/contain/text'], function (require) {
    'use strict';
    var textContain = require('zrender/contain/text');
    function adjustSingleSide(list, cx, cy, r, dir, viewWidth, viewHeight) {
        list.sort(function (a, b) {
            return a.y - b.y;
        });
        // 压
        function shiftDown(start, end, delta, dir) {
            for (var j = start; j < end; j++) {
                list[j].y += delta;
                if (j > start && j + 1 < end && list[j + 1].y > list[j].y + list[j].height) {
                    shiftUp(j, delta / 2);
                    return;
                }
            }
            shiftUp(end - 1, delta / 2);
        }
        // 弹
        function shiftUp(end, delta) {
            for (var j = end; j >= 0; j--) {
                list[j].y -= delta;
                if (j > 0 && list[j].y > list[j - 1].y + list[j - 1].height) {
                    break;
                }
            }
        }
        function changeX(list, isDownList, cx, cy, r, dir) {
            var lastDeltaX = dir > 0 ? isDownList ? Number.MAX_VALUE : 0 : isDownList ? Number.MAX_VALUE : 0;
            // 上
            for (var i = 0, l = list.length; i < l; i++) {
                // Not change x for center label
                if (list[i].position === 'center') {
                    continue;
                }
                var deltaY = Math.abs(list[i].y - cy);
                var length = list[i].len;
                var length2 = list[i].len2;
                var deltaX = deltaY < r + length ? Math.sqrt((r + length + length2) * (r + length + length2) - deltaY * deltaY) : Math.abs(list[i].x - cx);
                if (isDownList && deltaX >= lastDeltaX) {
                    // 右下，左下
                    deltaX = lastDeltaX - 10;
                }
                if (!isDownList && deltaX <= lastDeltaX) {
                    // 右上，左上
                    deltaX = lastDeltaX + 10;
                }
                list[i].x = cx + deltaX * dir;
                lastDeltaX = deltaX;
            }
        }
        var lastY = 0;
        var delta;
        var len = list.length;
        var upList = [];
        var downList = [];
        for (var i = 0; i < len; i++) {
            delta = list[i].y - lastY;
            if (delta < 0) {
                shiftDown(i, len, -delta, dir);
            }
            lastY = list[i].y + list[i].height;
        }
        if (viewHeight - lastY < 0) {
            shiftUp(len - 1, lastY - viewHeight);
        }
        for (var i = 0; i < len; i++) {
            if (list[i].y >= cy) {
                downList.push(list[i]);
            } else {
                upList.push(list[i]);
            }
        }
        changeX(upList, false, cx, cy, r, dir);
        changeX(downList, true, cx, cy, r, dir);
    }
    function avoidOverlap(labelLayoutList, cx, cy, r, viewWidth, viewHeight) {
        var leftList = [];
        var rightList = [];
        for (var i = 0; i < labelLayoutList.length; i++) {
            if (labelLayoutList[i].x < cx) {
                leftList.push(labelLayoutList[i]);
            } else {
                rightList.push(labelLayoutList[i]);
            }
        }
        adjustSingleSide(rightList, cx, cy, r, 1, viewWidth, viewHeight);
        adjustSingleSide(leftList, cx, cy, r, -1, viewWidth, viewHeight);
        for (var i = 0; i < labelLayoutList.length; i++) {
            var linePoints = labelLayoutList[i].linePoints;
            if (linePoints) {
                var dist = linePoints[1][0] - linePoints[2][0];
                if (labelLayoutList[i].x < cx) {
                    linePoints[2][0] = labelLayoutList[i].x + 3;
                } else {
                    linePoints[2][0] = labelLayoutList[i].x - 3;
                }
                linePoints[1][1] = linePoints[2][1] = labelLayoutList[i].y;
                linePoints[1][0] = linePoints[2][0] + dist;
            }
        }
    }
    return function (seriesModel, r, viewWidth, viewHeight) {
        var data = seriesModel.getData();
        var labelLayoutList = [];
        var cx;
        var cy;
        var hasLabelRotate = false;
        data.each(function (idx) {
            var layout = data.getItemLayout(idx);
            var itemModel = data.getItemModel(idx);
            var labelModel = itemModel.getModel('label.normal');
            // Use position in normal or emphasis
            var labelPosition = labelModel.get('position') || itemModel.get('label.emphasis.position');
            var labelLineModel = itemModel.getModel('labelLine.normal');
            var labelLineLen = labelLineModel.get('length');
            var labelLineLen2 = labelLineModel.get('length2');
            var midAngle = (layout.startAngle + layout.endAngle) / 2;
            var dx = Math.cos(midAngle);
            var dy = Math.sin(midAngle);
            var textX;
            var textY;
            var linePoints;
            var textAlign;
            cx = layout.cx;
            cy = layout.cy;
            var isLabelInside = labelPosition === 'inside' || labelPosition === 'inner';
            if (labelPosition === 'center') {
                textX = layout.cx;
                textY = layout.cy;
                textAlign = 'center';
            } else {
                var x1 = (isLabelInside ? (layout.r + layout.r0) / 2 * dx : layout.r * dx) + cx;
                var y1 = (isLabelInside ? (layout.r + layout.r0) / 2 * dy : layout.r * dy) + cy;
                textX = x1 + dx * 3;
                textY = y1 + dy * 3;
                if (!isLabelInside) {
                    // For roseType
                    var x2 = x1 + dx * (labelLineLen + r - layout.r);
                    var y2 = y1 + dy * (labelLineLen + r - layout.r);
                    var x3 = x2 + (dx < 0 ? -1 : 1) * labelLineLen2;
                    var y3 = y2;
                    textX = x3 + (dx < 0 ? -5 : 5);
                    textY = y3;
                    linePoints = [
                        [
                            x1,
                            y1
                        ],
                        [
                            x2,
                            y2
                        ],
                        [
                            x3,
                            y3
                        ]
                    ];
                }
                textAlign = isLabelInside ? 'center' : dx > 0 ? 'left' : 'right';
            }
            var font = labelModel.getModel('textStyle').getFont();
            var labelRotate = labelModel.get('rotate') ? dx < 0 ? -midAngle + Math.PI : -midAngle : 0;
            var text = seriesModel.getFormattedLabel(idx, 'normal') || data.getName(idx);
            var textRect = textContain.getBoundingRect(text, font, textAlign, 'top');
            hasLabelRotate = !!labelRotate;
            layout.label = {
                x: textX,
                y: textY,
                position: labelPosition,
                height: textRect.height,
                len: labelLineLen,
                len2: labelLineLen2,
                linePoints: linePoints,
                textAlign: textAlign,
                verticalAlign: 'middle',
                font: font,
                rotation: labelRotate
            };
            // Not layout the inside label
            if (!isLabelInside) {
                labelLayoutList.push(layout.label);
            }
        });
        if (!hasLabelRotate && seriesModel.get('avoidLabelOverlap')) {
            avoidOverlap(labelLayoutList, cx, cy, r, viewWidth, viewHeight);
        }
    };
});
define('zrender', ['zrender/zrender'], function (zrender) { return zrender;});
define('echarts', ['echarts/echarts'], function (echarts) { return echarts;});
var echarts = require('echarts');

echarts.graphic = require('echarts/util/graphic');
echarts.number = require('echarts/util/number');
echarts.format = require('echarts/util/format');


require('echarts/chart/bar');

require('echarts/chart/line');

require('echarts/chart/pie');

require('echarts/chart/scatter');

require('echarts/chart/effectScatter');


require('echarts/component/grid');

require('echarts/component/title');

require('echarts/component/legend');

require('echarts/component/tooltip');




return echarts;
}));; 
function renderOreport(datas){
	  var $curPage = ajaxPage.getCurPage();
	  var _id = $curPage.attr("id")+"_report_body";
	  var myChart = echarts.init(document.getElementById(_id));
	  $curPage.find(".report_title").html(datas.name);
	  if("pie"==datas.sign){	//馅饼图
	  	var legendArr = [];
        $.each(datas.data, function(i,obj){ 
        	legendArr.push(obj.name);
        	}); 
        myChart.setOption({
            legend: {
                data:legendArr
            },
            tooltip : {
                trigger: 'item',
                formatter: "{a} <br/>{b} : {c} ({d}%)"
            },
            calculable : true,
            series : [
                {
                    type:'pie',
                    radius : '55%',
                    center: ['50%', '55%'],
                    roseType: 'angle',
                    data:datas.data
                }
            ]
        });
	  }
  
  if("scatter"==datas.sign){	//散点图
        myChart.setOption({
            tooltip : {
                trigger: 'axis'
            },
            grid:{
            	x:25,
            	y:25,
            	x2:15,
            	y2:22,
            	left:'2%',
		    	right: '2%',
		    	containLabel: true
		    },
            calculable : true,
            xAxis : [
                {
                	type : 'value',
                	splitLine: {
                        show: true,
                        lineStyle: {
                            color: '#455061'
                        }
                    },
                    axisLine: {
                        lineStyle: {
                            color: '#4C4C4C'
                        }
                    }
                }
            ],
            yAxis : [
                {
                    type : 'value',
                    splitLine: {
                        show: true,
                        lineStyle: {
                            color: '#455061'
                        }
                    },
                    axisLine: {
                        lineStyle: {
                            color: '#4C4C4C'
                        }
                    }
                }
            ],
            series : [
                {
                    type:'scatter',
                    data:datas.data
                }
            ]
        });
	  }
  
  if("area"==datas.sign){	//面积图
        myChart.setOption({
            tooltip : {
                trigger: 'axis'
            },
            grid:{
            	x:25,
            	y:25,
            	x2:15,
            	y2:22,
            	left:'2%',
		    	right: '2%',
		    	containLabel: true
		    },
            calculable : true,
            xAxis : [
                {
                    type : 'category',
                    boundaryGap : false,
                    data : datas.xAxis
                }
            ],
            yAxis : [
                {
                    type : 'value',
                }
            ],
            series : [
                {
                    type:'line',
                    smooth:true,
                    itemStyle: {normal: {areaStyle: {type: 'default'}}},
                    data:datas.yAxis
                }
            ]
        });
	  }
  
  if("line"==datas.sign){	//折线图
        myChart.setOption({
            tooltip : {
                trigger: 'axis'
            },
            grid:{
            	x:25,
            	y:25,
            	x2:15,
            	y2:22,
            	left:'2%',
		    	right: '5%',
		    	containLabel: true
		    },
            calculable : true,
            xAxis : [
                {
                    type : 'category',
                    boundaryGap : false,
                    data : datas.xAxis
                }
            ],
            yAxis : [
                {
                    type : 'value',
                }
            ],
            series : [
                {
                    type:'line',
                    data:datas.yAxis
                }
            ]
        });
	  }
  
  if("bar"==datas.sign){	//条形图
        myChart.setOption({
            tooltip : {
                trigger: 'axis'
            },
            grid:{
		    	x:40,
		    	y:25,
		    	x2:10,
		    	y2:22,
		    	left:'2%',
		    	right: '2%',
		    	containLabel: true
		    },
            calculable : true,
            xAxis : [
                {
                    type : 'value',
                    boundaryGap : [0, 0.01]
                }
            ],
            yAxis : [
                {
                    type : 'category',
                    data : datas.xAxis
                }
            ],
            series : [
                {
                    type:'bar',
                    barCategoryGap: '60%',
		            itemStyle: {
		                normal: {
		                    color: 'tomato',
		                    barBorderColor: 'tomato',
		                    barBorderWidth: 0,
		                    barBorderRadius:4,
		                    label : {
		                        show: true, position: 'insideLeft'
		                    }
		                }
		            },
                    data:datas.yAxis
                }
            ]
        });
	  }
  
  if("histogram"==datas.sign){	//柱状图
	  myChart.setOption({
	    tooltip : {
	        trigger: 'axis'
	    },
	    grid:{
	    	x:25,
	    	y:25,
	    	x2:15,
	    	y2:22,
	    	left:'2%',
	    	right: '2%',
	    	containLabel: true
	    },
	    calculable : true,
	    xAxis : [
	        {
	            type : 'category',
	            axisLine: {
                    lineStyle: {
                        color: '#4C4C4C'
                    }
                },
	            data : datas.xAxis
	        }
	    ],
	    yAxis : [
	        {
	            type : 'value',
	            axisLine: {
                    lineStyle: {
                        color: '#4C4C4C'
                    }
                }
	        }
	    ],
	    series : [
	        {
	            type:'bar',
	            barCategoryGap: '60%',
	            itemStyle: {
	                normal: {
	                    color: 'tomato',
	                    barBorderColor: 'tomato',
	                    barBorderWidth: 6,
	                    barBorderRadius:0,
	                    label : {
	                        show: true, position: 'insideTop'
	                    }
	                }
	            },
	            data:datas.yAxis
	        }
	    ]
	  })
  }
} 
function showReport(){
	var $curPage = ajaxPage.getCurPage();
	var _id = $curPage.attr("id");
	$curPage.find(".report_body").attr("id",_id+"_report_body");	//echart需要获取容器的id，避免id重复，用表单id+"_report_body"
	var data = "";
	var formId = $curPage.find(".report_body").attr("_formId");
	var applicatioId = $curPage.find(".report_body").attr("_applicatioId");;
	$.ajax({
		  //type: "POST",
		  url: contextPath+'/portal/widget/getCustomizeReportData.action',
		  data:{id:formId},
		  success: function(datae){
			  if(datae != ""){
				  $curPage.find(".refreshMenuReport").show();
				  data = JSON.parse(datae);
				  renderOreport(data);
			  }
		    },
		    error:function(error){
		    	console.log(error);
		    }
		})
}; 
 /**
     * 给页面添加文字水印
     */
(function(){

    var watermark = function(self){
        this.elem = self;
    }

    watermark.prototype = {
        defaults : {
        	texts : ['此处水印文字'],
            width : 300, //每行水印文字的水平间距
            height : 250, //水印文字的高度间距（低于文字高度会被替代）
            textRotate : -30 , //文字旋转 度数
            textColor : '#d2d2d2', //文字颜色
            textFont : '16px "Helvetica Neue","Microsoft Yahei"' //字体
        },
        options : {
            canvas : []
        },
        init : function(options){
             $.extend(this.options, this.defaults, options);
            var $body = $('body'),
                can1 = this.__createCanvas($body),
                can2 = this.__createCanvas($body),
                canAll = this.__createCanvas($body),
                settings = this.options,
                txtlen = settings.texts.length;

            settings.deg = settings.textRotate * Math.PI / 180; //js里的正弦余弦用的是弧度

            this.__calcTextSize($body);
            var repeatTimes = Math.ceil(screen.width / settings.txts.length / settings.width);
            settings.canvasWidth = settings.canvasWidth * repeatTimes;
            var extTxts = [];
            while(repeatTimes--) extTxts = extTxts.concat(settings.txts);
            settings.txts = extTxts;

            var fixH = settings.maxWidth * Math.abs(Math.sin(settings.deg)) + Math.cos(settings.deg) * settings.textHeight;
            if(fixH > settings.height) settings.height = fixH;
            var ctx1 = this.__setCanvasStyle(can1, settings.canvasWidth, settings.height);
            var ctx2 = this.__setCanvasStyle(can2, settings.canvasWidth, settings.height);
            var ctx = this.__setCanvasStyle(canAll, settings.canvasWidth, settings.height * 2, true);

            this.__drawText(ctx1, settings.txts);
            this.__drawText(ctx2, settings.txts.reverse());
            
            //画布距离顶部有一段空白，计算backgroundPosition
            var topX = settings.width * Math.cos(settings.deg);
            var topY = parseInt(- topX * Math.tan(settings.deg) + settings.height);
            //合并canvas
            ctx.drawImage(can1, 0, 0, settings.canvasWidth, settings.height);
            ctx.drawImage(can2, 0, settings.height, settings.canvasWidth, settings.height);
            var dataURL = canAll.toDataURL("image/png");
            $(this.elem).css('backgroundImage', "url("+ dataURL +")");
            $(this.elem).css('backgroundPosition', "0 -"+topY+"px");
            //this.__destory();
        },
        __createCanvas : function($container){
            var canvas = document.createElement('canvas');
            $container.append(canvas);
            this.options.canvas.push(canvas); 
            return canvas;
        },
        __calcTextSize : function($container){
            var txts = [],
                maxWidth = 0,
                canvasWidth = 0,
                settings = this.options;
            $.each(settings.texts, function(i, text){
                var span = $('<span style="font:'+settings.textFont+';visibility: hidden;display: inline-block;"> '+text+ '</span>')
                    .appendTo($container);
                var tWidth = span[0].offsetWidth,
                    tHeight = span[0].offsetHeight;
                span.remove();
                txts.push({
                    txt : text,
                    width : tWidth,
                    height : tHeight
                });
                maxWidth = Math.max(maxWidth, tWidth);
                settings.textHeight = tHeight;
                var shadow = Math.cos(settings.deg) * tWidth;
                canvasWidth += (settings.width < shadow ? shadow : settings.width) - tHeight * Math.sin(settings.deg);
            });
            settings.txts = txts;
            settings.maxWidth = maxWidth;
            settings.canvasWidth = canvasWidth;
        },
        __setCanvasStyle : function(canvas, width, height, notextstyle){
            canvas.width = width;
            canvas.height = height;
            canvas.style.display='none';
           
            var ctx = canvas.getContext('2d');
            if(!notextstyle){
                var deg = this.options.deg,
                    absSindeg = Math.abs(Math.sin(deg));
                ctx.rotate(deg);
                //基于视窗的 x、y偏移量
                var offset = absSindeg * this.options.height - this.options.textHeight * absSindeg;
                var nx = - offset * Math.cos(deg),
                    ny = - offset * absSindeg;
                ctx.translate( nx, ny * absSindeg);

                ctx.font = this.options.textFont; 
                ctx.fillStyle = this.options.textColor;
                ctx.textAlign = 'left'; 
                ctx.textBaseline = 'Middle';
            }
            return ctx;
        },
        __drawText: function(ctx, txts){
            var settings = this.options;
            $.each(txts, function(i, obj){
                
                var wnap = (settings.maxWidth - obj.width) / 2 ;
                var x = settings.width * Math.cos(settings.deg) * i,
                    y = - x * Math.tan(settings.deg) + settings.height;
                ctx.fillText(obj.txt, x + wnap, y);
            });
        },
        __destory : function(){
            $.each(this.options.canvas, function(i, canvas){
                canvas.remove();
                canvas = null;
            });
        }
    }
   
    $.fn.watermark = function(options){
        new watermark(this).init(options);
    }

})(jQuery);; 
